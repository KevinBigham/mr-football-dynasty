import _R from 'react';
import { ROSTER_CAP, CAMP_CAP, PS_CAP, MIN_SALARY, CAP_MATH, getSalaryCap, getCapFloor, getMinSalary } from './src/config/cap-math.js';
import { makeContract, calcCapHit, calcDeadMoney, restructureContract, backloadContract973, extendAndRestructure973, CONTRACT_VALUE_TABLE_994, AGE_VALUE_CURVE_994, calcContractScore994, calcDeadCap994, calcFourthDownEV995 } from './src/systems/contracts.js';
import { getTradeValue, getTeamNeeds, getGMTradeThresholdMod, getGMFABias, getGMDraftBias } from './src/systems/trade-ai.js';
import { TRADE_MATH, RECORDS_WALL, GM_TRADE_PITCH, getGMTradePitch } from './src/systems/trade-math.js';
import { calcTradeValue, calcPickValue, evaluateTradePackage } from './src/systems/trade-value.js';
import { makePick, pickConditionText972, maybeBuildPickCondition972, pickValue, draftContract, aucContract } from './src/systems/draft-utils.js';
import { STARTER_COUNTS, SCOUT_COSTS86, SCOUT_POINT_GYM_BONUS86, SCOUT_POINT_WIN_BONUS86, genPickBlurb, genRunAlerts } from './src/systems/scouting.js';
// SCOUT_POINT_BASE86 kept local â€” dynamically mutated for large leagues (line ~12740)
var SCOUT_POINT_BASE86 = 1000;
import { COMP_PICKS_986 } from './src/systems/comp-picks.js';
import { OWNER_ARCHETYPES, initOwner, updateOwnerApproval, getOwnerStatus } from './src/systems/owner.js';
import { getPersonality, traitScalar, generatePersonality, PERS_ICONS, PERS_LABELS, getDominantTrait, getContractPersonalityEffects } from './src/systems/personality.js';
import { chemistryMod, systemFitMod, updateSystemFit, resetSystemFit } from './src/systems/chemistry.js';
import { T, SP, RAD, SH, S } from './src/config/theme.js';
import { HALFTIME_V2 } from './src/systems/halftime.js';
import { CLINIC_TRACKS, CLINIC, CLINIC_MATH } from './src/systems/coaching-clinic.js';
import { TRAITS, TRAIT_FX, TRAIT_MILESTONES95, getPlayerTraits95, hasTrait95, assignTrait, assignTraits, checkTraitMilestones95 } from './src/systems/traits.js';
import { EP_TABLE_993, getEP993, LEVERAGE_INDEX_993, getLeverageIndex, calcWinProbV2_993 } from './src/systems/win-probability.js';
import { TEAM_CLIMATES, CLIMATE_PROFILES, WEATHER, HT_CONDITIONS, HT_STRATEGIES } from './src/systems/weather.js';
import { BREAKOUT_SYSTEM } from './src/systems/breakout-system.js';
import { calcDominanceScore, calcDynastyIndex, calcPeakPower, calcLongevity, generateIdentityTags, ERA_THRESHOLD, ALMANAC_SCHEMA_VERSION, generateEraCards, buildHallOfSeasons } from './src/systems/dynasty-analytics.js';
var __MFD_REACT=_R;
var useState=__MFD_REACT&&__MFD_REACT.useState?__MFD_REACT.useState:function(init){
  return [typeof init==="function"?init():init,function(){}];
};
var useRef=__MFD_REACT&&__MFD_REACT.useRef?__MFD_REACT.useRef:function(v){return {current:v};};
var useEffect=__MFD_REACT&&__MFD_REACT.useEffect?__MFD_REACT.useEffect:function(){};
var memo=__MFD_REACT&&__MFD_REACT.memo?__MFD_REACT.memo:function(fn){return fn;};
if(typeof React==="undefined"){var React=__MFD_REACT||{createElement:function(){return null;}};}
if(typeof window!=="undefined"&&window.addEventListener){
  window.addEventListener("error",function(e){
    try{
      if(typeof document==="undefined"||!document.body) return;
      var d=document.getElementById("mfd-crash-display");
      if(!d){
        d=document.createElement("div");d.id="mfd-crash-display";
        d.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:#0f172a;color:#ef4444;padding:40px;font-family:monospace;font-size:13px;z-index:9999;white-space:pre-wrap;overflow:auto;";
        document.body.appendChild(d);
      }
      d.textContent="MFD v95 CRASH:\n\n"+(e.message||"Unknown error")+"\n\nLine: "+(e.lineno||"?")+"\nCol: "+(e.colno||"?")+"\n\n"+(e.error&&e.error.stack?e.error.stack.slice(0,2000):"");
    }catch(_err){}
  });
}
if(!__MFD_REACT&&typeof document!=="undefined"&&document.body){
  try{
    var _mfdBoot=document.createElement("div");
    _mfdBoot.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:#0f172a;color:#ef4444;padding:24px;font-family:monospace;z-index:9999;white-space:pre-wrap;";
    _mfdBoot.textContent="MFD BOOT ERROR: React runtime was not found in this artifact environment.";
    document.body.appendChild(_mfdBoot);
  }catch(_bootErr){}
}

function mS(){var r={};for(var i=0;i<arguments.length;i++){var o=arguments[i];if(o)for(var k in o)r[k]=o[k];}return r;}// merge styles
function StatBar(props){
  var v=props.value||0;var w=props.width||60;var h=props.height||6;
  var c=v>=95?T.cyan:v>=80?T.green:v>=60?T.gold:T.red;
  return React.createElement("div",{style:{display:"inline-flex",alignItems:"center",gap:4}},
    React.createElement("div",{style:{width:w,height:h,background:"rgba(255,255,255,0.06)",borderRadius:h/2,overflow:"hidden"}},
      React.createElement("div",{style:{width:Math.min(v,99)+"%",height:"100%",background:c,borderRadius:h/2,transition:"width 0.3s ease"}})
    ),
    React.createElement("span",{style:{fontSize:10,fontWeight:700,color:c,minWidth:20,textAlign:"right"}},v)
  );
}
function ToneBadge(props){
  var tones={gold:S.badgeGold,green:S.badgeGreen,red:S.badgeRed,purple:S.badgePurple,cyan:S.badgeCyan};
  return React.createElement("span",{style:mS(S.badge,tones[props.tone]||S.badgeGold,props.style||{})},props.children);
}
function WeeklyShowCard(props){
  var ws=props.weekShow;var myId=props.myId;var expanded=props.expanded;var onToggle=props.onToggle;
  if(!ws)return null;
  function reasonTag(r){
    if(r.pdpg>=8)return{tag:"Elite Offense",color:T.green};
    if(r.pdpg<=-5)return{tag:"Struggling Offense",color:T.red};
    if(r.sos>=55)return{tag:"Tough Schedule",color:T.cyan};
    if(r.mom>=2)return{tag:"Hot Streak",color:T.gold};
    if(r.mom<=-2)return{tag:"Cold Streak",color:T.red};
    if(r.winp>=0.7)return{tag:"Dominant",color:T.gold};
    if(r.winp<=0.3)return{tag:"Rebuilding",color:T.faint};
    return{tag:"Steady",color:T.dim};
  }
  return React.createElement("div",{style:mS(S.studioCard,{padding:12})},
    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",marginBottom:expanded?8:0},onClick:onToggle},
      React.createElement("div",{style:mS(S.header,{fontSize:12,color:T.gold})},">> MFD REPORT â€” WK "+ws.week),
      React.createElement("span",{style:{fontSize:10,color:T.faint}},expanded?"â–² Collapse":"â–¼ Expand")
    ),
    React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6,marginTop:6,marginBottom:expanded?8:0}},
      React.createElement("div",{style:mS(S.kpiBox,{background:"rgba(239,68,68,0.06)",border:"1px solid rgba(239,68,68,0.15)",borderRadius:RAD.md})},
        React.createElement("div",{style:{fontSize:14}},ws.upset?"ðŸ˜±":"âœ…"),
        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:ws.upset?T.red:T.green,marginTop:2}},ws.upset?"UPSET":"NO UPSETS"),
        ws.upset&&React.createElement("div",{style:{fontSize:8,color:T.dim,marginTop:1}},ws.upset.winnerAbbr+" over "+ws.upset.loserAbbr)
      ),
      React.createElement("div",{style:mS(S.kpiBox,{background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.15)",borderRadius:RAD.md})},
        React.createElement("div",{style:{fontSize:14}},"ðŸˆ"),
        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,marginTop:2}},"GAME OF WK"),
        ws.gotw&&React.createElement("div",{style:{fontSize:8,color:T.dim,marginTop:1}},ws.gotw.homeAbbr+" "+ws.gotw.score+" "+ws.gotw.awayAbbr)
      ),
      React.createElement("div",{style:mS(S.kpiBox,{background:ws.hotSeat.length>0?"rgba(245,158,11,0.06)":"rgba(255,255,255,0.02)",border:"1px solid "+(ws.hotSeat.length>0?"rgba(245,158,11,0.15)":T.border),borderRadius:RAD.md})},
        React.createElement("div",{style:{fontSize:14}},ws.hotSeat.length>0?"ðŸ”¥":"ðŸ˜Ž"),
        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:ws.hotSeat.length>0?T.orange:T.green,marginTop:2}},ws.hotSeat.length>0?"HOT SEAT":"ALL SAFE"),
        ws.hotSeat[0]&&React.createElement("div",{style:{fontSize:8,color:T.dim,marginTop:1}},ws.hotSeat[0].icon+ws.hotSeat[0].abbr+" ("+ws.hotSeat[0].mood+")")
      )
    ),
    expanded&&React.createElement("div",null,
      React.createElement("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:RAD.sm,padding:8,marginBottom:6}},
        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,marginBottom:4}},"âš¡ TOP TEAMS"),
        ws.powerRanks.slice(0,5).map(function(r,i){
          var isMe2=r.id===myId;var rt=reasonTag(r);
          return React.createElement("div",{key:r.id,style:{display:"flex",alignItems:"center",gap:6,padding:"3px 0",borderBottom:i<4?"1px solid rgba(255,255,255,0.04)":"none"}},
            React.createElement("span",{style:{fontWeight:900,fontSize:12,width:18,color:i===0?T.gold:i<3?T.green:T.dim,textAlign:"center"}},r.rank),
            React.createElement("span",{style:{fontSize:11,fontWeight:isMe2?800:500,color:isMe2?T.gold:T.text}},r.icon+" "+r.abbr),
            React.createElement("span",{style:{fontSize:8,padding:"1px 5px",borderRadius:8,background:"rgba(255,255,255,0.05)",color:rt.color,marginLeft:4}},rt.tag),
            React.createElement("span",{style:{fontSize:10,color:T.dim,marginLeft:"auto"}},r.wins+"-"+r.losses),
            React.createElement("span",{style:{fontSize:9,color:T.faint,width:28,textAlign:"right"}},r.pdpg>0?"+"+r.pdpg:r.pdpg)
          );
        })
      ),
      ws.awards&&ws.awards.mvp[0]&&React.createElement("div",{style:{background:"rgba(0,0,0,0.15)",borderRadius:RAD.sm,padding:8,marginBottom:6}},
        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,marginBottom:4}},"ðŸ… MVP WATCH"),
        ws.awards.mvp.slice(0,3).map(function(c,ci){
          return React.createElement("div",{key:ci,style:{display:"flex",alignItems:"center",gap:6,padding:"2px 0",fontSize:10}},
            React.createElement("span",{style:{fontWeight:900,width:14,color:ci===0?T.gold:T.dim}},ci+1),
            React.createElement("span",{style:{fontWeight:600}},c.name),
            React.createElement("span",{style:{color:T.gold,fontSize:9}},c.pos),
            React.createElement("span",{style:{color:T.dim,marginLeft:"auto",fontSize:9}},c.icon+c.team),
            React.createElement("span",{style:{color:T.faint,fontSize:9,marginLeft:4}},c.score+" pts")
          );
        })
      ),
      ws.headlines&&ws.headlines.length>0&&React.createElement("div",{style:{background:"rgba(0,0,0,0.1)",borderRadius:RAD.sm,padding:8}},
        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,marginBottom:4}},"ðŸ“° HEADLINES"),
        ws.headlines.slice(0,4).map(function(h,hi){
          return React.createElement("div",{key:hi,style:{fontSize:9,color:T.dim,padding:"1px 0"}},h);
        })
      )
    )
  );
}
function mulberry32(seed){var s=seed|0;return function(){s=s+0x6D2B79F5|0;var t=Math.imul(s^(s>>>15),s|1);t=t+(Math.imul(t^(t>>>7),t|61)^t)|0;return((t^(t>>>14))>>>0)/4294967296;};}
var SEED_GLOBAL=12345;// v52: Safe constant default â€” Date.now() only at league creation, never in sim chain
var RNG={play:mulberry32(SEED_GLOBAL),injury:mulberry32(SEED_GLOBAL+1),draft:mulberry32(SEED_GLOBAL+2),ai:mulberry32(SEED_GLOBAL+3),dev:mulberry32(SEED_GLOBAL+4),trade:mulberry32(SEED_GLOBAL+5),ui:mulberry32(SEED_GLOBAL+6)};// v58 FIX: Removed duplicate ui key (credit: ChatGPT v58 QA)
function assign(t){for(var i=1;i<arguments.length;i++){var s=arguments[i]||{};for(var k in s)if(Object.prototype.hasOwnProperty.call(s,k))t[k]=s[k];}return t;}
function setSeed(s){SEED_GLOBAL=s;RNG={play:mulberry32(s),injury:mulberry32(s+1),draft:mulberry32(s+2),ai:mulberry32(s+3),dev:mulberry32(s+4),trade:mulberry32(s+5),ui:mulberry32(s+6)};}
function reseedWeek(yr,wk){var chain=(SEED_GLOBAL^(yr*1000)^wk)>>>0;RNG.play=mulberry32(chain);RNG.injury=mulberry32(chain+1);RNG.ai=mulberry32(chain+3);RNG.dev=mulberry32(chain+4);RNG.trade=mulberry32(chain+5);}
function reseedSeason(yr){var chain=(SEED_GLOBAL^(yr*7919))>>>0;RNG.draft=mulberry32(chain+2);}
var DIFF_SETTINGS={
  rookie:{name:"Rookie",icon:"â– ",desc:"Forgiving trades, fewer injuries, patient owner. Learn the ropes.",
    tradeMod:0.85,injMod:0.6,ownerMod:0.7,clutchSwing:0.3,moraleMod:0.7,aiBidMod:0.75,staffBudget:28,startCash:100,
    foBudget:30},// v96: Rookie=$30M FO, $28M staff, $100M cash
  pro:{name:"Pro",icon:"â– ",desc:"Standard simulation. Fair trades, normal injury rates, balanced AI.",
    tradeMod:1.0,injMod:1.0,ownerMod:1.0,clutchSwing:0.5,moraleMod:1.0,aiBidMod:1.0,staffBudget:23,startCash:75,
    foBudget:25},// v96: Pro=$25M FO, $23M staff, $75M cash
  allpro:{name:"All-Pro",icon:"â– ",desc:"AI drives harder bargains, injuries pile up, owner expects results.",
    tradeMod:1.2,injMod:1.25,ownerMod:1.3,clutchSwing:0.65,moraleMod:1.2,aiBidMod:1.15,staffBudget:19,startCash:50,
    foBudget:22},// v96: All-Pro=$22M FO, $19M staff, $50M cash
  legend:{name:"Legend",icon:"â– ",desc:"Ruthless AI, devastating injuries, owner on a hair trigger. Glory or bust.",
    tradeMod:1.45,injMod:1.5,ownerMod:1.6,clutchSwing:0.8,moraleMod:1.4,aiBidMod:1.3,staffBudget:16,startCash:25,
    foBudget:20}// v96: Legend=$20M FO, $16M staff, $25M cash
};
var SAVE_VERSION=986;// v98.6: 20 new features â€” Halftime v2, Training Camp, Comp Picks, Power Rankings, Generational Talents, etc.
var DIFF_ACTIVE="pro";// global accessor for difficulty in sim functions outside React

// ===== v98.6 FEATURE PACK: 20 NEW SYSTEMS =====

// #1: HALFTIME_V2 â€” imported from src/systems/halftime.js

// #2: OFFSEASON TRAINING CAMP â€” Allocate focus, players gain/regress
var TRAINING_CAMP_986={
  focuses:["offense","defense","conditioning","development","chemistry"],
  run:function(team,focus,rng2){
    var results=[];
    team.roster.forEach(function(p){
      if(!p||!p.pos)return;
      var we=(p.personality?p.personality.workEthic:5)||5;
      var coachDev=team.staff?((team.staff.hc?team.staff.hc.ratings.development:50)+(focus==="offense"&&team.staff.oc?team.staff.oc.ratings.development:focus==="defense"&&team.staff.dc?team.staff.dc.ratings.development:50))/2:50;
      var baseGain=Math.round((we-5)*0.3+(coachDev-50)*0.02+(rng2()*2-0.5));
      var posMatch=(focus==="offense"&&["QB","RB","WR","TE","OL"].indexOf(p.pos)>=0)||(focus==="defense"&&["DL","LB","CB","S"].indexOf(p.pos)>=0);
      if(posMatch)baseGain+=1;
      if(focus==="development"&&p.age<=25)baseGain+=1;
      if(focus==="conditioning"){p.morale=Math.min(99,(p.morale||70)+3);baseGain=0;}
      if(focus==="chemistry"){p.chemistry=Math.min(100,(p.chemistry||60)+5);baseGain=0;}
      if(we<=3&&rng2()<0.3)baseGain=Math.min(baseGain,-1);// Lazy players risk regression
      baseGain=Math.max(-2,Math.min(3,baseGain));
      if(baseGain!==0){
        var def=typeof POS_DEF!=="undefined"?POS_DEF[p.pos]:null;
        if(def){def.r.forEach(function(r){p.ratings[r]=Math.max(35,Math.min(99,(p.ratings[r]||50)+baseGain));});}
        p.ovr=typeof calcOvr!=="undefined"?calcOvr(p):p.ovr;
      }
      if(baseGain>=2)results.push({name:p.name,pos:p.pos,change:baseGain,type:"star"});
      else if(baseGain<=-1)results.push({name:p.name,pos:p.pos,change:baseGain,type:"decline"});
    });
    return results;
  }
};

// #3: FRANCHISE TAG VARIANTS
var FRANCHISE_TAG_986={
  types:[
    {id:"exclusive",label:"Exclusive",desc:"Top-5 salary, cannot negotiate with others",salaryMult:1.2},
    {id:"non_exclusive",label:"Non-Exclusive",desc:"Top-5 avg, others can make offers (you match or get 2 1sts)",salaryMult:1.1},
    {id:"transition",label:"Transition",desc:"Top-10 avg, right of first refusal, no comp picks",salaryMult:0.9}
  ]
};

// #5: COMPENSATORY DRAFT PICKS

// #6: CONTRACT INCENTIVES
var INCENTIVES_986={
  types:[
    {id:"pass_yds",label:"Pass Yards",threshold:3500,bonus:2.0,pos:["QB"]},
    {id:"rush_yds",label:"Rush Yards",threshold:800,bonus:1.5,pos:["RB"]},
    {id:"rec_yds",label:"Rec Yards",threshold:700,bonus:1.5,pos:["WR","TE"]},
    {id:"sacks",label:"Sacks",threshold:8,bonus:1.5,pos:["DL","LB"]},
    {id:"ints",label:"Interceptions",threshold:4,bonus:1.0,pos:["CB","S"]},
    {id:"pro_bowl",label:"Pro Bowl",threshold:1,bonus:2.5,pos:["QB","RB","WR","TE","OL","DL","LB","CB","S"]},
    {id:"playoffs",label:"Make Playoffs",threshold:1,bonus:1.0,pos:["QB","RB","WR","TE","OL","DL","LB","CB","S","K"]}
  ],
  check:function(player,teamRecord){
    if(!player||!player.incentives986)return{hit:[],miss:[],totalBonus:0};
    var hit=[],miss=[],total=0;var s=player.stats||{};
    (player.incentives986||[]).forEach(function(inc){
      var val=0;
      if(inc.id==="pass_yds")val=s.passYds||0;
      else if(inc.id==="rush_yds")val=s.rushYds||0;
      else if(inc.id==="rec_yds")val=s.recYds||0;
      else if(inc.id==="sacks")val=s.sacks||0;
      else if(inc.id==="ints")val=s.defINT||0;
      else if(inc.id==="playoffs")val=teamRecord&&teamRecord.madePlayoffs?1:0;
      if(val>=inc.threshold){hit.push(inc);total+=inc.bonus;}else miss.push(inc);
    });
    return{hit:hit,miss:miss,totalBonus:total};
  }
};

// #7: GM REPUTATION SYSTEM
var GM_REP_986={
  calculate:function(txLog,tradeState){
    var rep={fairDealer:50,aggressive:50,loyalty:50,overall:50};
    if(!txLog)return rep;
    var trades=txLog.filter(function(tx){return tx.type==="TRADE";});
    var signs=txLog.filter(function(tx){return tx.type==="SIGN_FA";});
    rep.fairDealer=Math.min(100,50+trades.length*2);
    rep.aggressive=Math.min(100,30+trades.length*3+signs.length);
    if(tradeState&&tradeState.gmTrustByTeam){
      var trusts=Object.values(tradeState.gmTrustByTeam);
      if(trusts.length>0)rep.loyalty=Math.round(trusts.reduce(function(s,v){return s+v;},0)/trusts.length);
    }
    rep.overall=Math.round((rep.fairDealer+rep.aggressive+rep.loyalty)/3);
    return rep;
  },
  getLabel:function(score){
    if(score>=85)return{label:"Elite GM",icon:"ðŸ‘‘",color:"#d4a74b"};
    if(score>=70)return{label:"Respected",icon:"ðŸ¤",color:"#22c55e"};
    if(score>=50)return{label:"Average",icon:"ðŸ“‹",color:"#64748b"};
    if(score>=30)return{label:"Questionable",icon:"ðŸ¤”",color:"#f59e0b"};
    return{label:"Untrusted",icon:"âš ï¸",color:"#ef4444"};
  }
};

// #8: COACHING CAROUSEL â€” Fired coaches become available
var COACH_CAROUSEL_986={
  firedPool:[],
  fireCoach:function(coach,team,year){
    if(!coach)return;
    COACH_CAROUSEL_986.firedPool.push({name:coach.name,role:coach.role,arch:coach.arch,ratings:Object.assign({},coach.ratings),
      firedFrom:team?team.abbr:"?",firedYear:year,available:true});
    if(COACH_CAROUSEL_986.firedPool.length>20)COACH_CAROUSEL_986.firedPool=COACH_CAROUSEL_986.firedPool.slice(-20);
  }
};

// #9: WEEKLY PRESS CONFERENCES
// v99.3 â€” Mistral: Free Agency Narrative + Press Conference Pack
var FA_NARRATIVE_993 = {   bigSigning: [     "DONE DEAL: [PLAYER] signs with [TEAM] â€” [YEARS] years, [AMOUNT]M. A statement signing that changes everything.",     "Nobody saw this coming. [TEAM] reached deep into the vault and landed [PLAYER]. [AMOUNT]M buys you that kind of disruption.",     "BREAKING: [PLAYER] is officially a [TEAM]. [YEARS] years, [AMOUNT]M. The league just got a lot more interesting.",     "[TEAM] just made a HUGE splash. [PLAYER] is in the fold for [YEARS] years and [AMOUNT]M. Game-changer.",     "The ink is dry. [PLAYER] is heading to [TEAM] on a [YEARS]-year, [AMOUNT]M deal. The rich get richer.",     "[TEAM] just flexed their financial muscle. [PLAYER] is theirs for [YEARS] years and [AMOUNT]M. Wow.",     "Itâ€™s official: [PLAYER] is a [TEAM]. [YEARS] years, [AMOUNT]M. The balance of power just shifted.",     "[TEAM] didnâ€™t mess around. [PLAYER] is theirs for [YEARS] years and [AMOUNT]M. Statement made.",     "The deal is done. [PLAYER] joins [TEAM] on a [YEARS]-year, [AMOUNT]M contract. The offseason just got spicy.",     "[TEAM] just dropped a bombshell. [PLAYER] is in for [YEARS] years and [AMOUNT]M. The league is on notice.",     "[PLAYER] has a new home. [TEAM] locked him up for [YEARS] years and [AMOUNT]M. Huge move.",     "The rumors were true. [PLAYER] is now a [TEAM]. [YEARS] years, [AMOUNT]M. The offseason wins continue.",     "[TEAM] just secured their franchise cornerstone. [PLAYER] signs for [YEARS] years and [AMOUNT]M.",     "Itâ€™s a done deal. [PLAYER] is [TEAM]â€™s latest acquisition: [YEARS] years, [AMOUNT]M. The chess pieces are moving.",     "[TEAM] just made a power move. [PLAYER] is theirs for [YEARS] years and [AMOUNT]M. The arms race is on.",     "[PLAYER] is officially a [TEAM]. [YEARS] years, [AMOUNT]M. The offseason just got a lot more exciting.",     "The contract is signed. [PLAYER] joins [TEAM] for [YEARS] years and [AMOUNT]M. The landscape just changed.",     "[TEAM] just landed their man. [PLAYER] agrees to a [YEARS]-year, [AMOUNT]M deal. The rich keep getting richer.",     "[PLAYER] has found a new home. [TEAM] signs him for [YEARS] years and [AMOUNT]M. The offseason is heating up.",     "[TEAM] just made a splash. [PLAYER] is in the fold for [YEARS] years and [AMOUNT]M. The league takes notice.",     "The deal is sealed. [PLAYER] is now a [TEAM]. [YEARS] years, [AMOUNT]M. The offseason just got real.",     "[TEAM] just flexed. [PLAYER] is theirs for [YEARS] years and [AMOUNT]M. The offseason wins keep coming.",     "[PLAYER] is officially a [TEAM]. [YEARS] years, [AMOUNT]M. The offseason just delivered another blockbuster.",     "[TEAM] just made a statement. [PLAYER] is theirs for [YEARS] years and [AMOUNT]M. The league is watching.",     "Itâ€™s official: [PLAYER] joins [TEAM] on a [YEARS]-year, [AMOUNT]M deal. The offseason just got a lot more interesting."   ],   biddingWar: [     "Three teams are in a full bidding war for [PLAYER]. [TEAM1] and [TEAM2] are the finalists and the price keeps rising.",     "Sources say [TEAM1] and [TEAM2] are locked in a heated battle for [PLAYER]. The offers are getting wild.",     "The race for [PLAYER] is down to [TEAM1] and [TEAM2]. Both teams are pulling out all the stops.",     "[PLAYER] has [TEAM1] and [TEAM2] in a bidding frenzy. The numbers are climbing fast.",     "Itâ€™s a two-horse race for [PLAYER]. [TEAM1] and [TEAM2] are the last teams standing, and the offers are skyrocketing.",     "The battle for [PLAYER] is intense. [TEAM1] and [TEAM2] are the final bidders, and neither is backing down.",     "[TEAM1] and [TEAM2] are going toe-to-toe for [PLAYER]. The offers are getting harder to refuse.",     "The [PLAYER] sweepstakes are down to [TEAM1] and [TEAM2]. The price tag is climbing by the hour.",     "[TEAM1] and [TEAM2] are the last teams in the hunt for [PLAYER]. The offers are getting serious.",     "The bidding war for [PLAYER] is heating up. [TEAM1] and [TEAM2] are the finalists, and the stakes are high.",     "Itâ€™s crunch time for [PLAYER]. [TEAM1] and [TEAM2] are the last teams in the mix, and the offers are escalating.",     "The chase for [PLAYER] is down to [TEAM1] and [TEAM2]. The offers are getting harder to top.",     "[TEAM1] and [TEAM2] are the final bidders for [PLAYER]. The numbers are climbing, and the tension is rising.",     "The [PLAYER] sweepstakes are nearing the finish line. [TEAM1] and [TEAM2] are the last teams in, and the offers are soaring.",     "The battle for [PLAYER] is down to [TEAM1] and [TEAM2]. The offers are getting harder to match.",     "Itâ€™s a showdown for [PLAYER]. [TEAM1] and [TEAM2] are the final bidders, and the price is climbing fast.",     "The race for [PLAYER] is intense. [TEAM1] and [TEAM2] are the last teams standing, and the offers are getting wild.",     "The [PLAYER] bidding war is down to [TEAM1] and [TEAM2]. The numbers are climbing, and the tension is palpable.",     "The chase for [PLAYER] is heating up. [TEAM1] and [TEAM2] are the finalists, and the offers are getting serious.",     "The battle for [PLAYER] is down to the wire. [TEAM1] and [TEAM2] are the last teams in, and the offers are skyrocketing."   ],   playerHoldout: [     "[PLAYER] has informed [TEAM] he will not report until a new deal is in place. The staredown begins.",     "Sources: [PLAYER] wants out of [TEAM]. 'Wants to compete for a championship' is the polite version.",     "[PLAYER] is holding out, and [TEAM] is feeling the pressure. The clock is ticking.",     "[PLAYER] has made it clear: no new deal, no reporting to [TEAM]. The tension is rising.",     "The [PLAYER] holdout is getting serious. [TEAM] needs to make a move, or risk losing him for good.",     "[PLAYER] is digging in. No new contract, no showing up for [TEAM]. The stakes are high.",     "The [PLAYER] situation is escalating. [TEAM] is running out of time to make things right.",     "[PLAYER] is holding firm. No deal, no [TEAM]. The pressure is on the front office.",     "The [PLAYER] holdout is reaching a boiling point. [TEAM] needs to act fast.",     "[PLAYER] is making his stance clear: pay up, or heâ€™s not playing for [TEAM].",     "The [PLAYER] holdout is putting [TEAM] in a tough spot. The clock is ticking, and the tension is rising.",     "[PLAYER] is not backing down. [TEAM] needs to step up, or risk losing a key player.",     "The [PLAYER] situation is getting messy. [TEAM] is on the clock to make things right.",     "[PLAYER] is holding out, and [TEAM] is feeling the heat. The pressure is on to get a deal done.",     "The [PLAYER] holdout is a major story. [TEAM] needs to act fast, or risk losing him for good."   ],   marketUpdate: [     "The market for edge rushers has gone completely cold. Teams spent their money early and the remaining options are thin.",     "If you need a slot receiver right now, good luck. [TEAM] set the market and everyone else followed.",     "The running back market is flooded. Teams are waiting for prices to drop before making a move.",     "The offensive line market is red hot. Teams are paying top dollar for quality protection.",     "The cornerback market is drying up fast. The best options are already off the board.",     "The tight end market is surprisingly active. Teams are willing to pay for reliable hands.",     "The quarterback market is quiet. Teams are waiting for the right opportunity to strike.",     "The linebacker market is heating up. Teams are looking for playmakers on defense.",     "The wide receiver market is slow. Teams are being cautious with their spending.",     "The safety market is active. Teams are looking for versatile defenders to bolster their secondary.",     "The defensive tackle market is thin. The best options are already signed, and the rest are overpriced.",     "The kicker market is always unpredictable. Teams are willing to pay for consistency.",     "The fullback market is nonexistent. Teams are focusing their resources elsewhere.",     "The market for veteran leadership is strong. Teams are looking for experienced players to guide their rosters.",     "The market for young, unproven talent is active. Teams are taking chances on potential.",     "The market for special teamers is quiet. Teams are prioritizing other positions.",     "The market for pass rushers is competitive. Teams are willing to pay a premium for players who can get to the quarterback.",     "The market for offensive playmakers is slow. Teams are being selective with their investments.",     "The market for defensive backs is active. Teams are looking to upgrade their secondary.",     "The market for interior offensive linemen is heating up. Teams are investing in the trenches."   ],   quietPeriodOver: [     "The quiet period is over, and the free agency frenzy is about to begin. Buckle up!",     "The calm before the storm is over. Free agency is here, and the moves are coming fast.",     "The waiting is over. Free agency is officially open, and the chaos is just beginning.",     "The quiet period has ended, and the free agency floodgates are open. Expect fireworks.",     "The offseason just got a lot more interesting. Free agency is here, and the moves are already happening.",     "The anticipation is over. Free agency is officially underway, and the league is about to get wild.",     "The quiet period has ended, and the free agency frenzy is in full swing. Hold on tight.",     "The offseasonâ€™s biggest event is here. Free agency is open, and the moves are coming fast and furious.",     "The calm is over. Free agency is here, and the league is about to be turned upside down.",     "The waiting game is over. Free agency is officially open, and the action is just getting started."   ],   bustedSigning: [     "[PLAYER]â€™s deal with [TEAM] is already looking like a mistake. The red flags were there all along.",     "We saw this coming. [PLAYER]â€™s contract with [TEAM] is turning into a disaster.",     "The [PLAYER] signing was a risk, and itâ€™s not paying off for [TEAM].",     "[TEAM] rolled the dice on [PLAYER], and itâ€™s looking like a bust.",     "The [PLAYER] experiment isnâ€™t working out for [TEAM]. The warning signs were ignored.",     "[PLAYER]â€™s time with [TEAM] is already looking like a mistake. The front office should have known better.",     "The [PLAYER] signing was a gamble, and [TEAM] is losing big.",     "[TEAM] took a chance on [PLAYER], and itâ€™s not working out. The critics were right.",     "The [PLAYER] deal is turning sour for [TEAM]. The red flags were impossible to ignore.",     "[PLAYER]â€™s contract with [TEAM] is looking like a mistake. The front office misjudged this one."   ],   veteranRelease: [     "[TEAM] has released [PLAYER], ending an era. The veteranâ€™s time with the team has come to a close.",     "Itâ€™s the end of the road for [PLAYER] in [TEAM]. The veteran has been released after years of service.",     "[TEAM] has parted ways with [PLAYER]. The veteranâ€™s contributions will not be forgotten.",     "The [PLAYER] era in [TEAM] is over. The veteran has been released, marking the end of a chapter.",     "[TEAM] has released [PLAYER], a respected veteran. The team moves on, but his legacy remains.",     "After years of service, [PLAYER] has been released by [TEAM]. The veteranâ€™s time with the team has ended.",     "[TEAM] has made the tough decision to release [PLAYER]. The veteranâ€™s impact will be remembered.",     "The [PLAYER] era is over in [TEAM]. The veteran has been released, closing a significant chapter.",     "[TEAM] has released [PLAYER], a longtime contributor. The veteranâ€™s time with the team has come to an end.",     "The end of an era: [TEAM] has released [PLAYER]. The veteranâ€™s legacy will live on."   ] };
// 2. Press Conference Expansion
var PRESS_CONFERENCE_993 = {   questions: {     playoffChances: [       { text: "Coach, realistically, what are this teamâ€™s playoff chances this year?", tone: "direct" },       { text: "Do you think this team has what it takes to make a playoff run, or is it another rebuilding year?", tone: "skeptical" },       { text: "The fans want to know: are we looking at a playoff team, or is it going to be another long season?", tone: "adversarial" }     ],     rookiePerformance: [       { text: "How do you assess the rookieâ€™s performance so far?", tone: "neutral" },       { text: "The rookie has had some ups and downs. Are you concerned about his development?", tone: "critical" },       { text: "Whatâ€™s your take on the rookieâ€™s progress? Is he meeting expectations?", tone: "inquisitive" }     ],     injuryUpdate: [       { text: "Can you give us an update on the injured players?", tone: "neutral" },       { text: "The injury list is growing. Are you worried about the teamâ€™s depth?", tone: "concerned" },       { text: "How are the injured players progressing? Any updates on their return?", tone: "hopeful" }     ],     contractDispute: [       { text: "Whatâ€™s the latest on the contract dispute with [PLAYER]?", tone: "direct" },       { text: "The contract situation with [PLAYER] is getting messy. How do you plan to resolve it?", tone: "adversarial" },       { text: "Can you shed any light on the contract negotiations with [PLAYER]?", tone: "inquisitive" }     ],     coachingChanges: [       { text: "There are rumors about possible coaching changes. Can you address those?", tone: "direct" },       { text: "The teamâ€™s performance has been inconsistent. Are you concerned about your job security?", tone: "adversarial" },       { text: "Whatâ€™s your response to the speculation about coaching changes?", tone: "neutral" }     ],     teamMorale: [       { text: "How would you describe the teamâ€™s morale right now?", tone: "neutral" },       { text: "There seem to be some issues in the locker room. How are you addressing team morale?", tone: "concerned" },       { text: "The team seems divided. What are you doing to bring everyone together?", tone: "adversarial" }     ],     fanCriticism: [       { text: "The fans are frustrated. Whatâ€™s your message to them?", tone: "direct" },       { text: "The fanbase is upset with the teamâ€™s performance. How do you plan to win them back?", tone: "adversarial" },       { text: "What do you say to the fans who are calling for changes?", tone: "neutral" }     ],     draftStrategy: [       { text: "Whatâ€™s the teamâ€™s strategy heading into the draft?", tone: "neutral" },       { text: "The draft is coming up. Are you looking to trade up, or will you stay put?", tone: "inquisitive" },       { text: "The team has several needs. How do you plan to address them in the draft?", tone: "direct" }     ],     relocationRumor: [       { text: "There are rumors about the team relocating. Can you comment on that?", tone: "direct" },       { text: "The fans are worried about relocation rumors. What can you tell us?", tone: "concerned" },       { text: "Is there any truth to the rumors about the team moving?", tone: "adversarial" }     ],     starPlayerDemand: [       { text: "[PLAYER] is demanding a trade. How are you handling that situation?", tone: "direct" },       { text: "The [PLAYER] situation is a distraction. How do you plan to resolve it?", tone: "adversarial" },       { text: "Whatâ€™s the latest on [PLAYER]â€™s trade demand?", tone: "inquisitive" }     ],     coordinatorRumor: [       { text: "There are rumors about changes to the coaching staff. Can you address those?", tone: "direct" },       { text: "The teamâ€™s performance has been poor. Are you considering changes to the coaching staff?", tone: "adversarial" },       { text: "Whatâ€™s your response to the rumors about coordinator changes?", tone: "neutral" }     ],     dynastyLegacy: [       { text: "How do you view your legacy with this team?", tone: "neutral" },       { text: "The team hasnâ€™t won a championship in years. How do you reflect on your time here?", tone: "critical" },       { text: "What do you want your legacy to be with this franchise?", tone: "inquisitive" }     ],     rebuilding: [       { text: "The team is clearly in a rebuilding phase. Whatâ€™s your timeline for turning things around?", tone: "direct" },       { text: "The fans are tired of hearing about rebuilding. When can they expect to see results?", tone: "adversarial" },       { text: "Whatâ€™s your vision for the team as you rebuild?", tone: "neutral" }     ]   },   answers: {     playoffChances: [       { text: "Weâ€™re focused on getting better every day. The playoffs are the goal, and weâ€™re working towards that.", tone: "optimistic", moraleEffect: 1, ownerEffect: 0, mediaEffect: 1 },       { text: "Itâ€™s a tough league, and every game is a battle. Weâ€™ll see where we stand when the time comes.", tone: "guarded", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "Our focus is on the process. If we take care of business, the playoffs will take care of themselves.", tone: "process", moraleEffect: 1, ownerEffect: 1, mediaEffect: 1 }     ],     rookiePerformance: [       { text: "Heâ€™s learning and improving every day. Thatâ€™s all we can ask for from a rookie.", tone: "supportive", moraleEffect: 1, ownerEffect: 0, mediaEffect: 1 },       { text: "There are ups and downs, but heâ€™s getting better. Weâ€™re patient with our young players.", tone: "patient", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "Heâ€™s got a lot to learn, but the potential is there. Weâ€™ll keep working with him.", tone: "honest", moraleEffect: 0, ownerEffect: 0, mediaEffect: 1 }     ],     injuryUpdate: [       { text: "Weâ€™re taking it day by day. Their health is our top priority.", tone: "cautious", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "Theyâ€™re making progress, and weâ€™re hopeful theyâ€™ll be back soon.", tone: "optimistic", moraleEffect: 1, ownerEffect: 0, mediaEffect: 1 },       { text: "Injuries are part of the game. Weâ€™ll adjust and keep moving forward.", tone: "stoic", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 }     ],     contractDispute: [       { text: "Weâ€™re working through it. These things take time, but weâ€™re confident weâ€™ll find a solution.", tone: "diplomatic", moraleEffect: 0, ownerEffect: 0, mediaEffect: 1 },       { text: "Weâ€™re focused on whatâ€™s best for the team. Weâ€™ll handle it internally.", tone: "guarded", moraleEffect: -1, ownerEffect: 0, mediaEffect: 0 },       { text: "We respect [PLAYER] and what he brings to the team. Weâ€™re working to resolve this.", tone: "respectful", moraleEffect: 1, ownerEffect: 0, mediaEffect: 1 }     ],     coachingChanges: [       { text: "Iâ€™m focused on coaching this team. The rest is just noise.", tone: "deflect", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "My job is to win games. Thatâ€™s what Iâ€™m focused on.", tone: "direct", moraleEffect: 0, ownerEffect: 0, mediaEffect: 1 },       { text: "Weâ€™re all evaluated every day. Thatâ€™s the nature of this business.", tone: "honest", moraleEffect: -1, ownerEffect: -1, mediaEffect: 2 }     ],     teamMorale: [       { text: "The morale is good. Weâ€™ve got a tight-knit group thatâ€™s focused on getting better.", tone: "positive", moraleEffect: 1, ownerEffect: 0, mediaEffect: 1 },       { text: "Weâ€™re working through some things, but weâ€™re a resilient group. Weâ€™ll be fine.", tone: "resilient", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "Every team goes through ups and downs. Weâ€™re no different. Weâ€™ll get through it.", tone: "honest", moraleEffect: -1, ownerEffect: 0, mediaEffect: 1 }     ],     fanCriticism: [       { text: "We understand the fansâ€™ frustration. Weâ€™re working hard to give them a team they can be proud of.", tone: "empathetic", moraleEffect: 1, ownerEffect: 0, mediaEffect: 2 },       { text: "The fans have a right to their opinions. Weâ€™re focused on improving and giving them a winner.", tone: "diplomatic", moraleEffect: 0, ownerEffect: 0, mediaEffect: 1 },       { text: "We hear the fans. Weâ€™re not where we want to be, but weâ€™re working to get there.", tone: "honest", moraleEffect: 0, ownerEffect: -1, mediaEffect: 2 }     ],     draftStrategy: [       { text: "Weâ€™ll take the best player available. You can never have too much talent.", tone: "optimistic", moraleEffect: 1, ownerEffect: 0, mediaEffect: 1 },       { text: "Weâ€™ve got a plan, and weâ€™ll stick to it. Weâ€™re looking to add players who fit our culture.", tone: "process", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "The draft is about adding pieces that help us win now and in the future. Weâ€™ll be strategic.", tone: "strategic", moraleEffect: 0, ownerEffect: 1, mediaEffect: 1 }     ],     relocationRumor: [       { text: "Weâ€™re focused on building a winner here. Thatâ€™s all Iâ€™ll say about that.", tone: "deflect", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "I canâ€™t control the rumors. My job is to coach this team, and thatâ€™s what Iâ€™m focused on.", tone: "direct", moraleEffect: 0, ownerEffect: 0, mediaEffect: 1 },       { text: "The teamâ€™s future is in good hands. Weâ€™re committed to this city and our fans.", tone: "honest", moraleEffect: 1, ownerEffect: 1, mediaEffect: 2 }     ],     starPlayerDemand: [       { text: "Weâ€™re working through it. These things happen, and weâ€™ll handle it professionally.", tone: "diplomatic", moraleEffect: 0, ownerEffect: 0, mediaEffect: 1 },       { text: "[PLAYER] is a great player, and we want him here. Weâ€™ll do whatâ€™s best for the team.", tone: "respectful", moraleEffect: 1, ownerEffect: 0, mediaEffect: 1 },       { text: "Weâ€™ll address it internally. Our focus is on the team and moving forward.", tone: "guarded", moraleEffect: -1, ownerEffect: 0, mediaEffect: 0 }     ],     coordinatorRumor: [       { text: "Weâ€™re always evaluating our staff. Thatâ€™s part of the process.", tone: "process", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "Iâ€™m not going to comment on rumors. Weâ€™re focused on getting better as a team.", tone: "deflect", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "Weâ€™ll make the decisions that are best for the team. Thatâ€™s all Iâ€™ll say on the matter.", tone: "direct", moraleEffect: 0, ownerEffect: 0, mediaEffect: 1 }     ],     dynastyLegacy: [       { text: "Iâ€™m proud of what weâ€™ve accomplished here. Weâ€™re building something special.", tone: "pride", moraleEffect: 1, ownerEffect: 1, mediaEffect: 2 },       { text: "Itâ€™s not about me. Itâ€™s about the team and what weâ€™re building together.", tone: "humble", moraleEffect: 1, ownerEffect: 0, mediaEffect: 1 },       { text: "Weâ€™ve had some great moments, and weâ€™re not done yet. The best is still ahead.", tone: "optimistic", moraleEffect: 1, ownerEffect: 1, mediaEffect: 2 }     ],     rebuilding: [       { text: "Weâ€™re building for the future. It takes time, but weâ€™re on the right track.", tone: "optimistic", moraleEffect: 1, ownerEffect: 0, mediaEffect: 1 },       { text: "Rebuilding is part of the process. Weâ€™re focused on getting better every day.", tone: "process", moraleEffect: 0, ownerEffect: 0, mediaEffect: 0 },       { text: "Weâ€™re not where we want to be, but weâ€™re working to get there. The fans deserve a winner, and weâ€™re committed to that.", tone: "honest", moraleEffect: 0, ownerEffect: -1, mediaEffect: 2 }     ]   },   mediaReaction: [     "That answer from [COACH] told us everything. 'We're building for the long term' is league code for 'we know we're bad right now.'",     "[COACH] handled the [TEAM] questions with grace today. I'll give credit where it's due â€” that was a masterclass in message control.",     "The media tried to bait [COACH], but he stayed composed. That's the mark of a veteran leader.",     "[COACH]'s answers were vague, but that's par for the course. He's not going to give the media any bulletin board material.",     "You could tell [COACH] was frustrated, but he kept his cool. That's the sign of a coach who's been around the block.",     "[COACH]'s press conference was a masterclass in saying a lot without saying anything at all.",     "The media pushed [COACH] hard today, but he didn't take the bait. That's how you handle a tough presser.",     "[COACH]'s answers were measured and thoughtful. He's clearly focused on the big picture.",     "The press tried to rattle [COACH], but he stayed on message. That's the mark of a true professional.",     "[COACH]'s press conference was a reminder that he's been in this business a long time. He knows how to handle the media.",     "The media wanted a soundbite, but [COACH] gave them substance instead. That's a win for him.",     "[COACH]'s answers were honest and direct. It's refreshing to see a coach who doesn't sugarcoat things.",     "The press conference was tense, but [COACH] handled it with class. That's the sign of a true leader.",     "[COACH]'s answers were short and to the point. He's not one to waste words, and the media respects that.",     "The media tried to push [COACH]'s buttons, but he stayed calm and collected. That's how you handle a tough presser.",     "[COACH]'s press conference was a reminder that he's in control. He didn't let the media dictate the narrative.",     "The press wanted controversy, but [COACH] gave them professionalism instead. That's a win for the team.",     "[COACH]'s answers were thoughtful and well-measured. He's clearly focused on the task at hand.",     "The media tried to get under [COACH]'s skin, but he stayed composed. That's the mark of a veteran leader.",     "[COACH]'s press conference was a masterclass in handling tough questions with grace and professionalism."   ] };

// v99.4 â€” ChatGPT: Locker Room Chemistry System
var LOCKER_ROOM_994 = {
  newArrival: {
    veteranWelcome: [
      "You hear good things about [PLAYER]. Now let's see what he does when it matters.",
      "We don't do reputations in here. [PLAYER] earns it like everybody else.",
      "Happy to have [PLAYER] in the building. The standard doesn't change.",
      "Talent gets you in the door. Work keeps you here. That's what [PLAYER] needs to know.",
      "[PLAYER] can help us, sure. But fit is more than highlights.",
      "This locker room has a way of revealing who you are. We'll see who [PLAYER] is.",
      "I respect what [PLAYER] has done. Now it's about what he does with us.",
      "The name on the back is nice. The name on the front is what matters for [PLAYER] now.",
      "We'll welcome [PLAYER]. Then we'll compete. That's the deal.",
      "There are no shortcuts here. If [PLAYER] buys in, we'll ride with him.",
      "I don't need speeches from [PLAYER]. I need consistent reps.",
      "The veterans will show [PLAYER] how we do it. He can follow or fall behind.",
      "I'm glad [PLAYER] wants to be here. Now let's see him handle the grind.",
      "[PLAYER] has a role available. It's not guaranteed. It's earned.",
      "We protect the culture. If [PLAYER] respects it, he'll be fine."
    ],
    skepticTake: [
      "[PLAYER] has talent. Whether that talent translates here is a different question.",
      "I've seen big names show up and disappear. [PLAYER] has to prove it.",
      "The scheme asks a lot. If [PLAYER] fits it, great. If not, it gets loud fast.",
      "New guy means new competition. [PLAYER] better be ready for that reality.",
      "I don't care what he did somewhere else. [PLAYER] has to do it here.",
      "There's a difference between being good and being good for us. We'll see where [PLAYER] lands.",
      "Camp tells the truth. [PLAYER] will learn that quick.",
      "We talk about chemistry a lot. [PLAYER] has to add to it, not subtract from it.",
      "If [PLAYER] is here to work, he'll be fine. If he's here for headlines, he'll struggle.",
      "The tape will decide. Not the contract. Not the hype. [PLAYER] knows that.",
      "Some guys want the role, not the responsibility. We'll find out what [PLAYER] wants.",
      "I've got questions. [PLAYER] can answer them between the lines."
    ],
    hyped: [
      "I grew up watching [PLAYER]. And now he's in our building. I can't explain how that feels.",
      "This is wild â€” [PLAYER] is actually here. That's a different kind of motivation.",
      "When [PLAYER] walked in, the whole room got quieter. That's real.",
      "You add [PLAYER] and suddenly everything feels possible.",
      "I've been studying [PLAYER]'s game for years. Getting to work with him is crazy.",
      "Practice is going to be different now. [PLAYER] makes everybody raise their level.",
      "I just want one rep against [PLAYER] in drills. One rep. That's all.",
      "Fans don't get it â€” having [PLAYER] here changes the energy instantly.",
      "You can feel the confidence rise when a guy like [PLAYER] joins you.",
      "I'm not gonna lie, I was starstruck. Then I remembered it's still work. But yeah, it's [PLAYER].",
      "This is the kind of move that makes you want to be early to everything. [PLAYER] sets that tone.",
      "If [PLAYER] is locked in, we're about to be a problem."
    ],
    playerQuote: [
      "I'm here because I want to win. [TEAM] wants to win. That's the whole conversation.",
      "I didn't come here for comfort. I came here for standards. That's what [TEAM] has.",
      "I'm not asking for anything. I'm earning everything. That's how I was raised.",
      "The past is the past. I'm focused on what I can do for [TEAM] starting today.",
      "They brought me here for a reason. I'm going to honor that with work for [TEAM].",
      "I'm excited, but I'm not satisfied. There's a lot I still want to prove at [TEAM].",
      "I respect the guys in this room. I'm here to add, not disrupt. [TEAM] is bigger than me.",
      "My message is simple: I'm available, I'm accountable, and I'm ready to compete for [TEAM].",
      "People can talk. I'm going to let the film do the talking for [TEAM].",
      "I came here to be coached hard. I want that. [TEAM] is where you get that.",
      "I'm not chasing headlines. I'm chasing results. That's what [TEAM] is about.",
      "You earn trust with consistency. I'm here to earn trust in [TEAM]'s locker room."
    ]
  },
  tradeAway: {
    lockerRoomReact: [
      "You never want to see [PLAYER] go. That guy was everything this locker room stands for.",
      "[PLAYER] set a standard in here. It's on us to keep it alive.",
      "That's the business side, but it still hits. [PLAYER] was family in this room.",
      "You don't replace a teammate like [PLAYER] with a transaction.",
      "[PLAYER] made people better, and he did it without asking for applause.",
      "It hurts because [PLAYER] earned respect the hard way â€” every day.",
      "We lost a good one. [PLAYER] brought work, not excuses.",
      "When [PLAYER] walked in, practice got more serious. That's real.",
      "I want the best for [PLAYER]. He deserves that.",
      "The locker room feels quieter when a guy like [PLAYER] leaves.",
      "We know what [PLAYER] meant to us. We'll carry that forward.",
      "It's a reminder: nothing's promised. Appreciate your teammates like [PLAYER] while you have them."
    ],
    playerBittersweet: [
      "I gave everything I had to [TEAM]. I'll always be grateful for that. Now it's a new chapter.",
      "I learned a lot in [TEAM]'s building. I'll take those lessons with me forever.",
      "This league is business, but the relationships are real. [TEAM] will always mean something to me.",
      "I'm proud of what we built at [TEAM]. I wish I could've finished it, but I respect the process.",
      "I never took a day for granted with [TEAM]. I hope the fans know that.",
      "I met great people in [TEAM]. Coaches, teammates, staff â€” I'll remember them.",
      "No hard feelings. I did my job for [TEAM] the right way, and I can live with that.",
      "I'm excited for what's next, but I'm thankful for every rep I got with [TEAM].",
      "This isn't goodbye forever. It's just the next step. Much love to [TEAM].",
      "My focus now is proving myself again. That's what [TEAM] taught me â€” earn it, every day."
    ],
    cityReaction: [
      "[PLAYER] built something real with [TEAM]. The trade is business. The memories aren't.",
      "For [TEAM], this move signals a new direction â€” but it's hard to ignore what [PLAYER] meant to the identity.",
      "The departure of [PLAYER] feels like a chapter closing in [TEAM]'s recent era.",
      "Fans will debate the value, but the impact of [PLAYER] on [TEAM]'s culture is undeniable.",
      "[TEAM] is betting on the future. The cost is saying goodbye to [PLAYER].",
      "There are trades that make sense on paper and still sting. [PLAYER] leaving [TEAM] is one of them.",
      "[PLAYER] was a steady presence for [TEAM], and that kind of stability doesn't show up in a headline.",
      "This is the league in one sentence: [TEAM] moves on, [PLAYER] moves forward, and everyone feels both truths at once.",
      "However you grade it, [PLAYER]'s time with [TEAM] will be remembered for professionalism and production.",
      "[TEAM] will have to replace more than snaps. They'll have to replace what [PLAYER] represented."
    ]
  },
  chemistry: {
    highChemBonus: [
      "Watch how they communicate before the snap. That's a team that trusts each other.",
      "They celebrate the dirty work. That's how you know the chemistry is real.",
      "There's no panic in their body language. Everybody knows the plan.",
      "When one guy makes a play, the whole sideline reacts like they did it together.",
      "You can see the timing â€” routes, blocks, angles â€” it looks rehearsed because it is.",
      "They correct each other without ego. That's rare at this level.",
      "They play fast because they don't have to think about each other. They just know.",
      "Little things are clean tonight: substitutions, alignments, communication. That's chemistry.",
      "They trust the call, they trust the teammate next to them, and it shows on every rep.",
      "That was a mistake â€” and nobody pointed fingers. They moved on. That's a connected team.",
      "Everybody is sprinting to the pile. Effort travels when morale is high.",
      "This looks like a locker room that actually likes each other. It matters."
    ],
    lowChemTension: [
      "There's a distance on that sideline that doesn't show up in the box score.",
      "You can feel it â€” the mistakes linger a little longer with this group.",
      "Nobody's talking after the play. That's usually not a good sign.",
      "The body language is heavy. Even the wins feel tense.",
      "They look like eleven individuals wearing the same uniform right now.",
      "When adversity hits, the response is slow. That's chemistry breaking down in real time.",
      "The offense comes off the field and nobody makes eye contact. That's telling.",
      "They're not celebrating the small wins. That's where morale hides.",
      "Assignments look uncertain. When communication slips, confidence follows.",
      "The warmups had a weird energy, and the game is matching it.",
      "You can see frustration in the details â€” late substitutions, hands on hips, silence.",
      "It doesn't look like they trust the guy next to them, and that's a problem."
    ],
    leaderEmerges: [
      "[PLAYER] didn't call a team meeting. He just went out and played the game of his life.",
      "When things got tense, [PLAYER] got calmer. That's leadership.",
      "[PLAYER] isn't talking much â€” he's answering with effort. The room notices that.",
      "You can track the momentum shift to one thing: [PLAYER] refusing to fold.",
      "[PLAYER] made the play, then pointed to a teammate. That's how leaders grow roots.",
      "The team was drifting until [PLAYER] set a tone with one violent, clean rep.",
      "[PLAYER] stepped into the moment like it belonged to him. That's earned confidence.",
      "When the sideline got quiet, [PLAYER] got loud â€” not with words, with actions.",
      "[PLAYER] kept competing when the game got ugly. That's when leaders show up.",
      "This isn't a speech. It's [PLAYER] dragging standards back into the building."
    ]
  },
  coachClash: {
    hotheadTension: [
      "You can see [COACH] on the sideline. Whatever he's saying, it's not quiet.",
      "[COACH] is coaching with gasoline right now â€” everything is urgent.",
      "When [COACH] talks, the whole bench hears it. That creates edge and tension.",
      "There's an intensity around [COACH] that can spark a team or scorch it.",
      "[COACH] is living on the line between motivation and friction, and tonight it's close.",
      "Players are responding, but you can also see them measuring their words around [COACH].",
      "That headset is getting a workout. [COACH] is demanding perfection on every snap.",
      "The sideline is tight â€” not scared, just on alert â€” because [COACH] is on a short fuse.",
      "Some coaches coach the play. [COACH] is coaching the emotion of the whole building.",
      "It works when they win. When they lose, [COACH]'s style gets questioned fast."
    ],
    visionaryBuyIn: [
      "The veterans came into [COACH]'s system skeptical. Watch them now. They're believers.",
      "[COACH] sold a plan, but the locker room bought it because the details keep working.",
      "You can see alignment â€” the whole team is speaking the same language from [COACH].",
      "The early resistance is gone. [COACH] has the room, and the room knows it.",
      "[COACH] isn't winning with volume. He's winning with clarity, and [TEAM] is responding.",
      "The best sign is how the veterans correct the younger guys â€” that's buy-in to [COACH].",
      "You can feel the identity forming. [TEAM] knows who they are under [COACH] now.",
      "They look prepared. That's trust in [COACH]'s process turning into performance.",
      "[COACH] asked them to believe before the results. Now the results are confirming it for [TEAM].",
      "When the plan is real, veterans stop rolling their eyes. That's what you're seeing with [COACH]."
    ],
    mutualDisdain: [
      "There's a reason the star's press conference answers have been getting shorter.",
      "You can feel the cold professionalism â€” nobody is saying it, but everybody sees it.",
      "The sideline conversations look like transactions, not trust.",
      "When the head coach talks, the star nods. Then nothing changes.",
      "It's not loud conflict. It's quiet distance, and that's harder to fix.",
      "Everyone in the building senses the tension, and the building starts holding its breath.",
      "They coexist, but they don't connect. That bleeds into the team.",
      "The game plan looks like compromise, not conviction."
    ]
  }
};

// v99.4 â€” Mistral: Coach x Player Personality Voice System
var COACH_PLAYER_VOICE_994 = {
  synergy: {
    grinder_workEthic: [
      "[COACH] and [PLAYER] don't need words â€” they just put in the work. The results speak for themselves.",
      "When [COACH] says 'no shortcuts,' [PLAYER] is the first one nodding. Their bond is built on sweat.",
      "[PLAYER]'s work ethic is the embodiment of [COACH]'s philosophy: relentless, no excuses.",
      "The film room is their sanctuary. [COACH] and [PLAYER] are always the last ones to leave.",
      "[COACH] demands effort, and [PLAYER] delivers it â€” every single day.",
      "There's no 'off' switch for these two. [COACH] and [PLAYER] are always grinding.",
      "[PLAYER] is the kind of player [COACH] builds a program around â€” no-nonsense, all effort.",
      "The connection between [COACH] and [PLAYER] is simple: they both love the grind.",
      "[COACH] doesn't need to motivate [PLAYER]. He's already the first one in and the last one out.",
      "Their relationship is built on one thing: outworking everyone else."
    ],
    hothead_pressure: [
      "When the game is on the line, [COACH] and [PLAYER] are a volcano ready to erupt.",
      "The fire in [COACH]'s eyes matches the intensity in [PLAYER]'s heart â€” explosive.",
      "[PLAYER] thrives under pressure, and [COACH] fuels that fire.",
      "Their connection is electric. [COACH] demands it, and [PLAYER] delivers it.",
      "The scoreboard lights up when [COACH] and [PLAYER] are in sync â€” pure energy.",
      "[COACH]'s passion meets [PLAYER]'s clutch gene â€” it's a show every time.",
      "They don't just rise to the moment â€” they own it. [COACH] and [PLAYER] are built for pressure.",
      "The bigger the game, the brighter they burn. [COACH] and [PLAYER] are a force of nature.",
      "Their relationship is a spark â€” ignite it, and the whole stadium feels the heat.",
      "[PLAYER] is the match, and [COACH] is the accelerant. Together, they're unstoppable."
    ],
    professor_discipline: [
      "[COACH] and [PLAYER] speak the same language: precision, preparation, and execution.",
      "The game plan is a masterpiece, and [PLAYER] is the artist who brings it to life.",
      "[COACH]'s schemes are complex, but [PLAYER] thrives in the details.",
      "Their connection is cerebral. [COACH] designs it, [PLAYER] executes it flawlessly.",
      "The film doesn't lie, and [PLAYER] is the proof of [COACH]'s genius.",
      "[COACH]'s playbook is a puzzle, and [PLAYER] is the piece that makes it all fit.",
      "Their relationship is a chess match, and they're always three moves ahead.",
      "[PLAYER] is the perfect student for [COACH]'s classroom â€” they both love the process.",
      "The precision of [COACH]'s system meets the discipline of [PLAYER] â€” a match made in football heaven.",
      "Their bond is built on intellect and execution. [COACH] and [PLAYER] are always in sync."
    ],
    zen_ambition: [
      "[COACH]'s calm is the perfect balance for [PLAYER]'s hunger. Together, they're unstoppable.",
      "The zen of [COACH] meets the ambition of [PLAYER] â€” a rare and powerful combination.",
      "Their connection is quiet but deadly. [COACH] keeps [PLAYER] focused on the prize.",
      "[PLAYER]'s drive is relentless, but [COACH]'s steadiness keeps it all in check.",
      "They don't chase the moment â€” they let it come to them. [COACH] and [PLAYER] are in perfect harmony.",
      "The ambition is there, but [COACH] ensures it's always under control.",
      "Their relationship is a masterclass in balance: hunger meets patience.",
      "[PLAYER] wants it all, and [COACH] knows exactly how to guide him there.",
      "The zen master and the hungry star â€” together, they're a championship formula.",
      "Their bond is built on trust. [COACH]'s calm fuels [PLAYER]'s ambition."
    ],
    visionary_loyalty: [
      "[COACH] and [PLAYER] are building something bigger than themselves â€” a legacy.",
      "Their connection is about the long game. [PLAYER] is the cornerstone of [COACH]'s vision.",
      "[COACH] sees the future, and [PLAYER] is the heart of it.",
      "They're not just a coach and a player â€” they're architects of a dynasty.",
      "The loyalty of [PLAYER] is the foundation of [COACH]'s grand plan.",
      "Their relationship is a promise: [PLAYER] is all-in, and [COACH] is building around him.",
      "[COACH]'s vision meets [PLAYER]'s commitment â€” a recipe for greatness.",
      "They're writing a story together, and it's only just beginning.",
      "The bond between [COACH] and [PLAYER] is unbreakable â€” they're in this for the long haul.",
      "Their connection is about more than wins â€” it's about building something that lasts."
    ],
    firestarter_greed: [
      "[COACH] and [PLAYER] are a high-risk, high-reward duo â€” always entertaining, always explosive.",
      "Their relationship is a gamble, but when it works, it's pure magic.",
      "[PLAYER] wants the money, and [COACH] wants the fire â€” together, they're a spectacle.",
      "The greed is real, but so is the talent. [COACH] and [PLAYER] are a show you can't look away from.",
      "They're a volatile mix, but when they click, the league takes notice.",
      "[COACH] fuels the fire, and [PLAYER] wants the payday â€” it's a dangerous dance.",
      "Their connection is combustible, but it's never boring.",
      "The risk is high, but so is the reward. [COACH] and [PLAYER] are all-in on the chaos.",
      "They're a rollercoaster, but when they're on, they're unstoppable.",
      "The greed and the fire make for a wild ride â€” but it's one the fans love."
    ]
  },
  clash: {
    hothead_zenPlayer: [
      "[COACH] wants fire, but [PLAYER] is all about control â€” it's a clash of energies.",
      "The tension is palpable. [COACH]'s intensity meets [PLAYER]'s calm â€” it's a volatile mix.",
      "Their dynamic is a storm waiting to happen. [COACH]'s passion vs. [PLAYER]'s composure.",
      "The friction isn't personal â€” it's about energy. [COACH] wants heat, [PLAYER] wants balance.",
      "[COACH]'s fire is met with [PLAYER]'s ice â€” it's a battle of wills.",
      "The clash is about tempo. [COACH] wants urgency, [PLAYER] wants patience.",
      "Their relationship is a test of adaptability. [COACH]'s intensity vs. [PLAYER]'s serenity.",
      "The tension is in the air. [COACH]'s emotions run hot, but [PLAYER] stays cool.",
      "The dynamic is a puzzle. [COACH]'s fire vs. [PLAYER]'s calm â€” can they find a middle ground?",
      "The friction is about energy. [COACH] wants explosion, [PLAYER] wants control."
    ],
    professor_instinct: [
      "[COACH]'s playbook is a masterpiece, but [PLAYER] plays by feel â€” it's a clash of styles.",
      "The data says one thing, but [PLAYER]'s gut says another. [COACH] isn't happy about it.",
      "Their dynamic is a battle between science and art. [COACH] wants precision, [PLAYER] wants freedom.",
      "The tension is intellectual. [COACH] trusts the numbers, [PLAYER] trusts the moment.",
      "[COACH]'s schemes are brilliant, but [PLAYER] thrives on instinct â€” it's a delicate balance.",
      "The friction isn't personal â€” it's about process. [COACH] and [PLAYER] see the game through different lenses.",
      "The clash is quiet but real. [COACH] wants structure, [PLAYER] wants spontaneity.",
      "Their relationship is a test of adaptability. [COACH]'s system vs. [PLAYER]'s instincts.",
      "The tension is in the details. [COACH]'s playbook is rigid, but [PLAYER] is fluid.",
      "The dynamic is a puzzle. [COACH]'s logic vs. [PLAYER]'s gut â€” something's got to give."
    ],
    grinder_entitled: [
      "[COACH] and [PLAYER] speak different languages â€” one demands effort, the other expects privilege.",
      "The friction is subtle but real. [COACH] wants grind, [PLAYER] wants glory.",
      "Their relationship is a slow burn â€” [COACH]'s old-school ways clash with [PLAYER]'s modern demands.",
      "The distance between them is quiet but undeniable. [COACH] and [PLAYER] are on different wavelengths.",
      "[COACH] preaches sacrifice, but [PLAYER] is all about the spotlight.",
      "Their dynamic is a cold war â€” no blowups, just a steady drift apart.",
      "The tension isn't loud, but it's there. [COACH] and [PLAYER] are misaligned.",
      "The clash isn't personal â€” it's philosophical. [COACH] and [PLAYER] see the game differently."
    ]
  },
  coordinatorHire: [
    "[COACH] brings a completely different philosophy to [TEAM]'s [ROLE] room.",
    "Change is in the air. [COACH] is the new [ROLE] for [TEAM], and the energy is electric.",
    "[TEAM] has made a bold move, hiring [COACH] as their new [ROLE]. The future starts now.",
    "A new era begins. [COACH] takes over as [ROLE] for [TEAM], and the possibilities are endless.",
    "[TEAM] is shaking things up, bringing in [COACH] as their new [ROLE]. The fans are buzzing.",
    "The search is over. [COACH] is the new [ROLE] for [TEAM], and the excitement is palpable.",
    "[TEAM] has found their [ROLE]. [COACH] arrives, and the team is ready for a fresh start.",
    "A new chapter begins. [COACH] is [TEAM]'s new [ROLE], and the future looks bright.",
    "[TEAM] has made their move, hiring [COACH] as [ROLE]. The rebuild is officially underway.",
    "[TEAM] is turning the page, bringing in [COACH] as their new [ROLE]. The energy is contagious."
  ],
  coordinatorFire: [
    "[COACH] clears out the [ROLE] office. The system gets a reset.",
    "The [TEAM] [ROLE] experiment is over. Time to find a new voice.",
    "[TEAM] has parted ways with [COACH], their [ROLE]. The search for a replacement begins now.",
    "Change is inevitable. [TEAM] has relieved [COACH] of his duties as [ROLE]. The hunt for a new voice starts today.",
    "[TEAM] has made the difficult decision to move on from [COACH] as [ROLE]. The future is the focus.",
    "A new direction is needed. [TEAM] has let go of [COACH] as [ROLE], and the search for a successor is on.",
    "[TEAM] has decided to go in a different direction, parting ways with [COACH] as [ROLE]. The next chapter begins now.",
    "[TEAM] has announced the dismissal of [COACH] as [ROLE]. The team is already looking ahead.",
    "The decision has been made. [COACH] is out as [ROLE] for [TEAM], and the focus shifts to the future.",
    "[TEAM] has made a change, moving on from [COACH] as [ROLE]. The rebuild continues."
  ],
  midseasonFiring: [
    "The [TEAM] season didn't end â€” but [COACH]'s did.",
    "A shocking midseason move. [COACH] is out and everything just changed.",
    "The axe has fallen. [COACH] is out as head coach of [TEAM], and the season takes a dramatic turn.",
    "A midseason shakeup. [TEAM] has fired [COACH], and the search for a new leader begins immediately.",
    "[TEAM] has made the bold decision to part ways with [COACH] midseason. The stakes just got higher.",
    "The season isn't over, but the [COACH] era is. [TEAM] has made a change at the top.",
    "[TEAM] has pulled the trigger, firing [COACH] midseason. The hunt for a new voice starts now.",
    "[TEAM] have relieved [COACH] of his duties midseason. The future is uncertain."
  ]
};


var PRESS_CONF_986={
  questions:[
    {q:"Coach, how do you assess your team's performance this week?",type:"general"},
    {q:"Your {pos} had a rough game. Are you concerned?",type:"negative"},
    {q:"The playoff picture is getting tight. How's the locker room?",type:"pressure"},
    {q:"Fans are calling for changes. Your response?",type:"fan_pressure"},
    {q:"Your star player's contract is up soon. Any updates?",type:"contract"},
    {q:"What adjustments are you making for next week?",type:"strategy"},
    {q:"The owner seems unhappy. Is your job safe?",type:"hot_seat"},
    {q:"That was a dominant performance. What's the secret?",type:"positive"}
  ],
  responses:{
    confident:{label:"ðŸ’ª Confident",morale:2,ownerMood:1,media:1},
    humble:{label:"ðŸ™ Humble",morale:1,ownerMood:2,media:0},
    deflect:{label:"ðŸ¤· Deflect",morale:0,ownerMood:0,media:-1},
    fired_up:{label:"ðŸ”¥ Fired Up",morale:3,ownerMood:-1,media:2}
  },
  generate:function(team,week,won,scoreDiff,rng2){
    var pool=PRESS_CONF_986.questions.slice();
    if(won&&scoreDiff>14)pool=pool.filter(function(q){return q.type!=="negative"&&q.type!=="hot_seat";});
    if(!won&&scoreDiff<-14)pool=pool.filter(function(q){return q.type!=="positive";});
    var selected=[];
    for(var i=0;i<Math.min(3,pool.length);i++){
      var idx=Math.floor(rng2()*pool.length);
      selected.push(pool.splice(idx,1)[0]);
    }
    // v99.2: Coach personality opener from COACH_PERSONALITIES_991
    var coachQuote=null;
    try{
      var archetypes=["grinder","professor","hothead","zen","visionary","firestarter"];
      var teamArchetype=archetypes[Math.floor(rng2()*archetypes.length)];
      var persona=COACH_PERSONALITIES_991&&COACH_PERSONALITIES_991[teamArchetype];
      if(persona){
        var pool2=won?persona.afterWin:persona.afterLoss;
        if(pool2&&pool2.length)coachQuote={text:pool2[Math.floor(rng2()*pool2.length)],label:persona.label,icon:persona.icon};
      }
    }catch(e){}
    return {questions:selected,coachQuote:coachQuote};
  }
};

// #10: RIVALRY TROPHY GAMES â€” Named trophies between rivals

// â”€â”€ TEAM_FLAVOR_991: Meta 30-Team World Builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var TEAM_FLAVOR_991={
  "BUF":{stadium:"Glacier Field",atmosphere:"A bone-chilling cold rolls off the lake and settles into the stadium by November. When the Blizzard are winning, the noise in Glacier Field is a living, breathing thing that rattles your fillings.",fans:"Die-hard and weather-hardened â€” the kind of fans who tailgate in a blizzard and consider it a good time.",homeAdvLine:"ðŸŸï¸ Glacier Field is LOUD tonight â€” the crowd has their back!",rivalQuip:"They've got the sunshine. We've got the heart. See you in January."},
  "MIA":{stadium:"Bayfront Arena",atmosphere:"Warm nights, Latin rhythms pumping through the corridors, and an electric energy when the bandwagon is rolling. When the Surge are hot, Bayfront Arena becomes one of the most intimidating venues in the game.",fans:"Fair-weather but electric â€” they disappear in the lean years and create a party atmosphere when the wins stack up.",homeAdvLine:"ðŸŒ´ The Miami crowd is ON FIRE tonight!",rivalQuip:"We've got the beach, the nightlife, and the rings. What do you have?"},
  "NEC":{stadium:"Commonwealth Stadium",atmosphere:"Quiet corporate efficiency. The Colonial fan has seen success and expects more of it. A technically proficient crowd that reserves its loudest roar for championship-caliber plays.",fans:"Smug â€” but they've earned every ounce of it through championship after championship.",homeAdvLine:"ðŸ›ï¸ Commonwealth Stadium makes its presence felt!",rivalQuip:"Banners don't lie. Check the rafters."},
  "NYK":{stadium:"MetLife Park",atmosphere:"New York nights under the lights â€” media capital of the world, every move scrutinized. The Knights crowd is passionate in the way only New York crowds can be: demanding, knowledgeable, and unforgiving.",fans:"Brutally honest. They'll boo a bad play and give a standing ovation for a bone-crushing tackle on the next.",homeAdvLine:"ðŸ—½ MetLife Park is roaring â€” New York wants it!",rivalQuip:"You play in the same city and can't fill your own stadium. We don't have that problem."},
  "BAL":{stadium:"The Fortress, Harbor Field",atmosphere:"Industrial. Loud. Hostile. The Baltimore faithful bring an old-school, blue-collar energy that makes Harbor Field one of the most legitimately intimidating venues in the league.",fans:"Blue-collar, loyal, and technically savvy â€” they understand the game at a deep level and demand accountability.",homeAdvLine:"ðŸ° The Fortress lives up to its name tonight!",rivalQuip:"We built a dynasty on defense. You built yours on scandal."},
  "PIT":{stadium:"Steel Mill Stadium",atmosphere:"Towels twirling, black and gold filling every corner, the roar when a sack happens is something primal. Steel Mill Stadium embodies Pittsburgh's blue-collar identity.",fans:"Extreme loyalty, Terrible Towels, and an almost religious devotion to the franchise.",homeAdvLine:"ðŸ”§ Steel Mill Stadium is shaking! Those towels are TWIRLING!",rivalQuip:"Six rings. How many do you have?"},
  "CIN":{stadium:"Bengal Stripes Field",atmosphere:"An underdog city that punches above its weight. The crowd is passionate precisely because success hasn't always been guaranteed â€” every win feels earned.",fans:"Loyal despite heartbreak â€” they've seen the highs and lows and keep showing up.",homeAdvLine:"ðŸ¯ Bengal Stripes Field erupts â€” the jungle is ALIVE!",rivalQuip:"Keep sleeping on us. We'll be there when it matters."},
  "CLE":{stadium:"Lake Shore Stadium",atmosphere:"Resilient. Passionate. A fanbase that has watched their team lose and lose and come back again. When Cleveland is winning, Lake Shore Stadium is a cauldron of raw emotion.",fans:"Long-suffering, fiercely loyal â€” they've been promised better and they're holding out for it.",homeAdvLine:"ðŸŒŠ Lake Shore Stadium is ELECTRIC! The Browns are rolling!",rivalQuip:"Dog Pound never dies. Never."},
  "TEN":{stadium:"Cumberland Commons",atmosphere:"Music City meets football brutality. Nissan-era energy flows through Cumberland Commons â€” country music on the speakers, titan-level physicality on the field.",fans:"Southern pride and two-tone enthusiasm â€” they live for the big physical plays.",homeAdvLine:"ðŸŽ¸ Cumberland Commons is ROCKING in Music City!",rivalQuip:"We've got the titans of the division. You've got the consolation prize."},
  "JAX":{stadium:"The Jungle, Riverside Arena",atmosphere:"Humid. Loud. Dangerous on a good day. The Jaguars crowd is hungry for relevance and when they get a sniff of success, Riverside Arena becomes a genuine home-field nightmare.",fans:"Passionate but patient â€” they've waited for sustained success and will be ferocious when it arrives.",homeAdvLine:"ðŸ† The Jungle is WILD tonight in Jacksonville!",rivalQuip:"Everybody counts us out. That's exactly how we like it."},
  "IND":{stadium:"Horseshoe Dome",atmosphere:"Dome noise amplified to industrial levels. The Colts crowd has seen franchise quarterbacks come and go and remains devoted to the idea that the next one is waiting.",fans:"Polite until you hurt their quarterback â€” then the gloves come off.",homeAdvLine:"ðŸ‡ Horseshoe Dome is DEAFENING â€” advantage Colts!",rivalQuip:"We've been the class of this division. The stats don't lie."},
  "HOU":{stadium:"Oil Field Park",atmosphere:"Houston heat outside, controlled chaos inside. The Texans crowd brings a mix of energy from one of America's most diverse cities â€” loud, colorful, and ready.",fans:"Ambitious and passionate â€” Houston deserves a championship and they know it.",homeAdvLine:"âš™ï¸ Oil Field Park is pumping â€” Houston is LOUD!",rivalQuip:"We're Houston. We don't do small. Remember that."},
  "KC":{stadium:"Arrowhead West",atmosphere:"The loudest stadium in the football world. The Red Sea descends, the crowd rises, and visiting QBs can't hear themselves think. Arrowhead West is the gold standard of home-field advantage.",fans:"The most passionate, educated, and intimidating fanbase in the league â€” the noise is a genuine weapon.",homeAdvLine:"ðŸ”´ ARROWHEAD WEST! The Red Sea is deafening â€” impossible to communicate!",rivalQuip:"Come to Arrowhead. See what a real home-field advantage looks like."},
  "LV":{stadium:"Neon Arena",atmosphere:"Half tourists, half die-hards, all electric. Neon Arena after dark is one of the most unique experiences in football â€” you're not sure if the crowd is there for the game or the spectacle, but either way the noise is real.",fans:"A fascinating mix of Vegas regulars and road-tripping fans who make every home game feel like a neutral site.",homeAdvLine:"ðŸŽ° NEON ARENA! The house always wins â€” and tonight, that's the Raiders!",rivalQuip:"We play in Vegas now. Everything we do is must-see TV."},
  "LAC":{stadium:"SoCal Stadium",atmosphere:"Laid-back LA energy with genuine football passion underneath. The Chargers crowd is sophisticated, knowledgeable, and reaches peak volume in crunch time.",fans:"Understated but loyal â€” they've followed this team through a lot and believe their time is coming.",homeAdvLine:"âš¡ SoCal Stadium is CHARGED UP tonight!",rivalQuip:"We've got the talent. We've always had the talent."},
  "DEN":{stadium:"Mile High Field",atmosphere:"A mile above sea level, and visiting teams feel every foot of it. The thin air and passionate crowd make Mile High Field one of the most challenging environments for visiting offenses.",fans:"Outdoor-loving, elevation-proud fans who treat the altitude advantage as part of the game plan.",homeAdvLine:"ðŸ”ï¸ Mile High Field â€” the thin air is working in Denver's favor!",rivalQuip:"Come play at altitude. We'll see you at 5,280 feet."},
  "DAL":{stadium:"Star Palace",atmosphere:"The most glamorous stadium in professional football. Star Palace is enormous, loud, and filled with the most storied fanbase in the game. The star at midfield isn't decoration â€” it's a declaration.",fans:"Everywhere, all the time â€” America's team travels in massive numbers and turns any road game into a near-home-crowd experience.",homeAdvLine:"â­ STAR PALACE erupts â€” America's Team delivers!",rivalQuip:"America's Team doesn't need a rivalry. We are the standard."},
  "PHI":{stadium:"Independence Stadium",atmosphere:"Aggressive, hostile, and unapologetically passionate. Independence Stadium is the venue opposing teams most dread visiting. The crowd feeds off emotion and amplifies it.",fans:"Ferocious, demanding perfection, with a chip on their shoulder that fuels legendary home-field noise.",homeAdvLine:"ðŸ¦… Independence Stadium is DEAFENING â€” E-A-G-L-E-S!",rivalQuip:"We boo our own players. Imagine what we do to yours."},
  "WAS":{stadium:"National Park",atmosphere:"History hangs in the air at National Park. A storied franchise in the nation's capital draws a politically connected crowd that can be fiery when the team is performing.",fans:"Passionate and demanding â€” they remember the glory years and hold the present accountable.",homeAdvLine:"ðŸ›ï¸ National Park is ROCKING â€” the Generals are making a statement!",rivalQuip:"This is Washington. We play for keeps."},
  "NYG":{stadium:"Empire Field",atmosphere:"New York's other football team plays with a chip on its shoulder. Empire Field draws a passionate crowd that has celebrated championships and expects them.",fans:"Old school New York â€” they've seen the great teams and they know when the current group measures up.",homeAdvLine:"ðŸ—½ Empire Field is THUNDERING â€” the Giants are doing it in NEW YORK!",rivalQuip:"Three rings since 2008. You don't beat experience."},
  "CHI":{stadium:"Windy City Stadium",atmosphere:"Chicago in November is a football game in the truest sense. The cold off Lake Michigan, the crowd in wool coats, and the noise when the defense makes a play â€” this is what the game is supposed to feel like.",fans:"Old school, blue-collar Bears fans who demand physical football and reward it with genuine ferocity.",homeAdvLine:"ðŸ» WINDY CITY STADIUM! The Chicago cold is a 12th man tonight!",rivalQuip:"Da Bears. That's all that needs to be said."},
  "GB":{stadium:"Frozen Tundra Field",atmosphere:"Shareholders of the franchise cheering in subzero temperatures. Frozen Tundra Field in January is arguably the most iconic setting in all of professional football. Cold, loud, and deeply reverent.",fans:"Shareholders and superfans who have passed season tickets from generation to generation for 50+ years.",homeAdvLine:"ðŸ§Š FROZEN TUNDRA â€” temperature dropping, crowd rising!",rivalQuip:"We own the stadium. Literally. The fans are shareholders. Beat that."},
  "DET":{stadium:"Motor City Dome",atmosphere:"A city that has known hard times channels all of that energy into a passion for their Lions. Motor City Dome when the team is winning is a release valve for a proud, resilient city.",fans:"Loyal through thick and thin â€” Detroit fans know what it means to root for a team that has broken their heart and they show up anyway.",homeAdvLine:"ðŸ¦ MOTOR CITY DOME is ROCKING â€” Detroit is HERE!",rivalQuip:"We've been patient. Our time is coming."},
  "MIN":{stadium:"Nordic Palace",atmosphere:"Indoor NFL energy with a Midwest coldness outside that makes it feel earned. Nordic Palace generates some of the best dome noise in football.",fans:"Passionate, long-suffering Vikings fans who combine superstition with genuine football expertise.",homeAdvLine:"âš¡ NORDIC PALACE! The horns are out â€” this crowd is ELECTRIC!",rivalQuip:"We freeze in the regular season. We come alive in January."},
  "ATL":{stadium:"Peach Bowl Arena",atmosphere:"ATL on a Saturday night â€” music, style, and Georgia Dome energy. Peach Bowl Arena is one of the loudest venues in football when the Falcons are rolling.",fans:"Fashion-forward, loud when things are going well, and capable of creating a genuine home-field atmosphere.",homeAdvLine:"ðŸ‘ PEACH BOWL ARENA! ATL is TURNT UP tonight!",rivalQuip:"Atlanta stays ready. Don't mistake our style for softness."},
  "NO":{stadium:"Crescent City Dome",atmosphere:"The loudest dome in the universe on game day. The Saints crowd transforms Crescent City Dome into something between a concert and a prayer meeting. WHO DAT!",fans:"The most passionate, loudest, and most unified fanbase in football. New Orleans bleeds black and gold.",homeAdvLine:"ðŸŽº CRESCENT CITY DOME â€” WHO DAT! The noise is IMPOSSIBLE to play through!",rivalQuip:"Who dat say they gonna beat dem Saints? WHO DAT?"},
  "CAR":{stadium:"Carolina Coliseum",atmosphere:"The Queen City brought NFL football to the South and packs Carolina Coliseum with an enthusiastic, knowledgeable crowd that shows up through the rebuilds.",fans:"Loyal Southern football fans who appreciate physical play and game-changing defensive performances.",homeAdvLine:"ðŸ¾ CAROLINA COLISEUM is PURRING â€” the Panthers are on the prowl!",rivalQuip:"The South has been sleeping on us too long."},
  "TB":{stadium:"Lightning Dome",atmosphere:"Tampa Bay's dome creates an electric atmosphere that combines Southern heat with genuine football passion. When the Thunder are hitting on all cylinders, Lightning Dome is deafening.",fans:"A mix of retirees who've followed the game for decades and younger fans energized by recent success.",homeAdvLine:"âš¡ LIGHTNING DOME! Tampa Bay brings the thunder tonight!",rivalQuip:"We've built something here. Everybody's catching up."},
  "SF":{stadium:"Bay Area Stadium",atmosphere:"Tech money meets football passion in the most scenic setting in professional sports. Bay Area Stadium with a Bay backdrop on a clear day is magnificent. The crowd is educated and loud.",fans:"A sophisticated mix of old-school 49ers faithful and tech-age newcomers who appreciate excellence.",homeAdvLine:"ðŸŒ‰ BAY AREA STADIUM â€” the faithful are ROARING over the Bay!",rivalQuip:"The franchise that invented the West Coast offense doesn't need to justify its legacy."},
  "SEA":{stadium:"The Crest, Emerald Grounds",atmosphere:"The 12th Man. Emerald Grounds is so loud on key third downs that the visiting QB legitimately cannot hear the snap count. Noise is measured in decibels here â€” and it's record-breaking.",fans:"The most legendary home-field crowd in professional football. The 12th Man is a registered trademark for a reason.",homeAdvLine:"ðŸŒ² THE 12TH MAN! EMERALD GROUNDS is SHAKING â€” visiting team timeout incoming!",rivalQuip:"We retired the number 12 for the fans. The fans. That's who we are."}
};
// Helper: get stadium name for display
function getTeamFlavor991(abbr,key){
  var tf=TEAM_FLAVOR_991[abbr];if(!tf)return null;return tf[key]||null;
}
// â”€â”€ END TEAM_FLAVOR_991 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// v100 â€” ChatGPT: Dynasty & Championship Moments
var DYNASTY_MOMENTS_995={firstChampionship:{broadcast:["They have DONE IT. For the first time in franchise history â€” [TEAM] are champions.","A city that has waited so long finally exhales. [TEAM] are your champions.","The final whistle, the final confetti â€” and the first title banner in franchise history belongs to [TEAM].","Decades of trying. Years of heartbreak. One perfect season. [TEAM] are champions at last.","This is the moment they have chased forever. [TEAM] have climbed the mountain and reached the top.","History made tonight. [TEAM] have never been here before â€” and now they own it.","From expansion talk to championship talk â€” it ends the same way: [TEAM] on top of the world.","Listen to that crowd. That's not noise â€” that's release. [TEAM] are champions for the first time.","Every former player who wore that jersey is smiling tonight. [TEAM] finally got the ring.","This is the call of a lifetime: [TEAM] win their first championship. They are champions."],fans:["I CANNOT BREATHE. [TEAM] WON THE CHAMPIONSHIP. I HAVE WAITED MY ENTIRE LIFE FOR THIS.","calling in sick tomorrow. and the next day. and forever. [TEAM] ARE CHAMPIONS.","WE DID IT WE DID IT WE DID IT. FIRST ONE EVER. [TEAM] CHAMPIONS. I'M CRYING IN PUBLIC.","I AM SHAKING. THIS IS NOT A DRILL. [TEAM] JUST WON THE WHOLE THING.","i am hugging strangers. i am texting exes. i am forgiven. [TEAM] ARE CHAMPIONS.","THE DROUGHT IS OVER. THE PAIN WAS REAL. THE JOY IS REALER. [TEAM] WON IT ALL.","MY CHILDHOOD IS HEALING IN REAL TIME. [TEAM] CHAMPIONS. I DON'T KNOW WHAT TO DO WITH MY HANDS.","i said i wouldn't cry. i lied. [TEAM] won the championship and i'm a puddle.","THIS IS FOR EVERY YEAR WE GOT CLOSE AND GOT HURT. [TEAM] FINALLY FINISHED.","WE HAVE A BANNER. WE HAVE A RING. WE HAVE PEACE. [TEAM] ARE CHAMPIONS."],insider:["[TEAM] have won their first championship. Per sources: the locker room is pure chaos right now.","CONFIRMED: [TEAM] are champions. Per sources, the owner was crying in the tunnel.","Per sources: veterans are staying on the field. Nobody wants this moment to end for [TEAM].","Sources confirm: a champagne shower started before the broadcast signed off. [TEAM] knew.","Per sources: security is already preparing for an all-night celebration. [TEAM] are champions."]},backToBack:{broadcast:["Back-to-back! [TEAM] have REPEATED as champions â€” and it may never get old.","They said defending was the hardest thing in football. [TEAM] made it look effortless.","The crown stays right where it is. [TEAM] defend the title and repeat as champions.","This is what greatness looks like: pressure, expectations, and [TEAM] answering anyway.","Another year, same ending â€” [TEAM] at the top, confetti in the air, history in the books.","You don't stumble into a repeat. [TEAM] earned this one snap by snap, month by month.","Every opponent swung for them. Nobody knocked them off. [TEAM] are champions again.","This isn't a run â€” it's control. [TEAM] go back-to-back, and the league has to deal with it."],fans:["[TEAM] BACK TO BACK AND I STILL DON'T KNOW HOW TO PROCESS THIS","this team just lives in my mind rent free. back to back champions. [TEAM].","REPEAT CHAMPS. i'm acting brand new and i'm not apologizing. [TEAM].","WE DID IT AGAIN. AGAIN!! this is illegal. [TEAM] back to back.","i used to pray for times like this. now i'm just yelling. [TEAM] REPEAT.","THEY SAID IT WAS HARD. WE SAID WATCH THIS. [TEAM] BACK TO BACK.","my personality is now 'defending champion' and [TEAM] made it permanent.","two rings. two years. zero shame. [TEAM] back to back champs."],insider:["Per sources: rival coaches called it a \"problem\" in the fourth quarter. [TEAM] repeated anyway.","[TEAM] have repeated. Sources say the rebuild plan that got them here cost 3 years. It worked.","Sources confirm: multiple starters took pay cuts last offseason. The repeat is the payoff.","Per sources: the message in the locker room was simple â€” \"finish again.\" [TEAM] did."]},dynastyWatch:{broadcast:["Three championships. The word dynasty is no longer a debate â€” it is a fact.","They have done something this sport has rarely seen. This is a dynasty.","A generation of dominance, stamped in confetti. [TEAM] have built a dynasty in real time.","You can argue eras, you can argue rules â€” you can't argue rings. [TEAM] are a dynasty.","This is sustained greatness. Not one peak â€” an era. [TEAM] have changed the league.","The league has chased them, studied them, copied them. None of it mattered. [TEAM] win again.","There are teams that win. There are teams that define time. [TEAM] just defined time.","It takes excellence to arrive here. It takes obsession to stay. [TEAM] stayed â€” and won again.","When people tell the story of this era, this is the chapter title: [TEAM] dominance.","Three. And it feels like they could do it three more. [TEAM] are the standard."],fans:["my team is a dynasty and I will never let anyone forget it (for the rest of my life)","[TEAM] DYNASTY. SAY IT. SAY THE WORD. I WILL WAIT.","i used to be humble. then [TEAM] became a dynasty. now i'm unbearable. sorry not sorry.","THREE RINGS. i'm walking around like i own the league because apparently i do. [TEAM].","the best part of a dynasty is watching other fanbases develop new emotions: despair.","i am going to be toxic for decades. [TEAM] DYNASTY. DEAL WITH IT.","they told me to be realistic. i told them to look at the trophies. [TEAM] dynasty.","WE'RE NOT LUCKY. WE'RE GOOD. WE'RE A DYNASTY. [TEAM].","this isn't a phase. it's an era. [TEAM] dynasty and i am thriving.","my favorite hobby is watching [TEAM] win championships and then reading excuses."],insider:["Per sources: the league's competition committee met this week. [TEAM] came up.","The dynasty conversation is real. Sources say rival ownership groups are rethinking their timelines.","Per sources: multiple stars turned down bigger offers to stay with [TEAM]. Dynasty decisions.","Sources confirm: opponents built whole offseasons around stopping [TEAM]. It didn't work.","Per sources: the locker room word tonight was \"legacy.\" [TEAM] played like it."]},dynastyEnds:{broadcast:["All great runs must end. Tonight, [TEAM]'s dynasty met its final chapter.","It was a dynasty built on sustained brilliance. Tonight it ends â€” not with a whisper, but a reckoning.","The crown is finally taken. [TEAM]'s reign is over, and a new era begins tonight.","For years, they were the final boss. Tonight, somebody beat the game. [TEAM] fall.","History doesn't always end cleanly â€” but it ends. [TEAM]'s dynasty ends here.","The standard-bearer is finally stopped. [TEAM] gave everything. It wasn't enough tonight.","No shame in the fall â€” only proof of how high they climbed. [TEAM]'s run ends.","The confetti falls for someone else. And for the first time in years, [TEAM] walk off without it."],fans:["the dynasty is over and i don't know who i am without it. [TEAM] era: over.","WE ENDED THE DYNASTY. [TEAM] FELL. THIS IS THE GREATEST MOMENT OF MY LIFE.","i am staring at the wall. no thoughts. just [TEAM] losing and my soul leaving my body.","THEY'RE HUMAN. THEY BLEED. [TEAM] CAN BE BEAT. I'M LAUGHING AND CRYING AT ONCE.","i can't even be mad. it was an unbelievable run. but wow this hurts. [TEAM].","we just toppled the giant. [TEAM] dynasty: ended. i will tell this story forever.","i'm in mourning. please respect my privacy. [TEAM] dynasty ended and i feel empty.","I USED TO PRAY FOR THIS. [TEAM] FINALLY LOST. THIS IS MY SUPER BOWL."]},coachLegacy:{broadcast:["He's coached his last game. And what a body of work it has been.","A coaching career measured not in games but in generations. Tonight he walks away as a legend.","When you say \"standard,\" you mean [COACH]. Tonight, the sideline turns a page.","The trophies tell part of it. The culture tells the rest. [COACH] retires as an all-time great.","Players changed, eras changed â€” [COACH] stayed the constant. Now the game says goodbye.","This is the rare exit that feels complete. [COACH] built it, sustained it, and now steps away.","You can hear the respect in the building. [COACH] is leaving, but the imprint remains.","The last handshake, the last walk, the last headset. [COACH] retires with a legacy secured."],fans:["i don't want to talk about it. he was the franchise. [COACH] retiring hits different.","THANK YOU [COACH]. for everything. for all of it. you built something special.","i'm crying over a coach and i don't care who knows it. [COACH] forever.","that man raised an entire era. [COACH] retiring feels like the end of my childhood.","i don't care about the debates. [COACH] is the greatest to me. period.","the wins were amazing but the STANDARD was the gift. thank you [COACH].","i will be telling my kids about [COACH]. like folklore. like legend.","please let [COACH] get a parade, a statue, a street name, and my eternal gratitude."]},fanGeneration:["I watched my dad watch this team. Now I'm watching with my son. Same colors. Same hope. Different era.","My grandfather never saw them win. He'd have loved this.","I used to sit on the floor as a kid and listen to games through the wall. Now I'm the one teaching my kid the chants.","My mom worked nights. We only had one tradition: watching this team together when she was home.","I wore these colors before I knew what winning was. Tonight I finally understand what the older fans meant.","My dad used to say, \"Just once.\" I wish he was here to see the \"once\" become real.","I grew up on stories about heartbreak. Now I'm making a new story with my family.","My first jersey was too big and handed down. I kept it anyway. It feels right tonight.","We used to celebrate small wins because big ones never came. Tonight, the big one finally came.","I moved away, but I called home for the final whistle. Some things still connect you.","My kid asked why I'm crying. I told them it's happy and sad at the same time. It's history.","I remember being told \"maybe next year\" for years. Now I'm saying it with a smile, not a sigh.","I promised myself I'd watch this moment with someone I love. I did.","My family doesn't agree on much. But we agree on these colors, every season.","I kept showing up. That's the whole story. I kept showing up â€” and tonight it mattered."]};

// v100 â€” Meta: Stadium Upgrade Narrative
var STADIUM_UPGRADE_995={newStadiumOpen:["New concrete. New seats. New atmosphere. The franchise didn't just build a stadium â€” they built a statement.","The first home game in a new building feels like a first breath. Everything is possible again.","The players walk onto the field and just stare. You can't practice for a moment like this.","There's a different echo in a new stadium. The roar of the crowd hasn't settled into the walls yet.","This isn't just a building; it's a promise to the city. A promise of a new era.","The smell of fresh paint and possibility hangs in the air. Tonight, this house becomes a home.","A cathedral of steel and glass, waiting for its first congregation to fill it with noise.","The sun sets on the old stadium's memory and rises on the future, right here.","From the luxury boxes to the nosebleeds, every seat has a perfect view of a franchise reborn.","The pre-game flyover feels different today. It's not just a ritual; it's a christening.","Years of planning, months of construction, all leading to this one perfect moment before kickoff.","You can feel the city's pride radiating from the stands. This stadium belongs to them.","The old ghosts didn't make the trip. This place is all about the future.","The inaugural coin toss feels heavier somehow, weighted with the significance of a new beginning.","The first cheer, the first touchdown, the first win. It all starts now."],capacityExpansion:["Five thousand new seats, and every single one of them sold before the paint dried.","When the crowd is this loud, the opposing offense can't function. They added more crowd.","The stadium's roar just found a higher gear. That new upper deck is already shaking.","It's standing room only in a stadium that just got bigger. That's the sign of a franchise on the rise.","The opposing quarterback is already complaining about the noise. It just got 5,000 voices louder.","More seats. More noise. More advantage. The math is simple.","They literally raised the roof, and the fans are raising hell. What an atmosphere.","This place was already a fortress. Now the walls are even higher, and the army is even larger.","The expansion was built for moments like this: third down, game on the line, and utter chaos.","You can feel the added weight of the new crowd. The pressure on the opposition just doubled.","The franchise is growing, and the stadium is growing with it. A beautiful sight.","Welcome to the new loudest stadium in the league. Hope you brought earplugs."],practiceUpgrade:["The first day in a new training facility is quiet. Then the players get to work, and it gets loud fast.","The best free agents go where the investment is real. This facility sends a message without saying a word.","You can tell what a franchise values by how it treats its players' bodies. This is a commitment to excellence.","The new weight room is a palace of iron and ambition. Records are going to be broken in here.","A state-of-the-art hydrotherapy pool means players are fresher in the fourth quarter. It's an investment that pays off on Sundays.","The film room is now a digital command center. No tendency will go unnoticed.","The players walk in with a different swagger. This isn't just a practice facility; it's a competitive advantage.","When you practice on perfectly manicured fields, you play faster. It's that simple.","The message from the owner is clear: every resource will be provided to win a championship.","The vibe in the locker room has changed. This is the look of a first-class organization.","Recruits and free agents take notice. This is a destination now.","Winning starts on Monday. And Monday just got a serious upgrade."],fieldSurface:["Natural grass in late October, after a week of rain â€” there is nothing like it in professional sports.","They switched to synthetic. Faster. More consistent. The traditionalists complained for exactly one week.","The players' knees will thank the owner for this one. The new turf has give. It has life.","There's a smell to a real grass field that you can't fake. It's the smell of football.","The running backs are ecstatic. The new surface allows for harder, cleaner cuts.","They installed a heated field. The snow will melt, but the opponent's will to win might melt with it.","It's a chess match of surfaces. This new grass plays slow, favoring the home team's power running game.","The debate is over. This hybrid surface is the best of both worlds, and the players love it.","The first thing the players did was lie down on it. That's how you know you got the new field right.","Rain or shine, the footing on this new turf is immaculate. A true home field advantage."],jumbotron:["The new board is so large you can see the quarterback's eyes on the replay. The crowd has never been louder.","When they installed the new scoreboard, the first thing they showed was last year's championship. That's how you do a reveal.","The replay of that controversial call is 80 feet high and in crystal clear 4K. The referee is not having a good day.","The crowd's roar on a big defensive stop is amplified when they see the hit again on the massive new screen.","It's not just a scoreboard; it's a second coach, showing players what they missed on the last series.","The visiting team tries to ignore it, but the sheer size and clarity of the new jumbotron is its own form of intimidation.","The fan experience has been transformed. It feels less like watching a game and more like being in one.","A game-changing play happens, and 70,000 fans immediately look up. The new board tells the story all over again.","The visiting owner is looking at the new scoreboard with a notepad out. He's taking notes.","It has changed the sound of the stadium. The roar for the replay is now as loud as the roar for the play itself."],atmosphereGrowth:["You build a home field advantage one win at a time. After enough wins, the building itself starts to feel dangerous.","Opposing coaches put this stadium on the schedule and quietly adjust their audible packages. It's that loud now.","The crowd doesn't just cheer anymore. They anticipate. They understand their role in the game.","It started a few seasons ago. A belief. Now, it's a tangible force. The stadium has a soul.","This place used to be just a stadium. Now it's a fortress. The fans are the gatekeepers.","Teams used to come in here looking for a win. Now they come in hoping to survive.","The mystique is real. The players feel it. The opponents fear it.","You can't buy this kind of atmosphere. You have to earn it, one deafening third down at a time.","The city has fallen back in love with its team, and the stadium is the heart of that romance.","This isn't just a tough place to play anymore. It's a place where championship dreams come to die."]};

// v100 â€” ChatGPT: Champion Voice (6 archetypes Ã— win/loss + dynasty coach)
var CHAMPION_VOICE_995={grinder:{win:["We ran the football and stopped the run. That's it. That's how you win championships.","Offensive line, defensive front â€” they set the tone. Everybody else followed.","We practiced the details. We executed the details. The result is the result.","Ball security, field position, tackling. You do those things and you give yourself a chance.","Nobody won this alone. It was a full roster job, from starters to scout team.","We didn't chase style points. We played our brand for four quarters.","We handled the moment because we handled Monday through Saturday.","Enjoy it tonight. Then we start over. That's the standard."],loss:["We got outexecuted in the second half. That's on me. We'll fix it.","They were the better team today. We didn't do enough in the critical downs.","We lost the line of scrimmage when it mattered. That's where it starts.","Too many negative plays. Too many missed tackles. That's the game right there.","We had chances and we didn't cash them. That's the difference at this level.","No excuses. We didn't play clean enough to win a championship.","We will evaluate every snap and correct the errors. That's the job.","It hurts, but it doesn't change the work. We'll be back in this spot."]},professor:{win:["The preparation validated itself tonight. When you commit to the process, the moment becomes manageable.","We didn't need surprises. We needed discipline, alignment, and execution â€” and the players delivered.","Our plan was simple: reduce variance, win the situational downs, and finish drives. We did all three.","I told the team all week: the fourth quarter would reward whoever stayed the most precise.","We measured ourselves by habits, not headlines. Tonight, the habits showed up on the scoreboard.","You can feel the difference when a team understands why each call exists. We played with clarity.","We won because we stayed composed through adversity and kept stacking correct decisions.","The trophy is a byproduct. The real win is the standard these players chose to live in."],loss:["There were a handful of possessions that decided this game, and we didn't maximize them.","A loss like this teaches you more than ten comfortable wins. We'll be honest about the lessons.","We had a plan, but we didn't sustain our execution under the highest leverage.","When you lose at this stage, it's rarely one thing. It's a chain of small errors that compound.","We didn't earn enough clean looks in the areas that decide championships: third down and red zone.","Credit to them â€” they adjusted faster than we did. That's the margin in a title game.","We'll review the tape, identify the failure points, and rebuild the process with precision.","Painful outcome, valuable information. Now we have to respond like professionals."]},hothead:{win:["They questioned everything â€” the scheme, the roster, the coaching. How's it look now?","They told us we couldn't do it. They made jokes. We just held the trophy in their face.","They wanted us to fold. We didn't fold. We hit harder, we finished, and we won.","They said we were lucky. You don't get lucky for a whole season. You earn this.","They doubted our guys all year. Those same guys just turned doubt into confetti.","They can keep talking. We're the champions. That's the only quote that matters.","They tried to turn us into a story. We turned it into a statement.","They thought pressure would break us. Pressure made us better."],loss:["I'm sick about it. They didn't take this â€” we let it slip with mistakes we can control.","They made the plays at the end, and we didn't. That's the truth, and it burns.","They'll celebrate, and they earned it. But don't confuse tonight with who we are.","They capitalized on our errors. In a championship game, that's a death sentence.","They outfinished us. That's the part that hurts the most because we know the standard.","They got momentum and we didn't answer fast enough. That's on me to fix.","They can have tonight. We're going to remember every snap that cost us this.","They didn't break our spirit. They caught us with our guard down, and we won't repeat it."]},zen:{win:["We prepared. We executed. We won.","Proud of the team. Grateful for the work. Enjoy tonight.","They stayed present. The result followed.","We respected the moment. We didn't fear it.","Short week. Long season. Same focus.","We played clean. We finished.","Celebrate with the people who helped you. Then return to the work.","This is a good night. Tomorrow is a new day."],loss:["They made plays. We didn't make enough.","We'll correct what needs correcting. We'll be ready next year.","No excuses. No hiding. Just work.","It hurts. We'll learn. We'll move forward.","We didn't finish. That's the difference.","Respect to them. Responsibility for us.","Tonight is quiet. The work won't be.","We'll carry it. We'll grow from it."]},visionary:{win:["This validates the model. We took heat for the decisions â€” the decisions just won a championship.","We believed in the system when the noise was loud. The trophy is the receipt.","We built for repeatable advantages, not vibes. Tonight the repeatable advantages showed up.","People called it unconventional. We called it optimized. The result speaks for itself.","We targeted efficiency, roster flexibility, and role clarity. This is what that looks like at the end.","The data said our window was real. The players turned probability into reality.","We won because our process reduces chaos. In this league, that's a superpower.","Enjoy the win, then update the baseline. The goal is sustained excellence."],loss:["The model liked our odds, but the game reminded us variance is undefeated. We'll update what we missed.","We didn't lose because of philosophy. We lost because of execution in high-leverage snaps.","There were scenarios we didn't account for well enough. That's on preparation, and we'll correct it.","Our approach is built for long-run success. Tonight was a short-run outcome we didn't earn.","We got exposed in a couple matchup zones we knew were thin. That's an offseason fix.","The data doesn't prevent pain. It helps you respond intelligently to pain. That's what we'll do.","We need to tighten the process where it matters most: red zone, third down, late-game decisions.","We'll take the lesson, adjust the inputs, and come back with a better version of this team."]},firestarter:{win:["These players... they gave everything they had, every day, and tonight they got the reward.","I don't have perfect words. I'm just proud â€” proud of their fight, proud of their heart.","This team kept showing up for each other when it was hard. That's why we're champions.","You watch them love each other, push each other, forgive each other â€” that's what won tonight.","I've coached a long time, and moments like this still feel unreal. I'm grateful.","This isn't just a trophy. It's every early morning, every rehab day, every quiet sacrifice.","I'm happy for the families. I'm happy for the staff. I'm happy for the guys who never stopped believing.","We did it together. And I hope the city feels how much we played for them tonight."],loss:["I hurt for our players. They poured themselves into this, and I wish I could hand them a different ending.","This one sits heavy. Not because of me â€” because of what they gave and what they deserved.","They fought. They kept fighting. And it still wasn't enough. That's a hard truth to live with.","I take responsibility. I asked them to believe, and tonight I wish I had given them one more answer.","I'm proud of the effort, and I'm heartbroken by the result. Both can be true.","We'll sit in the pain, then we'll build again. Because these players earned another chance at this.","I told them I'd never stop working for them. That promise matters most after a night like this.","It feels like we let the city down, and that hurts. We'll carry it, and we'll come back for them."]},dynastyCoach:["I don't know if I could've done any of this without the players who believed before anyone else did.","The rings are nice, but I'm most proud of the standard we kept when nobody was watching.","I think about the assistants who became head coaches. That's the legacy that lasts.","You spend your life chasing wins, then you realize it's the relationships that stay with you.","The best teams I've coached were the ones that loved the hard parts of the job.","I was never the smartest person in the room. I just tried to be the most consistent.","We had great players, but we also had great workers. That's why we sustained it.","I remember the early years when it was ugly. Those years built everything that followed.","The city gave us patience, then gave us belief. I hope we gave something back.","When people ask what it took, the answer is simple: time, trust, and a lot of uncomfortable honesty.","I learned more from the losses than the parades. The losses kept us sharp.","You don't do this alone. The staff, the trainers, the equipment room â€” they were our backbone.","I'm tired in a good way. Like someone who emptied the tank for something that mattered.","If there's one message, it's this: build it the right way and protect it every day.","I'm grateful. That's the word. Grateful for the players, the people, and the years."]};

// v100 â€” ChatGPT: Power Rankings Show
var POWER_RANKINGS_SHOW_995={rank1:["Nobody is playing better football right now. That's just the facts.","They look inevitable â€” not just winning, but removing doubt by halftime.","The top spot belongs to them this week, and nobody is making a real case to take it.","They're dominating in the trenches and staying clean in the margins. That's a scary combo.","You can try to outscore them, but they can also grind you down. Pick your poison.","Every week they answer a different question, and that's what elite looks like.","The film says it, the scoreboard says it, the league feels it: they're the standard right now.","They win ugly, they win pretty, and they win late. That's a complete team.","If you're building a game plan against them, you're already conceding something.","Right now, they don't have a weakness â€” they have preferences. That's dangerous."],rank2to5:["Elite football. A legitimate contender. Just not quite all the way there yet.","They're in the conversation. One big week and that could change in a hurry.","Good enough to win a championship â€” they're just chasing the current top team right now.","They have the talent, they have the coaching, and they have the belief. The finish is the last step.","If they clean up one recurring mistake, they can beat anybody in the league.","The ceiling is real. The question is whether the consistency matches the talent every week.","They're winning, but you still see a few missed chances on tape that matter in January.","This is a team nobody wants to draw in the playoffs. They're built for that environment.","They can take over a game in a quarter. Now it's about taking over a season.","They're close. Close is scary â€” and also unforgiving at this level."],rank6to10:["A playoff team with real questions. That's not an insult â€” most teams wish they had their problems.","They belong in this range. The question is whether they can climb when it matters.","They can beat anyone on their best day, and they can beat themselves on a bad day.","The talent is clear. The week-to-week identity is still forming.","They've got a puncher's chance against the elites, but the margin is thin.","Some weeks they look top-five. Some weeks they look ordinary. That's the story right now.","They're dangerous if they start fast. If they start slow, you can steal it from them.","They're winning enough to be taken seriously, but not clean enough to be trusted fully.","The scheme is working â€” the consistency isn't always there. That's the separator.","They're a real team. Now they have to prove they can be a real problem."],rank11to20:["Right in the middle of the pack. They haven't separated themselves from anyone.","Neither rising nor falling. A team still searching for its identity.","One win from relevant, one loss from forgotten. That's the neighborhood they live in.","They have strengths, but the weaknesses keep showing up at the worst possible times.","You watch them and think: good roster, incomplete execution. That's the summary.","They can make a run if they get hot. They can also disappear if they don't.","The ceiling is higher than the record, but the floor is lower than the fans want.","They're competitive, but not consistent. That's why they're stuck in the middle.","Some parts look playoff-ready, other parts look like a weekly coin flip.","If they want to climb, they have to start winning the close games â€” not explaining them."],rank21to30:["They're building toward something. It's just not built yet.","A tough stretch. The schedule doesn't get easier, and neither do the questions.","They fight, but the errors keep piling up. That's what rebuilding looks like in real time.","You can see pieces, not a machine. The machine takes time and a lot of good decisions.","They're learning hard lessons every week. The only hope is that the lessons stick.","The effort is there. The execution isn't. Until that flips, the results won't either.","They need cleaner football and better answers in the fourth quarter. Right now they're short on both.","This is a team that can upset someone â€” and then undo it with one sloppy sequence.","They're not hopeless. They're just not there yet, and the standings are honest about it.","The goal is progress, not perfection. But they have to show more progress soon."]};

// v99.3 â€” Meta: Playoff & Championship Narrative
var PLAYOFF_NARRATIVE_993 = {
  clinchedBerth: [
    "IT'S OFFICIAL. [TEAM] is going to the playoffs. [RECORD], [SEED] seed. They earned every bit of it.",
    "The scoreboard elsewhere does the work â€” [TEAM] is IN. The locker room is going to be electric tonight.",
    "Punch the ticket! [TEAM] has clinched a playoff berth!",
    "They're in! A whole season of work comes down to this: a chance at the title. [TEAM] is playoff-bound.",
    "No more scoreboard watching. [TEAM] controls their own destiny now. They're in the dance.",
    "The regular season was just the prelude. [TEAM] has officially clinched their spot in the postseason.",
    "Breathe it in, [CITY]. Your team is going to the playoffs.",
    "[RECORD]. [SEED] seed. The road to the championship now runs through [CITY].",
    "It wasn't always pretty, but it doesn't have to be. [TEAM] are in the playoffs.",
    "From training camp to the final whistle, it's all been for this. [TEAM] has made the tournament.",
    "The journey's not over. In fact, it's just beginning. [TEAM] is in!",
    "This team fought for every yard, every win. Now they've fought their way into the postseason.",
    "The path was long and the doubters were many. [TEAM] proved them all wrong. They're in.",
    "This is the moment every fan dreams of. The chance is here. [TEAM] is in the playoffs.",
    "They left no doubt. A statement win to clinch the [SEED] seed.",
    "The celebration is on! [TEAM] has punched their ticket to the postseason.",
    "All the sweat, all the sacrifice... it was all worth it. [TEAM] is in.",
    "The regular season mountain has been climbed. Now, a new one awaits. [TEAM] are playoff-bound.",
    "They didn't just knock on the door, they kicked it down. [TEAM] is in the playoffs.",
    "This team has a pulse. And it's beating stronger than ever. [TEAM] is in."
  ],
  playoffWeekHype: [
    "Playoff football. Everything leading up to this moment was just practice.",
    "[TEAM] walked through fire to get here. Win or go home â€” and they have no intention of going home.",
    "The air is different this week. Colder. Sharper. This is what January football feels like.",
    "Twelve teams remain. For [TEAM], only one thing matters: finding a way to be the last one standing.",
    "Every snap is magnified. Every mistake is amplified. This is the crucible of the playoffs.",
    "You can feel the tension in the city. Every fan, every local news report, all focused on one thing: Sunday.",
    "Forget the regular season record. Everyone is 0-0 now. It's a brand new season.",
    "The margin for error is gone. It's about execution, poise, and will. Does [TEAM] have what it takes?",
    "Legends are born in these moments. Who on [TEAM] will step into the light?",
    "The quiet confidence of a team that knows what it's capable of. [TEAM] is ready for war.",
    "This isn't about stats anymore. It's about heart. It's about who wants it more.",
    "All the film study, all the reps, all the pain. It all comes down to sixty minutes of football.",
    "The road to glory is paved with the ghosts of teams who couldn't finish. [TEAM] looks to write a different story.",
    "One game at a time. That's the mantra. But everyone knows what the ultimate goal is.",
    "The stadium will be a fortress. The crowd will be a weapon. [TEAM] is ready to defend its house.",
    "This is where heroes are made and hearts are broken. There is no in-between.",
    "The hype is real, but the focus is sharper. [TEAM] has locked in.",
    "Championship habits are forged in the fire of the postseason. It's time to see what [TEAM] is made of.",
    "The silence before the storm. The calm focus of a team on a mission.",
    "They've dreamed of this since they were kids. Now, the dream is a few wins away from reality.",
    "The intensity in practice this week could cut glass. [TEAM] is leaving nothing to chance.",
    "No more second chances. No more looking ahead. Just one game. One win.",
    "The city is buzzing. You can't go a block without seeing the team colors. The support is real.",
    "This is where legacies are defined. Not by what you did, but by what you do now.",
    "The lights are brightest in the playoffs. Time for [TEAM] to shine."
  ],
  superBowlWeek: [
    "Two teams. One week. One game. Everything on the line. This is what it's all for.",
    "[TEAM] hasn't slept since the conference title. This city hasn't either.",
    "The media circus has arrived. The entire world is watching [TEAM] now.",
    "This is the biggest stage in sports. A long way from the muddy fields of training camp.",
    "One final week of preparation. One final game plan. One shot at immortality.",
    "The weight of history is on their shoulders. The hope of a city is on their backs.",
    "Every player on this roster has a story. This week, they have a chance to write the perfect ending.",
    "Forget the noise. Forget the hype. It's still just a football game. The biggest one of their lives.",
    "The team hotel feels like a bunker. A quiet island in a sea of global hysteria.",
    "They're representing more than just themselves. They're representing every fan who ever believed.",
    "Forty-eight hours to kickoff. The longest two days in a football player's life.",
    "The Lombardi Trophy. It's so close they can almost taste it. But 'almost' means nothing.",
    "This week isn't just about the game; it's about cementing a legacy that will live on forever.",
    "From the first day of OTAs, this was the goal. The only goal. And now it's here.",
    "All the sacrifices, the injuries, the doubtsâ€”it all evaporates this week. There is only the opportunity.",
    "The coaches have been living in the facility. Every detail, every tendency, every possibility analyzed.",
    "A lifetime of work for a four-hour window to prove you're the best in the world.",
    "The calm before the storm. The final walkthrough. The last moment of peace before battle.",
    "The world is watching. But for [TEAM], the only thing that matters is the family inside that locker room.",
    "You can feel the magnitude of the moment in the air. This is bigger than football.",
    "This is the game kids play in their backyards. The final seconds, the championship on the line. It's real now.",
    "So much has been said and written. Soon, the time for talk will be over.",
    "The final chapter of a long, grueling season is about to be written. Will it be a tragedy or a triumph?",
    "Two champions, forged in the fires of their respective conferences. Only one will survive.",
    "Immortality is just 60 minutes away."
  ],
  championshipWin: [
    "[TEAM] ARE CHAMPIONS OF THE WORLD. Every sack, every fourth-down stop, every late comeback â€” it was all building to this.",
    "The confetti is falling. [TEAM] stands at the top. Nobody can take this from them.",
    "They did it. They actually did it. A season of belief culminates in the ultimate prize.",
    "This is for every fan who wore the colors through the losing seasons. This is for you.",
    "From the bottom to the summit. [TEAM] has climbed the mountain of the NFL.",
    "The clock hits zero. Pandemonium. A city erupts in pure, unadulterated joy.",
    "Etch their names in history. [TEAM] are champions.",
    "This wasn't just a win; it was a coronation. The best team in football, bar none.",
    "They took the hard road. They faced the best. And they beat them all. Unbelievable.",
    "Every player on this roster will be remembered as a legend in their city forever.",
    "The Lombardi Trophy is coming home.",
    "A perfect ending to a magical season. It feels like a movie.",
    "They left everything on the field. Blood, sweat, and tears. And now they leave as champions.",
    "The doubters said they couldn't do it. They were wrong. So, so wrong.",
    "This is the moment. The one they'll replay for 100 years.",
    "The final whistle blows, and a lifetime of dreams comes true. [TEAM] are the champions.",
    "They played for each other. They played for their city. And they won it all.",
    "An entire season of perfect execution. A masterpiece of coaching and execution.",
    "The celebration on that field is something you can't script. Pure emotion. Pure triumph.",
    "They stared into the face of pressure and didn't blink. That's the heart of a champion.",
    "Tonight, the city of [CITY] is the capital of the football world.",
    "Every single player contributed. This was the ultimate team victory.",
    "They will be talking about this [TEAM] team for generations.",
    "It's over. The quest is complete. [TEAM] has reached the promised land.",
    "Simply the best."
  ],
  superBowlLoss: [
    "They were so close. [TEAM] played 17 weeks of brilliant football and it ends here, one game short.",
    "No shame in this loss. But no comfort either. Not tonight.",
    "The other side celebrates. For [TEAM], only the long walk back to a silent locker room.",
    "Heartbreak on the biggest stage. This one will sting for a long, long time.",
    "One or two plays. That's the difference between a parade and a quiet flight home.",
    "To get this far and fall at the final hurdle is a unique kind of pain.",
    "They gave it everything they had. Tonight, it just wasn't enough.",
    "A brilliant season ends in the most painful way imaginable.",
    "The confetti falls, but not for them. A devastating sight.",
    "They will be back. But that's a promise for tomorrow. Tonight is about the pain of today.",
    "Heads held high. They fought like warriors, but this battle wasn't theirs to win.",
    "The finality of the Super Bowl is cruel. There's no next week. There's only the end.",
    "Every player will be replaying the final moments in their head all offseason.",
    "A season of incredible highs ends with the lowest of lows.",
    "It's a long way back to this game. A tough pill to swallow for [TEAM]."
  ],
  earlyPlayoffExit: [
    "Season over. [TEAM] exits in the [ROUND]. The locker room is quiet and the questions are loud.",
    "Just like that, it's gone. A promising season vanishes in the cold air of January.",
    "They fought all year to get here. To go out like this is a brutal blow.",
    "The silence is deafening. The playoffs are a cruel, unforgiving place.",
    "So many expectations. So much hope. And it ends in the [ROUND].",
    "This was not how the story was supposed to end.",
    "Back to the drawing board. The offseason starts now, far sooner than anyone in the [TEAM] organization wanted.",
    "A season's worth of work, undone in three hours. Football can be a cruel sport.",
    "The window of opportunity is small in this league. A missed chance that will haunt them.",
    "What went wrong? That's the question that will be asked all winter.",
    "The finality of a playoff loss is like no other. There are no more chances.",
    "They were outplayed. Outcoached. And now, they're out of the tournament.",
    "A bitter end to a season that held so much promise.",
    "The road to the championship is littered with teams like this. Good, but not good enough on the day.",
    "A quiet plane ride home awaits. The celebration will be somewhere else.",
    "Sometimes, the other team is just better. A tough lesson to learn in the playoffs.",
    "The offseason will be long, filled with 'what ifs' and regrets.",
    "From the highs of clinching to the crushing low of elimination.",
    "A great regular season, but the playoffs are a different beast.",
    "The dream is over for [TEAM]."
  ],
  hofInduction: [
    "[PLAYER] spent [SEASONS] seasons making this city believe. Today, they enshrine that belief in Canton.",
    "Nobody played the game the way [PLAYER] played it. That's why they're standing at that podium.",
    "A legend of the game gets their golden jacket. A career of excellence, immortalized.",
    "The Hall of Fame calls. [PLAYER] answers. A perfect cap to a perfect career.",
    "For [SEASONS] years, he was the heart and soul of [TEAM]. Now, he's a Hall of Famer.",
    "The bust is sculpted. The legacy is sealed. [PLAYER] is forever enshrined among the greats.",
    "From a rookie full of promise to a legend in Canton. What a journey.",
    "Every kid who ever wore a [PLAYER] jersey is smiling today.",
    "You can't write the history of the NFL without mentioning the name [PLAYER].",
    "The highest individual honor a player can receive. No one is more deserving.",
    "His impact went beyond the stats. He changed the game. He inspired a generation.",
    "The roar of the crowd one last time, for one of the all-time best.",
    "It was never a question of 'if,' only 'when.' Today is the day.",
    "A career defined by greatness. A legacy defined by this moment.",
    "Welcome to football immortality, [PLAYER]."
  ],
  dynastyReflection: [
    "[RINGS] championships. [YEARS] years. An era that nobody who watched it will ever forget.",
    "They didn't just win games â€” [TEAM] rewrote what a dynasty looks like in this league.",
    "It takes a special group to climb the mountain once. To do it [RINGS] times is the stuff of legend.",
    "We may never see a run like this again. A dominant force that defined an entire era of football.",
    "The names and faces changed, but the standard of excellence remained the same. That's a dynasty.",
    "For [YEARS] years, the road to the championship ran through one city.",
    "More than a team. This was an empire.",
    "The rest of the league watched and wondered: how do you stop them? For [YEARS] years, nobody had an answer.",
    "A collection of talent, coaching, and sheer will that comes around once in a generation.",
    "The history books will be kind to this [TEAM] squad. They were inevitable.",
    "An entire generation of fans grew up knowing nothing but excellence. What a time.",
    "They built a culture of winning that was unshakable.",
    "The architect, the quarterback, the coach... a perfect storm of greatness.",
    "When you talk about the greatest teams of all time, this [TEAM] group is in the conversation.",
    "They didn't just chase history; they made it.",
    "The level of sustained success was staggering. A masterclass in team building and execution.",
    "The rest of the league was playing checkers while [TEAM] was playing chess.",
    "A truly golden age for the franchise and its fans.",
    "Their greatness wasn't just in the wins, but in their resilience.",
    "An unforgettable era. A legendary team. A true dynasty."
  ],
  firstTitleEver: [
    "They've been waiting their whole lives for this. Every fan, every player, every city â€” this one's for all of them.",
    "A city that never gave up. A team that never stopped believing. THEY DID IT.",
    "The curse is broken. The wait is over. For the first time in franchise history, [TEAM] are champions.",
    "Decades of heartbreak, washed away in a flood of joyous tears. History has been made.",
    "This is for the fans who were there from the very beginning. This is your moment.",
    "No more 'almost.' No more 'next year.' This year is THE year.",
    "This isn't just a championship; it's a validation for an entire city.",
    "The ghosts of seasons past have been exorcised. A new era has begun.",
    "The impossible dream has become an incredible reality.",
    "The party in [CITY] tonight will be one for the ages. They've earned it.",
    "For the first time, they can say it: We are the champions.",
    "This team will be remembered forever as the one that finally brought it home.",
    "You can't describe this feeling. It's more than joy. It's history.",
    "They did it for the legends who came before and never got this far. They did it for themselves. They did it for the city.",
    "The weight of an entire franchise's history has been lifted. They are finally on top."
  ]
};

var RIVALRY_TROPHIES_986={
  names:["The Iron Boot","Silver Shield","The Governor's Cup","Thunder Bowl","The Patriot's Plate",
    "Crown of the Coast","The Steel Belt","Golden Gate Game","Metro Showdown","The Lone Star","Prairie Fire Cup",
    "The Rust Belt","Pacific Clash","The Battle Bell","River City Rivalry","The Mountain Crown"],
  generate:function(team1,team2,rng2){
    var idx=Math.floor(rng2()*RIVALRY_TROPHIES_986.names.length);
    return{name:RIVALRY_TROPHIES_986.names[idx],team1:team1.abbr,team2:team2.abbr,
      icon1:team1.icon,icon2:team2.icon,holder:null,history:[]};
  }
};

// #15: POWER RANKINGS
var POWER_RANKINGS_986={
  generate:function(teams,week){
    var ranked=teams.map(function(t){
      var winPct=t.wins+t.losses>0?t.wins/(t.wins+t.losses):0.5;
      var ovrAvg=t.roster&&t.roster.length>0?t.roster.reduce(function(s,p){return s+(p.ovr||60);},0)/t.roster.length:60;
      var streak=t.streak||0;
      var score=winPct*60+ovrAvg*0.3+streak*2+(t.pf-t.pa)*0.05;
      return{team:t,score:score,wins:t.wins,losses:t.losses,pf:t.pf||0,pa:t.pa||0,streak:streak};
    });
    ranked.sort(function(a,b){return b.score-a.score;});
    var blurbs=["Dominant on both sides of the ball.","Playing their best football right now.",
      "Quietly building momentum.","Inconsistent but talented.","Struggling to find an identity.",
      "Injuries taking a toll.","Better than their record suggests.","Worse than their record suggests.",
      "The defense carries this team.","Offense is electric when clicking.","A dark horse contender.",
      "Rebuilding but ahead of schedule.","Trending in the wrong direction.","Could be a sleeper playoff team.",
      "The coaching staff has them well-prepared."];
    return ranked.map(function(r,i){
      r.rank=i+1;
      r.blurb=blurbs[Math.min(i,blurbs.length-1)];
      r.change=0;// Will be set by comparing to previous week
      return r;
    });
  }
};

// #16: CAP PROJECTIONS
var CAP_PROJ_986={
  project:function(team,year,getSalaryCapFn){
    var projections=[];
    for(var y=0;y<3;y++){
      var projYear=year+y;
      var cap=getSalaryCapFn(projYear);
      var committed=0;var expiring=0;var expiringNames=[];
      (team.roster||[]).forEach(function(p){
        if(p.contract&&p.contract.years>y){committed+=(p.contract.salary||0);}
        else if(p.contract&&p.contract.years===y+1){expiring++;expiringNames.push(p.name+" ("+p.pos+")");}
      });
      projections.push({year:projYear,cap:cap,committed:Math.round(committed*10)/10,
        space:Math.round((cap-committed-(team.deadCap||0))*10)/10,
        expiring:expiring,expiringNames:expiringNames.slice(0,5),deadCap:y===0?(team.deadCap||0):0});
    }
    return projections;
  }
};

// #17: GENERATIONAL PLAYERS â€” Once every 8-10 drafts
var GENERATIONAL_986={
  shouldSpawn:function(year,rng2){
    // ~12% chance per draft, roughly once per 8 years
    return rng2()<0.12;
  },
  create:function(rng2){
    var positions=["QB","QB","RB","WR","WR","DL","DL","CB","LB","TE"];
    var pos=positions[Math.floor(rng2()*positions.length)];
    var names=["Marcus Frost","DeAndre Phoenix","Khalil Storm","Jaxon Blaze","Trevon Knight",
      "Zion Hammer","Darius Crown","Malik Thunder","Caden Apex","Roman Titan"];
    var name=names[Math.floor(rng2()*names.length)];
    return{name:name,pos:pos,isGenerational:true,ovr:78+Math.floor(rng2()*8),pot:95+Math.floor(rng2()*5),
      devTrait:"superstar",hype:"ðŸŒŸ GENERATIONAL TALENT â€” Once-in-a-decade prospect",
      scoutGrade:"A+",combine:{forty:pos==="QB"?4.5+rng2()*0.2:4.2+rng2()*0.3}};
  }
};

// #18: OWNER MODE LITE â€” Ticket prices, stadium upgrades, revenue
var OWNER_MODE_986={
  ticketTiers:[{label:"Budget",price:50,fanImpact:3,rev:0.7},{label:"Standard",price:75,fanImpact:0,rev:1.0},
    {label:"Premium",price:100,fanImpact:-2,rev:1.3},{label:"Luxury",price:130,fanImpact:-5,rev:1.6}],
  stadiumLevels:[{level:1,label:"Basic",cost:0,revBonus:0,prestigeBonus:0},
    {level:2,label:"Modern",cost:50,revBonus:0.1,prestigeBonus:5},
    {level:3,label:"Elite",cost:150,revBonus:0.25,prestigeBonus:12}],
  calcRevenue:function(team,wins){
    var tIdx=(team.ticketTier986||1);var tier=OWNER_MODE_986.ticketTiers[tIdx]||OWNER_MODE_986.ticketTiers[1];
    var stadLvl=team.stadiumLevel986||1;var stadBonus=OWNER_MODE_986.stadiumLevels.find(function(s){return s.level===stadLvl;})||OWNER_MODE_986.stadiumLevels[0];
    var base=wins*3+(team.fanbase||60)*0.5;
    return Math.round(base*tier.rev*(1+stadBonus.revBonus)*10)/10;
  }
};

// #14: PLAYER COMPARISON helper
var PLAYER_COMPARE_986={
  buildRadar:function(p1,p2){
    var cats=["Speed","Strength","Skill","IQ","Durability"];
    var p1Vals=[],p2Vals=[];
    [p1,p2].forEach(function(p,pi){
      var r=p.ratings||{};var vals=Object.values(r);
      var avg=vals.length>0?vals.reduce(function(s,v){return s+v;},0)/vals.length:50;
      var spd=r.speed||r.acceleration||avg;
      var str=r.strength||r.power||avg;
      var skl=r.catching||r.accuracy||r.passRush||r.coverage||avg;
      var iq=r.awareness||r.playRecognition||avg;
      var dur=r.stamina||r.toughness||avg;
      if(pi===0){p1Vals=[spd,str,skl,iq,dur];}else{p2Vals=[spd,str,skl,iq,dur];}
    });
    return{categories:cats,p1:p1Vals,p2:p2Vals};
  }
};

// #13: FRANCHISE TIMELINE â€” Key events tracker
var TIMELINE_986={
  addEvent:function(timeline,year,week,type,text,icon){
    if(!timeline)timeline=[];
    timeline.push({year:year,week:week||0,type:type,text:text,icon:icon||"ðŸ“Œ",ts:Date.now()});
    if(timeline.length>200)timeline=timeline.slice(-200);
    return timeline;
  },
  types:{trade:"ðŸ”„",draft:"ðŸ“‹",sign:"âœï¸",championship:"ðŸ†",fired:"ðŸ”¥",record:"ðŸ“Š",milestone:"ðŸŽ¯",injury:"ðŸ¤•",retire:"ðŸšª"}
};

// #12/#20: RETIREMENT & HOF CEREMONY
var CEREMONY_986={
  generateRetirementSpeech:function(player,team,careerStats){
    var cs=careerStats||{};
    var lines=["\"It's been an incredible journey with the "+team.city+" "+team.name+".\""];
    if((cs.seasons||0)>=10)lines.push("\""+((cs.seasons||0))+" seasons. I wouldn't trade a single one.\"");
    if((cs.proBowls||0)>=3)lines.push("\""+(cs.proBowls)+" Pro Bowls â€” each one a reminder of the team behind me.\"");
    if((cs.passYds||0)>20000)lines.push("\"Over "+Math.round((cs.passYds||0)/1000)+"k passing yards. Every one of them belongs to my teammates.\"");
    if((cs.rushYds||0)>5000)lines.push("\""+Math.round((cs.rushYds||0)/1000)+"k rushing yards. I left everything on that field.\"");
    if((cs.sacks||0)>50)lines.push("\""+(cs.sacks||0)+" sacks. I lived in the backfield.\"");
    lines.push("\"To the fans â€” you made this city my home. Thank you.\"");
    return{lines:lines,isHoFWorthy:(cs.proBowls||0)>=4||(cs.seasons||0)>=10};
  },
  generateHoFSpeech:function(player,stats){
    var lines=["\"Standing here in the Hall of Fame... I'm speechless.\""];
    lines.push("\"From "+((player.college?player.college.school||player.college:"a small town"))+" to the pinnacle of football.\"");
    if((stats.allPros||0)>=2)lines.push("\""+(stats.allPros)+" All-Pro selections. That's the one I'm most proud of.\"");
    lines.push("\"To every coach who pushed me, every teammate who believed â€” this is yours too.\"");
    lines.push("\"I am, and always will be, a football player. Thank you.\"");
    return lines;
  }
};

// #4: PRACTICE SQUAD SYSTEM
var PRACTICE_SQUAD_986={
  MAX_SIZE:16,
  canAdd:function(player){return player&&player.age<=26&&(player.ovr||0)<=68;},
  promote:function(team,player){
    if(!team||!player)return false;
    var idx=(team.practiceSquad986||[]).findIndex(function(p){return p.id===player.id;});
    if(idx<0)return false;
    team.practiceSquad986.splice(idx,1);
    team.roster.push(player);
    return true;
  }
};

// #11: PLAYER HOLDOUTS v2 â€” Enhanced conditioning penalty
var HOLDOUT_V2_986={
  applyPenalty:function(player,weeksHeldOut){
    if(!player||weeksHeldOut<=0)return 0;
    var penalty=Math.min(4,Math.floor(weeksHeldOut/2));
    var def=typeof POS_DEF!=="undefined"?POS_DEF[player.pos]:null;
    if(def&&penalty>0){
      def.r.forEach(function(r){if(player.ratings&&player.ratings[r])player.ratings[r]=Math.max(40,player.ratings[r]-penalty);});
      if(typeof calcOvr!=="undefined")player.ovr=calcOvr(player);
    }
    return penalty;
  },
  types:[
    {id:"give_in",label:"ðŸ’° Give In",salaryMult:1.2,morale:-3},
    {id:"hold_firm",label:"ðŸ›¡ï¸ Hold Firm",salaryMult:1.0,morale:-1},
    {id:"restructure",label:"ðŸ¤ Restructure",salaryMult:1.05,morale:1}
  ]
};

// #19: EXPANSION DRAFT EVENT â€” Year 10+
var EXPANSION_DRAFT_986={
  MIN_YEAR:10,PROTECT_LIMIT:15,
  shouldTrigger:function(yearsPlayed,rng2){return yearsPlayed>=10&&rng2()<0.15;},
  cities:["San Antonio","Portland","Salt Lake","Sacramento","Columbus","Austin","Memphis","Richmond","Oklahoma City","San Diego"],
  names:["Rattlers","Wolves","Storm","Knights","Titans","Blazers","Thunder","Stallions","Vipers","Sentinels"],
  icons:["ðŸ","ðŸº","â›ˆï¸","âš”ï¸","ðŸ›ï¸","ðŸ”¥","âš¡","ðŸŽ","ðŸ","ðŸ›¡ï¸"]
};

var COST_MEASURABLES=20;
var COST_INTERVIEW=30;
var COST_FILM=50;
SCOUT_COSTS86.full=SCOUT_COSTS86.measurables+SCOUT_COSTS86.interview+SCOUT_COSTS86.film;
// v95: Scout Points win bonus â€” awarded after each regular season week win
var SCOUT_POINT_PLAYOFF_BONUS86=50;// Per playoff win
// v95: Scout Points spending menu â€” all the ways to spend beyond draft scouting
var SCOUT_SPEND_MENU95=[
  {id:"opponent_film",label:"Opponent Film Study",icon:"ðŸ“¹",cost:40,phase:["regular","playoffs"],desc:"+5% win chance vs next opponent. Reveals tendencies."},
  {id:"injury_intel",label:"Injury Intel",icon:"ðŸ©º",cost:25,phase:["regular","playoffs"],desc:"Reveals if opponent's Questionable star will actually play."},
  {id:"fa_background",label:"FA Background Check",icon:"ðŸ”",cost:35,phase:["offseason","fa"],desc:"Reveals hidden negative traits on a free agent before signing."},
  {id:"trade_intel",label:"Trade Block Intel",icon:"ðŸ’±",cost:50,phase:["regular","offseason"],desc:"Reveals rival GM's minimum acceptable trade package for a target."},
  {id:"medical_recheck",label:"Medical Re-Check",icon:"ðŸ¥",cost:30,phase:["any"],desc:"50% chance to cut injury recovery time by 1-3 weeks."},
  {id:"locker_mole",label:"Locker Room Intel",icon:"ðŸ•µï¸",cost:60,phase:["regular"],desc:"Identifies exact source of low morale â€” which player is causing it."},
  {id:"contract_intel",label:"Contract Intel",icon:"âœï¸",cost:25,phase:["offseason","resign"],desc:"Reveals a player's true contract demands before negotiations."},
  {id:"training_boost",label:"Position Group Boost",icon:"ðŸ‹ï¸",cost:45,phase:["preseason","regular"],desc:"+15% dev speed for one position group this week."},
  {id:"udfa_search",label:"UDFA Gem Search",icon:"ðŸ’Ž",cost:120,phase:["offseason"],desc:"Find 3 hidden high-potential undrafted free agents after draft."},
  {id:"pr_spin",label:"Media Spin",icon:"ðŸ“º",cost:80,phase:["any"],desc:"Artificially boost Owner Mood +5. Useful when you're on the hot seat."},
  {id:"pipeline",label:"College Pipeline",icon:"ðŸŽ“",cost:150,phase:["offseason","regular"],desc:"Build college intel year-round with weekly scout trips. Improves draft class insight and pipeline bonuses."},
  {id:"combine_extra",label:"Combine Deep Dive",icon:"ðŸ”¬",cost:55,phase:["offseason"],desc:"Extra combine analysis â€” 50% chance to reveal hidden Glass trait on prospect."},
];
var SCOUT_MATH={
  getErrorBand:function(facilityLevel,scoutBonus){
    var baseError=12;
    var facilityReduction=(facilityLevel||0)*1.5;// 0/1.5/3/4.5 pts reduction
    var staffReduction=Math.floor(((scoutBonus||0)*40)/10);// foD79*40 pts => staff quality 0-4
    var finalError=Math.max(1,Math.floor(baseError-facilityReduction-staffReduction));
    return finalError;
  },
  getOvrDisplay:function(trueOvr,conf,errorBand){
    if(conf>=100) return ""+trueOvr;
    if(conf<40) return "??";
    var lo=Math.max(40,trueOvr-errorBand);
    var hi=Math.min(99,trueOvr+errorBand);
    return lo+"-"+hi;
  }
};
var SCOUT_NOTE_FLAVOR={
  "QB+workEthic":"Film junkie. He'll know your defense better than you do.",
  "QB+ambition":"High ceiling. Needs the right system to unlock it.",
  "QB+greed":"Elite talent. Will cost you â€” and knows it.",
  "QB+loyalty":"Team guy. Will take a hometown discount to win.",
  "QB+pressure":"Thrives in big moments. Born for fourth quarter.",
  "RB+speed":"Burst off the line that pro scouts dream about.",
  "RB+workEthic":"Workhorse back. Give him 25 carries and he won't complain.",
  "WR+ambition":"Wants the spotlight. Give it to him.",
  "WR+greed":"Will catch everything thrown his way â€” then ask for more.",
  "CB+pressure":"Clutch cover corner. Big game specialist.",
  "CB+workEthic":"Technician. Studies film until midnight every week.",
  "DL+workEthic":"Motor never stops. Offensive linemen hate him.",
  "DL+ambition":"Wants to lead the league in sacks. He's got the tools.",
  "LB+loyalty":"Captain-type. Defensive leader waiting to happen.",
  "QB+fallback":"Intriguing arm talent. The tape tells the story.",
  "fallback":"Intriguing prospect. Film suggests upside â€” needs development."
};
function getScoutNoteFlavor(pos,trait){
  return SCOUT_NOTE_FLAVOR[(pos||"?")+"+"+(trait||"")]||SCOUT_NOTE_FLAVOR[(pos||"?")+"+fallback"]||SCOUT_NOTE_FLAVOR.fallback;
}
var LEGACY={
  buildStats:function(history,myId,teams,season){
    var stats={games:0,wins:0,losses:0,rings:0,playoffs:0,draftHits:0,
      capMastery:0,devSuccesses:0,neverTanked:true,fired:false,years:0};
    var myT=teams?teams.find(function(t){return t.id===myId;}):null;
    (history||[]).forEach(function(h){
      if(!h.teamRecords)return;
      var myRec=h.teamRecords.find(function(r){return r.id===myId;});
      if(!myRec)return;
      stats.years++;
      stats.wins+=(myRec.wins||0);
      stats.losses+=(myRec.losses||0);
      stats.games+=(myRec.wins||0)+(myRec.losses||0);
      if(h.winnerId===myId||h.champId===myId)stats.rings++;
      if(h.madePlayoffs||myRec.madePlayoffs)stats.playoffs++;
      if((myRec.wins||0)<4)stats.neverTanked=false;
      if(h.legacyStats91){
        stats.draftHits+=(h.legacyStats91.draftHits||0);
        stats.capMastery+=(h.legacyStats91.capMastery||0);
        stats.devSuccesses+=(h.legacyStats91.devSuccesses||0);
      }
    });
    if(myT){
      stats.wins+=(myT.wins||0);stats.losses+=(myT.losses||0);
      stats.games+=(myT.wins||0)+(myT.losses||0);
    }
    return stats;
  },
  calcScore:function(stats){
    var score=0;
    var winPct=stats.games>0?(stats.wins/stats.games):0;
    var winPctScore=Math.min(30,winPct*30);
    var ringsScore=Math.min(25,stats.rings*5);
    var playoffsScore=Math.min(15,stats.playoffs*1.5);
    var draftHitsScore=Math.min(10,stats.draftHits*2);
    var capScore=Math.min(10,stats.capMastery*2);
    var devScore=Math.min(10,stats.devSuccesses*1);
    var neverTankedBonus=stats.neverTanked?5:0;
    var firedPenalty=stats.fired?-15:0;
    var dynastyDecadeBonus=(stats.rings>=3&&stats.years<=10)?10:0;
    score+=winPctScore;// Win % â€” 30pts
    score+=ringsScore;// Championships â€” 25pts (5 per ring)
    score+=playoffsScore;// Playoff appearances â€” 15pts
    score+=draftHitsScore;// Draft hits (90+ OVR players) â€” 10pts
    score+=capScore;// Cap efficiency seasons â€” 10pts
    score+=devScore;// Development successes â€” 10pts
    score+=neverTankedBonus;// Never tanked
    score+=firedPenalty;// Got fired
    score+=dynastyDecadeBonus;// Dynasty Decade bonus
    // v97.6: Additional legacy dimensions
    var coachStability=0;
    if(stats.years>=8)coachStability=5;
    else if(stats.years>=5)coachStability=3;
    score+=coachStability;
    var eraBonus=0;
    if(stats.rings>=3&&stats.years<=8)eraBonus=8;
    else if(stats.rings>=2&&stats.years<=5)eraBonus=5;
    score+=eraBonus;
    var finalScore=Math.min(100,Math.max(0,Math.round(score)));
    var tier=finalScore>=90?"Hall of Fame":finalScore>=75?"Legendary":finalScore>=60?"Great":finalScore>=45?"Good":"Average";
    return{score:finalScore,tier:tier,winPct:winPct,breakdown:{
      winPct:winPctScore,rings:ringsScore,playoffs:playoffsScore,draftHits:draftHitsScore,cap:capScore,dev:devScore,
      integrity:neverTankedBonus,firedPenalty:firedPenalty,dynastyDecade:dynastyDecadeBonus,coachStability:coachStability,eraBonus:eraBonus
    }};
  },
  buildSeasonStats:function(myT,teams,season,history){
    var draftHits=0;
    if(myT&&myT.roster){
      myT.roster.forEach(function(p){if((p.ovr||0)>=90&&p._draftYear&&p._fromTeamId===myT.id)draftHits++;});
    }
    var cap=getSalaryCap?getSalaryCap(season?season.year:2026):255;
    var used=myT?(myT.capUsed||0):0;
    var capSpace=cap-used;
    var capMastery=(capSpace<5&&capSpace>=0)?1:0;
    var devSuccesses=0;
    if(myT&&myT.roster){
      myT.roster.forEach(function(p){if((p._ovrAtSeasonStart||0)>0&&(p.ovr||0)-(p._ovrAtSeasonStart||0)>=5)devSuccesses++;});
    }
    return{draftHits:draftHits,capMastery:capMastery,devSuccesses:devSuccesses};
  }
};
var RELOCATION_CITIES976=[
  {city:"London",abbr:"LDN",icon:"ðŸ‡¬ðŸ‡§",marketMod:1.25,fanbaseStart:40,presBoost:15,desc:"International expansion. Huge market, building a fanbase from scratch."},
  {city:"Mexico City",abbr:"MEX",icon:"ðŸ‡²ðŸ‡½",marketMod:1.15,fanbaseStart:45,presBoost:10,desc:"Passionate fans in North America's largest city."},
  {city:"Toronto",abbr:"TOR",icon:"ðŸ",marketMod:1.10,fanbaseStart:50,presBoost:8,desc:"A hungry sports town ready for football."},
  {city:"Austin",abbr:"AUS",icon:"ðŸŽ¸",marketMod:1.05,fanbaseStart:55,presBoost:5,desc:"Tech money and college football culture collide."},
  {city:"Portland",abbr:"PDX",icon:"ðŸŒ²",marketMod:0.95,fanbaseStart:48,presBoost:3,desc:"Passionate, loyal fanbase in the Pacific Northwest."},
  {city:"St. Louis",abbr:"STL",icon:"âšœï¸",marketMod:0.90,fanbaseStart:60,presBoost:2,desc:"A city that lost its team and is HUNGRY for football."},
  {city:"Orlando",abbr:"ORL",icon:"ðŸ°",marketMod:1.00,fanbaseStart:50,presBoost:4,desc:"Tourism capital with year-round warm weather."},
  {city:"Las Cruces",abbr:"LC",icon:"ðŸœï¸",marketMod:0.80,fanbaseStart:35,presBoost:-2,desc:"Small market underdog. Low cost, loyal locals."},
  {city:"Honolulu",abbr:"HNL",icon:"ðŸŒº",marketMod:0.85,fanbaseStart:42,presBoost:5,desc:"Paradise location. Recruiting advantage, travel nightmare."},
  {city:"Berlin",abbr:"BER",icon:"ðŸ‡©ðŸ‡ª",marketMod:1.20,fanbaseStart:38,presBoost:12,desc:"European powerhouse. Football is booming in Germany."}
];
var RELOCATION976={
  canRelocate:function(team,season,history){
    if(!team||!season)return{ok:false,msg:"Missing data."};
    if(((season.year||2026)-2026)<2)return{ok:false,msg:"Must complete at least 3 seasons before relocating."};
    if((team.cash||0)<30)return{ok:false,msg:"Need at least $30M cash to fund relocation."};
    if(team._relocYear976&&((season.year||2026)-team._relocYear976)<5)return{ok:false,msg:"Must wait 5 years between relocations."};
    var ownerForce=(team.ownerMood||70)<40;
    var playerChoice=true;
    if(!ownerForce&&!playerChoice)return{ok:false,msg:"No relocation pressure."};
    return{ok:true,ownerForced:ownerForce};
  },
  relocate:function(team,destination,season,nameParts){
    if(!team||!destination||!season)return{ok:false,msg:"Missing relocation data."};
    var cost=30+Math.floor((destination.marketMod||1.0)*20);
    if((team.cash||0)<cost)return{ok:false,msg:"Need $"+cost+"M cash for this move."};
    team.cash=(team.cash||50)-cost;
    team._prevCity976=team.city||null;
    team._prevName976=team.name||null;
    team._prevAbbr976=team.abbr||null;
    team._prevIcon976=team.icon||null;
    team._relocYear976=season.year||2026;
    team.city=destination.city;
    team.name=(nameParts&&nameParts.teamName)||team.name||(destination.city+" Football Club");
    team.abbr=(nameParts&&nameParts.abbr)||destination.abbr||team.abbr;
    team.icon=destination.icon||team.icon;
    team.fanbase=Math.max(20,(destination.fanbaseStart||40)+Math.floor((team.prestige||50)*0.15));
    team.prestige=cl((team.prestige||50)+(destination.presBoost||0),10,99);
    team.ownerMood=cl((team.ownerMood||70)+15,5,99);
    (team.roster||[]).forEach(function(p){
      p.chemistry=cl((p.chemistry||60)-rng(3,8),15,100);
      p.morale=cl((p.morale||70)-rng(2,5),15,100);
    });
    if(team.facilities)team.facilities.stad=1;
    team.stadiumName976=null;
    team.stadiumDeal976=null;
    return{ok:true,cost:cost,newCity:destination.city,newName:team.name,
      msg:"Relocated to "+destination.city+"! Cost: $"+cost+"M. New stadium construction begins."};
  }
};
var STADIUM_DEALS976=[
  {name:"TechNova Field",revenue:8,years:5,prestige:3,icon:"ðŸ’»"},
  {name:"Ironclad Arena",revenue:6,years:7,prestige:2,icon:"ðŸ—ï¸"},
  {name:"Velocity Park",revenue:10,years:4,prestige:5,icon:"âš¡"},
  {name:"Pioneer Stadium",revenue:5,years:10,prestige:1,icon:"ðŸ”ï¸"},
  {name:"Nexus Dome",revenue:12,years:3,prestige:4,icon:"ðŸ”®"},
  {name:"Heritage Field",revenue:4,years:15,prestige:6,icon:"ðŸ›ï¸"},
  {name:"Apex Center",revenue:9,years:5,prestige:3,icon:"ðŸŽ¯"},
  {name:"Titan Grounds",revenue:7,years:6,prestige:2,icon:"âš™ï¸"}
];
function generateStadiumDeals976(){
  var pool=STADIUM_DEALS976.slice();
  var offers=[];
  for(var i=0;i<3&&pool.length>0;i++){
    var idx=Math.floor(RNG.ui()*pool.length);
    var deal=assign({},pool[idx]);
    deal.revenue=Math.round(deal.revenue*(0.8+RNG.ui()*0.4)*10)/10;
    offers.push(deal);
    pool.splice(idx,1);
  }
  return offers;
}
function normalizeTeamFranchise976(team){
  if(!team)return team;
  if(team._relocYear976===undefined)team._relocYear976=null;
  if(team._prevCity976===undefined)team._prevCity976=null;
  if(team._prevName976===undefined)team._prevName976=null;
  if(team._prevAbbr976===undefined)team._prevAbbr976=null;
  if(team._prevIcon976===undefined)team._prevIcon976=null;
  if(team.stadiumName976===undefined)team.stadiumName976=null;
  if(team.stadiumDeal976===undefined)team.stadiumDeal976=null;
  return team;
}
function getStadiumName976(team){
  if(!team)return"Stadium";
  if(team.stadiumName976)return team.stadiumName976;
  return (team.city||"Team")+" Stadium";
}
function buildDynastyTimeline976(history,myId,teams,hallOfFame,awards){
  return (history||[]).map(function(h,i){
    var rec=h.teamRecords?h.teamRecords.find(function(r){return r.id===myId;}):null;
    var isChamp=h.champId===myId||h.winnerId===myId;
    var madePlayoffs=!!(h.madePlayoffs||(rec&&rec.madePlayoffs));
    var seasonAwards=[];
    if(h.awards){
      if(h.awards.mvp&&h.awards.mvp.teamId===myId)seasonAwards.push("ðŸ… MVP: "+h.awards.mvp.name);
      if(h.awards.dpoy&&h.awards.dpoy.teamId===myId)seasonAwards.push("ðŸ›¡ï¸ DPOY: "+h.awards.dpoy.name);
      if(h.awards.roy&&h.awards.roy.teamId===myId)seasonAwards.push("â­ ROY: "+h.awards.roy.name);
      if(h.awards.coty&&h.awards.coty.teamId===myId)seasonAwards.push("ðŸŽ“ COTY");
    }else{
      if(h.mvp&&h.mvp.tm===((rec&&rec.abbr)||null))seasonAwards.push("ðŸ… MVP: "+h.mvp.name);
      if(h.dpoy&&h.dpoy.tm===((rec&&rec.abbr)||null))seasonAwards.push("ðŸ›¡ï¸ DPOY: "+h.dpoy.name);
      if(h.oroy&&h.oroy.tm===((rec&&rec.abbr)||null))seasonAwards.push("â­ OROY: "+h.oroy.name);
      if(h.droy&&h.droy.tm===((rec&&rec.abbr)||null))seasonAwards.push("â­ DROY: "+h.droy.name);
      if(h.coty&&h.coty.tm===((rec&&rec.abbr)||null))seasonAwards.push("ðŸŽ“ COTY: "+h.coty.name);
    }
    var hofInductions=(hallOfFame||[]).filter(function(hof){
      return (hof.yearInducted||hof.inducted)===h.year;
    }).map(function(hof){return"ðŸ›ï¸ "+hof.name;});
    var ls=h.legacyStats91||{};
    return{
      year:h.year||(2026+i),
      record:rec?((rec.wins||0)+"-"+(rec.losses||0)):"?",
      wins:rec?(rec.wins||0):0,
      losses:rec?(rec.losses||0):0,
      isChamp:isChamp,
      madePlayoffs:madePlayoffs,
      awards:seasonAwards,
      hofInductions:hofInductions,
      draftHits:ls.draftHits||0,
      capMastery:ls.capMastery||0,
      devSuccesses:ls.devSuccesses||0,
      era:null,
      rec:rec||null
    };
  });
}
function detectDynastyEras976(timeline){
  var eras=[];var currentEra=null;
  (timeline||[]).forEach(function(season,i){
    if(season.isChamp){
      if(!currentEra){
        currentEra={startYear:season.year,endYear:season.year,rings:1,startIdx:i};
      }else if((season.year-currentEra.endYear)<=3){
        currentEra.endYear=season.year;currentEra.rings++;
      }else{
        if(currentEra.rings>=2)eras.push(assign({},currentEra));
        currentEra={startYear:season.year,endYear:season.year,rings:1,startIdx:i};
      }
    }
  });
  if(currentEra&&currentEra.rings>=2)eras.push(currentEra);
  eras.forEach(function(era){
    era.name=era.rings>=3?"The Dynasty":era.rings>=2?"The Run":"Championship Window";
    era.label=era.name+" ("+era.startYear+"-"+era.endYear+", "+era.rings+"ðŸ†)";
  });
  (timeline||[]).forEach(function(season){
    eras.forEach(function(era){
      if(season.year>=era.startYear&&season.year<=era.endYear)season.era=era;
    });
  });
  return eras;
}
var LEGACY_MILESTONES976=[
  {id:"first_win",label:"First Victory",icon:"ðŸˆ",check:function(s){return s.wins>=1;}},
  {id:"first_playoff",label:"Playoff Bound",icon:"ðŸ“ˆ",check:function(s){return s.playoffs>=1;}},
  {id:"first_ring",label:"Championship!",icon:"ðŸ†",check:function(s){return s.rings>=1;}},
  {id:"dynasty",label:"Dynasty Declared",icon:"ðŸ‘‘",check:function(s){return s.rings>=3;}},
  {id:"fifty_wins",label:"50 Wins Club",icon:"ðŸŽ¯",check:function(s){return s.wins>=50;}},
  {id:"hundred_wins",label:"Century Mark",icon:"ðŸ’¯",check:function(s){return s.wins>=100;}},
  {id:"perfect_cap",label:"Cap Wizard",icon:"ðŸ’°",check:function(s){return s.capMastery>=3;}},
  {id:"talent_factory",label:"Talent Factory",icon:"ðŸ­",check:function(s){return s.draftHits>=5;}},
  {id:"developer",label:"Player Whisperer",icon:"ðŸ“ˆ",check:function(s){return s.devSuccesses>=10;}},
  {id:"never_tanked",label:"Integrity",icon:"ðŸ«¡",check:function(s){return s.neverTanked&&s.years>=5;}},
  {id:"decade",label:"Decade of Dominance",icon:"ðŸ”Ÿ",check:function(s){return s.years>=10;}},
  {id:"hall_of_fame_gm",label:"Hall of Fame GM",icon:"ðŸ›ï¸",check:function(s){return s.rings>=3&&s.wins>=100;}}
];
var POS_MARKET_DEFAULT86={tier:3,mult:1.0,holdoutRaisePct:0.15};
var POS_MARKET_TIER={
  QB:{tier:1,mult:2.5,holdoutRaisePct:0.18},
  WR:{tier:2,mult:1.2,holdoutRaisePct:0.18},
  LT:{tier:2,mult:1.2,holdoutRaisePct:0.18},
  DE:{tier:2,mult:1.2,holdoutRaisePct:0.18},
  CB:{tier:2,mult:1.2,holdoutRaisePct:0.18},
  RB:{tier:3,mult:1.0,holdoutRaisePct:0.15},
  S:{tier:3,mult:1.0,holdoutRaisePct:0.15},
  LB:{tier:3,mult:1.0,holdoutRaisePct:0.15},
  TE:{tier:3,mult:1.0,holdoutRaisePct:0.15},
  OL:{tier:3,mult:1.0,holdoutRaisePct:0.15},
  DL:{tier:3,mult:1.0,holdoutRaisePct:0.15},
  K:{tier:4,mult:0.35,holdoutRaisePct:0.10},
  P:{tier:4,mult:0.35,holdoutRaisePct:0.10}
};
function getPosMarketTier86(pos){
  var key=String(pos||"").toUpperCase();
  return POS_MARKET_TIER[key]||POS_MARKET_DEFAULT86;
}
function cl(v,a,b){return Math.max(a,Math.min(b,v));}
function rng(a,b){return Math.floor(RNG.play()*(b-a+1))+a;}
function rngI(a,b){return Math.floor(RNG.injury()*(b-a+1))+a;}
function rngD(a,b){return Math.floor(RNG.draft()*(b-a+1))+a;}
function rngAI(a,b){return Math.floor(RNG.ai()*(b-a+1))+a;}
function rngT(a,b){return Math.floor(RNG.trade()*(b-a+1))+a;}
function rngDev(a,b){return Math.floor(RNG.dev()*(b-a+1))+a;}
function pick(a){return a[Math.floor(RNG.play()*a.length)];}
function pickD(a){return a[Math.floor(RNG.draft()*a.length)];}
function U(){return RNG.ui().toString(36).slice(2,8)+RNG.ui().toString(36).slice(2,5);}// v42: Fully deterministic IDs via RNG.ui
function sum(a,fn){return a.reduce(function(s,x){return s+(fn?fn(x):x);},0);}
function avg(a,fn){return a.length?sum(a,fn)/a.length:0;}
// ROSTER_CAP, CAMP_CAP, PS_CAP, MIN_SALARY, CAP_MATH, getSalaryCap, getCapFloor, getMinSalary
// â†’ imported from ./src/config/cap-math.js
// v93.13: Draft contract â€” OVR+round â†’ realistic salary/years for inaugural snake draft
// v93.12: Auction contract â€” bid+OVR â†’ realistic salary so cap fills properly (~$180-250M for 53 players)
// CONTRACT_VALUE_TABLE_994, AGE_VALUE_CURVE_994, calcContractScore994,
// calcDeadCap994, calcFourthDownEV995 â†’ imported from ./src/systems/contracts.js
var _CONTRACT_IMPORTED_SENTINEL = true; // marker so esbuild tree-shakes nothing
var _UNUSED_CONTRACT_VALUE_TABLE_994 = {
  QB:  { elite: 0.18, starter: 0.09, backup: 0.03 },
  RB:  { elite: 0.12, starter: 0.06, backup: 0.02 },
  WR:  { elite: 0.16, starter: 0.08, backup: 0.025 },
  TE:  { elite: 0.10, starter: 0.05, backup: 0.015 },
  OL:  { elite: 0.11, starter: 0.055, backup: 0.018 },
  DL:  { elite: 0.15, starter: 0.075, backup: 0.022 },
  LB:  { elite: 0.10, starter: 0.05, backup: 0.015 },
  CB:  { elite: 0.14, starter: 0.07, backup: 0.02 },
  S:   { elite: 0.09, starter: 0.045, backup: 0.012 },
  K:   { elite: 0.05, starter: 0.025, backup: 0.008 },
  P:   { elite: 0.04, starter: 0.02, backup: 0.006 }
};

// AGE_VALUE_CURVE_994[position] -> array of multipliers, index 0 = age 21, index 17 = age 38
// 1.0 = peak value. Below 1.0 = developing or declining. Above 1.0 NOT ALLOWED.

// calcContractScore994(ovr, pos, age, years, totalValue, capTotal)
// ovr: 0-99 player rating | pos: position string | age: player age (21-38)
// years: contract length (1-6) | totalValue: total contract dollars | capTotal: league cap (default 200)
// Returns: { score: 0-100, grade: string, surplus: float, annualCapPct: float, fairValue: float }

// calcDeadCap994(totalGuaranteed, yearsRemaining, yearsCut)
// totalGuaranteed: guaranteed money on the contract
// yearsRemaining: years left on the deal (including current)
// yearsCut: which year the player is cut (1 = this season, 2 = next season, etc.)
// Returns: { deadCapHit: float, capSavings: float, netCapImpact: float }

// v100 â€” DeepSeek: 4th Down Expected Value Calculator


function migrateContract(old){
  if(!old)return makeContract(MIN_SALARY,1,0,0);
  if(old.baseSalary!==undefined)return old;// already v35
  var sal=old.salary||MIN_SALARY;var yrs=Math.max(old.years||1,1);
  var totalVal=sal*yrs;var impliedBonus=sal>2?Math.round(Math.min(sal*0.2*yrs,totalVal*0.4)*10)/10:0;
  var pro=yrs>0?Math.round(impliedBonus/yrs*10)/10:0;
  return {baseSalary:Math.max(Math.round((sal-pro)*10)/10,MIN_SALARY),years:yrs,signingBonus:impliedBonus,
    prorated:pro,guaranteed:Math.round(sal*Math.min(yrs,2)*10)/10,restructured:false,originalYears:yrs,
    salary:sal};// v35: preserve original salary as capHit for compat
}
function v36_capHit(c,yrOff){if(!c)return 0;yrOff=yrOff||0;if(c.baseSalary===undefined)return c.salary||0;if(yrOff>=(c.years||1))return 0;return Math.round((c.baseSalary+(c.prorated||0))*10)/10;}
function v36_cashPaid(c,yrOff,isSigning){if(!c)return 0;yrOff=yrOff||0;if(c.baseSalary===undefined)return c.salary||0;if(yrOff>=(c.years||1))return 0;var b=c.baseSalary;if(isSigning)b+=(c.signingBonus||0);return Math.round(b*10)/10;}
function v36_deadIfCut(c){return calcDeadMoney(c)+voidYearDeadCap(c);}// v73: includes void year dead cap acceleration
function v36_deadIfTraded(c){if(!c||!c.prorated)return 0;return Math.round((c.prorated*(c.years||1)+voidYearDeadCap(c))*10)/10;}// v73: includes void year dead cap
function v36_tradeSavings(c){return Math.round((v36_capHit(c)-v36_deadIfTraded(c))*10)/10;}
function splitDeadCapCharge(deadAmt,phase,week){
  var dead=Math.max(0,deadAmt||0);
  var postDeadline=(phase==="regular"&&(week||0)>10);
  if(!postDeadline||dead<=0)return{now:Math.round(dead*10)/10,next:0,postDeadline:false};
  var now=Math.round(dead*0.5*10)/10;
  var next=Math.round((dead-now)*10)/10;
  return{now:now,next:next,postDeadline:true};
}
function applyDeadCapCharge(team,year,split){
  if(!team||!split)return;
  if(!team.deadCapByYear)team.deadCapByYear={};
  var yNow=String(year||2026);
  if(split.now>0){
    team.deadCap=Math.round(((team.deadCap||0)+split.now)*10)/10;
    team.deadCapByYear[yNow]=Math.round(((team.deadCapByYear[yNow]||0)+split.now)*10)/10;
  }
  if(split.next>0){
    var yNext=String((year||2026)+1);
    team.deadCapByYear[yNext]=Math.round(((team.deadCapByYear[yNext]||0)+split.next)*10)/10;
  }
}
function calcTradeImpact(player){var c=player.contract;if(!c)return{deadMoney:0,newContract:null,capSavings:0};var dead=v36_deadIfTraded(c);var nc=makeContract(c.baseSalary,c.years,0,0);nc.years=c.years;return{deadMoney:dead,newContract:nc,capSavings:Math.round((v36_capHit(c)-dead)*10)/10};}
function addVoidYears(p,numVoid){
  var c=p.contract;if(!c||c.baseSalary===undefined)return {ok:false,msg:"Contract not v35-shaped."};
  if((c.voidYears||0)>=3)return {ok:false,msg:"Max 3 void years already added."};
  if(c.years<=1)return {ok:false,msg:"Cannot add void years to expiring contract."};
  numVoid=Math.min(numVoid||1,3-(c.voidYears||0));
  var oldHit=calcCapHit(c);
  var totalBonus=c.prorated*(c.years||1);// total remaining bonus
  var newSpread=c.years+numVoid;
  var newPro=Math.round(totalBonus/newSpread*10)/10;
  c.prorated=newPro;
  c.voidYears=(c.voidYears||0)+numVoid;
  c.salary=calcCapHit(c);
  var newHit=calcCapHit(c);
  var savings=Math.round((oldHit-newHit)*10)/10;
  return {ok:true,savings:savings,voidYears:c.voidYears,newHit:newHit,
    msg:"Added "+numVoid+" void year"+(numVoid>1?"s":"")+": saved $"+savings+"M/yr. "+c.voidYears+" total void years. WARNING: $"+Math.round(totalBonus*10)/10+"M dead cap when contract expires!"};
}
function voidYearDeadCap(c){
  if(!c||!c.voidYears||c.voidYears<=0)return 0;
  return Math.round(c.prorated*(c.voidYears||0)*10)/10;
}
function restructureCascade(team,targetSavings){
  var results=[];var totalSaved=0;
  var eligible=team.roster.filter(function(p){
    var c=p.contract;
    if(!c||c.baseSalary===undefined)return false;
    if(c.years<=1||c.restructured)return false;
    var yoe=Math.max((p.age||22)-22,0);var minBase=getMinSalary(yoe);
    return c.baseSalary>=(minBase+1.0);
  }).sort(function(a,b){return calcCapHit(b.contract)-calcCapHit(a.contract);});
  for(var i=0;i<eligible.length;i++){
    if(totalSaved>=targetSavings)break;
    var r=restructureContract(eligible[i]);
    if(r.ok){results.push({name:eligible[i].name,pos:eligible[i].pos,savings:r.savings,addedPro:r.addedPro});totalSaved+=r.savings;}
  }
  return {totalSaved:Math.round(totalSaved*10)/10,count:results.length,players:results,
    msg:results.length>0?"Restructured "+results.length+" contracts: saved $"+Math.round(totalSaved*10)/10+"M":"No eligible contracts to restructure."};
}
var FRANCHISE_TAG_MULT973={QB:2.8,WR:1.5,RB:1.2,TE:1.2,OL:1.3,DL:1.5,LB:1.3,CB:1.5,S:1.2,K:0.6,P:0.5};
function getFranchiseTagSalary973(pos,teams){
  var posPlayers=[];
  (teams||[]).forEach(function(t){
    (t.roster||[]).forEach(function(p){
      if(p&&p.pos===pos&&p.contract)posPlayers.push(v36_capHit(p.contract));
    });
  });
  posPlayers.sort(function(a,b){return b-a;});
  var top5=posPlayers.slice(0,5);
  var avg=top5.length?top5.reduce(function(s,v){return s+v;},0)/top5.length:10;
  return Math.round(Math.max(avg,((FRANCHISE_TAG_MULT973[pos]||1.0)*8))*10)/10;
}
function applyFranchiseTag973(team,player,teams,year){
  if(!team||!player)return {ok:false,msg:"Missing team or player."};
  if(team.franchiseTag973&&team.franchiseTag973.year===year)return {ok:false,msg:"Already used franchise tag this year."};
  if(!player.contract)return {ok:false,msg:"Player has no contract."};
  var tagSal=getFranchiseTagSalary973(player.pos,teams||[]);
  var pers=getPersonality(player);
  var reaction="neutral";
  if(pers.loyalty>=7)reaction="happy";
  else if(pers.greed>=7)reaction="holdout";
  else if((player.age||0)>=30)reaction="unhappy";
  else if(typeof hasTrait95==="function"&&hasTrait95(player,"cancer"))reaction="holdout";
  else if(typeof hasTrait95==="function"&&hasTrait95(player,"loyal"))reaction="happy";
  else reaction=RNG.play()<0.4?"unhappy":"neutral";
  player.contract=makeContract(tagSal,1,0,tagSal);
  player.contract.isTagged=true;
  team.franchiseTag973={playerId:player.id,playerName:player.name,pos:player.pos,salary:tagSal,year:year,reaction:reaction};
  if(reaction==="happy"){
    player.chemistry=cl((player.chemistry||60)+5,15,100);
    player.morale=cl((player.morale||70)+3,15,100);
  }else if(reaction==="unhappy"){
    player.chemistry=cl((player.chemistry||60)-5,15,100);
    player.morale=cl((player.morale||70)-5,15,100);
  }else if(reaction==="holdout"){
    player.holdout75={week:0,demands:"extension",severity:"severe"};
    player.chemistry=cl((player.chemistry||60)-10,15,100);
    player.morale=cl((player.morale||70)-10,15,100);
  }
  player.ovr=calcOvr(player);
  player.trueOvr=player.ovr;
  return {ok:true,salary:tagSal,reaction:reaction,msg:"Franchise tagged "+player.name+" at $"+tagSal+"M. Reaction: "+reaction};
}
var COMP_PICK_RULES={
  calcCompPicks:function(team,faLosses,faSigned){
    if(!faLosses||!faLosses.length)return [];
    var netLoss=[];
    var signedVals=(faSigned||[]).map(function(p){return p.ovr*p.salary;}).sort(function(a,b){return b-a;});
    var usedIdx=0;
    faLosses.sort(function(a,b){return (b.ovr*b.salary)-(a.ovr*a.salary);});
    faLosses.forEach(function(loss){
      var lossVal=loss.ovr*(loss.salary||1);
      if(usedIdx<signedVals.length&&signedVals[usedIdx]>=lossVal*0.5){usedIdx++;return;}
      netLoss.push(loss);
    });
    var picks=[];
    netLoss.slice(0,4).forEach(function(loss,idx){// max 4 comp picks
      var val=loss.ovr*(loss.salary||1);
      var round=val>=600?3:val>=400?4:val>=250?5:val>=120?6:7;
      picks.push({round:round,type:"comp",fromLoss:loss.name+" ("+loss.pos+" "+loss.ovr+")",value:Math.round(val)});
    });
    return picks;
  }
};
var MARKET_TIERS={MEGA:{label:"Mega Market",cashMod:1.4,appeal:9},LARGE:{label:"Large Market",cashMod:1.2,appeal:7},MID:{label:"Mid Market",cashMod:1.0,appeal:5},SMALL:{label:"Small Market",cashMod:0.85,appeal:4}};
var TEAM_MARKET={NYG:"MEGA",NYJ:"MEGA",DAL:"MEGA",LAR:"MEGA",LAC:"MEGA",CHI:"MEGA",SF:"LARGE",MIA:"LARGE",PHI:"LARGE",NE:"LARGE",HOU:"LARGE",ATL:"LARGE",WAS:"LARGE",SEA:"LARGE",DEN:"LARGE",KC:"MID",MIN:"MID",TB:"MID",NO:"MID",LV:"MID",ARI:"MID",DET:"MID",BAL:"MID",PIT:"MID",CLE:"MID",CIN:"MID",BUF:"SMALL",JAX:"SMALL",TEN:"SMALL",IND:"SMALL",CAR:"SMALL",GB:"SMALL"};
function getMarketTier(abbr){return MARKET_TIERS[TEAM_MARKET[abbr]||"MID"]||MARKET_TIERS.MID;}
function calcCashBudget(team,yr){var mt=getMarketTier(team.abbr);var baseRev=120+((team.wins||0)*3)+((team.prestige||50)*0.4);return Math.round(baseRev*mt.cashMod*(team.ownerSpendRate||1.0)*10)/10;}
function gaussian(mean,sd){var u=0,v=0;while(u===0)u=RNG.draft();while(v===0)v=RNG.draft();return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v)*sd+mean;}
function confTier(c){return c<0.2?"blind":c<0.5?"hazy":c<0.8?"forming":"clear";}
function confColor(c){return c<0.2?"#ef4444":c<0.5?"#f59e0b":c<0.8?"#3b82f6":"#10b981";}
function getScoutedOvr(trueOvr,scoutAcc,conf,isRk){
  var sig=(isRk?15:5)*Math.max(0.05,1-conf)*(1-((scoutAcc-40)/95)*0.6);
  return cl(Math.round(gaussian(trueOvr,Math.max(sig,1))),40,99);
}
function getScoutRange(trueOvr,scoutAcc,conf,isRk){
  var sig=(isRk?15:5)*Math.max(0.05,1-conf)*(1-((scoutAcc-40)/95)*0.6);
  var err=Math.max(1,Math.round(sig*1.5));var est=getScoutedOvr(trueOvr,scoutAcc,conf,isRk);
  return{est:est,min:Math.max(40,est-err),max:Math.min(99,est+err),tier:confTier(conf),err:err};
}
function applyScoutBias(scouted,bias,player){
  if(!bias||bias==="balanced")return scouted;var adj=rngD(2,4);
  if(bias==="loves_speed"&&player.ratings&&(player.ratings.speed||0)>=80)return cl(scouted+adj,40,99);
  if(bias==="loves_speed"&&player.ratings&&(player.ratings.speed||0)<60)return cl(scouted-adj,40,99);
  if(bias==="loves_size"&&player.ratings&&(player.ratings.power||player.ratings.strength||0)>=80)return cl(scouted+adj,40,99);
  if(bias==="loves_college_pedigree"){var elite=COL_POWER.indexOf((player.college||{}).school)>=0;return cl(scouted+(elite?adj:-adj),40,99);}
  return scouted;
}
var SCOUT_SPECS=["QB/WR","OL/DL","RB/LB","DB/TE"];
var SCOUT_BIASES=["loves_speed","loves_size","loves_college_pedigree","balanced","balanced","balanced"];
function specMatchesPos(spec,pos){
  if(spec==="QB/WR")return"QB WR".indexOf(pos)>=0;if(spec==="OL/DL")return"OT OG C DE DT".indexOf(pos)>=0;
  if(spec==="RB/LB")return"RB FB LB MLB OLB ILB".indexOf(pos)>=0;if(spec==="DB/TE")return"CB S FS SS TE".indexOf(pos)>=0;return false;
}
function genScout(){return{id:U(),name:pick(FN)+" "+pick(LN),specialty:pickD(SCOUT_SPECS),accuracy:rngD(45,92),bias:pickD(SCOUT_BIASES),region:pickD(["South","Midwest","West","Northeast"]),salary:rngD(1,3)};}
function initScoutState(isOwned,isRk){return{confidence:isOwned?0.85:0.0,lastWeek:null,scoutId:null,events:[],isRookie:isRk||false};}
function advanceScoutConf(sc,scout,pos){if(!sc||!scout)return;var g=0.10;if(specMatchesPos(scout.specialty,pos))g+=0.05;sc.confidence=Math.min(0.95,Math.round((sc.confidence+g)*100)/100);}
function applyScoutEvent(sc,evt){if(!sc)return;var g={combine:0.20,interview:0.15,film_study:0.15,workout:0.12};sc.confidence=Math.min(0.95,Math.round((sc.confidence+(g[evt]||0.1))*100)/100);sc.events.push(evt);}
function getTeamScoutAccuracy(team){
  if(!team||!team.scouts||!team.scouts.length)return 60;
  var total=0,count=0;
  team.scouts.forEach(function(s){if(s&&typeof s.accuracy==="number"){total+=s.accuracy;count++;}});
  return count?Math.round(total/count):60;
}
function applyWeeklyRosterScouting(team,week){
  if(!team||!team.roster)return;
  var scoutAcc=getTeamScoutAccuracy(team);
  team.roster.forEach(function(p){
    if(!p)return;
    if(!p.scouting)p.scouting=initScoutState(true,(p.age||24)<=23);
    var sc=p.scouting;
    var trueVal=(p.trueOvr!==undefined&&p.trueOvr!==null)?p.trueOvr:(p.ovr||50);
    var snaps=p.stats?p.stats.snaps||0:0;
    var gp=p.stats?p.stats.gp||0:0;
    var pers=getPersonality(p);
    var usage=Math.min(1,Math.sqrt(Math.max(0,snaps))/18);// smooths cumulative snaps growth
    var target=0.35+(scoutAcc/100)*0.35+usage*0.20+Math.min(0.12,gp*0.01)+(p.isStarter?0.04:0)+Math.max(0,traitScalar(pers.workEthic))*0.02;
    target=cl(target,0.20,0.96);
    var curConf=sc.confidence||0.0;
    var drift=target-curConf;
    var step=drift>0?Math.min(drift,0.06):Math.max(drift,-0.03);
    sc.confidence=cl(Math.round((curConf+step)*100)/100,0.10,0.96);
    sc.lastWeek=week||sc.lastWeek||0;
    var est=getScoutedOvr(trueVal,scoutAcc,sc.confidence,!!sc.isRookie);
    if(p.hypeOvr===undefined||p.hypeOvr===null)p.hypeOvr=est;
    else p.hypeOvr=Math.round(p.hypeOvr*0.5+est*0.5);
    p.hypeOvr=cl(p.hypeOvr,40,99);
    p.scoutRange=getScoutRange(trueVal,scoutAcc,sc.confidence,!!sc.isRookie);
    p.scoutGrade=gradeL(p.hypeOvr);
  });
}
var SCOUT_RPT=[
{c:"blind",o:"elite",t:"{scout.name} quick hit: {player.pos} from {player.college.school}. Range feels wide ({range.min}-{range.max}). Could be special.",r:"scout"},
{c:"blind",o:"starter",t:"Two snaps caught my eye â€” {topRating} looks real, but {weakRating} might be a problem vs pro speed. {range.min}-{range.max}.",r:"rex"},
{c:"blind",o:"backup",t:"Street note: body type fits {player.pos}, age {player.age}. If {topRating} translates, he's a steal. If {weakRating} is who he is, camp story.",r:"scout"},
{c:"blind",o:"fringe",t:"Barely on radar. {player.pos} out of {player.college.school}. No buzz. {range.min}-{range.max}.",r:"dana"},
{c:"blind",o:"elite",t:"Hidden gem ping: late-round types sometimes show one elite trait early â€” {topRating} could be that. Still blind. {range.min}-{range.max}.",r:"rex"},
{c:"blind",o:"starter",t:"Name keeps coming up in background calls. Can't confirm yet. {range.min}-{range.max}.",r:"scout"},
{c:"blind",o:"backup",t:"Gut says backup. Tape is limited. {player.college.school} doesn't produce many pro {player.pos}s. {range.min}-{range.max}.",r:"dana"},
{c:"blind",o:"fringe",t:"Nothing pops on film. Size is a question. {range.min}-{range.max}. Monitor only.",r:"scout"},
{c:"blind",o:"elite",t:"Red flag (early): medical whispers / durability questions â€” unconfirmed. Range conservative: {range.min}-{range.max}.",r:"dana"},
{c:"blind",o:"starter",t:"First impression: competitive. Plays angry. Not sure if body holds up. {range.min}-{range.max}.",r:"rex"},
{c:"blind",o:"backup",t:"Practice squad type on first glance. Could surprise. {range.min}-{range.max}.",r:"scout"},
{c:"blind",o:"fringe",t:"Low priority. Depth chart filler at best. {range.min}-{range.max}.",r:"dana"},
{c:"blind",o:"elite",t:"Someone will reach for this kid. The upside is tantalizing. But we're still guessing. {range.min}-{range.max}.",r:"rex"},
{c:"hazy",o:"elite",t:"This kid has IT. {topRating} jumps off the tape. I'd take him top 10. Range narrowing: {range.min}-{range.max}.",r:"rex"},
{c:"hazy",o:"starter",t:"Solid. Not flashy. {topRating} is legit but {weakRating} caps the ceiling. {range.min}-{range.max}.",r:"scout"},
{c:"hazy",o:"backup",t:"Backup caliber. Can fill a role. {topRating} keeps him in the league. {range.min}-{range.max}.",r:"scout"},
{c:"hazy",o:"fringe",t:"The tape is... fine. But {weakRating} will get exposed against pro speed. {range.min}-{range.max}.",r:"dana"},
{c:"hazy",o:"elite",t:"Hidden gem (hazy): teammates lean on him late. That's real signal. Might outplay the grade ceiling.",r:"rex"},
{c:"hazy",o:"starter",t:"Red flag (hazy): character fit is a question â€” not a disqualifier. Vet in interviews. {range.min}-{range.max}.",r:"dana"},
{c:"hazy",o:"backup",t:"{scout.name} sees a situational contributor. Not a starter. {range.min}-{range.max}.",r:"scout"},
{c:"hazy",o:"fringe",t:"Camp invite at best. {weakRating} is a real concern. {range.min}-{range.max}.",r:"dana"},
{c:"hazy",o:"elite",t:"Big arm. Big frame. Big questions. Could go top-5 or fall to day 2. {range.min}-{range.max}.",r:"rex"},
{c:"hazy",o:"starter",t:"Dependable. Won't win you games alone but won't lose them either. {range.min}-{range.max}.",r:"scout"},
{c:"hazy",o:"backup",t:"Depth piece. Special teams contributor. {topRating} is the one thing. {range.min}-{range.max}.",r:"scout"},
{c:"hazy",o:"fringe",t:"Hard pass from me. The athleticism just isn't there. {range.min}-{range.max}.",r:"dana"},
{c:"hazy",o:"elite",t:"Production was elite at {player.college.school}. The question is if {weakRating} translates. I'm betting yes. {range.min}-{range.max}.",r:"rex"},
{c:"forming",o:"elite",t:"{scout.name}'s conviction: this is the real deal. {topRating} grades out elite. Ceiling: franchise {player.pos}. {range.min}-{range.max}.",r:"rex"},
{c:"forming",o:"starter",t:"Clear pro starter. {topRating} is plus. {weakRating} is manageable in the right scheme. {range.min}-{range.max}.",r:"scout"},
{c:"forming",o:"backup",t:"Depth. Knows his role. {topRating} keeps him employed. Not a difference maker. {range.min}-{range.max}.",r:"scout"},
{c:"forming",o:"fringe",t:"Camp body. Might stick as PS. {weakRating} is disqualifying at the next level. {range.min}-{range.max}.",r:"dana"},
{c:"forming",o:"elite",t:"Red flag (forming): durability has a pattern. He finishes games, but the accumulation is worth noting.",r:"dana"},
{c:"forming",o:"starter",t:"Hidden gem (forming): wins in ways the box score misses â€” leverage, angles, communication. That's why I'm higher than consensus.",r:"rex"},
{c:"forming",o:"backup",t:"Role player. Good locker room guy. {topRating} in limited reps. {range.min}-{range.max}.",r:"scout"},
{c:"forming",o:"fringe",t:"Below the line. Might catch on somewhere as a practice body. {range.min}-{range.max}.",r:"dana"},
{c:"forming",o:"elite",t:"Every week I study this kid, the grade goes up. {topRating} is legit. Getting close to final grade. {range.min}-{range.max}.",r:"rex"},
{c:"forming",o:"starter",t:"Scheme fit matters here. In our system, B+. In a spread, C. {range.min}-{range.max}.",r:"scout"},
{c:"forming",o:"backup",t:"Veteran backup type. Won't embarrass you. Won't elevate you. {range.min}-{range.max}.",r:"scout"},
{c:"forming",o:"fringe",t:"I've seen enough. This isn't a pro player barring a miracle. {range.min}-{range.max}.",r:"dana"},
{c:"forming",o:"elite",t:"{player.name} has first-round tools and a Day 1 starter floor. Pro Bowl ceiling or just 'good'? {range.min}-{range.max}.",r:"rex"},
{c:"clear",o:"elite",t:"FINAL GRADE: Franchise cornerstone. {topRating} is elite. My #1 {player.pos} in this class. {range.min}-{range.max}.",r:"rex"},
{c:"clear",o:"starter",t:"FINAL GRADE: Day 1 starter. No elite trait but no disqualifying weakness. Solid pro. {range.min}-{range.max}.",r:"scout"},
{c:"clear",o:"backup",t:"FINAL GRADE: Roster piece. Spot starter in a pinch. {topRating} is his meal ticket. {range.min}-{range.max}.",r:"scout"},
{c:"clear",o:"fringe",t:"FINAL GRADE: Priority FA at best. {weakRating} can't hold up. {range.min}-{range.max}.",r:"dana"},
{c:"clear",o:"elite",t:"Red flag (clear): medical is a real constraint â€” chronic, managed, not cured. Build plan around it or pass.",r:"dana"},
{c:"clear",o:"starter",t:"Hidden gem (clear): consensus board underrates him because scheme hid {topRating}. Isolate reps â€” it screams.",r:"rex"},
{c:"clear",o:"backup",t:"FINAL GRADE: Quality depth. 5-6 good years as backup / special teamer. {range.min}-{range.max}.",r:"scout"},
{c:"clear",o:"fringe",t:"FINAL GRADE: Not a pro. File closed. {range.min}-{range.max}.",r:"dana"},
{c:"clear",o:"elite",t:"Red flag (clear): maturity/discipline is a thing. Requires strong locker room leadership. Eyes open.",r:"dana"},
{c:"clear",o:"starter",t:"FINAL GRADE: Dependable starter for 8-10 years. Won't make Pro Bowl but you'll never regret the pick. {range.min}-{range.max}.",r:"scout"},
{c:"clear",o:"backup",t:"FINAL GRADE: Journeyman. Third on depth chart. Knows the playbook, does the work. {range.min}-{range.max}.",r:"scout"},
{c:"clear",o:"elite",t:"{player.name} is my top-rated {player.pos} in this class. Period. Pay whatever it costs. {range.min}-{range.max}.",r:"rex"}
];
function getScoutRpt(tier,ovr){var ot=ovr>=85?"elite":ovr>=75?"starter":ovr>=65?"backup":"fringe";var p=SCOUT_RPT.filter(function(r){return r.c===tier&&r.o===ot;});if(!p.length)p=SCOUT_RPT.filter(function(r){return r.c===tier;});return p.length?p[Math.floor(RNG.draft()*p.length)]:SCOUT_RPT[0];}
var EX36={
  trade:[
    {k:"valueDiff",h:"{aiTeam} hangs up: the value isn't close.",rs:["They grade your offer at {userValue} vs ask of {askingValue}.","Not enough to move the needle."],sg:["Add a premium pick (Rd 1-2).","Target a less valuable player."]},
    {k:"capImpact",h:"{aiTeamAbbr} says no: cap math breaks.",rs:["Only {aiCapSpace}M cap space.","This trade pushes them over."],sg:["Send salary back.","Wait for them to create room."]},
    {k:"deadCap",h:"Dead cap would torch YOU.",rs:["Trading {player.name} accelerates {deadCapAmt}M dead money.","{capSavings}M net impact â€” potentially negative."],sg:["Wait for more proration to vest.","Restructure first to spread the pain."]},
    {k:"posNeed",h:"{aiTeamAbbr} needs {player.pos} too badly.",rs:["{player.name} is their only quality {player.pos}.","No depth behind him."],sg:["Offer a replacement {player.pos}.","Look at other teams with depth."]},
    {k:"cornerstone",h:"{player.name} is untouchable.",rs:["{aiTeamAbbr} considers him a franchise cornerstone.","{player.ovr} OVR, age {player.age} â€” elite and in window."],sg:["This player isn't available.","Target someone else."]},
    {k:"contending",h:"{aiTeamAbbr} is in win-now mode.",rs:["At {aiRecord}, they won't trade starters mid-push."],sg:["Try again in the offseason.","Target a non-contender."]},
    {k:"default",h:"{aiTeamAbbr} declined your proposal.",rs:["Overall package didn't meet threshold."],sg:["Improve the offer or find another partner."]}
  ],
  fa:[
    {k:"money",h:"{player.name} wants more money.",rs:["Offered ${offerSalary}M â€” market is ${marketValue}M."],sg:["Raise offer to match market.","Wait for market to cool."]},
    {k:"contender",h:"{player.name} wants to win.",rs:["Record ({teamRecord}) doesn't scream contender."],sg:["Improve record first.","Overpay to overcome prestige gap."]},
    {k:"role",h:"{player.name} wants to start.",rs:["Already have a starter at {player.pos}."],sg:["Move current starter.","Target a willing backup."]},
    {k:"grudge",h:"{player.name} hasn't forgotten.",rs:["You cut him â€” loyalty penalty."],sg:["Overpay to overcome the grudge.","Move on."]},
    {k:"market",h:"{player.name} prefers a bigger stage.",rs:["Wants big market / warm weather."],sg:["Overpay 15-20% to compensate.","Focus on football-fit players."]},
    {k:"default",h:"{player.name} signed elsewhere.",rs:["Better overall package from another team."],sg:["Act faster next time."]}
  ],
  dev:[
    {k:"age_decline",h:"{player.name} lost a step.",rs:["At {player.age}, {player.pos} players typically decline."],sg:["Plan the succession.","Reduce snap count."]},
    {k:"injury",h:"Injury took a toll on {player.name}.",rs:["Recovery reduced physical attributes."],sg:["Manage workload.","Find a backup."]},
    {k:"morale",h:"{player.name}'s heart isn't in it.",rs:["Low morale ({player.morale}) suppressed development."],sg:["Address morale issue.","Consider a trade."]},
    {k:"snaps",h:"{player.name} needs more reps.",rs:["Only {player.stats.snaps} snaps â€” not enough."],sg:["Promote to starter.","Find reps elsewhere."]},
    {k:"breakout",h:"ðŸš€ {player.name} is breaking out!",rs:["Everything clicked â€” scheme, coaching, confidence."],sg:["Lock him up with an extension!"]},
    {k:"bust",h:"{player.name} isn't developing.",rs:["High potential, low actualization."],sg:["Cut losses and trade.","One more year with better coaching."]},
    {k:"coaching",h:"Coaching boost: {player.name} thriving.",rs:["Staff scheme fits perfectly."],sg:["Keep this staff together."]},
    {k:"default",h:"{player.name}'s rating changed.",rs:["Multiple factors contributed."],sg:["Review player card for details."]}
  ],
  cap:[
    {k:"overCap",h:"Over the cap â€” can't afford {player.name}.",rs:["Cap: ${capSpace}M. Need: ${offerTotal}M."],sg:["Cut someone.","Restructure a big contract."]},
    {k:"overCash",h:"Cap space exists, but you're cash-poor.",rs:["Cap âœ… Cash: ${cashAvailable}M âŒ Need: ${cashNeeded}M bonus."],sg:["Smaller signing bonus.","Wait for revenue."]},
    {k:"rosterFull",h:"Roster full ({rosterCount}/{rosterLimit}).",rs:["Someone has to go."],sg:["Cut lowest-rated player.","Trade to make room."]},
    {k:"deadCap",h:"Dead cap eating your space.",rs:["${deadCap}M from previous cuts/trades."],sg:["Wait â€” clears after this season."]},
    {k:"floor",h:"âš ï¸ Below the salary cap floor.",rs:["Min spend: ${capFloor}M. You're at ${capUsed}M."],sg:["Sign FAs.","Extend with raises."]}
  ]
};
function pickEx(cat,key){var p=(EX36[cat]||[]).filter(function(e){return e.k===key;});if(!p.length)p=(EX36[cat]||[]).filter(function(e){return e.k==="default";});return p[0]||{h:"",rs:[],sg:[]};}
function capCalc(roster){return Math.round(roster.reduce(function(s,p){var h=v36_capHit(p.contract);return s+(h<=MIN_SALARY?0:h);},0)*10)/10;}
var PHASE_RULES={
  preseason:  {canTrade:true, canSignFA:false,canCut:true, canRestructure:true, canDraft:false,canExtend:true, label:"Preseason"},
  cutDay:     {canTrade:false,canSignFA:false,canCut:true, canRestructure:false,canDraft:false,canExtend:false,label:"Cut Day"},
  regular:    {canTrade:true, canSignFA:true, canCut:true, canRestructure:true, canDraft:false,canExtend:true, label:"Regular Season"},
  playoffs:   {canTrade:false,canSignFA:true, canCut:false,canRestructure:false,canDraft:false,canExtend:false,label:"Playoffs"},
  seasonRecap:{canTrade:false,canSignFA:false,canCut:false,canRestructure:false,canDraft:false,canExtend:false,label:"Season Recap"},
  reSign:     {canTrade:false,canSignFA:false,canCut:true, canRestructure:true, canDraft:false,canExtend:true, label:"Re-Sign Window"},
  combine:    {canTrade:true, canSignFA:false,canCut:true, canRestructure:true, canDraft:false,canExtend:false,label:"Scouting Combine"},
  draft:      {canTrade:true, canSignFA:false,canCut:false,canRestructure:false,canDraft:true, canExtend:false,label:"Draft"},
  drafting:   {canTrade:true, canSignFA:false,canCut:false,canRestructure:false,canDraft:true, canExtend:false,label:"Draft (Active)"},
  freeAgency: {canTrade:false,canSignFA:true, canCut:true, canRestructure:true, canDraft:false,canExtend:false,label:"Free Agency"}
};
function canDoAction(phase,action){var r=PHASE_RULES[phase];if(!r)return true;return !!r[action];}
function canTrade(phase,week){return canDoAction(phase,"canTrade")&&!(phase==="regular"&&(week||0)>10);}
function logPhaseTransition(oldPhase,newPhase,seasonRef){
  if(oldPhase===newPhase)return;
  if(typeof ledgerLog==="function")ledgerLog("PHASE_TRANSITION","LEAGUE","Phase: "+oldPhase+" â†’ "+newPhase,{from:oldPhase,to:newPhase});
}
function hashId(id){var h=0;for(var i=0;i<id.length;i++){h=((h<<5)-h)+id.charCodeAt(i);h=h&h;}return Math.abs(h);}
var SKIN_TONES=["#3a2519","#593a28","#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac"];
var HAIR_COLORS=["#090806","#2c222b","#44342a","#71635a","#b7a69e","#b55239","#d6c4c2"];
var Sparkline = memo(function(props){
  var data=props.data||[];var w=props.width||60;var h=props.height||18;
  if(data.length<2) return null;
  var max=Math.max.apply(null,data)||1;
  var pts=data.map(function(v,i){return Math.round(i/(data.length-1)*w)+","+Math.round(h-((v/max)*(h-2))+1);}).join(" ");
  var trend=data[data.length-1]>data[0]?"#34d399":data[data.length-1]<data[0]?"#ef4444":"#9a9488";
  return React.createElement("svg",{width:w,height:h,style:{flexShrink:0}},
    React.createElement("polyline",{points:pts,fill:"none",stroke:trend,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),
    React.createElement("circle",{cx:w,cy:Math.round(h-((data[data.length-1]/max)*(h-2))+1),r:2,fill:trend})
  );
});
var PlayerFace = memo(function(props){
  var id=props.id||"x";var morale=props.morale||70;var sz=props.size||28;var age=props.age||25;
  var h=hashId(id);
  var skin=SKIN_TONES[h%SKIN_TONES.length];
  var hair=HAIR_COLORS[(h>>3)%HAIR_COLORS.length];
  if(age>=33)hair="#8a8a8a";else if(age>=30)hair="#"+hair.slice(1).split("").map(function(c,i){var v=parseInt(c,16);return Math.min(15,v+3).toString(16);}).join("");
  var hairStyle=(h>>6)%5;// 0:bald, 1:short, 2:flat, 3:high, 4:long
  var beard=(h>>9)%3===0;
  var brow=(h>>11)%2;// 0:normal, 1:thick
  var mouth=morale>75?"M9,21 Q15,27 21,21":morale<45?"M9,24 Q15,19 21,24":"M10,22 L20,22";
  return React.createElement("svg",{width:sz,height:sz,viewBox:"0 0 30 30",style:{borderRadius:"50%",flexShrink:0}},
    React.createElement("rect",{x:0,y:0,width:30,height:30,fill:"#555",rx:15}),
    React.createElement("ellipse",{cx:15,cy:16,rx:11,ry:12,fill:skin}),
    React.createElement("ellipse",{cx:10.5,cy:14,rx:1.8,ry:1.6,fill:"#1a1a1a"}),
    React.createElement("ellipse",{cx:19.5,cy:14,rx:1.8,ry:1.6,fill:"#1a1a1a"}),
    React.createElement("ellipse",{cx:11,cy:13.5,rx:0.5,ry:0.5,fill:"#fff"}),
    React.createElement("ellipse",{cx:20,cy:13.5,rx:0.5,ry:0.5,fill:"#fff"}),
    brow===1?React.createElement("line",{x1:8,y1:11,x2:13,y2:10.5,stroke:"#2d2d2d",strokeWidth:1.5}):
      React.createElement("line",{x1:8.5,y1:11.5,x2:12.5,y2:11,stroke:"#2d2d2d",strokeWidth:1}),
    brow===1?React.createElement("line",{x1:17,y1:10.5,x2:22,y2:11,stroke:"#2d2d2d",strokeWidth:1.5}):
      React.createElement("line",{x1:17.5,y1:11,x2:21.5,y2:11.5,stroke:"#2d2d2d",strokeWidth:1}),
    React.createElement("line",{x1:15,y1:14,x2:15,y2:18,stroke:"rgba(0,0,0,0.15)",strokeWidth:0.8}),
    React.createElement("ellipse",{cx:15,cy:18.2,rx:2,ry:0.8,fill:"rgba(0,0,0,0.08)"}),
    React.createElement("path",{d:mouth,stroke:"#4a3030",strokeWidth:1.2,fill:"none",strokeLinecap:"round"}),
    hairStyle===1?React.createElement("path",{d:"M4,11 Q8,3 15,2 Q22,3 26,11 L26,8 Q22,1 15,0 Q8,1 4,8 Z",fill:hair}):null,
    hairStyle===2?React.createElement("path",{d:"M5,12 Q7,5 15,4 Q23,5 25,12 L25,9 Q22,3 15,2 Q8,3 5,9 Z",fill:hair}):null,
    hairStyle===3?React.createElement("path",{d:"M5,12 Q6,1 15,-2 Q24,1 25,12 L26,8 Q23,-2 15,-4 Q7,-2 4,8 Z",fill:hair}):null,
    hairStyle===4?React.createElement("path",{d:"M4,11 Q6,2 15,0 Q24,2 26,11 L27,18 Q26,14 25,12 L25,8 Q22,1 15,-1 Q8,1 5,8 L5,12 Q4,14 3,18 Z",fill:hair}):null,
    beard?React.createElement("path",{d:"M9,22 Q12,28 15,28 Q18,28 21,22",stroke:hair,strokeWidth:2.5,fill:"none",opacity:0.7}):null
  );
});
var TeamLogo = memo(function(props){
  var team=props.team;var sz=props.size||26;
  if(!team) return null;
  var h=hashId(team.id||"x");
  var shape=h%3;// 0:Shield, 1:Circle, 2:Heater
  var path=shape===0?"M5,3 L25,3 L25,12 Q25,26 15,29 Q5,26 5,12 Z":shape===1?"M15,1 A14,14 0 1,1 14.99,1":"M4,3 L26,3 L24,17 Q15,29 15,29 Q15,29 6,17 Z";
  var stripe=h%4===0?"M5,3 L25,28":h%4===1?"M15,3 L15,29":h%4===2?"M5,15 L25,15":"";
  var c1=team.c1||"#333";var c2=h%2===0?"rgba(255,255,255,0.12)":"rgba(0,0,0,0.15)";
  return React.createElement("svg",{width:sz,height:sz,viewBox:"0 0 30 30",style:{flexShrink:0,filter:"drop-shadow(0 1px 3px rgba(0,0,0,0.5))"}},
    React.createElement("defs",null,
      React.createElement("linearGradient",{id:"lg_"+team.id,x1:"0",y1:"0",x2:"1",y2:"1"},
        React.createElement("stop",{offset:"0%",stopColor:c1}),
        React.createElement("stop",{offset:"100%",stopColor:c1+"cc"}))),
    React.createElement("path",{d:path,fill:"url(#lg_"+team.id+")"}),
    stripe?React.createElement("path",{d:stripe,stroke:c2,strokeWidth:"3",fill:"none"}):null,
    React.createElement("path",{d:path,fill:"none",stroke:"rgba(255,255,255,0.25)",strokeWidth:"0.8"}),
    React.createElement("text",{x:"15",y:shape===1?"19":"20",fontSize:Math.round(sz*0.45),textAnchor:"middle",fill:"#fff",fontWeight:"bold",style:{textShadow:"0 1px 2px rgba(0,0,0,0.6)"}},team.icon||"?")
  );
});
var Trophy = memo(function(props){
  var sz=props.size||40;var col=props.type==="champ"?T.gold:"#C0C0C0";var yr=props.year||"";
  return React.createElement("svg",{width:sz,height:sz,viewBox:"0 0 40 40",style:{filter:"drop-shadow(0 3px 6px rgba(212,167,75,0.4))"}},
    React.createElement("path",{d:"M10,8 L30,8 L28,24 Q20,31 12,24 Z",fill:col,stroke:"rgba(0,0,0,0.3)",strokeWidth:0.5}),
    React.createElement("path",{d:"M8,10 C1,10 1,19 8,19",fill:"none",stroke:col,strokeWidth:2.5}),
    React.createElement("path",{d:"M32,10 C39,10 39,19 32,19",fill:"none",stroke:col,strokeWidth:2.5}),
    React.createElement("rect",{x:14,y:27,width:12,height:3,fill:col,rx:1}),
    React.createElement("rect",{x:11,y:30,width:18,height:6,fill:"#444",rx:1}),
    React.createElement("rect",{x:12,y:31,width:16,height:4,fill:"#555",rx:1}),
    React.createElement("text",{x:20,y:35,fontSize:5,fill:"#fff",textAnchor:"middle",fontWeight:"bold"},yr),
    React.createElement("text",{x:20,y:20,fontSize:10,textAnchor:"middle",fill:"#fff",fontWeight:"bold"},"ðŸ†")
  );
});
var VirtualList = memo(function VirtualList(props) {
  var items = props.items || [];
  var rowHeight = props.rowHeight || 50;
  var height = props.height || 400;
  var renderRow = props.renderRow;
  var overscan = props.overscan || 5;
  var _scroll = useState(0), scrollTop = _scroll[0], setScrollTop = _scroll[1];
  var totalHeight = items.length * rowHeight;
  var startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - overscan);
  var endIndex = Math.min(items.length - 1, Math.floor((scrollTop + height) / rowHeight) + overscan);
  var visibleItems = [];
  for (var i = startIndex; i <= endIndex; i++) {
    visibleItems.push(React.createElement("div", {
      key: items[i].id || i,
      style: { position: "absolute", top: i * rowHeight, left: 0, width: "100%", height: rowHeight, overflow: "hidden" }
    }, renderRow(items[i], i)));
  }
  return React.createElement("div", {
    style: { height: height, overflowY: "auto", position: "relative" },
    onScroll: function(e) { setScrollTop(e.target.scrollTop); }
  }, React.createElement("div", { style: { height: totalHeight, position: "relative" } }, visibleItems));
});
var LZW = {
  compress: function(s) {
    if (!s) return "";
    var dict = {}, data = (s + "").split(""), out = [], phrase = data[0], code = 256;
    for (var i = 1; i < data.length; i++) {
      var c = data[i];
      if (dict[phrase + c] != null) { phrase += c; }
      else { out.push(phrase.length > 1 ? dict[phrase] : phrase.charCodeAt(0)); dict[phrase + c] = code++; phrase = c; }
    }
    out.push(phrase.length > 1 ? dict[phrase] : phrase.charCodeAt(0));
    var result = [];
    for (var j = 0; j < out.length; j++) { result.push(String.fromCharCode(out[j] & 0xFFFF)); }
    return result.join("");
  },
  decompress: function(s) {
    if (!s) return "";
    var dict = {}, data = (s + "").split(""), currChar = data[0], oldPhrase = currChar, out = [currChar], code = 256, phrase;
    for (var i = 1; i < data.length; i++) {
      var currCode = data[i].charCodeAt(0);
      phrase = currCode < 256 ? data[i] : (dict[currCode] ? dict[currCode] : (oldPhrase + currChar));
      out.push(phrase);
      currChar = phrase.charAt(0);
      dict[code++] = oldPhrase + currChar;
      oldPhrase = phrase;
    }
    return out.join("");
  },
  compressToBase64: function(s) { try { return btoa(unescape(encodeURIComponent(LZW.compress(s)))); } catch(e) { return btoa(LZW.compress(s)); } },
  decompressFromBase64: function(b) { try { return LZW.decompress(decodeURIComponent(escape(atob(b)))); } catch(e) { return LZW.decompress(atob(b)); } }
};
var KEYMAP = {
  "1":"home","2":"roster","3":"scouting","4":"schedule","5":"standings",
  "6":"stats","7":"trade","8":"freeAgents","9":"office",
  "d":"home","r":"roster","g":"trade","o":"office","c":"capLab",
  "h":"hallOfFame","i":"inbox",
  "[":"prevTab","]":"nextTab"
};
var ACTION_KEYS = {
  " ":"simWeek","w":"simWeek","n":"nextPhase","p":"simToPlayoffs",
  "Escape":"closeModal","?":"showHelp"
};
var TAB_ORDER=["home","roster","depthChart","scouting","schedule","standings","stats","trade","freeAgents","office"];
var UNLOCK_DEFS = [
  {id:"frontOffice",label:"Front Office Tools",trigger:"week3",tabs:["capLab","freeAgents"],
    toast:"ðŸ”“ Front Office unlocked: Free Agency + Cap Lab.",
    inbox:"Ownership approved new FO tools. Cap Lab is live."},
  {id:"scouting",label:"Scouting Department",trigger:"season1",tabs:["scouting","combine"],
    toast:"ðŸ”“ Scouting Department unlocked: Combine + Draft Intel.",
    inbox:"Your scouting staff is fully operational."},
  {id:"warRoom",label:"War Room",trigger:"madePlayoffs",tabs:["warRoom"],// v79: War Room now has real content
    toast:"ðŸ”“ War Room unlocked: Draft Day trades + Deadline.",
    inbox:"After reaching the playoffs, the owner opened the War Room."},
  {id:"ledger",label:"The Ledger",trigger:"season3",tabs:["ledger"],
    toast:"ðŸ”“ The Ledger unlocked: the game audits itself now.",
    inbox:"Three seasons of data means the analytics team can work."},
  {id:"legacy",label:"Legacy",trigger:"wonTitleOrSeason5",tabs:["hallOfFame","records","achievements"],
    toast:"ðŸ”“ Legacy unlocked: Hall of Fame + Records.",
    inbox:"Your legacy is taking shape. The Hall of Fame opens."}
];
var DEFAULT_UNLOCKS={frontOffice:false,scouting:false,warRoom:false,ledger:false,legacy:false};
function checkUnlocks(unlocks,season,teams,myId,godMode){
  if(godMode)return{frontOffice:true,scouting:true,warRoom:true,ledger:true,legacy:true};
  var u=assign({},DEFAULT_UNLOCKS,unlocks||{});
  var my=teams.find(function(t){return t.id===myId;});
  if(!u.frontOffice&&season.week>=3)u.frontOffice=true;
  if(!u.scouting&&season.year>2026)u.scouting=true;
  if(!u.warRoom&&my&&(my.madePlayoffs||(season.phase==="playoffs")))u.warRoom=true;
  if(!u.ledger&&season.year>=2029)u.ledger=true;
  if(!u.legacy&&(season.year>=2031||(my&&my.titles&&my.titles>0)))u.legacy=true;
  return u;
}
function isTabUnlocked(tabId,unlocks,godMode){
  if(godMode)return true;
  var alwaysOpen=["home","roster","depthChart","schedule","standings","trade","draft","settings","ownerReport"];
  if(alwaysOpen.indexOf(tabId)>=0)return true;
  for(var i=0;i<UNLOCK_DEFS.length;i++){
    if(UNLOCK_DEFS[i].tabs.indexOf(tabId)>=0)return unlocks[UNLOCK_DEFS[i].id]===true;
  }
  return true;// default open for unmapped tabs
}
var HELP_SECTIONS=[
  {title:"Navigation",keys:[
    {k:"1-9",desc:"Jump to tab"},
    {k:"[ ]",desc:"Previous / Next tab"},
    {k:"D",desc:"Dashboard"},{k:"R",desc:"Roster"},
    {k:"G",desc:"Trade"},{k:"O",desc:"Office"},
    {k:"Esc",desc:"Close modal"}
  ]},
  {title:"Simulation",keys:[
    {k:"Space / W",desc:"Sim Week"},
    {k:"N",desc:"Next Phase"},
    {k:"P",desc:"Sim to Playoffs"}
  ]},
  {title:"Save",keys:[
    {k:"Ctrl+S",desc:"Save Now"},
    {k:"Ctrl+Shift+C",desc:"Copy Export String"}
  ]}
];
var COL_POWER=["Alabama","Ohio St","Georgia","Michigan","USC","Oregon","Texas","Clemson","Penn St","LSU",
  "Oklahoma","Florida St","Florida","Tennessee","Notre Dame","Auburn","Texas A&M","Missouri","Wisconsin","Iowa",
  "Miami","Ole Miss","South Carolina","NC State","UCLA","Arizona St","Colorado","Utah","Washington","Iowa St",
  "Kansas St","Oklahoma St","Baylor","TCU","West Virginia","Virginia Tech","Louisville","Duke","Pittsburgh","Illinois",
  "Minnesota","Nebraska","Purdue","Michigan St","Maryland","Kentucky","Mississippi St","Arkansas","Vanderbilt","Wake Forest"];
var COL_G5=["Boise St","Memphis","UNLV","Tulane","Liberty","James Madison","Sam Houston","App State","Coastal Carolina",
  "San Jose St","Troy","Marshall","Western Kentucky","Toledo","Ohio","Central Michigan","Air Force","Navy","Army",
  "SMU","East Carolina","UAB","North Texas","UTSA","Charlotte","Jacksonville St","Kennesaw St","Louisiana","South Alabama"];
var COL_FCS=["North Dakota St","South Dakota St","Montana","Montana St","Sacramento St","Villanova","Delaware","UC Davis","Eastern Washington"];
var COL_WEIGHTED=COL_POWER.concat(["Missouri","Missouri","Missouri"]).concat(COL_G5);
function pickCollege(isElite){
  if(isElite)return pick(COL_POWER.concat(["Missouri","Missouri"]));
  var r=RNG.draft();// v35: was non-deterministic random â€” leak fixed
  if(r<0.05)return pick(COL_FCS);
  if(r<0.25)return pick(COL_G5);
  return pick(COL_WEIGHTED);
}
var POS_DEF={
  QB:{r:["arm","accuracy","awareness","speed","toughness",
    "throwOnRun","shortAccuracy","deepAccuracy","release","pocketPresence",
    "acceleration","agility","strength","stamina","clutch",
    "leadership","scramble","playRecognition","decisionSpeed","fieldVision"],
    w:[10,10,10,3,6, 6,6,6,6,10, 1,3,1,3,6, 3,3,6,6,3],side:"O",
    cat:{PHY:["speed","acceleration","agility","strength","stamina","toughness"],
      THROW:["arm","accuracy","shortAccuracy","deepAccuracy","throwOnRun","release"],
      MENTAL:["awareness","pocketPresence","playRecognition","decisionSpeed","fieldVision","clutch"],
      INTANG:["leadership","scramble"]}},
  RB:{r:["speed","power","elusiveness","catching","blocking",
    "acceleration","agility","strength","stamina","toughness",
    "ballCarrierVision","breakTackle","stiffArm","truckPower","routeRunning",
    "passProtection","awareness","clutch","durability","changeOfDirection"],
    w:[10,10,10,3,3, 6,6,3,6,3, 10,6,3,6,1, 1,6,3,3,6],side:"O",
    cat:{PHY:["speed","acceleration","agility","strength","stamina","toughness","durability"],
      RUSH:["power","elusiveness","ballCarrierVision","breakTackle","stiffArm","truckPower","changeOfDirection"],
      REC:["catching","routeRunning"],
      MENTAL:["awareness","clutch","blocking","passProtection"]}},
  WR:{r:["speed","catching","routeRunning","release","awareness",
    "acceleration","agility","strength","stamina","jumping",
    "catchInTraffic","spectacularCatch","shortRoute","deepRoute","separation",
    "yacAbility","breakTackle","runBlocking","playRecognition","clutch"],
    w:[10,10,10,6,6, 6,3,1,3,3, 6,3,6,6,10, 6,1,1,3,3],side:"O",
    cat:{PHY:["speed","acceleration","agility","strength","stamina","jumping"],
      REC:["catching","catchInTraffic","spectacularCatch","routeRunning","release","separation"],
      ROUTE:["shortRoute","deepRoute","yacAbility","breakTackle"],
      MENTAL:["awareness","playRecognition","clutch","runBlocking"]}},
  TE:{r:["catching","blocking","speed","routeRunning","toughness",
    "acceleration","agility","strength","stamina","jumping",
    "catchInTraffic","runBlocking","passProtection","impactBlocking","breakTackle",
    "awareness","playRecognition","clutch","release","ballCarrierVision"],
    w:[10,10,6,6,3, 3,3,6,3,3, 6,10,6,6,1, 6,3,3,3,1],side:"O",
    cat:{PHY:["speed","acceleration","agility","strength","stamina","toughness","jumping"],
      REC:["catching","catchInTraffic","routeRunning","release","ballCarrierVision","breakTackle"],
      BLOCK:["blocking","runBlocking","passProtection","impactBlocking"],
      MENTAL:["awareness","playRecognition","clutch"]}},
  OL:{r:["passBlock","runBlock","strength","awareness","toughness",
    "acceleration","agility","speed","stamina","impactBlocking",
    "pullBlock","footwork","handTechnique","anchorStrength","runBlockFinesse",
    "passBlockFinesse","playRecognition","clutch","durability","assignmentIQ"],
    w:[10,10,10,6,6, 1,3,1,6,6, 3,6,6,10,3, 3,6,3,3,6],side:"O",
    cat:{PHY:["strength","speed","acceleration","agility","stamina","toughness","durability"],
      PASS:["passBlock","passBlockFinesse","anchorStrength","handTechnique","footwork"],
      RUN:["runBlock","runBlockFinesse","impactBlocking","pullBlock"],
      MENTAL:["awareness","playRecognition","clutch","assignmentIQ"]}},
  DL:{r:["passRush","runStop","strength","speed","toughness",
    "acceleration","agility","stamina","powerMoves","finesseMoves",
    "bullRush","handUsage","blockShedding","pursuit","awareness",
    "playRecognition","clutch","durability","motorEffort","tackling"],
    w:[10,10,10,6,3, 6,3,6,6,6, 3,6,6,6,3, 3,3,3,6,1],side:"D",
    cat:{PHY:["strength","speed","acceleration","agility","stamina","toughness","durability"],
      RUSH:["passRush","powerMoves","finesseMoves","bullRush","handUsage"],
      RUN:["runStop","blockShedding","pursuit","tackling","motorEffort"],
      MENTAL:["awareness","playRecognition","clutch"]}},
  LB:{r:["tackle","coverage","speed","awareness","passRush",
    "acceleration","agility","strength","stamina","toughness",
    "zoneCoverage","manCoverage","pursuit","blockShedding","hitPower",
    "playRecognition","clutch","jumping","ballSkills","motorEffort"],
    w:[10,6,10,6,6, 6,3,3,6,3, 6,3,6,3,6, 6,3,3,3,3],side:"D",
    cat:{PHY:["speed","acceleration","agility","strength","stamina","toughness","jumping"],
      RUSH:["passRush","blockShedding","hitPower","pursuit","motorEffort"],
      COV:["coverage","zoneCoverage","manCoverage","ballSkills"],
      MENTAL:["awareness","playRecognition","clutch","tackle"]}},
  CB:{r:["coverage","speed","awareness","tackling","ballSkills",
    "acceleration","agility","strength","stamina","jumping",
    "manCoverage","zoneCoverage","pressAbility","hitPower","pursuit",
    "playRecognition","clutch","catchup","breakOnBall","discipline"],
    w:[10,10,6,3,6, 10,6,1,3,3, 10,6,6,1,3, 6,3,6,6,3],side:"D",
    cat:{PHY:["speed","acceleration","agility","strength","stamina","jumping"],
      COV:["coverage","manCoverage","zoneCoverage","pressAbility","breakOnBall","catchup"],
      BALL:["ballSkills","discipline","pursuit","hitPower","tackling"],
      MENTAL:["awareness","playRecognition","clutch"]}},
  S:{r:["coverage","tackling","speed","awareness","ballSkills",
    "acceleration","agility","strength","stamina","toughness",
    "jumping","zoneCoverage","manCoverage","hitPower","pursuit",
    "blockShedding","playRecognition","clutch","rangeAbility","runSupport"],
    w:[10,6,10,6,6, 6,3,3,3,3, 3,6,3,6,6, 3,6,3,10,6],side:"D",
    cat:{PHY:["speed","acceleration","agility","strength","stamina","toughness","jumping"],
      COV:["coverage","zoneCoverage","manCoverage","rangeAbility","ballSkills"],
      RUN:["tackling","hitPower","pursuit","blockShedding","runSupport"],
      MENTAL:["awareness","playRecognition","clutch"]}},
  K:{r:["kickPower","accuracy","clutch","consistency","awareness",
    "stamina","confidence","shortRange","medRange","longRange",
    "direction","hangTime","touchback","onsideKick","weatherResist",
    "acceleration","agility","toughness","fieldGoalIQ","iceVeins"],
    w:[10,10,6,10,3, 3,6,6,6,6, 3,3,1,1,1, 1,1,1,3,6],side:"K",
    cat:{PHY:["stamina","acceleration","agility","toughness"],
      KICK:["kickPower","accuracy","shortRange","medRange","longRange","direction","hangTime","touchback"],
      MENTAL:["clutch","consistency","awareness","confidence","iceVeins","fieldGoalIQ"],
      SPECIAL:["onsideKick","weatherResist"]}},
  P:{r:["kickPower","accuracy","consistency","awareness","clutch",
    "stamina","hangTime","directional","coffeeCorner","speed",
    "agility","tackling","toughness","confidence","weatherResist",
    "netPunt","pinPoint","coverage","fieldSense","insideThe20"],
    w:[10,10,10,3,3, 3,6,6,6,1, 1,1,1,3,1, 6,6,3,3,10],side:"K",
    cat:{PHY:["speed","agility","stamina","toughness","tackling"],
      PUNT:["kickPower","accuracy","hangTime","directional","coffeeCorner","netPunt","pinPoint","insideThe20"],
      MENTAL:["consistency","awareness","clutch","confidence","fieldSense"],
      SPECIAL:["coverage","weatherResist"]}}
};
var RATING_LABELS={
  arm:"ARM",accuracy:"ACC",awareness:"AWR",speed:"SPD",toughness:"TGH",
  throwOnRun:"TOR",shortAccuracy:"SAC",deepAccuracy:"DAC",release:"REL",pocketPresence:"PKT",
  acceleration:"ACL",agility:"AGI",strength:"STR",stamina:"STA",clutch:"CLT",
  leadership:"LDR",scramble:"SCR",playRecognition:"PRE",decisionSpeed:"DCS",fieldVision:"FVS",
  power:"PWR",elusiveness:"ELU",catching:"CTH",blocking:"BLK",
  ballCarrierVision:"BCV",breakTackle:"BTK",stiffArm:"SFA",truckPower:"TRK",routeRunning:"RTE",
  passProtection:"PPR",durability:"DUR",changeOfDirection:"COD",
  jumping:"JMP",catchInTraffic:"CIT",spectacularCatch:"SPC",shortRoute:"SRT",deepRoute:"DRT",
  separation:"SEP",yacAbility:"YAC",runBlocking:"RBK",
  impactBlocking:"IMP",passBlock:"PBK",runBlock:"RBL",
  pullBlock:"PUL",footwork:"FTW",handTechnique:"HND",anchorStrength:"ANC",
  runBlockFinesse:"RBF",passBlockFinesse:"PBF",assignmentIQ:"AIQ",
  passRush:"PRS",runStop:"RST",powerMoves:"PMV",finesseMoves:"FMV",bullRush:"BUL",
  handUsage:"HUS",blockShedding:"BSH",pursuit:"PUR",motorEffort:"MOT",tackling:"TKL",
  tackle:"TKL",coverage:"COV",zoneCoverage:"ZCV",manCoverage:"MCV",hitPower:"HIT",
  ballSkills:"BSK",pressAbility:"PRA",catchup:"CUP",breakOnBall:"BOB",discipline:"DSC",
  rangeAbility:"RNG",runSupport:"RSP",
  kickPower:"KPW",consistency:"CON",confidence:"CNF",shortRange:"SRG",medRange:"MRG",
  longRange:"LRG",direction:"DIR",hangTime:"HNG",touchback:"TBK",onsideKick:"ONS",
  weatherResist:"WTH",fieldGoalIQ:"FIQ",iceVeins:"ICE",
  directional:"DIR",coffeeCorner:"CFC",netPunt:"NET",pinPoint:"PIN",fieldSense:"FSN",insideThe20:"I20"
};
var OFF_SCHEMES=[
  {id:"spread",name:"Spread",boosts:{accuracy:8,routeRunning:6,speed:4,separation:4,deepRoute:5,shortAccuracy:3},pen:{runBlock:-4,blocking:-3,impactBlocking:-2}},
  {id:"west_coast",name:"West Coast",boosts:{accuracy:5,catching:5,awareness:4,shortRoute:5,catchInTraffic:3,playRecognition:3},pen:{speed:-2,deepRoute:-3}},
  {id:"smashmouth",name:"Smashmouth",boosts:{runBlock:8,power:6,blocking:5,truckPower:5,impactBlocking:4,anchorStrength:3},pen:{routeRunning:-4,release:-3,separation:-2}},
  {id:"pro_style",name:"Pro Style",boosts:{arm:5,awareness:5,passBlock:5,runBlock:3,catchInTraffic:3,playRecognition:3},pen:{speed:-1}},
  {id:"air_coryell",name:"Air Coryell",boosts:{arm:8,deepAccuracy:8,deepRoute:8,separation:5,release:4,speed:3},pen:{runBlock:-5,breakTackle:-2,shortRoute:-2}},
  {id:"balanced",name:"Balanced",boosts:{},pen:{}},
  {id:"pistol",name:"Pistol",boosts:{awareness:6,speed:5,catching:4,elusiveness:4,arm:3},pen:{runBlock:-3,blocking:-2}},
  {id:"heavy_jumbo",name:"Heavy Jumbo",boosts:{runBlock:9,impactBlocking:6,power:6,truckPower:5,toughness:4},pen:{routeRunning:-6,separation:-5,speed:-4,release:-3}}
];
var DEF_SCHEMES=[
  {id:"4-3",name:"4-3",boosts:{passRush:4,tackle:3,powerMoves:3,pursuit:2},pen:{}},
  {id:"3-4",name:"3-4",boosts:{coverage:3,passRush:3,tackle:3,zoneCoverage:3,blockShedding:2},pen:{}},
  {id:"multiple_d",name:"Multiple D",boosts:{coverage:4,playRecognition:4,awareness:4,passRush:2,speed:2},pen:{runStop:-2,tackle:-1}},
  {id:"nickel",name:"Nickel",boosts:{coverage:6,ballSkills:4,manCoverage:4,breakOnBall:3},pen:{runStop:-4,tackle:-2,runSupport:-3}},
  {id:"bear_46",name:"46 Bear",boosts:{runStop:9,passRush:6,tackle:5,powerMoves:4,pursuit:3,manCoverage:5,press:4},pen:{zoneCoverage:-6,coverage:-4,rangeAbility:-3}}
];
var OFF_PLANS=[
  {id:"balanced_o",name:"Balanced",icon:"âš–ï¸",desc:"No weaknesses, no major strengths. Safe.",rb:0,pm:0,tempoMod:0,bigPlayMod:0},
  {id:"air_raid",name:"Air Raid",icon:"âœˆï¸",desc:"Spread 'em out, throw early & often. Needs elite QB+WR.",rb:-0.18,pm:10,tempoMod:0,bigPlayMod:0.03},
  {id:"ground_pound",name:"Ground & Pound",icon:"ðŸƒ",desc:"Run it down their throat. Control the clock.",rb:0.18,pm:-6,tempoMod:-1,bigPlayMod:-0.02},
  {id:"west_coast",name:"West Coast",icon:"ðŸŽ¯",desc:"Short passes, high completion. Death by a thousand cuts.",rb:-0.05,pm:4,tempoMod:0,bigPlayMod:-0.04},
  {id:"play_action",name:"Play Action",icon:"ðŸŽ­",desc:"Fake the run, bomb it deep. Needs credible run game.",rb:0.05,pm:3,tempoMod:0,bigPlayMod:0.06},
  {id:"hurry_up",name:"Hurry Up",icon:"â©",desc:"No-huddle tempo. More possessions but defense tires.",rb:-0.08,pm:5,tempoMod:2,bigPlayMod:0.01}
];
var DEF_PLANS=[
  {id:"balanced_d",name:"Balanced D",icon:"ðŸ›¡ï¸",desc:"Sound fundamentals. No glaring weakness.",blitz:0,covMod:0,runStopMod:0,bigPlayRisk:0},
  {id:"blitz_heavy",name:"Blitz Heavy",icon:"ðŸ”¥",desc:"Bring pressure every play. Feast or famine.",blitz:0.18,covMod:-4,runStopMod:2,bigPlayRisk:0.06},
  {id:"zone_cov",name:"Zone Coverage",icon:"ðŸŒ",desc:"Blanket the field. Limits big plays, gives up underneath.",blitz:-0.04,covMod:4,runStopMod:-2,bigPlayRisk:-0.05},
  {id:"man_press",name:"Man Press",icon:"ðŸ‘¤",desc:"Lock 'em up at the line. CB-dependent â€” elite or bust.",blitz:0.04,covMod:6,runStopMod:-3,bigPlayRisk:0.03},
  {id:"run_stuff",name:"Run Stuff",icon:"ðŸ§±",desc:"Stack the box. Shut down the run, dare them to throw.",blitz:0.06,covMod:-6,runStopMod:8,bigPlayRisk:0.02},
  {id:"prevent",name:"Prevent",icon:"ðŸ°",desc:"Protect the lead. No big plays, but they'll march.",blitz:-0.08,covMod:8,runStopMod:-4,bigPlayRisk:-0.08}
];
var SCHEME_COUNTERS={
  air_raid:    {balanced_d:0,blitz_heavy:4,zone_cov:-3,man_press:1,run_stuff:6,prevent:-5},
  ground_pound:{balanced_d:1,blitz_heavy:5,zone_cov:1,man_press:3,run_stuff:-7,prevent:6},
  balanced_o:  {balanced_d:0,blitz_heavy:1,zone_cov:0,man_press:0,run_stuff:0,prevent:0},
  west_coast:  {balanced_d:1,blitz_heavy:5,zone_cov:-4,man_press:-2,run_stuff:3,prevent:1},
  play_action: {balanced_d:2,blitz_heavy:-1,zone_cov:5,man_press:-2,run_stuff:6,prevent:-3},
  hurry_up:    {balanced_d:2,blitz_heavy:3,zone_cov:-2,man_press:1,run_stuff:1,prevent:-1},
  pistol:      {balanced_d:1,blitz_heavy:2,zone_cov:0,man_press:1,run_stuff:-2,prevent:3},// RPO shreds light boxes, struggles vs loaded fronts
  heavy_jumbo: {balanced_d:2,blitz_heavy:1,zone_cov:2,man_press:3,run_stuff:-5,prevent:4},// battering ram vs soft looks; stuffed by heavy fronts
  smashmouth:  {balanced_d:1,blitz_heavy:-2,zone_cov:1,man_press:2,run_stuff:-3,prevent:4,bear_46:-4},
  spread:      {balanced_d:1,blitz_heavy:3,zone_cov:-2,man_press:0,run_stuff:5,prevent:-4,bear_46:4},
  air_coryell: {balanced_d:0,blitz_heavy:2,zone_cov:-4,man_press:2,run_stuff:5,prevent:-6,bear_46:3}
};
var SCHEME_FX={
  air_raid:{
    blitz_heavy:{passMod:3,rushMod:-2,blitzAdj:-0.04,covAdj:0,bigPlayAdj:0.03,turnoverAdj:0.01},// quick pass beats blitz but risky
    zone_cov:{passMod:-2,rushMod:0,blitzAdj:0,covAdj:2,bigPlayAdj:-0.03,turnoverAdj:0},// zones clog windows
    man_press:{passMod:1,rushMod:-1,blitzAdj:0,covAdj:0,bigPlayAdj:0.04,turnoverAdj:0.015},// feast or famine vs man
    run_stuff:{passMod:4,rushMod:-3,blitzAdj:0,covAdj:-3,bigPlayAdj:0.05,turnoverAdj:-0.01},// secondary exposed
    prevent:{passMod:-3,rushMod:0,blitzAdj:0,covAdj:4,bigPlayAdj:-0.06,turnoverAdj:-0.01}// deep zones wall it off
  },
  ground_pound:{
    blitz_heavy:{passMod:-1,rushMod:4,blitzAdj:-0.06,covAdj:0,bigPlayAdj:0.02,turnoverAdj:-0.01},// open lanes
    zone_cov:{passMod:0,rushMod:1,blitzAdj:0,covAdj:0,bigPlayAdj:0,turnoverAdj:0},// slight edge
    man_press:{passMod:0,rushMod:2,blitzAdj:0,covAdj:0,bigPlayAdj:0.01,turnoverAdj:0},// lighter box
    run_stuff:{passMod:1,rushMod:-5,blitzAdj:0.02,covAdj:0,bigPlayAdj:-0.03,turnoverAdj:0.01},// brick wall
    prevent:{passMod:0,rushMod:5,blitzAdj:0,covAdj:0,bigPlayAdj:0.01,turnoverAdj:-0.01}// run at will
  },
  west_coast:{
    blitz_heavy:{passMod:4,rushMod:0,blitzAdj:-0.06,covAdj:0,bigPlayAdj:0.01,turnoverAdj:-0.01},// hot routes destroy blitz
    zone_cov:{passMod:-3,rushMod:0,blitzAdj:0,covAdj:2,bigPlayAdj:-0.02,turnoverAdj:0.01},// zones clog short game
    man_press:{passMod:-1,rushMod:0,blitzAdj:0,covAdj:1,bigPlayAdj:-0.01,turnoverAdj:0.01},// timing disrupted
    run_stuff:{passMod:2,rushMod:-1,blitzAdj:0,covAdj:-2,bigPlayAdj:0.02,turnoverAdj:0},// pass over the top
    prevent:{passMod:1,rushMod:0,blitzAdj:0,covAdj:0,bigPlayAdj:-0.03,turnoverAdj:-0.01}// dink and dunk works
  },
  play_action:{
    blitz_heavy:{passMod:-1,rushMod:0,blitzAdj:0,covAdj:0,bigPlayAdj:0,turnoverAdj:0.02},// blitzers don't bite on PA
    zone_cov:{passMod:3,rushMod:1,blitzAdj:0,covAdj:-2,bigPlayAdj:0.05,turnoverAdj:-0.01},// LBs suck up on PA, windows open
    man_press:{passMod:-1,rushMod:0,blitzAdj:0,covAdj:1,bigPlayAdj:-0.01,turnoverAdj:0.01},// man doesn't bite
    run_stuff:{passMod:4,rushMod:-2,blitzAdj:0,covAdj:-3,bigPlayAdj:0.06,turnoverAdj:-0.01},// LBs in box bite HARD on PA
    prevent:{passMod:-2,rushMod:1,blitzAdj:0,covAdj:2,bigPlayAdj:-0.04,turnoverAdj:0}// safeties stay deep, PA irrelevant
  },
  hurry_up:{
    blitz_heavy:{passMod:2,rushMod:0,blitzAdj:-0.04,covAdj:0,bigPlayAdj:0.02,turnoverAdj:0},// tempo disrupts blitz packages
    zone_cov:{passMod:-1,rushMod:0,blitzAdj:0,covAdj:1,bigPlayAdj:-0.01,turnoverAdj:0},// zone stays disciplined
    man_press:{passMod:1,rushMod:0,blitzAdj:0,covAdj:-1,bigPlayAdj:0.01,turnoverAdj:0},// tempo tires man coverage
    run_stuff:{passMod:1,rushMod:0,blitzAdj:0,covAdj:0,bigPlayAdj:0,turnoverAdj:0},// slight mismatch
    prevent:{passMod:0,rushMod:0,blitzAdj:0,covAdj:0,bigPlayAdj:-0.01,turnoverAdj:0}// both conservative
  }
};
var SCHEME_FLAVOR={
  spread:      {offense:"A wide-open attack built on spacing and explosive playmaking.",defense:"They want to spread you thin and find the crease.",switch:"The offense opens up. Spacing and timing are the new currency.",alert:"Spread fit is slipping â€” route timing and separation need attention."},
  west_coast:  {offense:"Short, precise passing that turns checkdowns into chunk gains.",defense:"They will nickel-and-dime you to death if you let them.",switch:"The system demands precision. Every route must hit on time.",alert:"West Coast rhythm is off â€” quick-game accuracy and awareness are lagging."},
  smashmouth:  {offense:"Power running at its purest â€” run it until they quit.",defense:"A meat-grinder offense. They will try to bully the line of scrimmage.",switch:"The identity shifts to physical domination. The trenches decide everything.",alert:"The run identity is breaking down â€” the O-line fit is deteriorating."},
  pro_style:   {offense:"A complete, balanced attack â€” runs when needed, passes to win.",defense:"They have answers for everything. No easy preparation.",switch:"The playbook expands. This scheme rewards football IQ over athleticism.",alert:"Pro Style execution is inconsistent â€” mental processing and awareness are lagging."},
  air_coryell: {offense:"Vertical assault â€” push every safety back and attack the deep thirds.",defense:"They want to take the top off your defense on every play.",switch:"The deep ball becomes the identity. Big arm, big plays, big risks.",alert:"The vertical game is stalling â€” arm talent and deep route execution need work."},
  balanced:    {offense:"No tendencies, no weaknesses â€” disciplined football.",defense:"A balanced attack offers no easy adjustments.",switch:"The system neutralizes weaknesses. Stability over specialization.",alert:"Even a balanced scheme needs buy-in â€” identity scores are drifting."},
  pistol:      {offense:"Versatile read-option attack â€” the defense must account for the QB's legs.",defense:"They can hand it off, keep it, or throw. One defender is always wrong.",switch:"The quarterback becomes a weapon in the run game. Creativity replaces rote execution.",alert:"The read-option is leaking â€” dual-threat processing and RB catching are below threshold."},
  heavy_jumbo: {offense:"Two tight ends, a punishing back, and the will to run it down your throat.",defense:"They want to physically impose their will. Lighter boxes will get eaten alive.",switch:"The offense becomes a battering ram. Skill position flash gives way to trench dominance.",alert:"Jumbo identity is eroding â€” blocking grades and physical fit are declining."},
  "4-3":       {offense:"Four down linemen and three linebackers â€” the classic pro base.",defense:"Sound fundamentals. Strong against the run and reliable in coverage.",switch:"A proven foundation. Fits the majority of personnel groupings.",alert:"The 4-3 base is breaking down â€” front-seven fit and pursuit grades are slipping."},
  "3-4":       {offense:"Three down, four linebackers â€” versatility is the weapon.",defense:"Edge pressure from multiple angles. Hard to protect against.",switch:"The defense gains unpredictability. Pass rush comes from everywhere.",alert:"3-4 fit is degrading â€” OLB pass rush and LB coverage grades need reinforcement."},
  multiple_d:  {offense:"Multiple fronts and coverage shells â€” answers for every offensive tendency.",defense:"They can show you anything. No pre-snap reads are safe.",switch:"The defense gains chess-match complexity. Players must process quickly.",alert:"Multiple D demands football IQ â€” awareness and recognition scores are falling."},
  nickel:      {offense:"Six defensive backs â€” pure pass defense, run stop sacrificed.",defense:"They trust the secondary to win. One extra DB for one fewer run stopper.",switch:"Speed replaces size in the secondary. The run game will find openings.",alert:"Nickel coverage grades are declining â€” ball skills and man coverage need work."},
  bear_46:     {offense:"Eight men near the line â€” maximum pressure, maximum gamble.",defense:"The most physically dominant defensive scheme. Forces the offense to execute fast.",switch:"The defense goes to war. Corners are on islands. Front seven must wreck the backfield.",alert:"46 Bear execution is failing â€” run stopping and pass rush grades are below standard."}
};
function getSchemeFlavorLine(schemeId,context){
  var f=SCHEME_FLAVOR[schemeId];
  if(!f)return "";
  return f[context||"offense"]||f.offense||"";
}
var GAMEPLANS=[
  {id:"balanced",name:"Balanced",icon:"âš–ï¸",rb:0,pm:0,blitz:0},
  {id:"air_raid",name:"Air Raid",icon:"âœˆï¸",rb:-0.15,pm:8,blitz:0},
  {id:"ground_pound",name:"Ground & Pound",icon:"ðŸƒ",rb:0.15,pm:-5,blitz:0},
  {id:"blitz_heavy",name:"Blitz Heavy",icon:"ðŸ”¥",rb:0,pm:0,blitz:0.12},
  {id:"prevent",name:"Prevent",icon:"ðŸ›¡ï¸",rb:0,pm:-4,blitz:-0.08},
  {id:"clock_killer",name:"Clock Killer",icon:"â±ï¸",rb:0.2,pm:-8,blitz:0}
];
var GP_COUNTERS={
  air_raid:{prevent:6,balanced:1,blitz_heavy:-5},
  ground_pound:{blitz_heavy:5,balanced:1,prevent:-3},
  blitz_heavy:{air_raid:5,balanced:2,ground_pound:-5},
  balanced:{balanced:0,air_raid:-1,ground_pound:-1},
  prevent:{ground_pound:3,clock_killer:2,air_raid:-6},
  clock_killer:{prevent:3,balanced:1,blitz_heavy:-4}
};
var HOME_FIELD_ADV=3;// Points added to home team scoring modifier
var RIVALRY_NAMES=[
  "The {city1}-{city2} War","The {shared_trait} Bloodline","The {city1} Grudge Match",
  "{city2} Hate Week","Battle of the {shared_trait}","{winner_city} Supremacy",
  "The {loser_city} Revenge Tour","The {abbr1}-{abbr2} Border Brawl",
  "The Sunday Night Vendetta","The {shared_trait} Showdown",
  "{city1} vs {city2}: No Peace","The {year} Score to Settle"
];
function _findRivalObj(team,oppId){
  if(!team)return null;if(!team.rivals)team.rivals=[];
  for(var i=0;i<team.rivals.length;i++){if(team.rivals[i]&&team.rivals[i].teamId===oppId)return team.rivals[i];}
  return null;
}
function _ensureRivalObj(team,oppTeam){
  if(!team.rivals)team.rivals=[];var r=_findRivalObj(team,oppTeam.id);if(r)return r;
  r={teamId:oppTeam.id,heat:0,history:{wins:0,losses:0,playoffMeetings:0,lastResult:null,streak:0},origin:"emergent",name:null,trophy977:null};
  team.rivals.push(r);return r;
}
function getRivalryLabel(heat){
  var h=heat||0;
  if(h<20)return{tier:"none",label:null,emoji:""};
  if(h<40)return{tier:"budding",label:"Growing Rivalry",emoji:"ðŸ”¥"};
  if(h<60)return{tier:"heated",label:"Rivalry Game",emoji:"ðŸ”¥"};
  if(h<80)return{tier:"intense",label:"Bitter Rivals",emoji:"ðŸ”¥ðŸ”¥"};
  return{tier:"war",label:"Blood Feud",emoji:"ðŸ”¥ðŸ”¥ðŸ”¥"};
}
function _sharedTrait(c1,c2){
  var a=(c1||"").toLowerCase(),b=(c2||"").toLowerCase();
  if(a.indexOf("new")===0||b.indexOf("new")===0)return"New World";
  if(a.indexOf("san ")===0||b.indexOf("san ")===0)return"Coast";
  if(a.indexOf("lake")>=0||b.indexOf("lake")>=0)return"Lakes";
  if(a.indexOf("city")>=0||b.indexOf("city")>=0)return"Cities";
  return pick(["Plains","Rust","Coast","Heartland","Bay","Mountains","Desert","River","Capitals"]);
}
function generateRivalryName(t1,t2,rivalry,year){
  var t=pick(RIVALRY_NAMES);var c1=t1.city||t1.abbr,c2=t2.city||t2.abbr;
  var winC=c1,losC=c2;
  if(rivalry&&rivalry.history&&rivalry.history.streak<0){winC=c2;losC=c1;}
  t=t.replace(/\{city1\}/g,c1).replace(/\{city2\}/g,c2).replace(/\{abbr1\}/g,t1.abbr||"").replace(/\{abbr2\}/g,t2.abbr||"");
  t=t.replace(/\{shared_trait\}/g,_sharedTrait(c1,c2)).replace(/\{winner_city\}/g,winC).replace(/\{loser_city\}/g,losC).replace(/\{year\}/g,""+(year||2026));
  return t;
}
function getRivalryBonus(hTeam,aTeam){
  if(!hTeam||!aTeam)return{moodSwing:0,injuryMod:0,crowdMod:0,label:null,heat:0};
  var r=_findRivalObj(hTeam,aTeam.id);var heat=r?(r.heat||0):0;var tier=getRivalryLabel(heat);
  if(tier.tier==="budding")return{moodSwing:4,injuryMod:0,crowdMod:1,label:tier.label,heat:heat};
  if(tier.tier==="heated")return{moodSwing:6,injuryMod:0.03,crowdMod:2,label:tier.label+" "+tier.emoji,heat:heat};
  if(tier.tier==="intense")return{moodSwing:8,injuryMod:0.05,crowdMod:3,label:tier.label+" "+tier.emoji,heat:heat};
  if(tier.tier==="war")return{moodSwing:12,injuryMod:0.08,crowdMod:5,label:tier.label+" "+tier.emoji,heat:heat};
  return{moodSwing:0,injuryMod:0,crowdMod:0,label:null,heat:heat};
}
function _applyHeat(rival,delta){rival.heat=cl((rival.heat||0)+delta,0,100);}
function updateRivalries(teams,hTeamId,aTeamId,result,isPlayoff,year,week){
  var h=teams.find(function(t){return t.id===hTeamId;}),a=teams.find(function(t){return t.id===aTeamId;});
  if(!h||!a)return;
  var rh=_ensureRivalObj(h,a),ra=_ensureRivalObj(a,h);
  if(isPlayoff){
    if(rh.origin==="emergent")rh.origin="playoff";if(ra.origin==="emergent")ra.origin="playoff";
    rh.history.playoffMeetings=(rh.history.playoffMeetings||0)+1;
    ra.history.playoffMeetings=(ra.history.playoffMeetings||0)+1;
  }
  _applyHeat(rh,3);_applyHeat(ra,3);
  applyLeagueAlignment97(h);applyLeagueAlignment97(a);
  if(h.divId&&a.divId&&h.divId===a.divId){
    _applyHeat(rh,5);_applyHeat(ra,5);
    rh.origin="division";ra.origin="division";
  }
  var hs=result?result.home||0:0,as=result?result.away||0:0,margin=Math.abs(hs-as);
  var homeWon=hs>as,awayWon=as>hs;
  if(margin>0&&margin<=3){_applyHeat(rh,8);_applyHeat(ra,8);if(rh.origin==="emergent"){rh.origin="heartbreak";ra.origin="heartbreak";}}
  else if(margin>0&&margin<=7){_applyHeat(rh,5);_applyHeat(ra,5);}
  if(margin>=21){if(homeWon){_applyHeat(rh,4);_applyHeat(ra,6);}else if(awayWon){_applyHeat(ra,4);_applyHeat(rh,6);}}
  if(isPlayoff){_applyHeat(rh,15);_applyHeat(ra,15);
    if(result&&result.isElim){if(homeWon)_applyHeat(ra,20);else if(awayWon)_applyHeat(rh,20);}
  }
  if(homeWon){rh.history.wins++;ra.history.losses++;rh.history.lastResult="W";ra.history.lastResult="L";
    rh.history.streak=rh.history.streak>=0?rh.history.streak+1:1;ra.history.streak=ra.history.streak<=0?ra.history.streak-1:-1;
  }else if(awayWon){ra.history.wins++;rh.history.losses++;ra.history.lastResult="W";rh.history.lastResult="L";
    ra.history.streak=ra.history.streak>=0?ra.history.streak+1:1;rh.history.streak=rh.history.streak<=0?rh.history.streak-1:-1;
  }
  if(rh.history.streak<=-3)_applyHeat(rh,10);
  if(ra.history.streak<=-3)_applyHeat(ra,10);
  if((rh.heat||0)>=60&&!rh.name)rh.name=generateRivalryName(h,a,rh,year);
  if((ra.heat||0)>=60&&!ra.name)ra.name=rh.name||generateRivalryName(a,h,ra,year);
  // v97.7: Trophy creation and update
  if((rh.heat||0)>=60&&!rh.trophy977){rh.trophy977=RIVALRY_TROPHIES977.generateTrophy(h,a);rh.trophy977.created=year;}
  if(rh.trophy977&&result){var tw977=homeWon?hTeamId:awayWon?aTeamId:null;if(tw977)RIVALRY_TROPHIES977.updateTrophy(rh.trophy977,tw977,year,week||0,(hs||0)+"-"+(as||0));}
  if(ra&&rh.trophy977)ra.trophy977=rh.trophy977;
}
function decayRivalries(teams){
  teams.forEach(function(t){if(!t.rivals)return;
    t.rivals.forEach(function(r){r.heat=cl((r.heat||0)-3,0,100);});
    t.rivals=t.rivals.filter(function(r){return r.heat>0;});
  });
}
// v97.7 GLOBAL CONSTANTS â€” THE ATMOSPHERE UPDATE
var RIVALRY_TROPHIES977={
  templates:[
    {name:"The {city1}-{city2} Cup",icon:"ðŸ†",tier:"gold"},
    {name:"The {shared} Bell",icon:"ðŸ””",tier:"silver"},
    {name:"The Iron Boot",icon:"ðŸ¥¾",tier:"bronze"},
    {name:"The Founders Trophy",icon:"ðŸ›ï¸",tier:"gold"},
    {name:"The {city1} Axe",icon:"ðŸª“",tier:"silver"},
    {name:"The Border War Shield",icon:"ðŸ›¡ï¸",tier:"bronze"},
    {name:"The Eternal Flame",icon:"ðŸ”¥",tier:"gold"},
    {name:"The Old Grudge Hammer",icon:"ðŸ”¨",tier:"silver"}
  ],
  generateTrophy:function(t1,t2){
    var tmpl=RIVALRY_TROPHIES977.templates[Math.floor(RNG.ui()*RIVALRY_TROPHIES977.templates.length)];
    var name=tmpl.name.replace("{city1}",t1.city||t1.abbr).replace("{city2}",t2.city||t2.abbr).replace("{shared}",_sharedTrait(t1.city,t2.city));
    return{name:name,icon:tmpl.icon,tier:tmpl.tier,holderId:null,created:null,history:[]};
  },
  updateTrophy:function(trophy,winnerId,year,week,score){
    var changed=trophy.holderId!==winnerId;
    trophy.holderId=winnerId;
    trophy.history.push({year:year,week:week,winnerId:winnerId,score:score});
    return changed;
  }
};
var RIVALRY_WEEK977={
  getAtmosphere:function(myTeam,oppTeam,rivalObj,week){
    if(!rivalObj||(rivalObj.heat||0)<40)return null;
    var tier=getRivalryLabel(rivalObj.heat);
    var trophy=rivalObj.trophy977||null;
    var atmo={tier:tier.tier,label:rivalObj.name||(tier.label+": "+myTeam.abbr+" vs "+oppTeam.abbr),emoji:tier.emoji,trophy:trophy,hypeLines:[],effects:{moraleBoost:0,chemBoost:0,crowdBoost:0,injuryRisk:0}};
    if(tier.tier==="war"){atmo.hypeLines.push("ðŸ”¥ðŸ”¥ðŸ”¥ BLOOD FEUD WEEK â€” The entire league is watching.");atmo.effects.moraleBoost=5;atmo.effects.crowdBoost=5;atmo.effects.injuryRisk=0.08;}
    else if(tier.tier==="intense"){atmo.hypeLines.push("ðŸ”¥ðŸ”¥ RIVALRY WEEK â€” Circle this one on the calendar.");atmo.effects.moraleBoost=3;atmo.effects.crowdBoost=3;atmo.effects.injuryRisk=0.05;}
    else{atmo.hypeLines.push("ðŸ”¥ Growing rivalry â€” this matchup is starting to mean something.");atmo.effects.moraleBoost=2;atmo.effects.crowdBoost=1;}
    if(trophy&&trophy.holderId){var holdsIt=trophy.holderId===myTeam.id;atmo.hypeLines.push(trophy.icon+(holdsIt?" You hold "+trophy.name+". Defend it.":" "+oppTeam.abbr+" holds "+trophy.name+". Time to take it back."));}
    var streak=(rivalObj.history||{}).streak||0;
    if(streak>=3)atmo.hypeLines.push("ðŸ“ˆ You've won "+streak+" straight in this rivalry.");
    if(streak<=-3)atmo.hypeLines.push("ðŸ“‰ You've lost "+Math.abs(streak)+" straight. Enough is enough.");
    return atmo;
  }
};
var PREGAME_TALK977={
  generate:function(myTeam,oppTeam,season,rivalryAtmo,isPlayoff){
    var speeches=[];
    speeches.push({id:"motivate",label:"ðŸ”¥ Fire Them Up",text:"This is OUR house! Let's come out swinging and punch them in the mouth!",effect:{moraleBoost:3,chemBoost:1,turnoverRisk:0.02},desc:"+3 morale, +1 chem, slight turnover risk"});
    speeches.push({id:"focus",label:"ðŸ§  Lock In",text:"Forget the noise. Execute the game plan. Trust your preparation.",effect:{moraleBoost:1,chemBoost:2,turnoverRisk:-0.02},desc:"+1 morale, +2 chem, fewer turnovers"});
    speeches.push({id:"personal",label:"ðŸ’ª Make It Personal",text:"They don't respect us. They don't think we belong here. Prove. Them. Wrong.",effect:{moraleBoost:4,chemBoost:-1,injuryRisk:0.02},desc:"+4 morale, -1 chem, slight injury risk"});
    if(rivalryAtmo&&rivalryAtmo.tier!=="none"&&rivalryAtmo.tier!=="budding"){speeches.push({id:"rivalry",label:rivalryAtmo.emoji+" Rivalry Speech",text:"This game is bigger than a W. This is about pride. About history. About WHO WE ARE.",effect:{moraleBoost:5,chemBoost:3,turnoverRisk:0.01},desc:"+5 morale, +3 chem â€” rivalry intensity"});}
    else if(isPlayoff){speeches.push({id:"playoff",label:"ðŸ† Championship Mentality",text:"We didn't come this far to come this far. Leave everything on that field.",effect:{moraleBoost:5,chemBoost:2},desc:"+5 morale, +2 chem"});}
    else if((myTeam.losses||0)>(myTeam.wins||0)){speeches.push({id:"desperation",label:"ðŸ˜¤ Back Against the Wall",text:"Our season is slipping away. Every man in this room needs to decide: are we done or are we fighters?",effect:{moraleBoost:4,chemBoost:2,clutchBoost:0.05},desc:"+4 morale, +2 chem, clutch boost"});}
    return speeches;
  }
};
var HALFTIME_PANEL977={
  generate:function(margin){
    var adjustments=[];
    adjustments.push({id:"stay_course",label:"ðŸ“‹ Stay the Course",text:margin>=0?"We're executing well. Keep doing what got us here.":"We're close. Trust the process.",effect:{scoringMod:0,turnoverMod:-0.01},desc:"No changes â€” steady play, fewer mistakes"});
    adjustments.push({id:"attack",label:"âš¡ Open It Up",text:"We're going aggressive. Take shots downfield. Put pressure on their secondary.",effect:{scoringMod:0.08,turnoverMod:0.04},desc:"+scoring chance, +turnover risk"});
    adjustments.push({id:"grind",label:"ðŸƒ Control the Clock",text:"Run the ball. Chew clock. Win the time of possession battle.",effect:{scoringMod:-0.03,turnoverMod:-0.03,clockMod:0.1},desc:"Ball control, fewer turnovers, shorter game"});
    if(margin<=-14){adjustments.push({id:"desperation",label:"ðŸš¨ Desperation Mode",text:"Empty the playbook. Onside kicks, trick plays, everything. We have nothing to lose.",effect:{scoringMod:0.15,turnoverMod:0.10},desc:"Maximum aggression â€” feast or famine"});}
    else if(margin>=14){adjustments.push({id:"prevent",label:"ðŸ›¡ï¸ Protect the Lead",text:"Sit on the ball. Protect the football. Don't give them life.",effect:{scoringMod:-0.05,turnoverMod:-0.05},desc:"Conservative â€” lock it down"});}
    else{adjustments.push({id:"two_minute",label:"â±ï¸ Two-Minute Specialist",text:"We need points before half AND to start the 3rd quarter. Manage the clock perfectly.",effect:{scoringMod:0.05,clutchMod:0.03},desc:"Efficient drive management"});}
    // v98.6 #1: HALFTIME V2 â€” Additional Tactical Options
    adjustments.push({id:"blitz_heavy_986",label:"ðŸ”¥ Blitz Heavy",text:"Bring the house every play. Get to their QB. Force mistakes.",effect:{scoringMod:0.03,turnoverMod:0.06,clutchMod:0.02},desc:"Sack/INT chance UP, risk deep passes"});
    adjustments.push({id:"no_huddle_986",label:"âš¡ No-Huddle Tempo",text:"Speed it up. Don't let them substitute. We control the pace.",effect:{scoringMod:0.10,turnoverMod:0.05,clockMod:-0.1},desc:"High-octane scoring, fatigue risk"});
    adjustments.push({id:"target_mismatch_986",label:"ðŸŽ¯ Exploit Mismatch",text:"We found a mismatch underneath. Feed the WR2 and TE.",effect:{scoringMod:0.06,turnoverMod:-0.02},desc:"Safe completions, move chains"});
    return adjustments;
  }
};
var POSTGAME_LOCKER977={
  generate:function(userWon,myScore,oppScore,myTeam,isRivalry){
    var margin=Math.abs((myScore||0)-(oppScore||0));var blowout=margin>=21;var nailbiter=margin<=3;
    var mood=userWon?(blowout?"euphoric":nailbiter?"relieved":"satisfied"):(blowout?"devastated":nailbiter?"gutted":"disappointed");
    var locker=[];
    var starters=(myTeam&&myTeam.roster)?myTeam.roster.filter(function(p){return p.isStarter;}):[];
    if(starters.length>0){
      var star=starters.slice().sort(function(a,b){return(b.ovr||0)-(a.ovr||0);})[0];
      if(userWon){
        locker.push({player:star.name,pos:star.pos,quote:blowout?"We were LOCKED IN from the first snap!":nailbiter?"I've never been more nervous. But this team... we just find a way.":"Great team win. Everybody did their job."});
        if(isRivalry)locker.push({player:star.name,pos:star.pos,quote:"That trophy is OURS. They can come get it if they want it back."});
      }else{
        locker.push({player:star.name,pos:star.pos,quote:blowout?"I don't even know what to say. We weren't ready.":nailbiter?"That one stings. We had it. We HAD it.":"We'll be back. This team doesn't quit."});
      }
      var young=starters.filter(function(p){return p.age<=24&&p.id!==star.id;})[0];
      if(young)locker.push({player:young.name,pos:young.pos,quote:userWon?"The vets told me what this would feel like. It's even better than they said.":"I'm going to remember this feeling. Use it."});
    }
    return{mood:mood,locker:locker};
  }
};
var GAME_OF_WEEK977={
  pick:function(sched,teams,week,myId){
    var weekGames=sched.filter(function(g){return g.week===week&&!g.played;});
    if(weekGames.length===0)return null;
    var scored=weekGames.map(function(g){
      var h=teams.find(function(t){return t.id===g.home;}),a=teams.find(function(t){return t.id===g.away;});
      if(!h||!a)return{game:g,score:0,home:null,away:null};
      var rivalHeat=0;var rObj=_findRivalObj(h,a.id);if(rObj)rivalHeat=rObj.heat||0;
      var isUser=g.home===myId||g.away===myId;
      return{game:g,home:h,away:a,score:(h.wins||0)*2+(a.wins||0)*2+rivalHeat*0.5+(isUser?20:0)+((h.prestige||50)+(a.prestige||50))*0.1};
    });
    scored.sort(function(a,b){return b.score-a.score;});
    var gotw=scored[0];if(!gotw||!gotw.home)return null;
    return{home:gotw.home,away:gotw.away,isUser:gotw.game.home===myId||gotw.game.away===myId,label:"ðŸ“º GAME OF THE WEEK: "+gotw.home.icon+gotw.home.abbr+" vs "+gotw.away.icon+gotw.away.abbr,effects:{attendanceBoost:0.15,moraleBoost:2,revenueBoost:3}};
  }
};
function buildRivalryDashboard977(myTeam,teams){
  if(!myTeam||!myTeam.rivals)return{active:[],trophies:[]};
  var active=myTeam.rivals.filter(function(r){return(r.heat||0)>=20;}).sort(function(a,b){return(b.heat||0)-(a.heat||0);}).map(function(r){
    var opp=teams.find(function(t){return t.id===r.teamId;});
    return{rival:r,opp:opp,tier:getRivalryLabel(r.heat),h2h:r.history||{wins:0,losses:0,streak:0},trophy:r.trophy977||null,holdsTrophy:r.trophy977?r.trophy977.holderId===myTeam.id:false};
  });
  var trophies=active.filter(function(a){return a.holdsTrophy;});
  return{active:active,trophies:trophies};
}
var OWNER_GOAL_TEMPLATES=[
  {id:"win_title",label:"Win the Championship",forGoal:"title",reward:{ownerMood:12,cash:8},penalty:{ownerMood:-18}},
  {id:"win_division",label:"Win Your Division",forGoal:"title",reward:{ownerMood:8,cash:4},penalty:{ownerMood:-10}},
  {id:"make_playoffs",label:"Make the Playoffs",forGoal:"playoff",reward:{ownerMood:10,cash:5},penalty:{ownerMood:-15}},
  {id:"sell_tickets",label:"Average 90%+ Attendance",forGoal:"playoff",reward:{ownerMood:7,cash:6},penalty:{ownerMood:-8}},
  {id:"no_blowouts",label:"No Losses by 21+",forGoal:"playoff",reward:{ownerMood:6},penalty:{ownerMood:-10}},
  {id:"develop_youth",label:"Start 3+ Players Under 25",forGoal:"rebuild",reward:{ownerMood:8},penalty:{ownerMood:-10}},
  {id:"stay_solvent",label:"Finish Cash-Positive",forGoal:"rebuild",reward:{ownerMood:6,cash:6},penalty:{ownerMood:-12}}
];
var COACH_GOAL_TEMPLATES=[
  {id:"top10_offense",label:"Finish Top-10 in Scoring",reward:{coachDev:2,morale:4},penalty:{coachDev:-2}},
  {id:"top10_defense",label:"Finish Top-10 in Scoring Defense",reward:{coachDev:2,morale:4},penalty:{coachDev:-2}},
  {id:"develop_rookie",label:"Rookie Starter Reaches 75+ OVR",reward:{coachDev:2,morale:3},penalty:{coachDev:-1}},
  {id:"win_streak_5",label:"Win 5 Games in a Row",reward:{morale:6},penalty:{morale:-2}},
  {id:"no_shutouts",label:"Never Get Shut Out",reward:{morale:3},penalty:{morale:-3}}
];
var PLAYER_GOAL_TEMPLATES=[
  {id:"3500_pass",label:"3,500 Passing Yards",pos:["QB"],stat:"passYds",target:3500,compare:"gte",reward:{morale:8,devBoost:1},penalty:{morale:-3}},
  {id:"24_td",label:"24 Touchdown Passes",pos:["QB"],stat:"passTD",target:24,compare:"gte",reward:{morale:8,devBoost:1},penalty:{morale:-3}},
  {id:"low_int",label:"Under 12 Interceptions",pos:["QB"],stat:"int",target:12,compare:"lte",reward:{morale:6},penalty:{morale:-3}},
  {id:"800_rush",label:"800 Rushing Yards",pos:["RB"],stat:"rushYds",target:800,compare:"gte",reward:{morale:8,devBoost:1},penalty:{morale:-3}},
  {id:"7_rush_td",label:"7 Rushing Touchdowns",pos:["RB"],stat:"rushTD",target:7,compare:"gte",reward:{morale:7},penalty:{morale:-3}},
  {id:"700_rec",label:"700 Receiving Yards",pos:["WR","TE"],stat:"recYds",target:700,compare:"gte",reward:{morale:8,devBoost:1},penalty:{morale:-3}},
  {id:"55_rec",label:"55 Receptions",pos:["WR","TE"],stat:"rec",target:55,compare:"gte",reward:{morale:6},penalty:{morale:-3}},
  {id:"7_sacks",label:"7 Sack Season",pos:["DL","LB"],stat:"sacks",target:7,compare:"gte",reward:{morale:7,devBoost:1},penalty:{morale:-3}},
  {id:"3_int",label:"3 Interceptions",pos:["CB","S"],stat:"defINT",target:3,compare:"gte",reward:{morale:7},penalty:{morale:-3}},
  {id:"75_tackles",label:"75 Tackles",pos:["LB","S"],stat:"tackles",target:75,compare:"gte",reward:{morale:6},penalty:{morale:-3}},
  {id:"83pct_fg",label:"83% FG Accuracy",pos:["K"],stat:"fgPct",target:83,compare:"gte",reward:{morale:6},penalty:{morale:-3}}
];
function _cloneGoal(t){
  return{id:t.id,label:t.label,stat:t.stat||null,target:typeof t.target==="number"?t.target:null,
    compare:t.compare||"gte",reward:t.reward||{},penalty:t.penalty||{},status:"active",current:0};
}
function generateSeasonGoals(team){
  var ownerType=(team&&team.ownerGoal)?team.ownerGoal:"playoff";
  var ownerPool=OWNER_GOAL_TEMPLATES.filter(function(g){return g.forGoal===ownerType;});
  if(!ownerPool.length)ownerPool=OWNER_GOAL_TEMPLATES.slice();
  var ownerGoals=[];var oc=rng(1,2);
  for(var i=0;i<oc&&ownerPool.length;i++){var idx=rng(0,ownerPool.length-1);ownerGoals.push(_cloneGoal(ownerPool[idx]));ownerPool.splice(idx,1);}
  var coachPool=COACH_GOAL_TEMPLATES.slice();var coachGoals=[];var cc=rng(1,2);
  for(var j=0;j<cc&&coachPool.length;j++){var jx=rng(0,coachPool.length-1);coachGoals.push(_cloneGoal(coachPool[jx]));coachPool.splice(jx,1);}
  return{ownerGoals:ownerGoals,coachGoals:coachGoals};
}
function generatePlayerGoals(team){
  var out=[];if(!team||!team.roster)return out;
  var eligible=team.roster.filter(function(p){
    return (p.ovr>=78)||(p.devTrait&&p.devTrait!=="normal");
  }).sort(function(a,b){return b.ovr-a.ovr;}).slice(0,8);
  eligible.forEach(function(p){
    var pool=PLAYER_GOAL_TEMPLATES.filter(function(t){
      for(var i=0;i<t.pos.length;i++){if(t.pos[i]==="ALL"||t.pos[i]===p.pos)return true;}return false;
    });
    if(!pool.length)return;
    var chosen=pool[rng(0,pool.length-1)];
    out.push({playerId:p.id,playerName:p.name,pos:p.pos,goal:_cloneGoal(chosen)});
  });
  return out;
}
function _getGoalStat(p,stat){
  if(!p||!p.stats)return 0;
  if(stat==="fgPct"){var a=p.stats.fgA||0;return a<=0?0:Math.round((p.stats.fgM||0)/a*100);}
  return p.stats[stat]||0;
}
function updateGoalProgress(team,playerGoals){
  var newly=[];if(!team||!playerGoals)return newly;
  playerGoals.forEach(function(pg){
    if(!pg||!pg.goal||pg.goal.status!=="active")return;
    var p=team.roster.find(function(x){return x.id===pg.playerId;});if(!p)return;
    pg.goal.current=_getGoalStat(p,pg.goal.stat);
    var met=pg.goal.compare==="lte"?pg.goal.current<=pg.goal.target:pg.goal.current>=pg.goal.target;
    if(met){pg.goal.status="completed";newly.push({goalId:pg.goal.id,playerId:pg.playerId,playerName:pg.playerName,label:pg.goal.label});}
  });
  return newly;
}
function evaluateGoals(team,allTeams,ownerGoals,coachGoals,playerGoals,tracking){
  var completed=[],failed=[],rewards={},penalties={};
  var tr=tracking||{};
  function _sum(target,src,mult){if(!src)return;for(var k in src){if(src.hasOwnProperty(k)&&typeof src[k]==="number"){target[k]=(target[k]||0)+src[k]*(mult||1);}}}
  (ownerGoals||[]).forEach(function(og){
    if(og.status!=="active")return;var ok=false;
    if(og.id==="win_title")ok=!!tr.isChamp;
    else if(og.id==="make_playoffs")ok=!!tr.madePlayoffs;
    else if(og.id==="win_division"){
      if(typeof DIV_STANDINGS!=="undefined"&&DIV_STANDINGS&&typeof DIV_STANDINGS.getDivisions==="function"){
        DIV_STANDINGS.getDivisions(allTeams||[]);
      }
      ok=team._divRank76===1;
    }
    else if(og.id==="no_blowouts")ok=(tr.blowoutLosses||0)===0;
    else if(og.id==="sell_tickets")ok=(team.attendance||0)>=((team.facilities?team.facilities.stad||0:0)*900*0.9);
    else if(og.id==="develop_youth")ok=team.roster.filter(function(p){return p.isStarter&&p.age<=25;}).length>=3;
    else if(og.id==="stay_solvent")ok=(team.cash||0)>0;
    if(ok){og.status="completed";completed.push({layer:"owner",id:og.id,label:og.label});_sum(rewards,og.reward);}
    else{og.status="failed";failed.push({layer:"owner",id:og.id,label:og.label});_sum(penalties,og.penalty);}
  });
  (coachGoals||[]).forEach(function(cg){
    if(cg.status!=="active")return;var ok=false;
    var pfRank=allTeams.slice().sort(function(a,b){return b.pf-a.pf;}).findIndex(function(t){return t.id===team.id;})+1;
    var paRank=allTeams.slice().sort(function(a,b){return a.pa-b.pa;}).findIndex(function(t){return t.id===team.id;})+1;
    if(cg.id==="top10_offense")ok=pfRank<=10;
    else if(cg.id==="top10_defense")ok=paRank<=10;
    else if(cg.id==="develop_rookie")ok=team.roster.some(function(p){return p.isStarter&&p.age<=23&&p.ovr>=75;});
    else if(cg.id==="win_streak_5")ok=(tr.bestWinStreak||0)>=5;
    else if(cg.id==="no_shutouts")ok=(tr.shutoutLosses||0)===0;
    if(ok){cg.status="completed";completed.push({layer:"coach",id:cg.id,label:cg.label});_sum(rewards,cg.reward);}
    else{cg.status="failed";failed.push({layer:"coach",id:cg.id,label:cg.label});_sum(penalties,cg.penalty);}
  });
  (playerGoals||[]).forEach(function(pg){
    var g=pg.goal;if(!g)return;
    if(g.status==="completed"){completed.push({layer:"player",id:g.id,label:g.label,playerName:pg.playerName});_sum(rewards,g.reward);}
    else{var met=g.compare==="lte"?g.current<=g.target:g.current>=g.target;
      if(met){g.status="completed";completed.push({layer:"player",id:g.id,label:g.label,playerName:pg.playerName});_sum(rewards,g.reward);}
      else{g.status="failed";failed.push({layer:"player",id:g.id,label:g.label,playerName:pg.playerName});_sum(penalties,g.penalty);}
    }
  });
  return{completed:completed,failed:failed,rewards:rewards,penalties:penalties};
}
var SCHEME_FIT={
  spread:{
    QB:{key:["accuracy","speed","awareness"],wt:[40,30,20]},
    RB:{key:["speed","catching","elusiveness"],wt:[35,35,20]},
    WR:{key:["routeRunning","speed","catching"],wt:[35,30,25]},
    TE:{key:["catching","routeRunning","speed"],wt:[40,30,20]},
    OL:{key:["passBlock","awareness"],wt:[60,30]}
  },
  west_coast:{
    QB:{key:["accuracy","awareness","arm"],wt:[45,30,15]},
    RB:{key:["catching","elusiveness","speed"],wt:[40,30,20]},
    WR:{key:["catching","routeRunning","awareness"],wt:[35,35,20]},
    TE:{key:["catching","blocking","routeRunning"],wt:[35,35,20]},
    OL:{key:["passBlock","runBlock","awareness"],wt:[35,30,25]}
  },
  smashmouth:{
    QB:{key:["awareness","toughness","arm"],wt:[40,30,20]},
    RB:{key:["power","speed","elusiveness"],wt:[45,25,20]},
    WR:{key:["catching","awareness","speed"],wt:[35,30,25]},
    TE:{key:["blocking","toughness","catching"],wt:[45,30,15]},
    OL:{key:["runBlock","strength","toughness"],wt:[45,30,15]}
  },
  pro_style:{
    QB:{key:["arm","awareness","accuracy"],wt:[40,30,20]},
    RB:{key:["power","catching","awareness"],wt:[35,30,25]},
    WR:{key:["catching","routeRunning","awareness"],wt:[35,30,25]},
    TE:{key:["blocking","catching","awareness"],wt:[35,35,20]},
    OL:{key:["passBlock","runBlock","awareness"],wt:[40,30,20]}
  },
  air_coryell:{
    QB:{key:["arm","deepAccuracy","awareness"],wt:[45,35,10]},
    RB:{key:["speed","catching","awareness"],wt:[40,30,20]},
    WR:{key:["deepRoute","speed","separation"],wt:[45,35,10]},
    TE:{key:["deepRoute","catching","speed"],wt:[40,35,15]},
    OL:{key:["passBlock","awareness","strength"],wt:[45,30,15]}
  },
  balanced:{
    QB:{key:["accuracy","awareness","arm"],wt:[30,30,30]},
    RB:{key:["speed","power","catching"],wt:[30,30,30]},
    WR:{key:["catching","routeRunning","speed"],wt:[30,30,30]},
    TE:{key:["catching","blocking","routeRunning"],wt:[30,30,30]},
    OL:{key:["passBlock","runBlock","strength"],wt:[30,30,30]}
  },
  pistol:{
    QB:{key:["speed","awareness","accuracy"],wt:[35,35,20]},
    RB:{key:["catching","speed","elusiveness"],wt:[40,35,15]},
    WR:{key:["speed","separation","routeRunning"],wt:[35,30,25]},
    TE:{key:["catching","speed","awareness"],wt:[35,30,25]},
    OL:{key:["passBlock","awareness","speed"],wt:[40,30,20]}
  },
  heavy_jumbo:{
    QB:{key:["awareness","toughness","arm"],wt:[35,30,25]},
    RB:{key:["power","breakTackle","truckPower"],wt:[45,30,15]},
    WR:{key:["catching","toughness","blocking"],wt:[35,30,25]},
    TE:{key:["blocking","impactBlocking","toughness"],wt:[50,30,10]},
    OL:{key:["runBlock","strength","impactBlocking"],wt:[50,30,10]}
  },
  "4-3":{
    DL:{key:["passRush","speed","strength"],wt:[40,30,20]},
    LB:{key:["tackle","coverage","speed"],wt:[35,30,25]},
    CB:{key:["coverage","speed","ballSkills"],wt:[35,30,25]},
    S:{key:["coverage","speed","tackling"],wt:[35,30,25]}
  },
  "3-4":{
    DL:{key:["runStop","strength","toughness"],wt:[40,35,15]},
    LB:{key:["passRush","speed","tackle"],wt:[35,30,25]},
    CB:{key:["coverage","awareness","ballSkills"],wt:[35,30,25]},
    S:{key:["tackling","coverage","awareness"],wt:[35,30,25]}
  },
  multiple_d:{
    DL:{key:["passRush","runStop","speed"],wt:[35,35,20]},
    LB:{key:["coverage","speed","awareness"],wt:[40,30,20]},
    CB:{key:["manCoverage","coverage","speed"],wt:[40,30,20]},
    S:{key:["coverage","awareness","rangeAbility"],wt:[40,30,20]}
  },
  nickel:{
    DL:{key:["passRush","speed","strength"],wt:[40,30,20]},
    LB:{key:["coverage","speed","awareness"],wt:[40,30,20]},
    CB:{key:["coverage","ballSkills","speed"],wt:[40,30,20]},
    S:{key:["coverage","ballSkills","awareness"],wt:[40,30,20]}
  },
  bear_46:{
    DL:{key:["passRush","runStop","strength"],wt:[40,35,15]},
    LB:{key:["tackle","runStop","passRush"],wt:[45,35,10]},
    CB:{key:["manCoverage","press","toughness"],wt:[50,30,10]},// CBs on islands â€” pure man press
    S:{key:["tackling","runSupport","awareness"],wt:[45,35,10]}// Safeties in the box â€” run first
  }
};
function calcSchemeFit(player,schemeId){
  if(!player||!schemeId)return{score:50,grade:"C",label:"Average",boost:0};
  var profile=SCHEME_FIT[schemeId]&&SCHEME_FIT[schemeId][player.pos];
  if(!profile){var b=player.ovr||50;return{score:b,grade:b>=85?"A":b>=75?"B":b>=65?"C":"D",label:"Neutral",boost:0};}
  var sum=0,tw=0;
  for(var i=0;i<profile.key.length;i++){
    var v=player.ratings?(player.ratings[profile.key[i]]||50):50;
    var w=profile.wt[i]||10;sum+=v*w;tw+=w;
  }
  var s=tw>0?Math.round(sum/tw):50;s=cl(s,1,99);
  var grade=s>=92?"A+":s>=85?"A":s>=78?"B+":s>=72?"B":s>=65?"C+":s>=58?"C":s>=50?"D":"F";
  var boost=s>=92?4:s>=85?3:s>=78?1:s>=65?0:s>=50?-1:-3;
  var label=s>=85?"Perfect Fit":s>=72?"Good Fit":s>=58?"Ok Fit":"Poor Fit";
  return{score:s,grade:grade,label:label,boost:boost};
}
function fitTierFromScore(score){
  return score>=90?"ELITE":score>=80?"STRONG":score>=68?"SOLID":score>=56?"FRINGE":"POOR";
}
function getPlayerSide(pos){
  if(["QB","RB","WR","TE","OL"].indexOf(pos)>=0)return"off";
  if(["DL","LB","CB","S"].indexOf(pos)>=0)return"def";
  return"other";
}
function calcSpecialtyFitAdj(team,player,side){
  if(!team||!player||(side!=="off"&&side!=="def"))return 0;
  var spec=getSpecialtyBonus(team,side);
  if(!spec||!spec.id)return 0;
  var pos=player.pos,adj=0;
  if(side==="off"){
    if(spec.id==="run_guru"){
      if(pos==="RB")adj+=6;
      else if(pos==="OL"||pos==="TE")adj+=4;
      else if(pos==="QB")adj+=1;
    }else if(spec.id==="pass_arch"){
      if(pos==="QB")adj+=6;
      else if(pos==="WR"||pos==="TE")adj+=4;
      else if(pos==="OL")adj+=2;
    }else if(spec.id==="rz_spec"){
      if(["QB","RB","WR","TE"].indexOf(pos)>=0)adj+=3;
      else if(pos==="OL")adj+=1;
    }else if(spec.id==="tempo"){
      adj+=(player.ratings&&(player.ratings.stamina||50)>=70)?3:1;
    }else if(spec.id==="play_action"){
      if(pos==="QB")adj+=4;
      else if(pos==="RB"||pos==="WR"||pos==="TE")adj+=3;
      else if(pos==="OL")adj+=1;
    }
  }else if(side==="def"){
    if(spec.id==="blitz_des"){
      if(pos==="DL"||pos==="LB")adj+=5;
      else if(pos==="CB"||pos==="S")adj+=1;
    }else if(spec.id==="cov_spec"){
      if(pos==="CB"||pos==="S")adj+=5;
      else if(pos==="LB")adj+=2;
    }else if(spec.id==="run_stop"){
      if(pos==="DL"||pos==="LB")adj+=5;
      else if(pos==="S")adj+=1;
    }else if(spec.id==="turnover"){
      if(pos==="CB"||pos==="S")adj+=4;
      else if(pos==="LB"||pos==="DL")adj+=2;
    }else if(spec.id==="situational"){
      if(pos==="LB"||pos==="S"||pos==="CB")adj+=3;
      else if(pos==="DL")adj+=2;
    }
  }
  return cl(adj,-8,8);
}
function calcPersonalityFitAdj(player,team){
  if(!player)return 0;
  var pers=getPersonality(player);
  var workS=traitScalar(pers.workEthic);
  var loyalS=traitScalar(pers.loyalty);
  var greedS=traitScalar(pers.greed);
  var ambS=traitScalar(pers.ambition);
  var adj=workS*4+ambS*2-Math.max(0,greedS)*2;
  if(team&&player.formerTeam&&player.formerTeam===team.id)adj+=Math.max(0,loyalS)*2.5;
  else adj+=loyalS*1.2;
  if(player.holdout75&&pers.greed>=7)adj-=3;
  return cl(Math.round(adj),-8,8);
}
function calcPlayerIdentityFit(player,team,offScheme,defScheme){
  if(!player)return{score:50,letter:"C",tier:"SOLID",baseScore:50,specialtyAdj:0,personalityAdj:0,systemAdj:0,totalAdj:0,side:"other",schemeId:"",schemeLabel:"Neutral",specialtyId:"",specialtyLabel:""};
  var side=getPlayerSide(player.pos);
  var schemeId=side==="off"?(offScheme||(team&&team.schemeOff)||"balanced"):side==="def"?(defScheme||(team&&team.schemeDef)||"4-3"):"";
  var base=side==="other"?(player.ovr||50):calcSchemeFit(player,schemeId).score;
  var specialtyAdj=calcSpecialtyFitAdj(team,player,side);
  var personalityAdj=calcPersonalityFitAdj(player,team);
  var systemAdj=(player.systemFit===undefined||player.systemFit===null)?0:Math.round((player.systemFit-50)/10);
  systemAdj=cl(systemAdj,-6,6);
  var totalAdj=cl(specialtyAdj+personalityAdj+systemAdj,-12,12);
  var score=cl(base+totalAdj,20,99);
  var letter=score>=90?"A":score>=80?"B":score>=65?"C":score>=50?"D":"F";
  var spec=(side==="off"||side==="def")?(getSpecialtyBonus(team,side)||{}):{};
  var scDef=OFF_SCHEMES.concat(DEF_SCHEMES).find(function(s){return s.id===schemeId;})||{};
  return{score:score,letter:letter,tier:fitTierFromScore(score),
    baseScore:base,specialtyAdj:specialtyAdj,personalityAdj:personalityAdj,systemAdj:systemAdj,totalAdj:totalAdj,
    side:side,schemeId:schemeId,schemeLabel:scDef.name||schemeId||"Neutral",specialtyId:spec.id||"",specialtyLabel:spec.label||""};
}
function calcTeamFit(team){
  if(!team||!team.roster)return{off:0,def:0,total:0,fits:{A:0,B:0,C:0,D:0,F:0}};
  var oS=0,oC=0,dS=0,dC=0,fits={A:0,B:0,C:0,D:0,F:0};
  team.roster.forEach(function(p){
    var side=getPlayerSide(p.pos);
    var isOff=side==="off";
    var isDef=side==="def";
    if(!isOff&&!isDef)return;
    var fit=calcPlayerIdentityFit(p,team);
    if(isOff){oS+=fit.score;oC++;}else{dS+=fit.score;dC++;}
    var gl=fit.letter.charAt(0);if(fits.hasOwnProperty(gl))fits[gl]++;else if(gl==="F")fits.F++;
  });
  return{off:oC?Math.round(oS/oC):0,def:dC?Math.round(dS/dC):0,
    total:(oC+dC)?Math.round((oS+dS)/(oC+dC)):0,fits:fits};
}
function getTeamPlayerFitScore86(team,player){
  return calcPlayerIdentityFit(player,team).score;
}
function runFitInvariantChecks(team){
  if(!team||!team.roster)return{ok:true,issues:[]};
  var issues=[];var badCount=0;
  team.roster.forEach(function(p){
    var fit=calcPlayerIdentityFit(p,team);
    if(fit.score<20||fit.score>99){badCount++;issues.push("score("+p.name+")="+fit.score);}
    if(fit.totalAdj<-12||fit.totalAdj>12){badCount++;issues.push("adj("+p.name+")="+fit.totalAdj);}
  });
  return{ok:badCount===0,issues:issues.slice(0,5),count:badCount};
}
function assertFitInvariants(team,source){
  var check=runFitInvariantChecks(team);
  if(!check.ok&&typeof console!=="undefined"&&console.warn){
    console.warn("[FIT86]["+(source||"unknown")+"]",check.issues.join("; "));
  }
}
function getSchemeMismatchWarnings(team){
  var w=[];if(!team||!team.roster)return w;
  team.roster.forEach(function(p){
    if(!p.isStarter)return;
    if(getPlayerSide(p.pos)==="other")return;
    var fit=calcPlayerIdentityFit(p,team);
    if(fit.score<65)w.push({player:p,grade:fit.letter,score:fit.score,scheme:fit.schemeId});
  });
  return w.sort(function(a,b){return a.score-b.score;});
}
var FIT_GROUP_DEFS=[
  {id:"qb",label:"QB",side:"off",pos:["QB"]},
  {id:"rb",label:"RB",side:"off",pos:["RB"]},
  {id:"wrte",label:"WR/TE",side:"off",pos:["WR","TE"]},
  {id:"ol",label:"OL",side:"off",pos:["OL"]},
  {id:"dl",label:"DL",side:"def",pos:["DL"]},
  {id:"lb",label:"LB",side:"def",pos:["LB"]},
  {id:"db",label:"DB",side:"def",pos:["CB","S"]}
];
function normalizeFitAlertPref85(pref){
  var src=pref||{};
  var sev=src.minSeverity==="high"?"high":"any";
  var sno=src.snoozeUntil;
  sno=(sno===undefined||sno===null)?null:parseInt(sno,10);
  if(!isFinite(sno))sno=null;
  var highWeek=src.highOnlyWeek;
  highWeek=(highWeek===undefined||highWeek===null)?null:parseInt(highWeek,10);
  if(!isFinite(highWeek))highWeek=null;
  return{snoozeUntil:sno,minSeverity:sev,highOnlyWeek:highWeek};
}
function profilePref85(profileId,wk){
  var week=wk||1;
  if(profileId==="balanced")return{snoozeUntil:null,minSeverity:"any",highOnlyWeek:7};
  if(profileId==="minimal")return{snoozeUntil:week+3,minSeverity:"high",highOnlyWeek:null};
  return{snoozeUntil:null,minSeverity:"any",highOnlyWeek:null};
}
function detectFitAlertProfile85(team,wk){
  if(!team)return"strict";
  var week=wk||1;
  var prefs=team.fitAlertPrefs84||{};
  var ids=["strict","balanced","minimal"];
  for(var i=0;i<ids.length;i++){
    var pid=ids[i],ok=true;
    for(var g=0;g<FIT_GROUP_DEFS.length;g++){
      var gid=FIT_GROUP_DEFS[g].id;
      var pref=normalizeFitAlertPref85(prefs[gid]);
      if(pid==="strict"){
        if(pref.minSeverity!=="any"||pref.highOnlyWeek!==null||(pref.snoozeUntil!==null&&pref.snoozeUntil>week)){ok=false;break;}
      }else if(pid==="balanced"){
        if(pref.minSeverity!=="any"||pref.highOnlyWeek!==7||(pref.snoozeUntil!==null&&pref.snoozeUntil>week)){ok=false;break;}
      }else{
        if(pref.minSeverity!=="high"||pref.highOnlyWeek!==null){ok=false;break;}
      }
    }
    if(ok)return pid;
  }
  return"custom";
}
var FIT_GROUP_ALERT_HINTS86={
  qb:{needs:["QB","OL","WR"],note:"Passing timing and pocket integrity are slipping.",focus:"scout"},
  rb:{needs:["RB","OL","TE"],note:"Run identity cohesion is fading.",focus:"pads"},
  wrte:{needs:["WR","TE","QB"],note:"Route spacing and timing are off.",focus:"scout"},
  ol:{needs:["OL"],note:"Protection/assignment busts are compounding.",focus:"scout"},
  dl:{needs:["DL","LB"],note:"Front disruption is flattening out.",focus:"pads"},
  lb:{needs:["LB","DL","S"],note:"Second-level fits are late.",focus:"scout"},
  db:{needs:["CB","S","DL"],note:"Coverage communication is leaking explosives.",focus:"scout"}
};
function fitPlayerKey(player){
  if(!player)return"";
  if(player.id!==undefined&&player.id!==null)return String(player.id);
  return(player.name||"unknown")+"|"+(player.pos||"");
}
function recommendPracticeFocusFromFitReport(report){
  if(!report)return null;
  var sumSys=0,sumPers=0;
  (report.groupDeltas||[]).forEach(function(g){
    sumSys+=(g.sysDelta||0);
    sumPers+=(g.persDelta||0);
  });
  var recId="scout";
  var why="Neutral week. Scout prep keeps assignment cohesion high.";
  if(report.prevAvg===null){
    recId="scout";
    why="Baseline week. Install and assignment reps build a clean trend line.";
  }else if(report.avgDelta<=-2){
    if(sumSys<=-2){
      recId="scout";
      why="System knowledge slipped. Opponent Scout is the fastest recovery path.";
    }else if(sumPers<=-2){
      recId="recovery";
      why="Personality/chemistry drag is showing. Recovery week can stabilize morale.";
    }else{
      recId="scout";
      why="Overall fit dipped. Reinforce install before pushing development.";
    }
  }else if(report.avgDelta>=2){
    recId="pads";
    why="Fit momentum is positive. Full Pads can convert it into development gains.";
  }else if(sumPers<0){
    recId="recovery";
    why="Minor locker-room friction detected. Recovery helps hold the floor.";
  }
  var pf=(typeof PRACTICE_FOCUS!=="undefined"&&PRACTICE_FOCUS)?PRACTICE_FOCUS.find(function(p){return p.id===recId;}):null;
  return{id:recId,label:pf?pf.label:recId,why:why};
}
function buildIdentityFitSnapshot(team,offSchemeOverride,defSchemeOverride){
  if(!team||!team.roster)return{players:{},groups:[],avgScore:0,count:0};
  var players={};var totalScore=0;var totalCount=0;
  team.roster.forEach(function(p){
    var side=getPlayerSide(p.pos);
    if(side!=="off"&&side!=="def")return;
    var fit=calcPlayerIdentityFit(p,team,offSchemeOverride,defSchemeOverride);
    players[fitPlayerKey(p)]={id:p.id||fitPlayerKey(p),name:p.name,pos:p.pos,
      score:fit.score,baseScore:fit.baseScore,specialtyAdj:fit.specialtyAdj,
      personalityAdj:fit.personalityAdj,systemAdj:fit.systemAdj,totalAdj:fit.totalAdj,side:side};
    totalScore+=fit.score;totalCount++;
  });
  var groups=FIT_GROUP_DEFS.map(function(g){
    var pool=team.roster.filter(function(p){return g.pos.indexOf(p.pos)>=0;});
    var sample=pool.filter(function(p){return p.isStarter;});
    if(sample.length===0)sample=pool;
    var gScore=0,gBase=0,gSpec=0,gPers=0,gSys=0;
    sample.forEach(function(p){
      var fp=players[fitPlayerKey(p)];
      if(!fp)return;
      gScore+=fp.score;gBase+=fp.baseScore;gSpec+=fp.specialtyAdj;gPers+=fp.personalityAdj;gSys+=fp.systemAdj;
    });
    var cnt=sample.length;
    return{id:g.id,label:g.label,side:g.side,count:cnt,rosterCount:pool.length,
      avgScore:cnt?Math.round(gScore/cnt):0,avgBase:cnt?Math.round(gBase/cnt):0,
      avgSpec:cnt?Math.round(gSpec/cnt):0,avgPers:cnt?Math.round(gPers/cnt):0,avgSys:cnt?Math.round(gSys/cnt):0};
  });
  return{players:players,groups:groups,avgScore:totalCount?Math.round(totalScore/totalCount):0,count:totalCount};
}
function buildFitGroupRiskAlerts(team,groupDeltas,wk){
  if(!team)return[];
  var streaks=team.fitRiskStreak86||{};
  var alertPrefs=team.fitAlertPrefs84||{};
  var alerts=[];
  groupDeltas.forEach(function(g){
    if((g.count||0)<=0)return;
    var low=(g.current||0)<=62;
    streaks[g.id]=low?((streaks[g.id]||0)+1):0;
    if(!low||streaks[g.id]<2)return;
    var severe=(g.current||0)<=56||(g.delta||0)<=-4||(g.sysDelta||0)<=-3;
    var shouldAlert=streaks[g.id]===2||severe||(streaks[g.id]%3===0);
    if(!shouldAlert)return;
    var pref=normalizeFitAlertPref85(alertPrefs[g.id]||{});
    if(pref.snoozeUntil!==null&&wk<pref.snoozeUntil)return;
    var effMinSev=pref.minSeverity;
    if(pref.highOnlyWeek!==null&&wk>=pref.highOnlyWeek)effMinSev="high";
    if(effMinSev==="high"&&!severe)return;
    var hint=FIT_GROUP_ALERT_HINTS86[g.id]||{needs:[g.label],note:"Fit erosion detected.",focus:"scout"};
    alerts.push({id:g.id,label:g.label,current:g.current||0,delta:g.delta||0,streak:streaks[g.id],
      severity:severe?"high":"med",needs:hint.needs||[],note:hint.note||"",focus:hint.focus||"scout",week:wk});
  });
  team.fitRiskStreak86=streaks;
  return alerts;
}
function buildWeeklyFitReport(team,wk){
  if(!team||!team.roster)return null;
  var snapshot=buildIdentityFitSnapshot(team,team.schemeOff,team.schemeDef);
  var prev=team.fitWeeklyBaseline86||null;
  var risers=[];var fallers=[];var playerChanges=[];var netDelta=0;var tracked=0;var changed=0;
  if(prev&&prev.players){
    team.roster.forEach(function(p){
      var side=getPlayerSide(p.pos);if(side!=="off"&&side!=="def")return;
      var key=fitPlayerKey(p);var cur=snapshot.players[key];var old=prev.players[key];
      if(!cur||!old)return;
      var delta=cur.score-old.score;
      tracked++;netDelta+=delta;
      var row={id:p.id||key,name:p.name,pos:p.pos,delta:delta,from:old.score,to:cur.score,
        specDelta:cur.specialtyAdj-old.specialtyAdj,persDelta:cur.personalityAdj-old.personalityAdj,
        sysDelta:cur.systemAdj-old.systemAdj,baseDelta:cur.baseScore-old.baseScore,side:side};
      playerChanges.push(row);
      if(delta>0){risers.push(row);changed++;}
      else if(delta<0){fallers.push(row);changed++;}
    });
    risers.sort(function(a,b){return b.delta-a.delta;});
    fallers.sort(function(a,b){return a.delta-b.delta;});
  }
  playerChanges.sort(function(a,b){
    var ad=Math.abs(a.delta||0),bd=Math.abs(b.delta||0);
    if(bd!==ad)return bd-ad;
    return String(a.name||"").localeCompare(String(b.name||""));
  });
  var riseCount=risers.length,fallCount=fallers.length;
  var prevAvg=(prev&&prev.avgScore!==undefined&&prev.avgScore!==null)?prev.avgScore:null;
  var prevGroupMap={};
  if(prev&&prev.groups&&prev.groups.length){
    prev.groups.forEach(function(g){prevGroupMap[g.id]=g;});
  }
  var groupDeltas=snapshot.groups.map(function(g){
    var pg=prevGroupMap[g.id];
    return{id:g.id,label:g.label,count:g.count,current:g.avgScore,previous:pg?(pg.avgScore||0):null,
      currentSpec:g.avgSpec,currentPers:g.avgPers,currentSys:g.avgSys,
      previousSpec:pg?(pg.avgSpec||0):null,previousPers:pg?(pg.avgPers||0):null,previousSys:pg?(pg.avgSys||0):null,
      delta:pg?(g.avgScore-(pg.avgScore||0)):0,
      specDelta:pg?(g.avgSpec-(pg.avgSpec||0)):0,
      persDelta:pg?(g.avgPers-(pg.avgPers||0)):0,
      sysDelta:pg?(g.avgSys-(pg.avgSys||0)):0};
  });
  groupDeltas.sort(function(a,b){return Math.abs(b.delta)-Math.abs(a.delta);});
  var groupAlerts=buildFitGroupRiskAlerts(team,groupDeltas,wk);
  var report={week:wk,avgFit:snapshot.avgScore,prevAvg:prevAvg,avgDelta:prevAvg===null?0:(snapshot.avgScore-prevAvg),
    trackedPlayers:tracked,changedPlayers:changed,riseCount:riseCount,fallCount:fallCount,netDelta:netDelta,
    risers:risers.slice(0,3),fallers:fallers.slice(0,3),groupDeltas:groupDeltas,playerChanges:playerChanges,groupAlerts:groupAlerts};
  report.recommendation=recommendPracticeFocusFromFitReport(report);
  var trend=(team.fitTrend86||[]).slice();
  if(team.fitTrendWeek86!==wk||trend.length===0)trend.push(snapshot.avgScore);
  if(trend.length>18)trend=trend.slice(-18);
  team.fitTrend86=trend;
  team.fitTrendWeek86=wk;
  report.trend=trend.slice();
  team.fitWeeklyBaseline86={week:wk,avgScore:snapshot.avgScore,players:snapshot.players,groups:snapshot.groups};
  return report;
}
var STORY_BEATS86={
  fit_resurrection:{id:"fit_resurrection",icon:"ðŸ”¥",color:"gold",
    inbox:"[Name] RESURGENCE â€” Scheme adjustment unlocks true potential.",
    ticker:"[Name] thriving in new tactical identity.",
    toast:"[Name]'s scheme fit turned around.",
    presserQ:"Coach, [Name] looks like a completely different player. What changed?",
    presserOpts:["We finally put him in a position to succeed.","He put in the work. The scheme highlighted it.","It's just one week. We need consistency."]
  },
  hometown_hero:{id:"hometown_hero",icon:"â¤ï¸",color:"green",
    inbox:"[Name] takes hometown discount. Loyalty saves the franchise $[saved]M.",
    ticker:"[Name] leaves money on the table to stay.",
    toast:"[Name] chose home over money.",
    presserQ:"[Name] took significantly less to stay. How important is that for the culture?",
    presserOpts:["It shows we're building a brotherhood here.","It's great, but it's a business at the end of the day.","He knows this is his best chance at a ring."]
  },
  holdout_saga:{id:"holdout_saga",icon:"ðŸ’°",color:"orange",
    inbox:"[Name] holdout escalating. Camp demands market-resetting money.",
    ticker:"[Name] absent from facility amid contract dispute.",
    toast:"[Name] is holding out for top dollar.",
    presserQ:"The holdout with [Name] is becoming a distraction. Are you going to pay him?",
    presserOpts:["We are working internally to resolve this quickly.","No single player is bigger than the team.","We won't negotiate through the media."]
  },
  breakout_arrival:{id:"breakout_arrival",icon:"â­",color:"gold",
    inbox:"[Name] HAS ARRIVED â€” Officially enters elite tier (OVR 90+).",
    ticker:"[Name] makes the leap to superstardom this season.",
    toast:"[Name] is now recognized as elite.",
    presserQ:"We are witnessing a breakout season from [Name]. Did you expect this leap?",
    presserOpts:["We drafted him knowing he had this in him.","He's been working tirelessly behind the scenes.","Let's not crown him yet. Keep grinding."]
  },
  iron_man:{id:"iron_man",icon:"ðŸ¦¾",color:"cyan",
    inbox:"[Name] defying time. Work ethic reverses age-related decline.",
    ticker:"Veteran [Name] showing no signs of slowing down.",
    toast:"[Name] refuses to decline.",
    presserQ:"At age [age], most players regress. [Name] is actually improving. How?",
    presserOpts:["He takes care of his body better than anyone.","His football IQ makes up for losing a half-step.","We're managing his reps to keep him fresh."]
  },
  clutch_rating:{id:"clutch_rating",icon:"ðŸŽ¯",color:"gold",
    inbox:"[Name] CLUTCH GENE â€” Late-game heroics secure vital win.",
    ticker:"[Name] delivers ice-cold performance in the 4th quarter.",
    toast:"[Name] delivered when it counted.",
    presserQ:"When the game was on the line, [Name] took over. Is that something you can teach?",
    presserOpts:["Some guys just have ice in their veins.","We practice situational football every single week.","It was a great team effort, not just one guy."]
  },
  veteran_mentor:{id:"veteran_mentor",icon:"ðŸŽ“",color:"cyan",
    inbox:"MASTERCLASS: [Name]'s mentorship accelerates rookie development.",
    ticker:"Young core thriving under [Name]'s veteran leadership.",
    toast:"[Name] is passing the torch.",
    presserQ:"Your young players credit [Name] for their rapid growth. How valuable is he?",
    presserOpts:["He's like having another coach on the field.","It's his legacy. He wants to leave the room better.","Veterans are supposed to lead. He's doing his job."]
  },
  dynasty_decade:{id:"dynasty_decade",icon:"ðŸ†",color:"gold",
    inbox:"DYNASTY CEMENTED: 3 Championships in 10 years. A historic franchise.",
    ticker:"A decade of dominance secures dynasty status.",
    toast:"A true modern dynasty.",
    presserQ:"Three rings in ten years. Is it safe to call this a dynasty now?",
    presserOpts:["The results speak for themselves. We are historic.","We are only focused on winning the next one.","It's a testament to our front office and ownership."]
  },
  scheme_maestro:{id:"scheme_maestro",icon:"ðŸ§ ",color:"cyan",
    inbox:"TACTICAL IDENTITY: 5 consecutive years mastering the same scheme.",
    ticker:"The team's tactical execution reaches a state of flow.",
    toast:"Scheme mastery achieved.",
    presserQ:"You've stuck with this system for 5 years. The execution is flawless right now.",
    presserOpts:["Continuity breeds confidence. We know who we are.","We finally have the exact personnel to run it.","It doesn't matter what we run if we don't block and tackle."]
  },
  rival_showdown:{id:"rival_showdown",icon:"âš”ï¸",color:"red",
    inbox:"BAD BLOOD: 5th consecutive clash against bitter rivals. This one means everything.",
    ticker:"Security heightened as rivalry reaches boiling point.",
    toast:"This game means more.",
    presserQ:"The hatred between these two teams is palpable. Do you lean into that emotion?",
    presserOpts:["Absolutely. This is a war, and they know it.","We treat it like any other faceless opponent.","Emotion is good, but execution wins games."]
  },
  cap_genius:{id:"cap_genius",icon:"ðŸ§®",color:"cyan",
    inbox:"CAP MASTERCLASS: Playoff bound despite near-zero cap flexibility.",
    ticker:"Front office praised for building a contender on a shoestring.",
    toast:"Playoffs reached on a budget.",
    presserQ:"You navigated a brutal salary cap to make the playoffs. How did you manage it?",
    presserOpts:["We draft well and develop. That's the secret.","Our coaching staff elevated the talent we had.","It was a grind. I need a vacation."]
  },
  fan_favorite:{id:"fan_favorite",icon:"ðŸŸï¸",color:"gold",
    inbox:"CITY ICON: [Name] cements status as a beloved franchise legend.",
    ticker:"[Name]'s jersey becomes the highest-selling in the city.",
    toast:"[Name] is beloved by the fans.",
    presserQ:"The fans adore [Name]. You can barely hear yourself think when he makes a play.",
    presserOpts:["He embodies the blue-collar spirit of this city.","He earns that love by signing autographs and giving back.","The fans love winners, and he's a winner."]
  }
};
function checkStoryBeats86(team,wk){
  if(!team||!team.roster)return[];
  var items=[];
  var fitReport=team._storyFitReport87||null;
  var gameCtx=team._storyGameCtx87||null;
  if(fitReport&&fitReport.playerChanges&&fitReport.playerChanges.length){
    var fitHits=0;
    fitReport.playerChanges.forEach(function(ch){
      if(fitHits>=3)return;
      if((ch.from||0)<=55&&(ch.to||0)>=68){
        fitHits++;
        items.push({type:"story",icon:STORY_BEATS86.fit_resurrection.icon,
          text:ch.name+" RESURGENCE â€” identity fit jumped from "+ch.from+" to "+ch.to+".",
          color:STORY_BEATS86.fit_resurrection.color,id:U(),storyBeat:STORY_BEATS86.fit_resurrection.id,playerId:ch.id,week:wk,
          toast:ch.name+"'s fit turned around."});
      }
    });
  }
  team.roster.forEach(function(p){
    if((p.ovr||0)>=90&&!p.everReached90){
      p.everReached90=true;
      items.push({type:"story",icon:STORY_BEATS86.breakout_arrival.icon,
        text:p.name+" HAS ARRIVED â€” crossed OVR 90 for the first time.",
        color:STORY_BEATS86.breakout_arrival.color,id:U(),storyBeat:STORY_BEATS86.breakout_arrival.id,playerId:p.id,week:wk,
        toast:p.name+" is now elite."});
    }
  });
  if(wk===1){
    team.roster.forEach(function(p){
      var pers=getPersonality(p);
      if((p.age||0)<32||pers.workEthic<8)return;
      var hist=(p.careerStats&&p.careerStats.ovrHistory)?p.careerStats.ovrHistory:[];
      if(hist.length<4)return;
      var y3=hist[hist.length-4],y2=hist[hist.length-3],y1=hist[hist.length-2];
      var declining=(y3>y2&&y2>y1);
      var rebounded=(p.ovr||0)>y1;
      if(declining&&rebounded){
        items.push({type:"story",icon:STORY_BEATS86.iron_man.icon,
          text:p.name+", age "+p.age+", defying time. Work ethic keeping him sharp.",
          color:STORY_BEATS86.iron_man.color,id:U(),storyBeat:STORY_BEATS86.iron_man.id,playerId:p.id,week:wk,
          toast:p.name+" refuses to decline."});
      }
    });
  }
  if(gameCtx&&wk>=14&&gameCtx.won&&Math.abs(gameCtx.margin||0)<=7){
    var qb=(team.roster||[]).find(function(p){return p.pos==="QB"&&p.isStarter;});
    if(!qb)qb=(team.roster||[]).filter(function(p){return p.pos==="QB";}).sort(function(a,b){return (b.ovr||0)-(a.ovr||0);})[0];
    if(qb&&getPersonality(qb).pressure>=8){
      items.push({type:"story",icon:STORY_BEATS86.clutch_rating.icon,
        text:qb.name+" CLUTCH GENE â€” fourth-quarter hero in a win that mattered.",
        color:STORY_BEATS86.clutch_rating.color,id:U(),storyBeat:STORY_BEATS86.clutch_rating.id,playerId:qb.id,week:wk,
        toast:qb.name+" delivered when it counted."});
    }
  }
  if(wk===1){
    team.roster.forEach(function(p){
      var pers=getPersonality(p);
      if((p.age||0)<33||pers.workEthic<8)return;
      var mentorCount=(team._seasonMentorCount87&&team._seasonMentorCount87[p.id])||0;
      if(mentorCount>=2){
        items.push({type:"story",icon:STORY_BEATS86.veteran_mentor.icon,
          text:STORY_BEATS86.veteran_mentor.inbox.replace("[Name]",p.name),
          color:STORY_BEATS86.veteran_mentor.color,id:U(),storyBeat:"veteran_mentor",playerId:p.id,week:wk,
          toast:STORY_BEATS86.veteran_mentor.toast.replace("[Name]",p.name)});
      }
    });
  }
  if(wk===1){
    var dynHistory=team._champHistory87||[];
    var recentChamps=dynHistory.filter(function(yr){return(team._currentYear87||0)-yr<=10;}).length;
    if(recentChamps>=3&&!team._dynastyBeatFired87){
      team._dynastyBeatFired87=true;
      items.push({type:"story",icon:STORY_BEATS86.dynasty_decade.icon,
        text:STORY_BEATS86.dynasty_decade.inbox,
        color:STORY_BEATS86.dynasty_decade.color,id:U(),storyBeat:"dynasty_decade",week:wk,
        toast:STORY_BEATS86.dynasty_decade.toast});
    }
  }
  if(wk===1){
    var schemeStreak=team._schemeStreak87||0;
    if(schemeStreak>=5&&!team._schemeMaestroBeatFired87){
      team._schemeMaestroBeatFired87=true;
      items.push({type:"story",icon:STORY_BEATS86.scheme_maestro.icon,
        text:STORY_BEATS86.scheme_maestro.inbox,
        color:STORY_BEATS86.scheme_maestro.color,id:U(),storyBeat:"scheme_maestro",week:wk,
        toast:STORY_BEATS86.scheme_maestro.toast});
    }
  }
  if(wk>=14){
    var rivalries=team._topRival87;
    if(rivalries&&rivalries.streak>=5&&gameCtx&&gameCtx.oppId===rivalries.id){
      items.push({type:"story",icon:STORY_BEATS86.rival_showdown.icon,
        text:STORY_BEATS86.rival_showdown.inbox,
        color:STORY_BEATS86.rival_showdown.color,id:U(),storyBeat:"rival_showdown",week:wk,
        toast:STORY_BEATS86.rival_showdown.toast});
    }
  }
  if(wk>=14&&gameCtx&&gameCtx.madePlayoffs){
    var capLeft=(team.salary||0)>(team.capSpace||999)?0:(team.capSpace||0);
    if(capLeft<=3&&!team._capGeniusBeatFired87){
      team._capGeniusBeatFired87=true;
      items.push({type:"story",icon:STORY_BEATS86.cap_genius.icon,
        text:STORY_BEATS86.cap_genius.inbox,
        color:STORY_BEATS86.cap_genius.color,id:U(),storyBeat:"cap_genius",week:wk,
        toast:STORY_BEATS86.cap_genius.toast});
    }
  }
  if(Object.prototype.hasOwnProperty.call(team,"_storyFitReport87"))delete team._storyFitReport87;
  if(Object.prototype.hasOwnProperty.call(team,"_storyGameCtx87"))delete team._storyGameCtx87;
  return items;
}
function buildSchemeChangeProjection(team,side,newSchemeId){
  if(!team||!team.roster)return null;
  var currentOff=team.schemeOff||"balanced";
  var currentDef=team.schemeDef||"4-3";
  var nextOff=side==="off"?newSchemeId:currentOff;
  var nextDef=side==="def"?newSchemeId:currentDef;
  var currentSnapshot=buildIdentityFitSnapshot(team,currentOff,currentDef);
  var nextSnapshot=buildIdentityFitSnapshot(team,nextOff,nextDef);
  var posGroup=side==="off"?["QB","RB","WR","TE","OL"]:["DL","LB","CB","S"];
  var affected=team.roster.filter(function(p){return posGroup.indexOf(p.pos)>=0;});
  var avgFit=affected.length>0?Math.round(affected.reduce(function(s,p){return s+(p.systemFit||30);},0)/affected.length):30;
  var fitLoss=Math.round(avgFit*0.4);
  var groupDeltas=[];var totalCurrent=0;var totalNext=0;var totalCount=0;
  FIT_GROUP_DEFS.forEach(function(g){
    if(g.side!==side)return;
    var cur=currentSnapshot.groups.find(function(x){return x.id===g.id;})||{avgScore:0,count:0,avgSpec:0,avgPers:0,avgSys:0};
    var nxt=nextSnapshot.groups.find(function(x){return x.id===g.id;})||{avgScore:0,count:0,avgSpec:0,avgPers:0,avgSys:0};
    var cnt=nxt.count||cur.count||0;
    groupDeltas.push({id:g.id,label:g.label,count:cnt,current:cur.avgScore,next:nxt.avgScore,delta:nxt.avgScore-cur.avgScore,
      specDelta:nxt.avgSpec-cur.avgSpec,persDelta:nxt.avgPers-cur.avgPers,sysDelta:nxt.avgSys-cur.avgSys});
    totalCurrent+=cur.avgScore*cnt;totalNext+=nxt.avgScore*cnt;totalCount+=cnt;
  });
  groupDeltas.sort(function(a,b){return Math.abs(b.delta)-Math.abs(a.delta);});
  var movers=[];
  affected.forEach(function(p){
    var key=fitPlayerKey(p);var curP=currentSnapshot.players[key];var nxtP=nextSnapshot.players[key];
    if(!curP||!nxtP)return;
    var d=nxtP.score-curP.score;if(d===0)return;
    movers.push({id:p.id||key,name:p.name,pos:p.pos,current:curP.score,next:nxtP.score,delta:d,
      specDelta:nxtP.specialtyAdj-curP.specialtyAdj,persDelta:nxtP.personalityAdj-curP.personalityAdj,
      sysDelta:nxtP.systemAdj-curP.systemAdj,baseDelta:nxtP.baseScore-curP.baseScore});
  });
  movers.sort(function(a,b){return b.delta-a.delta;});
  var risers=movers.filter(function(m){return m.delta>0;}).slice(0,3);
  var fallers=movers.slice().sort(function(a,b){return a.delta-b.delta;}).filter(function(m){return m.delta<0;}).slice(0,3);
  var currentAvg=totalCount?Math.round(totalCurrent/totalCount):0;
  var projectedAvg=totalCount?Math.round(totalNext/totalCount):0;
  return{side:side,newScheme:newSchemeId,avgFit:avgFit,fitLoss:fitLoss,affected:affected.length,
    currentAvgFit:currentAvg,projectedAvgFit:projectedAvg,avgFitDelta:projectedAvg-currentAvg,
    groupDeltas:groupDeltas,risers:risers,fallers:fallers};
}
function buildFitAlertTargets84(team,alert,fasPool,limit){
  if(!team||!alert)return{internal:[],fa:[]};
  var lim=limit||3;
  var needMap={};
  (alert.needs||[]).forEach(function(n){needMap[n]=1;});
  function matchesNeed(p){
    if(!p||!p.pos)return false;
    return !!needMap[p.pos];
  }
  function ranker(a,b){
    if((b.fit||0)!==(a.fit||0))return (b.fit||0)-(a.fit||0);
    return (b.ovr||0)-(a.ovr||0);
  }
  var internal=(team.roster||[]).filter(matchesNeed).map(function(p){
    var fit=calcPlayerIdentityFit(p,team);
    return{id:p.id,name:p.name,pos:p.pos,ovr:p.ovr||0,fit:fit.score||0,isStarter:!!p.isStarter};
  }).sort(function(a,b){
    if(a.isStarter!==b.isStarter)return a.isStarter?1:-1;
    return ranker(a,b);
  }).slice(0,lim);
  var fa=(fasPool||[]).filter(matchesNeed).map(function(p){
    var fit=calcPlayerIdentityFit(p,team);
    return{id:p.id,name:p.name,pos:p.pos,ovr:p.ovr||0,fit:fit.score||0,ask:(p.contract&&p.contract.salary)||MIN_SALARY};
  }).sort(ranker).slice(0,lim);
  return{internal:internal,fa:fa};
}
function buildGMShortlist84(team,alert,fasPool,limit){
  if(!team||!alert)return[];
  var lim=limit||5;
  var sug=buildFitAlertTargets84(team,alert,fasPool,lim);
  var merged=[];
  (sug.fa||[]).forEach(function(tp){
    merged.push({id:tp.id,name:tp.name,pos:tp.pos,ovr:tp.ovr||0,fit:tp.fit||0,ask:tp.ask||MIN_SALARY,
      source:"fa",groupId:alert.id||"",groupLabel:alert.label||"group"});
  });
  (sug.internal||[]).forEach(function(tp){
    merged.push({id:tp.id,name:tp.name,pos:tp.pos,ovr:tp.ovr||0,fit:tp.fit||0,ask:0,
      source:"internal",groupId:alert.id||"",groupLabel:alert.label||"group"});
  });
  merged.sort(function(a,b){
    if((b.fit||0)!==(a.fit||0))return (b.fit||0)-(a.fit||0);
    if((b.ovr||0)!==(a.ovr||0))return (b.ovr||0)-(a.ovr||0);
    if(a.source!==b.source)return a.source==="fa"?-1:1;
    return (a.name||"")<(b.name||"")?-1:1;
  });
  var out=[];var seen={};
  merged.forEach(function(row){
    if(!row||!row.id||seen[row.id])return;
    if(out.length>=lim)return;
    seen[row.id]=1;
    out.push(row);
  });
  return out;
}
function buildGMShortlistMap84(shortlist){
  var map={};
  (shortlist||[]).forEach(function(row){
    if(row&&row.id)map[row.id]=row;
  });
  return map;
}
function classifySeason(entry,myId){
  if(!entry)return{type:"average",icon:"ðŸ˜",label:"SEASON",color:"#94a3b8"};
  if(entry.winnerId===myId)return{type:"championship",icon:"ðŸ†",label:"CHAMPIONS",color:"#fbbf24"};
  var rec=entry.teamRecords?entry.teamRecords.find(function(t){return t.id===myId;}):null;
  var w=rec?rec.wins:0;
  if(w>=12)return{type:"contender",icon:"ðŸ’ª",label:"CONTENDER",color:"#60a5fa"};
  if(w>=9)return{type:"playoff",icon:"ðŸˆ",label:"PLAYOFF RUN",color:"#34d399"};
  if(w>=7)return{type:"mediocre",icon:"ðŸ˜",label:"MIDDLING",color:"#94a3b8"};
  if(w>=4)return{type:"rebuild",icon:"ðŸ“ˆ",label:"REBUILD",color:"#22d3ee"};
  return{type:"tank",icon:"ðŸ’€",label:"DARK YEAR",color:"#ef4444"};
}
function generateKeyMoments(entry,myId,allHistory,hallOfFame){
  var moments=[];if(!entry)return moments;
  var myRec=entry.teamRecords?entry.teamRecords.find(function(t){return t.id===myId;}):null;
  if(myRec)moments.push("Record: "+myRec.wins+"-"+myRec.losses);
  if(entry.winnerId===myId){
    var rings=allHistory.filter(function(h){return h.winnerId===myId&&h.year<=entry.year;}).length;
    moments.push(rings===1?"First championship in franchise history!":"Championship #"+rings+"!");
  }
  if(entry.mvp&&entry.mvp.tm===(myRec?myRec.abbr:""))moments.push("MVP: "+entry.mvp.name+" ("+entry.mvp.pos+")");
  if(entry.roy&&entry.roy.tm===(myRec?myRec.abbr:""))moments.push("ROY: "+entry.roy.name+" ("+entry.roy.pos+")");
  if(entry.dpoy&&entry.dpoy.tm===(myRec?myRec.abbr:""))moments.push("DPOY: "+entry.dpoy.name);
  if(entry.opoy&&entry.opoy.tm===(myRec?myRec.abbr:""))moments.push("OPOY: "+entry.opoy.name);
  var prevIdx=-1;if(allHistory){for(var i=0;i<allHistory.length;i++){if(allHistory[i].year===entry.year-1){prevIdx=i;break;}}}
  if(prevIdx>=0&&myRec){
    var prevRec=allHistory[prevIdx].teamRecords?allHistory[prevIdx].teamRecords.find(function(t){return t.id===myId;}):null;
    if(prevRec){var delta=myRec.wins-prevRec.wins;
      if(delta>=5)moments.push("Turnaround! +"+delta+" wins over last year");
      else if(delta<=-5)moments.push("Collapse: "+delta+" wins from last year");
    }
  }
  if(hallOfFame){hallOfFame.forEach(function(h){if(h.inductYear===entry.year)moments.push("ðŸ›ï¸ "+h.name+" inducted into Hall of Fame");});}
  return moments.slice(0,4);
}
function buildDynastySummary(history,myId){
  var titles=0,totalW=0,totalL=0,best=0,worst=99,playoffs=0;
  history.forEach(function(h){
    if(h.winnerId===myId)titles++;
    var rec=h.teamRecords?h.teamRecords.find(function(t){return t.id===myId;}):null;
    if(rec){totalW+=rec.wins;totalL+=rec.losses;if(rec.wins>best)best=rec.wins;if(rec.wins<worst)worst=rec.wins;if(rec.wins>=9)playoffs++;}
  });
  return{seasons:history.length,titles:titles,totalW:totalW,totalL:totalL,bestSeason:best,worstSeason:worst<99?worst:0,playoffAppearances:playoffs};
}
var AGE_CURVES={
  // v95: Sharper decline â€” ChatGPT Deep Research validated + amplified per Kevin request
  // decayRate = annual OVR loss multiplier past cliff (higher = faster fall-off)
  QB:{prime:[26,33],cliff:36,decayRate:0.9},// QBs last longest but fall harder now
  RB:{prime:[23,27],cliff:29,decayRate:2.4},// RBs: brutal cliff at 29, fastest decline in league
  WR:{prime:[24,30],cliff:32,decayRate:1.5},// WRs: speed loss hits at 32
  TE:{prime:[25,31],cliff:32,decayRate:1.3},// TEs: lose burst fast after 32
  OL:{prime:[25,32],cliff:34,decayRate:1.0},// OL: technique carries but athleticism fades
  DL:{prime:[24,30],cliff:32,decayRate:1.6},// DL: motor/burst dependent, falls off hard
  LB:{prime:[24,29],cliff:31,decayRate:1.7},// LBs: range drops fast after 31
  CB:{prime:[23,28],cliff:30,decayRate:2.0},// CBs lose speed earliest â€” steep cliff at 30
  S:{prime:[24,30],cliff:31,decayRate:1.5},// Safeties: range matters, goes at 31
  K:{prime:[24,38],cliff:42,decayRate:0.4} // Kickers last forever â€” slight bump
};
var FACILS=[
  {id:"gym",name:"Training Center",icon:"ðŸ‹ï¸",desc:"Boosts development + scouting.",cost:15,maxLvl:3},
  {id:"med",name:"Medical Staff",icon:"ðŸ¥",desc:"Faster healing, fewer injuries.",cost:10,maxLvl:3},
  {id:"stad",name:"Stadium",icon:"ðŸŸï¸",desc:"More seats = more revenue.",cost:50,maxLvl:3},
  {id:"film",name:"Film Room",icon:"ðŸ“¹",desc:"Better gameplan preparation.",cost:20,maxLvl:3},
  {id:"rehab",name:"Rehab Center",icon:"ðŸ’†",desc:"Reduces injury recovery time.",cost:25,maxLvl:3}
];
var FACIL_FX={med:{fx:[1,3,5,8]},stad:{fx:[30,45,60,80]},gym:{fx:[0,5,10,18]},film:{fx:[0,3,6,10]},rehab:{fx:[0,2,4,7]}};
function getFacilFx(type,lvl){return FACIL_FX[type]?FACIL_FX[type].fx[lvl]||0:0;}
var AUDIO=(function(){
  var ctx=null;var masterGain=null;var dubDelay=null;var isMuted=true;var isInit=false;var _onToggle=null;
  var currentTrack=null;var loopTimer=null;var scheduleAhead=0.25;var nextBeatTime=0;var beatIdx=0;
  var loopCount=0;var loopTarget=6;
  var playlist=[];var playlistIdx=-1;
  var _onNext=null;
  var JUKEBOX=["legends","gears","neon","drive","wakeup",
    "afterburn","lobby","sunny","plains","steel","silicon",
    "turnstile","tapedeck","backfield","ghosts","clockwork","bathroom","noend"];
  function shuffleArr(a){
    var r=a.slice();
    var seed=(SEED_GLOBAL^((a.length+1)*2654435761)^((loopCount+1)*97)^((playlistIdx+2)*193))>>>0;
    var localRng=mulberry32(seed);
    for(var i=r.length-1;i>0;i--){
      var j=Math.floor(localRng()*(i+1));
      var t=r[i];r[i]=r[j];r[j]=t;
    }
    return r;
  }
  function buildPlaylist(custom){
    var src=custom||(AUDIO._userPlaylist&&AUDIO._userPlaylist.length>0?AUDIO._userPlaylist:JUKEBOX);
    playlist=shuffleArr(src);playlistIdx=0;
  }
  function calcLoopTarget(name){var s=SONGS[name];if(!s)return 6;return Math.max(3,Math.ceil(150*s.bpm/60/(s.loopBeats||16)));}
  var SWING=0.025;// MPC-style swing offset in seconds
  var NF={
    C1:32.70,D1:36.71,E1:41.20,F1:43.65,G1:49.00,A1:55.00,Bb1:58.27,B1:61.74,
    C2:65.41,D2:73.42,E2:82.41,F2:87.31,"F#2":92.50,G2:98.00,"G#2":103.83,A2:110.00,Bb2:116.54,B2:123.47,
    C3:130.81,"C#3":138.59,D3:146.83,"D#3":155.56,Eb3:155.56,E3:164.81,F3:174.61,"F#3":185.00,G3:196.00,
    "G#3":207.65,Ab3:207.65,A3:220.00,Bb3:233.08,B3:246.94,
    C4:261.63,"C#4":277.18,D4:293.66,"D#4":311.13,Eb4:311.13,E4:329.63,F4:349.23,"F#4":369.99,G4:392.00,
    "G#4":415.30,Ab4:415.30,A4:440.00,Bb4:466.16,B4:493.88,
    C5:523.25,"C#5":554.37,D5:587.33,"D#5":622.25,Eb5:622.25,E5:659.26,F5:698.46,"F#5":739.99,G5:783.99,
    "G#5":830.61,Ab5:830.61,A5:880.00,Bb5:932.33,B5:987.77
  };
  function freq(n){return NF[n]||440;}
  function playKick(t){
    if(!ctx)return;try{
    var osc=ctx.createOscillator();var env=ctx.createGain();
    osc.frequency.setValueAtTime(150,t);osc.frequency.exponentialRampToValueAtTime(40,t+0.15);
    env.gain.setValueAtTime(0.8,t);env.gain.exponentialRampToValueAtTime(0.01,t+0.2);
    osc.connect(env);env.connect(masterGain);osc.start(t);osc.stop(t+0.21);
    }catch(e){}
  }
  function playSnare(t){
    if(!ctx)return;try{
    var osc=ctx.createOscillator();var oE=ctx.createGain();
    osc.type="triangle";osc.frequency.setValueAtTime(300,t);
    oE.gain.setValueAtTime(0.5,t);oE.gain.exponentialRampToValueAtTime(0.01,t+0.1);
    osc.connect(oE);oE.connect(masterGain);osc.start(t);osc.stop(t+0.11);
    var bSz=Math.floor(ctx.sampleRate*0.08);var buf=ctx.createBuffer(1,bSz,ctx.sampleRate);
    var d=buf.getChannelData(0);for(var i=0;i<bSz;i++)d[i]=(RNG.ui()*2-1);
    var ns=ctx.createBufferSource();ns.buffer=buf;
    var nf=ctx.createBiquadFilter();nf.type="highpass";nf.frequency.value=2000;
    var nE=ctx.createGain();nE.gain.setValueAtTime(0.35,t);nE.gain.exponentialRampToValueAtTime(0.01,t+0.07);
    ns.connect(nf);nf.connect(nE);nE.connect(masterGain);ns.start(t);
    }catch(e){}
  }
  function playHat(t){
    if(!ctx)return;try{
    var osc=ctx.createOscillator();var env=ctx.createGain();
    osc.type="square";osc.frequency.value=8000;
    env.gain.setValueAtTime(0.04,t);env.gain.exponentialRampToValueAtTime(0.001,t+0.03);
    osc.connect(env);env.connect(masterGain);osc.start(t);osc.stop(t+0.04);
    }catch(e){}
  }
  function playBass(t,f,dur){
    if(!ctx||!f)return;try{
    var osc=ctx.createOscillator();var flt=ctx.createBiquadFilter();var env=ctx.createGain();
    osc.type="sawtooth";osc.frequency.value=f;
    flt.type="lowpass";flt.frequency.setValueAtTime(f*1.5,t);
    flt.frequency.exponentialRampToValueAtTime(f*4,t+0.04);// "Pop"
    flt.frequency.exponentialRampToValueAtTime(f,t+0.2);// Decay
    var d=Math.min(dur||0.25,0.4);
    env.gain.setValueAtTime(0.45,t);env.gain.linearRampToValueAtTime(0.3,t+0.08);
    env.gain.linearRampToValueAtTime(0,t+d);
    osc.connect(flt);flt.connect(env);env.connect(masterGain);
    osc.start(t);osc.stop(t+d+0.01);
    }catch(e){}
  }
  function playPulse(t,f,dur,vol,useDub){
    if(!ctx||!f)return;try{
    var osc=ctx.createOscillator();var env=ctx.createGain();
    osc.type="square";osc.frequency.value=f;
    var v=vol||0.12;var d=dur||0.2;
    env.gain.setValueAtTime(0,t);env.gain.linearRampToValueAtTime(v,t+0.008);
    env.gain.setValueAtTime(v,t+d*0.7);env.gain.linearRampToValueAtTime(0,t+d);
    osc.connect(env);env.connect(masterGain);
    if(useDub&&dubDelay)env.connect(dubDelay);// Send to dub delay
    osc.start(t);osc.stop(t+d+0.01);
    }catch(e){}
  }
  var TITLE_TRACK={bpm:104,loopBeats:32,channels:{
    pulse1:[
      {note:"D5",start:0,dur:.5},{note:"B4",start:.5,dur:.5},{note:"A4",start:1,dur:.5},{note:"G4",start:1.5,dur:.5},
      {note:"A4",start:2,dur:.5},{note:"B4",start:2.5,dur:.5},{note:"D5",start:3,dur:.5},{note:"C5",start:3.5,dur:.5},
      {note:"B4",start:4,dur:.5},{note:"A4",start:4.5,dur:.5},{note:"G4",start:5,dur:1},
      {note:"A4",start:6,dur:.5},{note:"B4",start:6.5,dur:.5},{note:"D5",start:7,dur:.5},{note:"B4",start:7.5,dur:.5},
      {note:"E5",start:8,dur:.5},{note:"D5",start:8.5,dur:.5},{note:"C5",start:9,dur:1},
      {note:"D5",start:10,dur:.5},{note:"E5",start:10.5,dur:.5},{note:"G5",start:11,dur:.5},{note:"E5",start:11.5,dur:.5},
      {note:"D5",start:12,dur:.5},{note:"C5",start:12.5,dur:.5},{note:"B4",start:13,dur:.5},{note:"A4",start:13.5,dur:.5},
      {note:"G4",start:14,dur:1},{note:"A4",start:15,dur:.5},{note:"B4",start:15.5,dur:.5},
      {note:"F5",start:16,dur:.5},{note:"E5",start:16.5,dur:.5},{note:"D5",start:17,dur:1},
      {note:"E5",start:18,dur:.5},{note:"F5",start:18.5,dur:.5},{note:"G5",start:19,dur:.5},{note:"E5",start:19.5,dur:.5},
      {note:"D5",start:20,dur:.5},{note:"B4",start:20.5,dur:.5},{note:"A4",start:21,dur:.5},{note:"G4",start:21.5,dur:.5},
      {note:"A4",start:22,dur:.5},{note:"B4",start:22.5,dur:.5},{note:"D5",start:23,dur:1},
      {note:"E5",start:24,dur:.5},{note:"F5",start:24.5,dur:.5},{note:"A5",start:25,dur:.5},{note:"G5",start:25.5,dur:.5},
      {note:"F5",start:26,dur:.5},{note:"E5",start:26.5,dur:.5},{note:"D5",start:27,dur:1},
      {note:"E5",start:28,dur:.5},{note:"D5",start:28.5,dur:.5},{note:"C5",start:29,dur:1},
      {note:"D5",start:30,dur:.5},{note:"E5",start:30.5,dur:.5},{note:"G5",start:31,dur:.5},{note:"D5",start:31.5,dur:.5}
    ],
    pulse2:[
      {note:"G4",start:.5,dur:.25},{note:"D4",start:1.5,dur:.25},{note:"G4",start:2.5,dur:.25},{note:"D4",start:3.5,dur:.25},
      {note:"G4",start:4.5,dur:.25},{note:"D4",start:5.5,dur:.25},{note:"G4",start:6.5,dur:.25},{note:"D4",start:7.5,dur:.25},
      {note:"C4",start:8.5,dur:.25},{note:"G3",start:9.5,dur:.25},{note:"C4",start:10.5,dur:.25},{note:"G3",start:11.5,dur:.25},
      {note:"C4",start:12.5,dur:.25},{note:"G3",start:13.5,dur:.25},{note:"C4",start:14.5,dur:.25},{note:"G3",start:15.5,dur:.25},
      {note:"F4",start:16.5,dur:.25},{note:"C4",start:17.5,dur:.25},{note:"F4",start:18.5,dur:.25},{note:"C4",start:19.5,dur:.25},
      {note:"G4",start:20.5,dur:.25},{note:"D4",start:21.5,dur:.25},{note:"G4",start:22.5,dur:.25},{note:"D4",start:23.5,dur:.25},
      {note:"D4",start:24.5,dur:.25},{note:"A3",start:25.5,dur:.25},{note:"D4",start:26.5,dur:.25},{note:"A3",start:27.5,dur:.25},
      {note:"C4",start:28.5,dur:.25},{note:"G3",start:29.5,dur:.25},{note:"C4",start:30.5,dur:.25},{note:"G3",start:31.5,dur:.25}
    ],
    triangle:[
      {note:"G2",start:0,dur:.75},{note:"D2",start:.75,dur:.25},{note:"F2",start:1,dur:.5},{note:"D2",start:1.5,dur:.5},
      {note:"G2",start:2,dur:.5},{note:"A2",start:2.5,dur:.25},{note:"B2",start:2.75,dur:.25},{note:"D2",start:3,dur:1},
      {note:"G2",start:4,dur:.75},{note:"D2",start:4.75,dur:.25},{note:"F2",start:5,dur:.5},{note:"D2",start:5.5,dur:.5},
      {note:"G2",start:6,dur:.5},{note:"A2",start:6.5,dur:.25},{note:"B2",start:6.75,dur:.25},{note:"D2",start:7,dur:1},
      {note:"C2",start:8,dur:.75},{note:"G1",start:8.75,dur:.25},{note:"B1",start:9,dur:.5},{note:"G1",start:9.5,dur:.5},
      {note:"C2",start:10,dur:.5},{note:"D2",start:10.5,dur:.25},{note:"E2",start:10.75,dur:.25},{note:"G1",start:11,dur:1},
      {note:"C2",start:12,dur:.75},{note:"G1",start:12.75,dur:.25},{note:"B1",start:13,dur:.5},{note:"G1",start:13.5,dur:.5},
      {note:"C2",start:14,dur:.5},{note:"D2",start:14.5,dur:.25},{note:"E2",start:14.75,dur:.25},{note:"G1",start:15,dur:1},
      {note:"F2",start:16,dur:.75},{note:"C2",start:16.75,dur:.25},{note:"E2",start:17,dur:.5},{note:"C2",start:17.5,dur:.5},
      {note:"F2",start:18,dur:.5},{note:"G2",start:18.5,dur:.25},{note:"A2",start:18.75,dur:.25},{note:"C2",start:19,dur:1},
      {note:"G2",start:20,dur:.75},{note:"D2",start:20.75,dur:.25},{note:"F2",start:21,dur:.5},{note:"D2",start:21.5,dur:.5},
      {note:"G2",start:22,dur:.5},{note:"A2",start:22.5,dur:.25},{note:"B2",start:22.75,dur:.25},{note:"D2",start:23,dur:1},
      {note:"D2",start:24,dur:.75},{note:"A1",start:24.75,dur:.25},{note:"C2",start:25,dur:.5},{note:"A1",start:25.5,dur:.5},
      {note:"D2",start:26,dur:.5},{note:"E2",start:26.5,dur:.25},{note:"F2",start:26.75,dur:.25},{note:"A1",start:27,dur:1},
      {note:"C2",start:28,dur:.75},{note:"G1",start:28.75,dur:.25},{note:"B1",start:29,dur:.5},{note:"G1",start:29.5,dur:.5},
      {note:"C2",start:30,dur:.5},{note:"D2",start:30.5,dur:.25},{note:"E2",start:30.75,dur:.25},{note:"G1",start:31,dur:1}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5},
      {drum:"kick",start:16},{drum:"hat",start:16.5},{drum:"snare",start:17},{drum:"hat",start:17.5},
      {drum:"kick",start:18},{drum:"hat",start:18.5},{drum:"snare",start:19},{drum:"hat",start:19.5},
      {drum:"kick",start:20},{drum:"hat",start:20.5},{drum:"snare",start:21},{drum:"hat",start:21.5},
      {drum:"kick",start:22},{drum:"hat",start:22.5},{drum:"snare",start:23},{drum:"hat",start:23.5},
      {drum:"kick",start:24},{drum:"hat",start:24.5},{drum:"snare",start:25},{drum:"hat",start:25.5},
      {drum:"kick",start:26},{drum:"hat",start:26.5},{drum:"snare",start:27},{drum:"hat",start:27.5},
      {drum:"kick",start:28},{drum:"hat",start:28.5},{drum:"snare",start:29},{drum:"hat",start:29.5},
      {drum:"kick",start:30},{drum:"hat",start:30.5},{drum:"snare",start:31},{drum:"hat",start:31.5}
    ]
  }};
  var HUB_TRACK={bpm:98,loopBeats:32,channels:{
    pulse1:[
      {note:"G4",start:0,dur:1},{note:"E4",start:1.5,dur:.5},{note:"D4",start:2,dur:1},{note:"C4",start:3.5,dur:.5},
      {note:"E4",start:4,dur:1},{note:"G4",start:5.5,dur:.5},{note:"A4",start:6,dur:1},{note:"G4",start:7.5,dur:.5},
      {note:"G4",start:8,dur:1},{note:"E4",start:9.5,dur:.5},{note:"D4",start:10,dur:1},{note:"C4",start:11.5,dur:.5},
      {note:"F4",start:12,dur:1},{note:"E4",start:13.5,dur:.5},{note:"D4",start:14,dur:1},{note:"C4",start:15.5,dur:.5},
      {note:"A4",start:16,dur:1},{note:"G4",start:17.5,dur:.5},{note:"E4",start:18,dur:1},{note:"D4",start:19.5,dur:.5},
      {note:"G4",start:20,dur:1},{note:"A4",start:21.5,dur:.5},{note:"G4",start:22,dur:1},{note:"E4",start:23.5,dur:.5},
      {note:"D4",start:24,dur:1},{note:"C4",start:25.5,dur:.5},{note:"D4",start:26,dur:1},{note:"E4",start:27.5,dur:.5},
      {note:"G4",start:28,dur:1},{note:"E4",start:29.5,dur:.5},{note:"D4",start:30,dur:1},{note:"C4",start:31.5,dur:.5}
    ],
    pulse2:[
      {note:"C4",start:.5,dur:.25},{note:"G3",start:1.5,dur:.25},{note:"F3",start:2.5,dur:.25},{note:"C3",start:3.5,dur:.25},
      {note:"C4",start:4.5,dur:.25},{note:"G3",start:5.5,dur:.25},{note:"Bb3",start:6.5,dur:.25},{note:"F3",start:7.5,dur:.25},
      {note:"C4",start:8.5,dur:.25},{note:"G3",start:9.5,dur:.25},{note:"F3",start:10.5,dur:.25},{note:"C3",start:11.5,dur:.25},
      {note:"C4",start:12.5,dur:.25},{note:"G3",start:13.5,dur:.25},{note:"Bb3",start:14.5,dur:.25},{note:"F3",start:15.5,dur:.25},
      {note:"C4",start:16.5,dur:.25},{note:"G3",start:17.5,dur:.25},{note:"F3",start:18.5,dur:.25},{note:"C3",start:19.5,dur:.25},
      {note:"C4",start:20.5,dur:.25},{note:"G3",start:21.5,dur:.25},{note:"Bb3",start:22.5,dur:.25},{note:"F3",start:23.5,dur:.25},
      {note:"C4",start:24.5,dur:.25},{note:"G3",start:25.5,dur:.25},{note:"F3",start:26.5,dur:.25},{note:"C3",start:27.5,dur:.25},
      {note:"C4",start:28.5,dur:.25},{note:"G3",start:29.5,dur:.25},{note:"Bb3",start:30.5,dur:.25},{note:"F3",start:31.5,dur:.25}
    ],
    triangle:[
      {note:"C2",start:0,dur:.75},{note:"G1",start:.75,dur:.25},{note:"Bb1",start:1,dur:.5},{note:"G1",start:1.5,dur:.5},
      {note:"F1",start:2,dur:.75},{note:"C2",start:2.75,dur:.25},{note:"C2",start:3,dur:1},
      {note:"C2",start:4,dur:.75},{note:"G1",start:4.75,dur:.25},{note:"Bb1",start:5,dur:.5},{note:"G1",start:5.5,dur:.5},
      {note:"F1",start:6,dur:.75},{note:"C2",start:6.75,dur:.25},{note:"C2",start:7,dur:1},
      {note:"C2",start:8,dur:.75},{note:"G1",start:8.75,dur:.25},{note:"Bb1",start:9,dur:.5},{note:"G1",start:9.5,dur:.5},
      {note:"F1",start:10,dur:.75},{note:"C2",start:10.75,dur:.25},{note:"C2",start:11,dur:1},
      {note:"C2",start:12,dur:.75},{note:"G1",start:12.75,dur:.25},{note:"Bb1",start:13,dur:.5},{note:"G1",start:13.5,dur:.5},
      {note:"F1",start:14,dur:.75},{note:"C2",start:14.75,dur:.25},{note:"C2",start:15,dur:1},
      {note:"C2",start:16,dur:.75},{note:"G1",start:16.75,dur:.25},{note:"Bb1",start:17,dur:.5},{note:"G1",start:17.5,dur:.5},
      {note:"F1",start:18,dur:.75},{note:"C2",start:18.75,dur:.25},{note:"C2",start:19,dur:1},
      {note:"C2",start:20,dur:.75},{note:"G1",start:20.75,dur:.25},{note:"Bb1",start:21,dur:.5},{note:"G1",start:21.5,dur:.5},
      {note:"F1",start:22,dur:.75},{note:"C2",start:22.75,dur:.25},{note:"C2",start:23,dur:1},
      {note:"C2",start:24,dur:.75},{note:"G1",start:24.75,dur:.25},{note:"Bb1",start:25,dur:.5},{note:"G1",start:25.5,dur:.5},
      {note:"F1",start:26,dur:.75},{note:"C2",start:26.75,dur:.25},{note:"C2",start:27,dur:1},
      {note:"C2",start:28,dur:.75},{note:"G1",start:28.75,dur:.25},{note:"Bb1",start:29,dur:.5},{note:"G1",start:29.5,dur:.5},
      {note:"F1",start:30,dur:.75},{note:"C2",start:30.75,dur:.25},{note:"C2",start:31,dur:1}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5},
      {drum:"kick",start:16},{drum:"hat",start:16.5},{drum:"snare",start:17},{drum:"hat",start:17.5},
      {drum:"hat",start:18.5},{drum:"snare",start:19},{drum:"hat",start:19.5},
      {drum:"kick",start:20},{drum:"hat",start:20.5},{drum:"snare",start:21},{drum:"hat",start:21.5},
      {drum:"hat",start:22.5},{drum:"snare",start:23},{drum:"hat",start:23.5},
      {drum:"kick",start:24},{drum:"hat",start:24.5},{drum:"snare",start:25},{drum:"hat",start:25.5},
      {drum:"hat",start:26.5},{drum:"snare",start:27},{drum:"hat",start:27.5},
      {drum:"kick",start:28},{drum:"hat",start:28.5},{drum:"snare",start:29},{drum:"hat",start:29.5},
      {drum:"hat",start:30.5},{drum:"snare",start:31},{drum:"hat",start:31.5}
    ]
  }};
  var GAMEDAY_TRACK={bpm:122,loopBeats:16,channels:{
    pulse1:[
      {note:"E5",start:0,dur:.5},{note:"C#5",start:.5,dur:.5},{note:"B4",start:1,dur:.5},{note:"A4",start:1.5,dur:.5},
      {note:"B4",start:2,dur:.5},{note:"C#5",start:2.5,dur:.5},{note:"E5",start:3,dur:1},
      {note:"D5",start:4,dur:.5},{note:"C#5",start:4.5,dur:.5},{note:"B4",start:5,dur:.5},{note:"A4",start:5.5,dur:.5},
      {note:"G4",start:6,dur:.5},{note:"A4",start:6.5,dur:.5},{note:"B4",start:7,dur:1},
      {note:"E5",start:8,dur:.5},{note:"F#5",start:8.5,dur:.5},{note:"E5",start:9,dur:.5},{note:"C#5",start:9.5,dur:.5},
      {note:"B4",start:10,dur:.5},{note:"A4",start:10.5,dur:.5},{note:"B4",start:11,dur:1},
      {note:"D5",start:12,dur:.5},{note:"E5",start:12.5,dur:.5},{note:"D5",start:13,dur:.5},{note:"B4",start:13.5,dur:.5},
      {note:"A4",start:14,dur:.5},{note:"B4",start:14.5,dur:.5},{note:"C#5",start:15,dur:1}
    ],
    pulse2:[
      {note:"A4",start:0,dur:.25},{note:"E4",start:.5,dur:.25},{note:"A4",start:1,dur:.25},{note:"E4",start:1.5,dur:.25},
      {note:"A4",start:2,dur:.25},{note:"E4",start:2.5,dur:.25},{note:"A4",start:3,dur:.25},{note:"E4",start:3.5,dur:.25},
      {note:"D4",start:4,dur:.25},{note:"A3",start:4.5,dur:.25},{note:"D4",start:5,dur:.25},{note:"A3",start:5.5,dur:.25},
      {note:"D4",start:6,dur:.25},{note:"A3",start:6.5,dur:.25},{note:"D4",start:7,dur:.25},{note:"A3",start:7.5,dur:.25},
      {note:"A4",start:8,dur:.25},{note:"E4",start:8.5,dur:.25},{note:"A4",start:9,dur:.25},{note:"E4",start:9.5,dur:.25},
      {note:"G4",start:10,dur:.25},{note:"D4",start:10.5,dur:.25},{note:"G4",start:11,dur:.25},{note:"D4",start:11.5,dur:.25},
      {note:"A4",start:12,dur:.25},{note:"E4",start:12.5,dur:.25},{note:"A4",start:13,dur:.25},{note:"E4",start:13.5,dur:.25},
      {note:"D4",start:14,dur:.25},{note:"A3",start:14.5,dur:.25},{note:"E4",start:15,dur:.25},{note:"A3",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"A2",start:0,dur:.5},{note:"E2",start:.5,dur:.25},{note:"G2",start:.75,dur:.25},{note:"E2",start:1,dur:.5},
      {note:"A2",start:1.5,dur:.25},{note:"B2",start:1.75,dur:.25},{note:"C#3",start:2,dur:.5},{note:"B2",start:2.5,dur:.25},
      {note:"A2",start:2.75,dur:.25},{note:"E2",start:3,dur:1},
      {note:"D2",start:4,dur:.5},{note:"A1",start:4.5,dur:.25},{note:"C2",start:4.75,dur:.25},{note:"A1",start:5,dur:.5},
      {note:"D2",start:5.5,dur:.25},{note:"E2",start:5.75,dur:.25},{note:"F#2",start:6,dur:.5},{note:"E2",start:6.5,dur:.25},
      {note:"D2",start:6.75,dur:.25},{note:"A1",start:7,dur:1},
      {note:"A2",start:8,dur:.5},{note:"E2",start:8.5,dur:.25},{note:"G2",start:8.75,dur:.25},{note:"E2",start:9,dur:.5},
      {note:"A2",start:9.5,dur:.25},{note:"B2",start:9.75,dur:.25},{note:"G2",start:10,dur:.5},{note:"E2",start:10.5,dur:.25},
      {note:"D2",start:10.75,dur:.25},{note:"A1",start:11,dur:1},
      {note:"A2",start:12,dur:.5},{note:"E2",start:12.5,dur:.25},{note:"G2",start:12.75,dur:.25},{note:"E2",start:13,dur:.5},
      {note:"D2",start:13.5,dur:.25},{note:"E2",start:13.75,dur:.25},{note:"A2",start:14,dur:.5},{note:"E2",start:14.5,dur:.5},
      {note:"A1",start:15,dur:1}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var DRAFT_TRACK={bpm:90,loopBeats:16,channels:{
    pulse1:[
      {note:"D4",start:0,dur:1.5},{note:"A4",start:2,dur:1},
      {note:"G4",start:4,dur:1},{note:"F#4",start:5.5,dur:.5},
      {note:"E4",start:6,dur:1},{note:"D4",start:7.5,dur:.5},
      {note:"A4",start:8,dur:1.5},{note:"B4",start:10,dur:1},
      {note:"C5",start:12,dur:.5},{note:"B4",start:12.5,dur:.5},{note:"A4",start:13,dur:1},
      {note:"G4",start:14.5,dur:.5},{note:"D4",start:15,dur:1}
    ],
    pulse2:[
      {note:"D3",start:2.5,dur:.25},{note:"A3",start:6.5,dur:.25},
      {note:"D3",start:10.5,dur:.25},{note:"A3",start:14.5,dur:.25}
    ],
    triangle:[
      {note:"D2",start:0,dur:1.5},{note:"D2",start:2,dur:1},{note:"G2",start:4,dur:2},
      {note:"A2",start:6,dur:2},{note:"D2",start:8,dur:2},{note:"G2",start:10,dur:2},
      {note:"C2",start:12,dur:2},{note:"D2",start:14,dur:2}
    ],
    noise:[
      {drum:"hat",start:.5},{drum:"hat",start:1.5},{drum:"hat",start:2.5},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"hat",start:5.5},
      {drum:"snare",start:6},{drum:"hat",start:6.5},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"hat",start:9.5},
      {drum:"snare",start:10},{drum:"hat",start:10.5},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var GEARS_TRACK={bpm:128,loopBeats:32,channels:{
    pulse1:[
      {note:"E5",start:0,dur:.25},{note:"G5",start:.25,dur:.25},{note:"B4",start:.5,dur:.25},{note:"G5",start:.75,dur:.25},
      {note:"E5",start:1,dur:.5},{note:"B4",start:1.5,dur:.5},
      {note:"D5",start:2,dur:.25},{note:"F#5",start:2.25,dur:.25},{note:"A4",start:2.5,dur:.25},{note:"F#5",start:2.75,dur:.25},
      {note:"D5",start:3,dur:.5},{note:"A4",start:3.5,dur:.5},
      {note:"C5",start:4,dur:.5},{note:"E5",start:4.5,dur:.5},{note:"G5",start:5,dur:.5},{note:"E5",start:5.5,dur:.5},
      {note:"C5",start:6,dur:.5},{note:"E5",start:6.5,dur:.5},
      {note:"D5",start:7,dur:.5},{note:"F#5",start:7.5,dur:.5},
      {note:"E5",start:8,dur:.25},{note:"G5",start:8.25,dur:.25},{note:"B4",start:8.5,dur:.25},{note:"E5",start:8.75,dur:.25},
      {note:"G5",start:9,dur:.5},{note:"B5",start:9.5,dur:.5},
      {note:"D5",start:10,dur:.25},{note:"F#5",start:10.25,dur:.25},{note:"A5",start:10.5,dur:.25},{note:"F#5",start:10.75,dur:.25},
      {note:"D5",start:11,dur:1},
      {note:"C5",start:12,dur:.5},{note:"G5",start:12.5,dur:.5},{note:"E5",start:13,dur:.5},{note:"G5",start:13.5,dur:.5},
      {note:"D5",start:14,dur:.5},{note:"A5",start:14.5,dur:.5},
      {note:"E5",start:15,dur:1},
      {note:"G5",start:16,dur:.5},{note:"B5",start:16.5,dur:.5},{note:"D5",start:17,dur:.5},{note:"G5",start:17.5,dur:.5},
      {note:"G5",start:18,dur:1},{note:"F#5",start:19,dur:1},
      {note:"D5",start:20,dur:.5},{note:"A5",start:20.5,dur:.5},{note:"F#5",start:21,dur:.5},{note:"D5",start:21.5,dur:.5},
      {note:"D5",start:22,dur:1},{note:"C5",start:23,dur:1},
      {note:"E5",start:24,dur:.25},{note:"G5",start:24.25,dur:.25},{note:"B4",start:24.5,dur:.25},{note:"G5",start:24.75,dur:.25},
      {note:"A5",start:25,dur:.5},{note:"G5",start:25.5,dur:.5},
      {note:"E5",start:26,dur:.5},{note:"G5",start:26.5,dur:.5},
      {note:"C5",start:27,dur:1},
      {note:"G5",start:28,dur:.5},{note:"B5",start:28.5,dur:.5},{note:"D5",start:29,dur:.5},{note:"G5",start:29.5,dur:.5},
      {note:"E5",start:30,dur:.5},{note:"D5",start:30.5,dur:.25},{note:"C5",start:30.75,dur:.25},
      {note:"E5",start:31,dur:1}
    ],
    pulse2:[
      {note:"E4",start:.5,dur:.25},{note:"G3",start:1.5,dur:.25},{note:"D4",start:2.5,dur:.25},{note:"F#3",start:3.5,dur:.25},
      {note:"C4",start:4.5,dur:.25},{note:"E3",start:5.5,dur:.25},{note:"D4",start:6.5,dur:.25},{note:"A3",start:7.5,dur:.25},
      {note:"E4",start:8.5,dur:.25},{note:"B3",start:9.5,dur:.25},{note:"D4",start:10.5,dur:.25},{note:"F#3",start:11.5,dur:.25},
      {note:"C4",start:12.5,dur:.25},{note:"G3",start:13.5,dur:.25},{note:"D4",start:14.5,dur:.25},{note:"E4",start:15.5,dur:.25},
      {note:"G4",start:16.5,dur:.25},{note:"B3",start:17.5,dur:.25},{note:"G4",start:18.5,dur:.25},{note:"D4",start:19.5,dur:.25},
      {note:"D4",start:20.5,dur:.25},{note:"A3",start:21.5,dur:.25},{note:"D4",start:22.5,dur:.25},{note:"C4",start:23.5,dur:.25},
      {note:"E4",start:24.5,dur:.25},{note:"G3",start:25.5,dur:.25},{note:"E4",start:26.5,dur:.25},{note:"C4",start:27.5,dur:.25},
      {note:"G4",start:28.5,dur:.25},{note:"B3",start:29.5,dur:.25},{note:"E4",start:30.5,dur:.25},{note:"G3",start:31.5,dur:.25}
    ],
    triangle:[
      {note:"E2",start:0,dur:2},{note:"E2",start:2,dur:.5},{note:"B1",start:2.5,dur:.5},
      {note:"D2",start:4,dur:2},{note:"A1",start:6,dur:1},{note:"D2",start:7,dur:1},
      {note:"E2",start:8,dur:2},{note:"B1",start:10,dur:.5},{note:"E2",start:10.5,dur:.5},
      {note:"D2",start:12,dur:2},{note:"C2",start:14,dur:1},{note:"D2",start:15,dur:1},
      {note:"G2",start:16,dur:4},{note:"D2",start:20,dur:4},
      {note:"E2",start:24,dur:4},{note:"C2",start:28,dur:2},{note:"D2",start:30,dur:1},{note:"E2",start:31,dur:1}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5},
      {drum:"kick",start:16},{drum:"hat",start:16.5},{drum:"snare",start:17},{drum:"hat",start:17.5},
      {drum:"kick",start:18},{drum:"hat",start:18.5},{drum:"snare",start:19},{drum:"hat",start:19.5},
      {drum:"kick",start:20},{drum:"hat",start:20.5},{drum:"snare",start:21},{drum:"hat",start:21.5},
      {drum:"kick",start:22},{drum:"hat",start:22.5},{drum:"snare",start:23},{drum:"hat",start:23.5},
      {drum:"kick",start:24},{drum:"hat",start:24.5},{drum:"snare",start:25},{drum:"hat",start:25.5},
      {drum:"kick",start:26},{drum:"hat",start:26.5},{drum:"snare",start:27},{drum:"hat",start:27.5},
      {drum:"kick",start:28},{drum:"hat",start:28.5},{drum:"snare",start:29},{drum:"hat",start:29.5},
      {drum:"kick",start:30},{drum:"hat",start:30.5},{drum:"snare",start:31},{drum:"hat",start:31.5}
    ]
  }};
  var NEON_TRACK={bpm:142,loopBeats:32,channels:{
    pulse1:[
      {note:"A5",start:0,dur:.25},{note:"C5",start:.25,dur:.25},{note:"B4",start:.5,dur:.25},{note:"G4",start:.75,dur:.25},
      {note:"A5",start:1,dur:.5},{note:"G4",start:1.5,dur:.5},
      {note:"G5",start:2,dur:.25},{note:"B4",start:2.25,dur:.25},{note:"D5",start:2.5,dur:.25},{note:"B4",start:2.75,dur:.25},
      {note:"G5",start:3,dur:1},
      {note:"F5",start:4,dur:.25},{note:"A5",start:4.25,dur:.25},{note:"C5",start:4.5,dur:.25},{note:"A5",start:4.75,dur:.25},
      {note:"F5",start:5,dur:.5},{note:"A5",start:5.5,dur:.5},
      {note:"E5",start:6,dur:.5},{note:"G#4",start:6.5,dur:.25},{note:"B4",start:6.75,dur:.25},
      {note:"E5",start:7,dur:1},
      {note:"A5",start:8,dur:.25},{note:"C5",start:8.25,dur:.25},{note:"B4",start:8.5,dur:.25},{note:"G4",start:8.75,dur:.25},
      {note:"E5",start:9,dur:.5},{note:"A5",start:9.5,dur:.5},
      {note:"G5",start:10,dur:.5},{note:"D5",start:10.5,dur:.5},
      {note:"G5",start:11,dur:1},
      {note:"F5",start:12,dur:.5},{note:"C5",start:12.5,dur:.5},
      {note:"A5",start:13,dur:.5},{note:"F5",start:13.5,dur:.5},
      {note:"E5",start:14,dur:.25},{note:"G#4",start:14.25,dur:.25},{note:"B4",start:14.5,dur:.5},
      {note:"A4",start:15,dur:1},
      {note:"C5",start:16,dur:.5},{note:"E5",start:16.5,dur:.5},{note:"G5",start:17,dur:.5},{note:"C5",start:17.5,dur:.5},
      {note:"E5",start:18,dur:1},{note:"G5",start:19,dur:1},
      {note:"G5",start:20,dur:.5},{note:"B5",start:20.5,dur:.5},{note:"D5",start:21,dur:.5},{note:"G5",start:21.5,dur:.5},
      {note:"G5",start:22,dur:1},{note:"F#5",start:23,dur:1},
      {note:"A5",start:24,dur:.25},{note:"C5",start:24.25,dur:.25},{note:"B4",start:24.5,dur:.25},{note:"G4",start:24.75,dur:.25},
      {note:"E5",start:25,dur:.5},{note:"A5",start:25.5,dur:.5},
      {note:"C5",start:26,dur:.5},{note:"E5",start:26.5,dur:.5},
      {note:"A4",start:27,dur:1},
      {note:"F5",start:28,dur:.5},{note:"A5",start:28.5,dur:.5},{note:"C5",start:29,dur:.5},{note:"F5",start:29.5,dur:.5},
      {note:"A5",start:30,dur:.5},{note:"G5",start:30.5,dur:.5},
      {note:"A5",start:31,dur:1}
    ],
    pulse2:[
      {note:"A4",start:.5,dur:.25},{note:"E4",start:1.5,dur:.25},{note:"G4",start:2.5,dur:.25},{note:"D4",start:3.5,dur:.25},
      {note:"F4",start:4.5,dur:.25},{note:"C4",start:5.5,dur:.25},{note:"E4",start:6.5,dur:.25},{note:"B3",start:7.5,dur:.25},
      {note:"A4",start:8.5,dur:.25},{note:"E4",start:9.5,dur:.25},{note:"G4",start:10.5,dur:.25},{note:"D4",start:11.5,dur:.25},
      {note:"F4",start:12.5,dur:.25},{note:"C4",start:13.5,dur:.25},{note:"E4",start:14.5,dur:.25},{note:"A3",start:15.5,dur:.25},
      {note:"C4",start:16.5,dur:.25},{note:"G3",start:17.5,dur:.25},{note:"E4",start:18.5,dur:.25},{note:"C4",start:19.5,dur:.25},
      {note:"G4",start:20.5,dur:.25},{note:"D4",start:21.5,dur:.25},{note:"G4",start:22.5,dur:.25},{note:"F#3",start:23.5,dur:.25},
      {note:"A4",start:24.5,dur:.25},{note:"E4",start:25.5,dur:.25},{note:"C4",start:26.5,dur:.25},{note:"A3",start:27.5,dur:.25},
      {note:"F4",start:28.5,dur:.25},{note:"C4",start:29.5,dur:.25},{note:"A4",start:30.5,dur:.25},{note:"E4",start:31.5,dur:.25}
    ],
    triangle:[
      {note:"A2",start:0,dur:4},{note:"G2",start:4,dur:4},{note:"F2",start:8,dur:4},{note:"E2",start:12,dur:4},
      {note:"C2",start:16,dur:4},{note:"G2",start:20,dur:4},{note:"A2",start:24,dur:4},{note:"F2",start:28,dur:4}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5},
      {drum:"kick",start:16},{drum:"kick",start:16.5},{drum:"snare",start:17},{drum:"hat",start:17.5},
      {drum:"kick",start:18},{drum:"hat",start:18.5},{drum:"snare",start:19},{drum:"hat",start:19.5},
      {drum:"kick",start:20},{drum:"kick",start:20.5},{drum:"snare",start:21},{drum:"hat",start:21.5},
      {drum:"kick",start:22},{drum:"hat",start:22.5},{drum:"snare",start:23},{drum:"hat",start:23.5},
      {drum:"kick",start:24},{drum:"hat",start:24.5},{drum:"snare",start:25},{drum:"hat",start:25.5},
      {drum:"kick",start:26},{drum:"hat",start:26.5},{drum:"snare",start:27},{drum:"hat",start:27.5},
      {drum:"kick",start:28},{drum:"kick",start:28.5},{drum:"snare",start:29},{drum:"hat",start:29.5},
      {drum:"kick",start:30},{drum:"hat",start:30.5},{drum:"snare",start:31},{drum:"hat",start:31.5}
    ]
  }};
  var LEGENDS_TRACK={bpm:104,loopBeats:32,channels:{
    pulse1:[
      {note:"Bb4",start:0,dur:1},{note:"C5",start:1,dur:.5},{note:"D5",start:1.5,dur:.5},
      {note:"F5",start:2,dur:1},{note:"G5",start:3,dur:1},
      {note:"F5",start:4,dur:.5},{note:"D5",start:4.5,dur:.5},{note:"C5",start:5,dur:.5},{note:"Bb4",start:5.5,dur:.5},
      {note:"D5",start:6,dur:1},{note:"C5",start:7,dur:1},
      {note:"G5",start:8,dur:1},{note:"Bb4",start:9,dur:.5},{note:"D5",start:9.5,dur:.5},
      {note:"G5",start:10,dur:.5},{note:"F5",start:10.5,dur:.5},{note:"Eb5",start:11,dur:1},
      {note:"Eb5",start:12,dur:1},{note:"F5",start:13,dur:.5},{note:"G5",start:13.5,dur:.5},
      {note:"Bb5",start:14,dur:1},{note:"F5",start:15,dur:1},
      {note:"Eb5",start:16,dur:1},{note:"F5",start:17,dur:1},
      {note:"G5",start:18,dur:.5},{note:"Bb5",start:18.5,dur:.5},{note:"D5",start:19,dur:1},
      {note:"F5",start:20,dur:1},{note:"G5",start:21,dur:1},
      {note:"Bb5",start:22,dur:.5},{note:"A5",start:22.5,dur:.5},{note:"G5",start:23,dur:1},
      {note:"Bb4",start:24,dur:1},{note:"C5",start:25,dur:.5},{note:"D5",start:25.5,dur:.5},
      {note:"F5",start:26,dur:1},{note:"G5",start:27,dur:1},
      {note:"G5",start:28,dur:.5},{note:"F5",start:28.5,dur:.5},{note:"Eb5",start:29,dur:.5},{note:"D5",start:29.5,dur:.5},
      {note:"F5",start:30,dur:1},{note:"Bb4",start:31,dur:1}
    ],
    pulse2:[
      {note:"D4",start:0,dur:1},{note:"F4",start:1,dur:1},{note:"D4",start:2,dur:1},{note:"C4",start:3,dur:1},
      {note:"G3",start:4,dur:2},{note:"Bb3",start:6,dur:2},
      {note:"Eb4",start:8,dur:2},{note:"G3",start:10,dur:2},
      {note:"Bb3",start:12,dur:2},{note:"F3",start:14,dur:2},
      {note:"Eb4",start:16,dur:2},{note:"F3",start:18,dur:2},
      {note:"D4",start:20,dur:2},{note:"Bb3",start:22,dur:2},
      {note:"D4",start:24,dur:2},{note:"F4",start:26,dur:2},
      {note:"Eb4",start:28,dur:2},{note:"Bb3",start:30,dur:2}
    ],
    triangle:[
      {note:"Bb1",start:0,dur:4},{note:"G1",start:4,dur:4},
      {note:"Eb3",start:8,dur:4},{note:"F2",start:12,dur:4},
      {note:"Eb3",start:16,dur:4},{note:"F2",start:20,dur:4},
      {note:"Bb1",start:24,dur:4},{note:"F2",start:28,dur:4}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"snare",start:9},{drum:"kick",start:10},{drum:"snare",start:11},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5},
      {drum:"kick",start:16},{drum:"hat",start:16.5},{drum:"snare",start:17},{drum:"hat",start:17.5},
      {drum:"kick",start:18},{drum:"hat",start:18.5},{drum:"snare",start:19},{drum:"hat",start:19.5},
      {drum:"kick",start:20},{drum:"hat",start:20.5},{drum:"snare",start:21},{drum:"hat",start:21.5},
      {drum:"kick",start:22},{drum:"hat",start:22.5},{drum:"snare",start:23},{drum:"hat",start:23.5},
      {drum:"kick",start:24},{drum:"hat",start:24.5},{drum:"snare",start:25},{drum:"hat",start:25.5},
      {drum:"kick",start:26},{drum:"hat",start:26.5},{drum:"snare",start:27},{drum:"hat",start:27.5},
      {drum:"kick",start:28},{drum:"hat",start:28.5},{drum:"snare",start:29},{drum:"hat",start:29.5},
      {drum:"kick",start:30},{drum:"hat",start:30.5},{drum:"snare",start:31},{drum:"hat",start:31.5}
    ]
  }};
  var DRIVE_TRACK={bpm:96,loopBeats:32,channels:{
    pulse1:[
      {note:"D5",start:0,dur:1},{note:"F5",start:1,dur:.5},{note:"E5",start:1.5,dur:.5},
      {note:"D5",start:2,dur:1.5},{note:"C5",start:3.5,dur:.5},
      {note:"Bb4",start:4,dur:1},{note:"D5",start:5,dur:.5},{note:"F5",start:5.5,dur:.5},
      {note:"Bb4",start:6,dur:1},{note:"A4",start:7,dur:1},
      {note:"F5",start:8,dur:1},{note:"A5",start:9,dur:.5},{note:"G5",start:9.5,dur:.5},
      {note:"F5",start:10,dur:1},{note:"Eb5",start:11,dur:1},
      {note:"C5",start:12,dur:1},{note:"E5",start:13,dur:.5},{note:"F5",start:13.5,dur:.5},
      {note:"G5",start:14,dur:1},{note:"F5",start:15,dur:1},
      {note:"D5",start:16,dur:.5},{note:"F5",start:16.5,dur:.25},{note:"E5",start:16.75,dur:.25},
      {note:"D5",start:17,dur:.5},{note:"C5",start:17.5,dur:.5},
      {note:"Bb4",start:18,dur:.5},{note:"D5",start:18.5,dur:.5},{note:"F5",start:19,dur:1},
      {note:"A5",start:20,dur:.5},{note:"G5",start:20.5,dur:.5},{note:"F5",start:21,dur:1},
      {note:"G5",start:22,dur:.5},{note:"F5",start:22.5,dur:.25},{note:"E5",start:22.75,dur:.25},
      {note:"D5",start:23,dur:1},
      {note:"C5",start:24,dur:1},{note:"Bb4",start:25,dur:.5},{note:"C5",start:25.5,dur:.5},
      {note:"D5",start:26,dur:.5},{note:"F5",start:26.5,dur:.5},{note:"A5",start:27,dur:1},
      {note:"Bb4",start:28,dur:1},{note:"C5",start:29,dur:.5},{note:"D5",start:29.5,dur:.5},
      {note:"F5",start:30,dur:.5},{note:"E5",start:30.5,dur:.25},{note:"D5",start:30.75,dur:.25},
      {note:"D5",start:31,dur:1}
    ],
    pulse2:[
      {note:"D4",start:0,dur:2},{note:"F4",start:2,dur:2},
      {note:"Bb3",start:4,dur:2},{note:"D4",start:6,dur:2},
      {note:"F4",start:8,dur:2},{note:"A3",start:10,dur:2},
      {note:"C4",start:12,dur:2},{note:"G3",start:14,dur:2},
      {note:"D4",start:16,dur:1},{note:"F4",start:17,dur:1},{note:"A4",start:18,dur:1},{note:"F4",start:19,dur:1},
      {note:"D4",start:20,dur:1},{note:"C4",start:21,dur:1},{note:"Bb3",start:22,dur:1},{note:"A3",start:23,dur:1},
      {note:"C4",start:24,dur:2},{note:"E4",start:26,dur:2},
      {note:"Bb3",start:28,dur:2},{note:"C4",start:30,dur:2}
    ],
    triangle:[
      {note:"D2",start:0,dur:4},{note:"Bb1",start:4,dur:4},
      {note:"F2",start:8,dur:4},{note:"C2",start:12,dur:4},
      {note:"D2",start:16,dur:2},{note:"F2",start:18,dur:2},
      {note:"Bb1",start:20,dur:2},{note:"C2",start:22,dur:2},
      {note:"C2",start:24,dur:2},{note:"A1",start:26,dur:2},
      {note:"Bb1",start:28,dur:2},{note:"D2",start:30,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:1},{drum:"snare",start:2},{drum:"hat",start:3},
      {drum:"kick",start:4},{drum:"hat",start:5},{drum:"snare",start:6},{drum:"hat",start:7},
      {drum:"kick",start:8},{drum:"hat",start:9},{drum:"snare",start:10},{drum:"hat",start:11},
      {drum:"kick",start:12},{drum:"hat",start:13},{drum:"snare",start:14},{drum:"hat",start:15},
      {drum:"kick",start:16},{drum:"hat",start:16.5},{drum:"snare",start:17},{drum:"hat",start:17.5},
      {drum:"kick",start:18},{drum:"hat",start:18.5},{drum:"snare",start:19},{drum:"hat",start:19.5},
      {drum:"kick",start:20},{drum:"hat",start:20.5},{drum:"snare",start:21},{drum:"hat",start:21.5},
      {drum:"kick",start:22},{drum:"hat",start:22.5},{drum:"snare",start:23},{drum:"hat",start:23.5},
      {drum:"kick",start:24},{drum:"hat",start:24.5},{drum:"snare",start:25},{drum:"hat",start:25.5},
      {drum:"kick",start:26},{drum:"hat",start:26.5},{drum:"snare",start:27},{drum:"hat",start:27.5},
      {drum:"kick",start:28},{drum:"hat",start:28.5},{drum:"snare",start:29},{drum:"hat",start:29.5},
      {drum:"kick",start:30},{drum:"hat",start:30.5},{drum:"snare",start:31},{drum:"hat",start:31.5}
    ]
  }};
  var WAKEUP_TRACK={bpm:120,loopBeats:32,channels:{
    pulse1:[
      {note:"C5",start:0,dur:.25},{note:"Eb5",start:.25,dur:.25},{note:"F5",start:.5,dur:.25},{note:"Eb5",start:.75,dur:.25},
      {note:"C5",start:1,dur:.5},{note:"G4",start:1.5,dur:.5},
      {note:"Ab4",start:2,dur:.25},{note:"C5",start:2.25,dur:.25},{note:"Eb5",start:2.5,dur:.25},{note:"C5",start:2.75,dur:.25},
      {note:"Ab4",start:3,dur:1},
      {note:"Eb5",start:4,dur:.5},{note:"G5",start:4.5,dur:.5},{note:"Bb4",start:5,dur:.5},{note:"G5",start:5.5,dur:.5},
      {note:"Eb5",start:6,dur:.5},{note:"Bb4",start:6.5,dur:.5},
      {note:"G4",start:7,dur:1},
      {note:"C5",start:8,dur:.25},{note:"Eb5",start:8.25,dur:.25},{note:"F5",start:8.5,dur:.25},{note:"Eb5",start:8.75,dur:.25},
      {note:"G5",start:9,dur:.5},{note:"Eb5",start:9.5,dur:.5},
      {note:"Ab4",start:10,dur:.5},{note:"C5",start:10.5,dur:.25},{note:"Eb5",start:10.75,dur:.25},
      {note:"F5",start:11,dur:1},
      {note:"Eb5",start:12,dur:.5},{note:"G5",start:12.5,dur:.5},
      {note:"Bb5",start:13,dur:.5},{note:"Ab5",start:13.5,dur:.5},
      {note:"G4",start:14,dur:.5},{note:"B4",start:14.5,dur:.5},
      {note:"C5",start:15,dur:1},
      {note:"Ab4",start:16,dur:.5},{note:"C5",start:16.5,dur:.5},{note:"Eb5",start:17,dur:.5},{note:"Ab5",start:17.5,dur:.5},
      {note:"Ab5",start:18,dur:1},{note:"G5",start:19,dur:1},
      {note:"Bb4",start:20,dur:.5},{note:"D5",start:20.5,dur:.5},{note:"F5",start:21,dur:.5},{note:"Bb5",start:21.5,dur:.5},
      {note:"Bb5",start:22,dur:1},{note:"Ab5",start:23,dur:1},
      {note:"C5",start:24,dur:.25},{note:"Eb5",start:24.25,dur:.25},{note:"F5",start:24.5,dur:.25},{note:"Eb5",start:24.75,dur:.25},
      {note:"G5",start:25,dur:.5},{note:"C5",start:25.5,dur:.5},
      {note:"Eb5",start:26,dur:.5},{note:"G5",start:26.5,dur:.5},
      {note:"Ab5",start:27,dur:1},
      {note:"Eb5",start:28,dur:.5},{note:"G5",start:28.5,dur:.5},{note:"Bb4",start:29,dur:.5},{note:"Eb5",start:29.5,dur:.5},
      {note:"G5",start:30,dur:.5},{note:"Eb5",start:30.5,dur:.25},{note:"C5",start:30.75,dur:.25},
      {note:"C5",start:31,dur:1}
    ],
    pulse2:[
      {note:"C4",start:.5,dur:.25},{note:"G3",start:1.5,dur:.25},{note:"Ab3",start:2.5,dur:.25},{note:"Eb3",start:3.5,dur:.25},
      {note:"Eb4",start:4.5,dur:.25},{note:"Bb3",start:5.5,dur:.25},{note:"G3",start:6.5,dur:.25},{note:"D3",start:7.5,dur:.25},
      {note:"C4",start:8.5,dur:.25},{note:"G3",start:9.5,dur:.25},{note:"Ab3",start:10.5,dur:.25},{note:"Eb3",start:11.5,dur:.25},
      {note:"Eb4",start:12.5,dur:.25},{note:"G3",start:13.5,dur:.25},{note:"G3",start:14.5,dur:.25},{note:"C4",start:15.5,dur:.25},
      {note:"Ab3",start:16.5,dur:.25},{note:"Eb4",start:17.5,dur:.25},{note:"Ab4",start:18.5,dur:.25},{note:"C4",start:19.5,dur:.25},
      {note:"Bb3",start:20.5,dur:.25},{note:"F3",start:21.5,dur:.25},{note:"Bb4",start:22.5,dur:.25},{note:"D4",start:23.5,dur:.25},
      {note:"C4",start:24.5,dur:.25},{note:"Eb3",start:25.5,dur:.25},{note:"G3",start:26.5,dur:.25},{note:"C4",start:27.5,dur:.25},
      {note:"Eb4",start:28.5,dur:.25},{note:"Bb3",start:29.5,dur:.25},{note:"G3",start:30.5,dur:.25},{note:"C4",start:31.5,dur:.25}
    ],
    triangle:[
      {note:"C2",start:0,dur:4},{note:"G#2",start:4,dur:4},
      {note:"Eb3",start:8,dur:4},{note:"G2",start:12,dur:4},
      {note:"G#2",start:16,dur:4},{note:"Bb1",start:20,dur:4},
      {note:"C2",start:24,dur:4},{note:"Eb3",start:28,dur:4}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"kick",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"kick",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5},
      {drum:"kick",start:16},{drum:"hat",start:16.5},{drum:"snare",start:17},{drum:"hat",start:17.5},
      {drum:"kick",start:18},{drum:"kick",start:18.5},{drum:"snare",start:19},{drum:"hat",start:19.5},
      {drum:"kick",start:20},{drum:"hat",start:20.5},{drum:"snare",start:21},{drum:"hat",start:21.5},
      {drum:"kick",start:22},{drum:"hat",start:22.5},{drum:"snare",start:23},{drum:"hat",start:23.5},
      {drum:"kick",start:24},{drum:"hat",start:24.5},{drum:"snare",start:25},{drum:"hat",start:25.5},
      {drum:"kick",start:26},{drum:"kick",start:26.5},{drum:"snare",start:27},{drum:"hat",start:27.5},
      {drum:"kick",start:28},{drum:"hat",start:28.5},{drum:"snare",start:29},{drum:"hat",start:29.5},
      {drum:"kick",start:30},{drum:"hat",start:30.5},{drum:"snare",start:31},{drum:"hat",start:31.5}
    ]
  }};
  var AFTERBURN_TRACK={bpm:102,loopBeats:16,channels:{
    pulse1:[
      {note:"E5",start:0,dur:.5},{note:"G5",start:.5,dur:.25},{note:"A5",start:.75,dur:.25},
      {note:"G5",start:1,dur:1},{note:"D5",start:2,dur:.5},{note:"F5",start:2.5,dur:.25},{note:"E5",start:2.75,dur:.25},
      {note:"D5",start:3,dur:1},{note:"C5",start:4,dur:.5},{note:"E5",start:4.5,dur:.5},{note:"D5",start:5,dur:.5},{note:"C5",start:5.5,dur:.5},
      {note:"B4",start:6,dur:.5},{note:"A4",start:6.5,dur:.25},{note:"C5",start:6.75,dur:.25},{note:"A4",start:7,dur:1},
      {note:"E5",start:8,dur:.5},{note:"G5",start:8.5,dur:.5},{note:"A5",start:9,dur:1},
      {note:"G5",start:10,dur:.5},{note:"F5",start:10.5,dur:.5},{note:"G5",start:11,dur:1},
      {note:"D5",start:12,dur:.5},{note:"E5",start:12.5,dur:.5},{note:"D5",start:13,dur:1},
      {note:"E5",start:14,dur:.5},{note:"G5",start:14.5,dur:.5},{note:"E5",start:15,dur:1}
    ],
    pulse2:[
      {note:"E4",start:.5,dur:.25},{note:"G3",start:1.5,dur:.25},{note:"D4",start:2.5,dur:.25},{note:"A3",start:3.5,dur:.25},
      {note:"C4",start:4.5,dur:.25},{note:"E3",start:5.5,dur:.25},{note:"B3",start:6.5,dur:.25},{note:"A3",start:7.5,dur:.25},
      {note:"E4",start:8.5,dur:.25},{note:"A3",start:9.5,dur:.25},{note:"G3",start:10.5,dur:.25},{note:"D4",start:11.5,dur:.25},
      {note:"D4",start:12.5,dur:.25},{note:"A3",start:13.5,dur:.25},{note:"E4",start:14.5,dur:.25},{note:"G3",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"E2",start:0,dur:2},{note:"E2",start:2,dur:.5},{note:"B1",start:2.5,dur:.5},
      {note:"C2",start:4,dur:2},{note:"D2",start:6,dur:2},{note:"B1",start:8,dur:2},{note:"A1",start:10,dur:2},
      {note:"G2",start:12,dur:2},{note:"E2",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"kick",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var LOBBY_TRACK={bpm:96,loopBeats:16,channels:{
    pulse1:[
      {note:"C5",start:0,dur:1},{note:"B4",start:1,dur:1},{note:"A4",start:2,dur:1},{note:"G4",start:3,dur:1},
      {note:"A4",start:4,dur:.5},{note:"C5",start:4.5,dur:.5},{note:"E5",start:5,dur:1},
      {note:"D5",start:6,dur:1},{note:"C5",start:7,dur:1},
      {note:"C5",start:8,dur:1},{note:"E5",start:9,dur:.5},{note:"D5",start:9.5,dur:.5},
      {note:"C5",start:10,dur:1},{note:"B4",start:11,dur:1},
      {note:"G4",start:12,dur:1},{note:"A4",start:13,dur:.5},{note:"B4",start:13.5,dur:.5},
      {note:"C5",start:14,dur:1},{note:"A4",start:15,dur:1}
    ],
    pulse2:[
      {note:"A3",start:1,dur:.25},{note:"F3",start:3,dur:.25},{note:"G3",start:5,dur:.25},{note:"E3",start:7,dur:.25},
      {note:"C4",start:9,dur:.25},{note:"G3",start:11,dur:.25},{note:"F3",start:13,dur:.25},{note:"A3",start:15,dur:.25}
    ],
    triangle:[
      {note:"A1",start:0,dur:4},{note:"F1",start:4,dur:4},{note:"G2",start:8,dur:4},{note:"E2",start:12,dur:4}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:1},{drum:"snare",start:2},{drum:"hat",start:3},
      {drum:"kick",start:4},{drum:"hat",start:5},{drum:"snare",start:6},{drum:"hat",start:7},
      {drum:"kick",start:8},{drum:"hat",start:9},{drum:"snare",start:10},{drum:"hat",start:11},
      {drum:"kick",start:12},{drum:"hat",start:13},{drum:"snare",start:14},{drum:"hat",start:15}
    ]
  }};
  var SUNNY_TRACK={bpm:108,loopBeats:16,channels:{
    pulse1:[
      {note:"F#5",start:0,dur:.5},{note:"E5",start:.5,dur:.5},{note:"D5",start:1,dur:.5},{note:"A4",start:1.5,dur:.5},
      {note:"B4",start:2,dur:1},{note:"D5",start:3,dur:1},
      {note:"F#5",start:4,dur:.5},{note:"E5",start:4.5,dur:.5},{note:"D5",start:5,dur:.5},{note:"E5",start:5.5,dur:.5},
      {note:"F#5",start:6,dur:1},{note:"A5",start:7,dur:1},
      {note:"G5",start:8,dur:.5},{note:"F#5",start:8.5,dur:.5},{note:"E5",start:9,dur:1},
      {note:"D5",start:10,dur:.5},{note:"F#5",start:10.5,dur:.5},{note:"A4",start:11,dur:1},
      {note:"B4",start:12,dur:.5},{note:"D5",start:12.5,dur:.5},{note:"F#5",start:13,dur:1},
      {note:"E5",start:14,dur:.5},{note:"D5",start:14.5,dur:.5},{note:"D5",start:15,dur:1}
    ],
    pulse2:[
      {note:"D4",start:.5,dur:.25},{note:"A3",start:1.5,dur:.25},{note:"B3",start:2.5,dur:.25},{note:"G3",start:3.5,dur:.25},
      {note:"D4",start:4.5,dur:.25},{note:"E4",start:5.5,dur:.25},{note:"D4",start:6.5,dur:.25},{note:"A3",start:7.5,dur:.25},
      {note:"G3",start:8.5,dur:.25},{note:"A3",start:9.5,dur:.25},{note:"D4",start:10.5,dur:.25},{note:"F#3",start:11.5,dur:.25},
      {note:"B3",start:12.5,dur:.25},{note:"G3",start:13.5,dur:.25},{note:"A3",start:14.5,dur:.25},{note:"D4",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"D2",start:0,dur:2},{note:"A2",start:2,dur:2},{note:"B2",start:4,dur:2},{note:"G2",start:6,dur:2},
      {note:"G2",start:8,dur:2},{note:"A2",start:10,dur:2},{note:"D2",start:12,dur:2},{note:"A1",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var PLAINS_TRACK={bpm:92,loopBeats:16,channels:{
    pulse1:[
      {note:"Bb4",start:0,dur:.25},{note:"G4",start:.25,dur:.25},{note:"F4",start:.5,dur:.5},{note:"Bb4",start:1,dur:1},
      {note:"Eb4",start:2,dur:.5},{note:"G4",start:2.5,dur:.5},{note:"Bb4",start:3,dur:1},
      {note:"F4",start:4,dur:.25},{note:"D4",start:4.25,dur:.25},{note:"Bb3",start:4.5,dur:.5},{note:"F4",start:5,dur:1},
      {note:"G4",start:6,dur:.5},{note:"Bb4",start:6.5,dur:.5},{note:"D4",start:7,dur:1},
      {note:"Bb4",start:8,dur:.25},{note:"G4",start:8.25,dur:.25},{note:"F4",start:8.5,dur:.5},{note:"G4",start:9,dur:1},
      {note:"Eb4",start:10,dur:.5},{note:"F4",start:10.5,dur:.5},{note:"G4",start:11,dur:1},
      {note:"Bb4",start:12,dur:.5},{note:"F4",start:12.5,dur:.5},{note:"G4",start:13,dur:1},
      {note:"F4",start:14,dur:.5},{note:"Eb4",start:14.5,dur:.5},{note:"D4",start:15,dur:1}
    ],
    pulse2:[
      {note:"G3",start:1,dur:.25},{note:"Eb3",start:3,dur:.25},{note:"F3",start:5,dur:.25},{note:"D3",start:7,dur:.25},
      {note:"Bb3",start:9,dur:.25},{note:"F3",start:11,dur:.25},{note:"G3",start:13,dur:.25},{note:"Eb3",start:15,dur:.25}
    ],
    triangle:[
      {note:"G1",start:0,dur:4},{note:"Eb2",start:4,dur:4},{note:"F2",start:8,dur:4},{note:"D2",start:12,dur:4}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"snare",start:1},{drum:"hat",start:2},{drum:"snare",start:3},
      {drum:"kick",start:4},{drum:"snare",start:5},{drum:"hat",start:6},{drum:"snare",start:7},
      {drum:"kick",start:8},{drum:"snare",start:9},{drum:"hat",start:10},{drum:"snare",start:11},
      {drum:"kick",start:12},{drum:"snare",start:13},{drum:"kick",start:14},{drum:"snare",start:15}
    ]
  }};
  var STEEL_TRACK={bpm:100,loopBeats:16,channels:{
    pulse1:[
      {note:"B4",start:0,dur:.5},{note:"D5",start:.5,dur:.25},{note:"E5",start:.75,dur:.25},
      {note:"F#5",start:1,dur:.5},{note:"E5",start:1.5,dur:.5},{note:"D5",start:2,dur:1},{note:"B4",start:3,dur:1},
      {note:"G4",start:4,dur:.5},{note:"A4",start:4.5,dur:.5},{note:"B4",start:5,dur:1},
      {note:"D5",start:6,dur:1},{note:"A4",start:7,dur:1},
      {note:"B4",start:8,dur:.5},{note:"D5",start:8.5,dur:.5},{note:"E5",start:9,dur:.5},{note:"F#5",start:9.5,dur:.5},
      {note:"A5",start:10,dur:.5},{note:"G5",start:10.5,dur:.5},{note:"F#5",start:11,dur:1},
      {note:"E5",start:12,dur:.5},{note:"D5",start:12.5,dur:.5},{note:"B4",start:13,dur:1},
      {note:"D5",start:14,dur:.5},{note:"F#5",start:14.5,dur:.5},{note:"B4",start:15,dur:1}
    ],
    pulse2:[
      {note:"B3",start:.5,dur:.25},{note:"G3",start:1.5,dur:.25},{note:"D4",start:2.5,dur:.25},{note:"A3",start:3.5,dur:.25},
      {note:"G3",start:4.5,dur:.25},{note:"D4",start:5.5,dur:.25},{note:"B3",start:6.5,dur:.25},{note:"A3",start:7.5,dur:.25},
      {note:"B3",start:8.5,dur:.25},{note:"F#3",start:9.5,dur:.25},{note:"G3",start:10.5,dur:.25},{note:"D4",start:11.5,dur:.25},
      {note:"E4",start:12.5,dur:.25},{note:"G3",start:13.5,dur:.25},{note:"B3",start:14.5,dur:.25},{note:"F#3",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"B1",start:0,dur:2},{note:"G2",start:2,dur:2},{note:"D2",start:4,dur:2},{note:"A1",start:6,dur:2},
      {note:"B1",start:8,dur:2},{note:"F#2",start:10,dur:2},{note:"E2",start:12,dur:2},{note:"B1",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"kick",start:9.5},
      {drum:"snare",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var SILICON_TRACK={bpm:88,loopBeats:16,channels:{
    pulse1:[
      {note:"E5",start:0,dur:2},{note:"D5",start:2,dur:2},{note:"C#5",start:4,dur:2},{note:"B4",start:6,dur:2},
      {note:"C#5",start:8,dur:1},{note:"E5",start:9,dur:1},{note:"A5",start:10,dur:1},{note:"G#5",start:11,dur:1},
      {note:"F#5",start:12,dur:1},{note:"E5",start:13,dur:1},{note:"C#5",start:14,dur:1},{note:"B4",start:15,dur:1}
    ],
    pulse2:[
      {note:"C#4",start:1,dur:.5},{note:"A3",start:3,dur:.5},{note:"E4",start:5,dur:.5},{note:"B3",start:7,dur:.5},
      {note:"C#4",start:9,dur:.5},{note:"A3",start:11,dur:.5},{note:"F#3",start:13,dur:.5},{note:"G#3",start:15,dur:.5}
    ],
    triangle:[
      {note:"C#2",start:0,dur:4},{note:"A1",start:4,dur:4},{note:"E2",start:8,dur:4},{note:"B1",start:12,dur:4}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:2},{drum:"snare",start:4},{drum:"hat",start:6},
      {drum:"kick",start:8},{drum:"hat",start:10},{drum:"snare",start:12},{drum:"hat",start:14}
    ]
  }};
  var TURNSTILE_TRACK={bpm:168,loopBeats:16,channels:{
    pulse1:[
      {note:"E5",start:0,dur:.25},{note:"G5",start:.25,dur:.25},{note:"B4",start:.5,dur:.25},{note:"G5",start:.75,dur:.25},
      {note:"E5",start:1,dur:.5},{note:"D5",start:1.5,dur:.5},
      {note:"C5",start:2,dur:.25},{note:"E5",start:2.25,dur:.25},{note:"G4",start:2.5,dur:.25},{note:"E5",start:2.75,dur:.25},
      {note:"D5",start:3,dur:1},
      {note:"G5",start:4,dur:.25},{note:"B5",start:4.25,dur:.25},{note:"D5",start:4.5,dur:.25},{note:"B5",start:4.75,dur:.25},
      {note:"G5",start:5,dur:.5},{note:"F#5",start:5.5,dur:.5},
      {note:"E5",start:6,dur:.5},{note:"G5",start:6.5,dur:.5},{note:"E5",start:7,dur:1},
      {note:"E5",start:8,dur:.25},{note:"G5",start:8.25,dur:.25},{note:"A5",start:8.5,dur:.25},{note:"G5",start:8.75,dur:.25},
      {note:"E5",start:9,dur:.5},{note:"D5",start:9.5,dur:.5},
      {note:"C5",start:10,dur:.5},{note:"D5",start:10.5,dur:.5},{note:"E5",start:11,dur:1},
      {note:"D5",start:12,dur:.5},{note:"C5",start:12.5,dur:.5},{note:"B4",start:13,dur:.5},{note:"G4",start:13.5,dur:.5},
      {note:"A4",start:14,dur:.5},{note:"B4",start:14.5,dur:.5},{note:"E5",start:15,dur:1}
    ],
    pulse2:[
      {note:"E4",start:0,dur:.25},{note:"E4",start:.5,dur:.25},{note:"C4",start:1,dur:.25},{note:"C4",start:1.5,dur:.25},
      {note:"G4",start:2,dur:.25},{note:"G4",start:2.5,dur:.25},{note:"D4",start:3,dur:.25},{note:"D4",start:3.5,dur:.25},
      {note:"G4",start:4,dur:.25},{note:"G4",start:4.5,dur:.25},{note:"G4",start:5,dur:.25},{note:"G4",start:5.5,dur:.25},
      {note:"D4",start:6,dur:.25},{note:"D4",start:6.5,dur:.25},{note:"E4",start:7,dur:.25},{note:"E4",start:7.5,dur:.25},
      {note:"E4",start:8,dur:.25},{note:"E4",start:8.5,dur:.25},{note:"C4",start:9,dur:.25},{note:"C4",start:9.5,dur:.25},
      {note:"G4",start:10,dur:.25},{note:"G4",start:10.5,dur:.25},{note:"D4",start:11,dur:.25},{note:"D4",start:11.5,dur:.25},
      {note:"D4",start:12,dur:.25},{note:"C4",start:12.5,dur:.25},{note:"C4",start:13,dur:.25},{note:"G3",start:13.5,dur:.25},
      {note:"E4",start:14,dur:.25},{note:"E4",start:14.5,dur:.25},{note:"E4",start:15,dur:.25},{note:"E4",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"E2",start:0,dur:2},{note:"C2",start:2,dur:2},{note:"G2",start:4,dur:2},{note:"D2",start:6,dur:2},
      {note:"E2",start:8,dur:2},{note:"C2",start:10,dur:2},{note:"D2",start:12,dur:2},{note:"E2",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var TAPEDECK_TRACK={bpm:158,loopBeats:16,channels:{
    pulse1:[
      {note:"A5",start:0,dur:.25},{note:"E5",start:.25,dur:.25},{note:"A5",start:.5,dur:.25},{note:"C#5",start:.75,dur:.25},
      {note:"E5",start:1,dur:.5},{note:"A4",start:1.5,dur:.5},
      {note:"F#5",start:2,dur:.5},{note:"D5",start:2.5,dur:.5},{note:"A4",start:3,dur:1},
      {note:"E5",start:4,dur:.25},{note:"C#5",start:4.25,dur:.25},{note:"A4",start:4.5,dur:.5},
      {note:"B4",start:5,dur:.5},{note:"D5",start:5.5,dur:.5},
      {note:"E5",start:6,dur:.5},{note:"C#5",start:6.5,dur:.5},{note:"A4",start:7,dur:1},
      {note:"A5",start:8,dur:.5},{note:"G#5",start:8.5,dur:.5},{note:"F#5",start:9,dur:1},
      {note:"E5",start:10,dur:.5},{note:"D5",start:10.5,dur:.5},{note:"C#5",start:11,dur:1},
      {note:"B4",start:12,dur:.5},{note:"A4",start:12.5,dur:.5},{note:"C#5",start:13,dur:.5},{note:"E5",start:13.5,dur:.5},
      {note:"A5",start:14,dur:.5},{note:"E5",start:14.5,dur:.5},{note:"A4",start:15,dur:1}
    ],
    pulse2:[
      {note:"A4",start:0,dur:.25},{note:"E4",start:.5,dur:.25},{note:"D4",start:1,dur:.25},{note:"A3",start:1.5,dur:.25},
      {note:"D4",start:2,dur:.25},{note:"A3",start:2.5,dur:.25},{note:"A4",start:3,dur:.25},{note:"E4",start:3.5,dur:.25},
      {note:"E4",start:4,dur:.25},{note:"B3",start:4.5,dur:.25},{note:"E4",start:5,dur:.25},{note:"B3",start:5.5,dur:.25},
      {note:"A4",start:6,dur:.25},{note:"E4",start:6.5,dur:.25},{note:"A4",start:7,dur:.25},{note:"E4",start:7.5,dur:.25},
      {note:"A4",start:8,dur:.25},{note:"E4",start:8.5,dur:.25},{note:"D4",start:9,dur:.25},{note:"A3",start:9.5,dur:.25},
      {note:"D4",start:10,dur:.25},{note:"A3",start:10.5,dur:.25},{note:"E4",start:11,dur:.25},{note:"A3",start:11.5,dur:.25},
      {note:"A4",start:12,dur:.25},{note:"E4",start:12.5,dur:.25},{note:"A4",start:13,dur:.25},{note:"E4",start:13.5,dur:.25},
      {note:"E4",start:14,dur:.25},{note:"A4",start:14.5,dur:.25},{note:"E4",start:15,dur:.25},{note:"A4",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"A1",start:0,dur:2},{note:"E2",start:2,dur:2},{note:"F#2",start:4,dur:2},{note:"D2",start:6,dur:2},
      {note:"A1",start:8,dur:2},{note:"E2",start:10,dur:2},{note:"D2",start:12,dur:2},{note:"E2",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var BACKFIELD_TRACK={bpm:174,loopBeats:16,channels:{
    pulse1:[
      {note:"D5",start:0,dur:.25},{note:"F#5",start:.25,dur:.25},{note:"A4",start:.5,dur:.25},{note:"D5",start:.75,dur:.25},
      {note:"A5",start:1,dur:.5},{note:"G5",start:1.5,dur:.5},
      {note:"F#5",start:2,dur:.5},{note:"E5",start:2.5,dur:.5},{note:"D5",start:3,dur:1},
      {note:"B4",start:4,dur:.5},{note:"D5",start:4.5,dur:.5},{note:"F#5",start:5,dur:.5},{note:"A4",start:5.5,dur:.5},
      {note:"G5",start:6,dur:.5},{note:"F#5",start:6.5,dur:.5},{note:"D5",start:7,dur:1},
      {note:"A5",start:8,dur:.5},{note:"G5",start:8.5,dur:.5},{note:"F#5",start:9,dur:1},
      {note:"E5",start:10,dur:.5},{note:"D5",start:10.5,dur:.5},{note:"A4",start:11,dur:1},
      {note:"D5",start:12,dur:.25},{note:"F#5",start:12.25,dur:.25},{note:"A5",start:12.5,dur:.25},{note:"G5",start:12.75,dur:.25},
      {note:"F#5",start:13,dur:.5},{note:"E5",start:13.5,dur:.5},
      {note:"D5",start:14,dur:.5},{note:"A4",start:14.5,dur:.5},{note:"D5",start:15,dur:1}
    ],
    pulse2:[
      {note:"D4",start:0,dur:.25},{note:"A3",start:.5,dur:.25},{note:"D4",start:1,dur:.25},{note:"A3",start:1.5,dur:.25},
      {note:"A3",start:2,dur:.25},{note:"E3",start:2.5,dur:.25},{note:"A3",start:3,dur:.25},{note:"E3",start:3.5,dur:.25},
      {note:"B3",start:4,dur:.25},{note:"F#3",start:4.5,dur:.25},{note:"B3",start:5,dur:.25},{note:"F#3",start:5.5,dur:.25},
      {note:"G3",start:6,dur:.25},{note:"D3",start:6.5,dur:.25},{note:"G3",start:7,dur:.25},{note:"D3",start:7.5,dur:.25},
      {note:"D4",start:8,dur:.25},{note:"A3",start:8.5,dur:.25},{note:"D4",start:9,dur:.25},{note:"A3",start:9.5,dur:.25},
      {note:"A3",start:10,dur:.25},{note:"E3",start:10.5,dur:.25},{note:"A3",start:11,dur:.25},{note:"E3",start:11.5,dur:.25},
      {note:"D4",start:12,dur:.25},{note:"A3",start:12.5,dur:.25},{note:"G3",start:13,dur:.25},{note:"D3",start:13.5,dur:.25},
      {note:"A3",start:14,dur:.25},{note:"E3",start:14.5,dur:.25},{note:"D4",start:15,dur:.25},{note:"A3",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"D2",start:0,dur:1.5},{note:"A1",start:1.5,dur:.5},{note:"A1",start:2,dur:1.5},{note:"E2",start:3.5,dur:.5},
      {note:"B1",start:4,dur:2},{note:"G2",start:6,dur:2},{note:"D2",start:8,dur:2},{note:"A1",start:10,dur:2},
      {note:"D2",start:12,dur:1},{note:"G2",start:13,dur:1},{note:"A1",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var GHOSTS_TRACK={bpm:182,loopBeats:16,channels:{
    pulse1:[
      {note:"G5",start:0,dur:.25},{note:"F5",start:.25,dur:.25},{note:"Eb5",start:.5,dur:.25},{note:"D5",start:.75,dur:.25},
      {note:"C5",start:1,dur:.5},{note:"Bb4",start:1.5,dur:.5},
      {note:"G5",start:2,dur:.5},{note:"Eb5",start:2.5,dur:.5},{note:"D5",start:3,dur:1},
      {note:"Eb5",start:4,dur:.5},{note:"G5",start:4.5,dur:.5},{note:"Bb5",start:5,dur:.5},{note:"G5",start:5.5,dur:.5},
      {note:"F5",start:6,dur:.5},{note:"Eb5",start:6.5,dur:.5},{note:"D5",start:7,dur:1},
      {note:"G5",start:8,dur:.25},{note:"F5",start:8.25,dur:.25},{note:"Eb5",start:8.5,dur:.25},{note:"D5",start:8.75,dur:.25},
      {note:"Bb4",start:9,dur:.5},{note:"C5",start:9.5,dur:.5},
      {note:"D5",start:10,dur:.5},{note:"Eb5",start:10.5,dur:.5},{note:"F5",start:11,dur:1},
      {note:"G5",start:12,dur:.5},{note:"Bb5",start:12.5,dur:.5},{note:"G5",start:13,dur:1},
      {note:"F5",start:14,dur:.5},{note:"Eb5",start:14.5,dur:.5},{note:"G4",start:15,dur:1}
    ],
    pulse2:[
      {note:"G3",start:0,dur:.25},{note:"G3",start:.5,dur:.25},{note:"Eb4",start:1,dur:.25},{note:"Eb4",start:1.5,dur:.25},
      {note:"Bb3",start:2,dur:.25},{note:"Bb3",start:2.5,dur:.25},{note:"F4",start:3,dur:.25},{note:"F4",start:3.5,dur:.25},
      {note:"Eb4",start:4,dur:.25},{note:"Eb4",start:4.5,dur:.25},{note:"Bb3",start:5,dur:.25},{note:"Bb3",start:5.5,dur:.25},
      {note:"F4",start:6,dur:.25},{note:"F4",start:6.5,dur:.25},{note:"G3",start:7,dur:.25},{note:"G3",start:7.5,dur:.25},
      {note:"G3",start:8,dur:.25},{note:"G3",start:8.5,dur:.25},{note:"Eb4",start:9,dur:.25},{note:"Eb4",start:9.5,dur:.25},
      {note:"Bb3",start:10,dur:.25},{note:"F3",start:10.5,dur:.25},{note:"G3",start:11,dur:.25},{note:"G3",start:11.5,dur:.25},
      {note:"Eb4",start:12,dur:.25},{note:"Bb3",start:12.5,dur:.25},{note:"F4",start:13,dur:.25},{note:"F4",start:13.5,dur:.25},
      {note:"Eb4",start:14,dur:.25},{note:"D4",start:14.5,dur:.25},{note:"G3",start:15,dur:.25},{note:"G3",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"G1",start:0,dur:2},{note:"Eb2",start:2,dur:2},{note:"Bb1",start:4,dur:2},{note:"F2",start:6,dur:2},
      {note:"G1",start:8,dur:2},{note:"Eb2",start:10,dur:2},{note:"G1",start:12,dur:2},{note:"D2",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"kick",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"kick",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var CLOCKWORK_TRACK={bpm:162,loopBeats:16,channels:{
    pulse1:[
      {note:"F#5",start:0,dur:.25},{note:"A5",start:.25,dur:.25},{note:"E5",start:.5,dur:.25},{note:"D5",start:.75,dur:.25},
      {note:"C#5",start:1,dur:.5},{note:"B4",start:1.5,dur:.5},{note:"D5",start:2,dur:.5},{note:"C#5",start:2.5,dur:.5},{note:"B4",start:3,dur:1},
      {note:"A4",start:4,dur:.25},{note:"C#5",start:4.25,dur:.25},{note:"E5",start:4.5,dur:.25},{note:"A5",start:4.75,dur:.25},
      {note:"F#5",start:5,dur:.5},{note:"E5",start:5.5,dur:.5},
      {note:"D5",start:6,dur:.5},{note:"C#5",start:6.5,dur:.5},{note:"B4",start:7,dur:1},
      {note:"F#5",start:8,dur:.5},{note:"E5",start:8.5,dur:.5},{note:"D5",start:9,dur:1},
      {note:"C#5",start:10,dur:.5},{note:"B4",start:10.5,dur:.5},{note:"A4",start:11,dur:1},
      {note:"B4",start:12,dur:.5},{note:"C#5",start:12.5,dur:.5},{note:"D5",start:13,dur:.5},{note:"E5",start:13.5,dur:.5},
      {note:"F#5",start:14,dur:.5},{note:"A5",start:14.5,dur:.5},{note:"F#5",start:15,dur:1}
    ],
    pulse2:[
      {note:"F#4",start:0,dur:.25},{note:"F#4",start:.5,dur:.25},{note:"D4",start:1,dur:.25},{note:"D4",start:1.5,dur:.25},
      {note:"A3",start:2,dur:.25},{note:"A3",start:2.5,dur:.25},{note:"E4",start:3,dur:.25},{note:"E4",start:3.5,dur:.25},
      {note:"A3",start:4,dur:.25},{note:"A3",start:4.5,dur:.25},{note:"C#4",start:5,dur:.25},{note:"C#4",start:5.5,dur:.25},
      {note:"B3",start:6,dur:.25},{note:"B3",start:6.5,dur:.25},{note:"F#3",start:7,dur:.25},{note:"F#3",start:7.5,dur:.25},
      {note:"F#4",start:8,dur:.25},{note:"F#4",start:8.5,dur:.25},{note:"D4",start:9,dur:.25},{note:"D4",start:9.5,dur:.25},
      {note:"C#4",start:10,dur:.25},{note:"A3",start:10.5,dur:.25},{note:"B3",start:11,dur:.25},{note:"F#3",start:11.5,dur:.25},
      {note:"B3",start:12,dur:.25},{note:"B3",start:12.5,dur:.25},{note:"C#4",start:13,dur:.25},{note:"C#4",start:13.5,dur:.25},
      {note:"D4",start:14,dur:.25},{note:"A3",start:14.5,dur:.25},{note:"F#4",start:15,dur:.25},{note:"C#4",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"F#2",start:0,dur:2},{note:"D2",start:2,dur:2},{note:"A1",start:4,dur:2},{note:"B1",start:6,dur:2},
      {note:"F#2",start:8,dur:2},{note:"C#2",start:10,dur:2},{note:"B1",start:12,dur:2},{note:"F#2",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var BATHROOM_TRACK={bpm:150,loopBeats:16,channels:{
    pulse1:[
      {note:"B4",start:0,dur:.5},{note:"A4",start:.5,dur:.5},{note:"G4",start:1,dur:.5},{note:"F#4",start:1.5,dur:.5},
      {note:"E4",start:2,dur:.5},{note:"D4",start:2.5,dur:.5},{note:"F#4",start:3,dur:1},
      {note:"G4",start:4,dur:.5},{note:"A4",start:4.5,dur:.5},{note:"B4",start:5,dur:1},
      {note:"D5",start:6,dur:.5},{note:"C#5",start:6.5,dur:.5},{note:"B4",start:7,dur:1},
      {note:"F#5",start:8,dur:.5},{note:"E5",start:8.5,dur:.5},{note:"D5",start:9,dur:1},
      {note:"C#5",start:10,dur:.5},{note:"B4",start:10.5,dur:.5},{note:"A4",start:11,dur:1},
      {note:"G4",start:12,dur:.5},{note:"A4",start:12.5,dur:.5},{note:"B4",start:13,dur:.5},{note:"D5",start:13.5,dur:.5},
      {note:"E5",start:14,dur:.5},{note:"F#5",start:14.5,dur:.5},{note:"B4",start:15,dur:1}
    ],
    pulse2:[
      {note:"B3",start:.5,dur:.25},{note:"B3",start:1.5,dur:.25},{note:"G3",start:2.5,dur:.25},{note:"F#3",start:3.5,dur:.25},
      {note:"G3",start:4.5,dur:.25},{note:"D4",start:5.5,dur:.25},{note:"B3",start:6.5,dur:.25},{note:"A3",start:7.5,dur:.25},
      {note:"B3",start:8.5,dur:.25},{note:"G3",start:9.5,dur:.25},{note:"F#3",start:10.5,dur:.25},{note:"A3",start:11.5,dur:.25},
      {note:"G3",start:12.5,dur:.25},{note:"D4",start:13.5,dur:.25},{note:"E4",start:14.5,dur:.25},{note:"B3",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"B1",start:0,dur:2},{note:"G2",start:2,dur:2},{note:"D2",start:4,dur:2},{note:"B1",start:6,dur:2},
      {note:"B1",start:8,dur:2},{note:"G2",start:10,dur:2},{note:"E2",start:12,dur:2},{note:"F#2",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"hat",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var NOEND_TRACK={bpm:176,loopBeats:16,channels:{
    pulse1:[
      {note:"C5",start:0,dur:.25},{note:"E5",start:.25,dur:.25},{note:"G5",start:.5,dur:.25},{note:"C5",start:.75,dur:.25},
      {note:"G5",start:1,dur:.5},{note:"F5",start:1.5,dur:.5},{note:"E5",start:2,dur:.5},{note:"D5",start:2.5,dur:.5},{note:"C5",start:3,dur:1},
      {note:"A5",start:4,dur:.25},{note:"G5",start:4.25,dur:.25},{note:"F5",start:4.5,dur:.25},{note:"E5",start:4.75,dur:.25},
      {note:"G5",start:5,dur:.5},{note:"A5",start:5.5,dur:.5},{note:"C6",start:6,dur:.5},{note:"G5",start:6.5,dur:.5},{note:"E5",start:7,dur:1},
      {note:"F5",start:8,dur:.5},{note:"G5",start:8.5,dur:.5},{note:"A5",start:9,dur:1},
      {note:"G5",start:10,dur:.5},{note:"E5",start:10.5,dur:.5},{note:"C5",start:11,dur:1},
      {note:"D5",start:12,dur:.5},{note:"F5",start:12.5,dur:.5},{note:"G5",start:13,dur:.5},{note:"A5",start:13.5,dur:.5},
      {note:"C6",start:14,dur:.5},{note:"A5",start:14.5,dur:.5},{note:"G5",start:15,dur:1}
    ],
    pulse2:[
      {note:"C4",start:0,dur:.25},{note:"G3",start:.5,dur:.25},{note:"G3",start:1,dur:.25},{note:"D3",start:1.5,dur:.25},
      {note:"G3",start:2,dur:.25},{note:"D3",start:2.5,dur:.25},{note:"C4",start:3,dur:.25},{note:"G3",start:3.5,dur:.25},
      {note:"A3",start:4,dur:.25},{note:"E3",start:4.5,dur:.25},{note:"A3",start:5,dur:.25},{note:"E3",start:5.5,dur:.25},
      {note:"G3",start:6,dur:.25},{note:"C4",start:6.5,dur:.25},{note:"E4",start:7,dur:.25},{note:"G3",start:7.5,dur:.25},
      {note:"F3",start:8,dur:.25},{note:"C4",start:8.5,dur:.25},{note:"F3",start:9,dur:.25},{note:"C4",start:9.5,dur:.25},
      {note:"G3",start:10,dur:.25},{note:"C4",start:10.5,dur:.25},{note:"E4",start:11,dur:.25},{note:"G3",start:11.5,dur:.25},
      {note:"D4",start:12,dur:.25},{note:"A3",start:12.5,dur:.25},{note:"D4",start:13,dur:.25},{note:"A3",start:13.5,dur:.25},
      {note:"C4",start:14,dur:.25},{note:"G3",start:14.5,dur:.25},{note:"G3",start:15,dur:.25},{note:"C4",start:15.5,dur:.25}
    ],
    triangle:[
      {note:"C2",start:0,dur:2},{note:"G2",start:2,dur:2},{note:"A2",start:4,dur:2},{note:"G2",start:6,dur:2},
      {note:"F2",start:8,dur:2},{note:"G2",start:10,dur:2},{note:"D2",start:12,dur:2},{note:"G2",start:14,dur:2}
    ],
    noise:[
      {drum:"kick",start:0},{drum:"hat",start:.5},{drum:"snare",start:1},{drum:"hat",start:1.5},
      {drum:"kick",start:2},{drum:"hat",start:2.5},{drum:"snare",start:3},{drum:"hat",start:3.5},
      {drum:"kick",start:4},{drum:"hat",start:4.5},{drum:"snare",start:5},{drum:"kick",start:5.5},
      {drum:"kick",start:6},{drum:"hat",start:6.5},{drum:"snare",start:7},{drum:"hat",start:7.5},
      {drum:"kick",start:8},{drum:"hat",start:8.5},{drum:"snare",start:9},{drum:"hat",start:9.5},
      {drum:"kick",start:10},{drum:"hat",start:10.5},{drum:"snare",start:11},{drum:"hat",start:11.5},
      {drum:"kick",start:12},{drum:"hat",start:12.5},{drum:"snare",start:13},{drum:"hat",start:13.5},
      {drum:"kick",start:14},{drum:"hat",start:14.5},{drum:"snare",start:15},{drum:"hat",start:15.5}
    ]
  }};
  var SONG_NAMES={
    menu:"Title Theme",hub:"Hub Groove",gameday:"Gameday",draft:"Draft Room",
    gears:"Gears in the Glow",neon:"Neon Fever Dream",legends:"Pretend We\'re Legends",
    drive:"Eight-Minute Drive",wakeup:"When I Wake Up",
    afterburn:"Afterburn Bounce",lobby:"Lobby Neon",sunny:"Sunny Circuit",
    plains:"Plains Riddim",steel:"Steel & Sun",silicon:"Silicon Reef",
    turnstile:"Neon Turnstile",tapedeck:"Tape Deck Glory",backfield:"Backfield Romance",
    ghosts:"Ghosts on 3rd Down",clockwork:"Clockwork Blitz",bathroom:"Bathroom Confessional",
    noend:"No End Zone",
    playoffs:"Playoffs Theme",victory:"Victory!",defeat:"Defeat",offseason:"Offseason"
  };
  var TRACK_META={
    legends:{vibe:"Anthem",emoji:"ðŸ†",mood:"Cinematic & uplifting",bpmLabel:"Mid"},
    gears:  {vibe:"Electronic",emoji:"âš¡",mood:"Driving synth energy",bpmLabel:"High"},
    neon:   {vibe:"Electronic",emoji:"ðŸŒƒ",mood:"Pulsing neon dance",bpmLabel:"High"},
    drive:  {vibe:"Groove",emoji:"ðŸš—",mood:"Smooth late-night cruise",bpmLabel:"Mid"},
    wakeup: {vibe:"Indie",emoji:"â˜€ï¸",mood:"Bright & optimistic",bpmLabel:"Mid"},
    afterburn:{vibe:"Reggae/Ska",emoji:"ðŸŽ·",mood:"Laid-back with bounce",bpmLabel:"Mid"},
    lobby:  {vibe:"Chill",emoji:"ðŸ›‹ï¸",mood:"Cool lobby vibes",bpmLabel:"Mid"},
    sunny:  {vibe:"Groove",emoji:"ðŸŒž",mood:"Sunny funk groove",bpmLabel:"Mid"},
    plains: {vibe:"Chill",emoji:"ðŸŒ¾",mood:"Open & spacious",bpmLabel:"Low"},
    steel:  {vibe:"Groove",emoji:"ðŸ­",mood:"Gritty city groove",bpmLabel:"Mid"},
    silicon:{vibe:"Downtempo",emoji:"ðŸ’¿",mood:"Underground electronic",bpmLabel:"Low"},
    turnstile:{vibe:"Punk",emoji:"ðŸ”¥",mood:"Fast & aggressive",bpmLabel:"Fast"},
    tapedeck:{vibe:"Indie Rock",emoji:"ðŸ“¼",mood:"Retro guitar anthem",bpmLabel:"Fast"},
    backfield:{vibe:"Punk",emoji:"ðŸŽ¸",mood:"Relentless & raw",bpmLabel:"Fast"},
    ghosts: {vibe:"Punk",emoji:"ðŸ‘»",mood:"Frenetic chaos energy",bpmLabel:"Fast"},
    clockwork:{vibe:"Alt Rock",emoji:"âš™ï¸",mood:"Tight & mechanical",bpmLabel:"Fast"},
    bathroom:{vibe:"Indie Rock",emoji:"ðŸªž",mood:"Lo-fi confessional",bpmLabel:"Fast"},
    noend:  {vibe:"Punk",emoji:"ðŸš¨",mood:"No brakes, all gas",bpmLabel:"Fast"}
  };
  var GAMEDAY_DJ={
    stateMap:{
      pregame:{vibes:["Anthem","Punk"],fallback:"legends"},
      simming:{vibes:["Electronic","Punk"],fallback:"gears"},
      win:{vibes:["Groove","Anthem","Indie"],fallback:"drive"},
      loss:{vibes:["Chill","Downtempo"],fallback:"plains"},
      playoffs:{vibes:["Electronic","Punk","Anthem"],fallback:"drive"},
      comeback:{vibes:["Punk","Alt Rock"],fallback:"turnstile"}
    },
    pickTrack:function(state,playlist){
      var cfg=GAMEDAY_DJ.stateMap[state]||GAMEDAY_DJ.stateMap.simming;
      var pool=(playlist&&playlist.length>0?playlist:Object.keys(TRACK_META)).filter(function(k){
        var meta=TRACK_META[k];
        return meta&&cfg.vibes.indexOf(meta.vibe)>=0;
      });
      if(pool.length===0)return cfg.fallback;
      var plLen=(playlist&&playlist.length)||0;
      var seed=(SEED_GLOBAL^((pool.length+1)*1315423911)^(((state||"simming").length+1)*977)^((plLen+1)*389))>>>0;
      var localRng=mulberry32(seed);
      return pool[Math.floor(localRng()*pool.length)];
    }
  };
  var SONGS={menu:TITLE_TRACK,hub:HUB_TRACK,gameday:GAMEDAY_TRACK,draft:DRAFT_TRACK,
    gears:GEARS_TRACK,neon:NEON_TRACK,legends:LEGENDS_TRACK,drive:DRIVE_TRACK,wakeup:WAKEUP_TRACK,
    afterburn:AFTERBURN_TRACK,lobby:LOBBY_TRACK,sunny:SUNNY_TRACK,
    plains:PLAINS_TRACK,steel:STEEL_TRACK,silicon:SILICON_TRACK,
    turnstile:TURNSTILE_TRACK,tapedeck:TAPEDECK_TRACK,backfield:BACKFIELD_TRACK,
    ghosts:GHOSTS_TRACK,clockwork:CLOCKWORK_TRACK,bathroom:BATHROOM_TRACK,noend:NOEND_TRACK,
    playoffs:{bpm:118,loopBeats:16,channels:{
      pulse1:[
        {note:"C5",start:0,dur:1},{note:"G5",start:1,dur:1},{note:"C5",start:2,dur:2},
        {note:"Bb4",start:4,dur:1},{note:"G4",start:5,dur:1},{note:"Eb4",start:6,dur:2},
        {note:"C5",start:8,dur:1},{note:"G5",start:9,dur:1},{note:"C5",start:10,dur:2},
        {note:"D5",start:12,dur:1},{note:"C5",start:13,dur:1},{note:"G4",start:14,dur:2}
      ],
      pulse2:[
        {note:"E4",start:0,dur:2},{note:"G4",start:2,dur:2},
        {note:"Eb4",start:4,dur:2},{note:"G4",start:6,dur:2},
        {note:"E4",start:8,dur:2},{note:"G4",start:10,dur:2},
        {note:"F4",start:12,dur:2},{note:"G4",start:14,dur:2}
      ],
      triangle:[
        {note:"C3",start:0,dur:2},{note:"C3",start:2,dur:2},
        {note:"Ab2",start:4,dur:2},{note:"Bb2",start:6,dur:2},
        {note:"C3",start:8,dur:2},{note:"C3",start:10,dur:2},
        {note:"G2",start:12,dur:2},{note:"G2",start:14,dur:2}
      ],
      noise:[
        {drum:"hat",start:0},{drum:"hat",start:1},{drum:"hat",start:2},{drum:"hat",start:3},
        {drum:"snare",start:4},{drum:"hat",start:5},{drum:"hat",start:6},{drum:"hat",start:7},
        {drum:"hat",start:8},{drum:"hat",start:9},{drum:"snare",start:10},{drum:"hat",start:11},
        {drum:"kick",start:12},{drum:"hat",start:13},{drum:"kick",start:14},{drum:"snare",start:15}
      ]
    }},
    victory:{bpm:126,loopBeats:16,channels:{
      pulse1:[
        {note:"C5",start:0,dur:.5},{note:"E5",start:.5,dur:.5},{note:"G5",start:1,dur:.5},{note:"C5",start:1.5,dur:.5},
        {note:"D5",start:2,dur:.5},{note:"F5",start:2.5,dur:.5},{note:"A5",start:3,dur:.5},{note:"D5",start:3.5,dur:.5},
        {note:"E5",start:4,dur:.5},{note:"G5",start:4.5,dur:.5},{note:"B5",start:5,dur:.5},{note:"E5",start:5.5,dur:.5},
        {note:"G5",start:6,dur:.5},{note:"E5",start:6.5,dur:.5},{note:"C5",start:7,dur:1},
        {note:"C5",start:8,dur:.5},{note:"E5",start:8.5,dur:.5},{note:"G5",start:9,dur:.5},{note:"C5",start:9.5,dur:.5},
        {note:"D5",start:10,dur:.5},{note:"F5",start:10.5,dur:.5},{note:"A5",start:11,dur:.5},{note:"D5",start:11.5,dur:.5},
        {note:"E5",start:12,dur:.5},{note:"G5",start:12.5,dur:.5},{note:"B5",start:13,dur:.5},{note:"E5",start:13.5,dur:.5},
        {note:"G5",start:14,dur:1},{note:"C5",start:15,dur:1}
      ],
      pulse2:[
        {note:"G4",start:0,dur:2},{note:"A4",start:2,dur:2},
        {note:"B4",start:4,dur:2},{note:"G4",start:6,dur:2},
        {note:"G4",start:8,dur:2},{note:"A4",start:10,dur:2},
        {note:"B4",start:12,dur:2},{note:"C5",start:14,dur:2}
      ],
      triangle:[
        {note:"C3",start:0,dur:2},{note:"D3",start:2,dur:2},
        {note:"E3",start:4,dur:2},{note:"G2",start:6,dur:2},
        {note:"C3",start:8,dur:2},{note:"D3",start:10,dur:2},
        {note:"E3",start:12,dur:2},{note:"C3",start:14,dur:2}
      ],
      noise:[
        {drum:"hat",start:0},{drum:"hat",start:1},{drum:"snare",start:2},{drum:"hat",start:3},
        {drum:"kick",start:4},{drum:"hat",start:5},{drum:"snare",start:6},{drum:"hat",start:7},
        {drum:"hat",start:8},{drum:"snare",start:9},{drum:"hat",start:10},{drum:"snare",start:11},
        {drum:"kick",start:12},{drum:"hat",start:13},{drum:"kick",start:14},{drum:"snare",start:15}
      ]
    }},
    defeat:{bpm:86,loopBeats:16,channels:{
      pulse1:[
        {note:"A4",start:0,dur:2},{note:"G4",start:2,dur:2},
        {note:"F4",start:4,dur:2},{note:"E4",start:6,dur:2},
        {note:"D4",start:8,dur:2},{note:"E4",start:10,dur:2},
        {note:"F4",start:12,dur:2},{note:"E4",start:14,dur:2}
      ],
      pulse2:[
        {note:"C4",start:0,dur:4},{note:"B3",start:4,dur:4},
        {note:"A3",start:8,dur:4},{note:"C4",start:12,dur:4}
      ],
      triangle:[
        {note:"A2",start:0,dur:4},{note:"G2",start:4,dur:4},
        {note:"F2",start:8,dur:4},{note:"C2",start:12,dur:4}
      ],
      noise:[
        {drum:"hat",start:0},{drum:"hat",start:2},
        {drum:"snare",start:4},{drum:"hat",start:6},
        {drum:"hat",start:8},{drum:"snare",start:10},
        {drum:"hat",start:12},{drum:"kick",start:14}
      ]
    }},
    offseason:{bpm:96,loopBeats:16,channels:{
      pulse1:[
        {note:"C5",start:0,dur:1},{note:"E5",start:1,dur:1},{note:"G5",start:2,dur:1},{note:"E5",start:3,dur:1},
        {note:"D5",start:4,dur:1},{note:"F5",start:5,dur:1},{note:"A5",start:6,dur:1},{note:"F5",start:7,dur:1},
        {note:"E5",start:8,dur:1},{note:"G5",start:9,dur:1},{note:"B5",start:10,dur:1},{note:"G5",start:11,dur:1},
        {note:"C5",start:12,dur:1},{note:"E5",start:13,dur:1},{note:"G5",start:14,dur:2}
      ],
      pulse2:[
        {note:"G4",start:0,dur:4},{note:"A4",start:4,dur:4},
        {note:"B4",start:8,dur:4},{note:"G4",start:12,dur:4}
      ],
      triangle:[
        {note:"C3",start:0,dur:4},{note:"D3",start:4,dur:4},
        {note:"E3",start:8,dur:4},{note:"G2",start:12,dur:4}
      ],
      noise:[
        {drum:"hat",start:0},{drum:"hat",start:1},{drum:"hat",start:2},{drum:"hat",start:3},
        {drum:"hat",start:4},{drum:"hat",start:6},
        {drum:"hat",start:8},{drum:"hat",start:10},
        {drum:"hat",start:12},{drum:"hat",start:14}
      ]
    }}
  };
  function init(){
    if(isInit) return true;
    try{
      var Ctx=window.AudioContext||window.webkitAudioContext;if(!Ctx) return false;
      ctx=new Ctx();
      masterGain=ctx.createGain();masterGain.gain.value=0;masterGain.connect(ctx.destination);
      dubDelay=ctx.createDelay();dubDelay.delayTime.value=0.32;
      var fb=ctx.createGain();fb.gain.value=0.35;
      var df=ctx.createBiquadFilter();df.type="lowpass";df.frequency.value=1200;
      dubDelay.connect(df);df.connect(fb);fb.connect(dubDelay);
      dubDelay.connect(masterGain);
      isInit=true;return true;
    }catch(e){return false;}
  }
  function resume(){try{if(ctx&&ctx.state==="suspended")ctx.resume();}catch(e){}}
  function scheduler(){
    if(!ctx||isMuted||!currentTrack) return;
    var song=SONGS[currentTrack];if(!song) return;
    var secPerBeat=60.0/song.bpm;
    var loopLen=song.loopBeats||16;
    while(nextBeatTime<ctx.currentTime+scheduleAhead){
      var beatInLoop=beatIdx%loopLen;
      var t=nextBeatTime;
      var ch=song.channels;
      if(ch.pulse1)ch.pulse1.forEach(function(n){if(Math.abs(n.start-beatInLoop)<0.01){
        playPulse(t,freq(n.note),n.dur*secPerBeat,0.14,true);}});
      if(ch.pulse2)ch.pulse2.forEach(function(n){if(Math.abs(n.start-beatInLoop)<0.01){
        playPulse(t,freq(n.note),n.dur*secPerBeat,0.08,true);}});
      if(ch.triangle)ch.triangle.forEach(function(n){if(Math.abs(n.start-beatInLoop)<0.01){
        playBass(t,freq(n.note),n.dur*secPerBeat);}});
      if(ch.noise)ch.noise.forEach(function(n){if(Math.abs(n.start-beatInLoop)<0.01){
        if(n.drum==="kick")playKick(t);
        else if(n.drum==="snare")playSnare(t);
        else if(n.drum==="hat")playHat(t+((n.start%1>.4)?SWING:0));
      }});
      var prevBeat=beatIdx;
      nextBeatTime+=secPerBeat*0.25;
      beatIdx+=0.25;
      if(Math.floor(beatIdx/loopLen)>Math.floor(prevBeat/loopLen)){
        loopCount++;
        if(loopCount>=loopTarget){advanceTrack();return;}
      }
    }
  }
  function advanceTrack(){
    if(!playlist.length)buildPlaylist();
    playlistIdx=(playlistIdx+1);
    if(playlistIdx>=playlist.length){buildPlaylist();}// reshuffle when exhausted
    var name=playlist[playlistIdx];
    stopTrack();
    currentTrack=name;
    loopCount=0;
    loopTarget=calcLoopTarget(name);
    resume();
    nextBeatTime=ctx.currentTime+0.05;
    beatIdx=0;
    loopTimer=setInterval(scheduler,40);
    scheduler();
    if(_onNext)_onNext(name);
  }
  function startTrack(name){
    if(!isInit||isMuted) return;
    if(currentTrack===name) return;
    stopTrack();
    currentTrack=name;
    loopCount=0;
    loopTarget=calcLoopTarget(name);
    resume();
    nextBeatTime=ctx.currentTime+0.05;
    beatIdx=0;
    loopTimer=setInterval(scheduler,40);
    scheduler();
    if(_onNext)_onNext(name);
  }
  function stopTrack(){
    if(loopTimer){clearInterval(loopTimer);loopTimer=null;}
    currentTrack=null;beatIdx=0;
  }
  return {
    isMuted:function(){return isMuted;},
    onToggle:function(cb){_onToggle=cb;},
    onNext:function(cb){_onNext=cb;},// v80.10: now-playing callback
    getName:function(key){return SONG_NAMES[key]||key;},// v80.10
    shuffle:function(){// v80.10: start shuffle playlist from scratch
      if(!isInit||isMuted) return;
      buildPlaylist();
      playlistIdx=-1;
      advanceTrack();
    },
    toggle:function(){
      if(!isInit){if(!init()) return isMuted;}
      resume();
      isMuted=!isMuted;
      if(masterGain)masterGain.gain.setTargetAtTime(isMuted?0:0.30,ctx.currentTime,0.08);
      if(isMuted){stopTrack();}
      else if(!currentTrack){buildPlaylist();playlistIdx=-1;advanceTrack();}// v80.10: start shuffle on unmute
      if(_onToggle)_onToggle(isMuted);
      return isMuted;
    },
    play:function(name){if(!isInit||isMuted) return;startTrack(name);},
    next:function(){if(!isInit||isMuted) return;advanceTrack();},// v80.10: skip to next
    stop:function(){stopTrack();},
    current:function(){return currentTrack;},
    trackMeta:function(){return TRACK_META;},// v93.6: expose for Jukebox screen
    pickTrack:function(state,playlist){return GAMEDAY_DJ.pickTrack(state,playlist);}// v93.18: expose for Watch Game
  };
})();
var ARCHETYPES={
  HC:["Strategist","Motivator","Disciplinarian"],
  OC:["QB Guru","Run Coordinator","Air Attack"],
  DC:["Blitz Master","DB Whisperer","Run Stuffer"]
};
var ARCH_BOOST={
  "QB Guru":{arm:3,accuracy:3},"Run Coordinator":{runBlock:3,power:3},"Air Attack":{routeRunning:3,catching:3},
  "Blitz Master":{passRush:3},"DB Whisperer":{coverage:3,ballSkills:2},"Run Stuffer":{runStop:3,tackle:2},
  "Strategist":{awareness:2},"Motivator":{speed:1,toughness:1},"Disciplinarian":{toughness:2,awareness:1}
};
var COACH_TRAITS={
  AGGRESSIVE_4TH:{label:"Aggressive 4th",icon:"ðŸŽ²",desc:"Goes for it on 4th down more often",effects:{stallReduction:0.03,bigPlayBoost:0.02}},
  REDZONE_SCRIPT:{label:"Red Zone Script",icon:"ðŸŽ¯",desc:"Deadly inside the 20",effects:{rzTdBoost:4}},
  PASS_PRO_TECH:{label:"Pass Pro Tech",icon:"ðŸ›¡ï¸",desc:"O-line plays above their rating",effects:{pocketBoost:0.04}},
  BLITZ_PACKAGES:{label:"Blitz Packages",icon:"âš¡",desc:"Creative pressure schemes",effects:{pressureBoost:0.05,bigPlayAllowed:0.02}},
  BALL_HAWKS:{label:"Ball Hawks",icon:"ðŸ¦…",desc:"Secondary creates turnovers",effects:{intBoost:0.015}},
  DISCIPLINE:{label:"Discipline",icon:"ðŸ“",desc:"Fewer mistakes, stable morale",effects:{stallReduction:0.02,moraleStability:0.08,intReduction:0.01}},
  DEV_FACTORY:{label:"Dev Factory",icon:"ðŸ”¬",desc:"Young players develop faster",effects:{devRate:0.12}},
  QB_WHISPERER:{label:"QB Whisperer",icon:"ðŸ§ ",desc:"QBs play above their level",effects:{qbBoost:3}},
  FILM_JUNKIE:{label:"Film Junkie",icon:"ðŸŽ¬",desc:"Better preparation = fewer surprises",effects:{stallReduction:0.02,counterBoost:1}},
  PLAYER_COACH:{label:"Player's Coach",icon:"ðŸ¤",desc:"Players love playing for this guy",effects:{moraleBoost:5,devRate:0.06}}
};
var ARCH_TRAIT_POOLS={
  "Strategist":["FILM_JUNKIE","AGGRESSIVE_4TH","REDZONE_SCRIPT","DISCIPLINE"],
  "Motivator":["PLAYER_COACH","DEV_FACTORY","DISCIPLINE"],
  "Disciplinarian":["DISCIPLINE","FILM_JUNKIE","PASS_PRO_TECH"],
  "QB Guru":["QB_WHISPERER","PASS_PRO_TECH","REDZONE_SCRIPT"],
  "Run Coordinator":["AGGRESSIVE_4TH","PASS_PRO_TECH","FILM_JUNKIE"],
  "Air Attack":["REDZONE_SCRIPT","AGGRESSIVE_4TH","QB_WHISPERER"],
  "Blitz Master":["BLITZ_PACKAGES","AGGRESSIVE_4TH","BALL_HAWKS"],
  "DB Whisperer":["BALL_HAWKS","DISCIPLINE","FILM_JUNKIE"],
  "Run Stuffer":["DISCIPLINE","BLITZ_PACKAGES","FILM_JUNKIE"]
};
var CLIQUE_TYPES=[
  {id:0,label:"Vets",icon:"ðŸŽ–ï¸",desc:"Experienced players who set the culture"},
  {id:1,label:"Young Core",icon:"ðŸŒ±",desc:"Hungry rookies and sophomores building chemistry"},
  {id:2,label:"Stars",icon:"â­",desc:"Top talent who expect to be the focal point"}
];
function updateCliques(team){
  if(!team.roster)return;
  var winStreak=Math.max(0,(team.streak||0));
  var loseStreak=Math.abs(Math.min(0,(team.streak||0)));
  var hasCaptain=team.roster.some(function(p){return hasTrait95(p,"captain");});// v95.6: hasTrait95
  var hasCancer=team.roster.some(function(p){return hasTrait95(p,"cancer");});
  var cliqueCounts=[0,0,0];
  team.roster.forEach(function(p){cliqueCounts[p.cliqueId||0]++;});
  team.roster.forEach(function(p){
    var delta=0;
    if(winStreak>=3)delta+=rng(2,5);
    else if(winStreak>=1)delta+=rng(0,2);
    if(loseStreak>=3)delta-=rng(3,6);
    else if(loseStreak>=1)delta-=rng(0,2);
    if(hasCaptain&&p.cliqueId===0)delta+=2;// Captains are usually vets
    if(hasTrait95(p,"cancer"))delta-=rng(2,5);// v95.6: hasTrait95
    if(hasCancer&&p.cliqueId===(team.roster.find(function(x){return hasTrait95(x,"cancer");})||{}).cliqueId)delta-=1;
    if(cliqueCounts[p.cliqueId||0]<=3)delta-=1;
    var tMods=getCoachTraitMods(team);
    if(tMods.moraleBoost>0)delta+=1;
    p.chemistry=cl((p.chemistry||60)+delta,15,100);
  });
}
function rivalryKey(a,b){var ids=[a,b].sort();return ids[0]+"|"+ids[1];}
function updateRivalryHeat(rivalries,homeId,awayId,result,isPlayoff,homePR,awayPR,year,week){
  if(!rivalries)rivalries={};
  var key=rivalryKey(homeId,awayId);
  var r=rivalries[key]||{a:homeId<awayId?homeId:awayId,b:homeId<awayId?awayId:homeId,heat:0,streakA:0,streakB:0,
    lastYear:0,lastWeek:0,seriesA:0,seriesB:0,meetings:[]};// v45: series + meetings
  var scoreDiff=Math.abs((result.home||0)-(result.away||0));
  var reasons=[];
  var homeWon=(result.home||0)>(result.away||0);
  var isUpset66=false;
  if(homePR!==undefined&&awayPR!==undefined){
    var prDiff=Math.abs((homePR||16)-(awayPR||16));
    if(prDiff>=8&&((homeWon&&homePR>awayPR)||(!homeWon&&awayPR>homePR))){isUpset66=true;reasons.push("upset (PR diff "+prDiff+")");}
  }
  var streakLen66=homeWon?(r.streakA||0):(r.streakB||0);
  var delta=RIVALRY_MATH.calcDelta(scoreDiff,!!isPlayoff,isUpset66,streakLen66);
  if(scoreDiff<=3)reasons.push("heartbreaker ("+scoreDiff+"pt)");
  else if(scoreDiff<=7)reasons.push("tight game ("+scoreDiff+"pt)");
  if(scoreDiff>=21)reasons.push("blowout disrespect");
  if(isPlayoff)reasons.push("playoff matchup");
  r.heat=Math.min(r.heat+delta,15);
  var winnerId=homeWon?homeId:awayId;
  if(winnerId===r.a){r.streakA+=1;r.streakB=0;}else{r.streakB+=1;r.streakA=0;}
  if(homeWon){if(homeId===r.a)r.seriesA=(r.seriesA||0)+1;else r.seriesB=(r.seriesB||0)+1;}
  else{if(awayId===r.a)r.seriesA=(r.seriesA||0)+1;else r.seriesB=(r.seriesB||0)+1;}
  if(!r.meetings)r.meetings=[];
  r.meetings.push({year:year||0,week:week||0,scoreH:result.home||0,scoreA:result.away||0,homeId:homeId,awayId:awayId,playoff:!!isPlayoff});
  if(r.meetings.length>5)r.meetings=r.meetings.slice(-5);// Keep last 5
  r.lastYear=year||0;r.lastWeek=week||0;
  r.tag=r.heat>=13?"BLOOD_FEUD":r.heat>=9?"BITTER":r.heat>=6?"RIVALRY":r.heat>=3?"BUDDING":"";
  rivalries[key]=r;
  return {rivalries:rivalries,key:key,delta:delta,newHeat:r.heat,reasons:reasons};
}
function decayRivalryHeat(rivalries,teams,seasonCtx){
  if(!rivalries)return{};
  var keys=Object.keys(rivalries);
  var year=seasonCtx&&seasonCtx.year?seasonCtx.year:0;
  var byId={};
  (teams||[]).forEach(function(t){byId[t.id]=t;});
  keys.forEach(function(k){
    var r=rivalries[k];if(!r)return;
    var decay=1;// Base offseason fade
    if(year&&(r.lastYear||0)<year)decay+=2;// No meeting this season = rapid cooldown
    var tA=byId[r.a],tB=byId[r.b];
    if(tA&&tB){
      var aCont=(tA.wins||0)>=10;var bCont=(tB.wins||0)>=10;
      if(!aCont&&!bCont)decay+=1;// Two mid/bad teams lose spotlight
      if(Math.abs((tA.wins||0)-(tB.wins||0))>=6)decay+=1;// One-sided rivalry cools faster
    }
    r.heat=Math.max(0,(r.heat||0)-decay);
    if(r.heat<=0){delete rivalries[k];return;}
    r.tag=r.heat>=13?"BLOOD_FEUD":r.heat>=9?"BITTER":r.heat>=6?"RIVALRY":r.heat>=3?"BUDDING":"";
  });
  return rivalries;
}
function getRivalryMod(rivalries,homeId,awayId){
  if(!rivalries)return{isRival:false,heat:0,homeMorale:0,loserPenalty:0,crowdBonus:0,injuryRisk:0,chemVolatility:0,tier:""};
  var key=rivalryKey(homeId,awayId);var r=rivalries[key];
  if(!r||r.heat<6)return{isRival:false,heat:r?r.heat:0,homeMorale:0,loserPenalty:0,crowdBonus:0,injuryRisk:0,chemVolatility:0,tier:""};
  if(r.heat>=13)return{isRival:true,heat:r.heat,homeMorale:2,loserPenalty:-2,crowdBonus:2,injuryRisk:0.02,chemVolatility:3,tier:"BLOOD_FEUD",tag:r.tag,series:r};
  if(r.heat>=9)return{isRival:true,heat:r.heat,homeMorale:2,loserPenalty:-1,crowdBonus:2,injuryRisk:0.01,chemVolatility:2,tier:"BITTER",tag:r.tag,series:r};
  return{isRival:true,heat:r.heat,homeMorale:1,loserPenalty:-1,crowdBonus:1,injuryRisk:0,chemVolatility:1,tier:"RIVALRY",tag:r.tag,series:r};
}
function getTopRivalries(rivalries,teamId,limit){
  if(!rivalries)return[];
  return Object.keys(rivalries).filter(function(k){var r=rivalries[k];return r.a===teamId||r.b===teamId;})
    .map(function(k){return rivalries[k];}).sort(function(a,b){return b.heat-a.heat;}).slice(0,limit||3);
}
var ROLE_DEFS={
  RB:[{id:"rb1",label:"RB1 (Bellcow)",snapPct:65},{id:"3rd_down",label:"3rd Down Back",snapPct:25},{id:"goal_line",label:"Goal Line",snapPct:10}],
  WR:[{id:"wr_x",label:"X (Outside)",snapPct:45},{id:"wr_slot",label:"Slot",snapPct:35},{id:"wr_deep",label:"Deep Threat",snapPct:20}],
  DL:[{id:"pass_rush",label:"Pass Rusher",snapPct:55},{id:"run_stop",label:"Run Stopper",snapPct:45}],
  LB:[{id:"pass_rush_lb",label:"Blitzer",snapPct:40},{id:"coverage_lb",label:"Coverage",snapPct:35},{id:"run_stop_lb",label:"Run Stopper",snapPct:25}]
};
function assignDefaultRoles(roster){
  var byPos={};roster.forEach(function(p){if(!byPos[p.pos])byPos[p.pos]=[];byPos[p.pos].push(p);});
  ["RB","WR","DL","LB"].forEach(function(pos){
    var players=(byPos[pos]||[]).filter(function(p){return !(p.injury&&p.injury.games>0);}).sort(function(a,b){return b.ovr-a.ovr;});
    var roles=ROLE_DEFS[pos];if(!roles||!players.length)return;
    players.forEach(function(p,i){
      var newRole=i<roles.length?roles[i].id:roles[roles.length-1].id;
      if(p.role===newRole){p.roleWeeks=(p.roleWeeks||0)+1;}
      else{p.role=newRole;p.roleWeeks=0;}
    });
  });
}
function getRoleSnapPct(pos,roleId){
  var roles=ROLE_DEFS[pos];if(!roles)return 100;
  var r=roles.find(function(d){return d.id===roleId;});
  return r?r.snapPct:50;
}
function checkHateWeek(rivalries,teamId,opponentId){
  if(!rivalries)return null;
  var key=rivalryKey(teamId,opponentId);var r=rivalries[key];
  if(!r||r.heat<9)return null;
  var tier=r.heat>=13?"BLOOD_FEUD":r.heat>=9?"BITTER":"RIVALRY";
  return{isHateWeek:true,heat:r.heat,tier:tier,series:r,
    seriesRecord:(r.a===teamId?(r.seriesA||0)+"-"+(r.seriesB||0):(r.seriesB||0)+"-"+(r.seriesA||0))};
}
// Dynasty analytics functions â†’ extracted to src/systems/dynasty-analytics.js (module swap #13 â€” part 1)
function generateReceipts(gameResult,reason){
  if(!gameResult||!gameResult.drives)return[];
  var drives=gameResult.drives||[];
  var receipts=[];
  if(reason.key==="pressureRate"||reason.key==="pocket"){
    drives.forEach(function(dr,di){
      if(dr.type==="SACK")receipts.push({drive:di+1,text:"Drive "+(di+1)+": "+dr.d,type:"sack"});
      if(dr.d&&dr.d.indexOf("Pressure")>=0)receipts.push({drive:di+1,text:"Drive "+(di+1)+": "+dr.d,type:"pressure"});
      if(dr.d&&dr.d.indexOf("Clean pocket")>=0)receipts.push({drive:di+1,text:"Drive "+(di+1)+": "+dr.d,type:"clean"});
    });
  }
  if(reason.key==="turnovers"||reason.key==="int"){
    drives.forEach(function(dr,di){
      if(dr.type==="INT"||dr.type==="FUMBLE")receipts.push({drive:di+1,text:"Drive "+(di+1)+": "+dr.d,type:"turnover"});
    });
  }
  if(reason.key==="redZone"||reason.key==="rzEff"){
    drives.forEach(function(dr,di){
      if(dr.type&&dr.type.indexOf("TD")>=0)receipts.push({drive:di+1,text:"Drive "+(di+1)+": "+dr.d,type:"td"});
      if(dr.type==="FG")receipts.push({drive:di+1,text:"Drive "+(di+1)+": "+dr.d,type:"fg"});
      if(dr.type==="FG_MISS")receipts.push({drive:di+1,text:"Drive "+(di+1)+": "+dr.d,type:"miss"});
    });
  }
  if(reason.key==="runLanes"||reason.key==="runLaneAdv"){
    drives.forEach(function(dr,di){
      if(dr.d&&dr.d.indexOf("BREAKAWAY")>=0)receipts.push({drive:di+1,text:"Drive "+(di+1)+": "+dr.d,type:"breakaway"});
      if(dr.type&&dr.type.indexOf("Rush")>=0)receipts.push({drive:di+1,text:"Drive "+(di+1)+": "+dr.d,type:"rush_td"});
    });
  }
  return receipts.slice(0,5);
}
var FIX_IT_DRILLS={
  pressureRate:{drill:"Pass Pro Emphasis",action:"Reduce pressure rate this week",icon:"ðŸ›¡ï¸",fix:"quick_pass"},
  pocket:{drill:"Pass Pro Emphasis",action:"Focus OL assignments â€” reduce pressure rate",icon:"ðŸ›¡ï¸",fix:"quick_pass"},
  turnovers:{drill:"Ball Security",action:"QB conservative gameplan + protect the football",icon:"ðŸˆ",fix:"conservative"},
  int:{drill:"Ball Security",action:"QB safe reads â€” reduce interception risk",icon:"ðŸˆ",fix:"conservative"},
  redZone:{drill:"Red Zone Package",action:"Tweak red zone playcalling for higher conversion",icon:"ðŸŽ¯",fix:"red_zone"},
  rzEff:{drill:"Red Zone Package",action:"Install goal-line heavy sets â€” score TDs not FGs",icon:"ðŸŽ¯",fix:"red_zone"},
  runLanes:{drill:"Run Blocking Emphasis",action:"Power run focus â€” create lanes for RB",icon:"ðŸƒ",fix:"power_run"},
  runLaneAdv:{drill:"Run Blocking Emphasis",action:"Heavy sets â€” establish the run game",icon:"ðŸƒ",fix:"power_run"},
  coverageWin:{drill:"Coverage Emphasis",action:"Man-press or zone shell â€” limit explosive plays",icon:"ðŸ“¡",fix:"coverage"}
};
var MOMENT_CATEGORIES={
  upset:{label:"Upset",emoji:"ðŸ˜±",check:function(m){return m.gravity&&m.gravity>=3&&m.text&&m.text.indexOf("upset")>=0;}},
  playoff:{label:"Playoff Heartbreak",emoji:"ðŸ’”",check:function(m){return m.text&&(m.text.indexOf("playoff")>=0||m.text.indexOf("championship")>=0);}},
  revenge:{label:"Revenge Game",emoji:"ðŸ˜¤",check:function(m){return m.text&&m.text.indexOf("revenge")>=0;}},
  blowout:{label:"Blowout",emoji:"ðŸ’¥",check:function(m){return m.margin&&m.margin>=21;}},
  thriller:{label:"Thriller",emoji:"âš¡",check:function(m){return m.margin!==undefined&&m.margin<=3;}}
};
function categorizeMoment(m){
  var cats=[];
  Object.keys(MOMENT_CATEGORIES).forEach(function(k){
    if(MOMENT_CATEGORIES[k].check(m))cats.push(k);
  });
  return cats.length>0?cats:["general"];
}
function buildRivalryTrophyCase(rivalry){
  var trophies=[];
  var winsA=rivalry.seriesA||0;var winsB=rivalry.seriesB||0;
  if(winsA>winsB)trophies.push({label:"Most Wins",value:winsA+"-"+winsB,winner:"a"});
  else if(winsB>winsA)trophies.push({label:"Most Wins",value:winsB+"-"+winsA,winner:"b"});
  else trophies.push({label:"Most Wins",value:"Tied "+winsA+"-"+winsB,winner:"tie"});
  var streakA=rivalry.streakA||0;var streakB=rivalry.streakB||0;
  if(streakA>0)trophies.push({label:"Current Streak",value:streakA+"W",winner:"a"});
  else if(streakB>0)trophies.push({label:"Current Streak",value:streakB+"W",winner:"b"});
  var biggest=null;
  (rivalry.moments||[]).forEach(function(m){
    if(m.margin&&(!biggest||m.margin>biggest.margin))biggest=m;
  });
  if(biggest)trophies.push({label:"Biggest Blowout",value:biggest.margin+"pts (Yr"+biggest.year+")",winner:"moment"});
  return trophies;
}
function buildRivalryLadder(rivalries,teams){
  if(!rivalries)return[];
  return Object.keys(rivalries).map(function(k){
    var r=rivalries[k];
    var tA=teams.find(function(t){return t.id===r.a;});
    var tB=teams.find(function(t){return t.id===r.b;});
    var recentMoments=(r.moments||[]).slice(-3).reverse().map(function(m){
      m.categories=categorizeMoment(m);return m;
    });
    var emoji=r.heat>=13?"ðŸ”¥ðŸ”¥ðŸ”¥":r.heat>=9?"ðŸ”¥ðŸ”¥":r.heat>=6?"ðŸ”¥":"";
    var trophies=buildRivalryTrophyCase(r);
    return{key:k,heat:r.heat||0,tier:r.heat>=13?"BLOOD_FEUD":r.heat>=9?"BITTER":r.heat>=6?"HEATED":"WARM",
      t1:tA,t2:tB,seriesRecord:(r.seriesA||0)+"-"+(r.seriesB||0),
      moments:recentMoments,emoji:emoji,meetings:r.meetings||0,trophies:trophies};
  }).filter(function(r){return r.heat>=4;}).sort(function(a,b){return b.heat-a.heat;}).slice(0,10);
}
var RIVALRY_FUEL_EVENT_TEMPLATES=[
  {id:"trash_talk",text:"{teamA} coach calls {teamB} 'overrated' at press conference",heat:1,emoji:"ðŸ—£ï¸"},
  {id:"controversial_call",text:"Refs' controversial call in {teamA} vs {teamB} sparks debate",heat:2,emoji:"ðŸŸ¨"},
  {id:"injury_revenge",text:"{teamA} player vows revenge after {teamB} hit injured star",heat:2,emoji:"ðŸ˜¤"},
  {id:"fans_chant",text:"{teamA} fans unveil brutal chant targeting {teamB}",heat:1,emoji:"ðŸ“¢"},
  {id:"social_media",text:"{teamA} WR posts cryptic message about {teamB} secondary",heat:1,emoji:"ðŸ“±"},
  {id:"coach_history",text:"{teamA} HC has bad blood with {teamB} from previous tenure",heat:2,emoji:"ðŸ§Š"}
];
function generateFuelEvent(teamA,teamB,rng2){
  var tmpl=FUEL_EVENT_TEMPLATES[Math.floor(rng2*FUEL_EVENT_TEMPLATES.length)];
  return{text:tmpl.text.replace(/\{teamA\}/g,teamA.abbr).replace(/\{teamB\}/g,teamB.abbr),
    heat:tmpl.heat,emoji:tmpl.emoji,id:tmpl.id};
}
function generateHighlights(gameResult){
  if(!gameResult||!gameResult.drives)return[];
  var highlights=[];var drives=gameResult.drives||[];
  var swingDrive=null;var maxSwing=0;
  drives.forEach(function(d,i){
    if(d.pts&&d.pts>0){var swing=d.pts+(d.turnover?7:0);
      if(swing>maxSwing){maxSwing=swing;swingDrive={idx:i,drive:d,swing:swing};}}
  });
  if(swingDrive)highlights.push({type:"swing",icon:"âš¡",text:swingDrive.drive.team+" scored "+swingDrive.drive.pts+" on a "+
    (swingDrive.drive.type||"drive")+" â€” biggest momentum shift of the game"});
  var bigStop=drives.find(function(d){return d.turnover||d.type==="INT"||d.type==="FUM";});
  if(bigStop)highlights.push({type:"stop",icon:"ðŸ›¡ï¸",text:(bigStop.defTeam||"Defense")+" forced a "+(bigStop.type||"turnover")+" â€” momentum killer"});
  var longestTD=null;var maxPlays=0;
  drives.forEach(function(d){if(d.pts>=6&&(d.plays||0)>maxPlays){maxPlays=d.plays||0;longestTD=d;}});
  if(longestTD&&longestTD!==swingDrive)highlights.push({type:"clutch",icon:"ðŸŽ¯",text:longestTD.team+" converted a "+maxPlays+"-play TD drive â€” patience wins"});
  if(highlights.length<2&&gameResult.home!==undefined){
    var margin=Math.abs((gameResult.home||0)-(gameResult.away||0));
    if(margin<=7)highlights.push({type:"close",icon:"ðŸ˜¤",text:"A "+margin+"-point game decided in the final drives"});
  }
  return highlights.slice(0,3);
}
// calcDominanceScore, ERA_THRESHOLD, ALMANAC_SCHEMA_VERSION, generateEraCards â†’ extracted to src/systems/dynasty-analytics.js (module swap #13 â€” part 2)
var MOMENT_GRAVITY={thriller:1,upset:2,playoff:3,elimination:4,championship:5};
function addRivalryMoment(rivalries,key,moment){
  if(!rivalries||!rivalries[key])return;
  if(!rivalries[key].moments)rivalries[key].moments=[];
  moment.gravity=MOMENT_GRAVITY[moment.type]||1;
  rivalries[key].moments.push(moment);
  if(rivalries[key].moments.length>10)rivalries[key].moments=rivalries[key].moments.slice(-10);
}
function getBiggestMoment(moments){
  if(!moments||moments.length===0)return null;
  return moments.slice().sort(function(a,b){return (b.gravity||0)-(a.gravity||0);})[0];
}
function getMostRecentMoment(moments){
  if(!moments||moments.length===0)return null;
  return moments[moments.length-1];
}
// generateHallPlaque, buildHallOfSeasons â†’ extracted to src/systems/dynasty-analytics.js (module swap #13 â€” part 3)
var FUEL_EVENT_TEMPLATES=[
  {type:"trash_talk",text:"{team1} coach calls {team2} 'overrated' in press conference",heat:1,emoji:"ðŸ—£ï¸"},
  {type:"controversial_call",text:"Controversial call in {team1} vs {team2} â€” fans are furious",heat:2,emoji:"ðŸ“¢"},
  {type:"injury_revenge",text:"{team1} star returns from injury caused by {team2} hit",heat:2,emoji:"ðŸ¥"},
  {type:"draft_steal",text:"{team1} drafted player {team2} was targeting â€” grudge formed",heat:1,emoji:"ðŸ“‹"},
  {type:"blowout_memory",text:"{team2} hasn't forgotten the {margin}-point blowout",heat:1,emoji:"ðŸ˜¤"},
  {type:"coaching_defection",text:"Former {team2} coach now leads {team1} â€” bad blood",heat:2,emoji:"ðŸ”„"}
];
// v99.2: pick rivalry trash talk line from RIVALRY_TRASH_991 based on heat
function pickRivalryTrash991(heat,rng2){
  if(!RIVALRY_TRASH_991)return null;
  var pool=heat>=13?RIVALRY_TRASH_991.atomic:heat>=9?RIVALRY_TRASH_991.spicy:RIVALRY_TRASH_991.mild;
  if(!pool||!pool.length)return null;
  return pool[Math.floor((rng2?rng2():Math.random())*pool.length)];
}
function generateRivalryFuelEvent(rivalry,team1,team2,rng2){
  if(!rivalry||rivalry.heat<7)return null;
  if(rng2()>0.25)return null;// 25% chance per week when rivalry is hot
  // v99.2: 30% chance to use RIVALRY_TRASH_991 flavor text
  if(rng2()<0.30){
    var trashLine=pickRivalryTrash991(rivalry.heat,rng2);
    if(trashLine)return{type:"trash_talk",text:team1.abbr+": \""+trashLine+"\"",heat:rivalry.heat>=13?3:rivalry.heat>=9?2:1,emoji:"ðŸ—£ï¸",week:0};
  }
  var template=RIVALRY_FUEL_EVENT_TEMPLATES[Math.floor(rng2()*RIVALRY_FUEL_EVENT_TEMPLATES.length)];
  var margin=Math.abs((rivalry.lastMargin||0));
  var text=template.text.replace(/\{team1\}/g,team1.abbr).replace(/\{team2\}/g,team2.abbr).replace(/\{margin\}/g,margin);
  return{type:template.type,text:text,heat:template.heat,emoji:template.emoji,week:0};
}
function buildRivalryLadderLite(rivalries,teams){
  if(!rivalries)return[];
  var entries=[];
  Object.keys(rivalries).forEach(function(key){
    var r=rivalries[key];if(!r||!r.heat)return;
    var t1=teams.find(function(t){return t.id===r.a;});
    var t2=teams.find(function(t){return t.id===r.b;});
    if(!t1||!t2)return;
    var seriesRec=(r.seriesA||0)+"-"+(r.seriesB||0);
    var recentMoments=(r.moments||[]).slice(-3);
    entries.push({key:key,heat:r.heat,tier:r.heat>=13?"BLOOD_FEUD":r.heat>=9?"BITTER":"HOT",
      t1:t1,t2:t2,seriesRecord:seriesRec,moments:recentMoments,
      emoji:r.heat>=13?"ðŸ”¥ðŸ”¥ðŸ”¥":r.heat>=9?"ðŸ”¥ðŸ”¥":"ðŸ”¥"});
  });
  return entries.sort(function(a,b){return b.heat-a.heat;}).slice(0,10);
}
var GM_STRATEGIES={
  rebuild:{id:"rebuild",label:"ðŸ”¨ Rebuild Mode",desc:"Shop veterans, favor youth + picks, maximize cap flexibility",
    tradePosture:"seller",youthBias:true,capMode:"flexible",
    effects:function(team){
      team.gmStrategy="rebuild";
      team.roster.forEach(function(p){
        if(p.age>=28&&p.ovr>=72)p.tradeBlock=true;
        else p.tradeBlock=false;
      });
    }},
  contend:{id:"contend",label:"ðŸ† Contend Mode",desc:"Buy rentals, favor high OVR, accept cap pain for wins now",
    tradePosture:"buyer",youthBias:false,capMode:"aggressive",
    effects:function(team){
      team.gmStrategy="contend";
      team.roster.forEach(function(p){
        p.tradeBlock=false;
        if(p.ovr<65&&p.age>=26)p.tradeBlock=true;// Underperforming vets expendable
      });
    }},
  neutral:{id:"neutral",label:"âš–ï¸ Balanced",desc:"No strong lean â€” evaluate opportunities case by case",
    tradePosture:"neutral",youthBias:false,capMode:"balanced",
    effects:function(team){
      team.gmStrategy="neutral";
      team.roster.forEach(function(p){p.tradeBlock=false;});
    }}
};
function applyGMStrategy(team,strategyId){
  var strat=GM_STRATEGIES[strategyId];
  if(!strat)return;
  strat.effects(team);
  return strat;
}
function normalizeAIMode(mode){
  if(mode==="contend")return "contend";
  if(mode==="rebuild")return "rebuild";
  return "balanced";
}
function teamCapRoomForYear(team,year){
  if(!team)return 0;
  var cap=getSalaryCap(year||2026);
  return Math.round((cap-(team.capUsed||0)-(team.deadCap||0))*10)/10;
}
function deriveAITeamMode(team,year){
  if(!team)return "balanced";
  var score=0;
  var hinted=normalizeAIMode(team.aiStrategy||team.gmStrategy||"balanced");
  if(hinted==="contend")score+=2;else if(hinted==="rebuild")score-=2;
  var games=(team.wins||0)+(team.losses||0);
  if(games>=4){
    var pct=(team.wins||0)/Math.max(1,games);
    if(pct>=0.67)score+=2;
    else if(pct>=0.56)score+=1;
    else if(pct<=0.33)score-=2;
    else if(pct<=0.42)score-=1;
  }
  var room=teamCapRoomForYear(team,year||2026);
  if(room<=4)score-=1;
  else if(room>=25)score+=1;
  var ageAvg=team.roster&&team.roster.length?avg(team.roster,function(p){return p.age||26;}):26;
  if(ageAvg>=28.5&&games>=6&&(team.wins||0)>(team.losses||0))score+=1;
  if(ageAvg<=25&&games>=6&&(team.losses||0)>(team.wins||0))score-=1;
  if(score>=2)return "contend";
  if(score<=-2)return "rebuild";
  return "balanced";
}
function modeToAiStrategy(mode){
  if(mode==="contend")return "contend";
  if(mode==="rebuild")return "rebuild";
  return "bubble";
}
function syncAITeamMode(team,year){
  if(!team||team.isUser)return;
  team.aiStrategy=modeToAiStrategy(deriveAITeamMode(team,year||2026));
}
function syncLeagueAIModes(teams,year){
  (teams||[]).forEach(function(t){syncAITeamMode(t,year||2026);});
}
var GM_ARCHETYPES90={
  analytics:{
    id:"analytics",label:"Analytics",icon:"ðŸ“Š",color:"cyan",flavor:"Trusts the board, not the buzz.",
    draft:{bpa:1.18,need:0.90,youth:1.00,cost:1.08,loyalty:0.95,reach:0.75},
    fa:{aggressive:0.95,bargain:1.20,veteran:0.85,overpay:0.82,need:1.00,loyalty:0.95},
    holdouts:{cave:0.35},
    trade:{strictPositive:true}
  },
  old_school:{
    id:"old_school",label:"Old School",icon:"ðŸ§±",color:"gold",flavor:"Build the trenches and run the ball.",
    draft:{bpa:0.96,need:1.08,youth:0.90,cost:0.95,loyalty:1.00,reach:1.08},
    fa:{aggressive:1.00,bargain:0.95,veteran:1.18,overpay:1.05,need:1.10,loyalty:1.05},
    holdouts:{cave:0.45},
    trade:{oldSchoolTrenches:true}
  },
  contender:{
    id:"contender",label:"Win-Now",icon:"ðŸ†",color:"green",flavor:"Future picks can wait. Win now.",
    draft:{bpa:1.05,need:1.15,youth:0.86,cost:0.92,loyalty:0.98,reach:1.12},
    fa:{aggressive:1.22,bargain:0.92,veteran:1.12,overpay:1.20,need:1.15,loyalty:1.00},
    holdouts:{cave:0.66},
    trade:{contenderStarPush:true}
  },
  rebuilder:{
    id:"rebuilder",label:"Rebuilder",icon:"ðŸ› ï¸",color:"blue",flavor:"Draft capital first. Timeline second.",
    draft:{bpa:1.08,need:0.90,youth:1.22,cost:1.10,loyalty:1.02,reach:0.85},
    fa:{aggressive:0.72,bargain:1.18,veteran:0.72,overpay:0.70,need:0.92,loyalty:1.02},
    holdouts:{cave:0.30},
    trade:{rebuilderVetForPicks:true}
  },
  moneyball:{
    id:"moneyball",label:"Moneyball",icon:"ðŸ’¸",color:"orange",flavor:"Value over hype, always.",
    draft:{bpa:1.15,need:0.88,youth:1.04,cost:1.20,loyalty:1.04,reach:0.70},
    fa:{aggressive:0.90,bargain:1.28,veteran:0.90,overpay:0.62,need:0.95,loyalty:1.06},
    holdouts:{cave:0.28},
    trade:{moneyballCapRelief:true}
  },
  loyalist:{
    id:"loyalist",label:"Loyalist",icon:"ðŸ¤",color:"purple",flavor:"Culture and loyalty beat flash.",
    draft:{bpa:0.95,need:1.05,youth:1.00,cost:0.90,loyalty:1.28,reach:0.95},
    fa:{aggressive:0.95,bargain:1.00,veteran:1.00,overpay:0.95,need:1.05,loyalty:1.22},
    holdouts:{cave:0.62},
    trade:{loyalCoreLock:true}
  }
};
var GM_ARCHETYPE_ORDER90=["analytics","old_school","contender","rebuilder","moneyball","loyalist"];
function getTeamGMArchetypeId90(team){
  if(team&&team.gmArchetype90&&GM_ARCHETYPES90[team.gmArchetype90])return team.gmArchetype90;
  var key=team&&team.id?String(team.id):"team_x";
  return GM_ARCHETYPE_ORDER90[hashId(key)%GM_ARCHETYPE_ORDER90.length];
}
function getTeamGMArchetype90(team){
  var id=getTeamGMArchetypeId90(team);
  return GM_ARCHETYPES90[id]||GM_ARCHETYPES90.analytics;
}
function ensureTeamGMArchetype90(team){
  if(!team)return;
  var id=getTeamGMArchetypeId90(team);
  team.gmArchetype90=id;
}
function ensureLeagueGMArchetypes90(teamList){
  (teamList||[]).forEach(function(t){ensureTeamGMArchetype90(t);});
}
function getGMDraftArchetypeBias90(team,player,needScore){
  var arch=getTeamGMArchetype90(team);
  var draft=arch.draft||{};
  var bias={ovrMult:draft.bpa||1,needMult:draft.need||1,bonus:0,arch:arch};
  if(!player)return bias;
  var age=player.age||24;
  if(age<=23)bias.bonus+=Math.round(((draft.youth||1)-1)*10);
  else if(age>=28)bias.bonus-=Math.round(((draft.youth||1)-1)*6);
  var pers=player.personality||{};
  if(typeof pers.greed==="number"){
    var greedOver=Math.max(0,pers.greed-50);
    bias.bonus-=Math.round(((draft.cost||1)-1)*(greedOver/7));
  }
  if(typeof pers.loyalty==="number"){
    var loyaltyOver=Math.max(0,pers.loyalty-50);
    bias.bonus+=Math.round(((draft.loyalty||1)-1)*(loyaltyOver/10));
  }
  var perceived=player.hypeOvr||player.ovr||50;
  if(perceived<66&&(needScore||0)>=5&&(draft.reach||1)<1){
    bias.bonus-=Math.round((1-(draft.reach||1))*12);
  }else if(perceived>=80&&(draft.reach||1)>1){
    bias.bonus+=Math.round(((draft.reach||1)-1)*8);
  }
  return bias;
}
function getGMFAArchetypeScore90(team,player,needScore){
  var arch=getTeamGMArchetype90(team);
  var fa=arch.fa||{};
  var score=1;
  var salary=player&&player.contract?(player.contract.salary||0):0;
  var age=player&&player.age?player.age:26;
  if(salary<=4)score*=fa.bargain||1;
  if(salary>=10)score*=fa.overpay||1;
  if(age>=29)score*=fa.veteran||1;
  if(typeof needScore==="number"&&needScore>0.5)score*=fa.need||1;
  var pers=player&&player.personality?player.personality:{};
  if(typeof pers.loyalty==="number"){
    score*=1+(((fa.loyalty||1)-1)*((pers.loyalty-50)/100));
  }
  return cl(score,0.20,2.25);
}
function getTeamMedicalLevel92(team){
  if(!team||!team.facilities)return 0;
  if(typeof team.facilities.medical==="number")return cl(team.facilities.medical,0,3);
  return cl(team.facilities.med||0,0,3);
}
function setPlayerInjury92(player,type,weeks){
  if(!player)return;
  var w=cl(Math.round(weeks||0),0,20);
  var prevInjury=player.injury||{};
  player._trueInjuryWeeks=w;
  player.injury=assign({},prevInjury,{type:type||null,games:w});
  if(w<=0){player.injury.type=null;player.injury.games=0;}
}
function decrementPlayerInjury92(player,heal){
  if(!player||!player.injury||player.injury.games<=0)return;
  var h=cl(Math.round(heal||0),1,3);
  player.injury.games=Math.max(0,(player.injury.games||0)-h);
  if(typeof player._trueInjuryWeeks!=="number")player._trueInjuryWeeks=player.injury.games||0;
  player._trueInjuryWeeks=Math.max(0,player._trueInjuryWeeks-h);
  if(player.injury.games<=0)setPlayerInjury92(player,null,0);
}
function getInjuryMask92(player,viewerTeam){
  if(!player||!player.injury||player.injury.games<=0)return{status:"Healthy",badge:"",type:"",trueWeeks:0};
  var trueWeeks=typeof player._trueInjuryWeeks==="number"?player._trueInjuryWeeks:(player.injury.games||0);
  var typeTxt=player.injury.type||"Injury";
  if(trueWeeks<=1)return{status:"Questionable â€” Day to Day",badge:"DTD",type:typeTxt,trueWeeks:trueWeeks};
  var medLvl=getTeamMedicalLevel92(viewerTeam);
  if(medLvl>=3){
    return{
      status:"Out "+trueWeeks+" Week"+(trueWeeks>1?"s":"")+" ("+typeTxt+")",
      badge:String(trueWeeks),
      type:typeTxt,
      trueWeeks:trueWeeks
    };
  }
  var band=medLvl<=0?2:1;
  var minW=Math.max(1,trueWeeks-band);
  var maxW=trueWeeks+band;
  return{
    status:"Out "+minW+"-"+maxW+" Weeks",
    badge:minW===maxW?String(minW):(minW+"-"+maxW),
    type:typeTxt,
    trueWeeks:trueWeeks
  };
}
function getNegotiationIntelBonus92(frontOffice){
  if(typeof FRONT_OFFICE==="undefined"||!FRONT_OFFICE||!FRONT_OFFICE.getBonus)return 0;
  var bonus=FRONT_OFFICE.getBonus(frontOffice||[],"negotiation");
  if(bonus<=0)bonus=FRONT_OFFICE.getBonus(frontOffice||[],"trades")*0.5;
  return bonus;
}
function getContractIntelRange92(actualDemand,frontOffice,revealed){
  var demand=Math.max(0.5,Math.round((actualDemand||0.5)*10)/10);
  var negBonus=getNegotiationIntelBonus92(frontOffice);
  var bandPct=negBonus>0?0.10:0.20;
  var min=Math.max(0.5,Math.round(demand*(1-bandPct)*10)/10);
  var max=Math.max(min,Math.round(demand*(1+bandPct)*10)/10);
  var mid=Math.round(((min+max)/2)*10)/10;
  if(revealed){min=demand;max=demand;mid=demand;}
  return{demand:demand,min:min,max:max,mid:mid,revealed:!!revealed,narrowed:negBonus>0,negBonus:negBonus};
}
var STRATEGY_PROFILES={
  rebuild:{mode:"rebuild",biases:{picks:85,youth:90,capFlex:80,immediateOVR:20,positionalNeed:40}},
  balanced:{mode:"balanced",biases:{picks:50,youth:50,capFlex:50,immediateOVR:50,positionalNeed:50}},
  contend:{mode:"contend",biases:{picks:20,youth:25,capFlex:25,immediateOVR:90,positionalNeed:75}}
};
function getTeamProfile(team){
  var mode=team.gmStrategy||"neutral";
  var profile=STRATEGY_PROFILES[mode]||STRATEGY_PROFILES.balanced;
  return assign({},profile,{teamId:team.id,abbr:team.abbr});
}
var AI_DECISION_LOG=[];// Session-only: max 100 entries
function logAIDecision(teamAbbr,mode,action,reason){
  AI_DECISION_LOG.push({team:teamAbbr,mode:mode,action:action,reason:reason});
  if(AI_DECISION_LOG.length>100)AI_DECISION_LOG.splice(0,AI_DECISION_LOG.length-100);
}
function generateCounterfactual(gameRecap,gameResult){
  if(!gameRecap||!gameResult)return null;
  var userWon=gameRecap.score>gameRecap.oppScore;
  if(userWon)return null;// Only show on losses
  var margin=gameRecap.oppScore-gameRecap.score;
  var cfs=[];
  var tos=gameRecap.turnovers||0;
  if(tos>=1){
    var toPts=tos*3.5;// ~3.5 expected points per turnover
    var wouldWin=margin<=toPts;
    cfs.push({metric:"Turnovers",change:"-1 TO",impact:"+"+Math.round(3.5)+" expected pts",
      verdict:wouldWin?"ðŸŸ¢ Likely win":"ðŸŸ¡ Closer game",confidence:tos>=2?"HIGH":"MED"});
  }
  var pocket=gameRecap.pressureRate||50;
  if(pocket<45){
    var pocketGain=Math.round((50-pocket)*0.4);// ~0.4 pts per % pocket improvement
    cfs.push({metric:"Pocket Protection",change:"+5% clean pocket",impact:"+"+pocketGain+" expected pts",
      verdict:margin<=pocketGain?"ðŸŸ¢ Likely win":"ðŸŸ¡ Closer game",confidence:pocket<35?"HIGH":"MED"});
  }
  var rz=gameRecap.rzEff||50;
  if(rz<50){
    var rzGain=Math.round((55-rz)*0.3);
    cfs.push({metric:"Red Zone Efficiency",change:"+5% RZ conversion",impact:"+"+rzGain+" expected pts",
      verdict:margin<=rzGain?"ðŸŸ¢ Likely win":"ðŸŸ¡ Closer game",confidence:rz<35?"HIGH":"MED"});
  }
  var run=gameRecap.runLaneAdv||50;
  if(run<40){
    cfs.push({metric:"Run Game",change:"+10% run success",impact:"+2 expected pts + clock control",
      verdict:margin<=5?"ðŸŸ¢ Likely win":"ðŸŸ¡ Closer game",confidence:"MED"});
  }
  return cfs.length>0?cfs.slice(0,2):null;// Max 2 counterfactuals
}
function generateEraStoryline(era,history,teams){
  if(!era)return"";
  var t=teams.find(function(t2){return t2.abbr===era.abbr;});
  var parts=[];
  if(era.titles>=3)parts.push("A true dynasty that dominated for "+era.seasons+" seasons.");
  else if(era.titles>=1)parts.push("A championship-caliber run spanning "+era.seasons+" years.");
  else if(era.avgDom>=40)parts.push("An elite era of sustained excellence across "+era.seasons+" seasons.");
  else parts.push("A competitive stretch of "+era.seasons+" seasons for "+(t?t.name:era.abbr)+".");
  if(era.titles>0)parts.push(era.titles+" title"+(era.titles>1?"s":"")+" cemented their legacy.");
  var winPct=era.wins+era.losses>0?Math.round(era.wins/(era.wins+era.losses)*100):0;
  if(winPct>=75)parts.push("At "+winPct+"% wins, they were nearly unstoppable.");
  else if(winPct>=60)parts.push("A steady "+winPct+"% win rate kept them in contention.");
  if(era.avgDom>=50)parts.push("Their dominance score of "+era.avgDom+" per season ranks among the greatest ever.");
  else if(era.avgDom>=30)parts.push("Consistently competitive with "+era.avgDom+" avg dominance.");
  return parts.slice(0,3).join(" ");
}
var DEFAULT_DNA={injuryRate:1.0,devSpeed:1.0,parity:1.0,tradeFreq:1.0,upsetChance:1.0};
var DNA_ACTIVE=DEFAULT_DNA;// v53: Global reference for sim functions to read
var DNA_SLIDERS=[
  {key:"injuryRate",label:"Injury Rate",emoji:"ðŸ¥",min:0.5,max:2.0,step:0.1,desc:"How often players get hurt"},
  {key:"devSpeed",label:"Dev Speed",emoji:"ðŸ“ˆ",min:0.5,max:2.0,step:0.1,desc:"How fast players develop"},
  {key:"parity",label:"Parity",emoji:"âš–ï¸",min:0.5,max:2.0,step:0.1,desc:"League balance â€” higher = more upsets"},
  {key:"tradeFreq",label:"Trade Frequency",emoji:"ðŸ”„",min:0.5,max:2.0,step:0.1,desc:"How often AI teams make trades"},
  {key:"upsetChance",label:"Upset Volatility",emoji:"ðŸ˜±",min:0.5,max:2.0,step:0.1,desc:"Underdog win chance multiplier"}
];
function computeSaveChecksum(data){
  if(!data||!data.teams)return 0;
  var sum=0;
  sum+=data.teams.length*1000;
  data.teams.forEach(function(t){sum+=t.roster.length*10+t.wins+t.losses;});
  sum+=(data.season?data.season.year*100+data.season.week:0);
  sum+=data.saveVersion||0;
  return sum;
}
function validateSaveChecksum(data){
  if(!data.checksum)return{valid:true,msg:"No checksum (pre-v53 save)"};
  var expected=computeSaveChecksum(data);
  if(data.checksum===expected)return{valid:true,msg:"âœ… Save integrity verified"};
  return{valid:false,msg:"âš ï¸ Save checksum mismatch! Expected "+expected+", got "+data.checksum+". Possible corruption.",
    expected:expected,actual:data.checksum};
}
function buildBroadcastRecap(teams,sched,season,myId){
  if(!sched||season.week<=1)return null;
  var lastWeek=season.week-1;
  var weekGames=sched.filter(function(g){return g.week===lastWeek;}); // v80.1: fix â€” sched is flat array, was incorrectly indexed as array-of-arrays
  if(weekGames.length===0)return null;
  var ranked=teams.slice().sort(function(a,b){
    if(b.wins!==a.wins)return b.wins-a.wins;
    return(b.pointsFor||0)-(b.pointsAgainst||0)-((a.pointsFor||0)-(a.pointsAgainst||0));
  });
  var powerRankings=ranked.map(function(t,i){
    var prevRank=t._prevRank||i+1;
    var delta=prevRank-(i+1);
    return{rank:i+1,team:t,prevRank:prevRank,delta:delta,wins:t.wins,losses:t.losses,
      streak:t.streak||0,emoji:delta>0?"ðŸ”º":delta<0?"ðŸ”»":"âž–"};
  });
  var headlines=[];
  weekGames.forEach(function(g){
    if(!g.result)return;
    var hT=teams.find(function(t){return t.id===g.home;});
    var aT=teams.find(function(t){return t.id===g.away;});
    if(!hT||!aT)return;
    var hS=g.result.home||g.result.homeScore||0,aS=g.result.away||g.result.awayScore||0;
    var margin=Math.abs(hS-aS);var winner=hS>aS?hT:aT;var loser=hS>aS?aT:hT;
    var winS=Math.max(hS,aS),loseS=Math.min(hS,aS);
    var wRank=powerRankings.findIndex(function(pr){return pr.team.id===winner.id;})+1;
    var lRank=powerRankings.findIndex(function(pr){return pr.team.id===loser.id;})+1;
    if(wRank>lRank+5){
      headlines.push({type:"upset",emoji:"ðŸ˜±",text:winner.icon+winner.abbr+" UPSET! Takes down "+loser.icon+loser.abbr+" "+winS+"-"+loseS,priority:3});
    }
    if(margin>=21){
      headlines.push({type:"blowout",emoji:"ðŸ’¥",text:winner.icon+winner.abbr+" BLOWOUT "+winS+"-"+loseS+" over "+loser.icon+loser.abbr,priority:2});
    }
    if(margin<=3){
      headlines.push({type:"thriller",emoji:"âš¡",text:"THRILLER: "+winner.icon+winner.abbr+" edges "+loser.icon+loser.abbr+" "+winS+"-"+loseS,priority:2});
    }
    if(g.home===myId||g.away===myId){
      var isUserWin=(g.home===myId&&hS>aS)||(g.away===myId&&aS>hS);
      var userT=g.home===myId?hT:aT;var oppT2=g.home===myId?aT:hT;
      headlines.push({type:isUserWin?"user_win":"user_loss",emoji:isUserWin?"âœ…":"âŒ",
        text:userT.icon+userT.abbr+(isUserWin?" WIN ":" LOSS ")+winS+"-"+loseS+(isUserWin?" vs ":" to ")+oppT2.icon+oppT2.abbr,priority:4});
    }
  });
  headlines.sort(function(a,b){return b.priority-a.priority;});
  var topTeam=ranked[0];var storyline="";
  if(topTeam.wins>=season.week*0.8)storyline=topTeam.icon+topTeam.abbr+" continues to dominate â€” can anyone stop them?";
  else if(ranked[ranked.length-1].losses>=season.week*0.8)storyline=ranked[ranked.length-1].icon+ranked[ranked.length-1].abbr+" still searching for answers at the bottom.";
  else storyline="Week "+lastWeek+" delivered â€” the playoff picture is taking shape.";
  return{week:lastWeek,powerRankings:powerRankings.slice(0,30),headlines:headlines.slice(0,6),storyline:storyline};
}
function buildAllTimeLeaders(history){
  if(!history||history.length===0)return null;
  var playerMap={};// key: playerName+pos â†’ cumulative stats
  history.forEach(function(h){
    if(!h.teams)return;
    h.teams.forEach(function(tr){
      if(!tr.roster)return;
      tr.roster.forEach(function(p){
        if(!p.stats)return;
        var key=p.name+"|"+p.pos;
        if(!playerMap[key])playerMap[key]={name:p.name,pos:p.pos,seasons:0,
          passYds:0,passTD:0,rushYds:0,rushTD:0,recYds:0,recTD:0,sacks:0,ints:0,teams:{}};
        var pm=playerMap[key];
        pm.seasons++;
        pm.passYds+=(p.stats.passYds||0);pm.passTD+=(p.stats.passTD||0);
        pm.rushYds+=(p.stats.rushYds||0);pm.rushTD+=(p.stats.rushTD||0);
        pm.recYds+=(p.stats.recYds||0);pm.recTD+=(p.stats.recTD||0);
        pm.sacks+=(p.stats.sacks||0);pm.ints+=(p.stats.ints||0);
        pm.teams[tr.abbr]=true;
      });
    });
  });
  var all=Object.keys(playerMap).map(function(k){return playerMap[k];});
  return{
    passYds:all.filter(function(p){return p.passYds>0;}).sort(function(a,b){return b.passYds-a.passYds;}).slice(0,10),
    passTD:all.filter(function(p){return p.passTD>0;}).sort(function(a,b){return b.passTD-a.passTD;}).slice(0,10),
    rushYds:all.filter(function(p){return p.rushYds>0;}).sort(function(a,b){return b.rushYds-a.rushYds;}).slice(0,10),
    rushTD:all.filter(function(p){return p.rushTD>0;}).sort(function(a,b){return b.rushTD-a.rushTD;}).slice(0,10),
    recYds:all.filter(function(p){return p.recYds>0;}).sort(function(a,b){return b.recYds-a.recYds;}).slice(0,10),
    sacks:all.filter(function(p){return p.sacks>0;}).sort(function(a,b){return b.sacks-a.sacks;}).slice(0,10),
    ints:all.filter(function(p){return p.ints>0;}).sort(function(a,b){return b.ints-a.ints;}).slice(0,10)
  };
}
// OWNER_ARCHETYPES array items removed â€” imported from ./src/systems/owner.js
function generateTradeSuggestions(team,teams,strategy){
  if(!team||!teams)return[];
  var suggestions=[];
  var needs=getTeamNeeds?getTeamNeeds(team):{};
  var neededPos=Object.keys(needs).slice(0,3);// Top 3 needs
  var mode=strategy||team.gmStrategy||"neutral";
  if(mode==="rebuild"){
    var vets=team.roster.filter(function(p){return p.age>=28&&p.ovr>=72&&p.isStarter;})
      .sort(function(a,b){return b.ovr-a.ovr;}).slice(0,3);
    vets.forEach(function(v){
      suggestions.push({type:"SELL",emoji:"ðŸ“¤",player:v.name+" ("+v.pos+" "+v.ovr+" OVR, age "+v.age+")",
        reason:"Rebuild: "+v.name+" has trade value but is aging. Sell high for picks/youth.",
        action:"trade_block",playerId:v.id,priority:v.ovr>=80?3:2});
    });
    teams.filter(function(t){return !t.isUser&&t.aiStrategy==="contend";}).slice(0,2).forEach(function(ct){
      var youngBench=ct.roster.filter(function(p){return p.age<=24&&!p.isStarter&&p.pot>=p.ovr+5;}).slice(0,1);
      youngBench.forEach(function(yp){
        suggestions.push({type:"BUY_YOUTH",emoji:"ðŸŒ±",player:yp.name+" ("+yp.pos+" "+yp.ovr+", pot "+yp.pot+") from "+ct.abbr,
          reason:"Rebuild: "+ct.abbr+" is contending and might deal youth for win-now help.",priority:2});
      });
    });
  }
  if(mode==="contend"){
    neededPos.forEach(function(pos){
      var sellers=teams.filter(function(t){return !t.isUser&&(t.aiStrategy==="rebuild"||t.losses>t.wins);});
      sellers.forEach(function(st){
        var targets=st.roster.filter(function(p){return p.pos===pos&&p.ovr>=72&&p.age<=30;})
          .sort(function(a,b){return b.ovr-a.ovr;}).slice(0,1);
        targets.forEach(function(tp){
          suggestions.push({type:"BUY",emoji:"ðŸ“¥",player:tp.name+" ("+tp.pos+" "+tp.ovr+" OVR) from "+st.abbr,
            reason:"Contend: "+st.abbr+" is rebuilding. "+tp.name+" fills your "+pos+" need.",priority:tp.ovr>=80?3:2});
        });
      });
    });
    var surplus=team.roster.filter(function(p){return !p.isStarter&&p.ovr>=68&&neededPos.indexOf(p.pos)<0;})
      .sort(function(a,b){return b.ovr-a.ovr;}).slice(0,2);
    surplus.forEach(function(sp){
      suggestions.push({type:"SELL_DEPTH",emoji:"â™»ï¸",player:sp.name+" ("+sp.pos+" "+sp.ovr+" OVR)",
        reason:"Contend: "+sp.name+" is bench depth at a non-need position. Package for upgrades.",priority:1});
    });
  }
  if(mode==="neutral"&&neededPos.length>0){
    suggestions.push({type:"NEED",emoji:"ðŸŽ¯",player:"Target: "+neededPos[0]+" position",
      reason:"Balanced: Your biggest roster hole is "+neededPos[0]+". Monitor trade market.",priority:1});
  }
  return suggestions.sort(function(a,b){return b.priority-a.priority;}).slice(0,5);
}
var DNA_PRESETS=[
  {id:"default",label:"ðŸ“‹ Default",desc:"Standard simulation settings",
    dna:{injuryRate:1.0,devSpeed:1.0,parity:1.0,tradeFreq:1.0,upsetChance:1.0}},
  {id:"madden_chaos",label:"ðŸ”¥ Chaos Mode",desc:"Wild games, fast dev, tons of trades, anyone can win",
    dna:{injuryRate:0.7,devSpeed:1.5,parity:1.8,tradeFreq:1.8,upsetChance:1.8}},
  {id:"sim_purist",label:"ðŸ“Š Sim Purist",desc:"Realistic pacing â€” injuries matter, development is slow, dynasties are rare",
    dna:{injuryRate:1.3,devSpeed:0.8,parity:0.8,tradeFreq:0.8,upsetChance:0.7}},
  {id:"iron_man",label:"ðŸ’ª Iron Man",desc:"Almost no injuries, fast development â€” everyone reaches their ceiling",
    dna:{injuryRate:0.5,devSpeed:1.8,parity:1.0,tradeFreq:1.0,upsetChance:1.0}},
  {id:"chaos_league",label:"ðŸ˜± Chaos League",desc:"Maximum parity + upsets. Last place can beat first place any week.",
    dna:{injuryRate:1.0,devSpeed:1.0,parity:2.0,tradeFreq:1.5,upsetChance:2.0}},
  {id:"dynasty_mode",label:"ðŸ‘‘ Dynasty Mode",desc:"Low parity â€” build a superteam and dominate for a decade",
    dna:{injuryRate:0.8,devSpeed:1.2,parity:0.5,tradeFreq:1.2,upsetChance:0.5}},
  {id:"trade_frenzy",label:"ðŸ”„ Trade Frenzy",desc:"Constant movement. AI teams make deals every week.",
    dna:{injuryRate:1.0,devSpeed:1.0,parity:1.0,tradeFreq:2.0,upsetChance:1.0}}
];
function pickGameOfTheWeek(weekGames,teams,powerRankings,myId){
  if(!weekGames||weekGames.length===0)return null;
  var scored=weekGames.map(function(g){
    if(!g.result)return null;
    var hT=teams.find(function(t){return t.id===g.home;});
    var aT=teams.find(function(t){return t.id===g.away;});
    if(!hT||!aT)return null;
    var hS=g.result.home||g.result.homeScore||0,aS=g.result.away||g.result.awayScore||0;
    var margin=Math.abs(hS-aS);
    var hRank=powerRankings?powerRankings.findIndex(function(pr){return pr.team.id===hT.id;})+1:10;
    var aRank=powerRankings?powerRankings.findIndex(function(pr){return pr.team.id===aT.id;})+1:10;
    var score=0;
    if(g.home===myId||g.away===myId)score+=15;
    if(margin<=3)score+=12;else if(margin<=7)score+=6;
    if(hRank<=5)score+=5;if(aRank<=5)score+=5;
    var winner=hS>aS?hT:aT;var loser=hS>aS?aT:hT;
    var wRank=powerRankings?powerRankings.findIndex(function(pr){return pr.team.id===winner.id;})+1:10;
    var lRank=powerRankings?powerRankings.findIndex(function(pr){return pr.team.id===loser.id;})+1:10;
    if(wRank>lRank+5)score+=10;
    var rivKey=[hT.id,aT.id].sort().join("-");
    score+=2;// Small base for all games
    var whyTags=[];
    if(g.home===myId||g.away===myId)whyTags.push("Your Game");
    if(margin<=3)whyTags.push("Thriller");
    if(wRank>lRank+5)whyTags.push("Upset");
    if(hRank<=5&&aRank<=5)whyTags.push("Clash of Titans");
    if(whyTags.length===0)whyTags.push("Top Matchup");
    return{game:g,hT:hT,aT:aT,hS:hS,aS:aS,margin:margin,score:score,whyTags:whyTags};
  }).filter(function(x){return !!x;});
  scored.sort(function(a,b){return b.score-a.score;});
  var best=scored[0];
  if(!best)return null;
  var highlights=[];
  var r=best.game.result;
  if(r.drives&&r.drives.length>0){
    var longest=r.drives.slice().sort(function(a,b){return(b.yds||0)-(a.yds||0);})[0];
    if(longest)highlights.push({emoji:"ðŸš€",label:"Big Play",text:(longest.d||"Explosive play")+" ("+((longest.yds||0))+" yds)"});
    var stops=r.drives.filter(function(d){return d.type==="PUNT"||d.type==="TURNOVER"||d.type==="FG_MISS";});
    if(stops.length>0)highlights.push({emoji:"ðŸ›‘",label:"Key Stop",text:stops[0].d||"Defense forces punt"});
    var turnovers=r.drives.filter(function(d){return d.type==="TURNOVER"||d.type==="INT"||d.type==="FUMBLE";});
    if(turnovers.length>0)highlights.push({emoji:"ðŸ’«",label:"Turning Point",text:turnovers[0].d||"Turnover changes momentum"});
  }
  while(highlights.length<3)highlights.push({emoji:"ðŸˆ",label:"Key Moment",text:best.margin<=3?"Game came down to the wire":"Hard-fought battle on both sides"});
  return{hT:best.hT,aT:best.aT,hS:best.hS,aS:best.aS,margin:best.margin,whyTags:best.whyTags,highlights:highlights.slice(0,3)};
}
function pickPlayersOfWeek(teams,weekGames){
  if(!weekGames||!teams)return{opow:null,dpow:null};
  var offPlayers=[];var defPlayers=[];
  teams.forEach(function(t){
    t.roster.forEach(function(p){
      if(!p.stats||!p.isStarter)return;
      if(["QB","RB","WR","TE"].indexOf(p.pos)>=0){
        var impact=(p.stats.passTD||0)*6+(p.stats.rushTD||0)*6+(p.stats.passYds||0)*0.04+(p.stats.rushYds||0)*0.1+(p.stats.recYds||0)*0.1;
        offPlayers.push({name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,ovr:p.ovr,impact:impact,
          line:p.pos==="QB"?(p.stats.passYds||0)+"yds/"+(p.stats.passTD||0)+"TD":
            (p.stats.rushYds||0)+"rush/"+(p.stats.recYds||0)+"rec/"+(((p.stats.rushTD||0)+(p.stats.recTD||0)))+"TD"});
      }
      if(["DL","LB","CB","S"].indexOf(p.pos)>=0){
        var dImpact=(p.stats.sacks||0)*4+(p.stats.ints||0)*6+(p.stats.tackles||0)*0.5;
        defPlayers.push({name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,ovr:p.ovr,impact:dImpact,
          line:(p.stats.sacks||0)+"sck/"+(p.stats.ints||0)+"INT/"+(p.stats.tackles||0)+"tkl"});
      }
    });
  });
  offPlayers.sort(function(a,b){return b.impact-a.impact;});
  defPlayers.sort(function(a,b){return b.impact-a.impact;});
  return{opow:offPlayers[0]||null,dpow:defPlayers[0]||null};
}
var MANDATE_TEMPLATES={
  win_now:[
    {id:"make_playoffs",text:"Make the playoffs this season",check:function(t,s){return t.wins>=Math.ceil((s.week||17)*0.55);}},
    {id:"sign_star",text:"Acquire or keep a player with 85+ OVR",check:function(t){return t.roster.some(function(p){return p.ovr>=85;});}}
  ],
  patient_builder:[
    {id:"draft_starters",text:"Start 3+ players age 25 or under",check:function(t){return t.roster.filter(function(p){return p.isStarter&&p.age<=25;}).length>=3;}},
    {id:"improve_facilities",text:"Upgrade at least one facility this season",check:function(t){var total=0;if(t.facilities){Object.keys(t.facilities).map(function(k){return t.facilities[k];}).forEach(function(v){total+=v;});}return total>=2;}}
  ],
  profit_first:[
    {id:"cap_healthy",text:"Maintain $10M+ cap space",check:function(t){return(150-(t.capUsed||0)-(t.deadCap||0))>=10;}},
    {id:"no_dead_cap",text:"Keep dead cap under $5M",check:function(t){return(t.deadCap||0)<5;}}
  ],
  fan_favorite:[
    {id:"keep_star",text:"Roster a player with 85+ OVR",check:function(t){return t.roster.some(function(p){return p.ovr>=85;});}},
    {id:"winning_streak",text:"Win 3+ games in a row at some point",check:function(t){return(t.streak||0)>=3||t._bestStreak>=3;}}
  ],
  legacy_builder:[
    {id:"dynasty_dom",text:"Achieve 40+ dominance score this season",check:function(t){return calcTeamDominance?calcTeamDominance(t)>=40:false;}},
    {id:"ring_chase",text:"Win the championship",check:function(t){return t._wonChampThisYear||false;}}
  ]
};
function generateMandates(owner){
  if(!owner||!owner.archetypeId)return[];
  var templates=MANDATE_TEMPLATES[owner.archetypeId]||[];
  return templates.map(function(m){return assign({},m,{met:false});});
}
function checkMandates(mandates,team,season){
  if(!mandates)return[];
  return mandates.map(function(m){
    return assign({},m,{met:m.check?m.check(team,season):false});
  });
}
function getApprovalConsequences(approval){
  if(approval>=60)return{label:"Normal",effects:{faMod:1.0,tradeMod:1.0,cashMod:1.0},desc:"Owner is satisfied. No interference."};
  if(approval>=40)return{label:"Meddling",effects:{faMod:1.05,tradeMod:1.05,cashMod:0.95},desc:"Owner meddles: FA prices +5%, trades harder, cash bonus -5%."};
  if(approval>=25)return{label:"Hot Seat",effects:{faMod:1.10,tradeMod:1.12,cashMod:0.85},desc:"HOT SEAT: FA +10%, trades +12% harder, cash -15%."};
  return{label:"Crisis",effects:{faMod:1.20,tradeMod:1.25,cashMod:0.70},desc:"CRISIS: FA +20%, trades +25% harder, cash -30%. Coaching change imminent."};
}
function buildFranchiseRecords(history,teamId){
  if(!history||!teamId)return null;
  var singleSeason={wins:0,losses:99,pointsFor:0,pointsAgainst:999};
  var career={};// playerKey â†’ cumulative stats
  var ssDetails={wins:null,losses:null,pointsFor:null,pointsAgainst:null};
  history.forEach(function(h){
    if(!h.teams)return;
    var tr=h.teams.find(function(t2){return t2.id===teamId;});
    if(!tr)return;
    if(tr.wins>singleSeason.wins){singleSeason.wins=tr.wins;ssDetails.wins={year:h.year,val:tr.wins};}
    if(tr.losses<singleSeason.losses){singleSeason.losses=tr.losses;ssDetails.losses={year:h.year,val:tr.losses};}
    if((tr.pointsFor||0)>singleSeason.pointsFor){singleSeason.pointsFor=tr.pointsFor||0;ssDetails.pointsFor={year:h.year,val:tr.pointsFor||0};}
    if((tr.pointsAgainst||0)<singleSeason.pointsAgainst&&(tr.pointsAgainst||0)>0){
      singleSeason.pointsAgainst=tr.pointsAgainst||0;ssDetails.pointsAgainst={year:h.year,val:tr.pointsAgainst||0};}
    if(tr.roster)tr.roster.forEach(function(p){
      if(!p.stats)return;
      var key=p.name+"|"+p.pos;
      if(!career[key])career[key]={name:p.name,pos:p.pos,passYds:0,passTD:0,rushYds:0,rushTD:0,recYds:0,sacks:0,ints:0,seasons:0};
      var c=career[key];c.seasons++;
      c.passYds+=(p.stats.passYds||0);c.passTD+=(p.stats.passTD||0);
      c.rushYds+=(p.stats.rushYds||0);c.rushTD+=(p.stats.rushTD||0);
      c.recYds+=(p.stats.recYds||0);c.sacks+=(p.stats.sacks||0);c.ints+=(p.stats.ints||0);
    });
  });
  var careerList=Object.keys(career).map(function(k){return career[k];});
  return{
    singleSeason:ssDetails,
    careerPassYds:careerList.filter(function(p){return p.passYds>0;}).sort(function(a,b){return b.passYds-a.passYds;}).slice(0,5),
    careerRushYds:careerList.filter(function(p){return p.rushYds>0;}).sort(function(a,b){return b.rushYds-a.rushYds;}).slice(0,5),
    careerSacks:careerList.filter(function(p){return p.sacks>0;}).sort(function(a,b){return b.sacks-a.sacks;}).slice(0,5)
  };
}
var MILESTONE_THRESHOLDS=[
  {stat:"passYds",vals:[5000,10000,20000,30000,50000],emoji:"ðŸˆ",label:"Career Passing Yards"},
  {stat:"passTD",vals:[25,50,100,200,300],emoji:"ðŸŽ¯",label:"Career Passing TDs"},
  {stat:"rushYds",vals:[2000,5000,10000,15000,20000],emoji:"ðŸƒ",label:"Career Rushing Yards"},
  {stat:"sacks",vals:[20,50,75,100,150],emoji:"ðŸ’¥",label:"Career Sacks"},
  {stat:"ints",vals:[10,25,50,75,100],emoji:"ðŸ¤š",label:"Career Interceptions"}
];
function checkMilestones(team,history){
  if(!team||!history)return[];
  var milestones=[];
  team.roster.forEach(function(p){
    if(!p.stats)return;
    var careerStats={passYds:p.stats.passYds||0,passTD:p.stats.passTD||0,
      rushYds:p.stats.rushYds||0,sacks:p.stats.sacks||0,ints:p.stats.ints||0};
    history.forEach(function(h){
      if(!h.teams)return;
      h.teams.forEach(function(tr){
        if(!tr.roster)return;
        var match=tr.roster.find(function(rp){return rp.name===p.name&&rp.pos===p.pos;});
        if(match&&match.stats){
          careerStats.passYds+=(match.stats.passYds||0);careerStats.passTD+=(match.stats.passTD||0);
          careerStats.rushYds+=(match.stats.rushYds||0);careerStats.sacks+=(match.stats.sacks||0);
          careerStats.ints+=(match.stats.ints||0);
        }
      });
    });
    MILESTONE_THRESHOLDS.forEach(function(mt){
      var val=careerStats[mt.stat]||0;
      mt.vals.forEach(function(threshold){
        var prevVal=val-(p.stats[mt.stat]||0);// What they had before this season
        if(val>=threshold&&prevVal<threshold){
          milestones.push({player:p.name,pos:p.pos,emoji:mt.emoji,label:mt.label,
            threshold:threshold,value:val,text:mt.emoji+" "+p.name+" ("+p.pos+") reached "+threshold.toLocaleString()+" "+mt.label+"!"});
        }
      });
    });
  });
  return milestones;
}
var MILESTONE_CELEBRATION={
  checkWeekly:function(team,week){
    if(!team||!team.roster)return[];
    var celebrations=[];
    team.roster.forEach(function(p){
      if(!p.stats||!p.careerStats)return;
      var cs=p.careerStats;
      var seasonChecks=[
        {stat:"passYds",vals:[3000,4000,5000],label:"Passing Yards This Season",emoji:"ðŸˆ"},
        {stat:"rushYds",vals:[1000,1500,2000],label:"Rushing Yards This Season",emoji:"ðŸƒ"},
        {stat:"recYds",vals:[1000,1500],label:"Receiving Yards This Season",emoji:"ðŸ“¡"},
        {stat:"passTD",vals:[25,30,40],label:"Passing TDs This Season",emoji:"ðŸŽ¯"},
        {stat:"sacks",vals:[10,15,20],label:"Sacks This Season",emoji:"ðŸ’¥"},
        {stat:"defINT",vals:[5,8,10],label:"Interceptions This Season",emoji:"ðŸ¦…"}
      ];
      seasonChecks.forEach(function(sc){
        var val=p.stats[sc.stat]||0;
        sc.vals.forEach(function(thresh){
          if(val>=thresh&&!p._milestone76){
            var rank76="";
            if(sc.stat==="passYds"&&thresh>=5000)rank76=" â€” franchise record pace!";
            if(sc.stat==="rushYds"&&thresh>=1500)rank76=" â€” elite season!";
            if(sc.stat==="sacks"&&thresh>=15)rank76=" â€” DPOY candidate!";
            celebrations.push({
              name:p.name,pos:p.pos,ovr:p.ovr,
              stat:sc.stat,threshold:thresh,value:val,
              emoji:sc.emoji,label:sc.label,
              text:sc.emoji+" "+p.name+" ("+p.pos+") hits "+thresh.toLocaleString()+" "+sc.label+"!"+rank76,
              week:week
            });
            p._milestone76=thresh;// Prevent duplicate celebrations
          }
        });
      });
    });
    return celebrations;
  }
};
// â”€â”€ FEATURE 9: RIVAL GM STORYLINE ENGINE (RIVAL_SAGA) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var RIVAL_TRASH_TALK={
  low:[
    "{rivalGM} ({rivalTeam}): 'They've had a decent run. Let's see them do it again.'",
    "{rivalGM} when asked about {myTeam}: 'We have a lot of respect for what they're building.'",
    "Media: {rivalTeam} eyeing players from {myTeam}'s roster this offseason."
  ],
  mid:[
    "{rivalGM}: 'Their defense is soft. We'll exploit that on Sunday.'",
    "{rivalGM} fires back: 'They got lucky last week. We'll see them again.'",
    "{rivalCoach} on {myTeam}: 'Predictable. We've seen it before. We're prepared.'",
    "{rivalGM} on {myStar}: 'Good player. Not great. Overpaid, honestly.'",
    "League insider: '{rivalTeam} quietly targeting {myTeam} free agents this offseason.'"
  ],
  high:[
    "{rivalGM}: 'That program? They've had their moment. Ours is now.'",
    "{rivalGM}: 'I don't care how good {myStar} is. We'll have a plan for him.'",
    "Anonymous player from {rivalTeam}: 'We hate those guys. It's personal now.'",
    "{rivalGM} at the podium: 'They talk. We prepare. The field doesn't lie.'"
  ],
  beef:[
    "{rivalGM}: 'Championship? They haven't earned the right to say that word.'",
    "{rivalCoach}: 'I said what I said. Their coach couldn't hold my clipboard.'",
    "{rivalGM}: 'Refs, injuries, whatever excuse they want. We dominated them.'",
    "Breaking: {rivalGM} declines to shake hands after {myTeam} win."
  ]
};
var PRESS_RESPONSES_RIVAL={
  calmDown:{label:"\"They'll have to earn it on the field.\"",credMod:5,beefMod:0,moraleMod:3},
  callout:{label:"\"Bulletin board material. My guys saw that.\"",credMod:-3,beefMod:8,moraleMod:10},
  noComment:{label:"\"No comment â€” we focus on ourselves.\"",credMod:3,beefMod:-5,moraleMod:0}
};
var RIVAL_SAGA={
  getBeefLevel:function(heat){return Math.min(100,Math.round((heat||0)/15*100));},
  getBeefTier:function(beefLevel){
    if(beefLevel>=80)return{tier:"BLOOD FEUD",color:"#ef4444",emoji:"ðŸ”¥ðŸ”¥ðŸ”¥"};
    if(beefLevel>=55)return{tier:"HEATED",color:"#f97316",emoji:"ðŸ”¥ðŸ”¥"};
    if(beefLevel>=35)return{tier:"BUILDING",color:"#f59e0b",emoji:"ðŸ”¥"};
    if(beefLevel>=15)return{tier:"SIMMERING",color:"#fbbf24",emoji:"ðŸ˜¤"};
    return{tier:"COOL",color:"#64748b",emoji:"ðŸ˜"};
  },
  generateTrashTalk:function(rivalTeam,myTeam,beefLevel){
    var pool=beefLevel>=80?RIVAL_TRASH_TALK.beef:beefLevel>=55?RIVAL_TRASH_TALK.high:beefLevel>=35?RIVAL_TRASH_TALK.mid:RIVAL_TRASH_TALK.low;
    var tmpl=pool[Math.floor(RNG.ui()*pool.length)]||pool[0];
    var gmName=rivalTeam.staff&&rivalTeam.staff.hc?rivalTeam.staff.hc.name:"The GM";
    var coachName=rivalTeam.staff&&rivalTeam.staff.hc?rivalTeam.staff.hc.name:"The Coach";
    var myStar=myTeam&&myTeam.roster?((myTeam.roster.filter(function(p){return p.isStarter&&p.ovr>=80;})[0])||{name:"your star"}).name:"your star";
    return tmpl
      .replace("{rivalGM}",gmName)
      .replace("{rivalCoach}",coachName)
      .replace("{rivalTeam}",rivalTeam.city+" "+rivalTeam.name)
      .replace("{myTeam}",myTeam?(myTeam.city+" "+myTeam.name):"your team")
      .replace("{myStar}",myStar);
  },
  grudgeMatchBonus:function(heat){
    if(heat<9)return null;
    return{moraleBoost:Math.round((heat-6)*0.8),label:"GRUDGE MATCH",emoji:"âš”ï¸"};
  }
};
// â”€â”€ END RIVAL_SAGA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€ SHARE_CARD â€” Feature 4: Shareable Dynasty Moments â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var SHARE_CARD={
  // Draw a 1200Ã—630 dynasty card onto a canvas element
  drawCard:function(canvas,data){
    var ctx=canvas.getContext("2d");
    canvas.width=1200;canvas.height=630;
    // Background gradient using team color
    var grad=ctx.createLinearGradient(0,0,1200,630);
    grad.addColorStop(0,data.teamColor||"#0f172a");
    grad.addColorStop(0.6,"#1e293b");
    grad.addColorStop(1,"#0f172a");
    ctx.fillStyle=grad;ctx.fillRect(0,0,1200,630);
    // Subtle radial shine at top
    var shine=ctx.createRadialGradient(600,0,0,600,0,500);
    shine.addColorStop(0,"rgba(251,191,36,0.12)");
    shine.addColorStop(1,"transparent");
    ctx.fillStyle=shine;ctx.fillRect(0,0,1200,630);
    // Gold accent bar at top
    ctx.fillStyle="#fbbf24";ctx.fillRect(0,0,1200,6);
    // Icon (trophy/hof/star)
    ctx.font="100px serif";ctx.fillText(data.icon||"ðŸ†",60,170);
    // Team name
    ctx.fillStyle="#ffffff";ctx.font="bold 60px system-ui,Arial,sans-serif";
    ctx.shadowColor="rgba(0,0,0,0.8)";ctx.shadowBlur=16;
    ctx.fillText((data.teamIcon||"")+" "+(data.teamName||"YOUR TEAM"),70,270);
    ctx.shadowBlur=0;
    // Headline
    ctx.font="bold 44px system-ui,Arial,sans-serif";ctx.fillStyle="#fbbf24";
    var hl=data.headline||"Dynasty Moment";
    if(hl.length>40)hl=hl.substring(0,40)+"...";
    ctx.fillText(hl,70,340);
    // Sub-line (season + record)
    ctx.font="28px system-ui,Arial,sans-serif";ctx.fillStyle="#94a3b8";
    ctx.fillText("Season "+data.season+(data.record?" \u2022 "+data.record:""),70,400);
    // Stats row if provided
    if(data.stats&&data.stats.length>0){
      var sx=70;
      data.stats.slice(0,4).forEach(function(s){
        ctx.fillStyle="rgba(255,255,255,0.06)";
        ctx.beginPath();ctx.roundRect&&ctx.roundRect(sx,430,180,70,8);ctx.fill();
        ctx.fillStyle="#fbbf24";ctx.font="bold 26px system-ui,Arial,sans-serif";
        ctx.fillText(String(s.val),sx+12,465);
        ctx.fillStyle="#64748b";ctx.font="16px system-ui,Arial,sans-serif";
        ctx.fillText(s.label,sx+12,490);
        sx+=196;
      });
    }
    // Branding footer
    ctx.fillStyle="rgba(255,255,255,0.08)";ctx.fillRect(0,590,1200,40);
    ctx.fillStyle="#475569";ctx.font="16px system-ui,Arial,sans-serif";
    ctx.fillText("Mr. Football Dynasty",60,615);
    ctx.fillText("MFSN \u2022 Dynasty Moments",900,615);
    // Gold bottom bar
    ctx.fillStyle="#fbbf24";ctx.fillRect(0,624,1200,6);
  },
  // Download the card as a PNG
  downloadCard:function(canvas,filename){
    try{
      canvas.toBlob(function(blob){
        if(!blob)return;
        var url=URL.createObjectURL(blob);
        var a=document.createElement("a");
        a.href=url;a.download=(filename||"dynasty-moment")+".png";
        document.body.appendChild(a);a.click();
        setTimeout(function(){document.body.removeChild(a);URL.revokeObjectURL(url);},500);
      },"image/png",0.95);
    }catch(e){console.warn("SHARE_CARD download error:",e);}
  },
  // Generate and download in one call
  generate:function(data,filename){
    try{
      var canvas=document.createElement("canvas");
      SHARE_CARD.drawCard(canvas,data);
      SHARE_CARD.downloadCard(canvas,filename||"dynasty-moment");
    }catch(e){console.warn("SHARE_CARD generate error:",e);}
  }
};
// â”€â”€ END SHARE_CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€ NEGOTIATION_SCENE â€” Feature 5: Contract Negotiation Dialogue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var NEGOTIATION_SCENE={
  // Agent opening statements keyed by personality archetype
  AGENT_LINES:{
    opening:{
      high_greed:[
        "My client is the best {pos} on this team â€” and the market knows it. We're looking at {demand}. Non-negotiable.",
        "Let me be direct: {name} has outside interest. Match {demand} or we're testing free agency.",
        "The market has spoken. {name} is worth {demand}. Don't make this awkward."
      ],
      high_loyalty:[
        "Look â€” {name} loves this city. He wants to stay. We're asking {demand}, and there's room to talk.",
        "{name} told me to be reasonable. He's not chasing money. Start us at {demand} and let's get this done.",
        "This is a hometown deal. {name} wants the ring, not the payday. {demand} gets it done."
      ],
      high_ego:[
        "{name} should be the highest-paid {pos} in this league. We want {demand}. That's where it starts.",
        "He's a franchise player. Franchise players get paid like franchise players. {demand}. Full stop.",
        "Do you know what {name} brings to this locker room? {demand} doesn't even cover the intangibles."
      ],
      high_ambition:[
        "{name} is on a trajectory. He wants a deal that reflects where he's GOING, not where he's been. {demand}.",
        "My client is chasing a legacy. He needs {demand} and a real shot to compete. Can you offer that?",
        "Stars need platforms. {name} wants {demand} and a winning team. Show him both."
      ],
      high_workEthic:[
        "{name} outworks everyone on that roster. His film grade earns {demand}. He's earned it.",
        "Every morning, every rep. {name} demands {demand} because he delivers {demand} worth of effort.",
        "Consistency has a price. {name} has shown up every day. {demand} reflects that."
      ],
      normal:[
        "We're looking for fair market value. {demand} over {years} years feels right.",
        "Simple deal: {name} for {demand} per year. He's proven his worth. Let's get it done.",
        "Nothing fancy here. Market value is {demand}. We're ready to sign if you are."
      ]
    },
    counter:{
      low_gap:[
        "We're close. Bump it to {ask} and we've got ourselves a deal.",
        "Almost there. {name} asked me to push one more time. {ask} closes it.",
        "One final move and he's yours. {ask}. Take it."
      ],
      mid_gap:[
        "That's a start, but we're not there. Come up to {ask}.",
        "I hear you. But {name} is worth more than that. {ask} is the next step.",
        "We came down. Now you come up. {ask} and we keep talking."
      ],
      high_gap_greed:[
        "That's an insult. We're going to test free agency if that's the best you've got.",
        "My client deserves better than that. Walk me up to {ask} or we're done here.",
        "You're not serious with that number. {ask}. That's your last chance."
      ],
      high_gap_loyalty:[
        "{name} wants to stay. But he can't justify that number to his family. {ask}.",
        "He asked me to be patient. I'm trying. But {ask} is the floor.",
        "This is hard. He loves this place. But {ask} is what we need."
      ],
      walkout:[
        "{name} needs time to think. We'll talk to other teams.",
        "We're stepping back. Other doors are open. Don't wait too long.",
        "Talks are over for now. {name} has options. Use this time wisely."
      ],
      accepted:[
        "Alright. {name} respects the organization. We'll take it. Call the press.",
        "Deal. He's excited. He said this is where he wants to be.",
        "Signed. {name} said to tell you he's going all in for a ring this year."
      ]
    }
  },
  // Get the right opening line based on player personality
  getOpeningLine:function(player,demand,years){
    var pers=player.personality||{};
    var greed=pers.greed||0;var loyalty=pers.loyalty||0;
    var ego=pers.ego||(pers.pressure||0);// ego mapped from pressure
    var ambition=pers.ambition||0;var workEthic=pers.workEthic||0;
    var pool;
    if(greed>=7)pool=NEGOTIATION_SCENE.AGENT_LINES.opening.high_greed;
    else if(loyalty>=7)pool=NEGOTIATION_SCENE.AGENT_LINES.opening.high_loyalty;
    else if(ego>=7||pers.pressure>=7)pool=NEGOTIATION_SCENE.AGENT_LINES.opening.high_ego;
    else if(ambition>=7)pool=NEGOTIATION_SCENE.AGENT_LINES.opening.high_ambition;
    else if(workEthic>=7)pool=NEGOTIATION_SCENE.AGENT_LINES.opening.high_workEthic;
    else pool=NEGOTIATION_SCENE.AGENT_LINES.opening.normal;
    var idx=Math.abs((player.id||"").charCodeAt(0)||0)%pool.length;
    return pool[idx]
      .replace("{name}",player.name||"He")
      .replace("{pos}",player.pos||"player")
      .replace("{demand}","$"+demand+"M/yr")
      .replace("{years}",years||"3");
  },
  // Get counter line based on gap and personality
  getCounterLine:function(player,ask,offerGap){
    var pers=player.personality||{};var greed=pers.greed||0;var loyalty=pers.loyalty||0;
    var pool;
    if(offerGap<2)pool=NEGOTIATION_SCENE.AGENT_LINES.counter.accepted;
    else if(offerGap<4)pool=NEGOTIATION_SCENE.AGENT_LINES.counter.low_gap;
    else if(offerGap<8)pool=NEGOTIATION_SCENE.AGENT_LINES.counter[(loyalty>=6?"high_gap_loyalty":"mid_gap")];
    else if(greed>=7)pool=NEGOTIATION_SCENE.AGENT_LINES.counter.high_gap_greed;
    else if(loyalty>=6)pool=NEGOTIATION_SCENE.AGENT_LINES.counter.high_gap_loyalty;
    else pool=NEGOTIATION_SCENE.AGENT_LINES.counter.walkout;
    var idx=Math.abs((player.id||"").charCodeAt(1)||0)%pool.length;
    return pool[idx]
      .replace("{name}",player.name||"He")
      .replace("{ask}","$"+ask+"M");
  }
};
// â”€â”€ END NEGOTIATION_SCENE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€ PIPELINE â€” Feature 7: College Pipeline / Scouting Trips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var PIPELINE_SCHOOLS=[
  {id:"state_u",name:"State University",region:"midwest",tier:"power",tendency:{scheme:"balanced",posBonus:["OL","LB"]},icon:"ðŸŒ½"},
  {id:"southern_u",name:"Southern University",region:"south",tier:"power",tendency:{scheme:"pro_run",posBonus:["RB","DL"]},icon:"ðŸˆ"},
  {id:"coastal_tech",name:"Coastal Tech",region:"southeast",tier:"power",tendency:{scheme:"air_raid",posBonus:["WR","QB"]},icon:"ðŸŒŠ"},
  {id:"metro_college",name:"Metro College",region:"northeast",tier:"mid",tendency:{scheme:"west_coast",posBonus:["WR","TE"]},icon:"ðŸ™ï¸"},
  {id:"plains_a_m",name:"Plains A&M",region:"midwest",tier:"power",tendency:{scheme:"option",posBonus:["QB","RB"]},icon:"ðŸŒ¾"},
  {id:"mountain_state",name:"Mountain State",region:"west",tier:"mid",tendency:{scheme:"balanced",posBonus:["LB","S"]},icon:"â›°ï¸"},
  {id:"river_valley",name:"River Valley",region:"south",tier:"mid",tendency:{scheme:"pro_run",posBonus:["OL","TE"]},icon:"ðŸŒŠ"},
  {id:"golden_coast",name:"Golden Coast",region:"west",tier:"power",tendency:{scheme:"spread",posBonus:["WR","CB"]},icon:"â˜€ï¸"},
  {id:"northern_inst",name:"Northern Institute",region:"north",tier:"mid",tendency:{scheme:"4-3_defense",posBonus:["DL","LB"]},icon:"â„ï¸"},
  {id:"capital_u",name:"Capital University",region:"east",tier:"power",tendency:{scheme:"pro_set",posBonus:["QB","WR"]},icon:"ðŸ›ï¸"},
  {id:"bayou_state",name:"Bayou State",region:"south",tier:"power",tendency:{scheme:"smashmouth",posBonus:["RB","OL"]},icon:"ðŸŠ"},
  {id:"tech_poly",name:"Tech Polytech",region:"southwest",tier:"mid",tendency:{scheme:"air_raid",posBonus:["QB","WR"]},icon:"âš¡"},
  {id:"lakeshore_u",name:"Lakeshore University",region:"midwest",tier:"mid",tendency:{scheme:"balanced",posBonus:["CB","S"]},icon:"ðŸžï¸"},
  {id:"desert_state",name:"Desert State",region:"west",tier:"mid",tendency:{scheme:"spread",posBonus:["RB","CB"]},icon:"ðŸŒµ"},
  {id:"valley_cc",name:"Valley Community",region:"south",tier:"small",tendency:{scheme:"pro_run",posBonus:["DL","K"]},icon:"ðŸŒ„"}
];
var PIPELINE_TIERS=[
  {min:0,max:24,label:"Cold",emoji:"ðŸ§Š",devBonus:0,intelBonus:0,color:"#64748b"},
  {min:25,max:49,label:"Warm",emoji:"ðŸ”¥",devBonus:0.02,intelBonus:0.10,color:"#f97316"},
  {min:50,max:74,label:"Pipeline",emoji:"ðŸŽ“",devBonus:0.05,intelBonus:0.25,color:"#22d3ee"},
  {min:75,max:100,label:"Feeder",emoji:"â­",devBonus:0.08,intelBonus:0.40,color:"#fbbf24"}
];
var PIPELINE={
  getTier:function(score){
    for(var i=PIPELINE_TIERS.length-1;i>=0;i--){
      if(score>=PIPELINE_TIERS[i].min)return PIPELINE_TIERS[i];
    }
    return PIPELINE_TIERS[0];
  },
  getBonus:function(schoolId,teamPipeline){
    if(!teamPipeline||!teamPipeline[schoolId])return{devBonus:0,intelBonus:0};
    return PIPELINE.getTier(teamPipeline[schoolId]);
  },
  sendScout:function(schoolId,teamPipeline){
    var prev=teamPipeline||{};
    var current=prev[schoolId]||0;
    var gain=Math.floor(RNG.ai()*10)+6;// 6-15 pts per scout trip
    var newScore=Math.min(100,current+gain);
    var result=assign({},prev);result[schoolId]=newScore;
    return{pipeline:result,gain:gain,newScore:newScore};
  },
  decay:function(teamPipeline){
    if(!teamPipeline)return{};
    var result=assign({},teamPipeline);
    Object.keys(result).forEach(function(id){
      result[id]=Math.max(0,(result[id]||0)-3);
    });
    return result;
  },
  // Pick a school for a draft prospect, weighted by pipeline scores + position tendency
  // Returns {school:string, pipelineId:string|null, devBonus:number, intelBonus:number}
  pickSchoolForProspect:function(pos,tier,teamPipeline){
    var pipeline=teamPipeline||{};
    // Build weighted pool: pipeline schools weighted by score, plus baseline COL pool
    var weighted=[];
    PIPELINE_SCHOOLS.forEach(function(sch){
      var score=pipeline[sch.id]||0;
      var pTier=PIPELINE.getTier(score);
      // Base weight: 1 for cold, scaling up to 8 for feeder
      var baseW=score<25?1:score<50?3:score<75?6:8;
      // Position bonus: double weight if this school favors the prospect's position
      var posW=(sch.tendency&&sch.tendency.posBonus&&sch.tendency.posBonus.indexOf(pos)>=0)?2:1;
      // Tier bonus: star/good prospects more likely from pipeline schools
      var tierW=(tier==="star"||tier==="good")?1.5:1;
      var w=Math.round(baseW*posW*tierW);
      for(var wi=0;wi<w;wi++)weighted.push({name:sch.name,id:sch.id,devBonus:pTier.devBonus,intelBonus:pTier.intelBonus});
    });
    // Pad with generic college pool so pipeline schools never dominate entirely
    // Generic schools get weight ~5 each, keeping them prevalent but pipeline schools elevated
    var genericPool=COL_WEIGHTED.concat(COL_G5);
    var genericCount=Math.max(20,weighted.length);
    for(var gi=0;gi<genericCount;gi++){
      weighted.push({name:genericPool[gi%genericPool.length],id:null,devBonus:0,intelBonus:0});
    }
    var chosen=weighted[Math.floor(RNG.draft()*weighted.length)];
    return chosen||{name:pickCollege(tier==="star"||tier==="good"),id:null,devBonus:0,intelBonus:0};
  }
};
// â”€â”€ END PIPELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€ WAR_ROOM â€” Feature 1: Draft Day Pick Clock + MFSN Ticker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var DRAFT_STATES={
  INTRO:"INTRO",ON_CLOCK:"ON_CLOCK",AI_PICKING:"AI_PICKING",
  PICK_MADE:"PICK_MADE",ROUND_BREAK:"ROUND_BREAK",COMPLETE:"COMPLETE"
};
var MFSN_DRAFT_LINES=[
  "ðŸŽ™ï¸ MFSN: This is THE night every GM has circled on their calendar.",
  "ðŸ“¡ Draft coverage brought to you live from the MFSN studios.",
  "ðŸŽ¤ Our analysts are calling tonight one of the deepest classes in years.",
  "âš¡ Multiple trade rumors swirling as teams get set to go on the clock.",
  "ðŸ”¥ Every scout in football has their big board locked and loaded.",
  "ðŸ“Š The analytics teams have been grinding film for months â€” it all comes down to tonight.",
  "ðŸ’¼ GMs are making the calls that will define their franchises for a decade.",
  "ðŸŸï¸ The war rooms are ready. The boards are set. Let's get this draft started."
];
var WAR_ROOM_TICKERS=[
  "âš¡ Sources: multiple teams exploring trades to move up.",
  "ðŸ“¡ MFSN: Several teams in contact about packages at the top.",
  "ðŸ” Trade rumors heating up â€” phones ringing across the league.",
  "ðŸŽ™ï¸ Analyst: 'This class has a lot of hidden gems in rounds 2 and 3.'",
  "ðŸ’¡ Insider tip: Two division rivals targeting the same QB position.",
  "ðŸ“ˆ Board movement: Three top-10 prospects slipping amid character concerns.",
  "ðŸŸï¸ Crowd going electric as the clock winds down.",
  "âš ï¸ Breaking: Late-night medical report could shake up the top 5.",
  "ðŸŽ¯ Our draft model projects at least 2 Pro Bowlers in the first round.",
  "ðŸ“Š MFSN Draft-O-Meter: 60% chance of a trade in next 3 picks."
];
// DraftClock â€” React component (declared at top-level to avoid re-creating on each render)
var DraftClock=function(props){
  var seconds=props.seconds||30;var onExpire=props.onExpire;var paused=props.paused||false;
  var _t=useState(seconds),t=_t[0],setT=_t[1];
  useEffect(function(){
    if(paused||t<=0){if(t<=0&&onExpire)onExpire();return;}
    var id=setTimeout(function(){setT(function(prev){return prev-1;});},1000);
    return function(){clearTimeout(id);};
  },[t,paused]);
  useEffect(function(){setT(seconds);},[seconds]);
  var color=t>20?"#22c55e":t>10?"#f59e0b":"#ef4444";
  var urgency=t<=5;
  return React.createElement("div",{style:{textAlign:"center",padding:"8px 0"}},
    React.createElement("div",{style:{fontSize:56,fontWeight:900,color:color,lineHeight:1,
      animation:urgency?"pulse-draft 0.4s infinite":"none",fontVariantNumeric:"tabular-nums"}},
      String(t).padStart(2,"0")),
    urgency&&React.createElement("div",{style:{fontSize:14,fontWeight:800,color:"#ef4444",marginTop:2,animation:"pulse-draft 0.5s infinite"}},
      "âš ï¸ HURRY UP â€” BPA AUTO-PICK INCOMING")
  );
};
// â”€â”€ END WAR_ROOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€ MFSN DRAFT SHOW v2 â€” Live analyst panel with team needs + verdicts â”€â”€â”€â”€â”€â”€â”€â”€
var MFSN_SHOW={
  analysts:[
    {name:"Rod Pemberton",icon:"ðŸŽ™ï¸",style:"hype",
     steal:["ROD IS ON HIS FEET! That's the pick of the draft so far!","STEAL ALERT! I had him going top-10. Unbelievable value!","Rod is losing his mind â€” this pick is a HEIST!"],
     reach:["Ooh. Rod doesn't love this one. That's a reach.","Rod raises an eyebrow. 'I had him in the third...'","Bold call. Rod respects the conviction, not the tape."],
     need:["Exactly what they needed! Rod called it in the pre-show!","Rod had this on his draft board as a priority need. Nailed it.","Addresses the biggest hole on that roster. Smart football."],
     value:["Rod approves. Good player, right price.","Solid pick. Rod gives it a thumbs up.","Clean selection. No complaints from Rod."],
     reaction:["ðŸŽ™ï¸","ðŸˆ","âš¡","ðŸ”¥"]},
    {name:"Diane Holloway",icon:"ðŸ“Š",style:"analyst",
     steal:["The analytics LOVE this. Contract value off the charts.","Diane's model had him as a top-5 value play. Team cashed in.","Expected contract value: elite. This front office did their homework."],
     reach:["Diane's model flags a reach. AV projection doesn't support this slot.","The numbers say overdraft. Diane is skeptical.","Contract efficiency takes a hit here. Diane sighs."],
     need:["Need score: maximum. This fills their biggest positional gap.","Diane's positional value chart lights up green. Perfect fit.","The team need index screams for this position. Well-executed."],
     value:["Analytics check out. Diane nods.","Efficiency model approves. Solid expected value.","Clean process. Diane stamps it."],
     reaction:["ðŸ“Š","ðŸ“ˆ","ðŸ§®","âœ…"]},
    {name:"Marcus Steele",icon:"ðŸ”¥",style:"upside",
     steal:["MARCUS IS GOING CRAZY! The ceiling on this kid is INSANE!","Upside pick of the DRAFT. Marcus called it!","If he develops? We'll be talking about this pick for years."],
     reach:["Marcus loves the upside but... that's a lot of draft capital.","He's got potential, but Marcus isn't sure it's worth this spot.","High-risk, high-reward. Marcus is intrigued but nervous."],
     need:["Need pick AND upside? Marcus is all in.","Fits the scheme and has the ceiling to be a star. Marcus loves it.","Safe floor, massive ceiling. Marcus calls it the total package."],
     value:["Marcus sees the upside. Good selection.","Solid pick. Marcus wants to see how he develops.","Good player. Marcus will be watching Year 2 closely."],
     reaction:["ðŸ”¥","ðŸ’¥","ðŸš€","â­"]},
    {name:"Lena Voss",icon:"ðŸ§ ",style:"scheme",
     steal:["Lena immediately IDs the scheme fit. This is MASTERFUL roster building.","That player was made for their system. Lena is impressed.","Tape study pays off. Lena called this team's interest three weeks ago."],
     reach:["Lena questions the scheme fit. Their system doesn't maximize this skillset.","The tape is good, but does it translate to their offense? Lena is unsure.","Interesting choice. Lena needs to see how the staff deploys him."],
     need:["Scheme fit: perfect. Lena had this player circled for this team all week.","Lena's film study confirms it â€” ideal system fit. Great process.","Their coaching staff will love working with this player. Lena approves."],
     value:["Lena checks out the scheme alignment. Good enough.","Film says he fits. Lena is satisfied.","Smart selection for their system. Lena nods."],
     reaction:["ðŸ§ ","ðŸ“‹","ðŸŽ¯","ðŸŸï¸"]}
  ],
  verdicts:{
    "A+":"STEAL OF THE DRAFT",
    "A":"EXCELLENT VALUE",
    "B+":"STRONG PICK",
    "B":"SOLID SELECTION",
    "C":"ACCEPTABLE",
    "C-":"QUESTIONABLE REACH",
    "D":"SIGNIFICANT REACH"
  },
  verdictColors:{
    "A+":"#22c55e","A":"#4ade80","B+":"#86efac","B":"#fbbf24","C":"#f59e0b","C-":"#f97316","D":"#ef4444"
  },
  getAnalyst:function(pickNum){
    // Rotate analysts by pick number for variety
    return MFSN_SHOW.analysts[pickNum%MFSN_SHOW.analysts.length];
  },
  buildPickCard:function(aiDnEntry,pickNum){
    if(!aiDnEntry)return null;
    var analyst=MFSN_SHOW.getAnalyst(pickNum);
    var grade=aiDnEntry.grade||"B";
    var isSteal=grade==="A+"||grade==="A";
    var isReach=grade==="C-"||grade==="D";
    var fillsNeed=aiDnEntry.reactions&&aiDnEntry.reactions.some(function(r){return r.emoji==="âœ…";});
    var linePool=isSteal?analyst.steal:isReach?analyst.reach:fillsNeed?analyst.need:analyst.value;
    var lineIdx=Math.floor(RNG.ui()*linePool.length);
    var line=linePool[lineIdx];
    var reactionEmoji=analyst.reaction[Math.floor(RNG.ui()*analyst.reaction.length)];
    return{
      analyst:analyst.name,
      analystIcon:analyst.icon,
      reactionEmoji:reactionEmoji,
      line:line,
      grade:grade,
      verdict:MFSN_SHOW.verdicts[grade]||"SOLID PICK",
      verdictColor:MFSN_SHOW.verdictColors[grade]||"#fbbf24",
      team:aiDnEntry.team,
      teamIcon:aiDnEntry.icon,
      player:aiDnEntry.player,
      pos:aiDnEntry.pos,
      ovr:aiDnEntry.ovr,
      pot:aiDnEntry.pot,
      pickNum:aiDnEntry.pickNum,
      round:aiDnEntry.round,
      reactions:aiDnEntry.reactions||[],
      fillsNeed:fillsNeed,
      isSteal:isSteal,
      isReach:isReach,
      timestamp:Date.now()
    };
  }
};
// â”€â”€ END MFSN DRAFT SHOW v2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€ CRISIS_ROOM â€” Feature 15: Dramatic Locker Room Crisis Popup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var CRISIS_ROOM={
  tierColors:{
    URGENT:"#ef4444",
    CRITICAL:"#f97316",
    OPPORTUNITY:"#fbbf24"
  },
  tierGlows:{
    URGENT:"rgba(239,68,68,0.30)",
    CRITICAL:"rgba(249,115,22,0.25)",
    OPPORTUNITY:"rgba(251,191,36,0.25)"
  },
  tierBg:{
    URGENT:"linear-gradient(135deg,rgba(239,68,68,0.14),rgba(239,68,68,0.03))",
    CRITICAL:"linear-gradient(135deg,rgba(249,115,22,0.14),rgba(249,115,22,0.03))",
    OPPORTUNITY:"linear-gradient(135deg,rgba(251,191,36,0.14),rgba(251,191,36,0.03))"
  },
  tierLabel:{
    URGENT:"ðŸš¨ URGENT CRISIS",
    CRITICAL:"âš ï¸ CRITICAL SITUATION",
    OPPORTUNITY:"âœ¨ FRANCHISE OPPORTUNITY"
  },
  // consequence preview text keyed to action
  consequences:{
    lock_star_in:{short:"Emergency max extension",risk:"Cap hit",reward:"Franchise cornerstone secured"},
    go_public_trade:{short:"Public confrontation",risk:"Locker room could fracture",reward:"Forces resolution immediately"},
    listen_offers:{short:"Shop your star",risk:"Locker room morale drop",reward:"Possible blue chip return"},
    back_vets:{short:"Veterans lead the ship",risk:"Young core disengages",reward:"Experience steadies team"},
    back_youngcore:{short:"Next gen takes over",risk:"Veterans disengage",reward:"High ceiling, volatile floor"},
    force_bonding:{short:"Mandatory unity week",risk:"Short-term practice hit",reward:"Permanent chemistry floor raised"},
    face_music:{short:"Own it publicly",risk:"Short-term morale dip",reward:"Owner + fan trust restored"},
    close_doors:{short:"Bunker mentality",risk:"Owner loses patience",reward:"Team bonds internally"},
    shake_depth:{short:"Shock the roster",risk:"Some players crack under pressure",reward:"New heroes emerge"},
    redemption_spotlight:{short:"Full spotlight on them",risk:"High pressure â€” could crack",reward:"Legend moment if delivered"},
    redemption_slow:{short:"Measured comeback",risk:"Slower arc resolution",reward:"Steady, durable recovery"},
    redemption_organic:{short:"Let it unfold naturally",risk:"Lower ceiling",reward:"No added pressure"},
    call_meeting:{short:"Emergency team meeting",risk:"Could backfire (-2 chem chance)",reward:"+3 morale team-wide"},
    stay_quiet:{short:"Trust the process",risk:"Nothing changes",reward:"Players self-regulate"},
    back_star:{short:"Publicly back your star",risk:"-2 team chemistry",reward:"+6 star chemistry"},
    stay_neutral:{short:"Switzerland mode",risk:"Star stays unhappy",reward:"+1 team chem"},
    fine_player:{short:"Hit the wallet",risk:"-3 morale",reward:"+2 discipline"},
    private_talk:{short:"Keep it in-house",risk:"-1 team morale",reward:"+1 cancer chemistry"}
  }
};
// â”€â”€ END CRISIS_ROOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€ ARC_SPOTLIGHT â€” Feature 16: Arc-Aware MFSN Weekly Broadcast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var ARC_SPOTLIGHT={
  // Per-arc analyst commentary pools. Each has won/lost variants.
  lines:{
    BREAKOUT:{
      won:[
        "{name} IS THE REAL DEAL. Another week, another statement performance. The {pos} market just got reset.",
        "You cannot stop {name} right now. Whatever they're paying this kid â€” it's not enough.",
        "BREAKOUT WATCH is officially over. {name} has arrived. Full stop.",
        "Week after week, {name} keeps proving the skeptics wrong. That\u2019s what franchise players do."
      ],
      lost:[
        "{name} is showing flashes even in the loss. This kid's arc doesn't stop â€” just a speed bump.",
        "Don't let the L fool you. {name} was the brightest thing out there today. Future is bright.",
        "Hard to break out when your team's struggling. {name} still stands out. That's rare."
      ],
      badge:"ðŸŒ± BREAKOUT",badgeColor:"#34d399"
    },
    ELITE:{
      won:[
        "ELITE. Not a conversation anymore. {name} is the best {pos} in this league and it isn't close.",
        "When the game was on the line, {name} delivered. That\u2019s what All-Pro looks like.",
        "{name} just put on a masterclass. The film room is going to have a lot to say about that one.",
        "Hall of Fame trajectory. {name} keeps piling up the kind of performances that define legacies."
      ],
      lost:[
        "{name} still balled out. Can\u2019t blame them for this one. Team needs to build around this player.",
        "Even in a rough one, {name} showed why they\u2019re the best. Carries a heavy load alone too often.",
        "The {pos} position has one clear king right now and it\u2019s {name}. Today doesn\u2019t change that."
      ],
      badge:"â­ ELITE",badgeColor:"#fbbf24"
    },
    SLUMP:{
      won:[
        "Let\u2019s see if today was the turning point for {name}. They needed a game like that.",
        "{name} had flashes today â€” but is it enough to break out of the funk? Time will tell.",
        "Maybe this is the reset {name} needed. One win doesn\u2019t fix a slump, but it\u2019s a start."
      ],
      lost:[
        "Rough go again for {name}. The slump is real and the questions are getting louder.",
        "At what point does the coaching staff make a change? {name} needs to find something â€” and fast.",
        "There\u2019s a player in there. The {name} from earlier in their career still exists. But right now? Nowhere to be found."
      ],
      badge:"ðŸ“‰ SLUMP",badgeColor:"#ef4444"
    },
    COMEBACK:{
      won:[
        "REDEMPTION ROAD continues for {name}. They said the story was over â€” they were wrong.",
        "You can\u2019t write a better comeback story. {name} has been through it all and keeps showing up.",
        "The league counted {name} out. Big mistake. That performance today was personal."
      ],
      lost:[
        "Setback on the comeback trail for {name}. But nobody said redemption was a straight line.",
        "{name} is fighting. You can see it. The comeback isn\u2019t dead â€” just taking longer than hoped.",
        "Still believe in {name}. Today hurt, but the arc isn\u2019t over."
      ],
      badge:"ðŸ”„ COMEBACK",badgeColor:"#22d3ee"
    },
    DECLINE:{
      won:[
        "Father Time undefeated â€” but {name} is fighting back today. Good win, great effort.",
        "Maybe we wrote {name} off too soon. One more chapter left in that story.",
        "Veterans find a way. {name} grinding it out â€” a masterclass in experience over athleticism."
      ],
      lost:[
        "Is this the twilight for {name}? Hard to watch greatness fade, but the numbers don\u2019t lie.",
        "The decline arc is real. {name} has given everything to this game. How much is left in the tank?",
        "Teams around the league are taking note of {name}\u2019s regression. Tough conversations ahead."
      ],
      badge:"ðŸ•°ï¸ DECLINE",badgeColor:"#94a3b8"
    },
    HOLDOUT:{
      won:[
        "{name} playing through contract drama â€” that\u2019s a professional. But this situation needs to be resolved.",
        "All-Pro performance, contract dispute in the background. {name} deserves their money.",
        "You can\u2019t question the effort. {name} is giving everything while the front office haggles. Respect."
      ],
      lost:[
        "Hard to play your best ball when your future is uncertain. {name} deserves clarity.",
        "The contract situation is clearly affecting the locker room. {name} needs to be locked up.",
        "Get this deal done. {name} is too important to let this drag on."
      ],
      badge:"ðŸ’° HOLDOUT",badgeColor:"#f97316"
    },
    SWAN_SONG:{
      won:[
        "One more chapter for {name}. The career is winding down but the passion? Still burning.",
        "If this is the end, {name} is going out with everything left on the field. Beautiful.",
        "Veteran leadership on full display. {name} knows every play could be their last â€” and plays like it."
      ],
      lost:[
        "Hard to watch the final chapter of a great career play out. {name} deserves better than this.",
        "The legend is fading. {name} gave this game everything. Today, the game gave back nothing.",
        "Whenever {name} hangs up the cleats, the Hall of Fame speech writes itself. That career is one for the ages."
      ],
      badge:"ðŸ¦¢ SWAN SONG",badgeColor:"#a855f7"
    },
    MENTOR:{
      won:[
        "{name} quietly making everyone around them better. That\u2019s what a mentor does â€” the stats don\u2019t capture it.",
        "Leadership by example from {name}. Watch how the young guys play differently when they\u2019re on the field.",
        "Veteran presence matters. {name} is the heartbeat of that locker room whether they're starting or not."
      ],
      lost:[
        "{name} still the emotional anchor even in a tough loss. Team wouldn\u2019t be the same without them.",
        "Hard to quantify what {name} brings. But watch the young guys around them develop â€” that\u2019s the legacy.",
        "The mentor role is thankless. {name} doing it anyway. Class act."
      ],
      badge:"ðŸ“š MENTOR",badgeColor:"#60a5fa"
    }
  },
  // Generate spotlight objects for key arc players on user's team
  generate:function(roster,won,week,myTeam){
    var spots=[];
    var safeRoster=Array.isArray(roster)?roster:[];
    var arcOrder=["BREAKOUT","SLUMP","ELITE","COMEBACK","SWAN_SONG","HOLDOUT","DECLINE","MENTOR"];
    arcOrder.forEach(function(arcKey){
      var p=null;
      for(var i=0;i<safeRoster.length;i++){
        var row=safeRoster[i];
        if(!row)continue;
        if((row._arcState||"")===arcKey&&row.isStarter&&(row.ovr||0)>=70){p=row;break;}
      }
      if(!p)return;
      var pool=ARC_SPOTLIGHT.lines[arcKey];if(!pool)return;
      var lines=won?pool.won:pool.lost;
      var line=lines[Math.floor(RNG.ui()*lines.length)];
      line=line.replace(/\{name\}/g,p.name).replace(/\{pos\}/g,p.pos);
      spots.push({arcKey:arcKey,badge:pool.badge,badgeColor:pool.badgeColor,
        playerName:p.name,pos:p.pos,ovr:p.ovr,age:p.age,
        line:line,week:week});
    });
    return spots.slice(0,3);// Max 3 spotlights per recap
  }
};
// â”€â”€ END ARC_SPOTLIGHT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// v99.4 â€” Meta/Llama: Trade Deadline Drama System
var TRADE_DEADLINE_994 = {
  deadlineFrenzy: [
    "Every phone in every war room is lit. Nobody is eating lunch today.",
    "The most important four hours in the football calendar. Everything can change.",
    "The air is thick with tension and possibility. A contender becomes a champion right here.",
    "This is what November is for. The buyers, the sellers, and the silence in between.",
    "Rumors are flying. Some are smoke, some are fire. All of it feels real right now.",
    "The clock is the loudest thing in the room.",
    "One phone call can alter the course of two franchises. The weight of that is palpable.",
    "GMs are playing high-stakes poker. The tells are in the whispers down the hallway.",
    "The foundation of next season's champion might be laid in the next 180 minutes.",
    "Is your team a buyer or a seller? Today, there is no middle ground.",
    "The final hours of the trade window. This is where seasons are saved or sold.",
    "Every reporter is refreshing their feed. Every fan is holding their breath.",
    "The league is a powder keg, and the deadline is the match.",
    "A day of calculated risks and quiet goodbyes.",
    "The phones are hot. The coffee is stale. The tension is perfect.",
    "This is the last chance to change the narrative of the season.",
    "Today, hope is a commodity to be bought and sold.",
    "The entire league holds its breath. The frenzy is on.",
    "It's not just about players; it's about signals. Who is going for it, and who is folding?",
    "4 PM. That's the only deadline that matters. And it is coming fast."
  ],
  buyerModeNarrative: [
    "[TEAM] is not waiting anymore. They're calling everyone. All in for [PLAYER].",
    "When a team decides to go for it, really go for it â€” this is what it looks like.",
    "This is the move that defines the season for [TEAM]. Championship or bust.",
    "They gave up a lot. They know. And they don't care. The only thing that matters is winning in January.",
    "The front office of [TEAM] just pushed all their chips to the center of the table.",
    "This isn't a rental. It's a declaration of intent. [TEAM] is here to win it all.",
    "[PLAYER] was the missing piece. [TEAM] went out and got him, cost be damned.",
    "A quiet confidence emanates from the [TEAM] war room. They got their guy.",
    "This move wasn't made for the headlines in November. It was made for the confetti in February.",
    "The message from [TEAM] to its locker room is clear: We believe in you. Now, go finish it.",
    "They saw a window of opportunity and didn't just knock; they kicked the door down.",
    "This is the kind of aggressive, purposeful move that dynasties are built on.",
    "The price was steep, but the price of regret is always steeper. [TEAM] made their choice.",
    "You don't make a trade like this unless you believe you're one player away.",
    "The entire league just took notice. [TEAM] is not playing for next year.",
    "They identified their weakness and addressed it with conviction. That's how champions are built.",
    "The future is now for [TEAM]. They've made their move.",
    "There's a new energy in the building. Hope has a name, and it's [PLAYER].",
    "This is a trade that sends a shockwave through the conference. The arms race is on.",
    "No hesitation. No second thoughts. [TEAM] knew what they needed and went and got it."
  ],
  sellerModeNarrative: [
    "When a rebuilding team answers the phone, the veterans know what that means.",
    "[TEAM] is in a different phase now. [PLAYER] deserves a chance to compete.",
    "This isn't a surrender; it's a strategy. [TEAM] is building for the long haul.",
    "The hardest thing a GM can do is trade a player like [PLAYER]. But business is business.",
    "It's a painful but necessary move. The future of [TEAM] got brighter today.",
    "They're collecting draft picks and young talent. The focus for [TEAM] has shifted to tomorrow.",
    "This trade is a nod to reality. [TEAM] knows where they are and where they're going.",
    "Giving a beloved veteran a chance to win a ring is its own kind of victory.",
    "The locker room will be quieter tomorrow. The price of a rebuild is paid in moments like these.",
    "It's a bittersweet transaction. Goodbye to a leader, hello to a new foundation.",
    "This move won't be popular, but it's the right one for the future of the franchise.",
    "They honored [PLAYER] by sending him to a contender. A class move by [TEAM].",
    "The cycle of football is cruel. Today, [TEAM] chose the future over the present.",
    "A tough day, but a necessary one. The rebuild of [TEAM] has truly begun.",
    "This is the dignified sacrifice of a team that knows a championship isn't in the cards this year."
  ],
  farewellMoment: [
    "[PLAYER] cleaned out his locker quietly. That's how these things end.",
    "He spent years building something here with [TEAM]. The trade is two sentences in a press release.",
    "The phone call to his family. The handshake with the GM. The last walk out of the facility.",
    "He looked out at the practice field one last time. So many battles won on that grass.",
    "His parking spot, his favorite lunch order, the handshake with the security guard. All gone in an instant.",
    "He didn't say much to the reporters. He just nodded. Everyone understood.",
    "The hardest part is saying goodbye to the equipment guys. The ones who were there every day.",
    "This is the part of the game nobody likes to talk about. The business is brutal.",
    "A career with [TEAM], reduced to a travel itinerary for a flight to a new city.",
    "He left his playbook on the chair. He won't need it anymore.",
    "The locker room was quiet as he packed his bag. A silent, knowing respect.",
    "Just like that, a pillar of the team becomes a memory.",
    "Football is a game of violent collisions, but the quietest moments are often the heaviest.",
    "He's a professional. He'll show up and do his job. But a piece of him will always be with [TEAM].",
    "The end comes for everyone. For [PLAYER], it came on a Tuesday afternoon in November."
  ],
  arrivalHype: [
    "[PLAYER] lands at [TEAM] with one purpose. He knows exactly what month they're building toward.",
    "New city. New uniform. Same hunger. [PLAYER] is exactly where he wants to be.",
    "He didn't come here to make friends. He came here to win a championship.",
    "The energy in the building shifted the moment [PLAYER] walked through the door. It's real now.",
    "He's the final piece of the puzzle. Everyone in that [TEAM] locker room knows it.",
    "You can see the focus in his eyes. [PLAYER] is on a mission.",
    "The flight was long, the playbook is thick, but the goal is simple: win four more games.",
    "This is what it feels like when a contender goes all-in. This is the energy of a championship run.",
    "He's been welcomed not as a stranger, but as the reinforcement they've been waiting for.",
    "No time for introductions. It's time to get to work. January is coming.",
    "The ink on the trade papers is barely dry, and [PLAYER] is already in the film room.",
    "He brings more than just talent; he brings the belief that it's possible.",
    "This isn't just a new chapter for [PLAYER]; it's the final chapter.",
    "From a team going nowhere to a team with a shot at everything. The stakes have changed.",
    "The locker room just got better. The championship odds just got shorter. [PLAYER] is here."
  ],
  stoodPat: [
    "They stood pat. They better be right.",
    "The phone calls came. They passed on every one. Now we find out why.",
    "4 PM came and went. The team you have is the team you have.",
    "They believe in the guys in that room. A powerful statement.",
    "Was it confidence or complacency? The next eight weeks will tell the story.",
    "The deadline passes in silence. A vote of faith in the current roster.",
    "All around them, their rivals got better. They chose to trust themselves.",
    "They looked at the price tags and decided the cost was too high. A disciplined, if unpopular, choice.",
    "The war room is dark. The decision is made. No moves.",
    "They're betting on chemistry over change. A bold gamble."
  ],
  lastRide: [
    "[PLAYER] has one more run in him. He can feel it. This is the team.",
    "He's been waiting for this trade for three years. It arrived on deadline day.",
    "A dozen years in the league, and this is his best, last chance at a ring.",
    "He's the grizzled veteran who has seen it all. Except for a championship parade.",
    "This isn't about the money or the stats anymore. It's about one last shot at glory.",
    "He walks into that locker room, and he brings the wisdom of a thousand battles with him.",
    "Every practice, every game from here on out is a gift. He knows it.",
    "He's playing for the name on the front of the jersey, and for the one chance he has left.",
    "Years of 'almost' and 'not quite' have led to this. His final stand.",
    "He thought this dream was over. Today, it just got a second life."
  ]
};


var TRADE_DEADLINE_FRENZY={
  isDeadlineWindow:function(week){return week>=8&&week<=10;},
  generateAITrades:function(teams,week,myId){
    if(week<8||week>10)return[];
    var trades=[];
    var contenders=teams.filter(function(t){return t.id!==myId&&(t.wins||0)>=Math.max(5,Math.round((week-1)*0.5));});
    var sellers=teams.filter(function(t){return t.id!==myId&&(t.losses||0)>=Math.max(6,Math.round((week-1)*0.6));});
    contenders.forEach(function(ct){
      if(RNG.ai()<0.25){// 25% chance per contender per deadline week
        var needs={};var posList=["QB","RB","WR","TE","OL","DL","LB","CB","S"];
        posList.forEach(function(pos){
          var sts=(ct.roster||[]).filter(function(p){return p.pos===pos;}).sort(function(a,b){return b.ovr-a.ovr;});
          if(sts.length>0&&sts[0].ovr<72)needs[pos]=80-sts[0].ovr;
        });
        var topNeed=null;var topVal=0;
        Object.keys(needs).forEach(function(pos){if(needs[pos]>topVal){topVal=needs[pos];topNeed=pos;}});
        if(topNeed){
          var seller=sellers.find(function(s){
            return (s.roster||[]).some(function(p){return p.pos===topNeed&&(p.ovr||50)>=70;});
          });
          if(seller){
            var traded=(seller.roster||[]).find(function(p){return p.pos===topNeed&&(p.ovr||50)>=70;});
            if(traded){
              trades.push({
                buyer:ct.abbr,buyerIcon:ct.icon,
                seller:seller.abbr,sellerIcon:seller.icon,
                player:traded.name,pos:traded.pos,ovr:traded.ovr,
                text:ct.icon+ct.abbr+" acquires "+traded.name+" ("+traded.pos+" "+traded.ovr+") from "+seller.icon+seller.abbr+"!",
                week:week
              });
            }
          }
        }
      }
    });
    return trades.slice(0,3);// Max 3 trades per week
  }
};
var FLEX_POSITIONS={
  eligible:{
    QB:[],// QBs don't flex
    RB:["WR"],// Pass-catching backs
    WR:["TE","RB"],// Big receivers, gadget players
    TE:["WR","OL"],// Move TEs, blocking TEs
    OL:[],// OL stays OL
    DL:["LB"],// Tweeners
    LB:["DL","S"],// Edge rushers, coverage LBs
    CB:["S"],// Slot corners
    S:["LB","CB"],// Hybrid safeties
    K:[],P:[]
  },
  assign:function(player){
    if(!player||!player.ratings)return null;
    var opts=FLEX_POSITIONS.eligible[player.pos]||[];
    if(opts.length===0)return null;
    var r=player.ratings;
    if(player.pos==="RB"&&(r.catching||50)>=65)return"WR";
    if(player.pos==="WR"&&(r.blocking||50)>=60&&(r.catching||50)>=70)return"TE";
    if(player.pos==="WR"&&(r.speed||50)>=80&&(r.elusiveness||50)>=70)return"RB";
    if(player.pos==="TE"&&(r.routeRunning||50)>=65&&(r.catching||50)>=70)return"WR";
    if(player.pos==="DL"&&(r.speed||50)>=70&&(r.coverage||r.tackle||50)>=60)return"LB";
    if(player.pos==="LB"&&(r.passRush||50)>=70)return"DL";
    if(player.pos==="LB"&&(r.coverage||50)>=65&&(r.speed||50)>=72)return"S";
    if(player.pos==="CB"&&(r.tackling||r.tackle||50)>=60)return"S";
    if(player.pos==="S"&&(r.coverage||50)>=70&&(r.speed||50)>=75)return"CB";
    if(player.pos==="S"&&(r.tackle||50)>=70&&(r.hitPower||50)>=65)return"LB";
    if(RNG.ai()<0.15&&opts.length>0)return opts[Math.floor(RNG.ai()*opts.length)];
    return null;
  },
  getFlexPenalty:function(){return-4;}// -4 OVR when playing out of position
};
var PRACTICE_REPORT={
  generate:function(team,week){
    if(!team||!team.roster)return null;
    var injuryReport=[];
    var practiceStar=null;var practiceStarReason="";
    team.roster.forEach(function(p){
      if(p.injury&&p.injury.games>0){
        injuryReport.push({name:p.name,pos:p.pos,ovr:p.ovr,injury:p.injury.type,
          status:p.injury.games>=3?"DNP":p.injury.games>=1?"Limited":"Full",
          games:p.injury.games,isStarter:p.isStarter});
      }
    });
    var healthy=team.roster.filter(function(p){return !(p.injury&&p.injury.games>0)&&(p.ovr||50)>=60;});
    if(healthy.length>0){
      var candidates=healthy.filter(function(p){return p.age<=25||((p.contract||{}).years||0)<=1;});
      if(candidates.length===0)candidates=healthy;
      practiceStar=candidates[Math.floor(RNG.ai()*candidates.length)];
      var reasons=[
        "dominated 1-on-1 drills all week",
        "had an incredible practice â€” coaches are raving",
        "is turning heads with improved technique",
        "made a jaw-dropping play in team drills",
        "showed elite effort and intensity all week",
        "is pushing for more playing time with his practice performance",
        "came to work early every day this week â€” film room warrior"
      ];
      practiceStarReason=reasons[Math.floor(RNG.ai()*reasons.length)];
    }
    var schemePct=Math.min(100,Math.round(week*8+Math.floor(RNG.ai()*10)));
    return{
      injuryReport:injuryReport.sort(function(a,b){var ord={DNP:0,Limited:1,Full:2};return(ord[a.status]||0)-(ord[b.status]||0);}),
      practiceStar:practiceStar?{id:practiceStar.id,name:practiceStar.name,pos:practiceStar.pos,ovr:practiceStar.ovr,reason:practiceStarReason}:null,
      schemePct:schemePct,
      week:week
    };
  }
};
// v96: Position-specific attribute pools for practice star breakdown
var PRAC_STAR_ATTRS={
  // v96.1: Uses REAL rating fields from POS_DEF + RATING_LABELS for display
  generateBreakdown:function(pos,totalBoost,player){
    var def=POS_DEF[pos];if(!def)return[];
    // Pick from the top-weighted ratings for this position (most impactful)
    var rated=def.r.map(function(rName,i){return{rName:rName,w:def.w[i]||1};});
    rated.sort(function(a,b){return b.w-a.w;});
    var topPool=rated.slice(0,12);// top 12 by weight
    // Shuffle top pool
    for(var si=topPool.length-1;si>0;si--){var sj=Math.floor(RNG.ai()*(si+1));var tmp=topPool[si];topPool[si]=topPool[sj];topPool[sj]=tmp;}
    var count=Math.min(topPool.length,totalBoost<=3?2:totalBoost<=5?3:4);
    var selected=topPool.slice(0,count);
    var vals=[];var remain=totalBoost;
    for(var a=0;a<selected.length;a++){
      if(a===selected.length-1){vals.push(Math.max(1,remain));}
      else{var v=Math.max(1,Math.floor(remain/(selected.length-a))+Math.floor(RNG.ai()*2));v=Math.min(v,remain-1);vals.push(v);remain-=v;}
    }
    return selected.map(function(s,i){return{rName:s.rName,label:RATING_LABELS[s.rName]||s.rName.substring(0,3).toUpperCase(),val:vals[i]};});
  },
  applyBoost:function(player,breakdown){
    // Actually boost the individual ratings, then recalc OVR
    if(!player||!player.ratings||!breakdown)return 0;
    var prevOvr=calcOvr(player);
    breakdown.forEach(function(b){
      if(player.ratings[b.rName]!==undefined){
        player.ratings[b.rName]=cl((player.ratings[b.rName]||60)+b.val,40,99);
      }
    });
    var newOvr=calcOvr(player);
    player.ovr=newOvr;player.trueOvr=newOvr;
    return newOvr-prevOvr;
  },
  removeBoost:function(player,breakdown){
    if(!player||!player.ratings||!breakdown)return;
    breakdown.forEach(function(b){
      if(player.ratings[b.rName]!==undefined){
        player.ratings[b.rName]=cl((player.ratings[b.rName]||60)-b.val,40,99);
      }
    });
    player.ovr=calcOvr(player);player.trueOvr=player.ovr;
  }
};
var UDFA_SYSTEM={
  generatePool:function(count){
    var ps=["QB","RB","WR","WR","TE","OL","OL","DL","DL","LB","LB","CB","CB","S","K","P"];
    var pool=[];
    var udfaCount97=count||getScaledUdfaCount97();
    for(var i=0;i<udfaCount97;i++){
      var pos=ps[i%ps.length];
      var p=genPlayer(pos,pick(["bad","bad","avg"]),rng(21,24));
      if(RNG.draft()<0.12){// 12% chance of hidden gem
        p.pot=cl(p.ovr+rng(8,15),p.ovr,92);
        p.isGem=true;
      }
      p.contract=makeContract(MIN_SALARY,1,0,0);// Minimum deals
      p.udfaBonus=Math.round(rng(1,8)*10)/10;// Signing bonus demand ($0.1M-$0.8M)
      p.udfaInterest=Math.floor(RNG.draft()*4)+1;// 1-4 teams interested
      pool.push(p);
    }
    return pool.sort(function(a,b){return b.ovr-a.ovr;});
  },
  aiSignings:function(pool,teams,myId){
    var signed=[];
    pool.forEach(function(udfa){
      if(udfa._signed76)return;
      var interest=udfa.udfaInterest||1;
      for(var i=0;i<interest;i++){
        var aiTeam=teams[Math.floor(RNG.ai()*teams.length)];
        if(aiTeam&&aiTeam.id!==myId&&(aiTeam.roster||[]).length<75&&RNG.ai()<0.3){
          udfa._signed76=true;
          signed.push({player:udfa.name,pos:udfa.pos,ovr:udfa.ovr,team:aiTeam.abbr,icon:aiTeam.icon});
          break;
        }
      }
    });
    return signed;
  }
};
var DIV_STANDINGS={
  getDivisions:function(teams){
    if(!teams||teams.length<6)return[];
    if((teams.length||0)<30){
      var divsLegacy=[
        {id:"N",name:"North",conf:"LG",icon:"ðŸ§Š",teams:[]},
        {id:"S",name:"South",conf:"LG",icon:"â˜€ï¸",teams:[]},
        {id:"E",name:"East",conf:"LG",icon:"ðŸŒŠ",teams:[]},
        {id:"W",name:"West",conf:"LG",icon:"ðŸ”ï¸",teams:[]},
        {id:"C",name:"Central",conf:"LG",icon:"â­",teams:[]}
      ];
      teams.forEach(function(t,i){divsLegacy[i%5].teams.push(t);});
      divsLegacy.forEach(function(d){
        d.teams.sort(function(a,b){
          if((a.wins||0)!==(b.wins||0))return (b.wins||0)-(a.wins||0);
          return ((b.pf||0)-(b.pa||0))-((a.pf||0)-(a.pa||0));
        });
        if(d.teams.length===0)return;
        var leader=d.teams[0];
        d.teams.forEach(function(t,i){
          t._gamesBack76=i===0?0:((leader.wins||0)-(t.wins||0));
          t._divRank76=i+1;
        });
      });
      return divsLegacy;
    }
    return LEAGUE_STRUCTURE.divisions.map(function(div){
      var divTeams=teams.filter(function(t){
        if(!t)return false;
        applyLeagueAlignment97(t);
        return div.teams.indexOf(t.id)>=0;
      });
      divTeams.sort(function(a,b){
        if((a.wins||0)!==(b.wins||0))return (b.wins||0)-(a.wins||0);
        return ((b.pf||0)-(b.pa||0))-((a.pf||0)-(a.pa||0));
      });
      if(divTeams.length===0)return null;
      var leader=divTeams[0];
      divTeams.forEach(function(t,i){
        t._gamesBack76=i===0?0:((leader.wins||0)-(t.wins||0));
        t._divRank76=i+1;
      });
      return {id:div.id,name:div.name,conf:div.conf,icon:div.icon,teams:divTeams};
    }).filter(function(div){return !!div;});
  },
  getConferences:function(teams){
    var divs=this.getDivisions(teams);
    return LEAGUE_STRUCTURE.conferences.map(function(conf){
      return {
        id:conf.id,name:conf.name,icon:conf.icon,
        divisions:divs.filter(function(d){return d.conf===conf.id;})
      };
    });
  },
  getUserDiv:function(divs,myId){
    for(var i=0;i<divs.length;i++){
      for(var j=0;j<divs[i].teams.length;j++){
        if(divs[i].teams[j].id===myId)return divs[i];
      }
    }
    return null;
  }
};
var FILM_BREAKDOWN={
  generate:function(gameResult,userTeam,oppTeam,isUserHome){
    if(!gameResult)return null;
    var uScore=isUserHome?gameResult.home:gameResult.away;
    var oScore=isUserHome?gameResult.away:gameResult.home;
    var won=uScore>oScore;var margin=Math.abs(uScore-oScore);
    var recap=gameResult.recap||{};
    var uRecap=isUserHome?recap.home:recap.away;
    var oRecap=isUserHome?recap.away:recap.home;
    var drives=[];var uRunning=0;var oRunning=0;
    var totalDrives=Math.max(8,Math.round(((uScore||0)+(oScore||0))/3.5));
    for(var d=0;d<totalDrives;d++){
      var isUserDrive=d%2===0;
      var pts=0;var result="punt";
      if(isUserDrive){
        var chance=RNG.play();
        if(chance<0.22){pts=7;result="TD";uRunning+=7;}
        else if(chance<0.32){pts=3;result="FG";uRunning+=3;}
        else if(chance<0.42){result="turnover";}
        else{result="punt";}
      }else{
        var chance2=RNG.play();
        if(chance2<0.20){pts=7;result="TD";oRunning+=7;}
        else if(chance2<0.30){pts=3;result="FG";oRunning+=3;}
        else if(chance2<0.40){result="turnover";}
        else{result="punt";}
      }
      drives.push({num:d+1,team:isUserDrive?"user":"opp",result:result,pts:pts,
        uScore:uRunning,oScore:oRunning});
    }
    var turningPoint=null;var biggestSwing=0;
    drives.forEach(function(dr,idx){
      if(dr.pts>0||dr.result==="turnover"){
        var swing=Math.abs(dr.uScore-dr.oScore);
        if(swing>biggestSwing&&idx>1){
          biggestSwing=swing;
          turningPoint={drive:dr.num,desc:dr.result==="TD"?(dr.team==="user"?"Your":"Opponent's")+" touchdown made it "+dr.uScore+"-"+dr.oScore:
            dr.result==="turnover"?(dr.team==="user"?"A costly turnover":"A huge takeaway")+" shifted momentum":
            (dr.team==="user"?"Your":"Opponent's")+" field goal changed the score to "+dr.uScore+"-"+dr.oScore};
        }
      }
    });
    if(!turningPoint)turningPoint={drive:1,desc:"The game was controlled from the opening drive."};
    var mvp=null;
    if(userTeam&&userTeam.roster){
      var candidates=userTeam.roster.filter(function(p){return p.isStarter&&!(p.injury&&p.injury.games>0);});
      if(candidates.length>0){
        candidates.sort(function(a,b){
          var aVal=(a.stats?((a.stats.passYds||0)+(a.stats.rushYds||0)*1.2+(a.stats.recYds||0)+(a.stats.sacks||0)*25+(a.stats.defINT||0)*30+(a.stats.tackles||0)*3):0);
          var bVal=(b.stats?((b.stats.passYds||0)+(b.stats.rushYds||0)*1.2+(b.stats.recYds||0)+(b.stats.sacks||0)*25+(b.stats.defINT||0)*30+(b.stats.tackles||0)*3):0);
          return bVal-aVal;
        });
        mvp={name:candidates[0].name,pos:candidates[0].pos,ovr:candidates[0].ovr};
      }
    }
    return{drives:drives,turningPoint:turningPoint,mvp:mvp,
      uScore:uScore,oScore:oScore,won:won,margin:margin,
      userAbbr:userTeam?userTeam.abbr:"?",oppAbbr:oppTeam?oppTeam.abbr:"?",
      oppIcon:oppTeam?oppTeam.icon:"",
      totalDrives:totalDrives};
  }
};
var HOT_SEAT={
  calcTemp:function(team,role,season){
    if(!team)return 0;
    var base=0;
    var gp=Math.max(1,(team.wins||0)+(team.losses||0));
    var winPct=(team.wins||0)/gp;
    if(winPct<0.35)base+=40;
    else if(winPct<0.45)base+=25;
    else if(winPct<0.5)base+=15;
    if(winPct>=0.65)base-=15;
    if(winPct>=0.75)base-=25;
    var mood=team.ownerMood||70;
    if(mood<40)base+=20;
    else if(mood<55)base+=10;
    if(mood>80)base-=10;
    if(role==="OC"){
      var ppg=(team.pf||0)/gp;
      if(ppg<14)base+=15;else if(ppg<17)base+=8;
      if(ppg>28)base-=10;
    }else if(role==="DC"){
      var oppPpg=(team.pa||0)/gp;
      if(oppPpg>28)base+=15;else if(oppPpg>24)base+=8;
      if(oppPpg<17)base-=10;
    }
    var streak=team.streak||0;
    if(streak<=-3)base+=Math.abs(streak)*5;
    if(streak>=3)base-=streak*3;
    return cl(Math.round(base),0,100);
  },
  shouldFire:function(temp){return temp>=85;},
  getLabel:function(temp){
    if(temp>=85)return{label:"SCORCHING",color:"#ef4444",emoji:"ðŸ”¥ðŸ”¥ðŸ”¥"};
    if(temp>=65)return{label:"HOT",color:"#f97316",emoji:"ðŸ”¥ðŸ”¥"};
    if(temp>=45)return{label:"WARM",color:"#eab308",emoji:"ðŸ”¥"};
    if(temp>=25)return{label:"COOL",color:"#22d3ee",emoji:"â„ï¸"};
    return{label:"ICE COLD",color:"#10b981",emoji:"ðŸ§Š"};
  }
};
var HOLDOUT_NEGOTIATION={
  start:function(player){
    if(!player)return null;
    var baseDemand=Math.round(Math.max(((player.ovr||50)-55)*0.5,2)*10)/10;// Base salary demand
    var agentStyle=pick(["shark","patient","emotional","reasonable"]);
    var agentNames=["Jerry Mega","Scott Bossing","Drew Rosenkrantz","Todd Franconia","Leigh Steinburg","Tom Conedon"];
    return{
      playerId:player.id,playerName:player.name,playerPos:player.pos,playerOvr:player.ovr,
      agentName:pick(agentNames),agentStyle:agentStyle,
      round:1,maxRounds:3,
      demand:baseDemand,currentOffer:0,
      resolved:false,result:null,
      history:[]
    };
  },
  respond:function(negotiation,offerAmount){
    if(!negotiation||negotiation.resolved)return negotiation;
    var n=assign({},negotiation);
    n.currentOffer=offerAmount;
    var gap=n.demand-offerAmount;
    var gapPct=gap/n.demand;
    n.history.push({round:n.round,offer:offerAmount,demand:n.demand});
    var accepted=false;
    if(n.agentStyle==="reasonable"){
      if(gapPct<=0.15)accepted=true;
      else n.demand=Math.round((n.demand-gap*0.3)*10)/10;
    }else if(n.agentStyle==="shark"){
      if(gapPct<=0.05)accepted=true;
      else{n.demand=Math.round((n.demand-gap*0.1)*10)/10;if(n.round>=2)n.demand=Math.round((n.demand+0.5)*10)/10;}
    }else if(n.agentStyle==="patient"){
      if(gapPct<=0.1)accepted=true;
      else n.demand=Math.round((n.demand-gap*0.2)*10)/10;
    }else{// emotional
      if(gapPct<=0.2)accepted=true;
      else if(RNG.ai()<0.3){n.demand=Math.round((n.demand+1)*10)/10;}// Gets offended
      else{n.demand=Math.round((n.demand-gap*0.25)*10)/10;}
    }
    n.round++;
    if(accepted){n.resolved=true;n.result="accepted";n.finalSalary=offerAmount;}
    else if(n.round>n.maxRounds){n.resolved=true;n.result="failed";}
    return n;
  },
  getStyleDesc:function(style){
    if(style==="shark")return"Aggressive negotiator â€” expects top dollar, may raise demands.";
    if(style==="patient")return"Measured approach â€” willing to meet halfway.";
    if(style==="emotional")return"Unpredictable â€” can be swayed but also offended easily.";
    return"Fair and professional â€” looking for a reasonable deal.";
  }
};
var AI_ROSTER_MOVES={
  types:[
    {id:"ir",label:"placed on IR",emoji:"ðŸ¥",chance:0.08},
    {id:"callup",label:"called up from practice squad",emoji:"ðŸ“‹",chance:0.06},
    {id:"waiver",label:"claimed off waivers",emoji:"ðŸ“",chance:0.05},
    {id:"cut",label:"released",emoji:"âœ‚ï¸",chance:0.07},
    {id:"emergency",label:"signed emergency FA",emoji:"ðŸ†˜",chance:0.04},
    {id:"extension",label:"signed to extension",emoji:"âœï¸",chance:0.03}
  ],
  generateWeekly:function(teams,myId,week){
    var moves=[];
    teams.forEach(function(t){
      if(t.id===myId)return;// Skip user team
      AI_ROSTER_MOVES.types.forEach(function(moveType){
        if(RNG.ai()<moveType.chance){
          var target=null;
          if(moveType.id==="ir"){
            target=t.roster.filter(function(p){return p.injury&&p.injury.games>=3;});
            target=target.length>0?target[Math.floor(RNG.ai()*target.length)]:null;
          }else if(moveType.id==="cut"){
            target=t.roster.filter(function(p){return (p.ovr||50)<62&&!p.isStarter;});
            target=target.length>0?target[Math.floor(RNG.ai()*target.length)]:null;
          }else if(moveType.id==="extension"){
            target=t.roster.filter(function(p){return (p.ovr||50)>=78&&p.contract&&p.contract.years<=1;});
            target=target.length>0?target[Math.floor(RNG.ai()*target.length)]:null;
          }else{
            target=t.roster.length>0?t.roster[Math.floor(RNG.ai()*t.roster.length)]:null;
          }
          if(target){
            moves.push({
              team:t.abbr,icon:t.icon,
              player:target.name,pos:target.pos,ovr:target.ovr,
              moveType:moveType.id,label:moveType.label,emoji:moveType.emoji,
              text:t.icon+t.abbr+" "+moveType.label+" "+target.name+" ("+target.pos+" "+target.ovr+")",
              week:week
            });
          }
        }
      });
    });
    return moves.slice(0,4);// Max 4 moves per week
  }
};
var GAME_PLAN_OPTIONS={
  offense:[
    {id:"air_raid",label:"ðŸŽ¯ Air Raid",desc:"Attack through the air â€” max passing yards",bonus:{passMod:3,rushMod:-1},counter:"zone_shell"},
    {id:"ground_pound",label:"ðŸƒ Ground & Pound",desc:"Establish the run â€” wear down the defense",bonus:{rushMod:3,passMod:-1},counter:"stack_box"},
    {id:"balanced",label:"âš–ï¸ Balanced Attack",desc:"No tendency â€” keep the defense guessing",bonus:{passMod:1,rushMod:1},counter:null},
    {id:"play_action",label:"ðŸŽ­ Play Action Heavy",desc:"Use the run threat to open deep shots",bonus:{passMod:2,rushMod:1,playAction:true},counter:"blitz_heavy"}
  ],
  defense:[
    {id:"zone_shell",label:"ðŸ›¡ï¸ Zone Shell",desc:"Drop into coverage â€” take away the deep ball",bonus:{coverageMod:3,rushDefMod:-1},beats:"air_raid"},
    {id:"stack_box",label:"ðŸ§± Stack the Box",desc:"Load the box â€” shut down the run",bonus:{rushDefMod:3,coverageMod:-2},beats:"ground_pound"},
    {id:"blitz_heavy",label:"ðŸ’¥ Blitz Heavy",desc:"Send pressure â€” disrupt the QB",bonus:{pressMod:4,coverageMod:-3},beats:"play_action"},
    {id:"bend_dont_break",label:"ðŸ”’ Bend Don't Break",desc:"Play conservative â€” force long drives",bonus:{coverageMod:1,rushDefMod:1,redZoneMod:3},beats:null}
  ],
  getBonus:function(userOff,userDef,oppSchemeOff,oppSchemeDef){
    var bonus=0;
    var offPlan=GAME_PLAN_OPTIONS.offense.find(function(o){return o.id===userOff;});
    var defPlan=GAME_PLAN_OPTIONS.defense.find(function(d){return d.id===userDef;});
    if(defPlan&&defPlan.beats&&defPlan.beats===oppSchemeOff)bonus+=3;
    if(offPlan&&offPlan.counter){
      var oppDef=GAME_PLAN_OPTIONS.defense.find(function(d){return d.id===offPlan.counter;});
      if(oppDef&&oppSchemeDef===offPlan.counter)bonus-=2;
    }
    if(offPlan)bonus+=(offPlan.bonus.passMod||0)*0.3+(offPlan.bonus.rushMod||0)*0.3;
    if(defPlan)bonus+=(defPlan.bonus.coverageMod||0)*0.2+(defPlan.bonus.rushDefMod||0)*0.2;
    return cl(Math.round(bonus*10)/10,-5,8);
  }
};
var POWER_RANKINGS_SHOW={
  generate:function(teams,week,myId){
    if(!teams||teams.length===0||week<2)return null;
    var ranked=teams.slice().sort(function(a,b){
      var aw=(a.wins||0),bw=(b.wins||0);
      if(aw!==bw)return bw-aw;
      return((b.pf||0)-(b.pa||0))-((a.pf||0)-(a.pa||0));
    });
    var blurbs=[
      "Looking DOMINANT. Nobody wants to face this team right now.",
      "Quietly building a juggernaut. Watch out come playoff time.",
      "Solid all around. No weaknesses, but no splash plays either.",
      "Riding a wave of momentum. The question is: can they sustain it?",
      "Inconsistent but talented. A wildcard in the playoff picture.",
      "Trending downward. Needs a statement win to right the ship.",
      "Stuck in the middle. Not bad enough to tank, not good enough to contend.",
      "The rebuild is real. Young players are developing nicely.",
      "Injuries have derailed what looked like a promising season.",
      "Going nowhere fast. Time to sell at the deadline.",
      "Making noise! This team is for real.",
      "Under the radar but dangerous. A sleeper for sure.",
      "The defense is elite but the offense can't keep up.",
      "All offense, no defense. Living and dying by the scoreboard.",
      "Coaching is the difference. Getting the most out of limited talent.",
      "Free-falling. Where does it end?",
      "Surprise contender! Nobody saw this coming.",
      "Battle-tested and playoff-ready.",
      "The schedule has been kind. Real tests are coming.",
      "Needs help at the deadline. One move away from contention."
    ];
    var hotTakes=[
      "is the team to beat this year!",
      "could go all the way if healthy.",
      "is a paper tiger â€” don't buy the hype.",
      "has the best roster in football.",
      "will be a first-round exit.",
      "is one trade away from a dynasty.",
      "should blow it up and rebuild.",
      "has the best coach in the league.",
      "is wasting elite talent.",
      "will shock everyone in the playoffs."
    ];
    return ranked.map(function(t,i){
      var prevRank=t._prevRank||i+1;
      var trend=prevRank>i+1?"up":prevRank<i+1?"down":"same";
      var trendIcon=trend==="up"?"ðŸ“ˆ":trend==="down"?"ðŸ“‰":"âž¡ï¸";
      var trendDelta=Math.abs(prevRank-(i+1));
      var gp=Math.max(1,(t.wins||0)+(t.losses||0));
      var isUser=t.id===myId;
      return{
        rank:i+1,prevRank:prevRank,team:t.abbr,icon:t.icon,
        wins:t.wins||0,losses:t.losses||0,
        trend:trend,trendIcon:trendIcon,trendDelta:trendDelta,
        blurb:blurbs[i%blurbs.length],
        hotTake:i<5?t.icon+t.abbr+" "+hotTakes[Math.floor(RNG.ui()*hotTakes.length)]:null,
        isUser:isUser,streak:t.streak||0,
        ppg:Math.round((t.pf||0)/gp*10)/10,
        oppPpg:Math.round((t.pa||0)/gp*10)/10
      };
    });
  }
};

// â”€â”€ MISTRAL v99.2: MFSN_CONTENT_991 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var MFSN_CONTENT_991={
  openingLines:[
    "ðŸŽ™ï¸ MFSN: Welcome to the most anticipated matchup of the week!",
    "ðŸ“¡ We are LIVE as the teams take the field! This one promises to be a classic.",
    "ðŸŽ¤ MFSN is in the building! The energy in this stadium is absolutely electric.",
    "ðŸ“º Good evening and welcome to MFSN prime time football â€” we have a game for you tonight.",
    "ðŸŽ™ï¸ MFSN: The teams are out for warmups and the buzz inside this venue is something special.",
    "ðŸ“¡ Tonight's matchup has all the makings of an instant classic. MFSN has you covered.",
    "ðŸŽ¤ The lights are on, the crowd is in, and MFSN is ready. Let's play football.",
    "ðŸ“º This is the game every analyst has been talking about all week. Now we settle it.",
    "ðŸŽ™ï¸ MFSN: We've seen highlights, we've read the matchup data â€” tonight we get the truth.",
    "ðŸ“¡ Championship implications could be written in the outcome of this game. Let's find out.",
    "ðŸŽ¤ Two teams. One winner. MFSN brings you every play of what should be a memorable night.",
    "ðŸ“º The pregame show is in the books. It's time for football. MFSN goes live.",
    "ðŸŽ™ï¸ MFSN: This is what fall weekends were made for. Football. Live. Right now.",
    "ðŸ“¡ The coin toss is complete. Kickoff is moments away. MFSN coverage begins.",
    "ðŸŽ¤ Forty-five thousand fans on their feet. MFSN in your living room. Let's get it started."
  ],
  powerRankingsIntro:[
    "ðŸ† MFSN Power Rankings: Every week we reassess â€” every week the board gets shaken.",
    "ðŸ“Š The MFSN Analytics Desk has processed the numbers. Here's where everyone stands.",
    "ðŸ”¢ Power Rankings Tuesday â€” where reputations are built and bubble teams get burst.",
    "ðŸ“ˆ The rankings are in and the debate has already started in the war room.",
    "ðŸ† MFSN Power Rankings Presented by the numbers: who rose, who fell, who held steady.",
    "ðŸ“Š Every performance rewrites the narrative. This week's rankings reflect that.",
    "ðŸ”¢ The polls are closed. The votes are tallied. MFSN reveals the hierarchy.",
    "ðŸ“ˆ New week, new rankings â€” the chase for the top spot never stops on MFSN.",
    "ðŸ† After a wild week of results, the MFSN Power Rankings have been recalibrated.",
    "ðŸ“Š The Power Rankings â€” half science, half art. Presented for your approval."
  ],
  hotTakeLines:[
    "ðŸ”¥ MFSN Hot Take: Their offensive line is the reason they keep winning â€” not the skill players.",
    "ðŸ’¥ Unpopular opinion from the MFSN desk: that loss might be the best thing that happened to them.",
    "ðŸ”¥ The analytics say one thing. The eye test says another. Both might be right.",
    "ðŸ’¥ MFSN Take: They're being wildly underseeded and this is going to matter in January.",
    "ðŸ”¥ Hot take incoming: their backup is more ready than anyone in this building will admit.",
    "ðŸ’¥ The injury is devastating, yes â€” but this team is better positioned to absorb it than people think.",
    "ðŸ”¥ MFSN Analyst: The defense has been the story all season and nobody's talking about them.",
    "ðŸ’¥ Controversial but defensible: they should be starting the rookie right now.",
    "ðŸ”¥ The trade rumors are a distraction. This roster, properly deployed, can win a title.",
    "ðŸ’¥ Mark this day: they just had the best game of the season and finished on the wrong side.",
    "ðŸ”¥ MFSN calls it: the next two weeks define whether this team is real or a mirage.",
    "ðŸ’¥ The coaching staff gets too much credit on wins and too much blame on losses. The players decide games."
  ],
  rivalryWatch:[
    "âš”ï¸ MFSN Rivalry Watch: Bad blood has been building all week. The locker room is ready.",
    "ðŸ”¥ When these two teams meet, regular season records become irrelevant. It's personal.",
    "âš”ï¸ The rivalry game has its own rules. History matters. Pride matters. Scoreboard matters.",
    "ðŸ”¥ MFSN has tracked every game in this series. The lead has changed hands multiple times.",
    "âš”ï¸ Rivalry week is unlike any other week. Preparation is different. Emotion is different.",
    "ðŸ”¥ Both coaching staffs spent extra time on motivation this week. The players don't need it.",
    "âš”ï¸ The trash talk started on Monday. By game time it's usually something beautiful.",
    "ðŸ”¥ MFSN Rivalry Index: elevated. These teams genuinely dislike each other and play like it.",
    "âš”ï¸ When rivals meet, the form book goes out the window. Expect the unexpected tonight.",
    "ðŸ”¥ The series history adds weight to every play. These players know what this game means."
  ],
  injuryReport:[
    "ðŸš‘ MFSN Injury Update: The team listed him as questionable and he will test it during warmups.",
    "âš ï¸ Late breaking: the injury is more significant than the team initially let on.",
    "ðŸš‘ The injury report came in and the implications for tonight's game are significant.",
    "âš ï¸ MFSN Source: the backup has been working first-team reps all week. Draw your own conclusions.",
    "ðŸš‘ The player is officially out â€” next man up and the depth chart gets a real test.",
    "âš ï¸ Questionable means questionable. He'll make a game-time decision with the training staff.",
    "ðŸš‘ The loss of that player changes the game plan. Both teams adjust accordingly.",
    "âš ï¸ MFSN Injury Tracker: two starters downgraded within the last hour. Big news."
  ],
  closingLines:[
    "ðŸŽ™ï¸ MFSN: That's the final gun and WHAT a game that was. We'll see you next week.",
    "ðŸ“¡ The scoreboard doesn't lie. One team earned this and the other has work to do.",
    "ðŸŽ¤ From the MFSN team â€” another game for the books. Talk about it all week.",
    "ðŸ“º A performance that will be remembered. MFSN signs off on a memorable night.",
    "ðŸŽ™ï¸ MFSN Final: the team executed when it mattered. They'll hear about this one for a while.",
    "ðŸ“¡ Post-game analysis is coming but first â€” let this result breathe for a moment.",
    "ðŸŽ¤ That's football. From MFSN, goodnight and great game.",
    "ðŸ“º MFSN thanks the teams, the players, the coaches, and the fans. See you next week.",
    "ðŸŽ™ï¸ On behalf of the entire MFSN broadcast team â€” what a night. What a sport.",
    "ðŸ“¡ The final whistle sounds. The recap starts now. What a game, what a night on MFSN."
  ]
};

// â”€â”€ COACH_PERSONALITIES_991 (Mistral + Claude complete) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var COACH_PERSONALITIES_991={
  grinder:{
    label:"Grinder",icon:"âš™ï¸",
    afterWin:["We executed the game plan. That's what we do.",
              "The preparation showed today. We put in the work.",
              "This win belongs to the players who grinded all week.",
              "Good win. Reset. Prepare for next week.",
              "We did our jobs. Film review in the morning."],
    afterLoss:["We'll review the film and fix what we got wrong.",
               "No excuses. We didn't execute well enough. That's on us.",
               "The work ethic doesn't change after a loss. We prepare harder.",
               "We lost today. We'll learn from it and come back stronger.",
               "Accountability starts with me. We'll correct this."],
    beforeBigGame:["This week is no different than any other week. Prepare. Execute.",
                   "Big game atmosphere doesn't change our approach. Trust the process.",
                   "We've put in the work. Now we go prove it on the field.",
                   "The players are ready. The preparation has been excellent.",
                   "Block out the noise. Execute the game plan. That's all that matters."]
  },
  professor:{
    label:"The Professor",icon:"ðŸ“",
    afterWin:["The scheme created advantages and the players exploited them perfectly.",
              "Our analytical preparation paid dividends in key third-down situations.",
              "The matchup data we identified held up. Excellent execution of the game plan.",
              "We knew their tendencies and made the right adjustments at halftime.",
              "The numbers projected a win probability north of 72%. We proved the model right."],
    afterLoss:["The data identified issues but we failed to execute the adjustments.",
               "We need to revisit our third-down conversion model. The numbers weren't working.",
               "The opponent made adjustments we hadn't accounted for. We learn and adapt.",
               "The analytics gave us a competitive gameplan. The execution let us down.",
               "We'll break down the film, identify the variance, and improve the system."],
    beforeBigGame:["The data gives us clear advantages we intend to exploit.",
                   "We've run 400 scenarios through our simulation model. We know what to expect.",
                   "Our preparation has been methodical and thorough. The players are ready.",
                   "The analytical edge we've built this week should show up on the field.",
                   "Every decision Sunday will be backed by data and sound preparation."]
  },
  hothead:{
    label:"The Hothead",icon:"ðŸ”¥",
    afterWin:["THAT IS WHAT I AM TALKING ABOUT! That's how you PLAY football!",
              "We came, we saw, we DOMINATED! Nobody believed in us â€” nobody! WE DID!",
              "I told these guys all week â€” NOBODY is beating us when we play like THAT!",
              "FIRE! That's what I feel right now! Pure FIRE! These players gave everything!",
              "That's our identity! Physical! Aggressive! Relentless! THAT IS WHO WE ARE!"],
    afterLoss:["That performance was UNACCEPTABLE! Completely unacceptable!",
               "I am not going to stand here and pretend that was okay because it was NOT okay!",
               "We let each other down today and I will not allow that to continue!",
               "THAT ends NOW. Film review. Hard practice. No excuses from this point forward.",
               "I'm furious. The players know I'm furious. Change happens or people move on."],
    beforeBigGame:["This is our MOMENT! Every day we worked for THIS! LET'S GO GET IT!",
                   "I want to see FIRE in your eyes on Sunday! Bring it! BRING IT ALL!",
                   "They think they know us. They have NO idea what's coming for them!",
                   "This is the game. This right here. Give me EVERYTHING you have!",
                   "Nobody in this building sleeps easy until we WIN this game. LET'S GO!"]
  },
  zen:{
    label:"Zen Master",icon:"â˜®ï¸",
    afterWin:["The team found their flow today. Beautiful football when we play together.",
              "When each player trusts the system, great things happen. Today was a reminder.",
              "Gratitude for the effort. The result was a natural consequence of the process.",
              "The players were present in every moment. That presence created the victory.",
              "Football at its best is a shared meditation. Today we meditated together."],
    afterLoss:["Every loss teaches more than a win. We will sit with this and learn.",
               "The outcome does not define us. Our response to it will.",
               "We release this result and focus on the growth it provides.",
               "Equanimity in victory and defeat. We process this and move forward with clarity.",
               "The scoreboard is temporary. What we learn from today is permanent."],
    beforeBigGame:["Be present. Trust your preparation. Let the game come to you.",
                   "The biggest game is always the next one. Approach it with the same calm.",
                   "There is no pressure when you are fully prepared and fully present.",
                   "Breathe. Trust. Execute. The game is won in the quiet moments.",
                   "The noise outside doesn't reach inside this room. Focus. Be here."]
  },
  visionary:{
    label:"The Visionary",icon:"ðŸ”­",
    afterWin:["This is just the beginning. What you saw today is chapter one of a much bigger story.",
              "We're building something here that this city hasn't seen in a generation.",
              "The win matters â€” but the WAY we won matters more. The system is working.",
              "I told this group in training camp: trust the vision. Today you saw it.",
              "Five years from now, people will look back at this game as when it all started."],
    afterLoss:["Setbacks are part of any great story. This isn't the end â€” it's the inflection point.",
               "The vision doesn't change based on one result. We stay the course.",
               "I've seen where this is going. Today was a bump in a very long road.",
               "Great things are built through adversity. We will be better for this.",
               "The blueprint is sound. The execution needs time. We keep building."],
    beforeBigGame:["This is the game where we show the world what we've been building.",
                   "I have seen this team at its best. Sunday is about revealing that to everyone.",
                   "Trust the vision. Trust each other. Trust what we've built together.",
                   "The future belongs to those who prepare for it. We have prepared.",
                   "This is our statement game. The league is about to understand who we are."]
  },
  firestarter:{
    label:"The Firestarter",icon:"ðŸŽ¯",
    afterWin:["We brought the heat and nobody could handle it. That's the identity. THAT'S US.",
              "I challenge my guys every week and they answer every single time. Proud of this group.",
              "We didn't come to participate. We came to ignite. And we set this place on fire.",
              "When we play angry, disciplined, and together â€” nobody can stop us. Remember that.",
              "The fire was burning before kickoff. The fire is burning after. It never goes out."],
    afterLoss:["I lit the fire this week. We didn't bring it to the game. That falls on me.",
               "We let the flame die today. That doesn't happen again. I guarantee it.",
               "This loss should sting. Let it sting. Let it fuel the fire for next week.",
               "I'm not turning down the heat because we lost. I'm turning it up.",
               "The opponent sparked something in us today. Watch what happens next week."],
    beforeBigGame:["I need you playing with a CHIP. The world is sleeping on us. WAKE THEM UP.",
                   "Strike first. Strike hard. Set the tone in the first five minutes.",
                   "I want controlled rage on that field. Passionate, physical, precise.",
                   "They haven't seen us at full throttle. Sunday they will.",
                   "We play with an edge. We play with fire. We play for each other. LET'S GO."]
  }
};

// â”€â”€ RIVALRY_TRASH_991 (Mistral) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var RIVALRY_TRASH_991={
  mild:["We respect them. That respect ends at kickoff.",
        "Good team. Not good enough.",
        "They'll prepare well. So will we. May the better team win.",
        "Nothing personal. We just need the W.",
        "They're a good rival. We intend to end their streak.",
        "The series is close. We're going to tip it our way.",
        "We know them. They know us. Still going to be a long day for them.",
        "Both teams earned this. One team deserves it more right now.",
        "They've beaten us before. Today is a different story.",
        "Respect in the offseason. Competition between the lines."],
  spicy:["They talk about culture. We are the culture.",
         "They have the reputation. We have the results.",
         "Our motivation is the fact that they need us for a rivalry â€” we don't need them.",
         "Every time they schedule us they know what's coming. They schedule it anyway.",
         "They can celebrate moral victories. We celebrate actual ones.",
         "Their fans travel well. They're going to see us win up close.",
         "The last three games in this series have gone our way for a reason.",
         "They built their identity on beating us. It hasn't been working lately.",
         "We circle this game. They circle this game. The difference is what we do about it.",
         "They've been talking all week. We'll let Sunday do the talking."],
  atomic:["We are coming for everything they have built. Every single piece of it.",
          "They can celebrate the series history. We're writing a new chapter and they won't like it.",
          "That locker room over there has underestimated us for the last time. LAST TIME.",
          "This isn't a game to us. This is a statement. A declaration. A reckoning.",
          "They wore our jerseys as a disrespect in warmups. They will not make that mistake again.",
          "We don't just want to beat them. We want to end the conversation permanently.",
          "That fanbase lives to mock us. Their silence Sunday will be the loudest sound we've ever heard.",
          "The blood between these teams is real. The hate is earned. And we are ready to settle it.",
          "They've had this rivalry in their back pocket for years. Today we take it back.",
          "Some teams play for rankings. Some for records. We are playing for REVENGE."]
};
// â”€â”€ END MISTRAL v99.2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

var MFSN_WEEKLY975={
  anchors:[
    {name:"Marcus Cole",icon:"ðŸŽ™ï¸",style:"bombastic",catchphrase:"THAT'S A FRANCHISE-ALTERING MOMENT!"},
    {name:"Diana Chen",icon:"ðŸ“Š",style:"analytical",catchphrase:"The numbers don't lie, people."},
    {name:"Big Trev",icon:"ðŸˆ",style:"folksy",catchphrase:"That's old-school football right there."}
  ],
  segments:["HEADLINE","YOUR_TEAM","POWER_RANKINGS","STORYLINES","HOT_SEAT","PRESS_CONFERENCE"],
  buildShow:function(teams,myId,week,gameResult,arcSpots,powerRanks,storylineEvents,season){
    var my=(teams||[]).find(function(t){return t.id===myId;});
    if(!my||week<1)return null;
    var anchor=MFSN_WEEKLY975.anchors[week%MFSN_WEEKLY975.anchors.length];
    // v99.2: Pick opening line from MFSN_CONTENT_991 if available
    var openL=MFSN_CONTENT_991&&MFSN_CONTENT_991.openingLines;
    var showOpener=openL&&openL.length?openL[week%openL.length]:null;
    var show={week:week,year:season&&season.year?season.year:null,anchor:anchor,segments:[],generated:true,opener:showOpener};
    var sorted=(teams||[]).slice().sort(function(a,b){
      var aw=a&&a.wins||0,bw=b&&b.wins||0;
      if(bw!==aw)return bw-aw;
      return ((b.pf||0)-(b.pa||0))-((a.pf||0)-(a.pa||0));
    });
    var headlines975=[];
    if(sorted[0])headlines975.push(sorted[0].icon+sorted[0].abbr+" leads the league at "+(sorted[0].wins||0)+"-"+(sorted[0].losses||0));
    if(sorted.length>1){
      var bottomTeam=sorted[sorted.length-1];
      if(bottomTeam&&sorted[0]&&bottomTeam.id!==sorted[0].id){
        headlines975.push(bottomTeam.icon+bottomTeam.abbr+" trying to climb out of "+(bottomTeam.wins||0)+"-"+(bottomTeam.losses||0));
      }
    }
    if(powerRanks&&powerRanks.length>0){
      var prTop=powerRanks[0];
      if(prTop)headlines975.push("Power Rankings: #1 "+prTop.icon+prTop.team+" ("+prTop.wins+"-"+prTop.losses+")");
      var topMover=(powerRanks.slice().sort(function(a,b){return (b.trendDelta||0)-(a.trendDelta||0);})[0]||null);
      if(topMover&&(topMover.trendDelta||0)>=2&&topMover.trend!=="same"){
        headlines975.push((topMover.trend==="up"?"ðŸ“ˆ":"ðŸ“‰")+" "+topMover.icon+topMover.team+" moves "+(topMover.trend==="up"?"up":"down")+" "+topMover.trendDelta+" spots");
      }
    }
    if(storylineEvents&&storylineEvents.headlines&&storylineEvents.headlines.length){
      storylineEvents.headlines.slice(0,2).forEach(function(h){
        if(typeof h==="string"&&headlines975.length<6)headlines975.push(h);
      });
    }
    if(headlines975.length===0)headlines975.push("Around the league: another wild week in pro football.");
    show.segments.push({type:"HEADLINE",title:"ðŸ“° TOP STORIES",items:headlines975.slice(0,6)});
    if(gameResult&&gameResult.result){
      var won=gameResult.isHome?(gameResult.result.home>gameResult.result.away):(gameResult.result.away>gameResult.result.home);
      var userScore=gameResult.isHome?gameResult.result.home:gameResult.result.away;
      var oppScore=gameResult.isHome?gameResult.result.away:gameResult.result.home;
      var streak=my.streak||0;
      var streakText=streak>=3?"ðŸ”¥ "+streak+"-game win streak!":streak<=-3?"â„ï¸ "+Math.abs(streak)+"-game losing streak.":"";
      var anchorReaction="";
      if(won){
        anchorReaction=anchor.style==="bombastic"?anchor.catchphrase:
          anchor.style==="analytical"?"Exactly what the analytics predicted.":
          "They just play good, clean football.";
      }else{
        anchorReaction=anchor.style==="bombastic"?"WHAT ARE WE DOING OUT THERE?!":
          anchor.style==="analytical"?"The underlying metrics tell a concerning story.":
          "That's a tough one to swallow.";
      }
      show.segments.push({
        type:"YOUR_TEAM",
        title:"ðŸˆ "+(my.icon||"")+my.abbr+" RECAP",
        result:(won?"W":"L")+" "+userScore+"-"+oppScore+" vs "+(gameResult.oppAbbr||"???"),
        record:(my.wins||0)+"-"+(my.losses||0),
        streak:streakText,
        won:won,
        anchorTake:anchorReaction
      });
    }else{
      show.segments.push({
        type:"YOUR_TEAM",
        title:"ðŸˆ "+(my.icon||"")+my.abbr+" RECAP",
        result:"BYE WEEK",
        record:(my.wins||0)+"-"+(my.losses||0),
        streak:"",
        won:null,
        anchorTake:"A week to heal up, self-scout, and get ready for the stretch run."
      });
    }
    if(powerRanks&&powerRanks.length>0){
      var myRank=powerRanks.find(function(r){return r&&((r.isUser)||r.team===my.abbr);})||null;
      var topMovers=powerRanks.filter(function(r){return r&&(r.trendDelta||0)>=2;})
        .sort(function(a,b){return (b.trendDelta||0)-(a.trendDelta||0);}).slice(0,3);
      show.segments.push({
        type:"POWER_RANKINGS",
        title:"ðŸ“Š POWER RANKINGS",
        myRank:myRank?myRank.rank:null,
        myTrend:myRank?myRank.trend:null,
        myTrendIcon:myRank?myRank.trendIcon:null,
        myBlurb:myRank?myRank.blurb:null,
        topMovers:topMovers
      });
    }
    if(arcSpots&&arcSpots.length>0){
      show.segments.push({
        type:"STORYLINES",
        title:"ðŸŒŸ PLAYER STORYLINES",
        items:arcSpots.slice(0,3).map(function(s){
          return{
            name:s.name||s.playerName||"Player",
            badge:s.badge||s.arcKey||"ðŸŒŸ",
            badgeColor:s.badgeColor||T.gold,
            text:s.text||s.line||"",
            pos:s.pos||""
          };
        })
      });
    }
    if((my.ownerMood||70)<50){
      var mood=my.ownerMood||70;
      show.segments.push({
        type:"HOT_SEAT",
        title:"ðŸª‘ HOT SEAT WATCH",
        data:{
          mood:mood,
          text:mood<30?"ðŸ”¥ The owner is FUMING. Changes could be imminent.":
            mood<40?"âš ï¸ Ownership patience is wearing thin.":
            "ðŸ‘€ The front office is watching closely."
        }
      });
    }
    var pressQ=MFSN_WEEKLY975.generatePressQuestion(my,week,gameResult,season);
    if(pressQ)show.segments.push({type:"PRESS_CONFERENCE",title:"ðŸŽ¤ PRESS CONFERENCE",data:pressQ});
    return show;
  },
  generatePressQuestion:function(team,week,gameResult,season){
    if(!team)return null;
    var questions=[];
    var won=!!(gameResult&&gameResult.result&&(gameResult.isHome?(gameResult.result.home>gameResult.result.away):(gameResult.result.away>gameResult.result.home)));
    if(gameResult&&won&&(team.streak||0)>=3){
      questions.push({
        q:"You're on a "+team.streak+"-game win streak. Is this team for real?",
        opts:[
          {text:"We're building something special here.",effect:{morale:3,chemistry:2,ownerMood:2}},
          {text:"One game at a time. We haven't accomplished anything yet.",effect:{morale:1,chemistry:1}},
          {text:"The league better take notice.",effect:{morale:5,ownerMood:3,chemistry:-1}}
        ]
      });
    }
    if(gameResult&&!won&&((team.losses||0)>=((team.wins||0)+3))){
      questions.push({
        q:"This season is slipping away. What's your message to the locker room?",
        opts:[
          {text:"We're going to fight for every game left.",effect:{morale:3,chemistry:2}},
          {text:"It's time for everyone to look in the mirror.",effect:{morale:-2,chemistry:1,ownerMood:1}},
          {text:"I take full responsibility. The players aren't the issue.",effect:{morale:5,chemistry:3,ownerMood:-2}}
        ]
      });
    }
    if(gameResult&&!won){
      questions.push({
        q:"Tough loss today. Where does the team go from here?",
        opts:[
          {text:"We'll fix it in practice. This group is resilient.",effect:{morale:2,chemistry:1}},
          {text:"I need to be better. It starts with me.",effect:{morale:3,ownerMood:-1}},
          {text:"Next question.",effect:{morale:-1,ownerMood:2}}
        ]
      });
    }
    if(gameResult&&won){
      questions.push({
        q:"Great win today. What stood out to you?",
        opts:[
          {text:"The preparation this week was outstanding.",effect:{morale:2,chemistry:1}},
          {text:"We made plays when it mattered. That's what winners do.",effect:{morale:3}},
          {text:"I'll have to watch the film. We still have things to clean up.",effect:{morale:1,ownerMood:1}}
        ]
      });
    }
    if(week>=10&&(team.wins||0)>=7){
      questions.push({
        q:"The playoffs are within reach. Are you managing expectations?",
        opts:[
          {text:"We expect to be there. This roster is built for January.",effect:{morale:3,ownerMood:2}},
          {text:"Control what we can control. Win the next game.",effect:{morale:2,chemistry:1}},
          {text:"We're not looking ahead. That's how you get beat.",effect:{morale:1,chemistry:2}}
        ]
      });
    }
    if(week>=8&&week<=10){
      questions.push({
        q:"The trade deadline is approaching. Are you a buyer or a seller?",
        opts:[
          {text:"We're always looking to improve this roster.",effect:{morale:1,ownerMood:1}},
          {text:"We like what we have. Our guys earned their spots.",effect:{morale:3,chemistry:2}},
          {text:"I'm not going to tip my hand to other GMs.",effect:{ownerMood:1}}
        ]
      });
    }
    if(!gameResult){
      questions.push({
        q:"Bye week this week. What was the focus behind closed doors?",
        opts:[
          {text:"Recovery and fundamentals. Fresh legs matter in November.",effect:{morale:2,chemistry:1}},
          {text:"Self-scouting. We found a few tendencies we need to break.",effect:{ownerMood:1,chemistry:1}},
          {text:"We challenged the room. Complacency kills seasons.",effect:{morale:-1,ownerMood:2,chemistry:2}}
        ]
      });
    }
    if(questions.length===0){
      questions.push({
        q:"What's your message to the fanbase right now?",
        opts:[
          {text:"Stay with us. This team's best football is ahead.",effect:{morale:2,ownerMood:1}},
          {text:"We're building the right way and the results will come.",effect:{chemistry:2,ownerMood:1}},
          {text:"Judge us in January.",effect:{ownerMood:2,morale:1}}
        ]
      });
    }
    return questions[Math.floor(RNG.ui()*questions.length)]||null;
  }
};
var ADVANCED_ANALYTICS={
  calcEPA:function(p,teamWins,teamGames){
    if(!p||!p.stats)return 0;
    var cs=p.stats;var pos=p.pos;
    if(pos==="QB")return Math.round(((cs.passYds||0)*0.04+(cs.passTD||0)*4-(cs.int||0)*3+(cs.rushYds||0)*0.08)*10)/10;
    if(pos==="RB")return Math.round(((cs.rushYds||0)*0.08+(cs.rushTD||0)*5-(cs.fumbles||0)*3+(cs.recYds||0)*0.06)*10)/10;
    if(pos==="WR"||pos==="TE")return Math.round(((cs.recYds||0)*0.07+(cs.recTD||0)*5+(cs.rec||0)*0.5)*10)/10;
    if(pos==="DL"||pos==="LB")return Math.round(((cs.sacks||0)*5+(cs.tackles||0)*0.5+(cs.defINT||0)*6-(cs.missedTkl||0)*2)*10)/10;
    if(pos==="CB"||pos==="S")return Math.round(((cs.defINT||0)*7+(cs.tackles||0)*0.4+(cs.passDefl||0)*2)*10)/10;
    if(pos==="K")return Math.round(((cs.fgM||0)*3-((cs.fgA||0)-(cs.fgM||0))*2+(cs.xpM||0)*0.5)*10)/10;
    return 0;
  },
  calcDVOA:function(team){
    if(!team)return{off:0,def:0,total:0};
    var gp=Math.max(1,(team.wins||0)+(team.losses||0));
    var ppg=(team.pf||0)/gp;var oppPpg=(team.pa||0)/gp;
    var offEff=Math.round((ppg-21)*3.5);// 21 ppg = league average baseline
    var defEff=Math.round((21-oppPpg)*3.5);
    return{off:cl(offEff,-50,50),def:cl(defEff,-50,50),total:cl(offEff+defEff,-80,80)};
  },
  calcTargetShare:function(player,teammates){
    if(!player||!player.stats)return 0;
    var myTgt=(player.stats.targets||player.stats.rec||0);
    var totalTgt=0;
    (teammates||[]).forEach(function(t){
      if(t.pos==="WR"||t.pos==="TE"||t.pos==="RB")totalTgt+=(t.stats?t.stats.targets||t.stats.rec||0:0);
    });
    if(totalTgt===0)return 0;
    return Math.round(myTgt/totalTgt*1000)/10;
  },
  findInefficiencies:function(fas){
    if(!fas||fas.length===0)return[];
    var gems=[];
    fas.forEach(function(p){
      var sal=p.contract?p.contract.salary:MIN_SALARY;
      var expectedSal=Math.max(MIN_SALARY,((p.ovr||50)-55)*0.6);
      if((p.ovr||50)>=72&&sal<expectedSal*0.7){
        gems.push({player:p,value:Math.round((expectedSal-sal)*10)/10,label:"ðŸ’Ž "+p.name+" ("+p.pos+" "+p.ovr+" OVR) â€” Worth $"+expectedSal.toFixed(1)+"M, available at $"+sal.toFixed(1)+"M"});
      }
    });
    gems.sort(function(a,b){return b.value-a.value;});
    return gems.slice(0,5);
  },
  winProb:function(scoreDiff,quarter){
    var q=Math.min(4,Math.max(1,quarter||4));
    var leverage=1+(q-1)*0.6;// Later quarters = more decisive
    var prob=1/(1+Math.exp(-scoreDiff*0.15*leverage));
    return Math.round(prob*1000)/10;
  }
};
// â”€â”€ FEATURE 2: PLAYER STORY ARC ENGINE (STORY_ARC) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var NARRATIVE_STATES={
  BREAKOUT:"breakout",ELITE:"elite",SLUMP:"slump",COMEBACK:"comeback",
  DECLINE:"decline",HOLDOUT:"holdout",REDEMPTION:"redemption",MENTOR:"mentor",SWAN_SONG:"swan_song"
};
var STORY_ARC_EVENTS={
  breakout:[
    {w:3,headline:"{name} is EMERGING as a franchise cornerstone",ovrMod:2,moraleMod:10,color:"#34d399"},
    {w:2,headline:"League taking notice of {name}'s breakout campaign",ovrMod:1,moraleMod:8,color:"#34d399"},
    {w:1,headline:"{name} â€” young star making noise in a big way",ovrMod:1,moraleMod:6,color:"#34d399"}
  ],
  elite:[
    {w:3,headline:"{name} cementing All-Pro status â€” elite performance continues",ovrMod:0,moraleMod:6,color:"#fbbf24"},
    {w:2,headline:"Critics agree: {name} is the best {pos} in the league",ovrMod:0,moraleMod:8,color:"#fbbf24"},
    {w:1,headline:"{name} carrying this franchise on their back",ovrMod:0,moraleMod:5,color:"#fbbf24"}
  ],
  slump:[
    {w:3,headline:"{name} struggling â€” benching rumors surface",ovrMod:-2,moraleMod:-12,color:"#ef4444"},
    {w:2,headline:"What's wrong with {name}? Media asks questions",ovrMod:-1,moraleMod:-8,color:"#ef4444"},
    {w:1,headline:"{name}'s rough stretch draws attention from league observers",ovrMod:-1,moraleMod:-6,color:"#f59e0b"}
  ],
  comeback:[
    {w:3,headline:"{name} silences doubters with dominant performance",ovrMod:3,moraleMod:15,color:"#60a5fa"},
    {w:2,headline:"Redemption arc: {name} back and better than ever",ovrMod:2,moraleMod:10,color:"#60a5fa"},
    {w:1,headline:"{name} proving the critics wrong, one play at a time",ovrMod:1,moraleMod:8,color:"#60a5fa"}
  ],
  decline:[
    {w:2,headline:"Father Time catching up with {name}? Production slipping",ovrMod:-1,moraleMod:-6,color:"#94a3b8"},
    {w:1,headline:"{name} showing his age â€” but the veteran still competes",ovrMod:0,moraleMod:-4,color:"#94a3b8"}
  ],
  holdout:[
    {w:2,headline:"{name}'s agent: 'My client deserves top-of-market money'",ovrMod:0,moraleMod:-8,color:"#f59e0b"},
    {w:1,headline:"{name} holdout entering week two â€” talks stalled",ovrMod:0,moraleMod:-10,color:"#ef4444"}
  ],
  redemption:[
    {w:3,headline:"{name} answering every critic â€” redemption season is real",ovrMod:2,moraleMod:12,color:"#a78bfa"},
    {w:2,headline:"{name} on a mission to prove the doubters wrong",ovrMod:1,moraleMod:8,color:"#a78bfa"}
  ],
  mentor:[
    {w:2,headline:"Veteran {name} quietly developing the next generation",ovrMod:0,moraleMod:10,color:"#22d3ee"},
    {w:1,headline:"{name}'s locker room leadership drawing praise from coaching staff",ovrMod:0,moraleMod:8,color:"#22d3ee"}
  ],
  swan_song:[
    {w:2,headline:"Could this be {name}'s final season? 'I'm giving everything I have'",ovrMod:0,moraleMod:20,color:"#fbbf24"},
    {w:1,headline:"{name} playing with the fire of a man who has nothing left to prove",ovrMod:0,moraleMod:15,color:"#fbbf24"}
  ]
};
function pickWeightedEvent(events){
  if(!events||!events.length)return null;
  var total=events.reduce(function(s,e){return s+(e.w||1);},0);
  var r=RNG.play()*total;
  for(var i=0;i<events.length;i++){r-=(events[i].w||1);if(r<=0)return events[i];}
  return events[0];
}
// v99.4 â€” Claude: Comeback & Redemption Arc System
var COMEBACK_994 = {
  injuryReturn: {
    QB: [
      "He's back under center. The stadium holds its breath.",
      "The franchise hasn't felt complete since the injury. Right now, it does.",
      "[PLAYER] takes the snap and the whole building exhales at once.",
      "Eleven months of film study, rehab, and patience. [PLAYER] is back.",
      "The team hasn't been the same since he went down. Watch what happens now.",
      "He didn't just recover â€” he came back looking like he had a point to prove.",
      "The offense has a different energy tonight. [PLAYER] is under center. That's why.",
      "You can hear it in the crowd the second he walks out. They've been waiting for this."
    ],
    RB: [
      "Torn ACL. Eleven months. This carry. Right now.",
      "[PLAYER] takes the handoff and cuts upfield and the crowd ERUPTS. He's back.",
      "The hardest thing in football is what [PLAYER] just did â€” come back from that.",
      "Every step of that rehab was for one moment. [PLAYER] just had it.",
      "He didn't lose the burst. You were worried he lost the burst. He didn't.",
      "That first hit he took? He bounced right up. That told you everything.",
      "They said the injury might change him. [PLAYER] says they were wrong.",
      "The running back position breaks bodies. [PLAYER] refused to stay broken."
    ],
    WR: [
      "[PLAYER] runs the first route of the game like he never left. Crisp. Clean. Back.",
      "The routes were always there. The trust between him and the QB â€” that too.",
      "First catch back. You could see the relief wash over the entire offense.",
      "[PLAYER] doesn't ease back in. Full speed, first snap. That's who he is.",
      "The timing was always going to come back. It just needed time. Tonight it's back.",
      "He ran a post route on the opening drive and it looked exactly like it used to. Perfect.",
      "The receiver position requires precision. [PLAYER] never lost his. Just had to find it again.",
      "Back in the lineup. Back in the offense. Back. [PLAYER] is fully, completely back."
    ],
    DL: [
      "[PLAYER] has been watching from the sideline for months. He is very, very angry about that.",
      "The first sack back. [PLAYER] stands over the quarterback and stares. No celebration needed.",
      "He missed a quarter of the season. He is here to collect interest on everything he missed.",
      "Four months of film study and fury. [PLAYER] channeled all of it on that one rep.",
      "The offensive tackle across from him had a long, unpleasant evening. [PLAYER] is back.",
      "You don't come back from that injury meaner. [PLAYER] is the exception.",
      "He said he'd be back better. Three plays in, the offense across the line believes him.",
      "Rehab gave [PLAYER] two things: a healthy knee and a score to settle."
    ]
  },
  slumpToBaller: [
    "Nobody believed in him. He believed in himself. That was enough.",
    "Four weeks of quiet. One week of the best football of his career. [PLAYER] is back.",
    "You write a player off at your own risk. [PLAYER] just handed in the essay.",
    "The film looked bad. The coaches stayed patient. The patience paid off.",
    "He was one more bad game from losing his job. Instead he's playing the best football on the roster.",
    "The slump is over. Emphatically, spectacularly over.",
    "Whatever [PLAYER] fixed in his game â€” it worked. Everything is working right now.",
    "Critics had the funeral planned. [PLAYER] didn't RSVP.",
    "There's a version of this story where he never recovers. This is the other version.",
    "Back to back dominant games and suddenly nobody remembers the slump.",
    "He put the work in when the results weren't there. The results are here now.",
    "Patience from the coaching staff. Trust in the process. A player rediscovered.",
    "The slump had a last day. It was last week. This is what comes after.",
    "You could feel the confidence returning. It shows up in every rep.",
    "[PLAYER] looks like himself again. Actually, he looks better than himself."
  ],
  lateCareerRenaissance: [
    "Father Time got a rematch. [PLAYER] won again.",
    "Age is supposed to slow a player down. Nobody told [PLAYER].",
    "This is his best season. He is 33 years old. Figure that out.",
    "The body cooperated. The mind was always there. [PLAYER] is having the season of his career.",
    "Whatever he found in the offseason, he should bottle it and sell it.",
    "The league was ready to move on. [PLAYER] was not ready to let it.",
    "His teammates are playing with urgency. Their leader is playing with brilliance.",
    "At his age, most players are managing careers. [PLAYER] is expanding his.",
    "The late-career renaissance is real. The numbers say so. The eye test confirms it.",
    "One more year. One more run. One more reminder that he belongs.",
    "He has earned every yard, every snap, every standing ovation. This is the reward.",
    "They said it couldn't last. [PLAYER] keeps making them say it for another year."
  ],
  redemptionAfterDrama: [
    "The contract saga is over. The football answers everything that was said.",
    "[PLAYER] let his play do the talking. It talked loudly.",
    "The front office moved on. So did [PLAYER] â€” directly into a career resurgence.",
    "He said everything he needed to say between the lines. Actions only.",
    "The drama was loud. This performance is louder.",
    "[TEAM] believed in him when others questioned the investment. Tonight, that belief is vindicated.",
    "Redemption doesn't arrive with a speech. It arrives like this â€” one dominant performance at a time.",
    "The holdout cost weeks. This comeback is costing opponents yards and points.",
    "He came back and proved the skeptics wrong and the believers right. In that order.",
    "Quiet professionalism after a loud offseason. That's the redemption arc.",
    "The team needed [PLAYER] to come back and be [PLAYER]. He is.",
    "Forgiveness isn't given â€” it's earned. He's been earning it since training camp."
  ],
  suspensionReturn: [
    "The league gave him another chance. He knows exactly what to do with it.",
    "He didn't waste the time away. He worked. It shows.",
    "Back on the field. No fanfare requested. Just football.",
    "The suspension is over. The talent was never suspended.",
    "Whatever he needed to figure out â€” he figured it out. The evidence is on tape.",
    "He served his time. He served it the right way. Now he's back, and it's football only.",
    "Cautious optimism from the coaching staff. Cautious dominance from [PLAYER]. It's a start.",
    "He understood the stakes coming back. He plays like he understands them.",
    "The organization stood by him. He's standing up for the organization.",
    "First game back. Every rep deliberate. Every rep earned. This is a new chapter."
  ],
  triumphOverTrade: [
    "[PLAYER] circled this date the day the trade went through.",
    "He has been preparing for this game since before the season started.",
    "Every rep in practice since the trade was pointed at this moment.",
    "His old team is on the other sideline. He has their tendencies memorized.",
    "The reception when [PLAYER] touched the ball was complicated. The football was not.",
    "He doesn't need motivation tonight. He brought his own.",
    "Former teammates. Former coaches. Former home. [PLAYER] plays it like a business trip.",
    "They traded him. He is now making them explain that decision.",
    "There are no bad emotions tonight â€” just football. He's winning the football.",
    "The scoreboard is [PLAYER]'s response to everything that happened last offseason."
  ]
};


var STORY_ARC_ENGINE={
  normalizePlayer:function(p){
    if(!p||!p.id)return p;
    if(p._arcState===undefined)p._arcState=null;
    if(typeof p._arcState!=="string"&&p._arcState!==null)p._arcState=null;
    if(typeof p._arcTurns!=="number"||!isFinite(p._arcTurns)||p._arcTurns<0)p._arcTurns=0;
    return p;
  },
  initPlayer:function(p){
    STORY_ARC_ENGINE.normalizePlayer(p);
    if(p._arcState===null){
      p._arcState=p.age<=24&&p.ovr>=72?NARRATIVE_STATES.BREAKOUT:p.age>=35?NARRATIVE_STATES.SWAN_SONG:p.age>=32?NARRATIVE_STATES.MENTOR:p.ovr>=85?NARRATIVE_STATES.ELITE:null;
      p._arcTurns=0;
    }
    return p;
  },
  getTargetState:function(p,teamWins,teamLosses,wk){
    var recentBad=(p.stats&&(p.stats.gp||0)>0&&p.pos==="QB"&&(p.stats.int||0)/(p.stats.gp||1)>1.5);
    var recentGood=(p.stats&&(p.stats.gp||0)>0&&p.pos==="QB"&&(p.stats.passTD||0)/(p.stats.gp||1)>2.5);
    var isHoldout=p.holdout75||false;
    if(isHoldout)return NARRATIVE_STATES.HOLDOUT;
    if(p.age>=37&&p.ovr>=70)return NARRATIVE_STATES.SWAN_SONG;
    if(p.age>=32&&p.ovr>=75)return NARRATIVE_STATES.MENTOR;
    if(p._arcState===NARRATIVE_STATES.SLUMP&&recentGood)return NARRATIVE_STATES.COMEBACK;
    if(p._arcState===NARRATIVE_STATES.COMEBACK&&p.ovr>=80)return NARRATIVE_STATES.ELITE;
    if(p.age>=(({QB:29,RB:27,WR:28,TE:28,OL:30,DL:28,LB:28,CB:27,S:28})[p.pos]||28)&&p.ovr<75)return NARRATIVE_STATES.DECLINE;
    if(recentBad&&wk>4)return NARRATIVE_STATES.SLUMP;
    if(p.age<=24&&p.ovr>=74)return NARRATIVE_STATES.BREAKOUT;
    if(p.ovr>=87)return NARRATIVE_STATES.ELITE;
    if(p._arcState===NARRATIVE_STATES.SLUMP||p._arcState===NARRATIVE_STATES.HOLDOUT)return NARRATIVE_STATES.REDEMPTION;
    return p._arcState;
  },
  tickPlayer:function(p,teamWins,teamLosses,wk,addNFn){
    if(!p||!p.id)return p;
    STORY_ARC_ENGINE.initPlayer(p);
    p._arcTurns=(p._arcTurns||0)+1;
    var minDwell=4+Math.floor(RNG.play()*5);
    if(p._arcTurns<minDwell)return p;
    var newState=STORY_ARC_ENGINE.getTargetState(p,teamWins,teamLosses,wk);
    if(!newState||newState===p._arcState)return p;
    p._arcState=newState;p._arcTurns=0;
    var events=STORY_ARC_EVENTS[newState];if(!events)return p;
    var evt=pickWeightedEvent(events);if(!evt)return p;
    var headline=evt.headline.replace(/{name}/g,p.name).replace(/{pos}/g,p.pos);
    if(evt.ovrMod&&evt.ovrMod!==0)p.ovr=Math.max(40,Math.min(99,p.ovr+evt.ovrMod));
    if(evt.moraleMod)p.morale=Math.max(30,Math.min(99,(p.morale||70)+evt.moraleMod));
    if(addNFn)addNFn("ðŸ“° "+headline,newState===NARRATIVE_STATES.SLUMP||newState===NARRATIVE_STATES.DECLINE?"red":newState===NARRATIVE_STATES.ELITE||newState===NARRATIVE_STATES.BREAKOUT?"gold":"cyan");
    return p;
  },
  tickTeam:function(roster,wins,losses,wk,addNFn){
    if(!roster)return roster;
    roster.forEach(function(p){
      STORY_ARC_ENGINE.normalizePlayer(p);
      if(p.isStarter&&p.ovr>=70&&RNG.play()<0.08){
        STORY_ARC_ENGINE.tickPlayer(p,wins,losses,wk,addNFn);
      }
    });
    return roster;
  }
};
// â”€â”€ END STORY_ARC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â”€â”€ FEATURE 8: MFSN BROADCAST MODE (BROADCAST) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var MFSN_BROADCAST={
  pbpTemplates:{
    pass_complete:[
      {w:3,t:"{QB} steps up and finds {WR} over the middle â€” {YDS} yards!"},
      {w:2,t:"{QB} with time... threading the needle to {WR} for {YDS}!"},
      {w:2,t:"Quick slant to {WR}, {YDS} yards â€” first down!"},
      {w:1,t:"{QB} launches it deep â€” {WR} hauls it in! {YDS} yards!"},
      {w:1,t:"Pump fake, then {QB} finds {WR} in stride â€” {YDS} yards!"}
    ],
    pass_td:[
      {w:3,t:"{QB} FIRES to the corner â€” {WR} IS IN! TOUCHDOWN!"},
      {w:2,t:"Back of the end zone â€” {WR} toe drags it! SIX POINTS!"},
      {w:2,t:"{QB} rolls right, lofts it â€” {WR} takes it in! TOUCHDOWN!"},
      {w:1,t:"Bullet from {QB}! {WR} through traffic â€” SCORE!"}
    ],
    rush_gain:[
      {w:3,t:"{RB} hits the gap â€” {YDS} yards on the carry!"},
      {w:2,t:"{RB} breaks a tackle! {YDS} yards downfield!"},
      {w:1,t:"Strong run by {RB} â€” {YDS} yards, moving the chains!"}
    ],
    rush_td:[
      {w:2,t:"{RB} POWERS through! TOUCHDOWN â€” what a run!"},
      {w:1,t:"{RB} spins, breaks free â€” INTO THE END ZONE! SIX!"}
    ],
    sack:[
      {w:2,t:"{PASS_RUSHER} bulls through â€” SACK on {QB}! Loss of {YDS} yards!"},
      {w:2,t:"Pressure! {PASS_RUSHER} gets home â€” sack, {QB} goes down!"},
      {w:1,t:"{PASS_RUSHER} with a MONSTER sack â€” {QB} never saw him coming!"}
    ],
    interception:[
      {w:1,t:"{QB} forces it â€” PICKED OFF by {DB}! What a read!"},
      {w:1,t:"INTERCEPTION! {DB} reads {QB} perfectly â€” turnover!"}
    ],
    field_goal:[
      {w:2,t:"Kick is GOOD! Three points on the board!"},
      {w:1,t:"{K} with the boot â€” right down the middle! It's GOOD!"}
    ]
  },
  pickTemplate:function(templates){
    var total=templates.reduce(function(s,t){return s+(t.w||1);},0);
    var r=RNG.ui()*total;
    for(var i=0;i<templates.length;i++){r-=(templates[i].w||1);if(r<=0)return templates[i].t;}
    return templates[0].t;
  },
  fill:function(tmpl,data){
    return tmpl
      .replace("{QB}",data.qb||"the QB")
      .replace("{WR}",data.receiver||"the receiver")
      .replace("{RB}",data.rusher||"the runner")
      .replace("{PASS_RUSHER}",data.passRusher||"the pass rusher")
      .replace("{DB}",data.db||"the defender")
      .replace("{K}",data.kicker||"the kicker")
      .replace("{YDS}",String(Math.abs(data.yards||7)));
  },
  generateHighlights:function(result,hTeam,aTeam,isUserHome){
    var plays=[];
    var uRec=result&&result.recap?result.recap[isUserHome?"home":"away"]:null;
    var oRec=result&&result.recap?result.recap[isUserHome?"away":"home"]:null;
    var userT=isUserHome?hTeam:aTeam;var oppT2=isUserHome?aTeam:hTeam;
    function starter(roster,pos){return(roster&&roster.filter(function(p){return p.pos===pos&&p.isStarter;})[0])||{name:pos};}
    var qb=starter(userT&&userT.roster,"QB");var wr=starter(userT&&userT.roster,"WR");
    var rb=starter(userT&&userT.roster,"RB");var dl=starter(oppT2&&oppT2.roster,"DL");
    var cb=starter(userT&&userT.roster,"CB");var k=starter(userT&&userT.roster,"K");
    var d={qb:qb.name,receiver:wr.name,rusher:rb.name,passRusher:dl.name,db:cb.name,kicker:k.name};
    var passYds=(uRec&&uRec.passYds)||0;var rushYds=(uRec&&uRec.rushYds)||0;
    var tds=((uRec&&uRec.passTD)||0)+((uRec&&uRec.rushTD)||0);
    var sacks=(oRec&&oRec.sacks)||0;var defINTs=(uRec&&uRec.defINT)||0;
    if(passYds>150)plays.push({icon:"âœˆï¸",text:MFSN_BROADCAST.fill(MFSN_BROADCAST.pickTemplate(MFSN_BROADCAST.pbpTemplates.pass_complete),assign({},d,{yards:Math.round(passYds/Math.max(1,14))}))});
    if(rushYds>60)plays.push({icon:"ðŸƒ",text:MFSN_BROADCAST.fill(MFSN_BROADCAST.pickTemplate(MFSN_BROADCAST.pbpTemplates.rush_gain),assign({},d,{yards:Math.round(rushYds/Math.max(1,18))}))});
    if(tds>0)plays.push({icon:"ðŸˆ",text:MFSN_BROADCAST.fill(MFSN_BROADCAST.pickTemplate(RNG.ui()<0.6?MFSN_BROADCAST.pbpTemplates.pass_td:MFSN_BROADCAST.pbpTemplates.rush_td),d)});
    if(sacks>0)plays.push({icon:"ðŸ’¥",text:MFSN_BROADCAST.fill(MFSN_BROADCAST.pickTemplate(MFSN_BROADCAST.pbpTemplates.sack),assign({},d,{yards:7}))});
    if(defINTs>0)plays.push({icon:"ðŸ¦…",text:MFSN_BROADCAST.fill(MFSN_BROADCAST.pickTemplate(MFSN_BROADCAST.pbpTemplates.interception),d)});
    if(plays.length<2)plays.push({icon:"âš¡",text:qb.name+" and the offense put together a workmanlike performance."});
    return plays;
  },
  halftimeScript:function(userScore,oppScore,userTeam,oppTeam){
    var margin=userScore-oppScore;
    if(margin>14)return userTeam.abbr+" is in COMPLETE control at the half â€” up "+margin+". The offense is clicking on all cylinders.";
    if(margin>7)return "Leads "+userScore+"-"+oppScore+" at the break. Solid first half for "+userTeam.abbr+". Defense setting the tone.";
    if(margin>0)return "A "+margin+"-point edge at halftime. Tight game â€” second half will decide it all.";
    if(margin===0)return "All tied at "+userScore+" apiece at the half. Everything to play for. Adjustments will be key.";
    if(margin>-8)return "Down "+Math.abs(margin)+" at halftime. Time for a gut check from "+userTeam.abbr+". Adjustments needed.";
    return "Down "+Math.abs(margin)+" at the half â€” "+userTeam.abbr+" facing an uphill battle. 30 minutes to rewrite the story.";
  },
  postgameOpener:function(userScore,oppScore,userTeam,oppTeam,week){
    var won=userScore>oppScore;var margin=Math.abs(userScore-oppScore);
    var suffix=margin>=21?" â€” dominant from start to finish":margin>=14?" â€” a convincing victory":margin<=3?" â€” survived a nail-biter":margin<=7?" â€” held on for the win":"";
    if(won)return "FINAL: "+userTeam.abbr+" defeats "+oppTeam.abbr+" "+userScore+"-"+oppScore+suffix+". Week "+week+" belongs to "+userTeam.city+".";
    return "FINAL: "+oppTeam.abbr+" hands "+userTeam.abbr+" a "+oppScore+"-"+userScore+" loss"+suffix+". A tough one for "+userTeam.city+" to digest.";
  },
  analystTake:function(won,recap){
    var tos=recap?((recap.ints||0)+(recap.fumbles||0)):0;
    var passYds=recap?recap.passYds||0:0;
    if(won&&passYds>280)return "\"That passing game was surgical today. If they keep that up, this team goes deep in the playoffs.\"";
    if(won&&tos===0)return "\"Zero turnovers. You take care of the football, you win football games. Simple as that.\"";
    if(!won&&tos>=2)return "\""+tos+" turnovers is just too many. You cannot win in this league giving the ball away.\"";
    if(!won&&passYds<150)return "\"The passing game sputtered all day. They need to figure that out â€” and fast.\"";
    if(won)return "\"Credit to the coaching staff. They made the right adjustments at halftime. That separates good teams from great ones.\"";
    return "\"Back to the drawing board. Tough loss, but there's film to study and a week to get right.\"";
  }
};
// â”€â”€ END BROADCAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var SCOUT_NETWORK={
  regions:[
    {id:"sec",name:"SEC",icon:"ðŸˆ",desc:"Elite athletes, pro-ready talent",posBias:["RB","LB","DL"],quality:1.1},
    {id:"big10",name:"Big Ten",icon:"ðŸŒ½",desc:"Physical, fundamentally sound",posBias:["OL","LB","RB"],quality:1.05},
    {id:"big12",name:"Big 12",icon:"ðŸ¤ ",desc:"High-flying offenses, gunslingers",posBias:["QB","WR","CB"],quality:1.0},
    {id:"acc",name:"ACC",icon:"ðŸŒ²",desc:"Skill position factory",posBias:["QB","WR","TE"],quality:1.0},
    {id:"pac12",name:"Pac-12",icon:"ðŸŒŠ",desc:"Speed and versatility",posBias:["WR","CB","S"],quality:0.95},
    {id:"other",name:"Small School",icon:"ðŸ’Ž",desc:"Hidden gems, raw upside",posBias:["TE","DL","K"],quality:0.85}
  ],
  maxScouts:3,// v78: Max regions you can scout per draft
  scoutRegion:function(regionId,draftClass){
    if(!draftClass)return[];
    var region=null;
    SCOUT_NETWORK.regions.forEach(function(r){if(r.id===regionId)region=r;});
    if(!region)return[];
    var scouted=[];
    draftClass.forEach(function(p){
      var pRegion=p._scoutRegion78||"other";
      if(pRegion===regionId){
        p._scouted78=true;if(p._scoutConfidence&&budget81){var alloc81=budget81[regionId]||1;p._scoutConfidence=Math.min(100,Math.round(p._scoutConfidence*(1+alloc81*0.08)));}
        p._scoutGrade78=p.pot>=80?"A+":p.pot>=72?"A":p.pot>=65?"B+":p.pot>=58?"B":p.pot>=50?"C":"D";
        p._scoutNotes78=region.posBias.indexOf(p.pos)>=0?"Elite program for "+p.pos+"s â€” pro-ready":"Solid prospect, may need development";
        scouted.push(p);
      }
    });
    return scouted;
  },
  assignRegions:function(draftClass){
    if(!draftClass)return;
    var regionIds=SCOUT_NETWORK.regions.map(function(r){return r.id;});
    draftClass.forEach(function(p){
      if(!p._scoutRegion78){
        if((p.ovr||50)>=78&&RNG.draft()<0.3)p._scoutRegion78="sec";
        else if((p.ovr||50)>=75&&RNG.draft()<0.25)p._scoutRegion78="big10";
        else p._scoutRegion78=regionIds[Math.floor(RNG.draft()*regionIds.length)];
      }
    });
  }
};
var PRIMETIME_SCHEDULING={
  slots:[
    {id:"snf",name:"Sunday Night Football",icon:"ðŸŒ™",abbr:"SNF",xpBonus:1.15,injuryMod:1.1,color:"#3b82f6"},
    {id:"mnf",name:"Monday Night Football",icon:"ðŸˆ",abbr:"MNF",xpBonus:1.2,injuryMod:1.08,color:"#10b981"},
    {id:"tnf",name:"Thursday Night Football",icon:"âš¡",abbr:"TNF",xpBonus:1.1,injuryMod:1.15,color:"#f59e0b"}
  ],
  calcWorthiness:function(team){
    if(!team)return 0;
    var winPct=(team.wins||0)/Math.max(1,(team.wins||0)+(team.losses||0));
    var marketSize=team.market||50;
    var starPower=0;
    (team.roster||[]).forEach(function(p){if((p.ovr||50)>=85)starPower+=5;if(p.devTrait==="superstar")starPower+=3;});
    return Math.round(winPct*40+marketSize*0.3+Math.min(starPower,25));
  },
  assignPrimetime:function(weekGames,teams,myId){
    if(!weekGames||weekGames.length===0)return weekGames;
    var scored=weekGames.map(function(g,i){
      var hTeam=null;var aTeam=null;
      teams.forEach(function(t){if(t.id===g.home)hTeam=t;if(t.id===g.away)aTeam=t;});
      var worth=PRIMETIME_SCHEDULING.calcWorthiness(hTeam)+PRIMETIME_SCHEDULING.calcWorthiness(aTeam);
      var hasUser=(g.home===myId||g.away===myId);
      if(hasUser)worth+=15;// Bias toward user games
      return{idx:i,worth:worth,hasUser:hasUser};
    });
    scored.sort(function(a,b){return b.worth-a.worth;});
    var slotIdx=0;
    scored.forEach(function(s){
      if(slotIdx<3&&slotIdx<PRIMETIME_SCHEDULING.slots.length){
        weekGames[s.idx]._primetime78=PRIMETIME_SCHEDULING.slots[slotIdx];
        slotIdx++;
      }
    });
    return weekGames;
  }
};
var REHAB_SYSTEM={
  options:[
    {id:"aggressive",label:"Aggressive",icon:"ðŸ”¥",desc:"50% faster recovery, 25% re-injury risk",speedMod:0.5,reinjuryChance:0.25,color:"#ef4444"},
    {id:"conservative",label:"Conservative",icon:"ðŸ›¡ï¸",desc:"25% slower recovery, very safe",speedMod:1.25,reinjuryChance:0.03,color:"#3b82f6"},
    {id:"experimental",label:"Experimental",icon:"ðŸ§ª",desc:"Wild card â€” could heal instantly or extend injury",speedMod:1.0,reinjuryChance:0.10,color:"#a855f7"}
  ],
  applyRehab:function(player,optionId){
    if(!player||!player.injury)return null;
    var opt=null;
    REHAB_SYSTEM.options.forEach(function(o){if(o.id===optionId)opt=o;});
    if(!opt)return null;
    player.injury._rehab78=optionId;
    if(optionId==="experimental"){
      var roll=RNG.injury();
      if(roll<0.3){setPlayerInjury92(player,player.injury.type||"Injury",1);return{outcome:"miracle",text:player.name+" responds amazingly to experimental treatment! Back next week!"};}
      else if(roll<0.5){setPlayerInjury92(player,player.injury.type||"Injury",(player.injury.games||0)+2);return{outcome:"setback",text:player.name+"'s experimental treatment backfired â€” 2 extra weeks added."};}
      else{return{outcome:"normal",text:player.name+" undergoing experimental treatment â€” monitoring closely."};}
    }else{
      var orig=player.injury.games;
      setPlayerInjury92(player,player.injury.type||"Injury",Math.max(1,Math.round(orig*opt.speedMod)));
      return{outcome:optionId,text:player.name+" on "+opt.label.toLowerCase()+" rehab â€” "+player.injury.games+" weeks remaining."};
    }
  },
  checkReinjury:function(player){
    if(!player||!player.injury)return false;
    var rehab=player.injury._rehab78;
    if(!rehab)return false;
    var opt=null;
    REHAB_SYSTEM.options.forEach(function(o){if(o.id===rehab)opt=o;});
    if(!opt)return false;
    return RNG.injury()<opt.reinjuryChance;
  }
};
var FO_FIRST_NAMES=["Mike","Dan","Sarah","Chris","Pat","Alex","Jordan","Casey","Morgan","Taylor",
  "Marcus","Keisha","Darius","Elena","Tommy","Priya","Lamar","Gwen","Vic","Nadia","Hank",
  "Simone","Reggie","Becca","Omar","Trish","DeShawn","Lucia","Colt","Vera","Zach","Imani",
  "Robbie","Faye","Luther","Mia","Calvin","Sasha","Terrence","Brooke","Gus","Yuki","Fletcher",
  "Nina","Scotty","Rhea","Wendell","Cleo","Brandon","Tina"];
var FO_LAST_NAMES=["Reynolds","Nakamura","O'Brien","Kowalski","Chen","Williams","Thompson","Garcia",
  "Patel","Kim","Torres","Jackson","Okafor","Marchetti","Lundqvist","Hassan","Delacroix","Brennan",
  "Vasquez","Okonkwo","Hartley","Rosenberg","Papadopoulos","Sutherland","Ferreira","Owens","Nguyen",
  "MacPherson","Abebe","Fitzgerald","Reyes","Yamamoto","Holloway","Petrov","Adeyemi","Castellano",
  "Higgins","Park","Dubois","McLaughlin","Amara","Johansson","Washington","O'Sullivan","Diallo",
  "Bergman","Adkins","Romero","Nakashima","Calloway"];
var FO_TRAITS={
  analytical:{label:"Analytical",icon:"ðŸ“ˆ",desc:"Data-first decisions â€” finds edge cases AI misses"},
  old_school:{label:"Old School",icon:"ðŸ“¼",desc:"Trusts the eye test â€” great at reading character"},
  aggressive:{label:"Aggressive",icon:"ðŸ”¥",desc:"Swings for blockbuster deals, high upside/variance"},
  conservative:{label:"Conservative",icon:"ðŸ›¡ï¸",desc:"Avoids busts, steady hand under cap pressure"},
  innovative:{label:"Innovative",icon:"ðŸ’¡",desc:"Ahead of the curve â€” spots market inefficiencies"},
  moneyball:{label:"Moneyball",icon:"ðŸ’°",desc:"Extracts value from undervalued players"},
  film_guru:{label:"Film Guru",icon:"ðŸŽ¬",desc:"Watches every snap â€” deep player tendencies knowledge"},
  connector:{label:"Connector",icon:"ðŸ¤",desc:"Players love them â€” boosts morale and retention"},
  negotiator:{label:"Negotiator",icon:"ðŸ“",desc:"Gets deals done â€” squeezes value in every contract"},
  developer:{label:"Developer",icon:"ðŸŒ±",desc:"Player development whisperer â€” POT players blossom"},
  grinder:{label:"Grinder",icon:"âš™ï¸",desc:"Outworks everyone â€” weekly scouting is always thorough"},
  visionary:{label:"Visionary",icon:"ðŸ”­",desc:"Builds dynasties â€” long-term roster architecture"},
  risk_taker:{label:"Risk Taker",icon:"ðŸŽ²",desc:"High-upside hires â€” boom or bust roster moves"},
  loyalist:{label:"Loyalist",icon:"ðŸ›ï¸",desc:"Builds team culture â€” reduces staff poaching"},
  numbers_wizard:{label:"Numbers Wizard",icon:"ðŸ”¢",desc:"Cap genius â€” finds space others can't see"}
};
var FO_BACKSTORIES={
  gm:["Former college GM who rebuilt 3 programs","Rose from intern to front office in 6 seasons",
    "Ex-agent who crossed to the team side","Salary cap specialist poached from a rival GM",
    "Former player rep who learned the business inside out","Division I AD transitioning to pro football"],
  scout_dir:["Spent 20 years scouting the SEC before this role","Former college coach who went full-time scouting",
    "Ran the combine testing operation for 8 years","Built his reputation finding undrafted gems",
    "International scout who re-tooled for the US market","Deep Midwest roots â€” knows every small-school sleeper"],
  analytics:["MIT stats grad with a football obsession","Came from NBA analytics and translated the model",
    "Self-taught coder who built his own scouting database","Former Vegas oddsmaker who moved to football ops",
    "Led the league in expected points modeling for 2 years","Started as an intern, stayed for the data"],
  cap_analyst:["CPA who discovered football pays better","Structured 3 championship rosters under the cap",
    "Known for the restructure that saved a dynasty team","Young gun â€” already two championship cap designs",
    "Survived two CBA negotiations as team rep","Former players association economist who switched to team ops"],
  personnel:["Played 4 years in the league â€” knows what teams need","Cross-sport background in basketball ops",
    "High school coach turned eval specialist","Spent a decade in UDFA evaluation","Built roster that made it to the title game twice",
    "Covers every position group with equal depth"],
  player_relations:["Players call him first when things go wrong","Former chaplain who transitioned to team ops",
    "Built the most cohesive locker room in recent memory","Agent-turned-advocate for the player side",
    "Specializes in keeping stars happy on mid-tier deals","Known for defusing locker room situations quickly"],
  medstaff:["Sports medicine PhD with 15 years pro football experience","Pioneered load management protocols",
    "Reduced IR stints by 30% at his last stop","Developed a return-to-play model now used league-wide",
    "Former Olympic sports scientist who moved to football","Built a recovery program that extended careers"]
};
var FRONT_OFFICE={
  roles:[
    {id:"gm",title:"Asst. General Manager",icon:"ðŸ‘”",affects:["trades","cap","drafting","negotiation"],salaryRange:[3,10],
      desc:"Handles trade negotiations, cap logistics, and draft-day decisions on your behalf.",
      color:"#a78bfa",tier:"core"},
    {id:"scout_dir",title:"Scouting Director",icon:"ðŸ”",affects:["drafting","evaluation"],salaryRange:[1.5,5],
      desc:"Sharpens your draft intel â€” tighter prospect OVR estimates and fewer busts.",
      color:"#22d3ee",tier:"core"},
    {id:"analytics",title:"Analytics Coordinator",icon:"ðŸ“Š",affects:["gameplan","evaluation"],salaryRange:[1,4],
      desc:"Turns film and data into gameplanning edges and scouting accuracy boosts.",
      color:"#4ade80",tier:"core"},
    {id:"cap_analyst",title:"Cap Analyst",icon:"ðŸ’°",affects:["cap","restructure","extension"],salaryRange:[1,3.5],
      desc:"Finds hidden cap space, models extensions, and prevents dead-money disasters.",
      color:"#fbbf24",tier:"specialist"},
    {id:"personnel",title:"Player Personnel Dir.",icon:"ðŸˆ",affects:["drafting","waivers","trades"],salaryRange:[1.5,4],
      desc:"Runs UDFA claims, waiver wire strategy, and depth chart evaluation.",
      color:"#f97316",tier:"specialist"},
    {id:"player_relations",title:"Player Relations Mgr.",icon:"ðŸ¤",affects:["morale","holdouts","chemistry"],salaryRange:[0.8,2.5],
      desc:"Keeps the locker room calm â€” reduces holdouts and chemistry crashes.",
      color:"#ec4899",tier:"specialist"},
    {id:"medstaff",title:"Medical Director",icon:"ðŸ¥",affects:["injuries","recovery","durability"],salaryRange:[1,3],
      desc:"Reduces injury frequency and shortens recovery timelines for your roster.",
      color:"#6ee7b7",tier:"specialist"}
  ],
  generateStaff:function(roleId){
    var role=null;
    FRONT_OFFICE.roles.forEach(function(r){if(r.id===roleId)role=r;});
    if(!role)return null;
    var ovr=cl(Math.round(45+RNG.ai()*45),40,95);
    var salary=Math.round((role.salaryRange[0]+(role.salaryRange[1]-role.salaryRange[0])*(ovr-40)/55)*10)/10;
    salary=Math.max(role.salaryRange[0],Math.round((salary+(RNG.ai()-0.5))*10)/10);
    var traitKeys=Object.keys(FO_TRAITS);
    var trait=traitKeys[Math.floor(RNG.ai()*traitKeys.length)];
    var backstories=FO_BACKSTORIES[roleId]||FO_BACKSTORIES.gm;
    return{
      id:U(),roleId:roleId,title:role.title,icon:role.icon,color:role.color||"#a78bfa",
      name:FO_FIRST_NAMES[Math.floor(RNG.ai()*FO_FIRST_NAMES.length)]+" "+FO_LAST_NAMES[Math.floor(RNG.ai()*FO_LAST_NAMES.length)],
      ovr:ovr,salary:salary,
      specialty:role.affects[Math.floor(RNG.ai()*role.affects.length)],
      trait:trait,traitData:FO_TRAITS[trait]||FO_TRAITS.analytical,
      backstory:backstories[Math.floor(RNG.ai()*backstories.length)],
      yearsLeft:cl(Math.floor(1+RNG.ai()*4),1,5),
      tier:role.tier||"core"
    };
  },
  getBonus:function(staff,action){
    if(!staff||staff.length===0)return 0;
    var bonus=0;
    staff.forEach(function(s){
      var role=null;
      FRONT_OFFICE.roles.forEach(function(r){if(r.id===s.roleId)role=r;});
      if(role&&role.affects.indexOf(action)>=0){
        bonus+=Math.round(((s.ovr||50)-50)*0.1*10)/10;
      }
    });
    return Math.round(bonus*10)/10;
  },
  getCandidates:function(roleId,count){
    var candidates=[];
    for(var i=0;i<(count||4);i++){candidates.push(FRONT_OFFICE.generateStaff(roleId));}
    candidates.sort(function(a,b){return b.ovr-a.ovr;});
    return candidates;
  }
};
var WEEKLY_CHALLENGES={
  pool:[
    {id:"score35",label:"Score 35+ points",icon:"ðŸŽ¯",check:function(r){return(r.userScore||0)>=35;},xp:15,diff:"medium"},
    {id:"hold14",label:"Hold opponent under 14 points",icon:"ðŸ›¡ï¸",check:function(r){return(r.oppScore||0)<14;},xp:20,diff:"hard"},
    {id:"rush150",label:"Rush for 150+ yards",icon:"ðŸƒ",check:function(r){return(r.rushYds||0)>=150;},xp:12,diff:"medium"},
    {id:"pass350",label:"Pass for 350+ yards",icon:"ðŸŽ¯",check:function(r){return(r.passYds||0)>=350;},xp:12,diff:"medium"},
    {id:"win21",label:"Win by 21+ points",icon:"ðŸ’ª",check:function(r){return(r.userScore||0)-(r.oppScore||0)>=21;},xp:25,diff:"hard"},
    {id:"no_turnovers",label:"Zero turnovers",icon:"ðŸ§¤",check:function(r){return(r.turnovers||0)===0;},xp:18,diff:"hard"},
    {id:"comeback",label:"Win after trailing at half",icon:"ðŸ”„",check:function(r){return r.trailedAtHalf&&r.won;},xp:30,diff:"elite"},
    {id:"td4",label:"Score 4+ touchdowns",icon:"ðŸˆ",check:function(r){return(r.totalTD||0)>=4;},xp:10,diff:"easy"},
    {id:"sack4",label:"Get 4+ sacks",icon:"ðŸ’¥",check:function(r){return(r.sacks||0)>=4;},xp:15,diff:"medium"},
    {id:"shutout",label:"Shutout opponent",icon:"ðŸš«",check:function(r){return(r.oppScore||0)===0;},xp:50,diff:"legendary"}
  ],
  generateWeekly:function(week){
    var shuffled=WEEKLY_CHALLENGES.pool.slice();
    for(var i=shuffled.length-1;i>0;i--){
      var j=Math.floor(RNG.ui()*(i+1));
      var tmp=shuffled[i];shuffled[i]=shuffled[j];shuffled[j]=tmp;
    }
    return shuffled.slice(0,3).map(function(c){return assign({},c,{week:week,completed:false});});
  },
  checkResults:function(challenges,gameResult){
    if(!challenges||!gameResult)return{completed:[],xpEarned:0};
    var completed=[];var xp=0;
    challenges.forEach(function(c){
      if(!c.completed&&c.check(gameResult)){
        c.completed=true;
        completed.push(c);
        xp+=c.xp;
      }
    });
    return{completed:completed,xpEarned:xp};
  }
};
var NEWS_TICKER={
  generateWeekly:function(teams,myId,week,fas){
    var items=[];
    teams.forEach(function(t){
      (t.roster||[]).forEach(function(p){
        if(p.injury&&p.injury.games>=3&&(p.ovr||50)>=80&&RNG.ui()<0.3){
          items.push({type:"injury",icon:"ðŸ¥",text:t.icon+" "+p.name+" ("+p.pos+") expected to miss "+(p.injury.games||"several")+" weeks",color:"#ef4444",priority:2});
        }
      });
    });
    teams.forEach(function(t){
      if((t.streak||0)>=4){
        items.push({type:"streak",icon:"ðŸ”¥",text:t.icon+" "+t.abbr+" riding a "+(t.streak)+" game win streak!",color:"#f59e0b",priority:1});
      }else if((t.streak||0)<=-4){
        items.push({type:"streak",icon:"ðŸ“‰",text:t.icon+" "+t.abbr+" mired in a "+Math.abs(t.streak)+" game losing skid",color:"#6b7280",priority:1});
      }
    });
    teams.forEach(function(t){
      if(t.id===myId)return;
      (t.roster||[]).forEach(function(p){
        if((p.ovr||50)>=82&&p.contract&&p.contract.years<=1&&RNG.ui()<0.08){
          items.push({type:"rumor",icon:"ðŸ‘€",text:"RUMOR: "+t.icon+" "+t.abbr+" shopping "+p.name+" ("+p.pos+" "+p.ovr+" OVR) before deadline",color:"#a855f7",priority:3});
        }
      });
    });
    teams.forEach(function(t){
      if(t._prevRank&&t._currRank78){
        var delta=t._prevRank-t._currRank78;
        if(Math.abs(delta)>=5){
          items.push({type:"rankings",icon:delta>0?"ðŸ“ˆ":"ðŸ“‰",text:t.icon+" "+t.abbr+" "+(delta>0?"surge â¬†ï¸"+delta:"drop â¬‡ï¸"+Math.abs(delta))+" spots in power rankings",color:delta>0?"#10b981":"#ef4444",priority:2});
        }
      }
    });
    if(fas&&fas.length>0){
      var topFA=fas.filter(function(p){return(p.ovr||50)>=78;});
      if(topFA.length>0&&RNG.ui()<0.3){
        var fa=topFA[Math.floor(RNG.ui()*topFA.length)];
        items.push({type:"fa_buzz",icon:"ðŸ“",text:"FA BUZZ: "+fa.name+" ("+fa.pos+" "+fa.ovr+" OVR) drawing interest from multiple teams",color:"#22d3ee",priority:2});
      }
    }
    var hotTakes=["is being called the best team in a decade","could be headed for a shocking early playoff exit","has the league's most underrated defense","is quietly building a dynasty","might fire their coach if this slide continues"];
    if(RNG.ui()<0.4){
      var ht=teams[Math.floor(RNG.ui()*teams.length)];
      items.push({type:"hottake",icon:"ðŸŒ¶ï¸",text:"HOT TAKE: "+ht.icon+" "+ht.abbr+" "+hotTakes[Math.floor(RNG.ui()*hotTakes.length)],color:"#f97316",priority:1});
    }
    items.sort(function(a,b){return b.priority-a.priority;});
    return items.slice(0,8);
  }
};
var CACHED_LEADERS=null;// Stored result of buildAllTimeLeaders
var CACHED_LEADERS_YEAR=0;// Year when last computed
var COACHING_TREE_LOG=[];// Session log of coaching moves
function processCoachingTree(teams,season,rng2){
  if(!season||season.phase!=="offseason")return{moves:[],teams:teams};
  var moves=[];
  var ranked=teams.slice().sort(function(a,b){return b.wins-a.wins;});
  var topTeams=ranked.slice(0,4);// Top 4 teams at risk
  var bottomTeams=ranked.slice(-6);// Bottom 6 looking for coaches
  topTeams.forEach(function(srcTeam){
    if(!srcTeam.coaches)return;
    var coords=["OC","DC"].filter(function(role){
      return srcTeam.coaches[role]&&srcTeam.coaches[role].level>=3;// Only poach good coordinators
    });
    coords.forEach(function(role){
      var poachChance=srcTeam.wins>=12?0.55:srcTeam.wins>=10?0.35:0.20;
      if(rng2()<poachChance){
        var dest=bottomTeams[Math.floor(rng2()*bottomTeams.length)];
        if(!dest||dest.id===srcTeam.id)return;
        var coord=srcTeam.coaches[role];
        var move={type:"HIRE_AWAY",fromTeam:srcTeam.abbr,fromIcon:srcTeam.icon,toTeam:dest.abbr,toIcon:dest.icon,
          role:role,coachName:coord.name||("Coach "+srcTeam.abbr+" "+role),level:coord.level,
          year:season.year,text:coord.name+" ("+role+") hired away from "+srcTeam.icon+srcTeam.abbr+" to "+dest.icon+dest.abbr+" as HC"};
        moves.push(move);
        if(!dest.coaches)dest.coaches={};
        dest.coaches.HC=assign({},coord,{role:"HC",prevTeam:srcTeam.abbr,hiredYear:season.year,
          lineage:(coord.lineage||[]).concat([{team:srcTeam.abbr,role:role,years:coord.tenure||1}])});
        srcTeam.coaches[role]={name:generateCoachName?generateCoachName(rng2):"New "+role,
          level:1,xp:0,tenure:0,traits:[],role:role};
      }
    });
  });
  COACHING_TREE_LOG=COACHING_TREE_LOG.concat(moves).slice(-50);
  return{moves:moves,teams:teams};
}
var OWNER_EVENT_TEMPLATES={
  thrilled:[
    {emoji:"ðŸŽ‰",text:"Owner says: 'Incredible job! Keep this up and the sky's the limit!'",type:"praise"},
    {emoji:"ðŸ’°",text:"Owner says: 'You've earned a bonus! Extra cash for the offseason.'",type:"bonus"},
    {emoji:"ðŸ†",text:"Owner says: 'Championship-caliber work. I'm extending your contract.'",type:"praise"}
  ],
  satisfied:[
    {emoji:"ðŸ‘",text:"Owner says: 'Good work this season. Solid foundation.'",type:"neutral"},
    {emoji:"ðŸ“ˆ",text:"Owner says: 'The franchise is heading in the right direction.'",type:"neutral"}
  ],
  unhappy:[
    {emoji:"ðŸ˜¤",text:"Owner says: 'I expected better. The fans are restless.'",type:"warning"},
    {emoji:"ðŸ“‰",text:"Owner says: 'Attendance is down. We need to turn this around.'",type:"warning"},
    {emoji:"âš ï¸",text:"Owner says: 'I'm watching closely. Don't disappoint me.'",type:"threat"}
  ],
  furious:[
    {emoji:"ðŸ”¥",text:"Owner says: 'This is UNACCEPTABLE. Major changes are coming.'",type:"ultimatum"},
    {emoji:"ðŸ’£",text:"Owner says: 'One more bad stretch and you're GONE.'",type:"ultimatum"},
    {emoji:"ðŸš¨",text:"Owner says: 'I'm bringing in consultants. Your authority is limited.'",type:"ultimatum"}
  ]
};
function generateOwnerEvent(owner,season,rng2){
  if(!owner)return null;
  var triggerWeeks=[5,10,15];
  if(season.phase!=="offseason"&&triggerWeeks.indexOf(season.week)<0)return null;
  var pool=[];
  if(owner.approval>=80)pool=OWNER_EVENT_TEMPLATES.thrilled;
  else if(owner.approval>=60)pool=OWNER_EVENT_TEMPLATES.satisfied;
  else if(owner.approval>=25)pool=OWNER_EVENT_TEMPLATES.unhappy;
  else pool=OWNER_EVENT_TEMPLATES.furious;
  if(!pool||pool.length===0)return null;
  if(rng2()>0.60)return null;
  var evt=pool[Math.floor(rng2()*pool.length)];
  return assign({},evt,{year:season.year,week:season.week,approval:owner.approval});
}
function buildTradeDeadlineShow(teams,season,txLog){
  if(!season||season.week!==10||season.phase!=="regular")return null;
  var recentTrades=(txLog||[]).filter(function(tx){
    return tx.type==="TRADE"&&tx.year===season.year&&tx.week>=7;
  });
  var contenders=teams.filter(function(t){return t.wins>=6;}).sort(function(a,b){return b.wins-a.wins;});
  var sellers=teams.filter(function(t){return t.losses>=8;}).sort(function(a,b){return b.losses-a.losses;});
  var headlines=[];
  headlines.push({emoji:"ðŸ””",text:"TRADE DEADLINE HAS PASSED. The rosters are locked.",priority:5});
  if(recentTrades.length>0){
    headlines.push({emoji:"ðŸ”„",text:recentTrades.length+" trade"+(recentTrades.length>1?"s":"")+" completed in the deadline window.",priority:4});
  }else{
    headlines.push({emoji:"â„ï¸",text:"A quiet deadline â€” no trades made in the final stretch.",priority:4});
  }
  contenders.slice(0,2).forEach(function(ct){
    headlines.push({emoji:"ðŸ†",text:ct.icon+ct.abbr+" ("+ct.wins+"-"+ct.losses+") locked in as a contender.",priority:3});
  });
  sellers.slice(0,2).forEach(function(st){
    headlines.push({emoji:"ðŸ“‰",text:st.icon+st.abbr+" ("+st.wins+"-"+st.losses+") looking ahead to the draft.",priority:2});
  });
  return{headlines:headlines.slice(0,6),tradeCount:recentTrades.length,contenders:contenders.slice(0,3),sellers:sellers.slice(0,3)};
}
function buildSeasonAwards(teams,season,history){
  if(!teams||!season)return null;
  var allPlayers=[];
  teams.forEach(function(t){
    t.roster.forEach(function(p){
      if(!p.stats)return;
      allPlayers.push(assign({},p,{team:t.abbr,icon:t.icon,teamWins:t.wins,teamLosses:t.losses}));
    });
  });
  var mvpPool=allPlayers.filter(function(p){return["QB","RB","WR","TE"].indexOf(p.pos)>=0&&p.teamWins>=8;});
  mvpPool.sort(function(a,b){
    var aI=(a.stats.passTD||0)*7+(a.stats.rushTD||0)*7+(a.stats.passYds||0)*0.04+(a.stats.rushYds||0)*0.1+a.teamWins*3;
    var bI=(b.stats.passTD||0)*7+(b.stats.rushTD||0)*7+(b.stats.passYds||0)*0.04+(b.stats.rushYds||0)*0.1+b.teamWins*3;
    return bI-aI;
  });
  var dpoyPool=allPlayers.filter(function(p){return["DL","LB","CB","S"].indexOf(p.pos)>=0;});
  dpoyPool.sort(function(a,b){
    return((b.stats.sacks||0)*5+(b.stats.ints||0)*7+(b.stats.tackles||0)*0.3)-
      ((a.stats.sacks||0)*5+(a.stats.ints||0)*7+(a.stats.tackles||0)*0.3);
  });
  var royPool=allPlayers.filter(function(p){return p.age<=22||p.exp===0;});
  royPool.sort(function(a,b){
    var aI=(a.stats.passTD||0)*6+(a.stats.rushTD||0)*6+(a.stats.passYds||0)*0.03+(a.stats.rushYds||0)*0.08+
      (a.stats.sacks||0)*4+(a.stats.ints||0)*5;
    var bI=(b.stats.passTD||0)*6+(b.stats.rushTD||0)*6+(b.stats.passYds||0)*0.03+(b.stats.rushYds||0)*0.08+
      (b.stats.sacks||0)*4+(b.stats.ints||0)*5;
    return bI-aI;
  });
  var cotyPool=teams.slice().sort(function(a,b){
    var aOver=a.wins-(a._projWins||8);var bOver=b.wins-(b._projWins||8);
    return bOver-aOver;
  });
  var mvp=mvpPool[0]||null;
  var dpoy=dpoyPool[0]||null;
  var roy=royPool[0]||null;
  var cotyTeam=cotyPool[0]||null;
  var coty=cotyTeam&&cotyTeam.coaches&&cotyTeam.coaches.HC?
    {name:cotyTeam.coaches.HC.name||"HC "+cotyTeam.abbr,team:cotyTeam.abbr,icon:cotyTeam.icon,wins:cotyTeam.wins,losses:cotyTeam.losses}:
    {name:"HC "+((cotyTeam||{}).abbr||"?"),team:(cotyTeam||{}).abbr||"?",icon:(cotyTeam||{}).icon||"ðŸˆ",wins:(cotyTeam||{}).wins||0,losses:(cotyTeam||{}).losses||0};
  return{
    mvp:mvp?{name:mvp.name,pos:mvp.pos,team:mvp.team,icon:mvp.icon,ovr:mvp.ovr,
      line:mvp.pos==="QB"?(mvp.stats.passYds||0)+"yds/"+(mvp.stats.passTD||0)+"TD":
        (mvp.stats.rushYds||0)+"rush/"+(mvp.stats.recYds||0)+"rec/"+(((mvp.stats.rushTD||0)+(mvp.stats.recTD||0)))+"TD"}:null,
    dpoy:dpoy?{name:dpoy.name,pos:dpoy.pos,team:dpoy.team,icon:dpoy.icon,ovr:dpoy.ovr,
      line:(dpoy.stats.sacks||0)+"sck/"+(dpoy.stats.ints||0)+"INT/"+(dpoy.stats.tackles||0)+"tkl"}:null,
    roy:roy?{name:roy.name,pos:roy.pos,team:roy.team,icon:roy.icon,ovr:roy.ovr,age:roy.age}:null,
    coty:coty,
    year:season.year
  };
}
function buildFranchiseTimeline(history,teamId){
  if(!history||!teamId||history.length<2)return[];
  var events=[];
  history.forEach(function(h){
    if(!h.teams)return;
    var tr=h.teams.find(function(t2){return t2.id===teamId;});
    if(!tr)return;
    var isChamp=h.champId===teamId||h.winnerId===teamId;
    var wpct=tr.wins/(Math.max(1,tr.wins+tr.losses));
    var type="normal";var emoji="ðŸ“…";var color="#6b7280";
    if(isChamp){type="ring";emoji="ðŸ’";color="#fbbf24";}
    else if(wpct>=0.75){type="elite";emoji="â­";color="#818cf8";}
    else if(wpct>=0.55){type="winning";emoji="âœ…";color="#34d399";}
    else if(wpct<=0.30){type="rebuild";emoji="ðŸ”¨";color="#ef4444";}
    events.push({year:h.year,wins:tr.wins,losses:tr.losses,type:type,emoji:emoji,color:color,
      isChamp:isChamp,wpct:Math.round(wpct*100)});
  });
  return events;
}
function buildDraftNightPick(pick,player,team,pickNum,totalPicks,teams){
  if(!player||!team)return null;
  var posNeed=getTeamNeeds?getTeamNeeds(team):{};
  var fillsNeed=posNeed[player.pos]>0;
  var isReach=player.projRound&&player.projRound>(Math.floor(pickNum/teams.length)+1);
  var isSteal=player.projRound&&player.projRound<(Math.floor(pickNum/teams.length)+1);
  var reactions=[];
  if(fillsNeed)reactions.push({emoji:"âœ…",text:"Fills a roster need at "+player.pos});
  if(isSteal)reactions.push({emoji:"ðŸ”¥",text:"STEAL! Projected to go higher"});
  if(isReach)reactions.push({emoji:"ðŸ¤”",text:"Reach pick â€” projected later"});
  if(player.ovr>=72)reactions.push({emoji:"â­",text:"Day 1 starter potential"});
  if(player.pot&&player.pot>=player.ovr+10)reactions.push({emoji:"ðŸ“ˆ",text:"Sky-high ceiling (pot "+player.pot+")"});
  if(reactions.length===0)reactions.push({emoji:"ðŸ“‹",text:"Solid selection"});
  var grade="C";
  if(fillsNeed&&isSteal)grade="A+";
  else if(fillsNeed||isSteal)grade="A";
  else if(!isReach&&player.ovr>=68)grade="B+";
  else if(isReach)grade="C-";
  else grade="B";
  return{team:team.abbr,icon:team.icon,player:player.name,pos:player.pos,ovr:player.ovr,
    pot:player.pot||player.ovr,pickNum:pickNum+1,round:Math.floor(pickNum/teams.length)+1,
    reactions:reactions.slice(0,3),grade:grade,isUser:team.isUser||false};
}
function getScoutFlavorTrait89(prospect){
  if(!prospect)return"";
  var dom=getDominantTrait(prospect);
  if(dom&&dom.key)return dom.key;
  var arch=String(prospect.arch||prospect.archetype||"").toLowerCase();
  if(prospect.pos==="RB"&&(arch.indexOf("speed")>=0||arch.indexOf("elusive")>=0))return"speed";
  if(prospect.trait&&prospect.trait!=="none")return prospect.trait;
  return prospect.dominantTrait||"";
}
function SCOUT_REPORT_CARD(prospect,ctx,T){
  if(!prospect||!T)return null;
  var conf=Math.max(0,Math.min(100,(ctx&&ctx.conf)||0));
  var errBand=(ctx&&ctx.errBand)||0;
  var ovrDisplay=(ctx&&ctx.ovrDisplay)||"??";
  var archNote=(ctx&&ctx.archNote)||prospect.arch||prospect.archetype||"Standard";
  var charNote=(ctx&&ctx.charNote)||((prospect.character75&&prospect.character75.label)||"Unknown");
  var projOvr=prospect.projOvr||prospect.ovr||60;
  var scoutLetter=conf>=95?"A":conf>=90?"A-":conf>=82?"B+":conf>=75?"B":conf>=65?"B-":conf>=55?"C+":conf>=45?"C":"D";
  var roundProj=projOvr>=78?"Round 1 projection":projOvr>=72?"Round 1-2 projection":projOvr>=67?"Round 2-3 projection":"Round 3+ projection";
  var hasFilm=(prospect.scoutNotes||[]).length>0;
  var filmEval=hasFilm?prospect.scoutNotes[0]:"No film scouted";
  var hasAthletics=!!prospect.combine;
  var athleticLine="Untested";
  if(hasAthletics){
    var c=prospect.combine||{};
    var c40=c.forty?c.forty+"s 40":"No forty";
    var cBench=(c.bench||0)+" bench";
    var cVert=(c.vertical||0)+"in vert";
    athleticLine=c40+" / "+cBench+" / "+cVert;
  }
  var flavorTrait=getScoutFlavorTrait89(prospect);
  var scoutNote=getScoutNoteFlavor(prospect.pos,flavorTrait);
  var confBarFilled=Math.round((conf/100)*10);
  var confBar="";
  for(var cb=0;cb<10;cb++)confBar+=cb<confBarFilled?"â–“":"â–‘";
  var gradeColor=scoutLetter.indexOf("A")===0?T.green:scoutLetter.indexOf("B")===0?T.gold:scoutLetter.indexOf("C")===0?T.orange:T.red;
  return React.createElement("div",{style:{padding:"10px 12px",marginBottom:6,borderRadius:8,background:T.bg3,border:"1px solid "+T.gold+"33"}},
    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}},
      React.createElement("div",{style:{fontSize:12,fontWeight:900}},prospect.name+" ("+prospect.pos+")"),
      React.createElement("div",{style:{fontSize:13,fontWeight:900,color:gradeColor}},scoutLetter)
    ),
    React.createElement("div",{style:{fontSize:8,fontWeight:700,color:T.cyan,marginBottom:6}},
      "SCOUTING GRADE: "+scoutLetter+" | "+roundProj+" | Proj OVR: "+ovrDisplay+" ("+conf+"% Â±"+errBand+")"
    ),
    React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:3,marginBottom:6}},
      React.createElement("div",{style:{fontSize:9,color:T.dim}},
        React.createElement("span",{style:{color:T.faint,width:110,display:"inline-block"}},"Athletic Profile:"),athleticLine
      ),
      React.createElement("div",{style:{fontSize:9,color:T.dim}},
        React.createElement("span",{style:{color:T.faint,width:110,display:"inline-block"}},"Film Evaluation:"),filmEval
      ),
      React.createElement("div",{style:{fontSize:9,color:T.dim}},
        React.createElement("span",{style:{color:T.faint,width:110,display:"inline-block"}},"Character:"),charNote+" (Arch: "+archNote+")"
      )
    ),
    React.createElement("div",{style:{fontSize:8,color:T.cyan,fontStyle:"italic",marginBottom:4}},"\""+scoutNote+"\""),
    React.createElement("div",{style:{fontSize:8,color:T.dim,fontFamily:"monospace"}},confBar+" "+conf+"%")
  );
}
var DRAFT_COMMENTARY={
  r1elite:"Elite talent off the board. That franchise just got better overnight.",
  r1solid:"Day 1 starter. Their staff loved him at the combine.",
  r1value:"Interesting pick. Could be a steal if he develops.",
  r2steal:"Steal of the draft? Scouts had him going much higher.",
  r2solid:"Solid Day 2 pick. Fills a need immediately.",
  r2depth:"Good value in Round 2. Fits their system.",
  r3plus:"Day 3 find. Depth pick with some upside.",
  r3gem:"Hidden gem alert â€” this kid was on nobody's radar.",
  fallback:"The pick is in."
};
function getDraftCommentary(round,ovr){
  var r=round||1;var o=ovr||65;
  if(r===1){
    if(o>=80)return DRAFT_COMMENTARY.r1elite;
    if(o>=72)return DRAFT_COMMENTARY.r1solid;
    return DRAFT_COMMENTARY.r1value;
  }
  if(r===2){
    if(o>=72)return DRAFT_COMMENTARY.r2steal;
    if(o>=66)return DRAFT_COMMENTARY.r2solid;
    return DRAFT_COMMENTARY.r2depth;
  }
  if(o>=68)return DRAFT_COMMENTARY.r3gem;
  return DRAFT_COMMENTARY.r3plus;
}
var AWARD_HISTORY_LOG=[];// [{year, mvp:{name,pos,team}, dpoy, roy, coty}]
function recordAwardHistory(awards,year){
  if(!awards)return;
  AWARD_HISTORY_LOG.push({year:year,
    mvp:awards.mvp?{name:awards.mvp.name,pos:awards.mvp.pos,team:awards.mvp.team}:null,
    dpoy:awards.dpoy?{name:awards.dpoy.name,pos:awards.dpoy.pos,team:awards.dpoy.team}:null,
    roy:awards.roy?{name:awards.roy.name,pos:awards.roy.pos,team:awards.roy.team}:null,
    coty:awards.coty?{name:awards.coty.name,team:awards.coty.team}:null
  });
}
function getMultiTimeWinners(awardKey){
  var counts={};
  AWARD_HISTORY_LOG.forEach(function(h){
    var winner=h[awardKey];if(!winner)return;
    var key=winner.name+"|"+winner.pos;
    if(!counts[key])counts[key]={name:winner.name,pos:winner.pos||"HC",team:winner.team,count:0,years:[]};
    counts[key].count++;counts[key].years.push(h.year);
  });
  return Object.keys(counts).map(function(k){return counts[k];}).filter(function(c){return c.count>=2;}).sort(function(a,b){return b.count-a.count;});
}
function getTrophyName(trophyNames,teamA,teamB){
  if(!trophyNames)return null;
  var key=[teamA,teamB].sort().join("-");
  return trophyNames[key]||null;
}
function setTrophyNameForRivalry(trophyNames,teamA,teamB,name){
  var key=[teamA,teamB].sort().join("-");
  var updated=assign({},trophyNames||{});
  if(name&&name.trim())updated[key]=name.trim();
  else delete updated[key];
  return updated;
}
var COACH_LEGACY_LOG={};// { coachName: {name, totalWins, totalLosses, rings, seasons, teams:[]} }
function updateCoachLegacy(teams,season){
  teams.forEach(function(t){
    if(!t.coaches||!t.coaches.HC)return;
    var hc=t.coaches.HC;
    var key=hc.name||"HC "+t.abbr;
    if(!COACH_LEGACY_LOG[key])COACH_LEGACY_LOG[key]={name:key,totalWins:0,totalLosses:0,rings:0,seasons:0,teams:{},bestSeason:null};
    var cl=COACH_LEGACY_LOG[key];
    cl.totalWins+=t.wins;cl.totalLosses+=t.losses;cl.seasons++;
    cl.teams[t.abbr]=true;
    var wpct=t.wins/(Math.max(1,t.wins+t.losses));
    if(!cl.bestSeason||wpct>(cl.bestSeason.wpct||0)){
      cl.bestSeason={year:season.year,team:t.abbr,wins:t.wins,losses:t.losses,wpct:wpct};
    }
  });
}
function recordCoachRing(teams,champId){
  var champ=teams.find(function(t){return t.id===champId;});
  if(!champ||!champ.coaches||!champ.coaches.HC)return;
  var key=champ.coaches.HC.name||"HC "+champ.abbr;
  if(COACH_LEGACY_LOG[key])COACH_LEGACY_LOG[key].rings++;
}
function getCoachLegacyTop(n){
  return Object.keys(COACH_LEGACY_LOG).map(function(k){return COACH_LEGACY_LOG[k];}).sort(function(a,b){return b.totalWins-a.totalWins;}).slice(0,n||10);
}
function buildDNAImpactReport(dna,teams,season){
  if(!dna||!teams)return null;
  var insights=[];
  if(dna.injuryRate!==1.0){
    var totalInjured=0;teams.forEach(function(t){t.roster.forEach(function(p){if(p.injury&&p.injury>0)totalInjured++;});});
    var avgInjPct=Math.round(totalInjured/teams.length*100)/100;
    insights.push({emoji:"ðŸ¥",label:"Injury Rate ("+dna.injuryRate.toFixed(1)+"Ã—)",
      text:dna.injuryRate>1?"Higher injury rate â€” "+avgInjPct+" avg injuries/team. Depth matters more.":
        "Lower injury rate â€” "+avgInjPct+" avg injuries/team. Stars stay healthy."});
  }
  if(dna.devSpeed!==1.0){
    var youngStars=0;teams.forEach(function(t){t.roster.forEach(function(p){if(p.age<=24&&p.ovr>=75)youngStars++;});});
    insights.push({emoji:"ðŸ“ˆ",label:"Dev Speed ("+dna.devSpeed.toFixed(1)+"Ã—)",
      text:dna.devSpeed>1?youngStars+" young stars (â‰¤24, 75+ OVR) emerged. Fast development rewarded youth investment.":
        "Slow development â€” only "+youngStars+" young stars. Veterans hold their value longer."});
  }
  if(dna.parity!==1.0){
    var topWins=Math.max.apply(null,teams.map(function(t){return t.wins;}));
    var botWins=Math.min.apply(null,teams.map(function(t){return t.wins;}));
    var spread=topWins-botWins;
    insights.push({emoji:"âš–ï¸",label:"Parity ("+dna.parity.toFixed(1)+"Ã—)",
      text:dna.parity>1?"Competitive balance â€” only "+spread+" win spread top to bottom. Any given Sunday.":
        "Hierarchy reigns â€” "+spread+" win spread. Superteams dominate."});
  }
  if(dna.tradeFreq!==1.0){
    var tradeCount=(season.ledger||[]).filter(function(l){return l.type==="TRADE";}).length;
    insights.push({emoji:"ðŸ”„",label:"Trade Freq ("+dna.tradeFreq.toFixed(1)+"Ã—)",
      text:dna.tradeFreq>1?tradeCount+" trades this season. Active market reshuffled rosters.":
        tradeCount+" trades. Quiet market â€” teams held firm."});
  }
  if(dna.upsetChance!==1.0){
    insights.push({emoji:"ðŸ˜±",label:"Upset Volatility ("+dna.upsetChance.toFixed(1)+"Ã—)",
      text:dna.upsetChance>1?"Chaos reigned â€” underdogs had extra juice all season.":
        "Chalk held â€” favorites won more often than normal."});
  }
  if(insights.length===0)insights.push({emoji:"ðŸ“‹",label:"Default DNA",text:"Standard simulation â€” no DNA modifiers active."});
  return{insights:insights,year:season.year};
}
var FA_TIERS={
  ELITE:{label:"Elite",emoji:"ðŸ‘‘",minOvr:78,rounds:3,color:"#fbbf24",aiCompetition:0.85},
  SOLID:{label:"Solid",emoji:"â­",minOvr:70,rounds:2,color:"#60a5fa",aiCompetition:0.55},
  DEPTH:{label:"Depth",emoji:"ðŸ”§",minOvr:60,rounds:1,color:"#a1a1aa",aiCompetition:0.30},
  CAMP:{label:"Camp Body",emoji:"ðŸ“‹",minOvr:0,rounds:0,color:"#52525b",aiCompetition:0.05}
};
function getFATier(ovr){if(ovr>=78)return FA_TIERS.ELITE;if(ovr>=70)return FA_TIERS.SOLID;if(ovr>=60)return FA_TIERS.DEPTH;return FA_TIERS.CAMP;}
var FA_PHASES={
  TAMPERING:{id:"tampering",label:"Legal Tampering",icon:"ðŸ‘€",desc:"Express interest. No binding offers yet."},
  OPEN:{id:"open",label:"FA Opens",icon:"ðŸª",desc:"Bidding is live. Place offers on targets."},
  SETTLING:{id:"settling",label:"Market Settling",icon:"ðŸ“‰",desc:"Remaining FAs accept best offer or wait."}
};
var FA_ROLE_PITCH={
  STARTER:{id:"starter",label:"Day 1 Starter",icon:"ðŸˆ",weight:1.20},
  ROTATION:{id:"rotation",label:"Rotation Piece",icon:"ðŸ”„",weight:1.00},
  BACKUP:{id:"backup",label:"Quality Backup",icon:"ðŸ“‹",weight:0.85},
  DEPTH:{id:"depth",label:"Depth / ST",icon:"ðŸ”§",weight:0.70}
};
var RFA_TENDERS={
  FIRST:{id:"first",label:"1st Round Tender",salary:8.0,compRound:1},
  SECOND:{id:"second",label:"2nd Round Tender",salary:5.5,compRound:2},
  ORIGINAL:{id:"original",label:"Original Round",salary:3.0,compRound:4}
};
var FA_MARKET_VALUE={
  scarcity:{QB:1.8,DL:1.3,CB:1.25,WR:1.15,OL:1.2,LB:1.1,RB:0.85,TE:1.0,S:1.05,K:0.5,P:0.4},
  ageMod:function(age){if(age<=25)return 1.15;if(age<=27)return 1.05;if(age<=29)return 0.95;if(age<=31)return 0.80;return 0.60;},
  calc:function(player,interestedCount){
    var base=Math.max(1,Math.round(player.ovr*0.12*10)/10);
    var scar=FA_MARKET_VALUE.scarcity[player.pos]||1.0;
    var ageMd=FA_MARKET_VALUE.ageMod(player.age);
    var demand=1.0+Math.min(0.5,(interestedCount||0)*0.08);
    return Math.round(base*scar*ageMd*demand*10)/10;
  }
};
var FA_PRIORITY_TAGS=["ðŸ’° Money","ðŸ’ Ring Chase","ðŸ“‹ Role","ðŸ  Hometown","ðŸŽ“ Coach","ðŸ§¬ Scheme Fit"];
function buildFAMarket(fas,teams,myId){
  if(!fas||fas.length===0)return[];
  var topFAs=fas.slice().sort(function(a,b){return b.ovr-a.ovr;}).slice(0,15);
  return topFAs.map(function(fa){
    var interested=[];
    teams.forEach(function(t){
      if(t.isUser)return;// User decides manually
      var needs=getTeamNeeds?getTeamNeeds(t):{};
      var hasNeed=needs[fa.pos]>0;
      var capRoom=150-(t.capUsed||0)-(t.deadCap||0);
      var canAfford=capRoom>(fa.contract?fa.contract.salary:3);
      if(hasNeed&&canAfford)interested.push({team:t.abbr,icon:t.icon,capRoom:Math.round(capRoom),
        isContender:t.wins>=8,strategy:t.aiStrategy||"neutral"});
    });
    var heat=interested.length>=4?"ðŸ”¥ HOT":interested.length>=2?"ðŸ“ˆ Active":"â„ï¸ Cold";
    var asking=fa.contract?fa.contract.salary:Math.max(1,Math.round(fa.ovr*0.15));
    return{player:fa,name:fa.name,pos:fa.pos,ovr:fa.ovr,age:fa.age,
      asking:asking,interested:interested.slice(0,4),heat:heat,
      priority:fa.ovr>=80?"ðŸ’ Ring Chase":fa.age>=30?"ðŸ’° Money":"ðŸ“‹ Role"};
  });
}
function buildFAHeadlines(signings,teams){
  if(!signings||signings.length===0)return[];
  return signings.slice(0,6).map(function(s){
    var team=teams.find(function(t){return t.id===s.teamId;});
    if(!team)return null;
    var emoji=s.salary>=8?"ðŸ’°":s.salary>=4?"ðŸ“":"âœï¸";
    return{emoji:emoji,text:"BREAKING: "+s.pos+" "+s.name+" signs with "+team.icon+team.abbr+" â€” "+s.years+"yr/$"+s.salary+"M",
      detail:s.reason||"Fills a roster need",priority:s.ovr>=78?3:s.ovr>=72?2:1};
  }).filter(function(x){return !!x;}).sort(function(a,b){return b.priority-a.priority;});
}
function buildFABidBoard(fas,teams,myId,rng2,year){
  var board=[];if(!fas||fas.length===0)return board;
  fas.forEach(function(fa){
    var tier=getFATier(fa.ovr);if(tier===FA_TIERS.CAMP)return;if((fa.faYears||0)>=1)return;
    var interested=[];var fitByTeam={};
    teams.forEach(function(t){if(t.isUser||t.id===myId)return;var needs=getTeamNeeds?getTeamNeeds(t):{};
      var aiMode=deriveAITeamMode(t,year||2026);
      var modeComp=aiMode==="contend"?1.2:aiMode==="rebuild"?0.75:1.0;
      var fitScore86=calcPlayerIdentityFit(fa,t).score;
      fitByTeam[t.id]=fitScore86;
      var fitProb86=fitScore86>=84?1.15:fitScore86>=72?1.05:fitScore86>=60?0.95:0.80;
      if((needs[fa.pos]||0)>0&&(getSalaryCap(year)-(t.capUsed||0)-(t.deadCap||0))>3&&rng2()<Math.min(0.98,tier.aiCompetition*modeComp*fitProb86))interested.push(t.id);});
    var mv=FA_MARKET_VALUE.calc(fa,interested.length);
    board.push({playerId:fa.id,name:fa.name,pos:fa.pos,ovr:fa.ovr,age:fa.age,agentType:fa.agentType||"loyal",formerTeam:fa.formerTeam||null,teamTenure:fa.teamTenure||0,contract:fa.contract,
      personality:fa.personality||null,fitByTeam:fitByTeam,
      tierId:tier===FA_TIERS.ELITE?"ELITE":tier===FA_TIERS.SOLID?"SOLID":"DEPTH",roundsLeft:tier.rounds,totalRounds:tier.rounds,marketValue:mv,bids:[],status:"open",interested:interested,signedTo:null,signedOffer:null,isRFA:fa.isRFA82||false,rfaTender:fa.rfaTender82||null});
  });return board;
}
function simFABidRound(board,fas,teams,myId,rng2,round,year){
  var signings=[];var alerts=[];var headlines=[];
  var diffMod=(DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).aiBidMod;
  board.forEach(function(entry){
    if(entry.status!=="open")return;
    var faObj86=fas.find(function(p){return p.id===entry.playerId;})||{id:entry.playerId,pos:entry.pos,ovr:entry.ovr,age:entry.age,personality:entry.personality};
    entry.interested.forEach(function(tId){
      var t=teams.find(function(tm){return tm.id===tId;});if(!t)return;
      var capRoom=getSalaryCap(year)-(t.capUsed||0)-(t.deadCap||0);if(capRoom<2)return;
      var existBid=entry.bids.find(function(b){return b.teamId===tId;});
      var needs=getTeamNeeds?getTeamNeeds(t):{};var needMod=(needs[entry.pos]||0)>0.5?1.2:1.0;
      var aiMode=deriveAITeamMode(t,year||2026);
      var modeSpend=aiMode==="contend"?1.12:aiMode==="rebuild"?0.90:1.0;
      var stratKey=aiMode==="balanced"?"neutral":aiMode;
      var faBias=getGMFABias(stratKey,{age:entry.age||26,ovr:entry.ovr||65,pot:(entry.ovr||65)+4,contract:{salary:entry.marketValue||1}});
      var fitScore86=entry.fitByTeam&&entry.fitByTeam[tId]!==undefined?entry.fitByTeam[tId]:calcPlayerIdentityFit(faObj86,t).score;
      var fitSpend86=fitScore86>=84?1.10:fitScore86>=72?1.04:fitScore86>=60?0.96:0.86;
      var baseSal=Math.round((entry.marketValue*needMod*diffMod*modeSpend*faBias*fitSpend86*(0.9+rng2()*0.3))*10)/10;
      baseSal=Math.min(baseSal,capRoom*0.4);baseSal=Math.max(MIN_SALARY,baseSal);
      var yrs=Math.min(entry.age>=30?Math.max(1,Math.floor(rng2()*2)+1):Math.floor(rng2()*3)+2,5);
      if(aiMode==="contend"&&entry.age>=29)yrs=Math.max(1,Math.min(2,yrs));
      if(aiMode==="rebuild"&&entry.age<=27)yrs=Math.max(3,yrs);
      var role=(needs[entry.pos]||0)>0.7?"STARTER":(needs[entry.pos]||0)>0.3?"ROTATION":"BACKUP";
      if(aiMode==="contend"&&entry.ovr>=74)role="STARTER";
      if(fitScore86<58&&role==="STARTER")role="ROTATION";
      if(fitScore86>=86)role="STARTER";
      if(existBid){existBid.salary=Math.round(Math.max(existBid.salary*1.05,baseSal)*10)/10;existBid.years=yrs;existBid.role=role;existBid.round=round;}
      else{entry.bids.push({teamId:tId,salary:baseSal,years:yrs,role:role,visitUsed:false,loyaltyYears:0,round:round,isUser:false});}
    });
    entry.roundsLeft=Math.max(0,entry.roundsLeft-1);
    if(entry.roundsLeft<=0&&entry.bids.length>0){
      var fa=fas.find(function(p){return p.id===entry.playerId;});var bestScore=-1;var bestBid=null;
      entry.bids.forEach(function(bid){
        var bTeam=teams.find(function(tm){return tm.id===bid.teamId;});
        if(!bTeam&&bid.isUser){bTeam=teams.find(function(tm){return tm.id===myId;});}if(!bTeam)return;
        var sc=agentFAScoreV2({ovr:entry.ovr,pos:entry.pos,agentType:entry.agentType,formerTeam:entry.formerTeam,teamTenure:entry.teamTenure,personality:(fa&&fa.personality)||entry.personality||null},bTeam,bid,rng2);
        bid._score82=sc;if(sc>bestScore){bestScore=sc;bestBid=bid;}
      });
      if(bestBid){
        entry.status="signed";entry.signedTo=bestBid.teamId;entry.signedOffer=bestBid;
        var sTeam=teams.find(function(tm){return tm.id===bestBid.teamId;});
        if(!sTeam&&bestBid.isUser)sTeam=teams.find(function(tm){return tm.id===myId;});
        signings.push({playerId:entry.playerId,name:entry.name,pos:entry.pos,ovr:entry.ovr,teamId:bestBid.teamId,team:sTeam?sTeam.abbr:"???",icon:sTeam?sTeam.icon:"",salary:bestBid.salary,years:bestBid.years,role:bestBid.role,isUser:bestBid.isUser,reason:(sTeam&&sTeam.id===myId?"You":"AI")+" won bidding"});
        if(fa&&sTeam){sTeam.roster.push(assign({},fa,{contract:makeContract(bestBid.salary,bestBid.years,bestBid.salary>3?Math.round(bestBid.salary*0.25*bestBid.years*10)/10:0,0),isStarter:false,teamTenure:0}));sTeam.capUsed=capCalc(sTeam.roster);}
      }
    }
    if(entry.status==="open"){
      var userBid=entry.bids.find(function(b){return b.isUser;});
      if(userBid){var topBid=entry.bids.slice().sort(function(a,b){return(b.salary||0)-(a.salary||0);})[0];
        if(topBid&&!topBid.isUser&&topBid.salary>userBid.salary){
          var rivalTm=teams.find(function(tm){return tm.id===topBid.teamId;});
          alerts.push({id:"alert_"+entry.playerId+"_"+round,playerId:entry.playerId,name:entry.name,pos:entry.pos,ovr:entry.ovr,rivalId:topBid.teamId,rivalTeam:rivalTm?rivalTm.abbr:"???",rivalIcon:rivalTm?rivalTm.icon:"",rivalSalary:topBid.salary,rivalYears:topBid.years,rivalRecord:rivalTm?(rivalTm.wins||0)+"-"+(rivalTm.losses||0):"",yourSalary:userBid.salary,yourYears:userBid.years,round:round,urgent:entry.roundsLeft<=1,decidesThisRound:entry.roundsLeft<=1,dismissed:false});}}
    }
  });
  var signedIds={};signings.forEach(function(s){signedIds[s.playerId]=true;});
  return{updatedBoard:board,board:board,signings:signings,alerts:alerts,headlines:headlines,remaining:fas.filter(function(p){return !signedIds[p.id];})};
}
function calcVisitTokens(fo){var base=3;if(!fo)return base;return base+Math.floor(FRONT_OFFICE.getBonus(fo,"morale"))+Math.floor(FRONT_OFFICE.getBonus(fo,"evaluation")*0.5);}
// Real NFL RFA rule: players who have completed exactly 3 accrued seasons
// (finished their 4-yr rookie deal year 3, or 3 years of service total).
// 4+ accrued seasons = Unrestricted FA. 1-2 seasons = still on rookie deal (not FA yet).
function identifyRFAs(roster){return roster.filter(function(p){
  if(!p.contract||p.contract.years>1)return false;// Must be expiring
  var seasons=(p.careerStats&&p.careerStats.seasons)||0;
  return seasons===3;// ONLY true RFAs: exactly 3 accrued seasons
});}function pendingBidCap(bids,myId){var total=0;bids.forEach(function(e){if(e.status!=="open")return;var ub=e.bids.find(function(b){return b.isUser;});if(ub)total+=ub.salary;});return Math.round(total*10)/10;}
function buildDraftPreview(draftClass,teams,myId){
  if(!draftClass||draftClass.length===0)return null;
  var bigBoard=draftClass.slice().sort(function(a,b){return b.ovr-a.ovr;}).slice(0,15).map(function(p,i){
    var isFullyScouted=p.scouted&&p.scouted.complete;
    var grade=p.scoutGrade||getLetterGrade(p.ovr);
    return{rank:i+1,name:p.name,pos:p.pos,ovr:isFullyScouted?p.ovr:"?",
      grade:grade,age:p.age,pot:isFullyScouted?p.pot:"?",
      devTrait:isFullyScouted?p.devTrait:"???",scouted:isFullyScouted};
  });
  var risers=draftClass.filter(function(p){return p.scouted&&p.scouted.complete&&p.pot>p.ovr+8;})
    .sort(function(a,b){return(b.pot-b.ovr)-(a.pot-a.ovr);}).slice(0,3)
    .map(function(p){return{name:p.name,pos:p.pos,emoji:"ðŸ“ˆ",text:"Ceiling play â€” pot "+p.pot+" vs "+p.ovr+" OVR"};});
  var fallers=draftClass.filter(function(p){return p.scouted&&p.scouted.complete&&p.age>=23;})
    .sort(function(a,b){return b.age-a.age;}).slice(0,3)
    .map(function(p){return{name:p.name,pos:p.pos,emoji:"ðŸ“‰",text:"Age concern â€” already "+p.age+" years old"};});
  var myTeam=teams.find(function(t){return t.id===myId;});
  var myNeeds=myTeam&&getTeamNeeds?getTeamNeeds(myTeam):{};
  var topNeeds=Object.keys(myNeeds).slice(0,3);
  var needMatches=bigBoard.filter(function(p){return topNeeds.indexOf(p.pos)>=0;})
    .map(function(p){return{rank:p.rank,name:p.name,pos:p.pos,grade:p.grade,text:"Fills your "+p.pos+" need"};});
  return{bigBoard:bigBoard,risers:risers,fallers:fallers,needMatches:needMatches.slice(0,4),topNeeds:topNeeds};
}
function buildRivalryGameDay(team,opponent,rivalry,trophyNames,sched,season){
  if(!rivalry||!team||!opponent)return null;
  if(rivalry.heat<5)return null;// Only for heated rivalries
  var tName=getTrophyName?getTrophyName(trophyNames,team.id,opponent.id):null;
  var tier=rivalry.heat>=15?"BLOOD_FEUD":rivalry.heat>=10?"BITTER":"HEATED";
  var lastResults=(rivalry.moments||[]).filter(function(m){return m.type==="game"||m.emoji;}).slice(-5);
  var seriesW=rivalry.winsA||0,seriesL=rivalry.winsB||0;
  if(rivalry.teamB===team.id){var tmp=seriesW;seriesW=seriesL;seriesL=tmp;}
  var keyMatchup=null;
  var myQB=team.roster.find(function(p){return p.pos==="QB"&&p.isStarter;});
  var oppDL=opponent.roster.filter(function(p){return p.pos==="DL"&&p.isStarter;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
  if(myQB&&oppDL)keyMatchup={label:"Pass Rush vs Pocket",our:myQB.name+" ("+myQB.ovr+")",their:oppDL.name+" ("+oppDL.ovr+")"};
  var stakes=[];
  if(team.wins>=8||opponent.wins>=8)stakes.push("Playoff seeding on the line");
  if(tier==="BLOOD_FEUD")stakes.push("Blood feud â€” bragging rights for a generation");
  if(tName)stakes.push("ðŸ·ï¸ The "+tName+" is at stake");
  if(stakes.length===0)stakes.push("Division pride on the line");
  return{team:team,opponent:opponent,tName:tName,tier:tier,heat:rivalry.heat,
    seriesW:seriesW,seriesL:seriesL,lastResults:lastResults,keyMatchup:keyMatchup,stakes:stakes};
}
function buildCapVisualization(team){
  if(!team)return null;
  var posCap={};var totalCap=0;
  team.roster.forEach(function(p){
    if(!p.contract)return;
    var sal=p.contract.salary||0;
    if(!posCap[p.pos])posCap[p.pos]=0;
    posCap[p.pos]+=sal;totalCap+=sal;
  });
  var breakdown=Object.keys(posCap).map(function(pos){
    return{pos:pos,cap:Math.round(posCap[pos]*10)/10,pct:totalCap>0?Math.round(posCap[pos]/totalCap*100):0};
  }).sort(function(a,b){return b.cap-a.cap;});
  var topHits=team.roster.filter(function(p){return p.contract&&p.contract.salary>0;})
    .sort(function(a,b){return(b.contract.salary||0)-(a.contract.salary||0);}).slice(0,10)
    .map(function(p){return{name:p.name,pos:p.pos,ovr:p.ovr,age:p.age,
      salary:p.contract.salary,years:p.contract.years,
      value:p.ovr>=75?"âœ… Fair":p.ovr>=70?"âš ï¸ Watch":"âŒ Overpay"};});
  var projections=[];
  for(var yr=0;yr<3;yr++){
    var expiring=0;var committed=0;
    team.roster.forEach(function(p){
      if(!p.contract)return;
      if(p.contract.years<=yr)expiring+=p.contract.salary||0;
      else committed+=p.contract.salary||0;
    });
    var projCap=150;// Simplified cap
    projections.push({year:"Y+"+(yr+1),committed:Math.round(committed*10)/10,
      expiring:Math.round(expiring*10)/10,space:Math.round((projCap-committed)*10)/10,
      warning:committed>projCap*0.85?"âš ï¸ Cap cliff":committed>projCap*0.7?"ðŸ“‹ Tight":""});
  }
  var deadCap=team.deadCap||0;
  return{breakdown:breakdown,topHits:topHits,projections:projections,
    totalUsed:Math.round(totalCap*10)/10,capRoom:Math.round((150-totalCap-deadCap)*10)/10,deadCap:deadCap};
}
function buildCareerPage(playerName,history,teams){
  if(!playerName||!history)return null;
  var seasons=[];var careerStats={passYds:0,passTD:0,rushYds:0,rushTD:0,recYds:0,sacks:0,ints:0,tackles:0};
  var teamsPlayed={};var awards=[];
  history.forEach(function(h){
    if(!h.teams)return;
    h.teams.forEach(function(t){
      t.roster.forEach(function(p){
        if(p.name!==playerName)return;
        teamsPlayed[t.abbr]=true;
        var s={year:h.year,team:t.abbr,icon:t.icon||"ðŸˆ",pos:p.pos,ovr:p.ovr,age:p.age,stats:assign({},p.stats||{})};
        var st=p.stats||{};
        careerStats.passYds+=(st.passYds||0);careerStats.passTD+=(st.passTD||0);
        careerStats.rushYds+=(st.rushYds||0);careerStats.rushTD+=(st.rushTD||0);
        careerStats.recYds+=(st.recYds||0);careerStats.sacks+=(st.sacks||0);
        careerStats.ints+=(st.ints||0);careerStats.tackles+=(st.tackles||0);
        seasons.push(s);
      });
    });
    if(h.mvp&&h.mvp.name===playerName)awards.push({year:h.year,award:"ðŸ† MVP"});
    if(h.dpoy&&h.dpoy.name===playerName)awards.push({year:h.year,award:"ðŸ›¡ï¸ DPOY"});
    if(h.roy&&h.roy.name===playerName)awards.push({year:h.year,award:"ðŸŒ± ROY"});
  });
  AWARD_HISTORY_LOG.forEach(function(ah){
    if(ah.mvp&&ah.mvp.name===playerName&&!awards.some(function(a){return a.year===ah.year&&a.award==="ðŸ† MVP";}))
      awards.push({year:ah.year,award:"ðŸ† MVP"});
    if(ah.dpoy&&ah.dpoy.name===playerName&&!awards.some(function(a){return a.year===ah.year&&a.award==="ðŸ›¡ï¸ DPOY";}))
      awards.push({year:ah.year,award:"ðŸ›¡ï¸ DPOY"});
    if(ah.roy&&ah.roy.name===playerName&&!awards.some(function(a){return a.year===ah.year&&a.award==="ðŸŒ± ROY";}))
      awards.push({year:ah.year,award:"ðŸŒ± ROY"});
  });
  if(seasons.length===0)return null;
  return{name:playerName,pos:seasons[0].pos,seasons:seasons,career:careerStats,
    teams:Object.keys(teamsPlayed),awards:awards,yearsPlayed:seasons.length};
}
var FA_DAY=0;// Current FA day (0-4)
function simFADay(fas,teams,myId,rng2){
  if(!fas||fas.length===0)return{signings:[],remaining:fas};
  var signings=[];var remaining=fas.slice();
  teams.forEach(function(t){
    if(t.isUser||t.id===myId)return;
    var needs=getTeamNeeds?getTeamNeeds(t):{};
    var topNeed=Object.keys(needs).sort(function(a,b){return needs[b]-needs[a];})[0];
    if(!topNeed)return;
    var capRoom=150-(t.capUsed||0)-(t.deadCap||0);
    if(capRoom<3)return;
    var candidates=remaining.filter(function(p){return p.pos===topNeed&&p.ovr>=60;})
      .sort(function(a,b){return b.ovr-a.ovr;});
    if(candidates.length===0)return;
    var target=candidates[0];
    var agentObj=getAgentTypeObj(target.agentType||"loyal");
    var baseSalary=Math.max(1,Math.round(target.ovr*0.12*10)/10);
    var demandedSalary=Math.round(baseSalary*agentObj.moneyWeight*1.8*10)/10;// Mercenaries demand more
    var winPct2=(t.wins||0)/Math.max(1,(t.wins||0)+(t.losses||0));
    var attractiveness=winPct2*agentObj.winWeight+((t.wins||0)>=10?agentObj.ringWeight*0.3:0);
    var willSign=rng2()<(0.3+attractiveness*0.5+(t.wins>=8?0.15:0));// Agent-adjusted willingness
    if(!willSign)return;
    var salary=Math.max(1,Math.round(Math.max(baseSalary,demandedSalary)*10)/10);
    if(salary>capRoom*0.4)salary=Math.round(capRoom*0.3*10)/10;// Don't overspend
    var years=target.age>=30?Math.max(1,Math.floor(rng2()*2)+1):Math.floor(rng2()*3)+2;
    t.roster.push(assign({},target,{contract:makeContract(salary,years,0,0),isStarter:false}));
    t.capUsed=(t.capUsed||0)+salary;
    remaining=remaining.filter(function(x){return x.id!==target.id;});
    signings.push({name:target.name,pos:target.pos,ovr:target.ovr,teamId:t.id,team:t.abbr,icon:t.icon,
      salary:salary,years:years,reason:topNeed+" need"+(t.wins>=8?" + contender":"")});
  });
  return{signings:signings,remaining:remaining};
}
var OWNER_PERSONALITY_EVENTS=[
  {archetype:"win_now",trigger:function(o,t,s){return t.losses>=4&&s.week>=6;},
    emoji:"ðŸ˜ ",msg:"I didn't invest in this team to miss the playoffs. Make a move.",mood:-5,tag:"PRESSURE"},
  {archetype:"win_now",trigger:function(o,t,s){return t.wins>=10;},
    emoji:"ðŸ˜Š",msg:"This is what I'm talking about. Keep it up.",mood:3,tag:"PRAISE"},
  {archetype:"patient_builder",trigger:function(o,t,s){return t.roster.filter(function(p){return p.age<=24&&p.ovr>=70;}).length>=3;},
    emoji:"ðŸŒ±",msg:"Love the youth movement. These kids are the future.",mood:4,tag:"PRAISE"},
  {archetype:"patient_builder",trigger:function(o,t,s){return(t.capUsed||0)>130;},
    emoji:"âš ï¸",msg:"We're spending too much. I'd rather develop from within.",mood:-3,tag:"WARNING"},
  {archetype:"profit_first",trigger:function(o,t,s){return(150-(t.capUsed||0)-(t.deadCap||0))>=30;},
    emoji:"ðŸ’°",msg:"Excellent cap management. The books look clean.",mood:4,tag:"PRAISE"},
  {archetype:"profit_first",trigger:function(o,t,s){return(t.deadCap||0)>=10;},
    emoji:"ðŸ’¸",msg:"This dead money is unacceptable. Stop overpaying.",mood:-4,tag:"WARNING"},
  {archetype:"fan_favorite",trigger:function(o,t,s){return t.roster.some(function(p){return p.ovr>=85;});},
    emoji:"ðŸŒŸ",msg:"The fans love our star player. Keep them happy.",mood:3,tag:"PRAISE"},
  {archetype:"fan_favorite",trigger:function(o,t,s){return t.wins<=3&&s.week>=8;},
    emoji:"ðŸ˜¤",msg:"The stadium is half empty. Fans are losing patience.",mood:-5,tag:"PRESSURE"},
  {archetype:"legacy_builder",trigger:function(o,t,s){return t.wins>=12;},
    emoji:"ðŸ‘‘",msg:"Dynasty material. This could be our year.",mood:5,tag:"PRAISE"},
  {archetype:"legacy_builder",trigger:function(o,t,s){return t.losses>=8;},
    emoji:"ðŸ˜”",msg:"This is not the legacy I envisioned. We need a plan.",mood:-4,tag:"WARNING"}
];
function checkOwnerPersonality(owner,team,season,rng2){
  if(!owner||!team||!season)return null;
  if(season.phase!=="regular")return null;
  if(rng2()<0.6)return null;// Only 40% chance per week
  var archetype=owner.archetype||"win_now";
  var applicable=OWNER_PERSONALITY_EVENTS.filter(function(e){
    return e.archetype===archetype&&e.trigger(owner,team,season);
  });
  if(applicable.length===0)return null;
  var evt=applicable[Math.floor(rng2()*applicable.length)];
  return{emoji:evt.emoji,msg:evt.msg,mood:evt.mood,tag:evt.tag,week:season.week,year:season.year};
}
function buildAwardsCeremony(awards){
  if(!awards)return null;
  var reveal=[];
  if(awards.roy){
    var royLine=awards.roy.pos+" "+awards.roy.name+" ("+awards.roy.team+", Age "+awards.roy.age+")";
    var roySub=awards.roy.runnerUp74?"Runner-up: "+awards.roy.runnerUp74.name+" ("+awards.roy.runnerUp74.pos+", "+awards.roy.runnerUp74.tm+")":"";
    reveal.push({category:"ðŸŒ± OFFENSIVE ROOKIE OF THE YEAR",winner:awards.roy,line:royLine,sub:roySub,emoji:"ðŸŒ±"});
  }
  if(awards.coty)reveal.push({category:"ðŸŽ“ COACH OF THE YEAR",winner:awards.coty,
    line:awards.coty.name+" ("+awards.coty.team+", "+awards.coty.wins+"-"+awards.coty.losses+")",sub:"",emoji:"ðŸŽ“"});
  if(awards.opoy){
    var opoyLine=awards.opoy.pos+" "+awards.opoy.name+" ("+awards.opoy.team+")";
    var opoySub=awards.opoy.runnerUp74?"Runner-up: "+awards.opoy.runnerUp74.name+" ("+awards.opoy.runnerUp74.pos+", "+awards.opoy.runnerUp74.tm+")":"";
    reveal.push({category:"âš¡ OFFENSIVE PLAYER OF THE YEAR",winner:awards.opoy,line:opoyLine,sub:opoySub,emoji:"âš¡"});
  }
  if(awards.dpoy){
    var dpoyLine=awards.dpoy.pos+" "+awards.dpoy.name+" ("+awards.dpoy.team+") â€” "+awards.dpoy.line;
    var dpoySub=awards.dpoy.runnerUp74?"Runner-up: "+awards.dpoy.runnerUp74.name+" ("+awards.dpoy.runnerUp74.pos+", "+awards.dpoy.runnerUp74.tm+")":"";
    reveal.push({category:"ðŸ›¡ï¸ DEFENSIVE PLAYER OF THE YEAR",winner:awards.dpoy,line:dpoyLine,sub:dpoySub,emoji:"ðŸ›¡ï¸"});
  }
  if(awards.mvp){
    var mvpLine=awards.mvp.pos+" "+awards.mvp.name+" ("+awards.mvp.team+") â€” "+awards.mvp.line;
    var mvpSub=awards.mvp.runnerUp74?"Runner-up: "+awards.mvp.runnerUp74.name+" ("+awards.mvp.runnerUp74.pos+", "+awards.mvp.runnerUp74.tm+")"+(awards.mvp.margin74?" â€” margin: "+awards.mvp.margin74+" pts":""):"";
    reveal.push({category:"ðŸ† MOST VALUABLE PLAYER",winner:awards.mvp,line:mvpLine,sub:mvpSub,emoji:"ðŸ†"});
  }
  return{reveal:reveal,year:awards.year};
}
var BROADCAST_SEQ=0;
function broadcastEventId(context){
  BROADCAST_SEQ++;
  return"evt_"+BROADCAST_SEQ+"_"+(context||"gen");
}
var SCOUT={
  gaussian:function(mean,stdDev,seed){
    var s=mulberry32(seed);var u1=s();var u2=s();
    var z=Math.sqrt(-2*Math.log(Math.max(0.0001,u1)))*Math.cos(2*Math.PI*u2);
    return mean+z*stdDev;
  },
  getPerceived:function(trueVal,scoutLevel,playerId,week){
    var seed=(parseInt((playerId||"p0").replace(/\D/g,""))||0)+week+999;
    var noiseFactor=Math.max(1,12-Math.min(scoutLevel||0,10));// Level 10=Â±2, Level 0=Â±12
    var perceived=SCOUT.gaussian(trueVal,noiseFactor,seed);
    return Math.max(30,Math.min(99,Math.round(perceived)));
  },
  getRange:function(trueVal,scoutLevel){
    var noise=Math.max(1,12-Math.min(scoutLevel||0,10));
    var lo=Math.max(30,Math.round(trueVal-noise*1.5));
    var hi=Math.min(99,Math.round(trueVal+noise*1.5));
    return{lo:lo,hi:hi,display:lo+"â€“"+hi,confident:noise<=3};
  },
  getGradeRange:function(trueVal,scoutLevel){
    var r=SCOUT.getRange(trueVal,scoutLevel);
    return getLetterGrade(r.lo)+" â€“ "+getLetterGrade(r.hi);
  }
};
var POS_COACH_SLOTS=["qb_coach","ol_coach","dl_coach","db_coach"];
var POS_COACH_MAP={qb_coach:["QB"],ol_coach:["OL"],dl_coach:["DL","LB"],db_coach:["CB","S"]};
var POS_COACH_LABELS={qb_coach:"QB Coach",ol_coach:"OL Coach",dl_coach:"DL Coach",db_coach:"DB Coach"};
function generatePosCoach(rng2){
  var firstNames=["Mike","Steve","Jim","Tony","Dave","Chris","Mark","Paul","Rick","Dan"];
  var lastNames=["Williams","Johnson","Brown","Davis","Miller","Wilson","Moore","Taylor","White","Harris"];

// â”€â”€ PLAYER_NAMES_991: ChatGPT Full Name Database â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var PLAYER_NAMES_991={
  first:{
    classic:["Mike","Tom","John","Chris","Kyle","Brett","Aaron","Scott","Brian","Kevin",
             "Eric","Mark","Jeff","Ryan","Jason","Matt","Todd","Derek","Craig","Shane",
             "Brad","Chad","Lance","Greg","Blake","Trevor","Travis","Justin","Adam","Cole",
             "Cody","Austin","Hunter","Tyler","Logan","Colton","Garrett","Tanner","Parker","Dalton"],
    modern:["Jaylen","Malik","Darius","Zach","Cooper","Trevon","Lamar","DeAndre","Tyree","Kavon",
            "Keyon","Jabril","Marshon","Quincy","Tavon","Devontae","Jarvis","Rashard","Damian","Tyson",
            "Deshawn","Terrell","Kendall","Jaquan","Amon","Trayvon","Keenan","Devante","Caleb","Brayden",
            "Tyrion","Jamar","Stephon","Kareem","Jevon","Dontae","Caylin","Micah","Saquon","Jalen"],
    southern:["Tanner","Clint","Beau","Tucker","Colt","Bo","Wyatt","Cade","Trace","Rhett",
              "Colby","Ty","Cash","Lane","Heath","Brock","Gage","Ridge","Slade","Dak",
              "Bubba","Junior","Hank","Roy","Earl","Wade","Vance","Jed","Cord","Tex"],
    international:["Rodrigo","Kwame","Nikolaj","Malakai","Andres","Tonga","Rasmus","Kaito","Emeka","Oluwaseun",
                   "Matias","Ola","Bjorn","Tomaso","Yousef","Kijana","Miroslav","Fabrice","Diallo","Thibault",
                   "Ola","Eddy","Lars","Rene","Kofi","Seneca","Amadou","Reuben","Tobias","Mathis"]
  },
  last:{
    common:["Smith","Johnson","Williams","Brown","Davis","Wilson","Moore","Taylor","White","Harris",
            "Martin","Thompson","Garcia","Robinson","Clark","Lewis","Lee","Walker","Hall","Allen",
            "Young","Hernandez","King","Wright","Lopez","Hill","Scott","Green","Adams","Nelson",
            "Baker","Carter","Mitchell","Perez","Roberts","Turner","Phillips","Campbell","Parker","Evans",
            "Edwards","Collins","Stewart","Sanchez","Morris","Rogers","Reed","Cook","Morgan","Bell"],
    athletic:["Jackson","Jefferson","Washington","Armstrong","Crawford","Dawson","Lawson","Patterson","Richardson","Ferguson",
              "Cunningham","Montgomery","Henderson","Richardson","Freeman","Griffin","Bryant","Foster","Porter","Warren",
              "Barnes","Dixon","Watkins","Hicks","Gibson","Murray","Riley","Pierce","Garrett","Harrison",
              "Sanders","Simmons","Hunter","Coleman","Ross","Tucker","Freeman","Nichols","Powell","Long",
              "Patterson","Stone","Bradley","Hamilton","Owens","Hudson","Graves","Jennings","Flynn","Mathis"],
    regional:["Thibodaux","Fontenot","Broussard","Guidry","Boudreaux","Hebert","Tanner","Harrington","Buchanan","Whitfield",
              "Beaumont","Thornton","Beauchamp","Callahan","Gallagher","O'Brien","Flanagan","Beaumont","Stafford","Beauregard",
              "Carmichael","Aldridge","Beaumont","Hollingsworth","Davenport","Abernathy","Blackwood","Ashford","Dunmore","Wainwright"]
  },
  positionWeights:{
    QB:{classic:0.35,modern:0.35,southern:0.20,international:0.10},
    RB:{classic:0.20,modern:0.50,southern:0.20,international:0.10},
    WR:{classic:0.15,modern:0.55,southern:0.15,international:0.15},
    TE:{classic:0.40,modern:0.30,southern:0.20,international:0.10},
    OL:{classic:0.35,modern:0.25,southern:0.30,international:0.10},
    DL:{classic:0.25,modern:0.40,southern:0.25,international:0.10},
    LB:{classic:0.35,modern:0.35,southern:0.25,international:0.05},
    CB:{classic:0.15,modern:0.55,southern:0.15,international:0.15},
    S:{classic:0.25,modern:0.45,southern:0.20,international:0.10},
    K:{classic:0.30,modern:0.20,southern:0.10,international:0.40},
    P:{classic:0.35,modern:0.20,southern:0.15,international:0.30}
  }
};

// â”€â”€ SCOUTING_TEMPLATES_991: ChatGPT Draft Scouting Reports â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var SCOUTING_TEMPLATES_991={
  QB:{
    elite:["[PLAYER] from [COLLEGE] is the real deal. Elite arm talent, exceptional pocket presence, and the football IQ of a ten-year veteran. Franchise cornerstone.",
           "[PLAYER] has everything you look for at the position. Touch, timing, accuracy at every level of the field. This is a generational talent.",
           "The [COLLEGE] product redefined what a college quarterback can be. [PLAYER] processes defenses at an NFL level already. Day 1 starter.",
           "[PLAYER] put up historic numbers at [COLLEGE] but the advanced metrics are what jump off the page. Zero wasted motion, elite decision speed.",
           "Watch five plays of [PLAYER] and you'll see it immediately. Rare combination of anticipation, arm strength, and competitive fire."],
    solid:["[PLAYER] from [COLLEGE] is a dependable starter. Won't wow you, but won't lose you games either. High-floor, defined ceiling.",
           "Consistent performer at [COLLEGE], [PLAYER] manages the game well. Smart decision-maker who won't beat himself. Reliable bridge or long-term starter.",
           "[PLAYER] is a professional. Solid mechanics, above-average football IQ, handles pressure. Projects as a 10-year starter in the right system.",
           "The tape shows a complete player who knows what he is. [PLAYER] wins within the structure â€” controlled aggression, limited mistakes.",
           "[PLAYER] is the definition of reliable. Not flashy, but consistently delivers. Fits best in a system that plays to his strengths."],
    project:["The numbers at [COLLEGE] were gaudy, but [PLAYER] played in a run-heavy spread system. Pro-style transition is a major question mark.",
             "[PLAYER] has the physical tools to be special, but rawness is a concern. Mental processing and footwork need NFL-level coaching.",
             "Arm talent is there, but [PLAYER] needs to develop internal clock and understanding of NFL coverage concepts. High ceiling, needs time.",
             "[PLAYER] from [COLLEGE] â€” the athleticism is undeniable but the mechanics are a project. Redshirt Year 1 could pay dividends.",
             "Late-round value. [PLAYER] has flashes of brilliance buried in inconsistency. Someone is going to bet on the upside."],
    bust:["The numbers at [COLLEGE] were gaudy, but [PLAYER] played in a run-heavy spread system. The pro-style transition is a major question mark. High ceiling, higher floor of disappointment.",
          "[PLAYER] dominated weak competition. The arm is fine, but does the IQ translate? Concerns about reading NFL defenses are legitimate.",
          "Medicals and off-field questions surround [PLAYER]. The talent is undeniable. The risk is real."]
  },
  RB:{
    elite:["[PLAYER] is a workhorse. Runs through contact, finds the crease, and never takes a play off. Three-down back of the future.",
           "Rare combination of power and speed. [PLAYER] from [COLLEGE] runs away from defenders and through them. Feature back.",
           "[PLAYER] put up eye-popping numbers and the HOW matters as much as the HOW MANY. Vision, patience, burst â€” he has it all.",
           "The [COLLEGE] product is a complete back. Catches out of the backfield, pass protects, takes the punishment. Bell cow.",
           "[PLAYER] is built for the NFL game. Compact, powerful, with elite contact balance. The touchdowns will follow the targets."],
    solid:["[PLAYER] will be a reliable committee back who provides four to five yards consistently. Smart runner, limited fumble issues.",
           "Not a feature back, but a valuable piece. [PLAYER] handles passing downs and short-yardage situations with competence.",
           "[PLAYER] is the definition of reliable depth. Knows his role, executes his assignments, won't make you cringe on film.",
           "Solid backup who can start in a pinch. [PLAYER] won't hurt you and occasionally helps you in key moments.",
           "[PLAYER] is a tough-yardage specialist. Thrives between the tackles. Fourth-down and goalline package value."],
    project:["Raw athleticism jumping off the tape â€” [PLAYER] is a converted track athlete still learning route running. If the hands develop, he's a steal.",
             "[PLAYER] is a developmental back with a rare gear. Needs to understand gap concepts and improve pass protection.",
             "The burst is there. The vision isn't yet. [PLAYER] has time to develop with the right coaching staff.",
             "Small school background means limited competition. [PLAYER] has the tools â€” the question is whether they translate.",
             "Interesting later-round flier. [PLAYER] does one thing at an elite level. If that one thing fits your system, take the chance."],
    scatback:["Don't let the size fool you â€” [PLAYER] is a chess piece who can't be tackled in space. Third-down back of the future.",
              "[PLAYER] is a weapon in space. Speed, agility, pass-catching ability â€” use him creatively and watch the defense panic.",
              "Undersized but electric. [PLAYER] wins with quickness where others win with power. Role player with Pro Bowl ceiling in the right system."]
  },
  WR:{
    elite:["[PLAYER] is a number-one receiver. Creates separation at every level, physical at the catch point, and demands double coverage.",
           "Elite route runner meets elite hands. [PLAYER] from [COLLEGE] is what every franchise is searching for. Lock him in.",
           "[PLAYER] changed the game at [COLLEGE]. Size, speed, route precision â€” the full package. This is a true number-one wide receiver.",
           "The separation metrics on [PLAYER] are unprecedented for a college receiver. He gets open against everyone. Every. Single. Time.",
           "Watch the route running. [PLAYER] has developed a mastery of leverage and timing that you rarely see at this level."],
    solid:["Reliable number-two receiver. [PLAYER] runs crisp routes, catches what hits him, and creates yards after contact.",
           "[PLAYER] is a professional. Won't make many highlight reels but will make the plays that move the chains.",
           "Hard-nosed receiver who competes every play. [PLAYER] is the type of player coaches love â€” dependable, smart, works hard.",
           "[PLAYER] fills a role and fills it well. Slot specialist with reliable hands and good feel for finding soft spots.",
           "Projection is a solid starter who makes the right play. [PLAYER] operates within a system and maximizes his opportunities."],
    project:["Raw talent jumping off the tape â€” [PLAYER] is a converted track athlete still learning route running. If the hands develop, he's a Day 2 steal.",
             "[PLAYER] can run by anyone. Route running and hand consistency are projects. Enormous upside for a patient team.",
             "The speed grade is exceptional. Everything else about [PLAYER] needs work. Long-term investment, not a quick fix.",
             "[PLAYER] flashes brilliance on individual plays. Consistency and route depth need development. Boom-or-bust prospect.",
             "Team that drafts [PLAYER] needs patience. The physical gifts are undeniable but the football IQ needs seasoning."],
    slot:["[PLAYER] was born to play the slot. Quickness off the line, feel for zone coverage, and reliable in short areas.",
          "Don't overlook [PLAYER]'s value as a slot specialist. Elite PPR asset, possession receiver, safety valve.",
          "Inside receiver of the future. [PLAYER] wins with craftiness and IQ rather than athleticism. Consistent producer."]
  },
  DL:{
    elite:["Disruptive from the first snap, [PLAYER] has the get-off and hand technique that translates immediately. Pro Bowl Year 1 is a realistic expectation.",
           "[PLAYER] is a wrecking ball. The burst, the motor, the technique â€” this is an elite pass rusher ready to terrorize QBs.",
           "Interior dominance is a premium in today's NFL. [PLAYER] provides that and more. First-round value plays here.",
           "[PLAYER] from [COLLEGE] doesn't just get sacks â€” he changes the way the offense plans their protection. Franchise defensive piece.",
           "The hand work alone makes [PLAYER] special. He wins in multiple ways â€” speed, power, and disguise. Immediate starter."],
    solid:["[PLAYER] projects as a reliable starting defensive lineman. Won't dominate, but consistently beats his block and plays sound technique.",
           "Productive college career translates to steady professional contribution. [PLAYER] is a system fit with long-term starting value.",
           "[PLAYER] does the dirty work. Two-gap ability, run stop, occasional pressure. The kind of player that makes a good defense work.",
           "Every rotation needs a [PLAYER] type. Consistent effort, reliable technique, competitive throughout the game.",
           "Underrated on most boards but [PLAYER] fills a need. Good length, solid technique, high football IQ for the position."],
    project:["[PLAYER] has the physical profile you can't teach. The technique is a developmental project but the raw tools justify the investment.",
             "Needs refinement at the point of attack, but [PLAYER]'s motor and athleticism give coaches something to work with.",
             "Late-round flier with upside. [PLAYER] needs to add strength and learn NFL techniques, but the talent floor is there."]
  },
  LB:{
    elite:["[PLAYER] is a complete linebacker. Sideline-to-sideline speed, takes on blockers, blitzes at a Pro Bowl level, covers ground in zone.",
           "Every offensive coordinator will scheme around [PLAYER] from Day 1. That's the ultimate compliment for a linebacker.",
           "[PLAYER] from [COLLEGE] plays faster than his measurables suggest. Diagnoses plays instantly and attacks gaps decisively.",
           "The instincts on [PLAYER] are generational. He's already thinking two steps ahead. That cannot be coached.",
           "Complete linebacker with no real weakness. [PLAYER] plays the run, drops in coverage, and rushes the passer. Franchise defender."],
    solid:["[PLAYER] is a reliable starting linebacker who won't make highlight reels but rarely misses assignments either.",
           "Sound technique, reliable pursuit angles, and trustworthy in coverage. [PLAYER] is the kind of defender that coaches trust.",
           "[PLAYER] fits the modern linebacker mold. Can play multiple coverage assignments and is a willing run stopper.",
           "Consistent performer who gives you quality snaps every week. [PLAYER] is a team-first player who makes the system better.",
           "Veteran-minded prospect. [PLAYER] plays within the scheme, avoids bad decisions, and competes every down."],
    project:["Athletic specimen who needs to learn the position conceptually. [PLAYER] can run â€” now teach him where to run.",
             "The tools are there. [PLAYER] needs to refine his instincts in coverage and improve block shedding at the next level.",
             "Physical gifts make [PLAYER] intriguing. Converting raw athleticism to positional production takes time and coaching."]
  },
  CB:{
    elite:["Lockdown corner. [PLAYER] is physical off the line and doesn't give cushion. The other team's number-one receiver has a long day.",
           "[PLAYER] is the type of CB who allows coordinators to bracket the rest of the field. Franchise cornerstone on defense.",
           "Elite man coverage skills. [PLAYER] shadows his assignment everywhere. The tape doesn't lie â€” he shuts people down."],
    solid:["[PLAYER] is a solid number-two cornerback. Technique-first player who won't be exposed in standard coverage assignments.",
           "Reliable starter who makes his assignments. [PLAYER] won't always win but he's rarely embarrassed.",
           "Zone specialist with a high floor. [PLAYER] reads quarterbacks well and rarely allows the big play."],
    project:["[PLAYER] has the athleticism to become a starter but needs to develop technique and route recognition.",
             "Long, rangy CB with upside. [PLAYER] plays big but still gets beaten on double moves. Coachable and motivated.",
             "Raw but intriguing. [PLAYER] has off-ball instincts that are hard to find. Needs patience."]
  },
  S:{
    elite:["[PLAYER] is an all-field safety who can play the deep ball and come downhill as a run defender. Versatile chess piece.",
           "Every defensive coordinator dreams of [PLAYER] type. Single-high mastery, elite zone reading, physical tackler.",
           "[PLAYER] from [COLLEGE] plays center field with authority. Quarterbacks will learn not to test him."],
    solid:["[PLAYER] is a dependable starting safety who plays his assignment and makes his tackles.",
           "Sound run support and serviceable in coverage. [PLAYER] gives you exactly what you see on film.",
           "[PLAYER] is a physical presence in the box. Strong safety value with special teams upside."],
    project:["[PLAYER] has the physical tools but needs to process faster in coverage. Ball skills and positioning need work.",
             "Developmental safety with plus athleticism. [PLAYER] needs to clean up footwork and communication skills.",
             "Backup-to-starter trajectory. [PLAYER] will need seasoning but the ceiling is a starter."]
  },
  TE:{
    elite:["[PLAYER] is a mismatch machine. Too fast for linebackers, too physical for safeties. The complete receiving tight end.",
           "As a blocker AND receiver, [PLAYER] from [COLLEGE] is the total package. This kind of tight end changes an offense.",
           "[PLAYER] is the type of tight end that forces a new coverage package. Game-wrecker from Day 1."],
    solid:["[PLAYER] is a reliable blocking tight end who catches enough to keep the defense honest. Solid starter.",
           "Not flashy but effective. [PLAYER] wins contested catches, blocks well in-line, and understands his role.",
           "[PLAYER] projects as a starting TE. Good hands, willing blocker, smart route runner. Valued team player."],
    project:["[PLAYER] has the receiving upside but hasn't developed as a blocker. Limited to pass-heavy formations for now.",
             "Converted athlete who only scratched the surface of what [PLAYER] can become. Worth developing.",
             "Needs refinement in every area but [PLAYER]'s athleticism earns him a roster spot and developmental time."]
  },
  OL:{
    elite:["[PLAYER] is a plug-and-play starter at multiple positions. The anchor of any offensive line he joins from Day 1.",
           "Interior lineman with elite movement for the position. [PLAYER] pulls, kicks, and dominates in both the run and pass game.",
           "[PLAYER] from [COLLEGE] is a franchise piece. Pass protection grade is elite and the run blocking is even better."],
    solid:["[PLAYER] is a reliable starter who keeps his assignment in both phases. Won't lose you games in the trenches.",
           "Technique-driven lineman. [PLAYER] uses leverage and footwork rather than athleticism. Steady, dependable, smart.",
           "[PLAYER] fits the mold of a starting OL who helps a line from a position of need."],
    project:["Athletic lineman who needs to refine his hand placement and stance. [PLAYER] has the size but not the polish.",
             "[PLAYER] played out of position in college. Moving to his natural spot in the pros could unlock real potential.",
             "Boom-or-bust OL with prototype size. [PLAYER] needs two years to develop but the frame is worth the bet."]
  }
};
// â”€â”€ END PLAYER_NAMES_991 / SCOUTING_TEMPLATES_991 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  return{name:firstNames[Math.floor(rng2()*firstNames.length)]+" "+lastNames[Math.floor(rng2()*lastNames.length)],
    rating:Math.floor(rng2()*40)+40,// 40-79
    years:0,specialty:""};
}
function initPosCoaches(team,rng2){
  if(!team.posCoaches)team.posCoaches={};
  POS_COACH_SLOTS.forEach(function(slot){
    if(!team.posCoaches[slot])team.posCoaches[slot]=generatePosCoach(rng2);
  });
  return team;
}
function getPosCoachBonus(team,pos){
  if(!team||!team.posCoaches)return 0;
  var bonus=0;
  POS_COACH_SLOTS.forEach(function(slot){
    var positions=POS_COACH_MAP[slot]||[];
    if(positions.indexOf(pos)>=0){
      var coach=team.posCoaches[slot];
      if(coach)bonus+=Math.floor(coach.rating/20);// 0-3 bonus based on 40-79 rating
    }
  });
  return bonus;
}
var OC_SPECIALTIES=[
  {id:"run_guru",label:"Run Game Guru",icon:"ðŸƒ",effect:{rushMod:2,runLanes:0.03},desc:"Boosts rushing efficiency"},
  {id:"pass_arch",label:"Pass Architect",icon:"ðŸŽ¯",effect:{passMod:2,pocket:0.02},desc:"Elevates passing game"},
  {id:"rz_spec",label:"Red Zone Specialist",icon:"ðŸ”´",effect:{rzTdPct:0.04},desc:"Better red zone TD conversion"},
  {id:"tempo",label:"Tempo Master",icon:"âš¡",effect:{drivesBonus:1},desc:"Extra offensive possessions"},
  {id:"play_action",label:"Play-Action Expert",icon:"ðŸŽ­",effect:{passMod:1,stallReduction:0.02},desc:"Fewer 3-and-outs with PA"}
];
var DC_SPECIALTIES=[
  {id:"blitz_des",label:"Blitz Designer",icon:"ðŸ’¨",effect:{pressureBoost:0.03},desc:"More effective blitz packages"},
  {id:"cov_spec",label:"Coverage Specialist",icon:"ðŸ›¡ï¸",effect:{covAdj:0.02,intBoost:0.01},desc:"Tighter coverage, more INTs"},
  {id:"run_stop",label:"Run Stopper",icon:"ðŸ§±",effect:{rushMod:-2},desc:"Shuts down opponent run game"},
  {id:"turnover",label:"Turnover Creator",icon:"ðŸ”„",effect:{intBoost:0.02,fumbleBoost:0.01},desc:"Forces more turnovers"},
  {id:"situational",label:"Situational Master",icon:"ðŸ§ ",effect:{stallReduction:0.01,lateGameBoost:0.03},desc:"Better in crucial moments"}
];
function assignCoordSpecialty(staffMember,role){
  var pool=role==="OC"?OC_SPECIALTIES:DC_SPECIALTIES;
  if(!staffMember)return null;
  if(staffMember.specialty75)return staffMember.specialty75;// Already assigned
  staffMember.specialty75=pool[Math.floor(RNG.ai()*pool.length)];
  return staffMember.specialty75;
}
function getSpecialtyBonus(team,side){
  if(!team||!team.staff)return null;
  var coord=side==="off"?team.staff.oc:team.staff.dc;
  if(!coord||!coord.specialty75)return null;
  return coord.specialty75;
}
var OFFSEASON_EVENTS={
  templates:[
    {id:"combine_surprise",icon:"ðŸ‹ï¸",label:"Combine Surprise",
      generate:function(ctx,rng2){
        if(!ctx.dc||ctx.dc.length===0)return null;
        var low=ctx.dc.filter(function(p){return(p.ovr||50)<=62;});
        if(low.length===0)return null;
        var p=low[Math.floor(rng2()*low.length)];
        return{type:"combine_surprise",icon:"ðŸ‹ï¸",headline:p.name+" EXPLODES at combine â€” scouts scrambling!",player:p.name,playerId:p.id,
          choices:[
            {label:"Move him up your board",desc:"Reveal true potential (+12 OVR boost)",effect:{type:"ovr_boost",playerId:p.id,amount:12}},
            {label:"Trust your existing eval",desc:"No changes â€” stick with your scouts",effect:{type:"none"}}
          ]};
      }},
    {id:"fa_bidding_war",icon:"ðŸ’°",label:"FA Bidding War",
      generate:function(ctx,rng2){
        if(!ctx.fas||ctx.fas.length===0)return null;
        var stars=ctx.fas.filter(function(p){return(p.ovr||50)>=72;});
        if(stars.length===0)return null;
        var p=stars[Math.floor(rng2()*stars.length)];
        return{type:"fa_bidding_war",icon:"ðŸ’°",headline:"Bidding war erupts for "+p.name+"! Two teams drive price up 30%.",player:p.name,
          choices:[
            {label:"Match the inflated price",desc:"Pay 130% market value to guarantee signing",effect:{type:"fa_inflate",playerName:p.name,mod:1.3}},
            {label:"Walk away",desc:"Let rivals overpay â€” find value elsewhere",effect:{type:"none"}}
          ]};
      }},
    {id:"coaching_carousel",icon:"ðŸŽ ",label:"Coaching Carousel",
      generate:function(ctx,rng2){
        var real974=ctx&&ctx.season&&Array.isArray(ctx.season.firedHCs974)?ctx.season.firedHCs974:[];
        if(real974.length>0){
          var fire974=real974[Math.floor(rng2()*real974.length)];
          return{type:"coaching_carousel",icon:"ðŸŽ ",headline:(fire974.icon||"ðŸŽ ")+" "+(fire974.team||"TEAM")+" fires HC "+(fire974.coach||"Unknown")+" after "+(fire974.record||"rough")+" season!",
            choices:[
              {label:"Poach their scout",desc:"Steal their scouting director (+5% draft confidence)",effect:{type:"scout_boost",amount:5}},
              {label:"Stay out of it",desc:"Focus on your own team",effect:{type:"none"}}
            ]};
        }
        var loserTeams=ctx.teams.filter(function(t){return!t.isUser&&t.losses>=10;});
        if(loserTeams.length===0)return null;
        var t=loserTeams[Math.floor(rng2()*loserTeams.length)];
        return{type:"coaching_carousel",icon:"ðŸŽ ",headline:t.icon+" "+t.abbr+" fires HC "+((t.staff&&t.staff.hc)?t.staff.hc.name:"Unknown")+"!",
          choices:[
            {label:"Poach their scout",desc:"Steal their scouting director (+5% draft confidence)",effect:{type:"scout_boost",amount:5}},
            {label:"Stay out of it",desc:"Focus on your own team",effect:{type:"none"}}
          ]};
      }},
    {id:"scandal",icon:"âš ï¸",label:"Player Scandal",
      generate:function(ctx,rng2){
        var myTeam=ctx.teams.find(function(t){return t.id===ctx.myId;});
        if(!myTeam||!myTeam.roster||myTeam.roster.length===0)return null;
        var candidates=myTeam.roster.filter(function(p){return(p.ovr||50)>=65&&!p.injury;});
        if(candidates.length===0)return null;
        var p=candidates[Math.floor(rng2()*candidates.length)];
        return{type:"scandal",icon:"âš ï¸",headline:"REPORT: "+p.name+" involved in off-field incident. 4-game suspension possible.",player:p.name,playerId:p.id,
          choices:[
            {label:"Suspend him (4 games)",desc:"Show discipline â€” team morale +5, player misses 4 games",effect:{type:"suspend",playerId:p.id,games:4,morale:5}},
            {label:"Stand by your player",desc:"Loyalty â€” no suspension but morale -3, fanbase -5",effect:{type:"loyalty",morale:-3,fanbase:-5}}
          ]};
      }},
    {id:"camp_standout",icon:"ðŸŒŸ",label:"Training Camp Standout",
      generate:function(ctx,rng2){
        return{type:"camp_standout",icon:"ðŸŒŸ",headline:"Undrafted rookie turns heads at training camp!",
          choices:[
            {label:"Sign him to the roster",desc:"Add a 58-65 OVR project player with star dev trait",effect:{type:"add_udfa"}},
            {label:"Let him go",desc:"Roster is full enough",effect:{type:"none"}}
          ]};
      }},
    {id:"international",icon:"ðŸŒ",label:"International Signing",
      generate:function(ctx,rng2){
        var positions=["DL","OL","LB","TE","RB"];
        var pos=positions[Math.floor(rng2()*positions.length)];
        return{type:"international",icon:"ðŸŒ",headline:"International prospect "+pos+" available â€” raw but sky-high ceiling!",
          choices:[
            {label:"Sign him (high ceiling, low floor)",desc:"Add 52-60 OVR player with superstar dev trait",effect:{type:"add_international",pos:pos}},
            {label:"Pass",desc:"Too risky for your roster",effect:{type:"none"}}
          ]};
      }},
    {id:"draft_trade_offer",icon:"ðŸ“ž",label:"Draft Day Trade Offer",
      generate:function(ctx,rng2){
        var aiTeams=ctx.teams.filter(function(t){return!t.isUser;});
        if(aiTeams.length===0)return null;
        var t=aiTeams[Math.floor(rng2()*aiTeams.length)];
        return{type:"draft_trade_offer",icon:"ðŸ“ž",headline:t.icon+" "+t.abbr+" calls with blockbuster draft pick offer!",
          choices:[
            {label:"Accept: trade down 5 spots for extra 2nd rounder",desc:"More picks, lower ceiling",effect:{type:"trade_down",spots:5}},
            {label:"Decline: keep your pick",desc:"Stay pat and trust your board",effect:{type:"none"}}
          ]};
      }},
    {id:"owner_demand",icon:"ðŸ‘”",label:"Owner Offseason Demand",
      generate:function(ctx,rng2){
        if(ctx.ownerPatience>=70)return null;
        return{type:"owner_demand",icon:"ðŸ‘”",headline:"Owner demands offseason changes: 'This isn't good enough.'",
          choices:[
            {label:"Promise a splashy FA signing",desc:"Owner patience +15, but expectations rise",effect:{type:"patience_boost",amount:15}},
            {label:"Ask for patience",desc:"Owner patience +5, trust your process",effect:{type:"patience_boost",amount:5}}
          ]};
      }}
  ],
  generate:function(ctx,rng2){
    var events=[];var attempts=0;var usedTypes={};
    while(events.length<4&&attempts<25){
      attempts++;
      var template=OFFSEASON_EVENTS.templates[Math.floor(rng2()*OFFSEASON_EVENTS.templates.length)];
      if(usedTypes[template.id])continue;
      var event=template.generate(ctx,rng2);
      if(event){events.push(event);usedTypes[template.id]=true;}
    }
    return events;
  }
};
var MFSN_DRAFT_GRADES={
  gradeScale:[
    {min:88,letter:"A+",desc:"Historic haul. MFSN calls it a masterclass."},
    {min:80,letter:"A",desc:"Excellent class. Multiple contributors expected."},
    {min:72,letter:"B+",desc:"Solid draft. Clear value at key positions."},
    {min:63,letter:"B",desc:"Decent work. Depth addressed, upside exists."},
    {min:54,letter:"C+",desc:"Average. Some reaches, some value picks."},
    {min:45,letter:"C",desc:"Underwhelming. Needs remain unaddressed."},
    {min:35,letter:"D",desc:"Poor class. Overdrafted, bad fits throughout."},
    {min:0,letter:"F",desc:"MFSN torches this draft. What were they thinking?"}
  ],
  analysts:[
    {name:"Rod Pemberton",icon:"ðŸŽ™ï¸",bias:"loves_athletes"},
    {name:"Diane Holloway",icon:"ðŸ“Š",bias:"loves_value"},
    {name:"Marcus Steele",icon:"ðŸ”¥",bias:"loves_upside"},
    {name:"Lena Voss",icon:"ðŸ§ ",bias:"loves_need"}
  ],
  scoreDraft:function(picks,team){
    if(!picks||picks.length===0)return{score:50,letter:"C",desc:"Nothing to grade."};
    var needs=getTeamNeeds?getTeamNeeds(team):{};
    var totalScore=0;
    picks.forEach(function(p){
      var base=p.ovr>=85?25:p.ovr>=78?20:p.ovr>=72?15:p.ovr>=65?10:p.ovr>=58?6:3;
      var needBonus=(needs&&needs[p.pos]&&needs[p.pos]>=7)?5:0;
      var pickSlotBonus=(p._draftRound||4)<=2?3:(p._draftRound||4)>=5?1:2;
      var devBonus=p.devTrait==="superstar"?8:p.devTrait==="star"?4:0;
      totalScore+=(base+needBonus+pickSlotBonus+devBonus);
    });
    var normalized=Math.min(99,Math.round(totalScore/picks.length));
    var g=MFSN_DRAFT_GRADES.gradeScale.find(function(gs){return normalized>=gs.min;})||MFSN_DRAFT_GRADES.gradeScale[MFSN_DRAFT_GRADES.gradeScale.length-1];
    return{score:normalized,letter:g.letter,desc:g.desc};
  },
  generate:function(picks,team,year,rng2){
    var gradeResult=MFSN_DRAFT_GRADES.scoreDraft(picks,team);
    var analyst=MFSN_DRAFT_GRADES.analysts[Math.floor(rng2()*MFSN_DRAFT_GRADES.analysts.length)];
    var topPick=picks.slice().sort(function(a,b){return b.ovr-a.ovr;})[0];
    var sleeper=picks.find(function(p){return p.isGem&&(p._draftRound||4)>=4;})||picks[picks.length-1];
    var takes={
      "A+":["Best draft class I've seen in years. "+team.abbr+" is a dynasty in the making.","Every pick has a role. This front office knows exactly what they're building."],
      "A":["Top to bottom, this is an excellent class. Multiple starters in this group.","Addressed every major need. "+team.abbr+" gets an A from me."],
      "B+":["Strong effort. Especially love the "+(topPick?topPick.pos:"first-round")+" pick.","Nothing flashy, but the value is undeniable. Strong B+."],
      "B":["Nothing flashy, but smart. "+team.abbr+" added depth where they needed it.","Some reaches, but the value picks balance it out. Solid B."],
      "C+":["Mixed bag. The "+(topPick?topPick.name+" pick was fine":"top pick was okay")+", but board falls off after Round 2.","Average class. Hope the coaching staff can develop the upside."],
      "C":[""+team.abbr+" needed more from this draft. Several positions still unaddressed.","You'd expect more value here. Giving a C and being generous."],
      "D":["Honestly? Baffled by some of these selections. Too many reaches.","This class has more questions than answers. A D, and only because I'm in a good mood."],
      "F":["MFSN BREAKING: "+team.abbr+" holds the worst draft in recent memory.","I've been doing this 20 years. This might be the worst draft I've ever graded."]
    };
    var takePools=takes[gradeResult.letter]||takes["C"];
    var takeIdx=Math.floor(rng2()*takePools.length);
    return{year:year,analyst:analyst.name,analystIcon:analyst.icon,grade:gradeResult.letter,score:gradeResult.score,desc:gradeResult.desc,take:takePools[takeIdx],topPick:topPick?{name:topPick.name,pos:topPick.pos,ovr:topPick.ovr,devTrait:topPick.devTrait}:null,sleeper:sleeper&&(sleeper._draftRound||4)>=4?{name:sleeper.name,pos:sleeper.pos,round:sleeper._draftRound}:null,revisitYear:year+2};
  },
  revisit:function(originalGrade,currentRoster,year){
    if(!originalGrade||year<originalGrade.revisitYear)return null;
    var drafted=currentRoster.filter(function(p){return p._draftYear===originalGrade.year;});
    if(drafted.length===0)return null;
    var starters=drafted.filter(function(p){return p.isStarter&&p.ovr>=72;}).length;
    var verdict=starters>=3?"We nailed it â€” "+starters+" starters from that class.":starters>=2?"Decent. "+starters+" contributors emerged.":starters===1?"One starter. Underperformed our "+originalGrade.grade+" grade.":"Complete bust. That "+originalGrade.grade+" grade aged poorly.";
    return{year:year,originalGrade:originalGrade.grade,starters:starters,verdict:verdict};
  }
};
var DRAFT_PRESSER975={
  generateQuestions:function(grade,picks,team,year){
    if(!grade||!picks||picks.length===0||!team)return[];
    var questions=[];
    var gradeKey=(grade.grade||"C").replace("+","_PLUS").replace("-","_MINUS");
    var gradeVal={A_PLUS:10,A:9,A_MINUS:8,B_PLUS:8,B:7,B_MINUS:6,C_PLUS:6,C:5,C_MINUS:4,D:3,F:1};
    var gv=gradeVal[gradeKey]||5;
    if(gv>=8){
      questions.push({
        q:"MFSN gave you an "+grade.grade+" for this draft. Walk us through your strategy.",
        opts:[
          {text:"We identified our needs and attacked them aggressively.",effect:{ownerMood:3,morale:2}},
          {text:"The board fell our way. Sometimes preparation meets opportunity.",effect:{ownerMood:2,morale:1}},
          {text:"Grades don't matter. Ask me again in three years.",effect:{ownerMood:1,morale:3}}
        ]
      });
    }else if(gv<=4){
      questions.push({
        q:"Analysts are calling this draft a "+grade.grade+". How do you respond to the critics?",
        opts:[
          {text:"We drafted for our system. Not for media grades.",effect:{ownerMood:-1,morale:3,chemistry:2}},
          {text:"We'll prove them wrong on the field.",effect:{morale:5,chemistry:1,ownerMood:-2}},
          {text:"I understand the concern. We have a plan.",effect:{ownerMood:2,morale:-1}}
        ]
      });
    }else{
      questions.push({
        q:"How do you feel about your draft class?",
        opts:[
          {text:"I'm excited about every player we added.",effect:{morale:2,chemistry:1}},
          {text:"We got our guys. That's all that matters.",effect:{morale:3,ownerMood:1}},
          {text:"Time will tell. We'll evaluate in camp.",effect:{morale:1,ownerMood:1}}
        ]
      });
    }
    var rd1=(picks||[]).filter(function(p){return (p._draftRound||0)===1;});
    if(rd1.length>0){
      var p1=rd1[0];
      questions.push({
        q:"You took "+p1.name+" with your first-round pick. Why "+p1.pos+"?",
        opts:[
          {text:"Best player available. Period.",effect:{morale:1,ownerMood:1}},
          {text:p1.pos+" was our biggest need. He fills a critical hole.",effect:{morale:2}},
          {text:"Wait until you see what this kid can do. He's special.",effect:{morale:3,chemistry:1}}
        ]
      });
    }
    var latePick=(picks||[]).filter(function(p){return (p._draftRound||7)>=4;});
    if(latePick.length>0){
      var lp=latePick[0];
      questions.push({
        q:"Tell us about the "+((lp._draftRound||"late"))+"-round pick "+lp.name+". A lot of people didn't have him on their boards.",
        opts:[
          {text:"Our scouts loved him. We had him ranked much higher.",effect:{morale:2}},
          {text:"He's a project, but the upside is incredible.",effect:{morale:1,chemistry:1}},
          {text:"We'll let the player's play speak for itself.",effect:{morale:1,ownerMood:1}}
        ]
      });
    }
    return questions.slice(0,3);
  }
};
var MFSN_PREDICTIONS={
  generate:function(teams,myId,year,rng2){
    var sorted=teams.slice().sort(function(a,b){
      var aOvr=a.roster?Math.round(a.roster.reduce(function(s,p){return s+p.ovr;},0)/Math.max(1,a.roster.length)):60;
      var bOvr=b.roster?Math.round(b.roster.reduce(function(s,p){return s+p.ovr;},0)/Math.max(1,b.roster.length)):60;
      return bOvr-aOvr;
    });
    var myRank=sorted.findIndex(function(t){return t.id===myId;})+1;
    var myT=teams.find(function(t){return t.id===myId;});
    var projWins=myRank<=4?Math.round(11+rng2()*3):myRank<=8?Math.round(9+rng2()*3):myRank<=16?Math.round(7+rng2()*3):Math.round(4+rng2()*4);
    projWins=Math.min(17,Math.max(2,projWins));
    var sbOdds=myRank<=2?"+"+Math.round(400+rng2()*200):myRank<=6?"+"+Math.round(800+rng2()*400):myRank<=12?"+"+Math.round(1500+rng2()*1000):"+"+Math.round(3000+rng2()*2000);
    var statPreds=[];
    if(myT&&myT.roster){
      var qb=myT.roster.filter(function(p){return p.pos==="QB"&&p.isStarter;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      var rb=myT.roster.filter(function(p){return p.pos==="RB"&&p.isStarter;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      var wr=myT.roster.filter(function(p){return p.pos==="WR"&&p.isStarter;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      if(qb){var passYdPred=Math.round((3200+qb.ovr*15+rng2()*500)/100)*100;statPreds.push({name:qb.name,pos:"QB",stat:"pass yds",pred:passYdPred,odds:qb.ovr>=82?"-115":"+"+(Math.round(100+rng2()*150))});}
      if(rb){var rushYdPred=Math.round((600+rb.ovr*8+rng2()*200)/50)*50;statPreds.push({name:rb.name,pos:"RB",stat:"rush yds",pred:rushYdPred,odds:rb.ovr>=80?"-110":"+"+(Math.round(120+rng2()*200))});}
      if(wr){var recYdPred=Math.round((500+wr.ovr*7+rng2()*200)/50)*50;statPreds.push({name:wr.name,pos:"WR",stat:"rec yds",pred:recYdPred,odds:wr.ovr>=80?"-105":"+"+(Math.round(130+rng2()*180))});}
    }
    var abbr=myT?myT.abbr:"TEAM";
    var takes=myRank<=3?["MFSN POWER RANKING: "+abbr+" is a legit Championship contender. Don't sleep.","Our analysts have "+abbr+" as a top-3 team. "+abbr+" to win it all: "+sbOdds+".","Vegas agrees â€” "+abbr+" is the real deal this season."]:myRank<=8?[abbr+" is a dark horse. If they stay healthy, watch out.","MFSN PROJECTION: "+abbr+" goes "+projWins+"-"+(17-projWins)+". Sneaky good.","Analysts are split on "+abbr+". We're going playoff bubble."]:["Tough road ahead for "+abbr+". MFSN projects "+projWins+" wins. Prove us wrong.","Rebuilding? Retooling? "+abbr+" needs a miracle to make the playoffs.","MFSN has "+abbr+" in the bottom half. Low expectations â€” perfect setup for a surprise."];
    return{year:year,projWins:projWins,sbOdds:sbOdds,myRank:myRank,statPreds:statPreds,headline:takes[Math.floor(rng2()*takes.length)],topSBFav:sorted[0]?sorted[0].abbr:"???",topSBFavOdds:"+"+Math.round(200+rng2()*200),generated:true};
  },
  resolve:function(pred,team,actualWins){
    if(!pred)return null;
    var diff=Math.abs(actualWins-pred.projWins);
    var verdict=diff<=1?"MFSN nailed it â€” predicted "+pred.projWins+", got "+actualWins+".":diff<=3?"MFSN was close â€” off by "+diff+" wins.":actualWins>pred.projWins?"MFSN WRONG: "+team.abbr+" EXCEEDED expectations by "+diff+" wins. ðŸ‘€":"MFSN WRONG: "+team.abbr+" fell short of "+pred.projWins+" win prediction.";
    return{verdict:verdict,projWins:pred.projWins,actualWins:actualWins,diff:diff,beat:actualWins>=pred.projWins};
  }
};
var STAFF_POACHING={
  checkPoach:function(staff,isChamp,wins,rng2){
    var targets=[];
    staff.forEach(function(s){
      if((s.ovr||0)<70)return;
      var rate=isChamp?0.50:wins>=9?0.25:0;
      if(rate>0&&rng2()<rate){targets.push(assign({},s,{poachRate:Math.round(rate*100)}));}
    });
    return targets;
  },
  counterOfferCost:function(s){return Math.round((s.salary||2)*1.5*10)/10;},
  applyPoach:function(frontOffice,target){
    return frontOffice.filter(function(s){return s.id!==target.id;});
  }
};
// BREAKOUT_SYSTEM â†’ extracted to src/systems/breakout-system.js (module swap #12)
var GRUDGE_MATCH={
  markGrudge:function(player,formerTeamId,reason){if(!player)return;player.grudge80={formerTeamId:formerTeamId,reason:reason,weeksActive:0,torched:false};},
  isGrudgeGame:function(player,homeTeamId,awayTeamId){if(!player||!player.grudge80)return false;return player.grudge80.formerTeamId===homeTeamId||player.grudge80.formerTeamId===awayTeamId;},
  applyBoost:function(player){
    if(!player||!player.grudge80)return player;
    var boosted=assign({},player);
    boosted.ovr=Math.min(99,boosted.ovr+8);
    if(boosted.ratings){boosted.ratings=assign({},boosted.ratings);Object.keys(boosted.ratings).forEach(function(k){boosted.ratings[k]=Math.min(99,(boosted.ratings[k]||60)+5);});}
    boosted._grudgeActive=true;
    return boosted;
  },
  resolve:function(player,playerStats,wasGoodGame,formerTeamAbbr){
    if(!player||!player.grudge80)return null;
    player.grudge80.weeksActive=(player.grudge80.weeksActive||0)+1;
    if(wasGoodGame&&!player.grudge80.torched){player.grudge80.torched=true;return{torched:true,name:player.name,pos:player.pos,abbr:formerTeamAbbr,stats:playerStats};}
    if(player.grudge80.weeksActive>34||player.grudge80.torched)delete player.grudge80;
    return null;
  }
};
var COACH_SKILL_TREE={
  trees:{
    Strategist:{branches:[
      {id:"air_raid",name:"Air Raid",icon:"âœˆï¸",tiers:[
        {level:3,label:"Quick Release",bonus:{passMod:2},desc:"+2% pass efficiency"},
        {level:6,label:"Spread Master",bonus:{passMod:3},desc:"+3% pass efficiency"},
        {level:9,label:"Aerial Dominance",bonus:{passMod:5,rzBoost:3},desc:"+5% pass, +3% red zone"}
      ]},
      {id:"ground_pound",name:"Ground & Pound",icon:"ðŸƒ",tiers:[
        {level:3,label:"Power Run",bonus:{rushMod:2},desc:"+2% rush efficiency"},
        {level:6,label:"Clock Killer",bonus:{rushMod:3,drivesBonus:1},desc:"+3% rush, +1 drive/game"},
        {level:9,label:"Steamroller",bonus:{rushMod:5,stallReduction:0.03},desc:"+5% rush, fewer stalls"}
      ]},
      {id:"analytics",name:"Analytics King",icon:"ðŸ“Š",tiers:[
        {level:3,label:"4th Down Guru",bonus:{stallReduction:0.02},desc:"Better 4th down conversion"},
        {level:6,label:"Matchup Hunter",bonus:{counterBoost:2},desc:"+2 scheme counter bonus"},
        {level:9,label:"Moneyball",bonus:{stallReduction:0.04,counterBoost:3},desc:"Peak analytics edge"}
      ]}
    ]},
    Motivator:{branches:[
      {id:"player_dev",name:"Player Developer",icon:"ðŸ“ˆ",tiers:[
        {level:3,label:"Growth Mindset",bonus:{devBoost:1},desc:"+1 OVR growth/season"},
        {level:6,label:"Star Maker",bonus:{devBoost:2},desc:"+2 OVR growth/season"},
        {level:9,label:"Legend Factory",bonus:{devBoost:3,breakoutBoost:15},desc:"+3 OVR, +15% breakout chance"}
      ]},
      {id:"morale_king",name:"Morale King",icon:"â¤ï¸",tiers:[
        {level:3,label:"Locker Room",bonus:{moraleMod:0.8},desc:"-20% morale drain"},
        {level:6,label:"Unity",bonus:{moraleMod:0.6,chemBoost:5},desc:"-40% drain, +5 chemistry"},
        {level:9,label:"Brotherhood",bonus:{moraleMod:0.4,chemBoost:10},desc:"-60% drain, +10 chem"}
      ]},
      {id:"clutch_coach",name:"Clutch Coach",icon:"ðŸŽ¯",tiers:[
        {level:3,label:"Ice Water",bonus:{clutchBoost:3},desc:"+3 clutch rating boost"},
        {level:6,label:"Big Game",bonus:{clutchBoost:5,playoffMod:1.05},desc:"+5 clutch, +5% playoffs"},
        {level:9,label:"Mr. February",bonus:{clutchBoost:8,playoffMod:1.10},desc:"+8 clutch, +10% playoffs"}
      ]}
    ]},
    Disciplinarian:{branches:[
      {id:"iron_d",name:"Iron Defense",icon:"ðŸ›¡ï¸",tiers:[
        {level:3,label:"Lockdown",bonus:{defMod:2},desc:"+2% defensive efficiency"},
        {level:6,label:"Fortress",bonus:{defMod:3,pressureBoost:0.02},desc:"+3% def, +2% pressure"},
        {level:9,label:"Shutdown",bonus:{defMod:5,intBoost:0.02},desc:"+5% def, +2% INT rate"}
      ]},
      {id:"special_teams",name:"Special Teams Ace",icon:"âš¡",tiers:[
        {level:3,label:"Coverage",bonus:{stMod:2},desc:"+2% ST efficiency"},
        {level:6,label:"Return Game",bonus:{stMod:3,fieldPosMod:3},desc:"+3% ST, +3 field position"},
        {level:9,label:"Hidden Yards",bonus:{stMod:5,fieldPosMod:5},desc:"+5% ST, +5 field position"}
      ]},
      {id:"conditioning",name:"Conditioning",icon:"ðŸ’ª",tiers:[
        {level:3,label:"Iron Man",bonus:{injMod:0.85},desc:"-15% injury risk"},
        {level:6,label:"Recovery",bonus:{injMod:0.75,recoveryBoost:1},desc:"-25% injury, +1wk recovery"},
        {level:9,label:"Machine",bonus:{injMod:0.60,recoveryBoost:2},desc:"-40% injury, +2wk recovery"}
      ]}
    ]}
  },
  getTreeKey:function(arch){
    if(["Strategist","QB Guru","Air Attack","Innovator"].indexOf(arch)>=0)return "Strategist";
    if(["Motivator","Player's Coach","DB Whisperer"].indexOf(arch)>=0)return "Motivator";
    return "Disciplinarian";
  },
  getActiveBonus:function(selections,coachId,coachLevel,arch){
    var sel=selections[coachId];if(!sel)return{};
    var treeKey=COACH_SKILL_TREE.getTreeKey(arch||sel.archForLookup||"Disciplinarian");
    var tree=COACH_SKILL_TREE.trees[treeKey];if(!tree)return{};
    var branch=null;tree.branches.forEach(function(b){if(b.id===sel.branch)branch=b;});
    if(!branch)return{};
    var bonus={};
    branch.tiers.forEach(function(t,ti){
      if(coachLevel>=t.level&&sel.tier>ti){
        Object.keys(t.bonus).forEach(function(k){bonus[k]=(bonus[k]||0)+(typeof t.bonus[k]==="number"?t.bonus[k]:0);});
      }
    });
    return bonus;
  }
};
var OWNER_PATIENCE={
  drainRate:{win_now:8,patient_builder:3,profit_first:5,fan_favorite:6,legacy_builder:4},
  gainRate:{win_now:12,patient_builder:6,profit_first:8,fan_favorite:10,legacy_builder:8},
  tick:function(current,owner,team,won,isPlayoffs){
    if(!owner||!owner.archetypeId)return current;
    var arch=owner.archetypeId;
    var drain=OWNER_PATIENCE.drainRate[arch]||5;
    var gain=OWNER_PATIENCE.gainRate[arch]||8;
    var delta=0;
    if(won){delta=isPlayoffs?gain*1.5:gain;}else{delta=isPlayoffs?-drain*2:-drain;}
    if(won&&(team.streak||0)>=3)delta+=4;
    if(!won&&(team.streak||0)<=-3)delta-=4;
    return Math.max(0,Math.min(100,current+delta));
  },
  status:function(patience){
    if(patience>=85)return{label:"ECSTATIC",color:"#4ade80",emoji:"ðŸ¤©",desc:"Owner is throwing money at problems.",barColor:"#4ade80"};
    if(patience>=65)return{label:"PLEASED",color:"#60a5fa",emoji:"ðŸ˜Š",desc:"Owner is happy. Business as usual.",barColor:"#60a5fa"};
    if(patience>=45)return{label:"WATCHING",color:"#fbbf24",emoji:"ðŸ˜",desc:"Owner is paying attention. Better perform.",barColor:"#fbbf24"};
    if(patience>=25)return{label:"IMPATIENT",color:"#f97316",emoji:"ðŸ˜ ",desc:"Owner is losing faith. Heat is rising.",barColor:"#f97316"};
    if(patience>=10)return{label:"FURIOUS",color:"#ef4444",emoji:"ðŸ”¥",desc:"DANGER: One more bad week triggers a meeting.",barColor:"#ef4444"};
    return{label:"CRISIS",color:"#7f1d1d",emoji:"ðŸ’€",desc:"OWNER MEETING INCOMING. Career on the line.",barColor:"#dc2626"};
  }
};
var OWNER_CONFIDENCE_ARC={
  stages:[
    {id:"PATIENT",min:70,emoji:"ðŸŸ¢",color:"#4ade80",heat:"#16a34a",desc:"Owner trusts the plan and gives you runway."},
    {id:"RESTLESS",min:50,emoji:"ðŸŸ¡",color:"#facc15",heat:"#f59e0b",desc:"Owner needs proof. Results must trend up soon."},
    {id:"DEMANDING",min:30,emoji:"ðŸŸ ",color:"#fb923c",heat:"#ea580c",desc:"Owner expects immediate results and visible action."},
    {id:"ULTIMATUM",min:0,emoji:"ðŸ”´",color:"#ef4444",heat:"#dc2626",desc:"One more bad stretch can trigger major consequences."}
  ],
  normalize:function(v,fallback){
    if(typeof v!=="number"||!isFinite(v))return fallback;
    return Math.max(0,Math.min(100,v));
  },
  score:function(patience,mood){
    var p=OWNER_CONFIDENCE_ARC.normalize(patience,50);
    var m=OWNER_CONFIDENCE_ARC.normalize(mood,70);
    return Math.round(p*0.65+m*0.35);
  },
  get:function(patience,mood){
    var score=OWNER_CONFIDENCE_ARC.score(patience,mood);
    var stage=OWNER_CONFIDENCE_ARC.stages[OWNER_CONFIDENCE_ARC.stages.length-1];
    for(var i=0;i<OWNER_CONFIDENCE_ARC.stages.length;i++){
      var s=OWNER_CONFIDENCE_ARC.stages[i];
      if(score>=s.min){stage=s;break;}
    }
    var severity=stage.id==="PATIENT"?0:stage.id==="RESTLESS"?1:stage.id==="DEMANDING"?2:3;
    var nextTarget=stage.id==="PATIENT"?null:(stage.id==="RESTLESS"?70:(stage.id==="DEMANDING"?50:30));
    var heat=Math.max(0,Math.min(100,100-score));
    return{id:stage.id,label:stage.id,emoji:stage.emoji,color:stage.color,heatColor:stage.heat,desc:stage.desc,
      score:score,heat:heat,severity:severity,nextTarget:nextTarget};
  },
  transition:function(prevArc,nextArc){
    if(!prevArc||!nextArc||prevArc.id===nextArc.id)return null;
    var gotWorse=nextArc.severity>prevArc.severity;
    if(gotWorse){
      return{color:nextArc.id==="ULTIMATUM"?"red":"orange",
        text:"ðŸ”¥ Owner confidence drops to "+nextArc.id+" ("+nextArc.score+"). "+nextArc.desc};
    }
    return{color:"green",text:"âœ… Owner confidence improves to "+nextArc.id+" ("+nextArc.score+")."};
  }
};
var OWNER_CONSEQUENCES={
  ultimatums:[
    {id:"trade_worst",label:"Trade your worst contract within 3 weeks",desc:"Move your highest-paid underperformer.",
      check:function(team,startRoster,currentRoster){
        if(!startRoster||!currentRoster)return false;
        var startIds={};startRoster.forEach(function(p){startIds[p.id]=true;});
        return currentRoster.some(function(p){return !startIds[p.id];})||currentRoster.length<startRoster.length;
      }},
    {id:"fire_coord",label:"Fire a coordinator immediately",desc:"Replace your OC or DC.",
      check:function(team,startStaff,currentStaff){
        if(!startStaff||!currentStaff)return false;
        return(currentStaff.oc&&startStaff.oc&&currentStaff.oc.id!==startStaff.oc.id)||(currentStaff.dc&&startStaff.dc&&currentStaff.dc.id!==startStaff.dc.id);
      }},
    {id:"cut_payroll",label:"Cut $8M in payroll within 3 weeks",desc:"Release expensive players to show fiscal responsibility.",
      check:function(team,startCap,currentCap){return(startCap-currentCap)>=8;}}
  ],
  generateUltimatums:function(rng2){
    var shuffled=OWNER_CONSEQUENCES.ultimatums.slice();
    for(var i=shuffled.length-1;i>0;i--){var j=Math.floor(rng2()*(i+1));var t=shuffled[i];shuffled[i]=shuffled[j];shuffled[j]=t;}
    return shuffled.slice(0,3);
  },
  furiousPenalties:[
    {id:"fa_tax",label:"Owner restricts free agency spending",effect:{faMod:1.25}},
    {id:"trade_penalty",label:"Owner limits trade flexibility",effect:{tradeMod:1.20}},
    {id:"budget_cut",label:"Owner slashes operations budget",effect:{cashMod:0.85}}
  ],
  watchingMessages:[
    "Owner sent a text: 'We need to talk about this team.'",
    "Owner was seen meeting with other coaching candidates.",
    "Local media reports ownership is 'evaluating all options.'",
    "Owner skipped the last home game. Sources say patience is thin."
  ]
};
var MENTOR_SYSTEM={
  posGroups:{QB:["QB"],RB:["RB"],WR:["WR","TE"],OL:["OL"],DL:["DL"],LB:["LB"],DB:["CB","S"]},
  getGroup:function(pos){var keys=Object.keys(MENTOR_SYSTEM.posGroups);for(var i=0;i<keys.length;i++){if(MENTOR_SYSTEM.posGroups[keys[i]].indexOf(pos)>=0)return keys[i];}return null;},
  isMentorEligible:function(p){return p.age>=30&&p.ovr>=75&&!(p.injury&&p.injury.games>0)&&p.isStarter;},
  isMenteeEligible:function(p){return p.age<=23&&p.ovr>=55&&p.pot>(p.ovr+5)&&!(p.injury&&p.injury.games>0);},
  canPair:function(mentor,mentee){return MENTOR_SYSTEM.getGroup(mentor.pos)===MENTOR_SYSTEM.getGroup(mentee.pos)&&mentor.id!==mentee.id;},
  weeklyBonus:function(mentor,mentee){if(!mentor||!mentee)return 0;var ovrGap=mentor.ovr-mentee.ovr;return ovrGap>=25?2.5:ovrGap>=15?1.8:ovrGap>=10?1.2:0.8;},
  applyWeekly:function(mentorships,roster){
    Object.keys(mentorships||{}).forEach(function(mentorId){
      var menteeId=mentorships[mentorId];
      var mentor=roster.find(function(p){return p.id===mentorId;});
      var mentee=roster.find(function(p){return p.id===menteeId;});
      if(!mentor||!mentee)return;
      var bonus=MENTOR_SYSTEM.weeklyBonus(mentor,mentee);
      if(mentor._arcState===NARRATIVE_STATES.MENTOR)bonus+=0.35;// small weekly arc synergy bonus
      mentee.pot=Math.min(99,mentee.pot+0.05);
      if(mentor.devTrait==="superstar")mentee._mentorBonus=(mentee._mentorBonus||0)+bonus*1.3;
      else mentee._mentorBonus=(mentee._mentorBonus||0)+bonus;
    });
  },
  retirementBoost:function(mentor,mentee){
    if(!mentor||!mentee)return;
    mentee.morale=Math.min(99,(mentee.morale||70)+8);
    mentee.pot=Math.min(99,mentee.pot+3);
    mentee._legacyMentor=mentor.name;
  }
};
// v99.3 â€” ChatGPT: Draft Analyst Expansion + War Room + Post-Draft Grades
var DRAFT_ANALYST_993 = {   rodPemberton: {     steal: [       "ROD PEMBERTON IS LOSING HIS MIND! [TEAM] just got [PLAYER] at [ROUND] and the rest of the league is going to regret letting it happen!",       "THIS IS A THEFT. Somebody call the authorities â€” [TEAM] just stole [PLAYER]. That is unreal value at [ROUND]!",       "I'M ON MY FEET! [PLAYER] is a game-changer and [TEAM] just got him like it's a clearance sale at [ROUND]!",       "ROD'S OFF THE CHAIR! [PLAYER] should not be available here â€” [TEAM] just won the draft for the next 10 minutes!",       "Thatâ€™s the kind of pick that flips a franchise. [TEAM] didnâ€™t just draft [PLAYER] â€” they drafted hope at [ROUND]!",       "ARE YOU KIDDING ME?! [PLAYER] at [ROUND] is a highlight reel waiting to happen. [TEAM] just printed money!",       "This is why you stay patient. [TEAM] waited, stayed calm, and then BOOM â€” [PLAYER] falls into their lap at [ROUND]!",       "ROD'S SCREAMING IN THE WAR ROOM! [PLAYER] brings fireworks, and [TEAM] just lit the fuse at [ROUND]!",       "That's a steal with sirens on it. [TEAM] got [PLAYER] and everyone else is staring at their board like it betrayed them.",       "I said it before any workouts, I said it after the tape: [PLAYER] is DIFFERENT. [TEAM] just got him at [ROUND]."     ],     reach: [       "People are calling it a reach â€” I call it conviction. [TEAM] went up and got THEIR guy in [PLAYER]. Respect it.",       "Reach? Nah. You donâ€™t get elite traits by waiting for permission. [TEAM] swung on [PLAYER] at [ROUND] and I love it.",       "Sometimes you draft the league before the league catches up. [PLAYER] is that kind of pick for [TEAM].",       "If [TEAM] believes [PLAYER] fits their identity, then take him. Draft boards donâ€™t win games â€” players do.",       "Look, I get the value charts. But [PLAYER] has juice. [TEAM] just drafted juice at [ROUND].",       "Everyone wants to be 'safe' on draft night. [TEAM] wasnâ€™t safe â€” they were bold. [PLAYER] can pay that off.",       "If [PLAYER] hits, nobody will remember the word 'reach.' They'll remember touchdowns and chaos for defenses.",       "Iâ€™m defending this one. [TEAM] didnâ€™t panic â€” they targeted [PLAYER]. Thatâ€™s how you build a roster."     ],     need: [       "Perfect need fit. [TEAM] had a hole, and [PLAYER] just filled it with concrete and rebar at [ROUND].",       "Thatâ€™s roster math. [TEAM] needed this exact type of player, and [PLAYER] checks that box loud and clear.",       "This is what smart teams do: identify the weakness, attack it, and do it with a real prospect like [PLAYER].",       "You canâ€™t patch a leak with a wish. [TEAM] used [ROUND] to fix the leak with [PLAYER].",       "Thatâ€™s a starter pathway pick. [TEAM] needed snaps, and [PLAYER] is going to earn snaps fast.",       "Need and talent met at the altar and got married. [TEAM] and [PLAYER] is a clean fit.",       "Thatâ€™s not forcing it â€” thatâ€™s addressing reality. [TEAM] had a need and [PLAYER] solves it.",       "This pick makes the depth chart make sense. [TEAM] gets [PLAYER] and the lineup looks better instantly."     ],     value: [       "Value, value, value. [TEAM] didnâ€™t chase the noise â€” they took [PLAYER] where it makes sense at [ROUND].",       "[PLAYER] at [ROUND] is like finding an upgrade button for free. [TEAM] just got better without overthinking it.",       "Thatâ€™s the sweet spot: good player, good price. [TEAM] just executed the draft like adults.",       "I love this kind of pick. Not flashy on the ticker, but [PLAYER] helps you win games for [TEAM].",       "This is how you build depth that becomes starters. [TEAM] grabbed [PLAYER] and thatâ€™s long-term value.",       "[TEAM] played the board, not the room. [PLAYER] at [ROUND] is strong value relative to the class.",       "This is one of those picks you celebrate in December. [PLAYER] is a value play that turns into real production.",       "Clean value. You donâ€™t need fireworks every pick â€” you need hits. [PLAYER] is a hit candidate for [TEAM]."     ],     injuryConcern: [       "Iâ€™m not ignoring it, but Iâ€™m not panicking. [PLAYER] is here to play, and [TEAM] clearly feels good about the medicals.",       "Injuries happen. The question is recovery and mindset â€” [PLAYER] looks like a fighter, and [TEAM] is betting on that.",       "If [PLAYER] was a long-term issue, he wouldnâ€™t be going here. [TEAM] did their homework â€” Iâ€™m not worried.",       "People hear 'medical flag' and they get scared. Sometimes itâ€™s just history, not destiny. [PLAYER] can roll.",       "[TEAM] wouldnâ€™t draft a ghost. They drafted [PLAYER] because they expect him on the field. End of story.",       "Iâ€™ve seen guys come back stronger. If [PLAYER] gets the right plan, [TEAM] just got a motivated monster.",       "This is where championships are won â€” taking calculated risks. [PLAYER] at [ROUND] is a calculated risk I can live with.",       "Iâ€™m downplaying it because I trust the pick: [TEAM] wants [PLAYER], and they know more than the internet does."     ],     characterConcern: [       "Let me say this: people grow. If [TEAM] talked to [PLAYER] and believe in the person, Iâ€™m not throwing stones.",       "The 'character' label gets slapped on guys too easily. [PLAYER] is a football player â€” let him prove it with work.",       "[TEAM] has vets, leaders, structure. If [PLAYER] needs direction, this is a place that can provide it.",       "Iâ€™m defending the kid. Everybodyâ€™s got a chapter theyâ€™re not proud of. [PLAYER] deserves a chance to write the next one.",       "Draft night is about talent and fit â€” [TEAM] thinks [PLAYER] fits. That matters more than anonymous whispers.",       "If [PLAYER] shows up and grinds, the 'concern' becomes a footnote. [TEAM] just took a swing on upside.",       "People want perfect humans. Football teams want competitors. [PLAYER] competes â€” [TEAM] bet on that.",       "This can be a turning point for [PLAYER]. A fresh start, real accountability, and a real opportunity with [TEAM]."     ],     sleeperAlert: [       "SLEEPER ALERT! [PLAYER] is the kind of guy you remember by midseason and wonder why he lasted until [ROUND].",       "This is a Day 3 type of pick that becomes a Day 1 contributor. [TEAM] found a gem in [PLAYER].",       "Iâ€™m flagging it now: [PLAYER] is going to outplay his draft slot. [TEAM] just got a sleeper with teeth.",       "Watch the energy on this pick. [PLAYER] has that 'chip' vibe â€” [TEAM] might have found a future starter.",       "Sleeper alert means: coaches are going to love him. [PLAYER] does the little things and [TEAM] needs that.",       "Some prospects donâ€™t sparkle at events â€” they sparkle on Sundays. [PLAYER] is that guy for [TEAM].",       "[TEAM] just drafted a player that fans will chant for later. [PLAYER] is a sleeper Iâ€™m pounding the table for.",       "Keep receipts: [PLAYER] is a sleeper, and [TEAM] is going to look smart when heâ€™s making big plays."     ],     bustAlert: [       "I hate saying it, but Iâ€™m a little worried. [PLAYER] has to prove he can translate his game for [TEAM].",       "This pick makes me nervous. If [PLAYER] doesnâ€™t adapt fast, [TEAM] might be staring at a tough outcome.",       "I see the upside, but the floor is real. [PLAYER] has to clean up the details or this gets rough for [TEAM].",       "Iâ€™m not calling it a bust, but Iâ€™m raising an eyebrow. [PLAYER] needs the right coaching and patience from [TEAM].",       "This is the rare time Iâ€™m cautious: [PLAYER] has to show consistency. [TEAM] is betting heavy on projection.",       "I want to love it, but I canâ€™t pretend: [PLAYER] has bust risk if the weaknesses stay. [TEAM] better have a plan."     ]   },    dianeHolloway: {     steal: [       "From a film standpoint, [PLAYER] should not be available at [ROUND]. The technique, processing, and repeatability are starter-level.",       "[TEAM] got a player whose tape shows consistent wins. [PLAYER] understands leverage and executes with discipline â€” thatâ€™s value.",       "This is a classic 'the board came to you' scenario. [PLAYER] has a clean projection because the fundamentals are already there.",       "I like the floor here. [PLAYER] plays with controlled feet and reliable hand placement. That translates in most schemes for [TEAM].",       "The best part is how consistent the tape is. [PLAYER] doesnâ€™t live on one highlight â€” he stacks good reps for [TEAM].",       "[PLAYER] at [ROUND] is a steal because his losing reps are teachable, and his winning reps are repeatable.",       "[TEAM] is getting a prospect whose technique holds under pressure. Thatâ€™s a strong indicator for early contribution.",       "Heâ€™s not just 'athletic' â€” [PLAYER] is functional. The film shows timing, angles, and finishing. Thatâ€™s a steal.",       "This pick makes sense because [PLAYER] wins in multiple ways on tape. [TEAM] wonâ€™t have to force-feed a role.",       "Thereâ€™s a clear pro translation here. [PLAYER] consistently plays within structure, and thatâ€™s why this is a steal for [TEAM]."     ],     reach: [       "I understand why some will label it a reach. The tape on [PLAYER] has flashes, but the down-to-down detail is still developing.",       "If [TEAM] is taking [PLAYER] at [ROUND], theyâ€™re betting on traits over refinement. That can work, but itâ€™s not risk-free.",       "The question is role clarity. [PLAYER] needs a defined usage plan; otherwise, youâ€™re asking the film to improve on faith.",       "On tape, [PLAYER] wins when the situation is favorable. The challenge will be winning when defenses adjust â€” [TEAM] must coach it.",       "This isnâ€™t a bad player, but the projection requires growth. [TEAM] is accelerating the timeline by taking [PLAYER] at [ROUND].",       "The athletic profile is evident, yet the technique is inconsistent. Thatâ€™s where the 'reach' label comes from for [PLAYER].",       "If [TEAM] has a specific schematic reason, I can see it. Without that, [PLAYER] at [ROUND] is earlier than the film suggests.",       "Iâ€™d call it aggressive. [PLAYER] can justify it, but it hinges on development in the parts of the game the film flags."     ],     need: [       "This addresses a roster need, but I like that it also aligns with what [PLAYER] actually does well on film.",       "Need picks work when the skill set matches the job. [PLAYER] has tape that supports the role [TEAM] likely has in mind.",       "Itâ€™s not just 'need' â€” itâ€™s fit. [PLAYER] plays with the type of technique that supports quick integration for [TEAM].",       "A need pick can be dangerous when forced. This doesnâ€™t feel forced; [PLAYER] has a legitimate pathway to snaps for [TEAM].",       "The film says [PLAYER] can handle the responsibilities that [TEAM] is missing. Thatâ€™s a strong need match at [ROUND].",       "You can see the problem [TEAM] is solving. [PLAYER] brings specific tools that directly address it.",       "This pick makes the depth chart cleaner. [PLAYER] fits the missing profile, and the tape supports early contribution.",       "[TEAM] didnâ€™t just draft a name â€” they drafted a skill set. [PLAYER] is a need fit with film-based justification."     ],     value: [       "Value here is rooted in translatable technique. [PLAYER] shows repeatable mechanics and that lowers risk for [TEAM].",       "I like this pick because [PLAYER] doesnâ€™t rely on unusual conditions to succeed. The film shows sustainable wins at [ROUND].",       "The processing and angles are a big part of the value. [PLAYER] plays fast mentally, which matters for [TEAM].",       "This is a good example of value beyond raw traits. [PLAYER] has timing and discipline on tape that often gets overlooked.",       "The footwork stays clean, even when the play breaks down. That makes [PLAYER] a strong value selection for [TEAM].",       "Value isnâ€™t just draft slot â€” itâ€™s role certainty. [PLAYER] has a defined role projection in this range for [TEAM].",       "[PLAYER] at [ROUND] offers a good blend of floor and ceiling based on what heâ€™s already doing correctly on film.",       "This is a professional pick. [TEAM] took [PLAYER] where the tape and projection intersect â€” thatâ€™s value."     ],     injuryConcern: [       "The medical component matters here. If [PLAYER] has a recurring soft-tissue issue, the re-injury risk is something teams plan around.",       "Iâ€™m looking at availability as a trait. [TEAM] needs to be comfortable that [PLAYER] can stack weeks without setbacks.",       "When a prospect has a documented injury history, the question is function: does the tape show compensation or hesitation for [PLAYER]?",       "If [PLAYER] had a past ligament issue, the stability and cutting mechanics matter. Iâ€™ll be watching how [TEAM] manages workload.",       "Medical flags arenâ€™t automatic red lights, but they are risk multipliers. [PLAYER] will need a thoughtful ramp-up with [TEAM].",       "If the issue is chronic rather than acute, it changes the projection. [TEAM] is likely betting the current baseline is sustainable.",       "The film can sometimes reveal health concerns through altered stride or reduced burst. With [PLAYER], the evaluation depends on the most recent tape.",       "Iâ€™m not alarmist, but Iâ€™m precise: [TEAM] is drafting talent plus a medical plan. [PLAYER] must be available to justify [ROUND]."     ],     characterConcern: [       "We donâ€™t have full context publicly, but teams do extensive background. [TEAM] likely vetted [PLAYER] beyond surface narratives.",       "Character questions become football questions if they affect preparation. The key is whether [PLAYER] has demonstrated consistent habits.",       "A locker room fit is real. [TEAM] is betting that [PLAYER] can align with their culture and routine.",       "If the concerns are maturity-based, structure can help. [PLAYER] will be evaluated quickly by teammates and coaches.",       "I try to separate rumor from pattern. If [TEAM] drafted [PLAYER], they likely believe the issue is manageable.",       "Accountability is the swing factor. [PLAYER] can silence concerns with punctuality, practice habits, and role acceptance for [TEAM].",       "Some prospects need clarity and support. If [TEAM] provides that, [PLAYER] can stabilize and develop.",       "This is a case where weâ€™ll learn the truth through consistency. [TEAM] is making a bet on the person as well as the player."     ],     sleeperAlert: [       "The sleeper case for [PLAYER] is film-based: he consistently executes details that typically earn early playing time.",       "If you watch the tape, [PLAYER] is often doing the correct thing even when it doesnâ€™t show up in the stat line. [TEAM] will value that.",       "I like sleepers who win with technique. [PLAYER] has that profile, and [TEAM] can plug him into a role quickly.",       "The release, footwork, or leverage â€” whichever applies â€” is more advanced than the draft slot suggests for [PLAYER].",       "A sleeper becomes real when the mental processing is fast. [PLAYER] plays with urgency and recognition on film for [TEAM].",       "[PLAYER] doesnâ€™t have to become a different player to contribute. He can be himself and still help [TEAM] at [ROUND].",       "This is the kind of prospect coaches trust because the assignment discipline is strong. [PLAYER] is a sleeper for [TEAM].",       "Thereâ€™s hidden value in consistency. [PLAYER] stacks good reps, and thatâ€™s how sleepers carve out roles for [TEAM]."     ],     bustAlert: [       "The bust path here is role mismatch. If [TEAM] asks [PLAYER] to do things the film doesnâ€™t support, the learning curve gets steep.",       "Consistency is the concern. If [PLAYER] canâ€™t repeat his technique under stress, then the projection becomes fragile for [TEAM].",       "If the athletic traits donâ€™t translate against faster competition, [PLAYER] may struggle early. Thatâ€™s the risk at [ROUND].",       "The film shows some correctable issues, but they must be corrected. If they arenâ€™t, [TEAM] may not get the expected return.",       "This is about adaptation speed. If [PLAYER] is slow to adjust to pro coaching and pro complexity, the bust risk increases.",       "Iâ€™m not calling it doomed â€” Iâ€™m saying the margin is thin. [TEAM] needs [PLAYER] to develop the flagged areas quickly."     ]   },    marcusSteele: {     steal: [       "Fine. Iâ€™ll admit it: [PLAYER] at [ROUND] is a steal. It hurts to say, but [TEAM] got real value.",       "This is one of the few times the room and the board agree. [PLAYER] shouldâ€™ve been gone earlier â€” [TEAM] benefited.",       "I donâ€™t love everything, but at this price? [TEAM] did well. [PLAYER] is a strong value relative to expectation.",       "Yes, itâ€™s a steal â€” but donâ€™t crown anyone yet. [PLAYER] still has to translate for [TEAM].",       "You donâ€™t see clean wins like this often. [TEAM] got [PLAYER] at [ROUND] and thatâ€™s objectively good business.",       "Iâ€™ll give credit where itâ€™s due. [TEAM] didnâ€™t overthink it. They took [PLAYER] and the value is obvious.",       "This is why teams hoard picks. Someone always falls. This time itâ€™s [PLAYER], and [TEAM] profited.",       "Itâ€™s a steal on paper and likely on the field â€” assuming [PLAYER] does the boring stuff right for [TEAM].",       "Iâ€™m grudgingly impressed. [TEAM] got [PLAYER] and didnâ€™t have to trade anything crazy to do it at [ROUND].",       "Thatâ€™s a good pick. Iâ€™m not clapping, but Iâ€™m not arguing either. [PLAYER] at [ROUND] is a steal for [TEAM]."     ],     reach: [       "Thatâ€™s a reach, and Iâ€™m not sugarcoating it. [TEAM] took [PLAYER] earlier than the profile warrants.",       "This is how you lose value in a draft. [TEAM] couldâ€™ve waited and still gotten [PLAYER].",       "I donâ€™t like it. [PLAYER] has real questions, and [TEAM] just paid a premium at [ROUND] to answer them.",       "The board was offering better options. [TEAM] ignored them to take [PLAYER]. Thatâ€™s a reach.",       "You can call it 'their guy' â€” I call it unnecessary risk. [PLAYER] at [ROUND] is aggressive in the wrong way.",       "If [PLAYER] hits, great. But the probability says [TEAM] overreached based on what we know.",       "This is the kind of pick that gets defended on draft night and regretted by Week 10 if the flaws show up.",       "Reach picks can work, but this one has too many 'ifs.' [TEAM] is betting big on [PLAYER] at [ROUND]."     ],     need: [       "Sure, it fills a need â€” but you canâ€™t draft purely out of panic. [TEAM] better be right about [PLAYER].",       "Need pick, fine. But need picks turn ugly when you ignore value. [TEAM] drafted [PLAYER] and now the pressureâ€™s on.",       "This makes sense for the depth chart, but the question is whether [PLAYER] is the correct solution or just the available one.",       "I see the rationale: [TEAM] needed help. I also see the risk: [PLAYER] has to be ready faster than some prospects are.",       "Need fit is real, but so is competition level. [TEAM] will find out quickly if [PLAYER] can handle the jump.",       "If [PLAYER] is a plug-and-play, this is great. If heâ€™s a project, [TEAM] just drafted a need they canâ€™t cash immediately.",       "The need is obvious. The evaluation must be honest. [TEAM] took [PLAYER] and now they must develop him correctly.",       "It checks a box, but boxes donâ€™t win. [PLAYER] has to become production for [TEAM], not just a label."     ],     value: [       "Value depends on what youâ€™re buying. [TEAM] bought [PLAYER] at [ROUND] â€” the question is whether the weaknesses are fixable.",       "On paper, itâ€™s value. In reality, value is earned on Sundays. [PLAYER] has to prove it for [TEAM].",       "I like the spot more than I like the player. [PLAYER] at [ROUND] is fine â€” assuming the translation holds.",       "This is the range where you take swings. [TEAM] swung on [PLAYER]. If the swing skill improves, itâ€™s value.",       "Value is nice, but fit matters. If [TEAM] uses [PLAYER] incorrectly, this 'value' turns into dead snaps.",       "Iâ€™ll call it value with caution. [PLAYER] has upside, but thereâ€™s a reason he was still on the board at [ROUND].",       "This is a value pick if [PLAYER] becomes consistent. If not, [TEAM] just drafted a roster puzzle piece that doesnâ€™t fit.",       "The cost is right. The outcome isnâ€™t guaranteed. [TEAM] got [PLAYER] at [ROUND] and now they need development to hit."     ],     injuryConcern: [       "Iâ€™m alarmed. When a prospect has repeated issues, itâ€™s not bad luck â€” itâ€™s a pattern. [TEAM] is taking a risk with [PLAYER].",       "Availability matters, and [PLAYER] hasnâ€™t proven he can stack seasons. [TEAM] needs to plan for missed time.",       "This isnâ€™t just a small flag. If the medical history includes recurrence, thatâ€™s a major concern for [PLAYER] at [ROUND].",       "I worry about soft tissue recurrences and workload tolerance. [TEAM] drafting [PLAYER] means they accept that risk.",       "If [PLAYER] has had multiple setbacks, the body might be telling the truth. [TEAM] is betting against biology.",       "Injuries change development arcs. If [PLAYER] misses camp reps, [TEAM] loses the most valuable teaching time.",       "I hate it for the player, but itâ€™s reality: injury history can shrink ceilings. [TEAM] is hoping [PLAYER] is the exception.",       "This pick could look smart or could look like a medical regret. [PLAYER] must stay on the field for [TEAM] to justify it.",       "The risk isnâ€™t just 'missing games' â€” itâ€™s losing explosiveness. If [PLAYER] loses a step, [TEAM] loses the whole bet.",       "Iâ€™m not optimistic on this one. [TEAM] might have drafted talent that canâ€™t stay available. [PLAYER] has to prove durability."     ],     characterConcern: [       "Iâ€™m very concerned. If the background suggests inconsistent habits, thatâ€™s a roster problem, not just a PR problem for [TEAM].",       "Character flags arenâ€™t gossip â€” theyâ€™re predictive when they affect preparation. [PLAYER] must show accountability fast.",       "Teams can manage talent. They canâ€™t manage chaos. If [PLAYER] brings chaos, [TEAM] will regret this pick.",       "I donâ€™t love gambling on maturity. [TEAM] is betting they can change [PLAYER]. Thatâ€™s a risky bet at [ROUND].",       "If thereâ€™s a pattern of missed responsibilities, that doesnâ€™t magically vanish. [TEAM] needs safeguards around [PLAYER].",       "The locker room cost is real. One distraction can drain a season. [TEAM] better be confident about [PLAYER].",       "You canâ€™t outcoach a lack of buy-in. If [PLAYER] doesnâ€™t buy in, [TEAM] is wasting development time and snaps.",       "I hope it works, but Iâ€™m skeptical. [TEAM] drafted [PLAYER] and now theyâ€™re responsible for the outcome off the field too.",       "This is not the kind of risk I like. If leadership has to babysit [PLAYER], [TEAM] loses focus and cohesion.",       "Iâ€™ll say it plainly: if the concerns are real, this pick can blow up. [TEAM] needs [PLAYER] to be professional immediately."     ],     sleeperAlert: [       "I donâ€™t throw 'sleeper' around, but [PLAYER] has a path. If he learns quickly, [TEAM] got real value at [ROUND].",       "This is a sleeper if the processing speed translates. [PLAYER] has some traits that are easy to build on for [TEAM].",       "I can see it: [PLAYER] can outplay his slot if he fixes one or two key issues. Thatâ€™s sleeper potential for [TEAM].",       "The reason I like this sleeper call is role clarity. [TEAM] can use [PLAYER] in a defined way early.",       "Not perfect, but intriguing. [PLAYER] at [ROUND] is the kind of pick that becomes a starter when development clicks.",       "If [PLAYER] embraces coaching, heâ€™ll make this board look silly. [TEAM] might have found a sleeper with real upside.",       "The tools are there. The question is consistency. If [PLAYER] becomes consistent, [TEAM] wins the late rounds.",       "Iâ€™m cautiously calling it: sleeper candidate. [PLAYER] has a realistic path to meaningful snaps for [TEAM]."     ],     bustAlert: [       "Bust alert. The production might be loud, but the translation risk is louder. [TEAM] drafted [PLAYER] and I see warning signs.",       "Iâ€™ve seen this story before: big numbers, easy reps, and then the pro game exposes the gaps. [PLAYER] has that risk.",       "If [PLAYER] canâ€™t win against better technique and speed, the learning curve will be brutal for [TEAM].",       "This is a bust path if the weaknesses are fundamental. [TEAM] needs [PLAYER] to improve quickly or it gets ugly.",       "Some players peak in college systems. If [PLAYER] is system-dependent, [TEAM] just drafted a mirage at [ROUND].",       "If [PLAYER] canâ€™t handle complexity, heâ€™ll play slow. Playing slow in the pros is how careers vanish. Bust risk.",       "Iâ€™m not wishing it â€” Iâ€™m forecasting it: if [PLAYER] doesnâ€™t adapt, [TEAM] will be drafting the same position next year.",       "This pick has bust potential because the floor is lower than people want to admit. [TEAM] better have a development plan."     ]   },    lenaVoss: {     steal: [       "Based on board value, [TEAM] just captured a major surplus. [PLAYER] at [ROUND] is the definition of positive expected return.",       "This is a value chart win. [TEAM] got [PLAYER] at a cost below market expectation for this prospect tier.",       "[PLAYER] falling to [ROUND] creates a surplus value pocket. [TEAM] exploited it cleanly.",       "If you model draft outcomes, this is the type of pick that improves roster efficiency. [TEAM] got [PLAYER] at a discount.",       "Steal isnâ€™t emotional â€” itâ€™s arithmetic. [TEAM] gained significant value by selecting [PLAYER] here.",       "This is how you beat the draft: take the player whose probability-weighted value exceeds the slot. [TEAM] did that with [PLAYER].",       "The opportunity cost is low and the upside is meaningful. [TEAM] just made an efficient selection with [PLAYER] at [ROUND].",       "Surplus value matters over multiple seasons. [PLAYER] at [ROUND] is a compounding advantage for [TEAM].",       "You can feel the board tension. [TEAM] stayed patient and got [PLAYER] in a high-leverage value window.",       "This pick grades as a steal because the slot cost is lower than the median outcome projection for [PLAYER]."     ],     reach: [       "By standard board values, [TEAM] paid too much. Selecting [PLAYER] at [ROUND] looks like an overpay versus consensus slotting.",       "If you translate this to value points, [TEAM] reached above the market baseline for [PLAYER]. The delta is meaningful.",       "This is an efficiency loss. [TEAM] used a higher asset than necessary to acquire [PLAYER], assuming typical availability.",       "I can justify reaches when the positional scarcity is extreme, but [PLAYER] here still reads as an overpay for [TEAM].",       "Draft capital is finite. [TEAM] spent more of it than the modeled return suggests on [PLAYER] at [ROUND].",       "If youâ€™re keeping score, [TEAM] took a negative value move. [PLAYER] might work, but the price was high.",       "This pick implies [TEAM] had [PLAYER] significantly higher than market. That can be smart â€” but the risk premium is real.",       "Value chart language: [TEAM] overpaid for [PLAYER] at [ROUND]. Now the player has to outperform the slot to break even."     ],     need: [       "Need picks can be efficient when they prevent future overpayment. [TEAM] addressing the hole now with [PLAYER] can reduce later costs.",       "Roster construction matters: if [TEAM] had to fix this position next cycle, the price likely rises. [PLAYER] at [ROUND] can be efficient.",       "From a portfolio perspective, [TEAM] is reducing volatility by filling a known weakness with [PLAYER].",       "Need plus reasonable slot cost is good process. If [PLAYER] fits, [TEAM] stabilizes a critical unit.",       "This selection suggests [TEAM] is optimizing for immediate marginal wins at the position. [PLAYER] helps that goal.",       "Need picks are fine when the value loss is small. Here, [PLAYER] at [ROUND] looks like a balanced decision for [TEAM].",       "[TEAM] is choosing certainty of role over theoretical upside elsewhere. [PLAYER] has a clear usage path.",       "This improves roster efficiency if [PLAYER] becomes a cost-controlled starter for [TEAM] across multiple seasons."     ],     value: [       "This is a value play in the purest sense: draft slot cost is below expected contribution. [TEAM] optimized the pick with [PLAYER].",       "I like the economics: [TEAM] gets [PLAYER] on a controlled contract while capturing above-slot performance probability.",       "Value is about alternatives. At [ROUND], [PLAYER] projects favorably versus the typical player available â€” thatâ€™s why I like it for [TEAM].",       "This pick has a high floor in terms of expected snaps. [TEAM] drafted [PLAYER] where the opportunity cost is manageable.",       "From an efficiency lens, [TEAM] made a disciplined selection. [PLAYER] is appropriately priced at [ROUND].",       "Value isnâ€™t always sexy. Itâ€™s stacking good decisions. [TEAM] stacking good decisions with [PLAYER] here.",       "If youâ€™re building a long-run contender, you need surplus picks. [PLAYER] at [ROUND] is a surplus candidate for [TEAM].",       "The risk-adjusted return is favorable. [TEAM] isnâ€™t betting the franchise â€” theyâ€™re buying a strong outcome distribution with [PLAYER].",       "This pick aligns with draft surplus theory: maximize expected returns per unit of capital. [TEAM] did that with [PLAYER] at [ROUND].",       "Iâ€™d call this a plus-value selection: [TEAM] captured efficiency by taking [PLAYER] in the right market window."     ],     injuryConcern: [       "Injury risk changes the distribution. The mean outcome might remain strong, but the variance increases for [PLAYER] and [TEAM].",       "Medicals function like a discount rate. [TEAM] is pricing [PLAYER] with an availability uncertainty premium at [ROUND].",       "If the injury history suggests recurrence, youâ€™re modeling missed games and delayed development. Thatâ€™s the hidden cost for [TEAM].",       "The upside remains, but the probability mass shifts downward when durability is uncertain. [TEAM] must be comfortable with that.",       "This pick is only efficient if [PLAYER] stays available. Otherwise, the expected surplus evaporates for [TEAM].",       "Injury concerns donâ€™t just reduce snaps â€” they reduce continuity and improvement rate. [TEAM] needs a plan for [PLAYER].",       "If [PLAYER] requires load management, the team-level value depends on depth. [TEAM] must support the pick structurally.",       "Iâ€™d label it: high-upside, higher-variance. [TEAM] drafted [PLAYER] knowing the injury risk widens the outcome range."     ],     characterConcern: [       "Character risk is an uncertainty multiplier. If it affects availability, focus, or development, the expected return drops for [TEAM] and [PLAYER].",       "Teams price this differently. [TEAM] is signaling they believe the downside probability is manageable for [PLAYER].",       "From an asset management view, off-field volatility can destroy value even when the talent is real. [TEAM] is accepting that risk.",       "The question is whether the risk is noise or pattern. If pattern, the pickâ€™s expected value shrinks quickly for [TEAM].",       "Culture fit is a cost center if it requires constant attention. [TEAM] believes [PLAYER] wonâ€™t become a cost center.",       "If [PLAYER] needs structure, [TEAM] must supply structure. Otherwise the value model breaks.",       "This can still be a good pick, but itâ€™s conditional. [TEAM] needs [PLAYER] to be consistent in preparation and accountability.",       "Character flags affect compounding. A talented player who doesnâ€™t develop loses the entire surplus advantage for [TEAM]."     ],     sleeperAlert: [       "Sleeper case: [PLAYER] has indicators that beat the draft slot â€” efficiency, role translation, or measurables that correlate with playing time for [TEAM].",       "This is a sleeper if usage aligns. [TEAM] can deploy [PLAYER] in high-leverage situations where his traits matter most.",       "I like sleepers whose statistical signals outpace their reputation. [PLAYER] fits that profile at [ROUND] for [TEAM].",       "The market may be mispricing [PLAYER]. If so, [TEAM] just captured an inefficiency and will benefit quickly.",       "Day 3 picks become valuable when they earn snaps. [PLAYER] has a realistic snaps pathway, which is the core sleeper argument for [TEAM].",       "This is a sleeper because the downside cost is low and the upside is meaningful. That asymmetric bet favors [TEAM].",       "If [PLAYER] hits even a median outcome, [TEAM] wins. If he outperforms median, this becomes a high-surplus sleeper.",       "Analytics angle: [PLAYER] has traits that historically outperform this draft region. [TEAM] is betting on that signal."     ],     bustAlert: [       "Bust risk rises when the projection depends on a single swing trait. If [PLAYER] doesnâ€™t improve the swing skill, [TEAM] doesnâ€™t get return on [ROUND].",       "The bust path is low adaptability. If [PLAYER] canâ€™t adjust to complexity and speed, the probability of failure increases for [TEAM].",       "This selection has a wider downside tail. [TEAM] needs development to compress that tail for [PLAYER].",       "If role translation is wrong, the asset becomes replacement-level. Thatâ€™s the bust definition, and [TEAM] must avoid it with usage.",       "Bust risk isnâ€™t doom â€” itâ€™s probability. With [PLAYER], the probability is non-trivial, and [TEAM] needs the coaching to shift it.",       "If [PLAYER] doesnâ€™t earn early snaps, the development curve often flattens. Thatâ€™s the bust pathway for [TEAM]."     ],     tradeGrade: [       "Trade grade: [TEAM] moved up for [PLAYER]. If the cost was a premium, they need starter-level impact to justify the value points spent.",       "Trade grade: If [TEAM] surrendered future capital, the break-even math requires [PLAYER] to outperform the average player at [ROUND] by a clear margin.",       "Trade grade: Moving down can be optimal. If [TEAM] added picks and still landed [PLAYER], thatâ€™s a net positive value outcome.",       "Trade grade: The value hinges on opportunity cost. If [TEAM] gave up a high-upside pick to secure [PLAYER], the trade is only good if [PLAYER] becomes a core piece.",       "Trade grade: This looks like a modest overpay unless [PLAYER] is a high-confidence projection. The capital spent raises the expectation bar for [TEAM].",       "Trade grade: If [TEAM] traded down and gained an extra selection, the portfolio improves even if [PLAYER] is merely solid.",       "Trade grade: The cleanest win is trading up without paying future premium. If [TEAM] did that for [PLAYER], I grade it favorably.",       "Trade grade: If the move cost [TEAM] multiple mid-round assets, the aggregate value loss must be offset by [PLAYER] becoming a difference-maker."     ]   } };  var WAR_ROOM_993 = [   "BREAKING: Trade talks heating up between two teams picking in the top 15.",   "SOURCES: [TEAM] has been shopping their pick for the past 20 minutes.",   "RUMOR: [PLAYER] had a private workout with [TEAM] last week â€” insiders are buzzing.",   "INTEL: Medical flags on [PLAYER] are being downplayed by his agent.",   "CLOCK DRAMA: [TEAM] is still on the phone with two offers on the table.",   "UPDATE: A surprise name is rising fast on multiple boards â€” [PLAYER] could go earlier than expected.",   "SOURCES: [TEAM] is trying to leapfrog a rival for a position run starting at [ROUND].",   "RUMOR: One front office is split â€” coaches want [PLAYER], analytics wants a trade down.",   "BREAKING: A late call just came in from [TEAM] about moving up five spots.",   "INTEL: [PLAYER] skipped a scheduled meeting earlier this week â€” teams are re-checking notes.",   "SOURCES: Two teams have identical grades on [PLAYER] â€” tiebreaker might be scheme fit.",   "RUMOR: [TEAM] is targeting a specific position and may trade up if the run starts now.",   "ALERT: A prospect expected to go earlier is still available â€” phones are lighting up.",   "BREAKING: [TEAM] has reportedly offered a future pick to move into this slot.",   "CLOCK DRAMA: The pick is not in yet â€” [TEAM] is scrambling.",   "SOURCES: [TEAM] is calling every team behind them to gauge trade value.",   "RUMOR: A surprise trade-up is being discussed to secure [PLAYER] before a rumored run.",   "INTEL: One GM called [PLAYER] 'a culture fit' â€” another called him 'a headache.'",   "BREAKING: A medical re-check request was filed on [PLAYER] minutes ago.",   "SOURCES: [TEAM] is considering a trade down even with [PLAYER] available.",   "RUMOR: A coach is pushing hard for [PLAYER] despite board value concerns.",   "ALERT: Position run may be starting â€” multiple teams are calling about moving up at [ROUND].",   "CLOCK DRAMA: [TEAM] is asking for extra time â€” league says no.",   "BREAKING: [TEAM] and [TEAM] have a framework deal; details still being negotiated.",   "INTEL: [PLAYER] impressed in whiteboard sessions â€” teams are boosting his grade late.",   "RUMOR: A prospect is sliding due to interviews, not tape. [PLAYER] could fall farther.",   "SOURCES: [TEAM] has contingency options if their top target is taken right before them.",   "BREAKING: Trade compensation includes a pick swap and an extra mid-rounder â€” big movement coming.",   "CLOCK DRAMA: The selection is delayed; announcement crew is standing by.",   "INTEL: A team doctor reportedly flagged a long-term concern on [PLAYER] â€” market reacting in real time.",   "RUMOR: [TEAM] is negotiating with two trade partners simultaneously.",   "SOURCES: [TEAM] is locked on [PLAYER] â€” unless a trade down offer becomes too good to ignore.",   "ALERT: A surprise pick just happened â€” boards across the league are being re-stacked.",   "BREAKING: [TEAM] is attempting to trade out of the round entirely for future capital.",   "INTEL: League-wide consensus has shifted; [PLAYER] is now viewed as a top-tier option at his position.",   "RUMOR: A rival team is trying to block [TEAM] by trading into their target zone.",   "SOURCES: [TEAM] is debating between need and best-available with seconds left on the clock.",   "CLOCK DRAMA: The commissioner is waiting â€” the card still not delivered.",   "BREAKING: A last-second trade offer includes multiple late picks â€” decision pending.",   "INTEL: [PLAYER] has a strong special teams projection â€” could boost his chances earlier than expected.",   "RUMOR: [TEAM] is willing to pay a premium to secure [PLAYER] right now.",   "SOURCES: A position coach just made a direct call to [PLAYER] â€” confidence is high.",   "ALERT: Another prospect is free-falling; teams are trying to determine why.",   "BREAKING: [TEAM] is on the clock and actively shopping â€” expect movement.",   "INTEL: [PLAYER] tested well in agility work; teams are re-evaluating his ceiling.",   "RUMOR: A team wants to trade down but fears losing [PLAYER] to a run.",   "SOURCES: [TEAM] has two names circled â€” decision coming down to medical confidence.",   "CLOCK DRAMA: A trade call is in progress with under 30 seconds left.",   "BREAKING: The pick is in â€” and the room looks stunned by the choice." ];  var POST_DRAFT_GRADES_993 = {   aPlus: [     "[TEAM] just turned draft capital into immediate starters and long-term upside. Thatâ€™s an A+ class by any reasonable standard.",     "A+ for [TEAM]. Clean process, strong value, and multiple picks that align with roster needs without forcing it.",     "[TEAM] dominated the board. They collected surplus value and still landed impact talent. Thatâ€™s elite draft execution.",     "This is how contenders draft. [TEAM] hit on premium positions, avoided panic, and created a coherent class identity.",     "[TEAM] left this draft with a class that can start early and develop late. A+ grade â€” efficient and dangerous."   ],   aGrade: [     "[TEAM] had a very strong weekend. Solid value, clear roster fits, and at least one pick with real star potential.",     "A grade for [TEAM]. They didnâ€™t chase noise; they drafted players who project to roles with upside.",     "[TEAM] drafted with discipline and balance. A few high-floor selections plus a couple high-ceiling swings â€” thatâ€™s good work.",     "This is a cohesive class. [TEAM] addressed weaknesses and improved depth with prospects who can earn snaps.",     "A for [TEAM]. Not perfect, but consistently smart and likely to look better as the season unfolds."   ],   bGrade: [     "B for [TEAM]. Solid, functional picks â€” not flashy, but likely to produce contributors and stabilize depth.",     "[TEAM] drafted responsibly, even if the ceiling isnâ€™t screaming. A steady class that should yield role players.",     "This is a 'good not great' class for [TEAM]. The process was fine, but the upside swings were limited.",     "B grade: [TEAM] avoided major mistakes and found a few value pockets. The question is whether they landed true difference-makers.",     "[TEAM] put together a competent class. It wonâ€™t headline reels, but it can quietly improve the roster over time."   ],   cGrade: [     "C grade for [TEAM]. A couple picks feel forced, and the value curve looks uneven across the class.",     "[TEAM] made some questionable bets. The outcomes could swing, but the process raises eyebrows.",     "This class has risk without enough surplus value to compensate. [TEAM] will need development to save the grade.",     "C for [TEAM]. The draft wasnâ€™t a disaster, but it includes decisions that could create regret if the players donâ€™t hit quickly.",     "[TEAM] left some value on the table. If the reaches donâ€™t outperform, this class will be remembered as missed opportunity."   ],   dGrade: [     "D grade for [TEAM]. The board value looks rough, and multiple picks require perfect outcomes to justify the capital spent.",     "[TEAM] took on a lot of risk without capturing enough upside. This could be a class that forces a rebuild of the rebuild.",     "This is a disaster-class profile: reaches, questionable fits, and little margin for error. D for [TEAM].",     "[TEAM] didnâ€™t maximize their capital and may have drafted problems they canâ€™t fix quickly. The process is the concern.",     "D grade. If the class doesnâ€™t develop fast, [TEAM] will be drafting for the same needs again next year."   ],   bestPickOverall: [     "Best pick overall: [TEAM] landing [PLAYER]. Thatâ€™s the kind of selection that changes the trajectory of a franchise.",     "Best pick overall goes to [TEAM] for [PLAYER]. The value, fit, and projection align in a rare way.",     "[TEAM] gets the best pick of the draft with [PLAYER]. High floor, high ceiling, and immediate impact potential.",     "Best pick overall: [PLAYER] to [TEAM]. Thatâ€™s a cornerstone-type selection at a price that makes it even better.",     "[TEAM] wins the headline: [PLAYER] is the best pick overall based on talent versus slot and role translation."   ],   biggestReach: [     "Biggest reach: [TEAM] selecting [PLAYER]. The slot cost exceeds the consensus value, and the projection has too many conditions.",     "This one stands out: [PLAYER] to [TEAM] as the biggest reach. The board offered better value and safer paths.",     "Biggest reach call goes to [TEAM] for [PLAYER]. If it hits, itâ€™s genius â€” but the price paid is the issue.",     "[TEAM] reached hardest with [PLAYER]. The development curve must accelerate or the capital spend looks wasteful.",     "Biggest reach: [PLAYER] by [TEAM]. The pick requires best-case coaching and best-case translation to justify the slot."   ],   bestValueRound2: [     "Best value Round 2: [TEAM] getting [PLAYER]. Thatâ€™s a Day 2 steal with immediate contributor probability.",     "Round 2 value winner: [PLAYER] to [TEAM]. The combination of slot cost and projected impact is excellent.",     "[TEAM] nailed Day 2 by landing [PLAYER]. Thatâ€™s surplus value and a clean role projection.",     "Best value in Round 2 belongs to [TEAM] for [PLAYER]. That pick should outperform the draft number.",     "[PLAYER] to [TEAM] is the Round 2 value headline. Strong process, strong projection, strong return potential."   ] };

var BROADCAST_COMMENTARY={
// â•â•â• v98.6: ENHANCED PLAY-BY-PLAY NARRATION ENGINE â•â•â•
// Rich, varied descriptions that make every drive feel like a real broadcast
pbp986:{
  passTD:[
    "{qb} drops back, surveys the field... FIRES to {wr} in the end zone! TOUCHDOWN! {plays} plays, {yds} yards!",
    "{qb} with time in the pocket â€” finds {wr} streaking across the middle â€” CAUGHT! TOUCHDOWN! {yds}-yard drive!",
    "Play-action fake, {qb} rolls right â€” {wr} has a step! LOFTS IT... TOUCHDOWN! What a throw! {plays} plays!",
    "{qb} under center, takes the snap, pump fakes â€” {wr} blows past the corner! DEEP BALL... TOUCHDOWN! {yds} yards!",
    "3rd and goal â€” {qb} scrambles, keeps it alive â€” fires a bullet to {wr}! TOUCHDOWN! {plays}-play drive!",
    "{wr} runs a beautiful route, {qb} threads the needle! SIX POINTS! {plays} plays, {yds} yards!",
    "Hurry-up offense, {qb} snaps, quick slant to {wr} â€” he breaks a tackle â€” WALKS INTO THE END ZONE! {yds} yards!",
    "{qb} stands tall in the pocket, delivers a strike to {wr} who makes an acrobatic catch for the TOUCHDOWN!",
    "Red zone efficiency on display! {qb} hits {wr} on a fade route â€” defender can't recover â€” TOUCHDOWN!",
    "What a drive! {plays} plays, all {yds} yards â€” capped off by {qb} to {wr} for the score!"
  ],
  rushTD:[
    "{rb} takes the handoff, hits the hole â€” GONE! Nobody's catching him! RUSHING TOUCHDOWN! {plays} plays, {yds} yards!",
    "{rb} behind the left guard, cuts right â€” sheds a tackler â€” DIVES IN! TOUCHDOWN! {yds}-yard drive!",
    "Power formation, {rb} gets the call â€” lowers his shoulder at the 2... HE'S IN! TOUCHDOWN! {plays} plays!",
    "Toss play to {rb}, he turns the corner â€” stiff arms the safety â€” SPRINTS into the end zone! {yds} yards!",
    "{rb} between the tackles, spins off a defender â€” reaches the ball across the goal line! TOUCHDOWN!",
    "Goal line stand? Not today! {rb} punches it in from the 1! Physical football! {plays}-play drive!",
    "Draw play to {rb} â€” he reads the blocks perfectly, finds daylight â€” 25 yards untouched â€” TOUCHDOWN!",
    "{rb} with the pitch, follows the pulling guard, cuts back against the grain â€” SCORES! What a run!",
    "The offensive line opens a crater and {rb} walks through it! RUSHING TOUCHDOWN! {yds} total yards!",
    "Patient runner. {rb} waits... waits... NOW! Bursts through for the TOUCHDOWN! {plays} plays to go {yds} yards!"
  ],
  sack:[
    "{dl} beats the tackle, wraps up {qb} â€” SACKED for a loss of {loss} yards! Devastating!",
    "All-out blitz and {dl} comes clean! {qb} never saw it coming â€” SACK! Minus {loss}!",
    "{dl} with a bull rush, collapses the pocket â€” {qb} goes DOWN! {loss}-yard loss!",
    "Pressure off the edge â€” {dl} bends the corner â€” GETS HOME! {qb} sacked!",
    "The pass rush is ferocious! {dl} strips through the block and buries {qb}! Loss of {loss}!",
    "{dl} comes on a delayed rush â€” {qb} steps up â€” right into the arms of {dl}! SACKED!",
    "WHAM! {dl} goes speed-to-power and flattens {qb}! Loss of {loss} yards! The crowd erupts!"
  ],
  interception:[
    "{qb} throws into coverage â€” PICKED OFF by {db}! What was he thinking?! {plays} plays, {yds} yards wasted!",
    "Miscommunication! {qb} throws it right to {db}! INTERCEPTION! Brutal turnover!",
    "{db} jumps the route, reads it all the way â€” INTERCEPTED! Terrible decision by {qb}!",
    "Tipped at the line â€” up in the air â€” {db} snags it! INTERCEPTION! {qb} hangs his head!",
    "Danger! {qb} forces it into double coverage â€” {db} comes down with it! TURNOVER!",
    "{db} with incredible ball skills â€” leaps and steals it from the receiver! INTERCEPTED! {qb} in disbelief!",
    "The pressure flushes {qb} â€” he throws off his back foot â€” easy pickings for {db}! INTERCEPTION!"
  ],
  fumble:[
    "{rb} hit hard at the point of attack â€” the ball is LOOSE! Turnover! {yds} yards lost on this drive!",
    "FUMBLE! {rb} stripped by the linebacker! The defense pounces on it!",
    "{rb} tries to bounce outside â€” gets walloped â€” FUMBLE! Big hit forces the turnover!",
    "Pile at the line of scrimmage â€” the ball squirts out! {rb} loses the handle! Turnover!"
  ],
  fgGood:[
    "{k} lines it up from {dist} yards... GOOD! Right through the uprights! {plays} plays, {yds} yards to set it up!",
    "The snap is down, the hold is good â€” {k} drives it... IT'S GOOD from {dist}! Three points!",
    "{k} knocks it home from {dist} yards! Clutch kick after a {plays}-play, {yds}-yard march!",
    "Money! {k} splits the uprights from {dist}! That's why you pay the kicker!"
  ],
  fgMiss:[
    "{k} from {dist}... it's got the distance... WIDE! No good! That one will haunt them!",
    "The snap, the hold, {k} kicks... pulls it LEFT! MISS from {dist} yards! Momentum killer!",
    "{k} pushes it wide right from {dist}! So close! {plays} plays for nothing!"
  ],
  punt:[
    "{plays} plays, {yds} yards â€” drive stalls. Punt team out.",
    "Couldn't convert on 3rd down. {plays} plays, {yds} yards â€” punt.",
    "Defense holds! {plays} plays, {yds} yards but no points. Time to punt.",
    "The drive fizzles at midfield. {plays} plays, {yds} yards gained. Punt.",
    "Three and out! Only {yds} yards on {plays} plays. Quick punt."
  ],
  threeAndOut:[
    "Three and out! {yds} yards â€” the defense swarms! Quick possession.",
    "Stuffed! {plays} plays, just {yds} yards. Defense wins this one.",
    "Offense can't get anything going â€” {plays} plays, {yds} yards. Punt!",
    "The defensive front dominates! Three and out â€” only {yds} yards!"
  ],
  explosive:[
    "EXPLOSIVE PLAY! {player} breaks free down the sideline!",
    "BLOWN COVERAGE! {player} is WIDE OPEN â€” this one's going deep!",
    "BREAKAWAY! {player} hits another gear â€” nobody's catching him!",
    "BIG PLAY! {player} sheds two tacklers and turns on the jets!"
  ],
  clutch4Q:[
    "4th quarter. Score is tight. This is where legends are made.",
    "CLUTCH TIME! Everything on the line now!",
    "The stadium is electric! This drive could decide it all!",
    "Gut check time. Can they come through when it matters most?"
  ],
  leadChange:[
    "LEAD CHANGE! The momentum has completely shifted!",
    "They've taken the lead! What a swing!",
    "NEW LEADER! The comeback is real!",
    "The scoreboard flips! It's a whole new ballgame!"
  ],
  blowout:[
    "This one's getting out of hand!",
    "Complete domination on display here.",
    "The starters might be heading to the bench early.",
    "Mercy rule? Not in the NFL, but maybe it should be!"
  ]
},
// Helper to fill templates
fill986:function(template,data){
  if(!template||!data)return template||"";
  return template.replace(/\{(\w+)\}/g,function(m,k){return data[k]!==undefined?data[k]:m;});
},
pick986:function(arr){return arr[Math.floor(Math.random()*arr.length)]||"";},
  drives:{
    TD:[
      "Touchdown! Surgical precision on that drive.",
      "They punch it in for six! The defense had absolutely no answers.",
      "An absolute clinic. That's how you orchestrate a scoring drive.",
      "Touchdown! You can feel the momentum shifting in the stadium.",
      "They break the plane! A devastating blow to the defense.",
      "Six points on the board. The offensive coordinator is in his bag today.",
      "They find the endzone! A relentless, physical march down the field.",
      "Paydirt! The blocking held up and the playmaker did the rest.",
      "Touchdown! This offense is operating on another level right now.",
      "A beautiful playcall results in six points. Elite execution."
    ],
    FG:[
      "The kick is good. Three points on the board.",
      "They stall in the red zone but salvage the field goal.",
      "Right down the middle. A reliable leg is a GM's best friend.",
      "Three points. It's a win for the defense, all things considered.",
      "The drive bends but doesn't break. Field goal is good.",
      "They settle for three after a promising march downfield.",
      "Through the uprights. Every point matters in this league.",
      "The kicker does his job. Three points added to the tally.",
      "A moral victory for the defense, holding them to a field goal.",
      "They take the points. Smart, situational football."
    ],
    TO:[
      "Turnover! The defense makes a massive play!",
      "Intercepted! What a catastrophic decision by the quarterback.",
      "Fumble! The ball is loose and the defense recovers!",
      "A backbreaker! You simply cannot turn the ball over in this league.",
      "Taken away! That's the defensive identity shining through.",
      "Disaster for the offense! The ball is going the other way.",
      "A brutal turnover. Those are the mistakes that cost you games.",
      "The defense feasts! A massive takeaway.",
      "Picked off! An unbelievable read by the defensive back.",
      "Turnover! That shifts the entire complexion of this matchup."
    ],
    PUNT:[
      "The drive stalls out. The punt unit takes the field.",
      "Three and out. The defense was completely dialed in.",
      "They are forced to punt. The offense just couldn't find a rhythm.",
      "A booming punt flips the field position.",
      "The defense gets off the field. Text-book execution.",
      "They punt it away. The battle for field position continues.",
      "Another stalled drive. The punter gets to work.",
      "The defense wins this round. Offense heads to the bench.",
      "A heavy dose of pressure forces the punt.",
      "Drive ends in a punt. The chess match rolls on."
    ],
    SAFETY:[
      "SAFETY! The defense swarms them in the endzone!",
      "Two points for the defense! An absolute disaster for the offense.",
      "Safety! You simply cannot get trapped back there.",
      "A massive defensive play results in a safety!",
      "Two points! The defense pins their ears back and attacks."
    ]
  },
  momentum:{
    takeLead:[
      "They have fought all the way back! We have a new leader!",
      "What a comeback! The momentum has completely flipped.",
      "They take the lead! This stadium is absolutely rocking right now.",
      "A stunning turnaround! They've erased the deficit and jumped ahead."
    ],
    extendLead:[
      "They are running away with this one! A commanding lead.",
      "The lead stretches out. They are smelling blood in the water.",
      "A huge cushion! The pressure is squarely on the opponent now.",
      "They extend their dominance! This is starting to look out of reach."
    ]
  },
  finalScore:{
    blowout:[
      "An absolute masterclass. They dismantled them from the opening kickoff.",
      "A dominant blowout victory. They were playing a different sport today.",
      "A statement win! They crushed their opponent without breaking a sweat.",
      "Total annihilation. This film will be tough to watch for the losers."
    ],
    comfortable:[
      "A solid, professional victory. They controlled the pace all game.",
      "They handle their business. A comfortable win for a well-coached team.",
      "A decisive win. They executed their gameplan and it showed.",
      "Never truly in doubt. A strong performance across the board."
    ],
    close:[
      "A hard-fought battle! They survive a very tough test.",
      "A gritty win in a one-score game. That builds character.",
      "They hold on for the victory! A tense finish to a great matchup.",
      "A clutch performance to seal a tight game. Great football."
    ],
    walkoff:[
      "AN INSTANT CLASSIC! They pull it out at the absolute buzzer!",
      "Heartbreak and euphoria! A walk-off win for the ages!",
      "Down to the final play! They survive an absolute nail-biter!",
      "Unbelievable finish! The thinnest of margins decides a thriller."
    ]
  },
  get:function(category,type,rng2){
    var pool=(this.drives||{})[type]||(this[category]||{})[type]||["Great play."];
    return pool[Math.floor((rng2||Math.random)()*pool.length)];
  }
};
var OFFSEASON_NEWS={
  templates:[
    {type:"trade_rumor",weight:3,generate:function(teams,myId,rng2){var t=teams[Math.floor(rng2()*teams.length)];var myT=teams.find(function(x){return x.id===myId;});var cands=myT&&myT.roster?myT.roster.filter(function(pl){return pl.ovr>=75;}):[];var p=cands.length?cands[Math.floor(rng2()*cands.length)]:null;if(!p)return null;return{headline:"ðŸ”¥ MFSN EXCLUSIVE: "+t.icon+t.abbr+" has inquired about "+p.name+" ("+p.pos+"). Source: 'Multiple calls made.'",consequence:{type:"morale_dip",playerId:p.id,amount:-5},serious:true,player:p.name};}},
    {type:"coach_interview",weight:2,generate:function(teams,myId,rng2){var t=teams.filter(function(x){return x.id!==myId;})[Math.floor(rng2()*(teams.length-1))];return{headline:"ðŸ“‹ MFSN: Your OC is reportedly in talks with "+t.icon+t.abbr+" for their HC vacancy. Monitoring the situation.",consequence:{type:"staff_anxiety",amount:-3},serious:false};}},
    {type:"holdout_threat",weight:2,generate:function(teams,myId,rng2){var myT=teams.find(function(x){return x.id===myId;});var cands=myT&&myT.roster?myT.roster.filter(function(pl){return pl.ovr>=78&&pl.contract&&pl.contract.years<=1;}):[];var p=cands.length?cands[Math.floor(rng2()*cands.length)]:null;if(!p)return null;return{headline:"ðŸ’° MFSN: Agent for "+p.name+" says contract talks are 'not progressing.' Holdout possible if unresolved.",consequence:{type:"player_morale",playerId:p.id,amount:-8},serious:true,player:p.name};}},
    {type:"viral_video",weight:2,generate:function(teams,myId,rng2){var myT=teams.find(function(x){return x.id===myId;});var p=myT&&myT.roster?myT.roster[Math.floor(rng2()*myT.roster.length)]:null;var videos=["doing the worm at a charity gala","going viral for eating a full rotisserie chicken mid-interview","challenging a raccoon to a staring contest and losing","teaching his grandmother the two-minute drill â€” she ran it in 1:58"];var v=videos[Math.floor(rng2()*videos.length)];if(!p)return null;return{headline:"ðŸ˜‚ MFSN TRENDING: "+p.name+" went viral after "+v+". +12M views. Endorsement calls flooding in.",consequence:{type:"fanbase_boost",amount:3},serious:false,player:p.name};}},
    {type:"alien_rumor",weight:1,generate:function(teams,myId,rng2){var myT=teams.find(function(x){return x.id===myId;});var p=myT&&myT.roster?myT.roster.filter(function(pl){return pl.devTrait==="superstar";})[0]||myT.roster[0]:null;if(!p)return null;return{headline:"ðŸ‘½ MFSN (Satire Desk): Sources say "+p.name+" doesn't sleep, doesn't eat, and once completed a 400-yd practice blindfolded. Is he human? We report, you decide.",consequence:{type:"morale_boost",playerId:p.id,amount:5},serious:false,player:p.name};}},
    {type:"jersey_drama",weight:2,generate:function(teams,myId,rng2){var jerseyNums=[0,1,7,12,13,17,24,80,99];var num=jerseyNums[Math.floor(rng2()*jerseyNums.length)];var myT=teams.find(function(x){return x.id===myId;});var abbr=myT?myT.abbr:"TEAM";return{headline:"ðŸ‘• MFSN: Two "+abbr+" players reportedly in a standoff over jersey #"+num+". Team source: 'Tense, but manageable.'",consequence:{type:"chemistry_dip",amount:-2},serious:false};}},
    {type:"star_endorsement",weight:2,generate:function(teams,myId,rng2){var myT=teams.find(function(x){return x.id===myId;});var cands=myT&&myT.roster?myT.roster.filter(function(pl){return pl.ovr>=80;}):[];var p=cands.length?cands[Math.floor(rng2()*cands.length)]:null;var brands=["a luxury SUV brand","a hot sauce company","a meditation app","a fast-casual taco chain","a crypto exchange (uh oh)"];if(!p)return null;return{headline:"ðŸ’¸ MFSN: "+p.name+" signs $3.2M endorsement deal with "+brands[Math.floor(rng2()*brands.length)]+". 'He earned it,' says agent.",consequence:{type:"morale_boost",playerId:p.id,amount:6},serious:false,player:p.name};}},
    {type:"gm_archetype_rivalry",weight:3,generate:function(teams,myId,rng2){
      var rivals=teams.filter(function(t){return t.id!==myId;});
      if(!rivals.length)return null;
      var rival=rivals[Math.floor(rng2()*rivals.length)];
      var arch=getTeamGMArchetype90?getTeamGMArchetype90(rival):null;
      if(!arch)return null;
      var headlines={
        analytics:["ðŸ“Š MFSN: "+rival.icon+rival.abbr+" GM defends unconventional pick: 'The model said so. That's enough.'","ðŸ“Š MFSN: "+rival.abbr+" front office reportedly running 400+ simulations per draft pick. Critics say 'relax.'"],
        old_school:["ðŸ§± MFSN: "+rival.icon+rival.abbr+" GM on FA splash signings: 'We don't chase. We build from the trenches up.'","ðŸ§± MFSN: "+rival.abbr+" passes on top WR prospect. 'We needed a guard. Nobody wins with weak guards.'"],
        contender:["ðŸ† MFSN: "+rival.icon+rival.abbr+" GM goes ALL IN â€” trades three 1sts for superstar. 'Window's open. Deal with it.'","ðŸ† MFSN: "+rival.abbr+" owner gives GM 'compete or clean out your desk' ultimatum. No comment from team."],
        rebuilder:["ðŸ› ï¸ MFSN: "+rival.icon+rival.abbr+" trades away entire core. Fans furious. GM: 'Trust the process.'","ðŸ› ï¸ MFSN: "+rival.abbr+" passes on every major FA. 'Those contracts are anchors. We accumulate picks.'"],
        moneyball:["ðŸ’¸ MFSN: "+rival.icon+rival.abbr+" quietly signs below-market kicker. Analytics says he'll be elite. We'll see.","ðŸ’¸ MFSN: "+rival.abbr+" GM on turning down $30M WR: 'Every player has a price. That wasn't our price.'"],
        loyalist:["ðŸ¤ MFSN: "+rival.icon+rival.abbr+" re-signs aging star well above market value. 'He bleeds our colors.'","ðŸ¤ MFSN: "+rival.abbr+" GM passes on trade rumors: 'You don't build culture by selling your people.'"]
      };
      var pool=headlines[arch.id]||[];
      if(!pool.length)return null;
      var line=pool[Math.floor(rng2()*pool.length)];
      return{headline:line,consequence:{type:"league_buzz",amount:0},serious:false,rival:rival.abbr,archetype:arch.id};
    }}
  ],
  generate:function(teams,myId,rng2){
    var stories=[];var attempts=0;
    while(stories.length<5&&attempts<20){
      attempts++;
      var pool=OFFSEASON_NEWS.templates;
      var totalWeight=pool.reduce(function(s,t){return s+t.weight;},0);
      var roll=rng2()*totalWeight;var cumulative=0;var chosen=null;
      for(var i=0;i<pool.length;i++){cumulative+=pool[i].weight;if(roll<=cumulative){chosen=pool[i];break;}}
      if(!chosen)continue;
      var story=chosen.generate(teams,myId,rng2);
      if(story&&!stories.some(function(s){return s.type===chosen.type;})){story.type=chosen.type;story.id=chosen.type+"_"+attempts;stories.push(story);}
    }
    return stories;
  }
};
var HOLDOUT_SYSTEM={
  checkHoldouts:function(team,isUser){
    var holdouts=[];
    if(!team||!team.roster)return holdouts;
    team.roster.forEach(function(p){
      if(p.holdout75)return;// Already holding out
      var marketTier86=getPosMarketTier86(p.pos);
      var underpaidLine86=Math.max(0,((p.ovr||50)-60)*0.4)*(marketTier86.mult||1);
      var isUnderpaid=(p.ovr||50)>=80&&p.contract&&p.contract.salary<underpaidLine86;
      var isExpiring=p.contract&&p.contract.years<=1;
      var isUnhappy=(p.morale||70)<50;
      var isStar=(p.ovr||50)>=82;
      var chance=0;
      if(isStar&&isExpiring&&isUnderpaid)chance=0.25;
      else if(isStar&&isUnhappy)chance=0.15;
      else if(isExpiring&&isUnderpaid&&(p.ovr||50)>=76)chance=0.10;
      if(chance>0){// v83: personality modifies holdout probability
        var _hFx=getContractPersonalityEffects(p,{});
        chance+=_hFx.holdoutChanceAdj;
        var fitHold86=calcPlayerIdentityFit(p,team);
        if(fitHold86.score<=55)chance+=0.06;
        else if(fitHold86.score<=62)chance+=0.03;
        else if(fitHold86.score>=84)chance-=0.05;
        else if(fitHold86.score>=76)chance-=0.02;
        chance=cl(chance,0,0.85);
      }
      if(chance>0&&RNG.ai()<chance){
        p.holdout75={week:0,demands:"extension",severity:isUnhappy?"severe":"moderate"};
        holdouts.push(p);
      }
    });
    return holdouts;
  },
  weeklyHoldout:function(p){
    if(!p||!p.holdout75)return null;
    p.holdout75.week=(p.holdout75.week||0)+1;
    var wk=p.holdout75.week;
    p.morale=Math.max(20,(p.morale||70)-4);// v80: Steeper morale drain per week
    var stage=wk<=1?1:wk<=2?2:wk<=4?3:wk<=6?4:5;
    p.holdout75.stage=stage;
    if(stage===1){
      return{type:"holdout_noshow",stage:1,name:p.name,pos:p.pos,ovr:p.ovr,
        headline:p.name+" ("+p.pos+") no-shows training camp. Agent: 'Exploring all options.'"};
    }else if(stage===2&&wk===2){
      return{type:"holdout_statement",stage:2,name:p.name,pos:p.pos,
        headline:"STATEMENT: "+p.name+" says he 'deserves to be paid like a top-"+p.pos+". No hard feelings.' MFSN at 11."};
    }else if(stage===3&&!p.holdout75.tradeRequest){
      p.holdout75.tradeRequest=true;p.holdout75.severity="severe";p.onTradeBlock=true;
      return{type:"trade_request",stage:3,name:p.name,pos:p.pos,
        headline:"ðŸš¨ "+p.name+" DEMANDS TRADE. Agent: 'He will not report under any circumstances.' MFSN BREAKING."};
    }else if(stage===4&&!p.holdout75.suspendOption){
      p.holdout75.suspendOption=true;
      return{type:"suspend_option",stage:4,name:p.name,pos:p.pos,
        headline:"WEEK "+wk+": "+p.name+" holdout enters critical stage. Team weighing suspension. Locker room fracturing."};
    }else if(stage===5){
      p.morale=Math.max(10,(p.morale||30)-8);
      return{type:"nuclear",stage:5,name:p.name,pos:p.pos,
        headline:"â˜¢ï¸ NUCLEAR: "+p.name+" holdout hits Week "+wk+". MFSN: 'This is a franchise-defining crisis.'"};
    }
    return{type:"holdout_week",stage:stage,name:p.name,pos:p.pos,weeks:wk};
  },
  resolve:function(p){
    if(!p||!p.holdout75)return;
    delete p.holdout75;
    p.morale=Math.min(99,(p.morale||70)+10);
  }
};
var RING_OF_HONOR_LOG={};// {teamId: [{name, pos, number, year, seasons, ovr, reason}]}
function nominateForRing(teamId,player,year){
  if(!RING_OF_HONOR_LOG[teamId])RING_OF_HONOR_LOG[teamId]=[];
  if(RING_OF_HONOR_LOG[teamId].some(function(h){return h.name===player.name;}))return false;
  RING_OF_HONOR_LOG[teamId].push({name:player.name,pos:player.pos,
    number:player.number||Math.floor(mulberry32(42+RING_OF_HONOR_LOG[teamId].length)()*89)+10,// deterministic fallback
    year:year,ovr:player.ovr,
    reason:player.ovr>=85?"Franchise legend":player.ovr>=80?"Fan favorite":"Beloved veteran"});
  return true;
}
function autoRingOfHonor(teams,history,year){
  if(history.length<3)return;
  var currentNames={};
  teams.forEach(function(t){t.roster.forEach(function(p){currentNames[p.name]=true;});});
  var lastSeason=history[history.length-1];
  if(!lastSeason||!lastSeason.teams)return;
  lastSeason.teams.forEach(function(ht){
    ht.roster.forEach(function(p){
      if(!currentNames[p.name]&&p.ovr>=82){
        nominateForRing(ht.id||ht.abbr,p,year);
      }
    });
  });
}
function getRingOfHonor(teamId){
  return(RING_OF_HONOR_LOG[teamId]||[]).slice().sort(function(a,b){return b.ovr-a.ovr;});
}
var CAREER_PAGE_CACHE={};// {playerName: careerPageData}
function getCachedCareerPage(playerName,history,teams){
  var isActive=false;
  teams.forEach(function(t){t.roster.forEach(function(p){if(p.name===playerName)isActive=true;});});
  if(!isActive&&CAREER_PAGE_CACHE[playerName])return CAREER_PAGE_CACHE[playerName];
  var page=buildCareerPage(playerName,history,teams);
  if(!isActive&&page){
    if(Object.keys(CAREER_PAGE_CACHE).length>50)CAREER_PAGE_CACHE={};
    CAREER_PAGE_CACHE[playerName]=page;
  }
  return page;
}
// v93.18 â€” Weather & HT strategy data â†’ extracted to src/systems/weather.js (module swap #11)
// Legacy alias so any old save data that uses HALFTIME_OPTIONS still works
var HALFTIME_OPTIONS=HT_CONDITIONS;
var INJURY_REPORT={
  generate:function(teams,week,myId,sched){
    var items=[];
    teams.forEach(function(t){
      t.roster.forEach(function(p){
        if(p.injury&&p.injury.games>0&&p.isStarter&&p.ovr>=65){
          var severity=p.injury.games>=5?"IR":p.injury.games>=3?"Out":"Questionable";
          var impact=p.ovr>=85?"HIGH":p.ovr>=75?"MED":"LOW";
          items.push({teamId:t.id,teamAbbr:t.abbr,teamIcon:t.icon,pid:p.id,name:p.name,pos:p.pos,
            ovr:p.ovr,weeksLeft:p.injury.games,type:p.injury.type,status:severity,impact:impact});
        }
      });
    });
    items.sort(function(a,b){return b.ovr-a.ovr||(b.weeksLeft-a.weeksLeft);});
    var matchupNotes=[];
    if(myId&&sched){
      var nextGame=sched.filter(function(g){return g.week===week&&(g.home===myId||g.away===myId);})[0];
      if(nextGame){
        var oppId=nextGame.home===myId?nextGame.away:nextGame.home;
        var myTeam=teams.find(function(t){return t.id===myId;});
        var oppTeam=teams.find(function(t){return t.id===oppId;});
        if(myTeam&&oppTeam){
          var myInjured=items.filter(function(x){return x.teamId===myId;});
          myInjured.forEach(function(inj){
            if(inj.pos==="CB"){
              var oppWR=oppTeam.roster.filter(function(p){return p.pos==="WR"&&p.isStarter;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
              if(oppWR)matchupNotes.push({emoji:"ðŸ“ˆ",note:oppTeam.abbr+" WR "+oppWR.name+" advantage (your "+inj.pos+" "+inj.name+" out)",delta:"+"+Math.round((oppWR.ovr-inj.ovr)*0.6+5),axis:"coverage"});
            }
            if(inj.pos==="QB"){matchupNotes.push({emoji:"ðŸ“‰",note:"Your QB "+inj.name+" out â€” offense impact",delta:"-12",axis:"offense"});}
            if(inj.pos==="OL"){matchupNotes.push({emoji:"ðŸ“‰",note:"Your "+inj.name+" (OL) out â€” pressure risk",delta:"+8",axis:"pressure"});}
          });
          var oppInjured=items.filter(function(x){return x.teamId===oppId;});
          oppInjured.forEach(function(inj){
            if(inj.pos==="CB"){
              var myWR=myTeam.roster.filter(function(p){return p.pos==="WR"&&p.isStarter;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
              if(myWR)matchupNotes.push({emoji:"ðŸ“ˆ",note:"Your WR "+myWR.name+" advantage ("+oppTeam.abbr+" "+inj.pos+" "+inj.name+" out)",delta:"+"+Math.round((myWR.ovr-inj.ovr)*0.6+5),axis:"coverage"});
            }
            if(inj.pos==="QB"){matchupNotes.push({emoji:"ðŸ“ˆ",note:oppTeam.abbr+" QB "+inj.name+" out â€” their offense crippled",delta:"+12",axis:"offense"});}
          });
        }
      }
    }
    return{items:items.slice(0,8),matchupNotes:matchupNotes.slice(0,4),week:week};
  }
};
var PRACTICE_FOCUS=[
  {id:"scout",label:"ðŸ” Opponent Scout",desc:"+system knowledge (fastest) Â· fewer turnovers & stalls",
    fx:{dev:0,injuryRisk:0,system:0.08,morale:0}},
  {id:"dev",label:"ðŸ“ˆ Development Camp",desc:"+player growth Â· no system knowledge gain",
    fx:{dev:0.12,injuryRisk:0,system:0,morale:0}},
  {id:"recovery",label:"ðŸ§Š Recovery Week",desc:"-injury risk, +morale Â· no system knowledge gain",
    fx:{dev:0,injuryRisk:-0.10,system:0,morale:0.02}},
  {id:"pads",label:"ðŸ’ª Full Pads",desc:"+dev, +system knowledge (moderate)",
    fx:{dev:0.04,injuryRisk:0,system:0.04,morale:0}}
];
var CAPTAIN_RULES={eligibleMinOvr:70,clutchDriveMin:9,scoreDiffMax:10,triggersPerSeason:3};
var CAPTAIN_MOMENT_TYPES=[
  {id:"calm_drive",label:"Calm Drive",emoji:"ðŸ§Š",desc:"Captain settled the offense â€” turnover risk dropped",
    fx:{intReduction:0.06,fumbleReduction:0.03}},
  {id:"big_stop",label:"Big Stop",emoji:"ðŸ›‘",desc:"Captain rallied the defense â€” pressure surge",
    fx:{pressureBoost:0.10,coverageBoost:0.04}},
  {id:"clutch_convert",label:"Clutch Convert",emoji:"âš¡",desc:"Captain willed the team forward â€” scoring boost",
    fx:{scoringBoost:8}}
];
var SCOUT_REPORT={
  generate:function(myTeam,oppTeam,sched,season,rivalries){
    if(!myTeam||!oppTeam)return null;
    var offPlan=OFF_PLANS.find(function(p){return p.id===(oppTeam.gameplanOff||"balanced_o");})||OFF_PLANS[0];
    var defPlan=DEF_PLANS.find(function(p){return p.id===(oppTeam.gameplanDef||"balanced_d");})||DEF_PLANS[0];
    var stars=oppTeam.roster.filter(function(p){return p.isStarter&&p.ovr>=78;})
      .sort(function(a,b){return b.ovr-a.ovr;}).slice(0,4)
      .map(function(p){return{name:p.name,pos:p.pos,ovr:p.ovr,trait:p.trait||"none",
        threat:p.ovr>=88?"ELITE":p.ovr>=82?"DANGEROUS":"SOLID"};});
    var posAvg={};
    oppTeam.roster.filter(function(p){return p.isStarter;}).forEach(function(p){
      if(!posAvg[p.pos])posAvg[p.pos]={total:0,count:0};
      posAvg[p.pos].total+=p.ovr;posAvg[p.pos].count++;
    });
    var weaknesses=Object.keys(posAvg).map(function(pos){return{pos:pos,avg:Math.round(posAvg[pos].total/posAvg[pos].count)};})
      .sort(function(a,b){return a.avg-b.avg;}).slice(0,3)
      .map(function(w){return{pos:w.pos,avg:w.avg,note:w.avg<65?"Exploitable":w.avg<72?"Below average":"Mediocre"};});
    var myOff=OFF_PLANS.find(function(p){return p.id===(myTeam.gameplanOff||"balanced_o");})||OFF_PLANS[0];
    var counterBonus=SCHEME_COUNTERS[myOff.id]&&SCHEME_COUNTERS[myOff.id][defPlan.id]?SCHEME_COUNTERS[myOff.id][defPlan.id]:0;
    var schemeNote=counterBonus>=4?"Your offense has a BIG advantage vs their D":counterBonus>=1?"Slight edge for your offense":
      counterBonus<=-4?"Their defense counters your offense HARD":counterBonus<=-1?"They have a slight defensive edge":"Neutral matchup";
    var injuredStarters=oppTeam.roster.filter(function(p){return p.isStarter&&p.injury&&p.injury.games>0&&p.ovr>=65;})
      .map(function(p){return{name:p.name,pos:p.pos,ovr:p.ovr,weeks:p.injury.games,type:p.injury.type};});
    var streak=oppTeam.streak||0;
    var momentum=streak>=3?"ðŸ”¥ HOT ("+streak+"W streak)":streak<=-3?"â„ï¸ COLD ("+Math.abs(streak)+"L streak)":"âž¡ï¸ Steady";
    var rivHeat=0;
    if(rivalries){
      var rk=rivalryKey?rivalryKey(myTeam.id,oppTeam.id):null;
      if(rk&&rivalries[rk])rivHeat=rivalries[rk].heat||0;
    }
    return{opp:oppTeam.icon+oppTeam.abbr+" ("+oppTeam.wins+"-"+oppTeam.losses+")",
      offPlan:offPlan,defPlan:defPlan,stars:stars,weaknesses:weaknesses,
      schemeNote:schemeNote,counterBonus:counterBonus,injuredStarters:injuredStarters,
      momentum:momentum,rivHeat:rivHeat};
  }
};
var PRESS_QUESTIONS=[
  {id:"bad_loss",trigger:function(r){return r.lost&&r.margin>=14;},
    q:"Your team got blown out by {margin} points. What happened out there?",
    opts:[
      {id:"blame",label:"ðŸ”¥ \"We didn't execute. Some guys weren't ready.\"",fx:{morale:-3,ownerApproval:2,rivalHeat:0}},
      {id:"own_it",label:"ðŸ¤ \"That's on me. I'll fix the gameplan.\"",fx:{morale:3,ownerApproval:-1,rivalHeat:0}},
      {id:"deflect",label:"ðŸ˜¤ \"Refs didn't help. We'll bounce back.\"",fx:{morale:1,ownerApproval:0,rivalHeat:2}}
    ]},
  {id:"close_loss",trigger:function(r){return r.lost&&r.margin<=7;},
    q:"A tough {margin}-point loss. How do you keep the locker room together?",
    opts:[
      {id:"rally",label:"ðŸ’ª \"We're close. One play away. We'll get there.\"",fx:{morale:2,ownerApproval:1,rivalHeat:0}},
      {id:"tough_love",label:"ðŸ”¥ \"Close isn't good enough. Time to earn it.\"",fx:{morale:-1,ownerApproval:2,rivalHeat:0}},
      {id:"next_up",label:"âž¡ï¸ \"Already looking at next week's film.\"",fx:{morale:0,ownerApproval:1,rivalHeat:-1}}
    ]},
  {id:"big_win",trigger:function(r){return r.won&&r.margin>=14;},
    q:"Dominant {margin}-point win tonight. How does it feel?",
    opts:[
      {id:"humble",label:"ðŸ™ \"Credit to the guys. They executed the gameplan.\"",fx:{morale:2,ownerApproval:1,rivalHeat:0}},
      {id:"swagger",label:"ðŸ˜Ž \"That's what championship teams look like.\"",fx:{morale:1,ownerApproval:2,rivalHeat:3}},
      {id:"focused",label:"ðŸŽ¯ \"Good teams don't celebrate one win. Next game.\"",fx:{morale:0,ownerApproval:2,rivalHeat:-1}}
    ]},
  {id:"close_win",trigger:function(r){return r.won&&r.margin<=7;},
    q:"A nail-biter â€” won by {margin}. Thoughts on the finish?",
    opts:[
      {id:"gritty",label:"ðŸ’Ž \"That's a character win. Gritty.\"",fx:{morale:3,ownerApproval:1,rivalHeat:0}},
      {id:"critical",label:"ðŸ“‹ \"We almost gave that away. Film session tomorrow.\"",fx:{morale:-1,ownerApproval:2,rivalHeat:0}},
      {id:"clutch",label:"â­ \"When it mattered most, our guys delivered.\"",fx:{morale:2,ownerApproval:1,rivalHeat:1}}
    ]},
  {id:"rivalry_any",trigger:function(r){return r.isRivalry;},
    q:"Rivalry game. The fans were electric. What does this matchup mean to you?",
    opts:[
      {id:"respect",label:"ðŸ¤ \"Great opponent. We both elevated our game.\"",fx:{morale:1,ownerApproval:1,rivalHeat:-2}},
      {id:"fire",label:"ðŸ”¥ \"This is OUR house. They know it now.\"",fx:{morale:2,ownerApproval:0,rivalHeat:4}},
      {id:"business",label:"ðŸ“Š \"Every game counts the same. On to the next.\"",fx:{morale:0,ownerApproval:1,rivalHeat:0}}
    ]}
];
var HEADLINES={
  generate:function(teams,myId,season,sched){
    var headlines=[];
    var my2=teams.find(function(t){return t.id===myId;});
    teams.forEach(function(t){
      if((t.streak||0)>=4)headlines.push({emoji:"ðŸ”¥",text:t.icon+t.abbr+" on a "+t.streak+"-game win streak!",priority:3});
      if((t.streak||0)<=-4)headlines.push({emoji:"ðŸ’€",text:t.icon+t.abbr+" in freefall â€” "+Math.abs(t.streak)+"-game losing streak",priority:3});
    });
    var sorted=teams.slice().sort(function(a,b){return b.wins!==a.wins?b.wins-a.wins:b.pf-a.pf;});
    if(season.week>=8){
      var bubble=sorted.slice(5,8);// Teams 6-8 (on the bubble)
      bubble.forEach(function(bt){
        if(bt.wins>=Math.floor(season.week*0.45))
          headlines.push({emoji:"ðŸˆ",text:bt.icon+bt.abbr+" ("+bt.wins+"-"+bt.losses+") fighting for playoff spot",priority:2});
      });
    }
    if(my2){
      my2.roster.filter(function(p){return p.age<=23&&p.isStarter&&p.ovr>=72;}).slice(0,2).forEach(function(rk){
        var weekPff=rk.pffWeek||0;
        if(weekPff>=80)headlines.push({emoji:"â­",text:"Rookie Watch: "+rk.name+" ("+rk.pos+") graded "+weekPff+" this week!",priority:2});
      });
    }
    if(my2){
      my2.roster.forEach(function(p){
        if(p.stats&&p.stats.passYds>=3500&&p.stats.passYds<4000)
          headlines.push({emoji:"ðŸ“ˆ",text:p.name+" closing in on 4,000 passing yards ("+p.stats.passYds+")",priority:2});
        if(p.stats&&p.stats.rushYds>=900&&p.stats.rushYds<1000)
          headlines.push({emoji:"ðŸ“ˆ",text:p.name+" approaching 1,000 rushing yards ("+p.stats.rushYds+")",priority:2});
        if(p.stats&&p.stats.recYds>=800&&p.stats.recYds<1000)
          headlines.push({emoji:"ðŸ“ˆ",text:p.name+" tracking toward 1,000 receiving yards ("+p.stats.recYds+")",priority:2});
        if(p.stats&&p.stats.sacks>=8)
          headlines.push({emoji:"ðŸ’ª",text:p.name+" leads the team with "+p.stats.sacks+" sacks â€” DPOY candidate?",priority:2});
      });
    }
    if(my2&&my2._prevRank){
      var curRank=sorted.findIndex(function(t){return t.id===myId;})+1;
      var delta=my2._prevRank-curRank;
      if(delta>=3)headlines.push({emoji:"ðŸ“ˆ",text:"Your team jumped "+delta+" spots in the power rankings to #"+curRank+"!",priority:3});
      if(delta<=-3)headlines.push({emoji:"ðŸ“‰",text:"You dropped "+Math.abs(delta)+" spots in the rankings to #"+curRank,priority:3});
    }
    if(season.week>=8&&season.week<=11){
      var contenders=sorted.slice(0,4);
      contenders.forEach(function(ct){
        if(ct.id!==myId){
          var need=ct.roster.filter(function(p){return p.isStarter&&p.ovr<65;});
          if(need.length>0)headlines.push({emoji:"ðŸ“ž",text:ct.icon+ct.abbr+" reportedly shopping for "+need[0].pos+" help before deadline",priority:1});
        }
      });
    }
    return headlines.sort(function(a,b){return b.priority-a.priority;}).slice(0,6);
  }
};
var DOSSIER={
  getEntry:function(db,oppId,year){
    var key=year+"-"+oppId;
    return db[key]||{oppId:oppId,year:year,conf:0,scoutCount:0,lastWeek:0,
      tells:[],weakSpots:[],stars:[],scheme:"",counterTip:""};
  },
  scout:function(db,oppId,year,week,scoutData,coachRating,clinicConfBonus){
    var key=year+"-"+oppId;
    var entry=db[key]||{oppId:oppId,year:year,conf:0,scoutCount:0,lastWeek:0,
      tells:[],weakSpots:[],stars:[],scheme:"",counterTip:""};
    entry.scoutCount=(entry.scoutCount||0)+1;
    entry.lastWeek=week;
    var confGain=15+Math.min((coachRating||50)-50,20)+(entry.scoutCount>1?10:0);
    confGain+=(clinicConfBonus||0);
    entry.conf=Math.min(95,entry.conf+confGain);
    if(scoutData){
      if(scoutData.offPlan)entry.scheme=scoutData.offPlan.name+" / "+scoutData.defPlan.name;
      if(scoutData.stars)entry.stars=scoutData.stars.slice(0,3);
      if(scoutData.weaknesses)entry.weakSpots=scoutData.weaknesses.slice(0,3);
      if(scoutData.schemeNote)entry.counterTip=scoutData.schemeNote;
      var newTells=[];
      if(scoutData.offPlan&&scoutData.offPlan.id!=="balanced_o")
        newTells.push("Runs "+scoutData.offPlan.name+" offense â€” "+scoutData.offPlan.desc.split(".")[0]);
      if(scoutData.defPlan&&scoutData.defPlan.id!=="balanced_d")
        newTells.push("Uses "+scoutData.defPlan.name+" defense â€” "+scoutData.defPlan.desc.split(".")[0]);
      if(scoutData.weaknesses&&scoutData.weaknesses[0]&&scoutData.weaknesses[0].avg<68)
        newTells.push("Weak at "+scoutData.weaknesses[0].pos+" ("+scoutData.weaknesses[0].avg+" OVR) â€” attack here");
      if(scoutData.stars&&scoutData.stars[0]&&scoutData.stars[0].ovr>=85)
        newTells.push("Must contain "+scoutData.stars[0].name+" ("+scoutData.stars[0].pos+" "+scoutData.stars[0].ovr+")");
      if(scoutData.injuredStarters&&scoutData.injuredStarters.length>0)
        newTells.push(scoutData.injuredStarters.length+" injured starter"+(scoutData.injuredStarters.length>1?"s":"")+" â€” exploit the depth");
      newTells.forEach(function(nt){
        if(entry.tells.indexOf(nt)<0)entry.tells.push(nt);
      });
      if(entry.tells.length>5)entry.tells=entry.tells.slice(-5);
    }
    db[key]=entry;
    return entry;
  },
  decay:function(db,year,week){
    Object.keys(db).forEach(function(key){
      var e=db[key];
      if(e.year===year&&e.lastWeek>0&&(week-e.lastWeek)>=4){
        e.conf=Math.max(0,e.conf-8);// -8 per check when stale
        if(e.conf<=0){e.tells=[];e.weakSpots=[];e.stars=[];}
      }
    });
    return db;
  },
  verify:function(db,oppId,year,gameResult,isHome){
    var key=year+"-"+oppId;
    var entry=db[key];
    if(!entry||entry.conf<=0)return null;
    var myScore=isHome?gameResult.home:gameResult.away;
    var oppScore=isHome?gameResult.away:gameResult.home;
    var won=myScore>oppScore;
    if(won){entry.conf=Math.min(95,entry.conf+5);return{status:"confirmed",delta:5};}
    else{entry.conf=Math.max(10,entry.conf-10);return{status:"wrong_read",delta:-10};}
  }
};
var MEDIA_TAGS={
  accountability:{label:"Accountability Coach",emoji:"ðŸ¤",desc:"Takes blame, builds trust"},
  tough_love:{label:"Taskmaster",emoji:"ðŸ”¥",desc:"Demands excellence, pushes hard"},
  players_coach:{label:"Players' Coach",emoji:"ðŸ’ª",desc:"Supports the locker room"},
  swagger:{label:"Showman",emoji:"ðŸ˜Ž",desc:"Confident, media-friendly"},
  deflector:{label:"Deflector",emoji:"ðŸ˜¤",desc:"Blames refs, dodges questions"},
  stoic:{label:"The Stoic",emoji:"ðŸŽ¯",desc:"Business-only, no emotion"}
};
var PRESS_TAG_MAP={
  blame:"tough_love",own_it:"accountability",deflect:"deflector",
  rally:"players_coach",tough_love:"tough_love",next_up:"stoic",
  humble:"accountability",swagger:"swagger",focused:"stoic",
  gritty:"players_coach",critical:"tough_love",clutch:"swagger",
  respect:"accountability",fire:"swagger",business:"stoic",
  scheme_buyin:"players_coach",scheme_temp:"stoic",scheme_honest:"accountability"
};
function getMediaPersona(tagHistory){
  if(!tagHistory||tagHistory.length<3)return null;
  var recent=tagHistory.slice(-6);
  var counts={};
  recent.forEach(function(t){counts[t]=(counts[t]||0)+1;});
  var topTag=null;var topCount=0;
  Object.keys(counts).forEach(function(t){if(counts[t]>topCount){topCount=counts[t];topTag=t;}});
  if(topCount>=2&&MEDIA_TAGS[topTag])return MEDIA_TAGS[topTag];
  return null;
}
var RIVALRY_MATH={
  calcDelta:function(margin,isPlayoff,isUpset,streakLength){
    var delta=1;// Base: every game = +1
    if(isPlayoff)delta+=4;// Playoffs are intense
    if(margin>=21)delta+=3;// Blowout disrespect
    else if(margin>=14)delta+=2;
    if(margin<=3&&margin>0)delta+=2;// Heartbreaker
    else if(margin<=7&&margin>3)delta+=1;// Tight game
    if(isUpset)delta+=3;// Shock factor
    if((streakLength||0)>=3)delta+=1;// Dominance builds hate
    return Math.min(12,delta);// Cap per game
  }
};
var PROSPECT_DOSSIER={
  getEntry:function(db,prospectId,year){
    var key=year+"-"+prospectId;
    return db[key]||{prospectId:prospectId,year:year,conf:0,scoutCount:0,lastWeek:0,
      tells:[],redFlags:[],schemeFit:"",source:{combine:false,interview:false,film:false}};
  },
  scout:function(db,prospectId,year,week,prospect,scoutType,coachRating,clinicConfBonus){
    var key=year+"-"+prospectId;
    var entry=db[key]||{prospectId:prospectId,year:year,conf:0,scoutCount:0,lastWeek:0,
      tells:[],redFlags:[],schemeFit:"",source:{combine:false,interview:false,film:false}};
    entry.scoutCount=(entry.scoutCount||0)+1;
    entry.lastWeek=week;
    entry.source[scoutType]=true;
    var confGain=scoutType==="film"?20:scoutType==="interview"?15:10;
    confGain+=Math.max(0,Math.min(10,(coachRating||50)-50));
    if(entry.scoutCount>1)confGain+=Math.max(0,8-entry.scoutCount*2);
    confGain+=(clinicConfBonus||0);
    entry.conf=Math.min(90,entry.conf+confGain);
    if(prospect){
      var newTells=[];var newFlags=[];
      if(scoutType==="measurables"||scoutType==="combine"){
        if(prospect.combine){
          if(prospect.combine.forty<=4.4)newTells.push("Elite speed ("+prospect.combine.forty+"s 40yd)");
          else if(prospect.combine.forty>=4.7)newFlags.push("Below-average speed ("+prospect.combine.forty+"s 40yd)");
        }
        if(prospect.ratings){
          var topR=null;var topV=0;
          Object.keys(prospect.ratings).forEach(function(r){if(prospect.ratings[r]>topV){topV=prospect.ratings[r];topR=r;}});
          if(topR&&topV>=80)newTells.push("Standout "+topR+" ("+topV+")");
        }
      }
      if(scoutType==="interview"){
        if(prospect.trait&&TRAITS[prospect.trait])newTells.push("Personality: "+TRAITS[prospect.trait].name);
        if(prospect.devTrait==="superstar")newTells.push("Superstar development ceiling");
        else if(prospect.devTrait==="star")newTells.push("Star development potential");
        if(prospect.age>=23)newFlags.push("Already "+prospect.age+" years old â€” limited upside window");
      }
      if(scoutType==="film"||scoutType==="film_study"){
        if(prospect.pot&&prospect.ovr&&prospect.pot>prospect.ovr+10)
          newTells.push("Film shows high ceiling (gap: +"+(prospect.pot-prospect.ovr)+")");
        if(prospect.pot&&prospect.ovr&&prospect.pot<=prospect.ovr+3)
          newFlags.push("What you see is what you get â€” limited growth");
        if(prospect.ovr>=78)newTells.push("Pro-ready talent ("+prospect.ovr+" OVR)");
      }
      newTells.forEach(function(t){if(entry.tells.indexOf(t)<0)entry.tells.push(t);});
      newFlags.forEach(function(f){if(entry.redFlags.indexOf(f)<0)entry.redFlags.push(f);});
      if(entry.tells.length>4)entry.tells=entry.tells.slice(-4);
      if(entry.redFlags.length>3)entry.redFlags=entry.redFlags.slice(-3);
      if(prospect.pos){
        var goodSchemes=[];
        if(prospect.ratings&&(prospect.ratings.speed||0)>=80)goodSchemes.push("Air Raid");
        if(prospect.ratings&&(prospect.ratings.power||prospect.ratings.strength||0)>=80)goodSchemes.push("Ground & Pound");
        if(goodSchemes.length>0)entry.schemeFit="Best fit: "+goodSchemes.join(", ");
      }
      var newClaims=PROSPECT_CLAIMS.generate(prospect,scoutType,prospect.pos);
      if(!entry.claims)entry.claims=[];
      newClaims.forEach(function(nc){
        var exists=entry.claims.some(function(ec){return ec.type===nc.type;});
        if(!exists&&entry.claims.length<3)entry.claims.push(nc);
        else if(exists){// Upgrade strength if re-scouted same claim
          entry.claims.forEach(function(ec){if(ec.type===nc.type&&nc.strength>ec.strength)ec.strength=nc.strength;});
        }
      });
    }
    db[key]=entry;
    return entry;
  },
  decay:function(db,year,week){
    Object.keys(db).forEach(function(key){
      var e=db[key];
      if(e.year===year&&e.lastWeek>0&&(week-e.lastWeek)>=5){
        e.conf=Math.max(0,e.conf-6);
        if(e.conf<=0){e.tells=[];e.redFlags=[];}
      }
    });
    return db;
  },
  verify:function(db,prospectId,year,rookiePlayer,gamesPlayed){
    var key=year+"-"+prospectId;
    var entry=db[key];
    if(!entry||entry.conf<=0)return null;
    var claims=entry.claims||[];
    if(claims.length===0){
      var gap=Math.abs((rookiePlayer.ovr||0)-(rookiePlayer.pot||0));
      if(gap<=5){entry.conf=Math.min(90,entry.conf+6);return{status:"VERIFIED",deltaConf:6,hits:["ovr"],misses:[],incomplete:[],notes:"Legacy check: OVR aligned"};}
      else if(gap<=12){return{status:"MIXED",deltaConf:0,hits:[],misses:[],incomplete:[],notes:"Legacy check: moderate gap"};}
      else{entry.conf=Math.max(0,entry.conf-8);return{status:"MISREAD",deltaConf:-8,hits:[],misses:["ovr"],incomplete:[],notes:"Legacy check: significant gap"};}
    }
    var result=PROSPECT_CLAIMS.verify(claims,rookiePlayer,gamesPlayed||0);
    if(!result)return null;
    var startConf=entry.conf;
    var bonus=0;
    if(startConf>=70&&result.deltaConf<0)bonus=-2;// Confident miss stings
    if(startConf<=30&&result.deltaConf>0)bonus=2;// Diamond in the rough reward
    entry.conf=cl(entry.conf+result.deltaConf+bonus,0,90);
    entry.verifyResult=result;
    return result;
  }
};
var CREDIBILITY_MATH={
  calcDelta:function(tag,margin){
    var isWin=margin>0;
    var isBlowoutLoss=margin<=-14;
    if(tag==="accountability")return isWin?1:4;// Taking blame after loss = massive trust
    if(tag==="stoic")return 2;// Steady hand always good
    if(tag==="deflector")return isWin?-1:(isBlowoutLoss?-4:-1);// Weak after blowout
    if(tag==="swagger")return isWin?2:-5;// Bragging after loss = fool
    if(tag==="tough_love")return isBlowoutLoss?-2:2;// Risky after blowout
    if(tag==="players_coach")return 1;// Always safe, low reward
    return 0;
  }
};
// CLINIC_TRACKS, CLINIC, CLINIC_MATH â€” imported from src/systems/coaching-clinic.js
var DRAFT_EVAL={
  compareSafety:function(dA,dB){
    var getScore=function(d){
      if(!d)return 0;
      var pts=0;
      pts+=(d.conf||0);// Confidence is king
      if(d.tells)pts+=(d.tells.length*10);// Intel = value (even bad news is info)
      if(d.redFlags)pts-=(d.redFlags.length*15);// Red flags reduce safety
      if(d.verified)pts+=25;// Verified = massive trust
      return pts;
    };
    return getScore(dA)-getScore(dB);
  }
};
var DRAFT_WAR_ROOM={
  getIntel:function(dc,team,pick,schemes){
    dc=dc||{};team=team||{};schemes=schemes||{};
    var pool=dc.pool||dc.draftClass||dc.class||dc.prospects||[];
    var rem=pool.filter(function(p){return p&&!(p._drafted||p.draftedBy||p.draftPick);});
    var posList=["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"];
    var needs={};
    posList.forEach(function(pos){
      var sts=team.roster?starters(team.roster,pos,pos==="OL"?5:pos==="WR"?2:1):[];
      var o=sts&&sts.length?avg(sts,function(pl){return pl.ovr||50;}):50;
      needs[pos]=cl(80-o,0,40);// 0..40
    });
    var scored=rem.map(function(p){
      var need=needs[p.pos]||0;
      var schemeFit=DRAFT_WAR_ROOM.schemeFitScore(p,schemes);
      var val=(p.ovr||50)+need*0.35+schemeFit*0.20;
      return {p:p,val:val,need:need,fit:schemeFit};
    }).sort(function(a,b){return b.val-a.val;});
    var targetBoard=scored.slice(0,5).map(function(x){
      return {id:x.p.id||x.p.name, name:x.p.name, pos:x.p.pos, ovr:x.p.ovr||50, value:Math.round(x.val), need:Math.round(x.need), schemeFit:Math.round(x.fit)};
    });
    var bpa=scored[0]||null;
    var next=scored[1]||null;
    var bpaAlert=null;
    if(bpa&&next&&bpa.val-next.val>=6){
      bpaAlert={msg:"BPA gap: "+bpa.p.name+" is "+Math.round(bpa.val-next.val)+" points above next best.", prospect:{id:bpa.p.id||bpa.p.name,name:bpa.p.name,pos:bpa.p.pos,ovr:bpa.p.ovr||50}};
    }
    var pickRec=bpa;
    if(scored.length){
      var needFirst=scored.slice(0,12).sort(function(a,b){
        var na=(a.need*1.2)+(a.fit*0.3)+(a.p.ovr||50)*0.2;
        var nb=(b.need*1.2)+(b.fit*0.3)+(b.p.ovr||50)*0.2;
        return nb-na;
      })[0];
      if(needFirst&&bpa&&bpa.val-needFirst.val<10)pickRec=needFirst;
    }
    var recReason=[];
    if(pickRec){
      if(pickRec===bpa)recReason.push("Best player available by value.");
      if((pickRec.need||0)>=20)recReason.push("Fills a high team need.");
      if((pickRec.fit||0)>=15)recReason.push("Strong scheme fit.");
    }
    return {
      targetBoard:targetBoard,
      bpaAlert:bpaAlert,
      schemeFit:{off:schemes.off||null, def:schemes.def||null},
      autoPick:pickRec?{id:pickRec.p.id||pickRec.p.name,name:pickRec.p.name,pos:pickRec.p.pos,ovr:pickRec.p.ovr||50,reason:recReason.join(" ")}:null
    };
  },
  schemeFitScore:function(p,schemes){
    p=p||{};schemes=schemes||{};
    var off=schemes.off||"";var def=schemes.def||"";
    var r=p.ratings||{};
    var score=0;
    if(p.pos==="QB"){
      if(off==="west_coast")score+=(r.shortAccuracy||50)*0.10+(r.fieldVision||50)*0.08;
      if(off==="air_raid")score+=(r.deepAccuracy||50)*0.10+(r.throwPower||r.arm||50)*0.08;
      if(off==="balanced_o")score+=(r.awareness||50)*0.08+(r.accuracy||50)*0.08;
      if(off==="smashmouth")score+=(r.toughness||50)*0.06+(r.pocketPresence||50)*0.06;
    }else if(p.pos==="RB"){
      if(off==="ground_pound"||off==="smashmouth")score+=(r.power||50)*0.10+(r.truckPower||50)*0.06;
      if(off==="west_coast"||off==="balanced_o")score+=(r.ballCarrierVision||50)*0.08+(r.elusiveness||50)*0.06;
    }else if(p.pos==="WR"||p.pos==="TE"){
      if(off==="west_coast")score+=(r.shortRoute||50)*0.10+(r.separation||50)*0.06;
      if(off==="air_raid")score+=(r.deepRoute||50)*0.10+(r.speed||50)*0.06;
      score+=(r.catching||50)*0.05+(r.catchInTraffic||50)*0.05;
    }else if(p.pos==="OL"){
      if(off==="ground_pound"||off==="smashmouth")score+=(r.pullBlock||50)*0.10+(r.runBlock||50)*0.06;
      else score+=(r.passBlock||50)*0.08+(r.assignmentIQ||50)*0.06;
    }else if(p.pos==="DL"){
      if(def==="blitz_heavy")score+=(r.powerMoves||50)*0.08+(r.motorEffort||50)*0.06;
      if(def==="zone_cov")score+=(r.pursuit||50)*0.06+(r.blockShedding||50)*0.06;
      if(def==="man_press")score+=(r.finesseMoves||50)*0.08;
    }else if(p.pos==="LB"){
      if(def==="zone_cov")score+=(r.zoneCoverage||50)*0.10+(r.range||r.speed||50)*0.04;
      if(def==="blitz_heavy")score+=(r.hitPower||50)*0.06+(r.pursuit||50)*0.05;
    }else if(p.pos==="CB"){
      if(def==="man_press")score+=(r.manCoverage||50)*0.12+(r.breakOnBall||50)*0.05;
      if(def==="zone_cov")score+=(r.zoneCoverage||50)*0.12+(r.breakOnBall||50)*0.04;
    }else if(p.pos==="S"){
      if(def==="zone_cov")score+=(r.rangeAbility||50)*0.12+(r.zoneCoverage||50)*0.05;
      if(def==="man_press")score+=(r.manCoverage||50)*0.08+(r.breakOnBall||50)*0.04;
    }
    score=(score/10)-5;
    return cl(Math.round(score),0,25);
  }
};
var PROSPECT_CHARACTER={
  types:[
    {id:"leader",label:"Leader",icon:"ðŸ‘‘",effect:"team",desc:"Natural captain. Lifts teammates' morale.",weight:8},
    {id:"film_junkie",label:"Film Junkie",icon:"ðŸ“½ï¸",effect:"dev",desc:"Studies obsessively. Faster development.",weight:10},
    {id:"raw_talent",label:"Raw Talent",icon:"ðŸ’Ž",effect:"ceiling",desc:"Incredible physical tools but needs coaching.",weight:7},
    {id:"pro_ready",label:"Pro Ready",icon:"ðŸŽ“",effect:"floor",desc:"Polished technique. Can start Day 1.",weight:8},
    {id:"boom_or_bust",label:"Boom or Bust",icon:"ðŸ’¥",effect:"variance",desc:"Could be All-Pro or out of the league in 3 years.",weight:6},
    {id:"injury_prone",label:"Injury Prone",icon:"ðŸ©¹",effect:"health",desc:"Concerning medical history. Higher injury risk.",weight:5},
    {id:"character_concern",label:"Character Concern",icon:"ðŸš©",effect:"risk",desc:"Off-field issues. May affect locker room.",weight:4},
    {id:"small_school",label:"Small School Gem",icon:"ðŸ«",effect:"hidden",desc:"Dominated weaker competition. Pro translation uncertain.",weight:6},
    {id:"workout_warrior",label:"Workout Warrior",icon:"ðŸ‹ï¸",effect:"combine",desc:"Elite combine numbers may not translate to game performance.",weight:5},
    {id:"football_iq",label:"High Football IQ",icon:"ðŸ§ ",effect:"mental",desc:"Exceptional processing speed and awareness.",weight:8}
  ],
  assign:function(prospect,tierStr){
    var types=PROSPECT_CHARACTER.types;
    var pool=[];
    types.forEach(function(t){
      var w=t.weight;
      if(tierStr==="star"&&(t.id==="leader"||t.id==="pro_ready"||t.id==="film_junkie"))w+=4;
      if(tierStr==="bad"&&(t.id==="character_concern"||t.id==="boom_or_bust"||t.id==="small_school"))w+=3;
      if(tierStr==="avg"&&(t.id==="raw_talent"||t.id==="workout_warrior"))w+=2;
      for(var i=0;i<w;i++)pool.push(t);
    });
    return pool[Math.floor(RNG.draft()*pool.length)];
  }
};
var BUST_STEAL_CALC={
  calc:function(prospect){
    if(!prospect)return{bustPct:0,stealPct:0,riskLabel:"Unknown"};
    var bustRisk=15;// Base 15% bust rate
    var stealChance=10;// Base 10% steal chance
    var char75=prospect.character75||null;
    if(char75){
      if(char75.id==="character_concern")bustRisk+=20;
      if(char75.id==="boom_or_bust"){bustRisk+=12;stealChance+=12;}
      if(char75.id==="injury_prone")bustRisk+=15;
      if(char75.id==="workout_warrior")bustRisk+=8;
      if(char75.id==="pro_ready"){bustRisk-=10;stealChance-=5;}
      if(char75.id==="film_junkie"){bustRisk-=8;stealChance+=5;}
      if(char75.id==="leader"){bustRisk-=6;stealChance+=3;}
      if(char75.id==="football_iq"){bustRisk-=8;stealChance+=4;}
      if(char75.id==="small_school")stealChance+=8;
      if(char75.id==="raw_talent"){bustRisk+=5;stealChance+=10;}
    }
    if(prospect.isGem)stealChance+=15;
    if(prospect.isBust)bustRisk+=15;
    if(prospect.age>=23)bustRisk+=5;
    if(prospect.combine&&prospect.combine.forty<=4.45&&(prospect.ovr||50)<70)bustRisk+=5;// Athletic but low OVR = red flag
    if(prospect.combine&&prospect.combine.forty<=4.45&&(prospect.ovr||50)>=75)stealChance+=5;
    if(prospect.pot&&prospect.ovr&&prospect.pot-prospect.ovr>=12)stealChance+=8;
    if(prospect.pot&&prospect.ovr&&prospect.pot-prospect.ovr<=3)bustRisk+=5;
    bustRisk=Math.max(2,Math.min(75,bustRisk));
    stealChance=Math.max(2,Math.min(65,stealChance));
    var riskLabel=bustRisk>=40?"HIGH RISK":bustRisk>=25?"MODERATE RISK":bustRisk>=15?"LOW RISK":"SAFE BET";
    return{bustPct:bustRisk,stealPct:stealChance,riskLabel:riskLabel};
  }
};
var DRAFT_DAY_TRADES={
  shouldTradeUp:function(team,prospect,currentPick,targetPick,allTeams){
    if(!team||!prospect||!allTeams)return null;
    var need=0;var posList=["QB","RB","WR","TE","OL","DL","LB","CB","S"];
    posList.forEach(function(pos){
      if(pos===prospect.pos){
        var sts=(team.roster||[]).filter(function(p){return p.pos===pos&&!(p.injury&&p.injury.games>0);}).sort(function(a,b){return b.ovr-a.ovr;});
        var bestOvr=sts.length>0?sts[0].ovr:40;
        need=Math.max(0,80-bestOvr);
      }
    });
    if(need<15||(prospect.ovr||50)<72)return null;
    var pickGap=currentPick-targetPick;
    if(pickGap<=0||pickGap>20)return null;// Can't trade backwards or too far
    var cost=Math.min(3,Math.ceil(pickGap/5));
    var futurePicks=(team.draftPicks||[]).filter(function(pk){return pk.round>=3;});
    if(futurePicks.length<cost)return null;// Not enough capital
    var isQBNeed=prospect.pos==="QB"&&need>=20;
    if(!isQBNeed&&need<20)return null;
    return{targetPick:targetPick,cost:cost,prospect:{name:prospect.name,pos:prospect.pos,ovr:prospect.ovr},picks:futurePicks.slice(0,cost)};
  },
  makeOffer:function(aiTeam,userPick,pickNum){
    if(!aiTeam||!userPick)return null;
    var offer={from:aiTeam.abbr,fromIcon:aiTeam.icon,fromId:aiTeam.id,pickNum:pickNum};
    var futurePicks=(aiTeam.draftPicks||[]).filter(function(pk){return pk.round>=2;});
    offer.picks=futurePicks.slice(0,Math.min(2,futurePicks.length));
    var tradeable=(aiTeam.roster||[]).filter(function(p){return(p.ovr||50)>=65&&(p.ovr||50)<=78&&p.contract&&p.contract.years>=2;});
    if(tradeable.length>0&&RNG.ai()<0.3){
      var tp=tradeable[Math.floor(RNG.ai()*tradeable.length)];
      offer.player={name:tp.name,pos:tp.pos,ovr:tp.ovr,id:tp.id};
    }
    return offer;
  }
};
var REVENGE_GAME={
  check:function(teamA,teamB,rivalries){
    if(!rivalries||!teamA||!teamB)return null;
    var riv=null;
    (rivalries||[]).forEach(function(r){
      if(!r)return;
      var isMatch=(r.teamA===teamA.id&&r.teamB===teamB.id)||(r.teamA===teamB.id&&r.teamB===teamA.id);
      if(isMatch)riv=r;
    });
    if(!riv)return null;
    var hist=riv.history||{};
    var aLostLast=hist.lastResult&&hist.lastResult.loserId===teamA.id;
    var bLostLast=hist.lastResult&&hist.lastResult.loserId===teamB.id;
    var streak=hist.streak||0;
    var result=null;
    if(aLostLast&&Math.abs(streak)>=2){
      result={revengeTeam:teamA.id,revengeAbbr:teamA.abbr,revengeIcon:teamA.icon,
        streak:Math.abs(streak),heat:riv.heat||0,bonus:Math.min(5,Math.abs(streak))};
    }else if(bLostLast&&Math.abs(streak)>=2){
      result={revengeTeam:teamB.id,revengeAbbr:teamB.abbr,revengeIcon:teamB.icon,
        streak:Math.abs(streak),heat:riv.heat||0,bonus:Math.min(5,Math.abs(streak))};
    }
    if(!result&&(riv.heat||0)>=50){
      result={revengeTeam:null,isHeatRivalry:true,heat:riv.heat,bonus:2,
        label:"ðŸ”¥ HEATED RIVALRY"};
    }
    return result;
  },
  getBonus:function(revengeInfo,teamId){
    if(!revengeInfo)return 0;
    if(revengeInfo.revengeTeam===teamId)return revengeInfo.bonus||0;
    if(revengeInfo.isHeatRivalry)return revengeInfo.bonus||0;
    return 0;
  }
};
var ALL_TIME_RECORDS={
  categories:[
    {id:"passYds",label:"Passing Yards",pos:"QB",type:"season"},
    {id:"passTD",label:"Passing TDs",pos:"QB",type:"season"},
    {id:"rushYds",label:"Rushing Yards",pos:"RB",type:"season"},
    {id:"rushTD",label:"Rushing TDs",pos:"RB",type:"season"},
    {id:"recYds",label:"Receiving Yards",pos:"WR",type:"season"},
    {id:"rec",label:"Receptions",pos:"WR",type:"season"},
    {id:"sacks",label:"Sacks",pos:"DL",type:"season"},
    {id:"defINT",label:"Interceptions",pos:"DB",type:"season"},
    {id:"tackles",label:"Tackles",pos:"LB",type:"season"},
    {id:"teamWins",label:"Team Wins",pos:null,type:"team_season"},
    {id:"teamPF",label:"Points Scored",pos:null,type:"team_season"},
    {id:"teamPA",label:"Fewest Points Allowed",pos:null,type:"team_season",invert:true}
  ],
  buildRecords:function(history){
    var records={};
    ALL_TIME_RECORDS.categories.forEach(function(cat){records[cat.id]=[];});
    if(!history)return records;
    history.forEach(function(h){
      if(!h||!h.teams)return;
      h.teams.forEach(function(t){
        if(t.wins!==undefined)records.teamWins.push({val:t.wins,name:t.abbr,icon:t.icon||"",year:h.year});
        if(t.pointsFor!==undefined)records.teamPF.push({val:t.pointsFor,name:t.abbr,icon:t.icon||"",year:h.year});
        if(t.pointsAgainst!==undefined)records.teamPA.push({val:t.pointsAgainst,name:t.abbr,icon:t.icon||"",year:h.year});
        if(t.rosterSnap){
          t.rosterSnap.forEach(function(p){
            if(!p||!p.stats)return;
            var s=p.stats;
            if(s.passYds)records.passYds.push({val:s.passYds,name:p.name,pos:p.pos,team:t.abbr,year:h.year});
            if(s.passTD)records.passTD.push({val:s.passTD,name:p.name,pos:p.pos,team:t.abbr,year:h.year});
            if(s.rushYds)records.rushYds.push({val:s.rushYds,name:p.name,pos:p.pos,team:t.abbr,year:h.year});
            if(s.rushTD)records.rushTD.push({val:s.rushTD,name:p.name,pos:p.pos,team:t.abbr,year:h.year});
            if(s.recYds)records.recYds.push({val:s.recYds,name:p.name,pos:p.pos,team:t.abbr,year:h.year});
            if(s.rec)records.rec.push({val:s.rec,name:p.name,pos:p.pos,team:t.abbr,year:h.year});
            if(s.sacks)records.sacks.push({val:s.sacks,name:p.name,pos:p.pos,team:t.abbr,year:h.year});
            if(s.defINT)records.defINT.push({val:s.defINT,name:p.name,pos:p.pos,team:t.abbr,year:h.year});
            if(s.tackles)records.tackles.push({val:s.tackles,name:p.name,pos:p.pos,team:t.abbr,year:h.year});
          });
        }
      });
    });
    ALL_TIME_RECORDS.categories.forEach(function(cat){
      if(cat.invert){records[cat.id].sort(function(a,b){return a.val-b.val;});}
      else{records[cat.id].sort(function(a,b){return b.val-a.val;});}
      records[cat.id]=records[cat.id].slice(0,10);// Top 10
    });
    return records;
  }
};
var SIM_CULL={
  matchupOVR:function(t,opp){
    var getUnit=function(roster,pos,n){
      var players=(roster||[]).filter(function(p){return p.pos===pos&&!(p.injury&&p.injury.games>0);})
        .sort(function(a,b){return b.ovr-a.ovr;});
      if(!players.length)return 50;
      var take=Math.min(n||3,players.length);
      var total=0;for(var i=0;i<take;i++)total+=players[i].ovr;
      return total/take;
    };
    var off=(getUnit(t.roster,"QB",1)*2+getUnit(t.roster,"OL",5)+getUnit(t.roster,"WR",3)+getUnit(t.roster,"RB",1)+getUnit(t.roster,"TE",1))/6;
    var def=(getUnit(opp.roster,"DL",4)*1.5+getUnit(opp.roster,"LB",3)+getUnit(opp.roster,"CB",3)+getUnit(opp.roster,"S",2))/4.5;
    var stK=getUnit(t.roster,"K",1);
    var schemeMod=0;
    if(t.gameplanOff&&t.gameplanOff!=="balanced_o")schemeMod+=1;
    if(t.gameplanDef&&t.gameplanDef!=="balanced_d")schemeMod+=0.5;
    return {offStrength:Math.round(off*10)/10,defStrength:Math.round(def*10)/10,specialTeams:stK,schemeBonus:schemeMod,diff:Math.round((off-def)*10)/10};
  },
  simAIGame:function(home,away,isPreseason,rngFn){
    var hM=this.matchupOVR(home,away);
    var aM=this.matchupOVR(away,home);
    var rng2=rngFn||RNG.play;// v71: always use seeded RNG
    var baseScore=21;
    var homePrepBonus91=0;var awayPrepBonus91=0;
    var awayKey91="oppIntel_"+(away._week91||"")+"_"+(away.id||away.abbr);// key by team id
    var homeKey91="oppIntel_"+(home._week91||"")+"_"+(home.id||home.abbr);
    if(home._oppIntel91){var hi=Object.values?Object.values(home._oppIntel91):[];// safely iterate
      if(hi&&hi.length){hi.forEach(function(v){if(v&&v.prepBonus&&v.prepBonus>0)homePrepBonus91+=v.prepBonus;});}}
    if(away._oppIntel91){var ai2=[];var aiKeys=Object.keys(away._oppIntel91||{});aiKeys.forEach(function(k){ai2.push(away._oppIntel91[k]);});
      ai2.forEach(function(v){if(v&&v.prepBonus&&v.prepBonus>0)awayPrepBonus91+=v.prepBonus;});}
    var hScore=Math.max(0,Math.round(baseScore+(hM.diff*0.8)+(hM.schemeBonus)+(rng2()*14-7)+3+homePrepBonus91));// +3 home field
    var aScore=Math.max(0,Math.round(baseScore+(aM.diff*0.8)+(aM.schemeBonus)+(rng2()*14-7)+awayPrepBonus91));
    if(hScore===aScore){if(rng2()>0.5)hScore+=3;else aScore+=3;}
    var mockQtrs=function(total){
      var q=[0,0,0,0];var rem=total;
      for(var qi=0;qi<3;qi++){var qPts=Math.round(rem*(0.2+rng2()*0.15));qPts=Math.min(qPts,rem);q[qi]=qPts;rem-=qPts;}
      q[3]=rem;return q;
    };
    var hQ=mockQtrs(hScore);var aQ=mockQtrs(aScore);
    var mockStats=function(team,pts2,matchup){
      var qb1=(team.roster||[]).filter(function(p){return p.pos==="QB";}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      var rb1=(team.roster||[]).filter(function(p){return p.pos==="RB";}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      var wr1=(team.roster||[]).filter(function(p){return p.pos==="WR";}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      var te1=(team.roster||[]).filter(function(p){return p.pos==="TE";}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      // v98: Calibrated from 2018 NFL play-by-play data (45,849 plays, 256 games)
      // Real per-game averages at 23.3 pts: QB 246yd/1.6TD, RB 63yd/0.5TD, WR1 55yd
      var passYds=Math.round(120+pts2*5+matchup.offStrength*0.2+(rng2()*70-35));
      var rushYds=Math.round(25+pts2*1.3+matchup.offStrength*0.12+(rng2()*40-20));
      // TDs: round-based for proper distribution (floor clips too aggressively)
      var passTD=Math.max(0,Math.round(pts2/7*0.48+(rng2()-0.5)*2));
      var rushTD=rng2()<(pts2*0.021)?1:0;// probability-based: 23ptsâ†’46% chance, 35ptsâ†’74%
      var ints=Math.max(0,Math.round(rng2()*2.0-0.2));// real: 0.79/game avg
      // Real: 2.8 sacks/team/game (10th: 1, 90th: 5)
      var sacks=Math.max(0,Math.round(rng2()*4+0.5));
      var fgs=Math.max(0,Math.floor((pts2%7)/3+(rng2()-0.3)));
      if(qb1){qb1.stats.passYds=(qb1.stats.passYds||0)+passYds;qb1.stats.passTD=(qb1.stats.passTD||0)+passTD;qb1.stats.int=(qb1.stats.int||0)+ints;qb1.stats.gp=(qb1.stats.gp||0)+1;qb1.stats.snaps=(qb1.stats.snaps||0)+55;}
      if(rb1){rb1.stats.rushYds=(rb1.stats.rushYds||0)+rushYds;rb1.stats.rushTD=(rb1.stats.rushTD||0)+rushTD;rb1.stats.gp=(rb1.stats.gp||0)+1;rb1.stats.snaps=(rb1.stats.snaps||0)+40;}
      // Real WR1: 22% of team pass yds, 4.8 rec/game; TE: 10% of pass yds
      if(wr1){wr1.stats.recYds=(wr1.stats.recYds||0)+Math.round(passYds*0.22);wr1.stats.rec=(wr1.stats.rec||0)+Math.round(2+rng2()*5);wr1.stats.recTD=(wr1.stats.recTD||0)+Math.max(0,passTD-1);wr1.stats.gp=(wr1.stats.gp||0)+1;wr1.stats.snaps=(wr1.stats.snaps||0)+50;}
      if(te1){te1.stats.recYds=(te1.stats.recYds||0)+Math.round(passYds*0.10);te1.stats.rec=(te1.stats.rec||0)+Math.round(1+rng2()*3);te1.stats.gp=(te1.stats.gp||0)+1;te1.stats.snaps=(te1.stats.snaps||0)+45;}
      var dls=(team.roster||[]).filter(function(p){return(p.pos==="DL"||p.pos==="LB")&&!(p.injury&&p.injury.games>0);}).sort(function(a,b){return b.ovr-a.ovr;}).slice(0,5);
      var cbs=(team.roster||[]).filter(function(p){return(p.pos==="CB"||p.pos==="S")&&!(p.injury&&p.injury.games>0);}).sort(function(a,b){return b.ovr-a.ovr;}).slice(0,4);
      dls.forEach(function(d){d.stats.tackles=(d.stats.tackles||0)+Math.round(2+rng2()*4);d.stats.gp=(d.stats.gp||0)+1;d.stats.snaps=(d.stats.snaps||0)+50;});
      // v98: Distribute sacks across 1-2 pass rushers (real NFL: top guy gets ~40% of team sacks)
      if(sacks>0&&dls.length>0){
        var sack1=Math.ceil(sacks*0.6);var sack2=sacks-sack1;
        var sg1=dls[Math.floor(rng2()*Math.min(2,dls.length))];sg1.stats.sacks=(sg1.stats.sacks||0)+sack1;
        if(sack2>0&&dls.length>1){var sg2=dls[1+Math.floor(rng2()*Math.min(2,dls.length-1))];sg2.stats.sacks=(sg2.stats.sacks||0)+sack2;}
      }
      cbs.forEach(function(c){c.stats.tackles=(c.stats.tackles||0)+Math.round(1+rng2()*3);c.stats.gp=(c.stats.gp||0)+1;c.stats.snaps=(c.stats.snaps||0)+50;});
      if(ints>0&&cbs.length>0){var intGuy=cbs[Math.floor(rng2()*Math.min(3,cbs.length))];intGuy.stats.defINT=(intGuy.stats.defINT||0)+1;}
      return {passYds:passYds,rushYds:rushYds,passTD:passTD,rushTD:rushTD,ints:ints,
        sacks:sacks,fgM:fgs,punts:Math.round(2+rng2()*3),totalTDs:passTD+rushTD,totalFGs:fgs,
        penalties:Math.round(3+rng2()*7),penYds:Math.round(20+rng2()*65),
        thirdDown:Math.round(8+rng2()*7),thirdConv:Math.round(2+rng2()*5),
        TOP:Math.round(27+rng2()*7)};
    };
    var hBox=mockStats(home,hScore,hM);
    var aBox=mockStats(away,aScore,aM);
    [home,away].forEach(function(t){
      t.roster.filter(function(p){return !(p.injury&&p.injury.games>0);}).forEach(function(p){
        if(!p.stats)p.stats={gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0,fumbles:0,punts:0,puntYds:0};
        if(p.isStarter)p.stats.snaps+=(isPreseason?30:60);
        else p.stats.snaps+=(isPreseason?35:Math.floor(2+rng2()*9));
      });
      t.roster.filter(function(p){return !(p.injury&&p.injury.games>0);}).slice(0,46).forEach(function(p){p.stats.gp=(p.stats.gp||0)+1;});
    });
    var dS=DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro;
    [home,away].forEach(function(t){
      var medLvl=t.facilities?t.facilities.med||0:0;
      var injChance=(0.38-(medLvl*0.04))*dS.injMod*(DNA_ACTIVE.injuryRate||1.0);
      if(RNG.injury()<injChance){
        var pool=(t.roster||[]).filter(function(p){return p&&!(p.injury&&p.injury.games>0)&&p.pos!=="K"&&p.pos!=="P";});
        if(pool.length===0)return;
        // v95.3: IRONMAN skips 60% of injury draws; v95.7: WORKHORSE skips 30%
        var eligPool95wk=pool.filter(function(p){
          if(hasTrait95(p,"ironman")&&RNG.injury()<0.60)return false;
          if(hasTrait95(p,"workhorse")&&RNG.injury()<0.30)return false;// v95.7: workhorse injury resistance
          return true;
        });
        if(eligPool95wk.length===0)eligPool95wk=pool;
        var glassPriority=eligPool95wk.filter(function(p){return hasTrait95(p,"glass");});
        var v=(glassPriority.length>0&&RNG.injury()<0.5)?pick(glassPriority):pick(eligPool95wk);
        if(v)setPlayerInjury92(v,pick(["hamstring","knee","ankle","shoulder","concussion"]),Math.floor(1+RNG.injury()*(hasTrait95(v,"glass")?8:hasTrait95(v,"ironman")?3:hasTrait95(v,"workhorse")?4:6)));
      }
    });
    if(!isPreseason){
      [home,away].forEach(function(t,ii){
        var won=ii===0?hScore>aScore:aScore>hScore;
        var dMM=dS.moraleMod||1;
        var hasCaptain=t.roster.some(function(x){return hasTrait95(x,"captain")&&!(x.injury&&x.injury.games>0);});
        var hasCancer=t.roster.some(function(x){return hasTrait95(x,"cancer")&&!(x.injury&&x.injury.games>0);});
        var hasMentorWk=t.roster.some(function(x){return hasTrait95(x,"mentor")&&!(x.injury&&x.injury.games>0);});
        var hasVocalLeaderWk=false;
        var vlFloor95wk=45;
        (t.roster||[]).forEach(function(x){
          if(!(hasTrait95(x,"vocal_leader")&&x.isStarter&&!(x.injury&&x.injury.games>0)))return;
          hasVocalLeaderWk=true;
          var vlPower95=(x.traitPowerLevel95&&x.traitPowerLevel95["vocal_leader"])||0;
          if(vlPower95>=2)vlFloor95wk=Math.max(vlFloor95wk,52);
          else if(vlPower95>=1)vlFloor95wk=Math.max(vlFloor95wk,48);
        });
        t.roster.forEach(function(p){
          var md=won?Math.floor(1+rng2()*3):Math.round(Math.floor(-4+rng2()*4)*dMM);
          // v95.3: Morale FX from ALL traits95 (was single p.trait only)
          getPlayerTraits95(p).forEach(function(tk){var fx95=TRAIT_FX[tk];if(fx95&&typeof fx95.morale==="number")md+=Math.round(fx95.morale*0.3);});
          if(hasTrait95(p,"comeback_kid")&&!won)md+=2;// Comeback Kid galvanized by loss
          if(hasTrait95(p,"hometown_hero")&&won)md+=1;// Hometown Hero extra joy from W
          if(hasCaptain)md+=1;if(hasCancer)md-=1;if(hasMentorWk&&!won)md+=1;
          var newMorale=cl((p.morale||70)+md,30,99);
          // v95.7/v95.9: team-level vocal leader morale floor (uses highest active vocal_leader power)
          if(hasVocalLeaderWk&&!won&&newMorale<vlFloor95wk)newMorale=vlFloor95wk;
          p.morale=newMorale;
        });
      });
    }
    var mockLeaders=function(team){
      var qb2=(team.roster||[]).filter(function(p){return p.pos==="QB";}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      var rb2=(team.roster||[]).filter(function(p){return p.pos==="RB";}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      return {
        pass:qb2?{name:qb2.name,yds:qb2.stats.passYds||0,td:qb2.stats.passTD||0,int:qb2.stats.int||0}:null,
        rush:rb2?{name:rb2.name,yds:rb2.stats.rushYds||0,td:rb2.stats.rushTD||0}:null,
        rec:[],sack:[],ints:[]
      };
    };
    return {home:hScore,away:aScore,homeId:home.id,awayId:away.id,
      log:[home.abbr+" "+hScore+" - "+away.abbr+" "+aScore+" (fast sim)"],
      tape:[],
      recap:{home:{},away:{}},
      qtrs:{h:hQ,a:aQ},
      box:{home:hBox,away:aBox},
      leaders:{home:mockLeaders(home),away:mockLeaders(away)},
      coachImpact:{home:{traits:[],edge:0},away:{traits:[],edge:0}},
      coachTriggers:{home:{},away:{}},
      weather:null,halftime:null,captainMoments:null,practiceFocus:null,gameplan:null,
      culled:true};
  }
};
var TRUST_TREND={
  getArrow:function(current,lastAvg){
    if(!lastAvg&&lastAvg!==0)return "âž¡ï¸";
    var diff=current-lastAvg;
    if(diff>=5)return "ðŸ“ˆ";
    if(diff<=-5)return "ðŸ“‰";
    if(diff>=2)return "â†—ï¸";
    if(diff<=-2)return "â†˜ï¸";
    return "âž¡ï¸";
  }
};
var AGING_V2={
  getMultiplier:function(ratingName,phase,posWeight){
    var isPhysical=["speed","acceleration","agility","stamina","strength","power",
      "elusiveness","jumping","toughness","durability","changeOfDirection","catchup"].indexOf(ratingName)!==-1;
    var isMental=["awareness","playRecognition","fieldVision","decisionSpeed","leadership",
      "clutch","discipline","assignmentIQ","fieldGoalIQ","fieldSense","iceVeins","confidence"].indexOf(ratingName)!==-1;
    var isTechnique=["accuracy","shortAccuracy","deepAccuracy","routeRunning","handTechnique",
      "footwork","shortRoute","deepRoute","separation","pocketPresence","throwOnRun",
      "zoneCoverage","manCoverage","pressAbility","breakOnBall","passBlock","runBlock",
      "passBlockFinesse","runBlockFinesse","powerMoves","finesseMoves"].indexOf(ratingName)!==-1;
    if(isMental){
      if(phase==="peak"||phase==="prime")return -0.5;// Gain
      if(phase==="decline")return 0;// Holds steady
      return 0.3;// Twilight: very slow loss
    }
    if(isPhysical){
      if(phase==="peak")return 0;// No decline yet
      return posWeight>5?1.5:2.0;
    }
    if(isTechnique){
      if(phase==="peak"||phase==="prime")return 0;
      return 0.5;
    }
    return 1.0;// Default: normal decay
  }
};
var TRUST={
  leagueSnapshot:function(tradeState,teams){
    if(!tradeState||!tradeState.gmTrustByTeam)return null;
    var trustMap=tradeState.gmTrustByTeam;
    var total=0;var count=0;
    var tiers={high:0,mid:0,low:0};
    var friendliest={id:null,val:-999,label:""};
    var coldest={id:null,val:999,label:""};
    teams.forEach(function(t){
      if(t.isUser)return;// Skip self
      var tr=trustMap[t.id];
      if(tr===undefined||tr===null)tr=50;
      total+=tr;count++;
      if(tr>=65)tiers.high++;
      else if(tr<=35)tiers.low++;
      else tiers.mid++;
      if(tr>friendliest.val){friendliest={id:t.id,val:tr,label:t.abbr};}
      if(tr<coldest.val){coldest={id:t.id,val:tr,label:t.abbr};}
    });
    var avgTrust=count>0?Math.round(total/count):50;
    var recent=tradeState.recentTrades||[];
    var fleeceCount=0;var fairCount=0;var overpayCount=0;
    recent.forEach(function(r){
      if(r.classification==="fleece")fleeceCount++;
      else if(r.classification==="fair")fairCount++;
      else if(r.classification==="overpay")overpayCount++;
    });
    var reputation="Neutral";
    if(avgTrust>=75)reputation="Legendary";
    else if(avgTrust>=60)reputation="Respected";
    else if(avgTrust<=25)reputation="Blacklisted";
    else if(avgTrust<=40)reputation="Untrustworthy";
    else if(fleeceCount>=2)reputation="Shark";
    else if(overpayCount>=2)reputation="Pushover";
    else if(fairCount>=3)reputation="Fair Dealer";
    return {
      avgTrust:avgTrust,
      reputation:reputation,
      tiers:tiers,
      friendliest:friendliest,
      coldest:coldest,
      recentPattern:{fleeceCount:fleeceCount,fairCount:fairCount,overpayCount:overpayCount}
    };
  }
};
var PLAYER_ARCHETYPES={
  classify:function(p){
    if(!p||!p.pos)return null;
    var pos=p.pos;
    if(pos==="K"||pos==="P")return null;
    var r=p.ratings||{};
    function sc(keys){
      var s=0;
      for(var i=0;i<keys.length;i++){
        var k=keys[i];
        s+=((r[k]||50)-50);
      }
      return s;
    }
    function pick(list){
      var best=null;var bestS=-999999;
      for(var i=0;i<list.length;i++){
        var a=list[i];
        var s=sc(a.keys);
        if(s>bestS){bestS=s;best=a;}
      }
      if(!best)return null;
      return {archetype:best.id,label:best.label,emoji:best.emoji,description:best.desc};
    }
    if(pos==="QB")return pick([
      {id:"pocket_passer",label:"Pocket Passer",emoji:"ðŸŽ¯",desc:"Wins from the pocket with accuracy, poise, and vision.",keys:["pocketPresence","accuracy","fieldVision","decisionSpeed"]},
      {id:"dual_threat",label:"Dual Threat",emoji:"âš¡",desc:"Creates pressure with legs and breaks the pocket.",keys:["speed","scramble","acceleration","agility"]},
      {id:"game_manager",label:"Game Manager",emoji:"ðŸ§ ",desc:"Protects the ball and keeps the offense on schedule.",keys:["awareness","shortAccuracy","decisionSpeed","leadership"]},
      {id:"gunslinger",label:"Gunslinger",emoji:"ðŸ’£",desc:"Attacks downfield with big arm and aggressive throws.",keys:["arm","deepAccuracy","throwOnRun","release"]}
    ]);
    if(pos==="RB")return pick([
      {id:"power_back",label:"Power Back",emoji:"ðŸ¦¬",desc:"Runs through contact and finishes falling forward.",keys:["power","truckPower","breakTackle","strength"]},
      {id:"speed_back",label:"Speed Back",emoji:"ðŸŽï¸",desc:"Threatens the edge with burst and change of direction.",keys:["speed","acceleration","changeOfDirection","elusiveness"]},
      {id:"receiving_back",label:"Receiving Back",emoji:"ðŸ§¤",desc:"A mismatch in space as a route runner and pass catcher.",keys:["catching","routeRunning","ballCarrierVision","passProtection"]},
      {id:"all_purpose",label:"All-Purpose",emoji:"ðŸŒ€",desc:"Does a bit of everything: vision, elusiveness, and hands.",keys:["ballCarrierVision","elusiveness","catching","speed"]}
    ]);
    if(pos==="WR")return pick([
      {id:"deep_threat",label:"Deep Threat",emoji:"ðŸš€",desc:"Stretches the field and wins vertically.",keys:["speed","deepRoute","separation","spectacularCatch"]},
      {id:"possession",label:"Possession",emoji:"ðŸ§²",desc:"Moves the chains with reliable hands and routes.",keys:["catching","catchInTraffic","shortRoute","awareness"]},
      {id:"slot",label:"Slot",emoji:"ðŸ§¬",desc:"Quick separator underneath with YAC potential.",keys:["agility","shortRoute","release","yacAbility"]},
      {id:"red_zone",label:"Red Zone Target",emoji:"ðŸ—¼",desc:"Wins contested catches near the goal line.",keys:["jumping","catchInTraffic","spectacularCatch","strength"]}
    ]);
    if(pos==="TE")return pick([
      {id:"blocking_te",label:"Blocking TE",emoji:"ðŸ§±",desc:"Sets edges, moves bodies, and protects the pocket.",keys:["blocking","runBlocking","impactBlocking","passProtection"]},
      {id:"receiving_te",label:"Receiving TE",emoji:"ðŸŽ£",desc:"Primary receiving threat who attacks seams.",keys:["catching","routeRunning","speed","catchInTraffic"]},
      {id:"hybrid_te",label:"Hybrid",emoji:"âš–ï¸",desc:"Balanced two-way TE: reliable hands + functional blocking.",keys:["catching","blocking","routeRunning","impactBlocking"]}
    ]);
    if(pos==="OL")return pick([
      {id:"pass_protector",label:"Pass Protector",emoji:"ðŸ›¡ï¸",desc:"Anchors vs rush and keeps the QB clean.",keys:["passBlock","passBlockFinesse","anchorStrength","footwork"]},
      {id:"road_grader",label:"Road Grader",emoji:"ðŸšœ",desc:"Creates movement in the run game and finishes blocks.",keys:["runBlock","impactBlocking","strength","pullBlock"]},
      {id:"technician",label:"Technician",emoji:"ðŸ§°",desc:"Wins with technique, IQ, and assignment consistency.",keys:["handTechnique","footwork","assignmentIQ","awareness"]}
    ]);
    if(pos==="DL")return pick([
      {id:"power_rusher",label:"Power Rusher",emoji:"ðŸ’ª",desc:"Collapses pockets with strength and power moves.",keys:["strength","powerMoves","bullRush","blockShedding"]},
      {id:"speed_rusher",label:"Speed Rusher",emoji:"ðŸ’¨",desc:"Wins with get-off, bend, and pursuit.",keys:["speed","acceleration","finesseMoves","pursuit"]},
      {id:"run_stuffer",label:"Run Stuffer",emoji:"ðŸ§±",desc:"Holds gaps and erases inside runs.",keys:["runStop","blockShedding","strength","toughness"]}
    ]);
    if(pos==="LB")return pick([
      {id:"coverage_lb",label:"Coverage LB",emoji:"ðŸ›°ï¸",desc:"Range + instincts to handle backs and TEs.",keys:["coverage","zoneCoverage","speed","awareness"]},
      {id:"pass_rush_lb",label:"Pass Rush LB",emoji:"ðŸ¦‚",desc:"Pressure specialist with burst and pursuit.",keys:["passRush","acceleration","blockShedding","pursuit"]},
      {id:"thumper",label:"Thumper",emoji:"ðŸ”¨",desc:"Physical downhill tackler who sets the tone.",keys:["tackle","hitPower","strength","toughness"]}
    ]);
    if(pos==="CB")return pick([
      {id:"lockdown",label:"Lockdown",emoji:"ðŸ—ï¸",desc:"Sticks in coverage and limits separation.",keys:["manCoverage","coverage","speed","agility"]},
      {id:"ball_hawk",label:"Ball Hawk",emoji:"ðŸ¦…",desc:"Plays the ball and creates turnovers.",keys:["ballSkills","zoneCoverage","awareness","jumping"]},
      {id:"physical_cb",label:"Physical",emoji:"ðŸ§·",desc:"Disrupts routes and tackles aggressively.",keys:["pressAbility","hitPower","tackling","strength"]}
    ]);
    if(pos==="S")return pick([
      {id:"free_safety",label:"Free Safety",emoji:"ðŸ§Š",desc:"Deep range and instincts as the last line.",keys:["zoneCoverage","ballSkills","speed","awareness"]},
      {id:"strong_safety",label:"Strong Safety",emoji:"ðŸª“",desc:"Box defender who tackles and hits.",keys:["hitPower","tackling","strength","toughness"]},
      {id:"hybrid_s",label:"Hybrid",emoji:"ðŸ”",desc:"Can cover and support the run without being a liability.",keys:["coverage","zoneCoverage","tackling","speed"]}
    ]);
    return null;
  }
};
var ARCHETYPE_AGING={
  mods:{
    pocket_passer:{cliffShift:1,decayMult:0.85},// Technique-based, ages gracefully
    dual_threat:{cliffShift:-2,decayMult:1.4},// Speed-dependent, legs go fast
    game_manager:{cliffShift:2,decayMult:0.7},// Mental-based, the ageless wonder
    gunslinger:{cliffShift:0,decayMult:1.0},// Arm talent, average aging
    power_back:{cliffShift:1,decayMult:0.8},// Strength holds longer than speed
    speed_back:{cliffShift:-1,decayMult:1.5},// Burst goes first, devastating decline
    receiving_back:{cliffShift:1,decayMult:0.85},// Route craft ages well
    all_purpose:{cliffShift:0,decayMult:1.1},// Slight speed reliance
    deep_threat:{cliffShift:-1,decayMult:1.4},// Speed-dependent
    possession:{cliffShift:2,decayMult:0.75},// Hands and routes = ageless
    slot:{cliffShift:0,decayMult:1.1},// Agility fades moderately
    red_zone:{cliffShift:1,decayMult:0.9},// Size/hands don't fade fast
    blocking_te:{cliffShift:1,decayMult:0.8},// Strength/technique
    receiving_te:{cliffShift:0,decayMult:1.1},// Speed matters more
    hybrid_te:{cliffShift:0,decayMult:1.0},// Balanced
    pass_protector:{cliffShift:1,decayMult:0.85},
    road_grader:{cliffShift:0,decayMult:1.0},
    technician:{cliffShift:2,decayMult:0.7},// IQ-based, plays into late 30s
    power_rusher:{cliffShift:0,decayMult:0.9},
    speed_rusher:{cliffShift:-1,decayMult:1.35},// First step goes
    run_stuffer:{cliffShift:1,decayMult:0.8},// Strength+technique
    coverage_lb:{cliffShift:-1,decayMult:1.2},// Speed-dependent coverage
    pass_rush_lb:{cliffShift:0,decayMult:1.15},// Burst fades
    thumper:{cliffShift:1,decayMult:0.85},// Strength/instinct
    lockdown:{cliffShift:-1,decayMult:1.3},// Man coverage needs elite speed
    ball_hawk:{cliffShift:1,decayMult:0.85},// Instinct/vision
    physical_cb:{cliffShift:0,decayMult:1.0},// Balanced
    free_safety:{cliffShift:0,decayMult:1.15},// Speed-reliant
    strong_safety:{cliffShift:1,decayMult:0.85},// Physical
    hybrid_s:{cliffShift:0,decayMult:1.0}
  },
  getCurve:function(p){
    var baseCurve=AGE_CURVES[p.pos]||AGE_CURVES.WR;
    var arch=p.archetype?p.archetype.archetype||p.archetype:null;
    if(!arch||!this.mods[arch])return baseCurve;
    var mod=this.mods[arch];
    return {
      prime:[baseCurve.prime[0],baseCurve.prime[1]+Math.round(mod.cliffShift*0.5)],
      cliff:baseCurve.cliff+mod.cliffShift,
      decayRate:Math.round(baseCurve.decayRate*mod.decayMult*100)/100
    };
  }
};
var DB_CLEANER={
  findStale:function(db,currentYear,retention){
    if(!db)return[];
    var staleKeys=[];
    var cutoff=currentYear-retention;
    for(var key in db){
      if(Object.prototype.hasOwnProperty.call(db,key)){
        var parts=key.split("-");
        var year=parseInt(parts[0],10);
        if(!isNaN(year)&&year<cutoff)staleKeys.push(key);
      }
    }
    return staleKeys;
  },
  prune:function(db,currentYear,retention){
    if(!db)return{};
    var result=assign({},db);
    var stale=DB_CLEANER.findStale(db,currentYear,retention);
    stale.forEach(function(key){delete result[key];});
    return{db:result,pruned:stale.length};
  }
};
var PROSPECT_CLAIMS={
  CLAIM_TYPES:["durability","iq","hands","speed","motor","schemeFit"],
  SOURCE_MAP:{combine:["speed","motor","durability"],interview:["iq","schemeFit"],film:["hands","schemeFit","motor"]},
  generate:function(prospect,scoutType,pos){
    if(!prospect)return[];
    var candidates=[];
    var r=prospect.ratings||{};
    var validTypes=PROSPECT_CLAIMS.SOURCE_MAP[scoutType==="measurables"?"combine":scoutType==="film_study"?"film":scoutType]||[];
    validTypes.forEach(function(claimType){
      var strength=0;
      if(claimType==="speed"){
        var spd=r.speed||r.spd||0;
        if(prospect.combine&&prospect.combine.forty){
          strength=prospect.combine.forty<=4.35?3:prospect.combine.forty<=4.5?2:prospect.combine.forty<=4.6?1:0;
        }else{strength=spd>=88?3:spd>=78?2:spd>=70?1:0;}
      }else if(claimType==="hands"){
        var cth=r.catching||r.cth||r.hands||0;
        if(["WR","TE","RB"].indexOf(pos)>=0)strength=cth>=85?3:cth>=75?2:cth>=65?1:0;
        else if(["LB","CB","S"].indexOf(pos)>=0)strength=cth>=80?3:cth>=70?2:cth>=60?1:0;
      }else if(claimType==="iq"){
        var awr=r.awareness||r.awr||r.iq||0;
        strength=awr>=85?3:awr>=75?2:awr>=65?1:0;
      }else if(claimType==="motor"){
        var sta=r.stamina||r.sta||r.toughness||0;
        strength=sta>=85?3:sta>=75?2:sta>=65?1:0;
      }else if(claimType==="durability"){
        var dur=r.toughness||r.durability||r.stamina||0;
        strength=dur>=85?3:dur>=78?2:dur>=68?1:0;
      }else if(claimType==="schemeFit"){
        if(prospect.schemeFit||prospect.archetype)strength=2;
        else{var top=0;Object.keys(r).forEach(function(k){if(r[k]>top)top=r[k];});strength=top>=82?2:top>=72?1:0;}
      }
      if(strength>0)candidates.push({type:claimType,strength:strength,source:scoutType==="measurables"?"combine":scoutType==="film_study"?"film":scoutType});
    });
    var priority={"durability":0,"iq":1,"hands":2,"speed":3,"motor":4,"schemeFit":5};
    candidates.sort(function(a,b){return b.strength-a.strength||(priority[a.type]||9)-(priority[b.type]||9);});
    return candidates.slice(0,3);
  },
  verify:function(claims,rookiePlayer,gamesPlayed){
    if(!claims||claims.length===0)return null;
    var r=rookiePlayer.ratings||{};
    var s=rookiePlayer.stats||{};
    var pos=rookiePlayer.pos;
    var lowSnaps=gamesPlayed<4;
    var hits=[];var misses=[];var incomplete=[];
    var rawScore=0;var maxScore=0;
    claims.forEach(function(claim){
      var hit=false;var checkable=true;
      maxScore+=claim.strength;
      if(lowSnaps){
        checkable=false;
        var fallbackHit=false;
        if(claim.type==="speed")fallbackHit=(r.speed||r.spd||50)>=70;
        else if(claim.type==="hands")fallbackHit=(r.catching||r.cth||50)>=70;
        else if(claim.type==="iq")fallbackHit=(r.awareness||r.awr||50)>=70;
        else if(claim.type==="motor")fallbackHit=(r.stamina||r.toughness||50)>=70;
        else if(claim.type==="durability")fallbackHit=gamesPlayed>=2;
        else if(claim.type==="schemeFit")fallbackHit=(rookiePlayer.ovr||50)>=68;
        if(fallbackHit){rawScore+=claim.strength*0.5;hits.push(claim.type);}
        else{rawScore-=claim.strength*0.5;misses.push(claim.type);}
        incomplete.push(claim.type);
        return;
      }
      if(claim.type==="speed"){
        if(pos==="QB")hit=(s.rushYds||0)>50||(r.speed||r.spd||50)>=72;
        else if(pos==="RB")hit=s.rushYds>0&&(s.rushYds/(Math.max(1,s.rushAtt||s.gp*8)))>=4.0;
        else if(pos==="WR"||pos==="TE")hit=(s.recYds||0)>0&&(s.targets||1)>0&&(s.recYds/(s.targets||1))>=10;
        else hit=(r.speed||r.spd||50)>=72;
      }else if(claim.type==="hands"){
        if(["WR","TE"].indexOf(pos)>=0)hit=(s.rec||0)>=10&&(s.recTD||0)>=1;
        else if(pos==="RB")hit=(s.rec||0)>=5;
        else if(["LB","CB","S"].indexOf(pos)>=0)hit=(s.defINT||0)>=1;
        else hit=(r.catching||r.cth||50)>=70;
      }else if(claim.type==="iq"){
        if(pos==="QB")hit=(s.int||0)<=Math.max(2,Math.round(gamesPlayed*0.6));
        else if(["DL","LB"].indexOf(pos)>=0)hit=(s.sacks||0)>=2;
        else hit=(r.awareness||r.awr||50)>=70;
      }else if(claim.type==="motor"){
        hit=(s.snaps||0)>=gamesPlayed*3;// Active snap count
        if(!hit)hit=(r.stamina||r.toughness||50)>=72;
      }else if(claim.type==="durability"){
        hit=gamesPlayed>=Math.max(8,12);// Played most of the season
      }else if(claim.type==="schemeFit"){
        hit=(rookiePlayer.ovr||50)>=(rookiePlayer.pot?rookiePlayer.pot-8:65);
      }
      if(hit){rawScore+=claim.strength;hits.push(claim.type);}
      else{rawScore-=claim.strength;misses.push(claim.type);}
    });
    var norm=maxScore>0?rawScore/maxScore:0;
    var deltaConf=Math.round(norm*8);
    var status=incomplete.length===claims.length?"INCOMPLETE":norm>=0.5?"VERIFIED":norm<=-0.5?"MISREAD":"MIXED";
    var notes=lowSnaps?"Limited snaps: used ratings fallback":hits.length>0&&misses.length>0?
      "You nailed "+hits.join("/")+", missed on "+misses.join("/"):
      hits.length===claims.length?"Clean read â€” all claims confirmed":
      misses.length===claims.length?"Full bust â€” re-evaluate your scouting process":"";
    return{status:status,deltaConf:deltaConf,hits:hits,misses:misses,incomplete:incomplete,notes:notes};
  }
};
function buildBracketTree(playoffGames,teams){
  if(!playoffGames||playoffGames.length===0)return null;
  var rounds={wildcard:[],divisional:[],confChamp:[],superBowl:[]};
  playoffGames.forEach(function(g){
    if(!g)return;
    var r=g.round||"wildcard";
    if(rounds[r])rounds[r].push(g);
  });
  function toNode(g){
    if(!g)return null;
    var home=teams.find(function(t){return t.id===g.home;});
    var away=teams.find(function(t){return t.id===g.away;});
    return{home:{id:g.home,abbr:home?home.abbr:"?",icon:home?home.icon:"?",seed:g.homeSeed||0},
      away:{id:g.away,abbr:away?away.abbr:"?",icon:away?away.icon:"?",seed:g.awaySeed||0},
      homeScore:g.result?g.result.homeScore:null,awayScore:g.result?g.result.awayScore:null,
      played:!!g.played,winnerId:g.result?(g.result.homeScore>g.result.awayScore?g.home:g.away):null};
  }
  return{wildcard:rounds.wildcard.map(toNode),divisional:rounds.divisional.map(toNode),
    confChamp:rounds.confChamp.map(toNode),superBowl:rounds.superBowl.map(toNode)};
}
var HALL_OF_FAME_LOG=[];// [{name, pos, teams, inducted, score, highlights}]
var HOF_SPEECHES={
  workEthic:[
    "They said I wasn't big enough or fast enough. So I just worked harder than all of them.",
    "The rings are nice, but what I'll miss most is the 5 AM film sessions. The empty gym.",
    "Talent sets the floor, but sweat sets the ceiling. I left every drop I had on that field.",
    "I didn't take a single play off in my entire career. Not in practice, not on Sunday.",
    "To the young guys watching: there is no shortcut. You have to fall in love with the work."
  ],
  ambition:[
    "I told my coach on day one: I'm not here to just make the roster. I'm here to make history.",
    "You have to believe you're the best before anyone else does. I always knew I'd end up here.",
    "I chased perfection every single season. Sometimes we caught it. Sometimes we caught championships.",
    "Greatness isn't given, it's taken. I wanted to be the greatest to ever put on the cleats.",
    "I was never satisfied. Even after a Championship, all I could think about was the next one."
  ],
  greed:[
    "It's a business, and I always handled my business. But today is about the legacy we built.",
    "They called me selfish when I asked for what I was worth. But look at the banner. We all won.",
    "I always bet on myself. The contracts were nice, but this gold jacket? This is forever.",
    "You have to maximize your value in this league. I maximized mine on the field and in the office.",
    "I demanded a lot from my teams, but I gave them everything on Sundays. The investment paid off."
  ],
  loyalty:[
    "I had chances to leave. I had chances to chase a ring somewhere else. But this city is my home.",
    "To the fans: we bled together, we cried together, and we won together. I am one of you.",
    "You don't build a dynasty by jumping ship when things get hard. You plant your feet and build.",
    "I wore one jersey my entire career. In today's game, that means everything to me.",
    "My teammates are my brothers. I would have run through a brick wall for any of them."
  ],
  pressure:[
    "When the clock was ticking down, and the stadium was screaming... that's when I felt the most peace.",
    "Some guys run from the moment. I lived for the fourth quarter. I wanted the ball in my hands.",
    "The bright lights never blinded me. They just showed me exactly where I needed to go.",
    "Pressure is a privilege. If they are counting on you to win it, it means you're exactly where you belong.",
    "You don't become a Hall of Famer in the first quarter. You earn this jacket when the game is on the line."
  ],
  fallback:[
    "I gave everything I had to this game, and this game gave everything back.",
    "Nobody hands you a Hall of Fame career. You earn it one play at a time.",
    "I always said: be ready when your number is called. Mine was called a lot.",
    "To every coach, teammate, and fan who believed in me â€” this jacket is for all of us."
  ]
};
function getHOFSpeech(trait,rng2){
  var pool=HOF_SPEECHES[trait||"fallback"]||HOF_SPEECHES.fallback;
  return pool[Math.floor((rng2||Math.random)()*pool.length)];
}
function calcLegacyScore(playerName,history){
  var score=0;var highlights=[];
  var rings=0;var mvps=0;var dpoys=0;var roys=0;var totalYds=0;
  var seasonsPlayed=0;var peakOvr=0;var teamsArr={};
  var eliteSeasons=0;// Each elite season worth +8 pts â€” allows OL/DL/K to reach HOF via dominance
  history.forEach(function(h){
    if(!h.teams)return;
    h.teams.forEach(function(t){
      t.roster.forEach(function(p){
        if(p.name!==playerName)return;
        seasonsPlayed++;teamsArr[t.abbr]=true;
        if(p.ovr>peakOvr)peakOvr=p.ovr;
        if((p.ovr||0)>=90)eliteSeasons++;
        var st=p.stats||{};
        totalYds+=(st.passYds||0)+(st.rushYds||0)+(st.recYds||0);
        var pos=p.pos||"";
        var isSkill=(pos==="QB"||pos==="RB"||pos==="WR"||pos==="TE");
        if(!isSkill){
          totalYds+=(st.sacks||0)*50+(st.tackles||0)*2+(st.ffum||0)*30+(st.defINT||0)*40;
          if(pos==="K"||pos==="P")totalYds+=(st.fgMade||0)*20;
        }
      });
    });
    if(h.champId&&h.teams.some(function(t){return t.roster.some(function(p){return p.name===playerName;})&&(t.id===h.champId||t.abbr===h.champAbbr);})){
      rings++;highlights.push("ðŸ’ Champion Yr"+h.year);
    }
  });
  AWARD_HISTORY_LOG.forEach(function(ah){
    if(ah.mvp&&ah.mvp.name===playerName){mvps++;highlights.push("ðŸ† MVP Yr"+ah.year);}
    if(ah.dpoy&&ah.dpoy.name===playerName){dpoys++;highlights.push("ðŸ›¡ï¸ DPOY Yr"+ah.year);}
    if(ah.roy&&ah.roy.name===playerName){roys++;highlights.push("ðŸŒ± ROY Yr"+ah.year);}
  });
  score=(rings*20)+(mvps*25)+(dpoys*20)+(roys*10)+Math.floor(totalYds/1000)*3;
  score+=Math.min(32,eliteSeasons*8);// +8 per elite season, capped at 32 (4 seasons max bonus)
  if(peakOvr>=85&&eliteSeasons===0)score+=5;// Safety net for near-elite careers
  if(seasonsPlayed>=8)score+=10;
  if(eliteSeasons>=4)highlights.push("â­ "+eliteSeasons+"-time Elite Season");
  return{score:score,rings:rings,mvps:mvps,dpoys:dpoys,roys:roys,
    totalYds:totalYds,peakOvr:peakOvr,seasons:seasonsPlayed,eliteSeasons:eliteSeasons,
    teams:Object.keys(teamsArr),highlights:highlights};
}
function autoHallOfFame(teams,history,year){
  if(history.length<5)return[];// Need at least 5 seasons
  var currentNames={};
  teams.forEach(function(t){t.roster.forEach(function(p){currentNames[p.name]=true;});});
  var inducted=[];
  var lastSeason=history[history.length-1];
  if(!lastSeason||!lastSeason.teams)return[];
  var checked={};
  lastSeason.teams.forEach(function(ht){
    ht.roster.forEach(function(p){
      if(currentNames[p.name]||checked[p.name])return;
      checked[p.name]=true;
      if(HALL_OF_FAME_LOG.some(function(h){return h.name===p.name;}))return;
      var legacy=calcLegacyScore(p.name,history);
      if(legacy.score>=80){
        var hofSpeech=getHOFSpeech(p.trait||p.dominantTrait||"fallback",Math.random);
        var mfsnReaction=legacy.rings>=3?"A dynasty legend takes their rightful place in Canton.":legacy.mvps>=2?"Multiple MVP honors. The case was never in doubt.":legacy.eliteSeasons>=4?"Four seasons of elite dominance. That's a Hall of Fame career.":"A generational talent takes their rightful place in Canton.";
        var entry={name:p.name,pos:p.pos,teams:legacy.teams,inducted:year,
          score:legacy.score,peakOvr:legacy.peakOvr,highlights:legacy.highlights,
          rings:legacy.rings,mvps:legacy.mvps,seasons:legacy.seasons,totalYds:legacy.totalYds,
          eliteSeasons:legacy.eliteSeasons,trait:p.trait||p.dominantTrait||"fallback",
          speech:hofSpeech,mfsnReaction:mfsnReaction};// v93: ceremony data
        HALL_OF_FAME_LOG.push(entry);
        inducted.push(entry);
      }
    });
  });
  return inducted;
}
function buildCapFixes(team,year){
  if(!team)return[];
  var fixes=[];var cap=150+(year-2026)*2;// salary cap
  var used=0;team.roster.forEach(function(p){used+=((p.contract&&p.contract.salary)||0);});
  var dead=team.deadCap||0;var room=cap-used-dead;
  if(room>10)return[];// No fix needed
  var restructureCands=team.roster.filter(function(p){
    return p.contract&&p.contract.salary>=6&&(p.contract.years||0)>=2&&p.ovr>=70;
  }).sort(function(a,b){return b.contract.salary-a.contract.salary;}).slice(0,3);
  restructureCands.forEach(function(p){
    var savings=Math.round(p.contract.salary*0.3*10)/10;
    fixes.push({type:"restructure",emoji:"ðŸ”„",player:p.name,pos:p.pos,ovr:p.ovr,
      desc:"Convert $"+savings+"M to signing bonus (spread over "+p.contract.years+" yrs)",
      savings:savings,risk:"Adds future dead money if cut"});
  });
  var cutCands=team.roster.filter(function(p){
    return p.contract&&p.contract.salary>=3&&p.ovr<=72;
  }).sort(function(a,b){return (a.ovr-b.ovr)||(b.contract.salary-a.contract.salary);}).slice(0,3);
  cutCands.forEach(function(p){
    var deadHit=Math.round(((p.contract.guaranteed||0)-(p.contract.salary||0)*0.2)*10)/10;
    if(deadHit<0)deadHit=0;
    var netSavings=Math.round((p.contract.salary-deadHit)*10)/10;
    if(netSavings<=0)return;
    fixes.push({type:"cut",emoji:"âœ‚ï¸",player:p.name,pos:p.pos,ovr:p.ovr,
      desc:"Release for $"+netSavings+"M savings"+(deadHit>0?" (dead: $"+deadHit+"M)":""),
      savings:netSavings,risk:deadHit>0?"$"+deadHit+"M dead cap hit":"Clean release"});
  });
  var tradeCands=team.roster.filter(function(p){
    return p.contract&&p.contract.salary>=5&&p.ovr>=72&&p.ovr<=82;
  }).sort(function(a,b){return b.contract.salary-a.contract.salary;}).slice(0,2);
  tradeCands.forEach(function(p){
    fixes.push({type:"trade",emoji:"ðŸ¤",player:p.name,pos:p.pos,ovr:p.ovr,
      desc:"Trade to shed $"+p.contract.salary+"M (get picks/players back)",
      savings:p.contract.salary,risk:"Lose "+p.ovr+" OVR "+p.pos});
  });
  return fixes.sort(function(a,b){return b.savings-a.savings;});
}
var FILM={
  analyze:function(gameResult,hTeam,aTeam,myId){
    if(!gameResult)return null;
    var hS=gameResult.home||0,aS=gameResult.away||0;
    var isUserHome=hTeam&&hTeam.id===myId;
    var userScore=isUserHome?hS:aS;var oppScore=isUserHome?aS:hS;
    var userTeam=isUserHome?hTeam:aTeam;var oppTeam=isUserHome?aTeam:hTeam;
    var won=userScore>oppScore;var margin=Math.abs(userScore-oppScore);
    var recap=gameResult.recap||{};
    var userRecap=isUserHome?recap.home:recap.away;
    var oppRecap=isUserHome?recap.away:recap.home;
    var offGrade=FILM.gradeOff(userScore,userRecap);
    var defGrade=FILM.gradeDef(oppScore,oppRecap);
    var stGrade=FILM.gradeST(userRecap,oppRecap);
    var insights=[];
    if(userRecap){
      if((userRecap.sacks||0)>=4)insights.push({emoji:"ðŸ’¥",text:"Pass protection collapsed â€” "+(userRecap.sacks||0)+" sacks allowed. Consider max-protect or quicker tempo.",grade:"F"});
      if((userRecap.ints||0)>=2)insights.push({emoji:"ðŸ–ï¸",text:(userRecap.ints||0)+" interceptions thrown. Ball security was a problem.",grade:"D"});
      if((userRecap.rushYds||0)>=120)insights.push({emoji:"ðŸƒ",text:"Ground game dominated: "+(userRecap.rushYds||0)+" rushing yards.",grade:"A"});
      if((userRecap.passYds||0)>=300)insights.push({emoji:"ðŸŽ¯",text:"Air attack was elite: "+(userRecap.passYds||0)+" passing yards.",grade:"A"});
    }
    if(oppRecap){
      if((oppRecap.rushYds||0)>=150)insights.push({emoji:"âš ï¸",text:"Opponent ran for "+(oppRecap.rushYds||0)+" yards. Run defense needs work.",grade:"D"});
      if((oppRecap.passYds||0)>=350)insights.push({emoji:"âš ï¸",text:"Opponent threw for "+(oppRecap.passYds||0)+" yards. Secondary got burned.",grade:"D"});
    }
    if(insights.length===0){
      insights.push(won?{emoji:"âœ…",text:"Solid all-around performance. No major red flags.",grade:"B"}
        :{emoji:"ðŸ“‹",text:"Competitive game. Small margins made the difference.",grade:"C"});
    }
    var turning="Game controlled from start to finish.";
    if(margin<=3)turning="Came down to the final drive â€” a true nail-biter.";
    else if(margin<=7)turning="One-score game. Execution in the red zone was the difference.";
    else if(margin>=21)turning=won?"Dominant performance from start to finish.":"Outclassed in every phase. Back to the drawing board.";
    else if(!won&&margin>=14)turning="Fell behind early and couldn't recover.";
    return{won:won,margin:margin,userScore:userScore,oppScore:oppScore,
      userTeam:userTeam?userTeam.abbr:"?",oppTeam:oppTeam?oppTeam.abbr:"?",
      grades:{off:offGrade,def:defGrade,st:stGrade},
      overall:Math.round((offGrade+defGrade+stGrade)/3),
      insights:insights,turning:turning,weather:gameResult.weather||null,
      halftime:gameResult.halftime||null,// v63: Halftime adjustment info
      captainMoments:gameResult.captainMoments||null,// v64: Captain moments
      practiceFocus:gameResult.practiceFocus||null,// v64: Practice focus
      gameplan:gameResult.gameplan||null};// v64: Gameplan Lab
  },
  gradeOff:function(pts,recap){
    var g=70;g+=(pts-17)*1.5;// +1.5 per point above 17
    if(recap){
      g+=((recap.passYds||0)-200)*0.03;
      g+=((recap.rushYds||0)-80)*0.04;
      g-=((recap.sacks||0))*3;
      g-=((recap.ints||0))*8;
      g+=((recap.passTD||0))*4;
    }
    return cl(Math.round(g),0,99);
  },
  gradeDef:function(oppPts,oppRecap){
    var g=75;g-=(oppPts-17)*1.5;// -1.5 per opp point above 17
    if(oppRecap){
      g-=((oppRecap.passYds||0)-200)*0.02;
      g-=((oppRecap.rushYds||0)-80)*0.03;
      g+=((oppRecap.sacks||0))*3;// sacks on opponent = good
      g+=((oppRecap.ints||0))*6;
    }
    return cl(Math.round(g),0,99);
  },
  gradeST:function(ur,or){
    var g=72;// baseline
    if(ur&&ur.fgMade)g+=ur.fgMade*3;
    if(ur&&ur.fgMiss)g-=ur.fgMiss*5;
    return cl(Math.round(g),40,95);
  },
  letterGrade:function(n){return n>=90?"A+":n>=85?"A":n>=80?"B+":n>=75?"B":n>=65?"C+":n>=55?"C":n>=45?"D":"F";}
};
var AGENT_TYPES=[
  {id:"loyal",name:"Loyal Lifer",emoji:"ðŸ ",desc:"Stays where they are if the money is close",
    moneyWeight:0.3,winWeight:0.3,loyaltyWeight:0.8,ringWeight:0.2},
  {id:"mercenary",name:"Show Me the Money",emoji:"ðŸ’°",desc:"Always takes the highest offer",
    moneyWeight:0.95,winWeight:0.1,loyaltyWeight:0.05,ringWeight:0.1},
  {id:"ring_chaser",name:"Ring Chaser",emoji:"ðŸ’",desc:"Will take a discount to join a contender",
    moneyWeight:0.2,winWeight:0.9,loyaltyWeight:0.1,ringWeight:0.95},
  {id:"hometown",name:"Hometown Hero",emoji:"ðŸŸï¸",desc:"Heavily favors returning to original team",
    moneyWeight:0.4,winWeight:0.2,loyaltyWeight:0.95,ringWeight:0.15},
  {id:"spotlight",name:"Spotlight Seeker",emoji:"ðŸ“º",desc:"Wants a big market and a big role",
    moneyWeight:0.5,winWeight:0.3,loyaltyWeight:0.1,ringWeight:0.3}
];
function assignAgentType(player,rng2){
  if(player.agentType)return player.agentType;
  var r=rng2();
  if(player.age>=31)return r<0.35?"ring_chaser":r<0.55?"mercenary":r<0.75?"loyal":r<0.9?"hometown":"spotlight";
  if(player.age>=28)return r<0.25?"mercenary":r<0.45?"loyal":r<0.6?"ring_chaser":r<0.8?"hometown":"spotlight";
  return r<0.3?"mercenary":r<0.5?"spotlight":r<0.65?"loyal":r<0.8?"hometown":"ring_chaser";
}
function getAgentTypeObj(typeId){
  return AGENT_TYPES.find(function(a){return a.id===typeId;})||AGENT_TYPES[0];
}
function agentFAScore(player,team,offer,rng2){
  var agent=getAgentTypeObj(player.agentType||"loyal");
  var score=0;
  var salaryFactor=(offer||0)/Math.max(1,(player.ovr||50)*0.12);
  score+=salaryFactor*agent.moneyWeight*40;
  var foCapBonus79=FRONT_OFFICE.getBonus(team.frontOffice||[],"cap");
  score+=(offer||0)*foCapBonus79*0.2;// Max +10% perceived offer value
  var winPct=(team.wins||0)/Math.max(1,(team.wins||0)+(team.losses||0));
  score+=winPct*agent.winWeight*50;
  if((team.wins||0)>=10)score+=agent.ringWeight*25;
  if(player.formerTeam===team.id)score+=agent.loyaltyWeight*30;
  score+=rng2()*10;
  return Math.round(score);
}
function agentFAScoreV2(player,team,offerObj,rng2){
  var agent=getAgentTypeObj(player.agentType||"loyal");var score=0;
  score+=((offerObj.salary||0)/Math.max(1,(player.ovr||50)*0.12))*agent.moneyWeight*40;
  if(team.frontOffice){score+=(offerObj.salary||0)*FRONT_OFFICE.getBonus(team.frontOffice||[],"cap")*0.2;}
  var winPct=(team.wins||0)/Math.max(1,(team.wins||0)+(team.losses||0));score+=winPct*agent.winWeight*50;
  if((team.wins||0)>=10)score+=agent.ringWeight*25;
  if(player.formerTeam===team.id)score+=agent.loyaltyWeight*30;
  var rp=FA_ROLE_PITCH[offerObj.role||"DEPTH"]||FA_ROLE_PITCH.DEPTH;
  score+=(agent.id==="spotlight"?rp.weight*20:rp.weight*8);
  score+=(team.prestige||50)*0.15;
  var ra=team.roster&&team.roster.length>0?team.roster.reduce(function(s,p2){return s+p2.ovr;},0)/team.roster.length:65;
  score+=((ra-65)*0.5+((team.wins||0)>=10?10:(team.wins||0)>=8?5:0))*agent.ringWeight;
  if(offerObj.visitUsed)score+=15+rng2()*5;
  if((player.teamTenure||0)>=4&&player.formerTeam===team.id){score+=(0.05+Math.min(0.10,((player.teamTenure||4)-4)*0.025))*100*agent.loyaltyWeight;}
  var _faFx=getContractPersonalityEffects(player,{isFormerTeam:player.formerTeam===team.id,isContender:(team.wins||0)>=10});
  score+=_faFx.faScoreAdj;
  var fit86=calcPlayerIdentityFit(player,team);
  score+=(fit86.score-70)*0.9;
  if(fit86.score>=84)score+=6;
  else if(fit86.score<=55)score-=8;
  score+=rng2()*10;return Math.round(score);
}
var GOLDEN_SEED_CHECKS=[];
var GOLDEN_SEED_DRIFT=null;// v50: Stores drift details for UI alert
function recordGoldenSeed(season,teams,myId){
  if(GOLDEN_SEED_CHECKS.length>0)return;
  var champ=teams.slice().sort(function(a,b){return b.wins-a.wins;})[0];
  var topScorer=teams.reduce(function(acc,t){return acc.concat(t.roster);},[]).sort(function(a,b){return (b.stats?b.stats.passTD||0:0)-(a.stats?a.stats.passTD||0:0);})[0];
  GOLDEN_SEED_CHECKS.push({seed:SEED_GLOBAL,year:season.year,champAbbr:champ?champ.abbr:"?",champWins:champ?champ.wins:0,
    topScorerPos:topScorer?topScorer.pos:"?",check:"v"+SAVE_VERSION});
}
function validateGoldenSeed(prevCheck,season,teams){
  if(!prevCheck)return{valid:true,msg:"No baseline"};
  var champ=teams.slice().sort(function(a,b){return b.wins-a.wins;})[0];
  var drifts=[];
  if(prevCheck.champAbbr!==(champ?champ.abbr:"?"))drifts.push("Champ: expected "+prevCheck.champAbbr+", got "+(champ?champ.abbr:"?"));
  if(prevCheck.champWins!==(champ?champ.wins:0))drifts.push("Wins: expected "+prevCheck.champWins+", got "+(champ?champ.wins:0));
  if(drifts.length>0){
    GOLDEN_SEED_DRIFT={seed:prevCheck.seed,year:prevCheck.year,version:prevCheck.check,drifts:drifts,
      msg:"âš ï¸ DETERMINISM DRIFT DETECTED â€” RNG stream changed or sim logic mutated"};
    return{valid:false,msg:GOLDEN_SEED_DRIFT.msg,details:drifts};
  }
  return{valid:true,msg:"Seed determinism verified âœ…"};
}
function calcWeekDeltas(currentRecap,prevRecap){
  if(!currentRecap||!prevRecap)return null;
  var metrics=[
    {key:"pressureRate",label:"Pocket Win",icon:"ðŸ›¡ï¸"},
    {key:"turnovers",label:"Turnovers",icon:"ðŸ¦‹",invert:true},
    {key:"rzEff",label:"Red Zone",icon:"ðŸŽ¯"},
    {key:"coverageWin",label:"Coverage",icon:"ðŸ“¡"},
    {key:"runLaneAdv",label:"Run Lanes",icon:"ðŸƒ"}
  ];
  var deltas=[];
  metrics.forEach(function(m){
    var cur=currentRecap[m.key];var prev=prevRecap[m.key];
    if(cur!==undefined&&prev!==undefined){
      var d=cur-prev;
      if(Math.abs(d)>=3){// Only show meaningful changes
        deltas.push({key:m.key,label:m.label,icon:m.icon,prev:prev,cur:cur,delta:d,good:m.invert?d<0:d>0});
      }
    }
  });
  return deltas.length>0?deltas:null;
}
function attributeCause(delta,recentLedger){
  if(!recentLedger||recentLedger.length===0)return{cause:"Natural variance",confidence:"LOW",proofs:[]};
  var matches=[];
  recentLedger.forEach(function(e){
    if(e.type==="INJURY"&&(delta.key==="pressureRate"||delta.key==="coverageWin"))
      matches.push({cause:"Injury: "+((e.detail||{}).name||"player"),entry:e,relevance:3});
    if(e.type==="SCHEME_CHANGE")matches.push({cause:"Scheme change",entry:e,relevance:2});
    if(e.type==="TRADE")matches.push({cause:"Roster move",entry:e,relevance:2});
    if(e.type==="LOCKER_CHOICE")matches.push({cause:"Locker room decision",entry:e,relevance:1});
    if(e.type==="HATE_WEEK")matches.push({cause:"Rivalry energy",entry:e,relevance:1});
    if(e.type==="FIX_APPLIED"){
      var fixType=(e.detail||{}).fix||"";
      var fixRelevance=1;
      if((fixType==="quick_pass"||fixType==="power_run")&&delta.key==="pressureRate")fixRelevance=3;
      if(fixType==="conservative"&&delta.key==="turnovers")fixRelevance=3;
      if(fixType==="red_zone"&&delta.key==="rzEff")fixRelevance=3;
      matches.push({cause:"Fix: "+fixType,entry:e,relevance:fixRelevance});
    }
  });
  if(matches.length===0)return{cause:"Natural variance",confidence:"LOW",proofs:[]};
  matches.sort(function(a,b){return b.relevance-a.relevance;});
  var best=matches[0];
  var confidence=best.relevance>=3?"HIGH":best.relevance>=2?"MED":"LOW";
  return{cause:best.cause,confidence:confidence,proofs:matches.slice(0,3).map(function(m){return m.entry;})};
}
function buildRivalryBroadcast(team,opponent,rivalry,season){
  if(!rivalry||rivalry.heat<9)return null;
  var tier=rivalry.heat>=13?"BLOOD_FEUD":rivalry.heat>=9?"BITTER":"RIVALRY";
  var seriesRec=rivalry.a===team.id?(rivalry.seriesA||0)+"-"+(rivalry.seriesB||0):(rivalry.seriesB||0)+"-"+(rivalry.seriesA||0);
  var biggest=getBiggestMoment(rivalry.moments||[]);
  var keys=[];
  var oppQBs=opponent.roster.filter(function(p){return p.pos==="QB"&&!(p.injury&&p.injury.games>0);});
  var oppOL=opponent.roster.filter(function(p){return p.pos==="OL"&&!(p.injury&&p.injury.games>0);});
  var avgOL=oppOL.length>0?Math.round(oppOL.reduce(function(s,p){return s+p.ovr;},0)/oppOL.length):0;
  var oppCBs=opponent.roster.filter(function(p){return (p.pos==="CB"||p.pos==="S")&&!(p.injury&&p.injury.games>0);});
  var avgDB=oppCBs.length>0?Math.round(oppCBs.reduce(function(s,p){return s+p.ovr;},0)/oppCBs.length):0;
  var oppRBs=opponent.roster.filter(function(p){return p.pos==="RB"&&!(p.injury&&p.injury.games>0);});
  if(avgOL<68)keys.push({icon:"ðŸŽ¯",text:"Weak OL (avg "+avgOL+" OVR)",stat:"Blitz success +"+Math.round((68-avgOL)*1.5)+"%",plan:"Set: Aggressive Blitz",target:"QB pressure"});
  if(oppQBs.length>0&&oppQBs[0].ovr<72)keys.push({icon:"ðŸŽ¯",text:"QB vulnerability ("+oppQBs[0].name+" "+oppQBs[0].ovr+")",stat:"INT prob +"+(72-oppQBs[0].ovr)+"%",plan:"Set: Man Press / Zone Blitz",target:"Force turnovers"});
  if(avgDB<70)keys.push({icon:"ðŸŽ¯",text:"Exposed secondary (avg "+avgDB+" OVR)",stat:"Deep pass success +"+(70-avgDB)*2+"%",plan:"Set: Play Action / Air Raid",target:"WR1 deep shots"});
  if(oppRBs.length>0&&oppRBs[0].ovr>=80)keys.push({icon:"âš ï¸",text:"Elite RB ("+oppRBs[0].name+" "+oppRBs[0].ovr+")",stat:"Expect "+Math.round(oppRBs[0].ovr*0.8)+"+ rush yds",plan:"Set: Run Stop focus",target:"Stack the box"});
  if(opponent.losses>opponent.wins)keys.push({icon:"ðŸŽ¯",text:"Struggling ("+opponent.wins+"-"+opponent.losses+")",stat:"Morale likely low",plan:"Apply pressure early",target:"Jump ahead"});
  if(keys.length===0)keys.push({icon:"ðŸŽ¯",text:"Well-rounded team",stat:"No clear exploit",plan:"Execute your gameplan",target:"Discipline wins"});
  return{tier:tier,heat:rivalry.heat,seriesRecord:seriesRec,biggestMoment:biggest,
    keys:keys.slice(0,3),emoji:tier==="BLOOD_FEUD"?"ðŸ”¥ðŸ”¥ðŸ”¥":tier==="BITTER"?"ðŸ”¥ðŸ”¥":"ðŸ”¥"};
}
function calcFatigueMultiplier(snapsThisGame,maxSnaps){
  if(!maxSnaps||maxSnaps<=0)return 1.0;
  var usage=snapsThisGame/maxSnaps;
  if(usage>0.85)return 0.92;// Heavy usage = -8% effectiveness
  if(usage>0.7)return 0.96;
  return 1.0;
}
function calcGameScriptMult(teamScore,oppScore,pos,role){
  var diff=teamScore-oppScore;
  if(diff>=14){// Blowout lead â€” ground and pound
    if(pos==="RB"&&(role==="rb1"||role==="goal_line"))return 1.15;
    if(pos==="WR"&&role==="wr_deep")return 0.85;
  }else if(diff<=-14){// Down big â€” passing game
    if(pos==="WR")return 1.12;
    if(pos==="RB"&&role==="3rd_down")return 1.10;
    if(pos==="RB"&&role==="rb1")return 0.88;
  }else if(diff<=-7){// Down a score â€” slight pass lean
    if(pos==="WR"&&role==="wr_slot")return 1.06;
  }
  return 1.0;
}
function calc4QInjuryRisk(player,driveNum){
  if(driveNum<9)return 0;// Only late-game risk
  var baseRisk=0.008;// ~0.8% per late drive
  var stamina=player.ratings?player.ratings.stamina||50:50;
  if(stamina<40)baseRisk+=0.006;// Low stamina players more vulnerable
  else if(stamina<55)baseRisk+=0.003;
  if(hasTrait95(player,"glass"))baseRisk+=0.012;// Glass trait = significant 4Q risk
  if(hasTrait95(player,"ironman"))baseRisk-=0.005;// Ironman trait = resilient
  var snapsPlayed=player.stats?player.stats.snaps||0:0;
  if(snapsPlayed>400)baseRisk+=0.003;// Season workload accumulation
  var weeklyFatigue=player.weeklyFatigue||0;
  baseRisk+=weeklyFatigue*0.002;
  return Math.max(0,Math.min(0.04,baseRisk));// Cap at 4%
}
function applyFatigueCarryover(roster){
  // v97.1: Weekly fatigue tracks workload only; training gains are applied separately and are not reduced here.
  roster.forEach(function(p){
    var snaps=p.stats?p.stats.snaps||0:0;
    var gamesPlayed=p.stats?p.stats.gp||0:0;
    if(gamesPlayed<=0){p.weeklyFatigue=0;return;}
    var avgSnaps=snaps/gamesPlayed;
    if(avgSnaps>55)p.weeklyFatigue=Math.min(5,Math.round((avgSnaps-55)/5));
    else p.weeklyFatigue=Math.max(0,(p.weeklyFatigue||0)-1);// Recovery
  });
}
function calcRoleDevBonus(player,staffDevRating){
  if(!player.role)return 0;
  var pos=player.pos;var roles=ROLE_DEFS[pos];
  if(!roles)return 0;
  var rd=roles.find(function(r){return r.id===player.role;});
  if(!rd)return 0;
  var snaps=player.stats?player.stats.snaps||0:0;
  if(snaps<50)return 0;// Not enough playing time to benefit from role
  var roleWeeks=player.roleWeeks||0;
  var stabilityMult=roleWeeks>=4?1.0:roleWeeks>=2?0.6:0.3;// Need 4+ weeks in role for full bonus
  var idx=roles.indexOf(rd);
  var baseBonus=idx===0?2:idx===1?1:0;
  var staffMult=staffDevRating?1+(staffDevRating-50)*0.008:1.0;// 50=neutral, 80=+24%, 30=-16%
  return Math.round(baseBonus*stabilityMult*staffMult*10)/10;
}
function schemeFitGrade(p,offScheme,defScheme,team){
  var fit86=calcPlayerIdentityFit(p,team,offScheme,defScheme);
  return{score:fit86.score,letter:fit86.letter,tier:fit86.tier,
    base:fit86.baseScore,specialtyAdj:fit86.specialtyAdj,personalityAdj:fit86.personalityAdj,systemAdj:fit86.systemAdj,totalAdj:fit86.totalAdj,
    schemeId:fit86.schemeId,schemeLabel:fit86.schemeLabel,specialtyLabel:fit86.specialtyLabel};
}
var LOCKER_EVENTS=[
  {id:"players_meeting",label:"Players-Only Meeting",icon:"ðŸ—£ï¸",
    check:function(t){var vets=t.roster.filter(function(p){return(p.cliqueId||0)===0;});
      var avgChem=vets.length>0?vets.reduce(function(s,p){return s+(p.chemistry||60);},0)/vets.length:60;
      return avgChem<35&&vets.length>=3;},
    apply:function(t){t.roster.forEach(function(p){p.morale=cl((p.morale||70)+2,30,99);});// +2 morale floor
      t.roster.forEach(function(p){if((p.cliqueId||0)===0)p.chemistry=cl((p.chemistry||60)+4,15,100);});
      t.roster.forEach(function(p){if(p.devBonus===undefined)p.devBonus=0;p.devBonus-=1;});},
    msg:"Veterans held a players-only meeting. Morale steadied, vets bonding â€” but practice time lost (-1 dev this week).",color:"gold"},
  {id:"captain_rally",label:"Captain's Rally",icon:"Â©ï¸",
    check:function(t){var hasCap=t.roster.some(function(p){return hasTrait95(p,"captain")||hasTrait95(p,"vocal_leader");});// v95.6
      var loseStreak=Math.abs(Math.min(0,(t.streak||0)));return hasCap&&loseStreak>=2;},
    apply:function(t){t.roster.forEach(function(p){p.chemistry=cl((p.chemistry||60)+5,15,100);});},
    msg:"Captain rallied the locker room after losing streak. All cliques chemistry +5.",color:"green"},
  {id:"rookie_hazing",label:"Rookie Hazing Gone Wrong",icon:"ðŸ˜¬",
    check:function(t){var rookies=t.roster.filter(function(p){return(p.cliqueId||0)===1;});
      var avgChem=rookies.length>0?rookies.reduce(function(s,p){return s+(p.chemistry||60);},0)/rookies.length:60;
      var hasCap=t.roster.some(function(p){return hasTrait95(p,"captain");});// v95.6: hasTrait95
      return avgChem<30&&rookies.length>=3&&!hasCap;},
    apply:function(t){t.roster.forEach(function(p){if((p.cliqueId||0)===1)p.systemFit=cl((p.systemFit||30)-2,0,100);});},
    msg:"Rookie hazing incident â€” Young Core systemFit dropped. A captain could prevent this.",color:"red"},
  {id:"star_demands",label:"Star Demands Spotlight",icon:"â­",
    check:function(t){var stars=t.roster.filter(function(p){return(p.cliqueId||0)===2&&(hasTrait95(p,"ego")||hasTrait95(p,"holdout"));});
      return stars.length>=1&&(t.losses||0)>=(t.wins||0);},
    apply:function(t){t.roster.forEach(function(p){if((p.cliqueId||0)===2)p.chemistry=cl((p.chemistry||60)-3,15,100);
      if((p.cliqueId||0)!==2)p.morale=cl((p.morale||70)-1,30,99);});},
    msg:"Star player demanding more touches. Stars clique chemistry dipped, team morale slightly shaken.",color:"orange"},
  {id:"winning_culture",label:"Winning Culture Taking Hold",icon:"ðŸ†",
    check:function(t){return(t.streak||0)>=4;},
    apply:function(t){t.roster.forEach(function(p){p.chemistry=cl((p.chemistry||60)+3,15,100);
      p.morale=cl((p.morale||70)+2,30,99);});},
    msg:"4-game win streak! Winning culture taking hold â€” chemistry and morale rising across the board.",color:"gold"},
  {id:"cancer_spreads",label:"Locker Room Cancer Spreads",icon:"â˜¢ï¸",
    check:function(t){var cancers=t.roster.filter(function(p){return hasTrait95(p,"cancer");});// v95.6
      return cancers.length>=1&&(t.losses||0)>=6;},
    apply:function(t){var cancerClique=(t.roster.find(function(p){return hasTrait95(p,"cancer");})||{}).cliqueId||0;// v95.6
      t.roster.forEach(function(p){if((p.cliqueId||0)===cancerClique)p.chemistry=cl((p.chemistry||60)-6,15,100);
        else p.chemistry=cl((p.chemistry||60)-2,15,100);});},
    msg:"Locker room cancer is spreading negativity. Chemistry crashing â€” consider cutting the source.",color:"red"},
  {id:"trade_rumors",label:"Trade Rumors Swirl",icon:"ðŸ“°",
    check:function(t){return t.roster.some(function(p){return p.onBlock;})&&
      t.roster.filter(function(p){return(p.chemistry||60)<40;}).length>=2;},
    apply:function(t){t.roster.forEach(function(p){if((p.chemistry||60)<40)p.chemistry=cl((p.chemistry||60)-2,15,100);});},
    msg:"Trade rumors swirling â€” unhappy players growing restless. Chemistry dropping for disgruntled players.",color:"orange"},
  {id:"contract_dispute",label:"Contract Dispute",icon:"ðŸ’°",
    check:function(t){return t.roster.some(function(p){return p.ovr>=82&&p.contract&&p.contract.years<=1&&p.age<=28;});},
    apply:function(t){var star=t.roster.find(function(p){return p.ovr>=82&&p.contract&&p.contract.years<=1&&p.age<=28;});
      if(star){star.chemistry=cl((star.chemistry||60)-4,15,100);star.contractDispute=true;}},
    msg:"Star player wants extension NOW â€” chemistry dropping until resolved. Check inbox for options.",color:"orange"},
  {id:"captain_injured",label:"Captain Sidelined",icon:"ðŸ¥",
    check:function(t){return t.roster.some(function(p){return(hasTrait95(p,"captain")||hasTrait95(p,"vocal_leader"))&&p.injury&&p.injury.games>0;});},
    apply:function(t){t.roster.forEach(function(p){p.systemFit=cl((p.systemFit||30)-1,0,100);});},
    msg:"Captain sidelined with injury â€” systemFit growth slowed across roster until return.",color:"red"},
  {id:"blowout_meeting",label:"Team Meeting After Blowout",icon:"ðŸ“‹",
    check:function(t){return(t.lastMargin||0)<=-21;},
    apply:function(t){t.roster.forEach(function(p){p.morale=cl((p.morale||70)+1,30,99);});t.blowoutMeeting=true;},
    msg:"Coaching staff called emergency meeting after blowout loss. Team refocused â€” morale steadied.",color:"gold"},
  {id:"media_leak",label:"Media Leak: Star Unhappy",icon:"ðŸ“º",chain:"star_demands",
    check:function(t){return(t.lastEvent||"")==="star_demands"&&(t.losses||0)>=(t.wins||0)&&
      t.roster.some(function(p){return(p.cliqueId||0)===2&&(p.chemistry||60)<35;});},
    apply:function(t){t.roster.forEach(function(p){p.morale=cl((p.morale||70)-1,30,99);});
      var unhappy=t.roster.find(function(p){return(p.cliqueId||0)===2&&(p.chemistry||60)<35;});
      if(unhappy)unhappy.tradeValue=(unhappy.tradeValue||100)-10;},// Trade value drops
    msg:"Media leaked star's unhappiness â€” national story. Morale dipped, trade value dropped for disgruntled star.",color:"red"},
  {id:"choice_team_meeting",label:"Call Team Meeting?",icon:"ðŸ—£ï¸",choice:true,
    check:function(t){return(t.losses||0)>=4&&(t.streak||0)<=-2;},
    msg:"After a rough stretch, do you call a team meeting?",color:"gold",
    options:[
      {label:"ðŸ“¢ Call Meeting",desc:"+3 morale, but -2 chemistry risk",action:"call_meeting"},
      {label:"ðŸ¤« Stay Quiet",desc:"No change â€” let them figure it out",action:"stay_quiet"}
    ]},
  {id:"choice_back_star",label:"Back the Star?",icon:"â­",choice:true,
    check:function(t){return t.roster.some(function(p){return p.contractDispute&&p.ovr>=82;});},
    msg:"Your star is unhappy about his contract. Do you publicly back him?",color:"orange",
    options:[
      {label:"ðŸ’ª Back the Star",desc:"+6 star chemistry, -2 team chemistry",action:"back_star"},
      {label:"ðŸ¢ Stay Neutral",desc:"+1 team chemistry, star stays upset",action:"stay_neutral"}
    ]},
  {id:"choice_fine_conduct",label:"Fine for Conduct?",icon:"âš–ï¸",choice:true,
    check:function(t){return t.roster.some(function(p){return hasTrait95(p,"cancer")&&(p.chemistry||60)<35;});},// v95.6
    msg:"Locker room cancer caught badmouthing coaches. Fine them?",color:"red",
    options:[
      {label:"ðŸ’° Fine Player",desc:"-3 morale, +2 discipline (fewer penalties)",action:"fine_player"},
      {label:"ðŸ¤ Private Talk",desc:"+1 cancer chemistry, -1 team morale",action:"private_talk"}
    ]},
  // â”€â”€ NEW CRISIS EVENTS v2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {id:"choice_trade_demand",label:"Star Demands Trade",icon:"ðŸšª",choice:true,
    check:function(t){return t.roster.some(function(p){return p.ovr>=85&&(p.morale||70)<40&&p.contract&&p.contract.years>=1;});},
    msg:"Your franchise star has officially requested a trade. The locker room is watching how you handle this.",color:"red",
    crisis:true,crisisTier:"URGENT",
    headline:"STAR DEMANDS OUT",
    subtext:"This will define your tenure. Handle it right or lose the locker room entirely.",
    options:[
      {label:"ðŸ”’ Lock Him In",desc:"Emergency meeting + max extension offer. +8 star morale, -$10M cap space",action:"lock_star_in"},
      {label:"ðŸ“£ Go Public",desc:"Call him out publicly. Forces his hand â€” might resolve it or blow up badly",action:"go_public_trade"},
      {label:"ðŸ“ž Listen to Offers",desc:"Tell him you'll shop him. Trade value maintained, locker room unease",action:"listen_offers"}
    ]},
  {id:"choice_faction_fight",label:"Locker Room Faction War",icon:"âš”ï¸",choice:true,
    check:function(t){
      var vets=t.roster.filter(function(p){return p.age>=28;}).length;
      var rooks=t.roster.filter(function(p){return p.age<=23;}).length;
      var avgMorale=t.roster.reduce(function(s,p){return s+(p.morale||70);},0)/Math.max(1,t.roster.length);
      return vets>=4&&rooks>=4&&avgMorale<55&&(t.losses||0)>=4;},
    msg:"Veterans and rookies are at each other's throats. Two factions have formed and it's getting ugly in practice.",color:"orange",
    crisis:true,crisisTier:"CRITICAL",
    headline:"LOCKER ROOM CIVIL WAR",
    subtext:"Two factions. One team. Your call as head coach will determine which group rallies behind you.",
    options:[
      {label:"ðŸ§“ Back the Vets",desc:"Veteran experience stabilizes ship. Rooks morale -5, vets +8, one vet dev boost",action:"back_vets"},
      {label:"âš¡ Back the Young Core",desc:"Inject energy + hunger. Vets morale -4, young core +10, one rook dev boost",action:"back_youngcore"},
      {label:"ðŸ¤ Mandatory Team Bonding",desc:"Force unity. Both groups +3 morale, -2 practice efficiency this week",action:"force_bonding"}
    ]},
  {id:"choice_fan_blowback",label:"Fan Base Turns on Team",icon:"ðŸ“¢",choice:true,
    check:function(t){return (t.losses||0)>=7&&(t.streak||0)<=-4;},
    msg:"Boo birds are out. Local media calling for coaching changes. Fans booing players off the field. The city has turned.",color:"red",
    crisis:true,crisisTier:"CRITICAL",
    headline:"CITY HAS TURNED",
    subtext:"Losing streaks kill fan bases. How you respond to public pressure will echo through your dynasty.",
    options:[
      {label:"ðŸŽ™ï¸ Hold Press Conference",desc:"Face the music. +5 owner confidence, team morale -2 but respect earned",action:"face_music"},
      {label:"ðŸšª Close the Doors",desc:"Shut out media. Focus internally. Team morale +3, owner confidence -3",action:"close_doors"},
      {label:"ðŸ”¥ Shake Up the Depth Chart",desc:"Bench struggling starters. Shock the system â€” some thrive, some crack",action:"shake_depth"}
    ]},
  {id:"choice_redemption_moment",label:"Redemption Arc Moment",icon:"âœ¨",choice:true,
    check:function(t){
      var hasSlump=t.roster.some(function(p){return p._arcState==="SLUMP"&&(p.morale||70)<50&&p.ovr>=78;});
      var winStreak=(t.streak||0)>=3;
      return hasSlump&&winStreak;},
    msg:"A struggling star is on the brink of a redemption moment. Three-game win streak has the city buzzing again. Do you give them the spotlight?",color:"gold",
    crisis:true,crisisTier:"OPPORTUNITY",
    headline:"REDEMPTION ON THE LINE",
    subtext:"This is a franchise-defining moment. The right call could create a legend.",
    options:[
      {label:"ðŸŒŸ Give Them the Spotlight",desc:"Feature them this week. If they deliver: +15 morale, arc resets to ELITE",action:"redemption_spotlight"},
      {label:"ðŸ“Š Ease Them Back Slowly",desc:"Protect their confidence. Steady +5 morale over 3 weeks, safer floor",action:"redemption_slow"},
      {label:"ðŸ”„ Let It Happen Organically",desc:"No spotlight, no pressure. Natural arc resolution, lower peak",action:"redemption_organic"}
    ]}
];
function checkLockerEvents(team,isUser){
  var triggered=null;
  for(var i=0;i<LOCKER_EVENTS.length;i++){
    var ev=LOCKER_EVENTS[i];
    if(ev.chain){
      if((team.lastEvent||"")===ev.chain&&ev.check(team)&&RNG.ai()<0.45){
        ev.apply(team);triggered=ev;break;
      }
      continue;
    }
    if(ev.choice){
      if(ev.check(team)&&RNG.ai()<0.30){// 30% trigger for choice events
        triggered=ev;break;// Don't apply â€” inbox will handle
      }
      continue;
    }
    if(ev.check(team)&&RNG.ai()<0.35){
      ev.apply(team);triggered=ev;break;
    }
  }
  team.lastEvent=triggered?triggered.id:"";
  return triggered;
}
function getCoachTraitMods(t){
  var mods={stallReduction:0,bigPlayBoost:0,rzTdBoost:0,pocketBoost:0,pressureBoost:0,
    bigPlayAllowed:0,intBoost:0,intReduction:0,moraleStability:0,moraleBoost:0,
    devRate:0,qbBoost:0,counterBoost:0};
  if(!t.staff)return mods;
  [t.staff.hc,t.staff.oc,t.staff.dc].forEach(function(c){
    if(!c||!c.traits)return;
    c.traits.forEach(function(tId){
      var def=COACH_TRAITS[tId];if(!def)return;
      Object.keys(def.effects).forEach(function(k){mods[k]=(mods[k]||0)+def.effects[k];});
    });
  });
  mods.stallReduction=Math.min(mods.stallReduction,0.07);
  mods.pocketBoost=Math.min(mods.pocketBoost,0.08);
  mods.pressureBoost=Math.min(mods.pressureBoost,0.08);
  mods.intBoost=Math.min(mods.intBoost,0.03);
  mods.qbBoost=Math.min(mods.qbBoost,6);
  mods.devRate=Math.min(mods.devRate,0.25);
  mods.moraleBoost=Math.min(mods.moraleBoost,8);
  return mods;
}
// TRAITS, TRAIT_FX, TRAIT_MILESTONES95 + helper functions â€” imported from src/systems/traits.js
var CALENDAR=[
  {week:0,phase:"preseason",event:"Training Camp",icon:"â›º",desc:"Evaluate roster, set depth chart"},
  {week:1,phase:"regular",event:"Opening Day",icon:"ðŸˆ",desc:"The season begins"},
  {week:4,phase:"regular",event:"Cut Day",icon:"âœ‚ï¸",desc:"Trim roster to 53"},
  {week:8,phase:"regular",event:"Midseason Review",icon:"ðŸ“Š",desc:"Owner evaluates progress"},
  {week:10,phase:"regular",event:"Trade Deadline",icon:"ðŸ””",desc:"Last chance to deal this season"},
  {week:14,phase:"regular",event:"Stretch Run",icon:"ðŸ",desc:"Playoff picture takes shape"},
  {week:18,phase:"regular",event:"Regular Season Ends",icon:"ðŸ“‹",desc:"Final standings set"},
  {week:18,phase:"playoffs",event:"Playoffs Begin",icon:"ðŸ†",desc:"Win or go home"},
  {week:21,phase:"offseason",event:"Championship",icon:"ðŸ’",desc:"One team claims glory"},
  {week:22,phase:"offseason",event:"Tag Window",icon:"ðŸ·ï¸",desc:"Franchise/Transition tags (2 max)"},
  {week:23,phase:"offseason",event:"Re-Sign Phase",icon:"âœï¸",desc:"Keep your core"},
  {week:24,phase:"offseason",event:"Free Agency",icon:"ðŸª",desc:"Open market"},
  {week:25,phase:"offseason",event:"Combine",icon:"ðŸ”¬",desc:"Scout the draft class"},
  {week:26,phase:"offseason",event:"Draft",icon:"ðŸ“º",desc:"Build the future"},
  {week:27,phase:"offseason",event:"Rookie Signings",icon:"ðŸ“",desc:"Welcome the class"},
  {week:28,phase:"offseason",event:"Owner Meeting",icon:"ðŸ¤µ",desc:"Annual performance review"}
];
var OWNER_TYPES=[
  {id:"patient",name:"Patient Builder",icon:"ðŸ§±",desc:"Values long-term growth",goalBias:["develop_rookie","cap_discipline","draft_well"]},
  {id:"win_now",name:"Win-Now Mandate",icon:"ðŸ†",desc:"Results or consequences",goalBias:["make_playoffs","win_division","win_sb"]},
  {id:"penny",name:"Penny Pincher",icon:"ðŸ’µ",desc:"Bottom line first",goalBias:["cap_discipline","revenue","no_dead_cap"]}
];
var OWNER_GOALS=[
  {id:"make_playoffs",label:"Make the Playoffs",check:function(ctx){return ctx.madePlayoffs;},exceed:function(ctx){return ctx.wonChamp;}},
  {id:"win_division",label:"Win the Division",check:function(ctx){return ctx.divRank===1;},exceed:function(ctx){return ctx.divRank===1&&ctx.wins>=12;}},
  {id:"win_sb",label:"Win the Championship",check:function(ctx){return ctx.wonChamp;},exceed:function(ctx){return ctx.wonChamp&&ctx.losses<=4;}},
  {id:"develop_rookie",label:"Develop a Rookie Starter",check:function(ctx){return ctx.rookieStarters>=1;},exceed:function(ctx){return ctx.rookieStarters>=2;}},
  {id:"cap_discipline",label:"Keep Cap Room Above $20M",check:function(ctx){return ctx.capRoom>=20;},exceed:function(ctx){return ctx.capRoom>=40;}},
  {id:"revenue",label:"Boost Revenue (Win 8+ Games)",check:function(ctx){return ctx.wins>=8;},exceed:function(ctx){return ctx.wins>=12;}},
  {id:"top_defense",label:"Top-10 Defense",check:function(ctx){return ctx.defRank<=10;},exceed:function(ctx){return ctx.defRank<=3;}},
  {id:"no_dead_cap",label:"Avoid Dead Cap Over $15M",check:function(ctx){return ctx.deadCap<=15;},exceed:function(ctx){return ctx.deadCap<=5;}},
  {id:"draft_well",label:"Draft a 70+ OVR Rookie",check:function(ctx){return ctx.bestRookieOvr>=70;},exceed:function(ctx){return ctx.bestRookieOvr>=78;}}
];
var STAT_HEADLINES=[
  {cond:function(g){return g&&g.passTD>=4;},text:"After throwing {passTD} TDs vs {opp}"},
  {cond:function(g){return g&&g.rushYds>=150;},text:"After rushing for {rushYds} yards vs {opp}"},
  {cond:function(g){return g&&g.sacks>=4;},text:"After {sacks} sacks vs {opp}"},
  {cond:function(g){return g&&g.ints>=2;},text:"After {ints} turnovers vs {opp}"},
  {cond:function(g){return g&&g.margin>21;},text:"After a {margin}-point blowout vs {opp}"},
  {cond:function(g){return g&&g.margin<=-21;},text:"After getting blown out by {opp}"},
  {cond:function(g){return g&&Math.abs(g.margin)<=3;},text:"After a nail-biter vs {opp}"},
  {cond:function(g){return g&&g.won&&g.streak>=3;},text:"Riding a {streak}-game win streak"},
  {cond:function(g){return g&&!g.won&&g.streak<=-3;},text:"Mired in a {streak}-game losing skid"},
  {cond:function(g){return g&&g.rushYds<50;},text:"After being held to {rushYds} rushing yards"},
  {cond:function(g){return g&&g.passTD===0&&g.ints>=2;},text:"After a scoreless passing performance with {ints} picks"},
  {cond:function(g){return g&&g.won;},text:"Coming off a win over {opp}"},
  {cond:function(g){return g&&!g.won;},text:"Coming off a loss to {opp}"}
];
function getStatHeadline(gameCtx){
  if(!gameCtx)return "";
  for(var i=0;i<STAT_HEADLINES.length;i++){
    var h=STAT_HEADLINES[i];
    if(h.cond(gameCtx)){
      return h.text.replace("{passTD}",gameCtx.passTD||0).replace("{rushYds}",gameCtx.rushYds||0)
        .replace("{sacks}",gameCtx.sacks||0).replace("{ints}",gameCtx.ints||0)
        .replace("{margin}",Math.abs(gameCtx.margin||0)).replace("{opp}",gameCtx.opp||"OPP")
        .replace("{streak}",Math.abs(gameCtx.streak||0));
    }
  }
  return "";
}
function getTraitMoraleExplainer(roster){
  var reasons=[];
  var hasCaptain=roster.some(function(p){return hasTrait95(p,"captain")&&!(p.injury&&p.injury.games>0);});// v95.6: hasTrait95
  var hasCancer=roster.some(function(p){return hasTrait95(p,"cancer")&&!(p.injury&&p.injury.games>0);});
  var hasMentor=roster.some(function(p){return hasTrait95(p,"mentor")&&!(p.injury&&p.injury.games>0);});
  var hasHothead=roster.some(function(p){return hasTrait95(p,"hothead")&&!(p.injury&&p.injury.games>0);});
  if(hasCaptain)reasons.push("Â©ï¸ Captain +1");
  if(hasCancer)reasons.push("â˜¢ï¸ Cancer -1");
  if(hasMentor)reasons.push("ðŸ“š Mentor +1 rookies");
  if(hasHothead)reasons.push("ðŸŒ¶ï¸ Hot Head -0.6");
  return reasons;
}
var STORY_TEMPLATES=[
  {id:"holdout",type:"Holdout Saga",icon:"ðŸ’°",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.player&&(hasTrait95(ctx.player,"mercenary")||hasTrait95(ctx.player,"cancer"))&&ctx.player.contract.years<=1&&ctx.player.ovr>=80;},// v95.6: hasTrait95
    states:["rumbling","public_demand","trade_request","resolved"],
    headlines:["ðŸ’° {name} wants a new deal â€” tensions rising","ðŸ“¢ {name}: 'Pay me what I'm worth'","ðŸ”¥ {name} demands trade if deal isn't done by Week {deadline}","âœ… {name} situation resolved"],
    duration:4,actions:[{id:"pay",label:"Pay Up (+$4M/yr)",cost:4},{id:"hold",label:"Hold Firm",cost:0},{id:"trade",label:"Shop Player",cost:0}]},
  {id:"rookie_spotlight",type:"Rookie Spotlight",icon:"â­",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.player&&ctx.player.age<=23&&ctx.player.devTrait!=="normal"&&ctx.weekNum>=3;},
    states:["hype","struggle","decision","breakout_or_bust"],
    headlines:["â­ Rookie {name} generating buzz","ðŸ˜° {name} hitting the rookie wall","ðŸ¤” Start {name} or sit?","ðŸš€ {name} breaks out!"],
    duration:6,actions:[{id:"start",label:"Keep Starting",cost:0},{id:"bench",label:"Bench & Develop",cost:0}]},
  {id:"rivalry_heat",type:"Rivalry Escalation",icon:"ðŸ”¥",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.weekNum>=6;},
    states:["trash_talk","dirty_play","revenge_game"],
    headlines:["ðŸ—£ï¸ {team1} vs {team2} war of words heats up","âš ï¸ Dirty hit sparks outrage","ðŸ¥Š Revenge game: {team1} wants payback"],
    duration:3,actions:[]},
  {id:"hot_seat",type:"Coaching Hot Seat",icon:"ðŸª‘",
    triggerFn:function(ctx){return ctx.losses>=ctx.wins+3&&ctx.weekNum>=8;},
    states:["media_pressure","ultimatum","decision"],
    headlines:["ðŸ“° Media questioning coaching decisions","âš ï¸ Owner issues ultimatum: win or else","ðŸª‘ Coaching change? Decision time."],
    duration:3,actions:[{id:"keep",label:"Keep Coach",cost:0},{id:"fire",label:"Fire Coach",cost:0}]},
  {id:"milestone",type:"Milestone Chase",icon:"ðŸ“ˆ",
    triggerFn:function(ctx){return ctx.player&&ctx.player.stats&&ctx.player.stats.gp>=8;},
    states:["approaching","one_away","achieved"],
    headlines:["ðŸ“ˆ {name} approaching franchise record","ðŸŽ¯ {name} ONE game away from history","ðŸ† {name} BREAKS the all-time record!"],
    duration:3,actions:[]},
  {id:"injury_comeback",type:"Injury Comeback",icon:"ðŸ¥",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.player&&ctx.player.injury&&ctx.player.injury.games>=4&&ctx.player.ovr>=75;},
    states:["surgery","rehab","setback_risk","return"],
    headlines:["ðŸ¥ {name} out with major injury â€” long road ahead","ðŸ‹ï¸ {name} grinding through rehab","âš ï¸ {name} comeback faces setback risk","ðŸŽ‰ {name} returns to action!"],
    duration:5,actions:[{id:"rush",label:"Rush Back (re-injury risk)",cost:0},{id:"patient",label:"Full Rehab (+2 wks)",cost:0}]},
  {id:"trade_rumor",type:"Trade Rumor Storm",icon:"ðŸ“±",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.weekNum>=4&&ctx.weekNum<=9&&ctx.player&&ctx.player.ovr>=78;},
    states:["whispers","national_story","locker_room_hit"],
    headlines:["ðŸ“± Trade whispers swirling around {name}","ðŸ“º {name} trade talks dominate headlines","ðŸ˜¤ Locker room reacts to {name} rumors"],
    duration:3,actions:[{id:"deny",label:"Deny Publicly",cost:0},{id:"listen",label:"Take Calls",cost:0}]},
  {id:"fa_frenzy",type:"Free Agent Frenzy",icon:"ðŸª",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.weekNum>=15;},
    states:["market_heats","bidding_war","deadline_pressure"],
    headlines:["ðŸª Offseason market heating up early","ðŸ’µ Bidding war erupts for top free agents","â° Sign now or lose them forever"],
    duration:3,actions:[{id:"spend",label:"Open the Wallet",cost:0},{id:"wait",label:"Stay Patient",cost:0}]},
  {id:"coaching_carousel",type:"Coaching Carousel",icon:"ðŸŽ ",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.weekNum>=14;},
    states:["rumors","interviews","poaching_threat"],
    headlines:["ðŸŽ  Coaching carousel begins across the league","ðŸŽ¤ Multiple teams requesting interview with your staff","ðŸš¨ {team2} trying to poach your coordinator!"],
    duration:3,actions:[{id:"block",label:"Block Interview",cost:0},{id:"allow",label:"Let Them Go",cost:0}]},
  {id:"qb_controversy",type:"QB Controversy",icon:"ðŸˆ",
    triggerFn:function(ctx){
      if(ctx.phase!=="regular"||ctx.weekNum<5)return false;
      var qbs=ctx.roster?ctx.roster.filter(function(p){return p.pos==="QB"&&!(p.injury&&p.injury.games>0);}):[];
      return qbs.length>=2&&qbs[0]&&qbs[1]&&Math.abs(qbs[0].ovr-qbs[1].ovr)<=6;},
    states:["murmurs","media_debate","coach_decides"],
    headlines:["ðŸˆ Backup QB generating locker room buzz","ðŸ“º 'Start the kid!' debate rages in media","ðŸŽ¯ QB decision: starter or switch?"],
    duration:4,actions:[{id:"start_vet",label:"Stick with Vet",cost:0},{id:"start_kid",label:"Start the Kid",cost:0}]},
  {id:"locker_split",type:"Locker Room Split",icon:"ðŸ’¥",
    triggerFn:function(ctx){
      if(ctx.phase!=="regular")return false;
      var hasHothead=ctx.roster?ctx.roster.some(function(p){return hasTrait95(p,"hothead")||hasTrait95(p,"cancer");}):false;// v95.6: hasTrait95
      var hasMentor=ctx.roster?ctx.roster.some(function(p){return hasTrait95(p,"mentor")||hasTrait95(p,"captain");}):false;
      return hasHothead&&hasMentor&&ctx.weekNum>=4;},
    states:["tension","confrontation","resolution"],
    headlines:["ðŸ’¥ Personality clash brewing in the locker room","ðŸ¤¬ Heated argument between veterans reported","ðŸ¤ Team meeting called â€” will they unite?"],
    duration:3,actions:[{id:"side_vet",label:"Back the Captain",cost:0},{id:"side_hot",label:"Back the Firestarter",cost:0},{id:"mediate",label:"Mediate",cost:0}]},
  {id:"contract_year",type:"Breakout Contract Year",icon:"ðŸ’Ž",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.player&&ctx.player.contract.years===1&&ctx.player.ovr>=74&&ctx.player.age<=28;},
    states:["motivated","balling_out","extension_window"],
    headlines:["ðŸ’Ž {name} playing with chip on shoulder","ðŸ”¥ {name} on a tear â€” contract year motivation","âœï¸ Extension window open for {name}"],
    duration:4,actions:[{id:"extend",label:"Extend Now ($$$)",cost:0},{id:"wait_fa",label:"Let Him Walk to FA",cost:0}]},
  {id:"rookie_wall",type:"Rookie Wall",icon:"ðŸ§±",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.weekNum>=10&&ctx.player&&ctx.player.age<=23;},
    states:["fatigue","slump","coaching_choice"],
    headlines:["ðŸ§± {name} showing signs of rookie fatigue","ðŸ“‰ {name}'s production drops â€” rookie wall?","ðŸ¤” Rest {name} or push through?"],
    duration:3,actions:[{id:"rest",label:"Reduce Snaps",cost:0},{id:"push",label:"Keep Playing Through",cost:0}]},
  {id:"record_chase",type:"Record Chase",icon:"ðŸ“Š",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.weekNum>=12&&ctx.player&&ctx.player.ovr>=85;},
    states:["on_pace","closing_in","record_day"],
    headlines:["ðŸ“Š {name} on pace for franchise record season","ðŸŽ¯ {name} needs one big game to make history","ðŸ† RECORD BROKEN! {name} etches name in stone!"],
    duration:4,actions:[]},
  {id:"underdog_run",type:"Underdog Run",icon:"ðŸº",
    triggerFn:function(ctx){return ctx.phase==="regular"&&ctx.weekNum>=10&&ctx.wins>=ctx.losses&&ctx.losses>=4;},
    states:["nobody_believes","winning_streak","cinderella"],
    headlines:["ðŸº Nobody believes in this team â€” perfect","ðŸ”¥ {team1} stringing together wins â€” playoff push!","âœ¨ Cinderella story: {team1} fighting for their lives"],
    duration:4,actions:[]}
];
var PRESSER_TAG_TRIGGERS=[
  {tags:["promise_changes","losing_streak"],storyId:"hot_seat",advance:1},
  {tags:["blame_qb","qb_low_morale"],storyId:"qb_controversy",advance:0},
  {tags:["calm","owner_low"],storyId:"hot_seat",advance:0},
  {tags:["tough","culture"],storyId:"locker_split",advance:0},
  {tags:["praise_rookie"],storyId:"rookie_spotlight",advance:1},
  {tags:["bold","winning_streak"],storyId:"underdog_run",advance:1}
];
function gradeL(v){return v>=92?"A+":v>=86?"A":v>=80?"A-":v>=76?"B+":v>=72?"B":v>=68?"B-":v>=64?"C+":v>=60?"C":v>=55?"C-":v>=50?"D+":v>=45?"D":"F";}
function getFuzzyRating(val, scoutLvl){
  if(!val && val!==0) return "?";
  if(scoutLvl>=3) return String(val); // Exact
  var noise = scoutLvl===2 ? 3 : scoutLvl===1 ? 6 : 12;
  return Math.max(40, val-noise) + "â€“" + Math.min(99, val+noise);
}
function getFuzzyGrade(ovr, scoutLvl){
  var gradeL=function(v){return v>=92?"A+":v>=86?"A":v>=80?"A-":v>=76?"B+":v>=72?"B":v>=68?"B-":v>=64?"C+":v>=60?"C":v>=55?"C-":v>=50?"D+":v>=45?"D":"F";};
  if(scoutLvl>=3) return gradeL(ovr);
  var noise = scoutLvl===2 ? 3 : scoutLvl===1 ? 6 : 12;
  var lo=gradeL(Math.max(40, ovr-noise)), hi=gradeL(Math.min(99, ovr+noise));
  return lo===hi ? lo : lo+"â€“"+hi;
}
var TD=[
  {id:"hawks",city:"Atlanta",name:"Muscle Hawks",abbr:"ATL",icon:"ðŸ¦…",c1:"#8b0000"},
  {id:"volts",city:"Miami",name:"Neon Flamingos",abbr:"MIA",icon:"ðŸ¦©",c1:"#6d28d9"},
  {id:"reap",city:"Las Vegas",name:"Sin City Grim Reapers",abbr:"LV",icon:"ðŸ’€",c1:"#1a1a1a"},
  {id:"crown",city:"New York",name:"Concrete Gargoyles",abbr:"NYG",icon:"ðŸ—½",c1:"#1e3a5f"},
  {id:"ghost",city:"Portland",name:"Drizzle Phantoms",abbr:"POR",icon:"ðŸ‘»",c1:"#3b0764"},
  {id:"titan",city:"Chicago",name:"Deep Dish Destroyers",abbr:"CHI",icon:"ðŸ•",c1:"#065f46"},
  {id:"storm",city:"Dallas",name:"Lone Star Scorpions",abbr:"DAL",icon:"ðŸ¦‚",c1:"#c2410c"},
  {id:"sent",city:"Denver",name:"Mile High Yetis",abbr:"DEN",icon:"ðŸ”ï¸",c1:"#166534"},
  {id:"blaze",city:"Phoenix",name:"Cactus Jacks",abbr:"PHX",icon:"ðŸŒµ",c1:"#b91c1c"},
  {id:"frost",city:"Minneapolis",name:"Tundra Berserkers",abbr:"MIN",icon:"ðŸª“",c1:"#1e40af"},
  {id:"surge",city:"Seattle",name:"Sasquatch",abbr:"SEA",icon:"ðŸ¦¶",c1:"#0e7490"},
  {id:"apex",city:"Houston",name:"Space Cowboys",abbr:"HOU",icon:"ðŸ¤ ",c1:"#7c2d12"},
  {id:"bbq",city:"Kansas City",name:"Smokestack Hogs",abbr:"KC",icon:"ðŸ—",c1:"#c41e3a"},
  {id:"yeti",city:"Buffalo",name:"Lake Effect Maniacs",abbr:"BUF",icon:"ðŸŒ¨ï¸",c1:"#1d3461"},
  {id:"gator",city:"Jacksonville",name:"Swamp Demons",abbr:"JAX",icon:"ðŸŠ",c1:"#006d5b"},
  {id:"moth",city:"Detroit",name:"Rust Belt Mothmen",abbr:"DET",icon:"ðŸ¦‡",c1:"#4a4a4a"},
  {id:"cactus",city:"San Antonio",name:"Prickly Boiz",abbr:"SA",icon:"ðŸ¤™",c1:"#8b6914"},
  {id:"kraken",city:"San Francisco",name:"Fog Krakens",abbr:"SF",icon:"ðŸ¦‘",c1:"#4b0082"},
  {id:"comet",city:"Nashville",name:"Honky Tonk Comets",abbr:"NSH",icon:"â˜„ï¸",c1:"#ff6b35"},
  {id:"doom",city:"Baltimore",name:"Harbor Doom",abbr:"BAL",icon:"âš“",c1:"#2a0845"},
  // v97: 30-team expansion (+10 teams)
  {id:"brawl",city:"Philadelphia",name:"Liberty Brawlers",abbr:"PHI",icon:"ðŸ¥Š",c1:"#004C54"},
  {id:"furnace",city:"Pittsburgh",name:"Iron Furnace",abbr:"PIT",icon:"âš™ï¸",c1:"#FFB612"},
  {id:"buzz",city:"Charlotte",name:"Buzz Saws",abbr:"CLT",icon:"ðŸ",c1:"#1D428A"},
  {id:"voodoo",city:"New Orleans",name:"Bayou Voodoo",abbr:"NO",icon:"ðŸŽ­",c1:"#6B2D8B"},
  {id:"cuda",city:"Tampa Bay",name:"Gulf Barracudas",abbr:"TB",icon:"ðŸŸ",c1:"#00A4BD"},
  {id:"wolves",city:"Boston",name:"Harbor Wolves",abbr:"BOS",icon:"ðŸº",c1:"#1C2841"},
  {id:"tremor",city:"Los Angeles",name:"Sunset Tremors",abbr:"LA",icon:"ðŸŒ‹",c1:"#FF4500"},
  {id:"rams97",city:"Salt Lake City",name:"Summit Rams",abbr:"SLC",icon:"ðŸ",c1:"#4A6741"},
  {id:"twist",city:"Oklahoma City",name:"Prairie Twister",abbr:"OKC",icon:"ðŸŒªï¸",c1:"#CC5500"},
  {id:"shark",city:"San Diego",name:"Pacific Sharks",abbr:"SD",icon:"ðŸ¦ˆ",c1:"#005B5C"}
];
var LEAGUE_TEAM_COUNT97=TD.length;
var REG_SEASON_WEEKS97=18;
var REG_SEASON_GAMES97=17;
var LEAGUE_POOL_SCALE97=Math.max(1,LEAGUE_TEAM_COUNT97/20);
var MFD97_CONF_DIV_MAP={
  yeti:{conf:"EC",div:"North",divId:"ECN",confName:"East Conference",divName:"EC North"},
  crown:{conf:"EC",div:"North",divId:"ECN",confName:"East Conference",divName:"EC North"},
  wolves:{conf:"EC",div:"North",divId:"ECN",confName:"East Conference",divName:"EC North"},
  moth:{conf:"EC",div:"North",divId:"ECN",confName:"East Conference",divName:"EC North"},
  furnace:{conf:"EC",div:"North",divId:"ECN",confName:"East Conference",divName:"EC North"},
  titan:{conf:"EC",div:"Central",divId:"ECC",confName:"East Conference",divName:"EC Central"},
  doom:{conf:"EC",div:"Central",divId:"ECC",confName:"East Conference",divName:"EC Central"},
  comet:{conf:"EC",div:"Central",divId:"ECC",confName:"East Conference",divName:"EC Central"},
  brawl:{conf:"EC",div:"Central",divId:"ECC",confName:"East Conference",divName:"EC Central"},
  buzz:{conf:"EC",div:"Central",divId:"ECC",confName:"East Conference",divName:"EC Central"},
  volts:{conf:"EC",div:"South",divId:"ECS",confName:"East Conference",divName:"EC South"},
  hawks:{conf:"EC",div:"South",divId:"ECS",confName:"East Conference",divName:"EC South"},
  gator:{conf:"EC",div:"South",divId:"ECS",confName:"East Conference",divName:"EC South"},
  cuda:{conf:"EC",div:"South",divId:"ECS",confName:"East Conference",divName:"EC South"},
  voodoo:{conf:"EC",div:"South",divId:"ECS",confName:"East Conference",divName:"EC South"},
  frost:{conf:"WC",div:"North",divId:"WCN",confName:"West Conference",divName:"WC North"},
  surge:{conf:"WC",div:"North",divId:"WCN",confName:"West Conference",divName:"WC North"},
  ghost:{conf:"WC",div:"North",divId:"WCN",confName:"West Conference",divName:"WC North"},
  sent:{conf:"WC",div:"North",divId:"WCN",confName:"West Conference",divName:"WC North"},
  rams97:{conf:"WC",div:"North",divId:"WCN",confName:"West Conference",divName:"WC North"},
  bbq:{conf:"WC",div:"Central",divId:"WCC",confName:"West Conference",divName:"WC Central"},
  storm:{conf:"WC",div:"Central",divId:"WCC",confName:"West Conference",divName:"WC Central"},
  apex:{conf:"WC",div:"Central",divId:"WCC",confName:"West Conference",divName:"WC Central"},
  cactus:{conf:"WC",div:"Central",divId:"WCC",confName:"West Conference",divName:"WC Central"},
  twist:{conf:"WC",div:"Central",divId:"WCC",confName:"West Conference",divName:"WC Central"},
  reap:{conf:"WC",div:"South",divId:"WCS",confName:"West Conference",divName:"WC South"},
  blaze:{conf:"WC",div:"South",divId:"WCS",confName:"West Conference",divName:"WC South"},
  kraken:{conf:"WC",div:"South",divId:"WCS",confName:"West Conference",divName:"WC South"},
  tremor:{conf:"WC",div:"South",divId:"WCS",confName:"West Conference",divName:"WC South"},
  shark:{conf:"WC",div:"South",divId:"WCS",confName:"West Conference",divName:"WC South"}
};
var LEAGUE_STRUCTURE={
  conferences:[
    {id:"EC",name:"East Conference",icon:"ðŸ›ï¸"},
    {id:"WC",name:"West Conference",icon:"ðŸŒ„"}
  ],
  divisions:[
    {id:"ECN",conf:"EC",name:"North",icon:"ðŸ§Š",teams:["yeti","crown","wolves","moth","furnace"]},
    {id:"ECC",conf:"EC",name:"Central",icon:"â­",teams:["titan","doom","comet","brawl","buzz"]},
    {id:"ECS",conf:"EC",name:"South",icon:"â˜€ï¸",teams:["volts","hawks","gator","cuda","voodoo"]},
    {id:"WCN",conf:"WC",name:"North",icon:"â„ï¸",teams:["frost","surge","ghost","sent","rams97"]},
    {id:"WCC",conf:"WC",name:"Central",icon:"â›°ï¸",teams:["bbq","storm","apex","cactus","twist"]},
    {id:"WCS",conf:"WC",name:"South",icon:"ðŸŒµ",teams:["reap","blaze","kraken","tremor","shark"]}
  ]
};
function applyLeagueAlignment97(team){
  if(!team||!team.id)return team;
  var a=MFD97_CONF_DIV_MAP[team.id];
  if(a){
    team.conf=a.conf;
    team.confName=a.confName;
    team.div=a.div;
    team.divId=a.divId;
    team.divName=a.divName;
  }else{
    if(!team.conf)team.conf="LG";
    if(!team.confName)team.confName="League";
    if(!team.div)team.div="Independent";
    if(!team.divId)team.divId="IND";
    if(!team.divName)team.divName="Independent";
  }
  return team;
}
function getScaledCount97(base){
  return Math.max(1,Math.round((base||0)*LEAGUE_POOL_SCALE97));
}
function getScaledDraftClassCount97(){
  return getScaledCount97(300);
}
function getScaledFreeAgentCount97(){
  return getScaledCount97(60);
}
function getScaledOffseasonFreeAgentCount97(){
  return getScaledCount97(30);
}
function getScaledUdfaCount97(){
  return getScaledCount97(25);
}
function getLeagueTeamCountLabel97(){
  return String(LEAGUE_TEAM_COUNT97);
}
// v97 market tiers for new abbrs + LA short code support
TEAM_MARKET.BOS=TEAM_MARKET.BOS||"LARGE";
TEAM_MARKET.CLT=TEAM_MARKET.CLT||"MID";
TEAM_MARKET.SLC=TEAM_MARKET.SLC||"MID";
TEAM_MARKET.OKC=TEAM_MARKET.OKC||"MID";
TEAM_MARKET.SD=TEAM_MARKET.SD||"LARGE";
TEAM_MARKET.LA=TEAM_MARKET.LA||"MEGA";
// v97 scout scaling for larger league search surface
if(LEAGUE_TEAM_COUNT97>=30)SCOUT_POINT_BASE86=Math.max(SCOUT_POINT_BASE86||1000,1500);
var FN=["Marcus","Jaylen","Devon","Tyrell","Khalil","Andre","Darius","Xavier","Malik","Terrance",
  "Jalen","Isaiah","Kameron","Travis","Lamar","Ezekiel","Micah","Caleb","Brock","Trey","Saquon",
  "Kyler","Justin","Patrick","Derrick","Chase","CJ","Amari","Trevon","Roquan","Devin","Josh","Joe",
  "Breece","Myles","Nick","Davante","George","Aaron","Cooper","Garrett","Zach","Sam",
  "Michael","James","Robert","David","Daniel","Anthony","Chris","Ryan","Tyler","Brandon","Jordan",
  "Austin","Kevin","Brian","Eric","Jason","Kyle","Corey","Deandre","Jamal","Rashad","DeShawn",
  "Tremaine","Terrell","Carlos","Luis","Diego","Rafael","Angel","Antonio","Damien","Darren",
  "Donovan","Quincy","Marlon","Reggie","Derek","Kendall","Maurice","Rashid","Tavon","DeMarcus",
  "Kayvon","Quinnen","Javon","Kadarius","Jaire","Budda","Laviska","Mecole","Denzel","Montez",
  "Derwin","Jessie","Calvin","Randall","Tyson","Desmond","Allen","Curtis","Todd","Jerome",
  "Keith","Darrell","Kenneth","Leon","Carl","Wayne","Larry","Tommy","Eddie","Willie","Ray",
  "Trent","Craig","Troy","Scott","Jeff","Greg","Mark","Steve","Phil","Tim","Don","Vince",
  "Sean","Nate","Blake","Cole","Luke","Max","Logan","Mason","Ethan","Liam","Noah","Owen",
  "Carter","Hunter","Bryson","Bryce","Carson","Landon","Grayson","Bennett","Parker","Colton",
  "Ty","Dak","Najee","Tua","Mac","Kenny","Aidan","Jameson","Drake","Christian","Miles","Will",
  "Quay","Azeez","Kwity","Nakobe","Ahmad",
  "Aiden","Jackson","Jacob","Elijah","Alexander","Henry","Sebastian","Jack","Wyatt","Dylan",
  "Nathan","Andrew","Thomas","Joseph","Samuel","Christopher","John","Matthew","Lincoln","Asher",
  "Theodore","Leo","Kai","Hudson","Axel","Easton","Jaxon","Ryder","Atlas","Brooks","Roman",
  "Graham","Spencer","Grant","Preston","Reed","Sawyer","Griffin","Wade","Hayes","Sullivan",
  "Beckett","Remington","Jett","Cash","Knox","Cade","Rhett","Beau","Finn","Cruz","Tate",
  "Quinn","Sterling","Pierce","Shea","Penn","Heath","Clay","Lane","Stone","West",
  "DeSean","JaVonte","Tyreek","Jahmyr","Braelon","Bijan","Quentin","Marvin","TJ","JJ",
  "AJ","DJ","CeeDee","DeVonta","Amon-Ra","Tee","Puka","Rome",
  "Adonai","Maxx","Tank","Smoke","Hollywood","Deebo","Bam",
  "Kam","Keaontay","Zay","Elijah","Baker","Trevor",
  "Bo","DK","Juju","Diontae","Chuba","Penei","Rashawn",
  "Jevon","Dexter","Daron","Keenan","Mike","Nico","Jayden","Kyren","Raheem","Dameon",
  "Keaton","Marshall","Dalton","Teddy","Drew","Russell","Kirk","Geno","Taylor","Deshaun",
  "Ladd","Quandre","Chauncey","Tre","Jonathan","Tyree","Darnell","Jarvis",
  "Alejandro","Fernando","Miguel","Ricardo","Enrique","Pablo","Mateo","Santiago","Emilio","Marco",
  "Roberto","Jairo","Andres","Raul","Omar","Hector","Jesus","Eduardo","Cesar",
  "Clyde","Buford","Roscoe","Leroy","Chester","Wilbur","Floyd","Thurman","Elmer","Horace",
  "Otis","Rufus","Archibald","Cornelius","Jedidiah","Barnaby","Bartholomew","Mortimer","Percival","Thaddeus",
  "Clarence","Aloysius","Beauregard","Ebenezer","Ignatius","Reginald","Rutherford","Sylvester","Valentine","Woodrow",
  "Eugene","Melvin","Harold","Vernon","Lester","Murray","Irving","Seymour","Herbert","Delbert",
  "Norbert","Orville","Grover","Hubert","Merle","Virgil","Gus","Buck","Hank","Bud",
  "Chet","Dutch","Red","Biff","Moose","Bull","Ace","Dizzy",
  "Cleophas","Booker","Roosevelt","Napoleon","Ulysses","Columbus","Jupiter","Erasmus","Zebulon",
  "Festus","Waldo","Enoch","Lemuel","Obadiah","Zephaniah","Thelonius","Magnus",
  "Brick","Slab","Crank","Turbo","Blaze","Ox","Diesel","Hawk","Storm","Gunner",
  "Titan","Flash","Rocket","Maverick","Spike","Thunder","Boulder","Iron",
  "Anvil","Rusty","Trooper","Asteroid","Centauri",
  "Aaron","Abel","Adam","Adrian","Alan","Albert","Alec","Alfred","Alonzo","Alphonso",
  "Alvin","Amos","Angelo","Archie","Arnold","Arturo","Barry","Basil","Baxter","Benny",
  "Bernard","Bertrand","Billy","Bobby","Boyd","Bradley","Brady","Brett","Bruce","Bryan",
  "Buddy","Byron","Cameron","Carlton","Cecil","Cedric","Chad","Chandler","Charlie","Chip",
  "Clifford","Clinton","Clint","Cody","Colin","Conrad","Corey","Cornelius","Dale","Damian",
  "Damon","Dane","Darcy","Darnell","Darren","Darwin","Dean","Demetrius","Dennis","Desmond",
  "Dewayne","Dexter","Dominic","Dominique","Donnie","Dorian","Douglas","Duane","Duncan","Dustin",
  "Dwight","Earl","Ed","Edgar","Edmund","Edwin","Eli","Elliot","Ellis","Emerson",
  "Emmanuel","Emmett","Enrique","Ernie","Ervin","Fabian","Felix","Fletcher","Floyd","Forrest",
  "Francis","Frank","Franklin","Fred","Frederick","Gabriel","Galen","Gary","Gavin","Gene",
  "Geoffrey","Gerald","Gilbert","Glen","Glenn","Gordon","Grady","Grayson","Gregory","Grover",
  "Gustavo","Guy","Harlan","Harley","Harold","Harrison","Harvey","Hayden","Herman","Howard",
  "Hugh","Hugo","Ibrahim","Irvin","Isaac","Ivan","Ivory","Jabari","Jace","Jaime",
  "Jakari","Jamarion","Jamari","Jamir","Jared","Jarrett","Jasper","Javier","Jayson","Jeffery",
  "Jelani","Jeremiah","Jeremy","Jermaine","Jerome","Jesse","Jimmie","Jimmy","Joaquin","Jody",
  "Joel","Johnathan","Jonah","Jonas","Jose","Josiah","Juan","Julian","Julius","Junior",
  "Justice","Kaden","Kareem","Karl","Keegan","Keion","Kelvin","Kendrick","Kenneth","Keon",
  "Kerry","Keshawn","Khari","Kobe","Korey","Lamar","Lance","Langston","Lawrence","Leandro",
  "Leland","Lemuel","Lennox","Leonardo","Leroy","Leslie","Levi","Lewis","Lincoln","Lloyd",
  "Lorenzo","Louie","Luca","Lucian","Luther","Lyle","Maddox","Malcolm","Manuel","Marcel",
  "Marcos","Mario","Marquis","Martin","Marvin","Maurice","Maynard","Melvin","Milo","Milton",
  "Mitchell","Monroe","Montgomery","Morgan","Morris","Myron","Nelson","Nestor","Nigel","Noel",
  "Norman","Oliver","Omar","Orlando","Oscar","Otis","Otto","Pablo","Pedro","Perry",
  "Porter","Prince","Quentin","Quinton","Ralph","Ramon","Randolph","Raphael","Raul","Raymond",
  "Reece","Remy","Rene","Rex","Ricardo","Richard","Rico","Riley","Roderick","Rodney",
  "Rodrigo","Roger","Roland","Rolando","Ronnie","Rory","Ross","Roy","Ruben","Rudolph",
  "Salvador","Salvatore","Samir","Samson","Santos","Sergio","Seth","Shane","Sheldon","Sherman",
  "Sidney","Silas","Solomon","Sonny","Stanley","Stefan","Stephen","Stevin","Stuart","Sylvester",
  "Tanner","Terrence","Theron","Tobias","Toby","Todd","Tony","Torrey","Trace","Tremaine",
  "Trenton","Tristan","Tucker","Tyrone","Ulysses","Vance","Vaughn","Vernon","Victor","Virgil",
  "Vivian","Wallace","Walter","Warren","Wendell","Werner","Wesley","Weston","Wilbert","Wiley",
  "Willard","Winston","Wylie","Xander","Yosef","Zander","Zane","Zayne","Zion","Zuriel"];
var LN=["Johnson","Williams","Davis","Jackson","Thomas","Harris","Robinson","Clark","Lewis","Walker",
  "Mitchell","Carter","Phillips","Turner","Parker","Evans","Edwards","Collins","Stewart","Morris",
  "Reed","Cook","Bell","Howard","Ward","Brooks","Sanders","Price","Long","Foster","Hayes","Graham",
  "Hunt","Ford","Marshall","Stone","Cole","Warren","Knight","Dixon","Brown","Smith","Jones","Wilson",
  "Anderson","Taylor","Moore","Martin","White","Allen","Young","King","Wright","Hill",
  "Scott","Green","Adams","Baker","Nelson","Hall","Rivera","Campbell","Ramirez","Torres",
  "Peterson","Gonzalez","Hernandez","Lopez","Martinez","Garcia","Rodriguez","Sanchez","Flores","Diaz",
  "Murphy","Sullivan","Bennett","Wood","Ross","Cox","Cruz","Reyes","Watson",
  "Bryant","Russell","Griffin","Coleman","Simmons","Patterson","Reynolds","Hamilton","Jenkins",
  "Perry","Powell","Butler","Barnes","Fisher","Henderson","Washington","Crawford","Owens","Palmer",
  "Cunningham","Kelley","Watkins","Dunn","Barnett","Hicks","Hodges","Barber","Bates","Moss",
  "Swanson","Pope","Lamb","Norwood","Dorsey","Pollard","Tatum","Cannon","Rivers","Bridges",
  "Mack","Branch","Sharpe","Battle","Cash","Pace","Strong","Speed","Swift","Chance",
  "Power","Justice","Land","Fountain","North","Field","Lake","Ridge","Peak",
  "Hughes","Alexander","Ferguson","Nichols","Hoffman","Daniels","Robertson",
  "Lambert","Craig","Hudson","Spencer","Lawrence","Stephens","Grant","Fox","Lynch","Freeman",
  "Hardy","Webb","Simpson","Stevens","Tucker","Hart","Jensen","Dawson","Chapman",
  "Fitzgerald","Holloway","Chambers","Sutton","Kim","Nguyen","Chen","Patel","Okafor","Eze",
  "Kwame","Adebayo","Okonkwo","Mensah","Achebe","Bautista","Jimenez","Santiago",
  "Volkov","Petrov","Nakamura","Tanaka","Schmidt","Mueller","Becker","Wagner","Fischer",
  "OBrien","Kelly","McCarthy","Gallagher","Doyle","Conway","Brennan","Walsh",
  "Hardcastle","Broadnax","Swindlehurst","Bonesaw","Troutman",
  "Funkhouser","Winterbottom","Goodpasture","Shufflebarger","Bumgardner",
  "Honeycutt","Armbruster","Funkenstein","Sassafras",
  "Sackington","Blitzenheimer","Gridiron",
  "Abbott","Acosta","Aguilar","Aguirre","Albert","Aldridge","Allison","Alston","Alvarez","Amos",
  "Andrade","Anthony","Archer","Armstrong","Arnold","Ashford","Atkins","Austin","Avery","Ayers",
  "Baird","Baldwin","Ball","Banks","Barlow","Barrett","Barron","Bartlett","Baskin","Bass",
  "Bean","Beard","Beasley","Beck","Bedford","Benson","Bentley","Berry","Best","Bevins",
  "Bishop","Black","Blackmon","Blackwell","Blair","Blake","Blanchard","Bland","Blanton","Bloom",
  "Blythe","Bolton","Bond","Booker","Booth","Bowers","Bowman","Boyd","Bradford","Brady",
  "Bragg","Brewer","Britt","Brock","Brookins","Browning","Bruce","Buchanan","Buckley","Burgess",
  "Burke","Burnett","Burns","Burris","Burton","Bush","Byrd","Cain","Caldwell","Callahan",
  "Calloway","Camacho","Cameron","Cardenas","Carey","Carlisle","Carlton","Carpenter","Carr","Carroll",
  "Carson","Cartwright","Casey","Castaneda","Castillo","Castro","Cervantes","Chandler","Chang","Chase",
  "Chavez","Cherry","Childers","Chin","Christian","Cisneros","Clay","Clayton","Clement","Cleveland",
  "Cline","Coates","Cobb","Coffey","Cohen","Colbert","Coleman","Collier","Combs","Compton",
  "Conley","Conrad","Conner","Contreras","Cooke","Cooper","Copeland","Cordero","Corona","Cortes",
  "Cotton","Couch","Courtney","Cowan","Craig","Crane","Crockett","Cross","Crowell","Cummings",
  "Curry","Dalton","Daly","Daniels","Darby","Davenport","Davidson","Day","Dean","Delaney",
  "Delgado","Dennis","Devine","Dickerson","Dickson","Dillon","Dillard","Dobbins","Dobson","Doherty",
  "Dominguez","Donaldson","Donovan","Dooley","Doss","Douglas","Downs","Drake","Draper","Drummond",
  "Dudley","Duffy","Duke","Dunbar","Duncan","Dunlap","Dunn","Dupree","Durant","Durham",
  "Eaton","Edmonds","Elkins","Elliott","Ellis","Emery","English","Ennis","Erickson","Espinoza",
  "Estrada","Everett","Ewing","Faulkner","Ferguson","Fernandez","Fields","Figueroa","Finch","Finley",
  "Fitch","Flanagan","Fleming","Fletcher","Flood","Floyd","Flynn","Foley","Forbes","Foreman",
  "Forrest","Fowler","Franco","Franklin","Frazier","French","Frost","Fuentes","Fuller","Gaines",
  "Galindo","Gallegos","Galloway","Gamble","Garner","Garrett","Garrison","Gates","Gay","Gentry",
  "George","Gibbs","Gibson","Gilbert","Gill","Gilliam","Gilmore","Glass","Glover","Golden",
  "Gomez","Goodman","Goodwin","Gordon","Gould","Grace","Grady","Greer","Gross","Guerrero",
  "Guthrie","Gutierrez","Hale","Haley","Hamby","Hammond","Hampton","Hancock","Hanson","Harden",
  "Hardin","Harding","Harper","Harrell","Harrington","Hartman","Hawkins","Hayden","Haynes","Hays",
  "Heath","Heller","Hendricks","Hensley","Henson","Herman","Herrera","Hewitt","Hickman","Higgins",
  "Hightower","Hilliard","Hinton","Hobbs","Hoffman","Hogan","Holcomb","Holder","Holland","Holley",
  "Hollis","Holmes","Hood","Hooper","Hoover","Horn","Horton","House","Houston","Howell",
  "Hubbard","Huff","Humphrey","Hunt","Ibarra","Ingram","Irwin","Iverson","Ivy","Jacks",
  "Jacobs","James","Jarvis","Jefferson","Johns","Johnston","Jordan","Joyce","Juarez","Kane",
  "Kearns","Keene","Keith","Keller","Kemp","Kendrick","Kennedy","Kent","Kern","Key",
  "Kidd","Kilgore","Kimball","Kincaid","Kirby","Kirk","Kirkland","Klein","Knapp","Knox",
  "Koch","Kramer","Kruger","Lacy","Laird","Lane","Lang","Lara","Larson","Lash",
  "Lassiter","Latham","Lawson","Layne","Leach","LeBlanc","Ledford","Lehman","Leon","Leonard",
  "Lester","Levy","Lindsey","Little","Livingston","Lloyd","Lockhart","Lofton","Logan","Logue",
  "Lomax","Love","Lowe","Lowery","Lucas","Luna","Lunsford","Lyle","Lynch","Lynn",
  "Maddox","Mahoney","Maldonado","Malone","Mann","Manning","Marks","Marsh","Martin","Mason",
  "Massey","Masters","Mathews","Mathis","Maxwell","May","Maynard","McBride","McCabe","McCall",
  "McCann","McClain","McCoy","McCray","McCullough","McDaniel","McDowell","McFadden","McGee","McGill",
  "McGowan","McGuire","McIntosh","McIntyre","McKay","McKee","McKenzie","McKinley","McKinney","McLaughlin",
  "McLean","McMahon","McManus","McMillan","McNair","McNeil","Meadows","Medina","Mejia","Melendez",
  "Melton","Mendez","Mendoza","Mercer","Merritt","Meyer","Michael","Middleton","Miles","Miller",
  "Mills","Mims","Minor","Miranda","Mobley","Molina","Monroe","Montoya","Moody","Moon",
  "Morales","Moran","Moreno","Morgan","Morrison","Morrow","Morton","Mosley","Mullen","Mullins",
  "Munoz","Murray","Myers","Nance","Nash","Navarro","Neal","Neely","Newton","Noble",
  "Nolan","Norman","Norris","Norton","Nunez","Ochoa","Odell","Odom","Ogden","Oliver",
  "Olsen","Olson","ONeal","Oquendo","Orr","Ortega","Ortiz","Osborn","Osborne","Ostrowski",
  "Otto","Overstreet","Pace","Padilla","Page","Paine","Parham","Park","Parks","Parr",
  "Parrish","Parsons","Patrick","Patten","Payne","Pearsall","Pearson","Peck","Peebles","Penn",
  "Pennington","Peoples","Perez","Perkins","Person","Pham","Phelps","Pickett","Pierce","Pine",
  "Pitts","Plummer","Poe","Polk","Pool","Pope","Porter","Potter","Potts","Pounds",
  "Pratt","Prescott","Preston","Prince","Pritchard","Proctor","Pruitt","Pugh","Purcell","Putnam",
  "Quinn","Raines","Ramos","Randall","Randolph","Ransom","Ratliff","Rawlings","Ray","Rayburn",
  "Rector","Redmond","Reese","Register","Reno","Rhodes","Rich","Richards","Richardson","Riddle",
  "Riggs","Riley","Rios","Ritchie","Ritter","Roach","Robbins","Roberts","Robison","Robles",
  "Rock","Rodgers","Rollins","Roman","Romero","Root","Rosales","Rose","Roth","Rowe",
  "Rowland","Royster","Rubin","Ruffin","Rush","Rutledge","Saldana","Sample","Sampson","Samuels",
  "Sandoval","Sands","Santana","Santos","Sargent","Saunders","Savage","Sawyer","Scales","Scarborough",
  "Schaefer","Schwartz","Sears","Self","Sellers","Serrano","Sexton","Shaffer","Shannon","Sharp",
  "Shaw","Shelton","Shepherd","Shields","Short","Shultz","Sierra","Sikes","Silva","Slater",
  "Slaughter","Small","Smart","Snider","Snow","Snyder","Solis","Solomon","Soto","Sparks",
  "Spears","Springer","Stafford","Stanton","Stark","Steadman","Steele","Stokes","Strange","Street",
  "Strickland","Stuart","Suarez","Summers","Sutherland","Sykes","Talley","Tang","Tanner","Tarver",
  "Temple","Terrell","Terry","Thacker","Thayer","Thigpen","Thornton","Tillman","Timmerman","Todd",
  "Tolbert","Townsend","Tracy","Tran","Tripp","Trotter","Troy","True","Trujillo","Truong",
  "Tubbs","Tuck","Tuggle","Tyson","Underwood","Upton","Vail","Valdez","Valencia","Valentine",
  "VanDyke","Vargas","Vasquez","Vaughn","Vega","Velasquez","Vick","Villa","Villanueva","Vincent",
  "Vinson","Wade","Wagoner","Walden","Waldron","Walton","Wang","Ware","Warner","Waters",
  "Watts","Weathers","Weaver","Webster","Welch","Wells","Werner","West","Weston","Wheeler",
  "Whitaker","Whitehead","Whitfield","Whitley","Whitney","Whittaker","Wiggins","Wilbanks","Wilcox","Wilder",
  "Wiley","Wilkins","Williamson","Willis","Winters","Wise","Witherspoon","Wolf","Wolfe","Wong",
  "Woodard","Woods","Woody","Wooten","Worth","Worthy","Wray","Wu","Wyatt","Wynn",
  "Yang","Yarbrough","York","Youngblood","Zamora","Zuniga"];
// v99.2: Extend FN/LN with PLAYER_NAMES_991 pools (ChatGPT)
(function(){try{
  var pn=PLAYER_NAMES_991;if(!pn)return;
  var allFirst=(pn.first.classic||[]).concat(pn.first.modern||[]).concat(pn.first.southern||[]).concat(pn.first.international||[]);
  var allLast=(pn.last.common||[]).concat(pn.last.athletic||[]).concat(pn.last.regional||[]);
  allFirst.forEach(function(n){if(FN.indexOf(n)<0)FN.push(n);});
  allLast.forEach(function(n){if(LN.indexOf(n)<0)LN.push(n);});
}catch(e){}})();
function genCoach(role){
  var arch=pick(ARCHETYPES[role]);
  var pool=ARCH_TRAIT_POOLS[arch]||["DISCIPLINE"];
  var traits=[];var available=pool.slice();
  var numTraits=RNG.draft()<0.3?2:1;
  for(var ti=0;ti<numTraits&&available.length>0;ti++){
    var idx=rng(0,available.length-1);traits.push(available[idx]);available.splice(idx,1);
  }
  var genRatings={strategy:rng(40,95),development:rng(40,95),gameplan:rng(40,95)};
  var avgRat=Math.round((genRatings.strategy+genRatings.development+genRatings.gameplan)/3);
  // v95: DeepSeek formula â€” guarantees total HC+OC+DC between $20M-$24.8M
  // baseSalary = 6.06 + 1.455*((avgRat-40)/55) â†’ at rating 40: $6.06, at 95: $7.515
  // total = 1.3*HC + OC + DC = 3.3 * base â†’ min $20.0M, max $24.79M
  var baseSalary=Math.round((6.06+1.455*((avgRat-40)/55))*10)/10;
  if(role==="HC")baseSalary=Math.round(baseSalary*1.3*10)/10;
  baseSalary=Math.max(6.0,Math.round((baseSalary+(rng(-2,2)/10))*10)/10);
  return {id:U(),role:role,name:pick(["Mike","Sean","Kyle","Brian","Kevin","Matt","Dan","Andy","Ron","Pete",
    "Vince","Bear","Knute","Hank","Bud","Dutch","Red","Woody","Bo","Chuck","Chet","Gus","Curly","Butch"])+" "+pick(LN),
    arch:arch,traits:traits,
    ratings:genRatings,
    salary:baseSalary,contract:rng(1,3),yearsLeft:rng(1,4),
    reputation:rng(30,80),hot:rng(10,50),
    xp:0,level:1,
    history:{wins:0,losses:0,playoffWins:0,rings:0,seasons:0},
    mood:70};// mood: how happy coach is (affects departure risk)
}
function progressCoach(c,teamWins,teamLosses,madePlayoffs,wonChamp){
  if(!c)return c;
  var nc=assign({},c,{history:assign({},c.history||{wins:0,losses:0,playoffWins:0,rings:0,seasons:0})});
  nc.history.wins=(nc.history.wins||0)+teamWins;
  nc.history.losses=(nc.history.losses||0)+teamLosses;
  nc.history.seasons=(nc.history.seasons||0)+1;
  if(madePlayoffs)nc.history.playoffWins=(nc.history.playoffWins||0)+1;
  if(wonChamp)nc.history.rings=(nc.history.rings||0)+1;
  var xpGain=teamWins*3+(madePlayoffs?15:0)+(wonChamp?30:0);
  nc.xp=(nc.xp||0)+xpGain;
  var newLevel=Math.min(10,1+Math.floor((nc.xp||0)/50));
  var leveledUp=newLevel>nc.level;
  nc.level=newLevel;
  var rBoost=leveledUp?rng(1,3):0;
  nc.ratings=assign({},nc.ratings);
  nc.ratings.strategy=cl(nc.ratings.strategy+rBoost+rng(0,1),40,99);
  nc.ratings.development=cl(nc.ratings.development+(wonChamp?rng(1,3):rng(-1,1)),40,99);
  nc.ratings.gameplan=cl(nc.ratings.gameplan+(teamWins>=10?rng(1,2):teamWins<=4?rng(-2,0):0),40,99);
  nc.reputation=cl((nc.reputation||50)+(teamWins>=10?rng(3,8):teamWins>=7?rng(0,3):rng(-5,-1))+(wonChamp?15:0)+(madePlayoffs?5:0),10,99);
  nc.hot=cl((nc.hot||30)+(nc.reputation>75?rng(5,15):rng(-5,5)),5,99);
  var traitChance=leveledUp?0.15:(wonChamp?0.25:0);
  if(RNG.ai()<traitChance&&(nc.traits||[]).length<3){
    var pool=ARCH_TRAIT_POOLS[nc.arch]||Object.keys(COACH_TRAITS);
    var allTraits=Object.keys(COACH_TRAITS);
    var candidates=(pool.length>nc.traits.length?pool:allTraits).filter(function(t){return nc.traits.indexOf(t)<0;});
    if(candidates.length>0){
      nc.traits=nc.traits.slice();nc.traits.push(pick(candidates));
      nc._newTrait=nc.traits[nc.traits.length-1];// Flag for toast
    }
  }
  if(teamLosses>=8&&RNG.ai()<0.05&&nc.traits.length>1){
    nc.traits=nc.traits.slice();
    nc._lostTrait=nc.traits.pop();// Flag for toast
  }
  nc.yearsLeft=Math.max(0,(nc.yearsLeft||1)-1);
  nc.mood=cl((nc.mood||70)+(teamWins>=10?rng(3,8):teamWins<=4?rng(-8,-3):rng(-2,2)),20,99);
  return nc;
}
function coachBuyout(c){return Math.round(((c.yearsLeft||0)*(c.salary||3))*10)/10;}
function detectPositionBattles974(roster){
  var battles=[];
  var starterSlots=STARTER_COUNTS||{};
  Object.keys(starterSlots).forEach(function(pos){
    if(pos==="K"||pos==="P")return;
    var players=(roster||[]).filter(function(p){
      return p&&p.pos===pos&&(!p.injury||!p.injury.games);
    }).sort(function(a,b){return (b.ovr||0)-(a.ovr||0);});
    if(players.length<2)return;
    var starter=players[0];
    var challenger=players[1];
    var gap=(starter.ovr||0)-(challenger.ovr||0);
    if(gap<=5||((challenger.age||99)<=24&&((challenger.pot||0)>=(starter.ovr||0)))){
      battles.push({
        pos:pos,
        incumbent:{id:starter.id,name:starter.name,ovr:starter.ovr||0,age:starter.age||0,salary:v36_capHit(starter.contract||{})},
        challenger:{id:challenger.id,name:challenger.name,ovr:challenger.ovr||0,age:challenger.age||0,pot:challenger.pot||0,salary:v36_capHit(challenger.contract||{})},
        resolved:false,
        winner:null
      });
    }
  });
  return battles.slice(0,4);
}
function buildCutAdvisor974(roster,rosterCap){
  var overBy=(roster||[]).length-(rosterCap||ROSTER_CAP);
  if(overBy<=0)return null;
  var candidates=(roster||[]).slice().sort(function(a,b){
    var aScore=(a.ovr||0)+(a.isStarter?20:0)+(((a.pot||0)>(a.ovr||0))?5:0)+((a.age||99)<=24?5:0);
    var bScore=(b.ovr||0)+(b.isStarter?20:0)+(((b.pot||0)>(b.ovr||0))?5:0)+((b.age||99)<=24?5:0);
    var aSal=v36_capHit(a.contract||{})||0;
    var bSal=v36_capHit(b.contract||{})||0;
    if((a.ovr||0)<65)aScore-=aSal*2;
    if((b.ovr||0)<65)bScore-=bSal*2;
    return aScore-bScore;
  });
  return {
    overBy:overBy,
    suggestions:candidates.slice(0,Math.min(overBy+3,10)).map(function(p){
      var deadMoney=v36_deadIfCut(p.contract||{});
      var salary=v36_capHit(p.contract||{})||0;
      var reason=(p.ovr||0)<60?"Low OVR":
        ((p.ovr||0)<65&&salary>3)?"Overpaid backup":
        (!p.isStarter&&(p.age||0)>=30)?"Aging non-starter":"Roster crunch";
      return {id:p.id,name:p.name,pos:p.pos,ovr:p.ovr||0,age:p.age||0,salary:salary,deadMoney:deadMoney,reason:reason};
    })
  };
}
function getAgingPhase(p){
  var curve=AGE_CURVES[p.pos]||AGE_CURVES.WR;
  if(p.age<curve.prime[0]) return {label:"ðŸ“ˆ",tip:"Rising",color:"#10b981"};
  if(p.age<=curve.prime[1]) return {label:"â­",tip:"Prime",color:"#d4a74b"};
  if(p.age<=curve.cliff) return {label:"ðŸ“Š",tip:"Aging",color:"#f59e0b"};
  return {label:"ðŸ“‰",tip:"Declining",color:"#ef4444"};
}
function calcOvr(p){
  var def=POS_DEF[p.pos];if(!def) return 50;var t=0,w=0;
  def.r.forEach(function(r,i){var v=p.ratings[r]||50;t+=cl(v,30,99)*def.w[i];w+=def.w[i];});
  var o=Math.round(t/w);
  if(p&&!p._noArch){p.archetype=PLAYER_ARCHETYPES.classify(p);}
  return o;
}
function genPlayer(pos,tier,age){
  var ranges={star:[78,95],good:[72,88],avg:[62,80],bad:[55,72]};
  var lo=(ranges[tier]||ranges.avg)[0],hi=(ranges[tier]||ranges.avg)[1];
  var a=age||(tier==="rookie"?rng(21,23):rng(23,32));
  var def=POS_DEF[pos];var ratings={};
  var baseOvr=cl(rng(lo,hi),40,99);// Anchor value for this player's talent level
  def.r.forEach(function(r,i){
    var w=def.w[i]||3;
    var spread=w>=10?rng(-4,4):w>=6?rng(-7,5):rng(-12,6);// Core: tight to base; Minor: wide variance
    var corr=0;
    if(ratings.speed&&(r==="acceleration"||r==="changeOfDirection"||r==="agility"||r==="catchup"))corr=Math.round((ratings.speed-baseOvr)*0.4);
    if(ratings.strength&&(r==="power"||r==="truckPower"||r==="anchorStrength"||r==="hitPower"||r==="impactBlocking"))corr=Math.round((ratings.strength-baseOvr)*0.4);
    if(ratings.accuracy&&(r==="shortAccuracy"||r==="deepAccuracy"||r==="medRange"))corr=Math.round((ratings.accuracy-baseOvr)*0.5);
    if(ratings.coverage&&(r==="zoneCoverage"||r==="manCoverage"||r==="rangeAbility"))corr=Math.round((ratings.coverage-baseOvr)*0.4);
    if(ratings.passBlock&&(r==="passBlockFinesse"||r==="handTechnique"||r==="footwork"))corr=Math.round((ratings.passBlock-baseOvr)*0.4);
    if(ratings.passRush&&(r==="powerMoves"||r==="finesseMoves"||r==="bullRush"))corr=Math.round((ratings.passRush-baseOvr)*0.4);
    if(ratings.catching&&(r==="catchInTraffic"||r==="spectacularCatch"))corr=Math.round((ratings.catching-baseOvr)*0.4);
    if(ratings.kickPower&&(r==="longRange"||r==="hangTime"||r==="touchback"))corr=Math.round((ratings.kickPower-baseOvr)*0.5);
    ratings[r]=cl(baseOvr+spread+corr,40,99);
  });
  var pTraits95=assignTraits();// v95: up to 3 traits
  var p={id:U(),name:pick(FN)+" "+pick(LN),pos:pos,age:a,ratings:ratings,morale:cl(70+rng(-10,15),40,99),
    devTrait:RNG.draft()<0.05?"superstar":RNG.draft()<0.13?"star":"normal",
    trait:pTraits95[0]||"none",traits95:pTraits95,onTradeBlock:false,// trait=primary for compat; traits95=full array
    contract:makeContract(0,rng(1,4),0,0),injury:{type:null,games:0},
    stats:{gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0},
    careerStats:{gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0,seasons:0,fumbles:0,proBowls:0,allPros:0},
    traitMilestones95:{},traitPowerLevel95:{},// v95.9: milestone tracking initialized at creation
    isStarter:false};
  p.ovr=calcOvr(p);p.pot=cl(p.ovr+rng(0,a<=24?13:5),p.ovr,99);
  p.everReached90=(p.ovr||0)>=90;// v87: season breakout guard (OVR 90 already reached)
  p.trueOvr=p.ovr;// Store the real rating
  p.personality=generatePersonality(pos,p.age,p.devTrait);// v83: 5-trait personality system
  p.scouting=initScoutState(true,a<=23);// owned players start at 0.85 confidence
  var basePay;
  if(pos==="K"||pos==="P"){basePay=Math.round(rng(3,6)*0.1*10)/10;}
  else{basePay=p.ovr>=85?rng(8,20):p.ovr>=75?rng(3,10):p.ovr>=65?rng(1,4):Math.round(rng(4,15)*0.1*10)/10;}
  if(hasTrait95(p,"mercenary"))basePay=Math.round(basePay*1.2*10)/10;// v95.6: hasTrait95
  if(hasTrait95(p,"loyal"))basePay=Math.round(basePay*0.85*10)/10;
  if(hasTrait95(p,"glass"))basePay=Math.round(basePay*0.8*10)/10;
  basePay=Math.round(basePay*10)/10;
  var cYrs=p.contract.years;var cBonus=basePay>3?Math.round(Math.min(basePay*0.3*cYrs,basePay*cYrs*0.4)*10)/10:0;
  var cBase=Math.max(Math.round((basePay-(cYrs>0?cBonus/cYrs:0))*10)/10,MIN_SALARY);
  p.contract=makeContract(cBase,cYrs,cBonus,Math.round(basePay*Math.min(cYrs,2)*10)/10);
  var isEliteP=p.ovr>=78;
  p.college={school:pickCollege(isEliteP)};
  var HT_RANGES={QB:[73,77],RB:[68,73],WR:[70,77],TE:[75,79],OL:[75,79],DL:[73,79],LB:[72,76],CB:[69,74],S:[70,75],K:[70,75],P:[72,77]};
  var WT_RANGES={QB:[210,240],RB:[195,230],WR:[175,215],TE:[240,265],OL:[295,340],DL:[265,310],LB:[225,260],CB:[180,205],S:[195,220],K:[180,210],P:[200,230]};
  var htR=HT_RANGES[pos]||[72,76];var wtR=WT_RANGES[pos]||[200,240];
  p.height=rng(htR[0],htR[1]);// inches
  p.weight=rng(wtR[0],wtR[1]);// lbs
  p.cliqueId=a>=28?0:a<=23?1:2;// 0=Vets, 1=Young Core, 2=Stars (based on age tier)
  p.chemistry=cl(60+rng(-15,15),30,100);// How bonded to team
  p.systemFit=rng(55,72);// v93.15: Offseason study â€” all players start with system knowledge (55+)
  p.archetype=PLAYER_ARCHETYPES.classify(p);
  p.flexPos76=FLEX_POSITIONS.assign(p);
  return p;
}
// v93.14: Market-rate contract for Instant Start â€” OVR+age â†’ realistic salary range
function marketContract(ovr,age){
  var m;
  if(ovr>=98)m=28;else if(ovr>=95)m=20;else if(ovr>=92)m=15;else if(ovr>=89)m=11;
  else if(ovr>=85)m=8;else if(ovr>=80)m=4.5;else if(ovr>=75)m=2.5;
  else if(ovr>=70)m=1.4;else if(ovr>=65)m=1.0;else m=0.795;
  if(age>=36)m*=0.55;else if(age>=33)m*=0.75;else if(age>=31)m*=0.90;else if(age<=24)m*=0.82;
  var sal=Math.round(Math.min(Math.max(m,CAP_MATH.MIN_SAL.ROOKIE),30.0)*10)/10;
  var yrs=age>=36?1:age>=33?2:age>=31?3:4;
  var bonus=ovr>=85?Math.round(sal*0.12*yrs*10)/10:0;// v93.17: 12% (was 25%) â€” keeps cap hits realistic
  return makeContract(sal,yrs,bonus,Math.round(sal*Math.min(yrs,2)*10)/10);
}
var PRESET_ROSTERS={
  bbq:[// Kansas City â€” Dynasty-tier roster, dominant
    ["Cael Vanthorn","QB",99,25,"ss"],["Dorian Fells","LB",98,22,"ss"],["Remy Callcott","TE",94,28,"ss"],
    ["Tyson Greer","DL",93,27,"ss"],["Marcus Ode","OL",91,26,"s"],["Levi Crux","CB",89,24,"s"],
    ["Donte Vasser","WR",87,26,"s"],["Broderick Noel","S",84,25,"s"],["Cortez Ingle","RB",83,24],
    ["Wade Elston","OL",84,28],["Solomon Finch","WR",81,23],["Rey Maddox","DL",83,25],
    ["Garret Holst","OL",83,27],["Cullen Vance","LB",81,24],["Porter Dunn","WR",80,27],
    ["Noel Castor","CB",79,25],["Blair Holt","K",84,28]
  ],
  doom:[// Baltimore â€” Electric runner at QB, bruising ground game
    ["Ezra Volta","QB",97,26,"ss"],["Crenshaw Mosley","RB",93,27,"ss"],["Torrance Aldrich","S",92,23,"ss"],
    ["Prentice Woad","LB",91,26,"ss"],["Kellen Farrar","TE",85,28,"s"],["Orion Baptiste","OL",84,28,"s"],
    ["Beau Loring","K",81,31],["Cedric Obi","DL",82,24,"s"],["Damon Pryce","CB",83,27,"s"],
    ["Rashawn Colt","WR",82,23,"s"],["Fergus Lyle","OL",84,25],["Kofi Annan","CB",79,23],
    ["Darius Wynn","LB",79,26],["Sawyer Beck","WR",77,25],["Eli Forte","TE",78,23]
  ],
  kraken:[// San Fran â€” Elite RB, elite OL, loaded skill positions
    ["Dillon Ryker","QB",89,25,"s"],["Vance Holloway","RB",96,27,"ss"],["Quincy Alderman","WR",88,27,"ss"],
    ["Ferris Cole","DL",95,25,"ss"],["Benson Trout","OL",96,34,"ss"],["Graham Whittle","TE",93,30,"ss"],
    ["Leon Strade","LB",89,26,"s"],["Colton Bray","WR",86,25,"s"],["Ari Pacheco","S",83,24,"s"],
    ["Shon Gatlin","CB",83,27],["Tre Caswell","S",83,27],["Obinna Jacks","DL",81,26],
    ["Pax Rios","CB",77,23],["Kade Armour","DL",79,32]
  ],
  moth:[// Detroit â€” Elite OL, elite WR1, explosive skill
    ["Reed Cavett","QB",88,29,"s"],["Zuri Holman","WR",94,23,"ss"],["Bram Stokes","OL",94,22,"ss"],
    ["Asher Dial","DL",88,23,"s"],["Dante Rowe","RB",85,22,"s"],["Gus Fortner","OL",89,29,"s"],
    ["Cam Pell","TE",82,26],["Eli Branch","S",83,22,"s"],["Tomas Veal","S",80,23],
    ["Winston Carr","WR",79,23],["Reese Falk","LB",81,26],["Declan Hurd","DL",81,29],
    ["Fitz Cain","K",79,27],["Clay Overton","CB",77,28],["Percy Dumont","RB",77,28]
  ],
  volts:[// Miami â€” Speed everywhere, dynamic QB, track star WR
    ["Marco Elias","QB",86,25,"s"],["Darian Velez","WR",95,29,"ss"],["Jonah Fleury","WR",86,24,"s"],
    ["Soren Kade","S",84,23,"s"],["Vaughn Okafor","OL",86,31,"s"],["Noel Jarvis","CB",84,28,"s"],
    ["Rico Stines","RB",81,31],["Calder Nash","RB",81,23],["Cole Merton","OL",81,27],
    ["Blair Weston","WR",75,22],["Wade Faron","K",81,28],["Dex Whitmore","DL",79,28]
  ],
  yeti:[// Buffalo â€” Elite scrambler QB, powerful defense
    ["Decker Voss","QB",96,27,"ss"],["Rory Stanton","RB",85,22,"s"],["Knox Millard","LB",86,28,"s"],
    ["Pell Owens","DL",84,26,"s"],["Burl Haines","DL",85,33,"s"],["Colt Reeves","DL",85,23,"s"],
    ["Brax Mercer","CB",81,27],["Finn Calloway","TE",81,22],["Wade Darcy","OL",83,28],
    ["Soren Poole","S",81,26],["Garrett Knox","WR",81,23],["Eli Towne","OL",81,24],
    ["Declan Carr","K",81,27],["Cade Rowan","WR",77,21]
  ],
  apex:[// Houston â€” Young franchise QB, elite corner, run stopper
    ["Roman Slade","QB",90,22,"ss"],["Percy Nolan","WR",86,23,"s"],["Dex Harmon","WR",83,30,"s"],
    ["Vance Riddick","DL",86,22,"ss"],["Cole Osei","OL",90,28,"s"],["Elias Renner","CB",89,22,"ss"],
    ["Ferris Nwosu","DL",86,29,"s"],["Cade Forte","RB",84,27,"s"],["Beau Sellers","TE",77,26],
    ["Kai Fielder","K",81,30],["Soren Perkins","DL",75,25],["Reese Kenton","LB",79,26]
  ],
  storm:[// Dallas â€” Elite WR, elite edge rusher, dominant OL
    ["Cason Eldridge","QB",86,30,"s"],["Zuri Blackwood","WR",97,24,"ss"],["Remy Pascal","DL",96,24,"ss"],
    ["Blaine Oswald","OL",94,33,"ss"],["Loren Vance","CB",86,24,"s"],["Drake Alton","CB",85,24,"s"],
    ["Wade Burrell","K",84,27,"s"],["Colt Meyers","OL",83,22],["Beau Dorado","RB",79,25],
    ["Eli Fagan","TE",81,23],["Finch Valdo","DL",81,27],["Liam Keane","S",79,29]
  ],
  frost:[// Minnesota â€” Transcendent WR, solid TE, physical OL
    ["Gus Whitfield","QB",80,26],["Cael Osborne","WR",98,24,"ss"],["Dex Parrish","WR",81,21,"s"],
    ["Remy Claxton","TE",87,26,"s"],["Tate Nordell","OL",87,28,"s"],["Blaine Greaves","DL",84,26,"s"],
    ["Cord Stahl","OL",86,24,"s"],["Ferris Hollis","CB",83,26],["Cort Keller","S",81,34],
    ["Soren Wolfe","LB",82,28],["Bram Doster","RB",79,23],["Kai Larkin","K",81,29]
  ],
  ghost:[// Philadelphia â€” Complete team, elite QB, elite RB, elite WR
    ["Zane Larkin","QB",92,25,"ss"],["Colt Vander","RB",93,26,"ss"],["Garrett Wynn","WR",94,26,"ss"],
    ["Dex Solano","WR",87,25,"s"],["Bram Olstead","OL",92,33,"ss"],["Ferris Rawls","DL",89,22,"ss"],
    ["Cole Harding","OL",86,26,"s"],["Ren Castellano","TE",86,28,"s"],["Noel Spence","CB",83,32],
    ["Blaine Mercer","S",81,26],["Pax Grier","LB",81,23],["Caden Strand","OL",81,24],
    ["Eli Dunbar","K",79,28],["Soren Ruiz","CB",82,22,"s"],["Wade Obasi","DL",83,27]
  ],
  cactus:[// Cincinnati â€” Elite QB, elite WR1, explosive offense
    ["Cael Rawlings","QB",93,26,"ss"],["Darian Croft","WR",96,23,"ss"],["Brax Hollins","WR",86,24,"s"],
    ["Knox Ridley","DL",90,27,"ss"],["Pell Donnelly","OL",84,26,"s"],["Loren Vines","S",81,28],
    ["Orion Hadley","DL",81,27],["Tate Burroughs","CB",79,24],["Cade Whitmore","LB",81,28],
    ["Blaine Fosse","RB",77,26],["Declan Corte","TE",79,25],["Remy Calder","K",83,25,"s"]
  ],
  hawks:[// Atlanta â€” Star RB, physical corners, young talent
    ["Mace Nolan","QB",82,34],["Bram Calderon","RB",90,22,"ss"],["Eli Farrow","WR",84,22,"s"],
    ["Corden Lyle","TE",81,22,"s"],["Noel Terrace","CB",84,24,"s"],["Finch Graber","DL",83,31],
    ["Soren Bauer","OL",86,27,"s"],["Liam Mattox","S",84,26,"s"],["Rex Judson","DL",81,31],
    ["Cord Andover","LB",81,25],["Cade Mooney","WR",77,26],["Kai Yost","K",83,27]
  ],
  blaze:[// Arizona â€” Young mobile QB, star safety, ascending TE
    ["Tate Murillo","QB",83,25,"s"],["Cort Whitaker","WR",81,21,"ss"],["Wade Conner","RB",79,28],
    ["Blaine Osei","TE",86,24,"s"],["Bram Baxter","S",89,27,"ss"],["Declan Parrish","OL",80,21],
    ["Cael Wythe","LB",77,27],["Remy Norris","CB",75,26],["Pell Garner","DL",77,27],
    ["Finch Dorset","WR",75,25],["Liam Strand","LB",78,24],["Wade Prentiss","K",79,29]
  ],
  surge:[// Seattle â€” Physical WR, young CB, run-first offense
    ["Cole Navarro","QB",82,32],["Cael Strand","WR",89,26,"s"],["Eli Lockwood","WR",82,30],
    ["Decker Vance","RB",83,22,"s"],["Soren Briggs","CB",84,22,"s"],["Cord Woolley","CB",81,22,"s"],
    ["Rex Holloway","DL",83,24,"s"],["Blaine Wager","LB",81,32],["Finn Crawford","WR",79,20,"s"],
    ["Bram Whittle","OL",83,23,"s"],["Noel Forrest","DL",79,27],["Kai Emerson","K",79,32]
  ],
  titan:[// Chicago â€” Young franchise QB, dominant edge, slot WR
    ["Brennan Clay","QB",76,21,"ss"],["Wade Morley","WR",85,26,"s"],["Cort Yates","WR",77,20,"s"],
    ["Declan Holt","TE",81,24],["Rex Ashworth","DL",86,26,"s"],["Cael Burton","CB",85,24,"s"],
    ["Blaine Edmund","LB",81,25],["Pell Byrd","S",79,30],["Finn Stokes","OL",81,24],
    ["Cade Tillman","RB",81,25],["Ferris Rhodes","RB",75,24],["Tate Cantrell","K",81,33],
    ["Liam Grant","OL",79,22]
  ],
  sent:[// Denver â€” Young QB developing, elite CB, solid defense
    ["Eli Blakely","QB",76,23,"ss"],["Bram Sutherland","WR",82,28],["Cord Renfro","CB",94,23,"ss"],
    ["Caden Forte","RB",77,22],["Remy Bonnet","LB",81,24,"s"],["Knox Aldridge","DL",81,26],
    ["Mace Quimby","OL",81,24],["Wade Simmons","S",79,29],["Soren Bolts","OL",79,26],
    ["Declan Fosse","TE",77,25],["Cael Luntz","K",79,27],["Finch Ellison","WR",77,25]
  ],
  gator:[// Jacksonville â€” Accurate young QB, explosive RB, elite edge
    ["Colt Ashford","QB",86,24,"s"],["Ferris Tipton","RB",89,24,"ss"],["Pell Thomas","WR",79,21,"s"],
    ["Bram Crane","TE",83,29,"s"],["Rex Garfield","DL",88,25,"ss"],["Wade Campion","LB",81,24],
    ["Finn Osei","LB",77,27],["Cael Pearson","CB",77,25],["Soren Cisco","S",77,25],
    ["Cord Sherwood","OL",81,32],["Declan Rowe","DL",79,27],["Eli McTavish","K",77,32]
  ],
  reap:[// Las Vegas â€” Star pass rusher, aging WR, rebuilding
    ["Mace Corbett","QB",72,24],["Knox Rafferty","DL",96,26,"ss"],["Dex Adams","WR",88,31,"ss"],
    ["Cael Jacobs","RB",79,26],["Liam Hobbs","CB",77,24],["Cord Deblois","S",77,25],
    ["Bram Tolliver","OL",83,28],["Wade Wilkes","DL",79,28],["Finn Spellman","DL",77,25],
    ["Pell Morehead","LB",75,25],["Declan Mayor","TE",75,23],["Eli Carlisle","K",79,28]
  ],
  crown:[// New York â€” Elite DL, raw rookie WR, struggling QB
    ["Tate DeVito","QB",72,25],["Knox Ravine","DL",93,26,"ss"],["Cael Nabors","WR",81,21,"ss"],
    ["Bram Whitmore","OL",83,25,"s"],["Wade Tibbetts","DL",81,23,"s"],["Ferris Harlow","RB",76,26],
    ["Cord Slatten","CB",77,27],["Eli Okereke","LB",77,27],["Soren McKim","S",75,27],
    ["Declan Bell","TE",75,26],["Remy Robins","WR",73,23],["Cort Grander","K",81,34]
  ],
  comet:[// Tennessee â€” Young QB, elite DL, veteran weapons
    ["Finn Lennox","QB",77,23,"s"],["Cord Pollard","RB",81,26],["Declan Hopkins","WR",81,31],
    ["Bram Simmonds","DL",88,26,"s"],["Wade Landree","LB",81,27],["Soren Saffron","OL",77,34],
    ["Eli Awuzie","CB",79,28],["Cael Hooper","S",77,26],["Mace Treylon","WR",75,23],
    ["Tate Henrikson","RB",75,25],["Ferris Folkes","K",79,33],["Knox Horner","TE",73,25]
  ],
  brawl:[// Philadelphia â€” Bruising defense, physical OL, ground-and-pound
    ["Rocco Vega","DL",93,26,"ss"],["Tommy Brink","OL",92,28,"ss"],["Jax Ferarro","LB",91,25,"ss"],
    ["Cade Prescott","QB",85,27,"s"],["Dante Morales","RB",88,24,"s"],["Kai Whitaker","CB",86,23,"s"],
    ["Owen Steele","OL",87,30],["Marco Rossi","S",83,25,"s"],["Zane Hawkins","WR",82,24],
    ["Troy Castellano","DL",84,27],["Niko Sandoval","TE",80,26],["Ellis Crawford","LB",81,28],
    ["Ry Dalton","WR",78,22],["Brock Tanner","K",79,29],["Vince Palazzo","CB",77,24]
  ],
  furnace:[// Pittsburgh â€” Elite safety, strong run game, gritty defense
    ["Beau Hendricks","S",94,25,"ss"],["Darnell Grimes","RB",90,26,"ss"],["Colton Briggs","DL",89,27,"s"],
    ["Shane Mercer","QB",84,28,"s"],["Wade Ironside","OL",88,29,"s"],["Tyson Caldwell","LB",87,24,"s"],
    ["Rex Donovan","WR",83,25],["Emmett Hale","TE",82,27],["Clay Warwick","OL",85,30],
    ["Jace Booker","CB",81,23],["Silas Odom","DL",80,26],["Brady Flynn","WR",79,24],
    ["Nolan Ash","K",78,27],["Kurt Pittman","S",77,25],["Roman Slate","LB",76,28]
  ],
  buzz:[// Charlotte â€” Dynamic young QB, explosive receiver, ascending
    ["Jaylen Storm","QB",88,23,"ss"],["Dex Calloway","WR",91,24,"ss"],["Keyon Ballard","CB",86,22,"s"],
    ["Trevon Oakes","RB",84,25,"s"],["Garrison Cole","OL",87,27,"s"],["Malik Durant","DL",83,24,"s"],
    ["Zaire Foster","TE",81,23],["Preston Ward","LB",82,26],["Avery Kidd","S",80,24],
    ["Nash Goodwin","WR",79,22],["Dorian Pierce","OL",84,28],["Caleb Raines","DL",78,25],
    ["Ty Morrow","K",77,26],["Jett Langston","LB",76,23],["Quinn Mays","CB",75,24]
  ],
  voodoo:[// New Orleans â€” Elite TE, creative offense, voodoo defense
    ["Remy Devereaux","TE",95,27,"ss"],["Armand Baptiste","QB",87,26,"s"],["Thibault Landry","DL",90,25,"ss"],
    ["Lucien Broussard","CB",88,24,"ss"],["Beau Thibodeaux","LB",85,28,"s"],["Marcel Hebert","RB",83,25,"s"],
    ["Dante Guidry","WR",84,23],["Pierre Mouton","OL",86,29],["Roux Fontenot","S",81,24],
    ["Gaston Arceneaux","WR",80,27],["Felix Boudreaux","OL",82,26],["Clovis Duval","DL",79,25],
    ["Hugo Treme","K",78,28],["Rene Castille","WR",77,22],["Noel Breaux","CB",76,23]
  ],
  cuda:[// Tampa Bay â€” Speed everywhere, elite pass rush, young core
    ["Cruz Delgado","DL",93,24,"ss"],["Blaze Santiago","WR",90,23,"ss"],["Reef Nakamura","QB",86,25,"s"],
    ["Jet Cordero","RB",85,23,"s"],["Kai Pescador","CB",87,22,"ss"],["Storm Rivera","S",83,24,"s"],
    ["Finn Galveston","OL",84,27],["Rio Castano","TE",81,25],["Ace Marquez","LB",82,26],
    ["Diego Torres","WR",80,24],["Mateo Reyes","OL",83,28],["Nico Aguilar","DL",79,23],
    ["Cruz Benitez","K",77,26],["Tomas Fuentes","LB",78,25],["Andres Salazar","CB",76,24]
  ],
  wolves:[// Boston â€” Cerebral QB, elite coverage, physical secondary
    ["Beckett O'Brien","QB",91,27,"ss"],["Ronan Murphy","CB",93,25,"ss"],["Declan Walsh","S",89,26,"ss"],
    ["Finn McCarthy","OL",87,29,"s"],["Liam Gallagher","DL",85,25,"s"],["Connor Doyle","LB",86,24,"s"],
    ["Aiden Burke","WR",84,23],["Seamus Quinn","TE",82,27],["Kieran Lynch","RB",81,24],
    ["Padraig Kelly","WR",80,26],["Niall Brennan","OL",83,28],["Eamon Reilly","DL",79,24],
    ["Owen Flanagan","K",78,27],["Callum Hayes","LB",77,25],["Rory Sullivan","WR",76,22]
  ],
  tremor:[// Los Angeles â€” Flashy offense, star WR, celebrity vibes
    ["Phoenix Carter","QB",88,25,"s"],["Marquise Hollywood","WR",94,24,"ss"],["Zion Banks","RB",87,23,"ss"],
    ["Jalen Bridges","CB",86,25,"s"],["Koa Nakamura","DL",89,26,"ss"],["Sterling Cross","OL",85,28,"s"],
    ["Asher Gold","WR",83,22],["Maddox Lane","TE",81,26],["Blaze Cannon","LB",82,24],
    ["Cairo Redd","S",80,23],["Rome Valentino","OL",84,27],["Kai Westbrook","DL",78,25],
    ["Neo Starling","K",79,26],["Jett Malibu","WR",77,24],["Dax Rodeo","CB",76,23]
  ],
  rams97:[// Salt Lake City â€” Dominant OL, ground game, altitude advantage
    ["Jensen Clark","OL",95,27,"ss"],["Brigham Stone","RB",90,26,"ss"],["Dalton Ryder","QB",85,28,"s"],
    ["Summit Young","DL",88,25,"s"],["Canyon Tate","LB",87,24,"ss"],["Aspen Greer","CB",84,23,"s"],
    ["Ridge Bonner","TE",83,26],["Flint Murdock","OL",86,29],["Colt Jennings","S",81,24],
    ["Sage Whitfield","WR",82,25],["Boulder Nash","DL",80,27],["River Kemp","WR",79,22],
    ["Peak Leavitt","K",78,27],["Timber Hale","OL",84,30],["Alpine Vest","LB",76,23]
  ],
  twist:[// Oklahoma City â€” Explosive playmakers, boom-or-bust, high variance
    ["Tornado Jones","QB",87,24,"s"],["Thunder Banks","WR",92,23,"ss"],["Cyclone Davis","DL",88,25,"ss"],
    ["Prairie Williams","RB",85,22,"s"],["Dusty Rhodes","LB",86,27,"s"],["Flint Harper","CB",84,24,"s"],
    ["Gust Coleman","OL",83,28],["Storm Hendrix","TE",81,25],["Blaze Roper","S",80,23],
    ["Hail Beckett","WR",79,24],["Ridge Tucker","OL",82,27],["Bolt Graves","DL",78,26],
    ["Wind Walker","K",77,25],["Dust Chandler","LB",76,24],["Twain Garrett","CB",75,23]
  ],
  shark:[// San Diego â€” Balanced roster, elite corner, beach mentality
    ["Cove Masterson","QB",86,26,"s"],["Pacific Wells","CB",93,24,"ss"],["Reef Thompson","WR",89,25,"ss"],
    ["Tide Alderman","DL",87,27,"s"],["Current Brooks","RB",85,24,"s"],["Bay Henderson","OL",88,28,"ss"],
    ["Anchor Young","TE",83,25],["Shore Mitchell","LB",82,26],["Wave Jackson","S",84,23,"s"],
    ["Marina Diaz","WR",80,22],["Shell Porter","OL",81,29],["Coral Stevens","DL",79,25],
    ["Fin Whitley","K",78,27],["Kelp Murray","WR",77,24],["Dune Foster","CB",76,23]
  ]
};
function genPresetPlayer(preset){
  var name=preset[0],pos=preset[1],targetOvr=preset[2],age=preset[3];
  var dev=preset[4]||"n";
  var tier=targetOvr>=90?"star":targetOvr>=78?"good":targetOvr>=65?"avg":"bad";
  var p=genPlayer(pos,tier,age);
  p.name=name;
  p.devTrait=dev==="ss"?"superstar":dev==="s"?"star":"normal";
  var def=POS_DEF[pos];
  if(def){
    var curOvr=p.ovr;
    var diff=targetOvr-curOvr;
    if(Math.abs(diff)>1){
      var totalW=0;def.w.forEach(function(w){totalW+=w;});
      def.r.forEach(function(r,i){
        var wPct=def.w[i]/totalW;
        var adj=Math.round(diff*(1+wPct));
        p.ratings[r]=cl(p.ratings[r]+adj,40,99);
      });
    }
    var attempts=0;
    p.ovr=calcOvr(p);
    while(Math.abs(p.ovr-targetOvr)>1&&attempts<15){
      var gap=targetOvr-p.ovr;
      def.r.forEach(function(r){p.ratings[r]=cl(p.ratings[r]+(gap>0?1:-1),35,99);});
      p.ovr=calcOvr(p);attempts++;
    }
  }
  p.trueOvr=p.ovr;
  p.everReached90=(p.ovr||0)>=90;
  p.pot=cl(p.ovr+(age<=25?rng(3,12):rng(0,5)),p.ovr,99);
  p.isStarter=true;// Preset players are starters
  return p;
}
function genRoster(q){
  var roster=[];
  var needs=[{pos:"QB",n:3},{pos:"RB",n:3},{pos:"WR",n:5},{pos:"TE",n:3},{pos:"OL",n:8},{pos:"DL",n:6},{pos:"LB",n:6},{pos:"CB",n:5},{pos:"S",n:3},{pos:"K",n:1},{pos:"P",n:1}];
  var tiers={elite:["star","star","good","good","avg","avg","avg","bad"],good:["star","good","good","avg","avg","avg","bad","bad"],
    avg:["good","avg","avg","avg","avg","bad","bad","bad"],bad:["avg","avg","bad","bad","bad","bad","bad","bad"]};
  var pool=tiers[q||"avg"]||tiers.avg;
  needs.forEach(function(nd){for(var i=0;i<nd.n;i++){var tier=i===0?pool[rng(0,2)]:pool[rng(2,pool.length-1)];roster.push(genPlayer(nd.pos,tier));}});
  while(roster.length<53)roster.push(genPlayer(pick(["WR","OL","DL","LB","CB"]),"bad"));
  return roster.slice(0,53);
}
function genPresetRoster(teamId){
  var presets=PRESET_ROSTERS[teamId]||[];
  var roster=[];
  presets.forEach(function(pr){roster.push(genPresetPlayer(pr));});
  var needs=[{pos:"QB",n:3},{pos:"RB",n:3},{pos:"WR",n:5},{pos:"TE",n:3},{pos:"OL",n:8},{pos:"DL",n:6},{pos:"LB",n:6},{pos:"CB",n:5},{pos:"S",n:3},{pos:"K",n:1},{pos:"P",n:1}];
  var have={};roster.forEach(function(p){have[p.pos]=(have[p.pos]||0)+1;});
  needs.forEach(function(nd){
    var existing=have[nd.pos]||0;
    for(var i=existing;i<nd.n;i++){
      var tier=i===0?"good":i<=1?"avg":"bad";
      roster.push(genPlayer(nd.pos,tier));
    }
  });
  while(roster.length<53)roster.push(genPlayer(pick(["WR","OL","DL","LB","CB"]),"bad"));
  roster=roster.slice(0,53);
  // v93.17: Apply marketContract to ALL players then enforce $210M-$245M cap range
  roster.forEach(function(p){p.contract=marketContract(p.ovr,p.age||25);});
  // v98: Diversify contract years so every offseason has 10+ expiring players
  // Real NFL rosters have a mix of 1-4yr deals, not everyone on max-length
  var sorted98=roster.slice().sort(function(a,b){return b.ovr-a.ovr;});
  var yearBuckets98=[1,1,1,2,2,2,3,3,4];// weighted toward shorter deals for depth
  sorted98.forEach(function(p,idx){
    if(idx<5)return;// Top 5 OVR players keep their long deals
    if(p.age>=33)return;// Veterans already have short deals from marketContract
    var roll=yearBuckets98[idx%yearBuckets98.length];
    // Stars (top 15) lean longer, depth players lean shorter
    if(idx<15&&roll===1)roll=2;// Nudge stars from 1yr to 2yr
    if(idx>=35&&rng(0,2)===0)roll=1;// Extra 1yr deals for bottom of roster
    if(roll<p.contract.years){
      var c=p.contract;
      p.contract=makeContract(c.baseSalary,roll,roll>=3?c.signingBonus:0,Math.round(c.baseSalary*Math.min(roll,2)*10)/10);
    }
  });
  // Ceiling: must stay $10M under cap ($245M) â€” scale down proportionally if over
  var capCeil93=(getSalaryCap(2026)||255)-10;
  var total93=roster.reduce(function(s,p){return s+v36_capHit(p.contract);},0);
  if(total93>capCeil93){
    var sf=Math.max(0.5,(capCeil93-5)/total93);
    roster.forEach(function(p){
      var c=p.contract;
      var ns=Math.round(Math.max((c.baseSalary||MIN_SALARY)*sf,CAP_MATH.MIN_SAL.ROOKIE)*10)/10;
      var nb=c.signingBonus?Math.round(c.signingBonus*sf*10)/10:0;
      p.contract=makeContract(ns,c.years||2,nb,Math.round(ns*Math.min(c.years||2,2)*10)/10);
    });
  }
  // Floor: bump depth players if total < $210M
  var total93b=roster.reduce(function(s,p){return s+v36_capHit(p.contract);},0);
  if(total93b<210){
    var gap93=210-total93b;
    var dep93=roster.filter(function(p){return (p.ovr||70)<80;});
    if(dep93.length>0){
      var boost93=Math.round(gap93/dep93.length*10)/10;
      dep93.forEach(function(p){
        var ns2=Math.round(Math.min((p.contract.baseSalary||MIN_SALARY)+boost93,8.0)*10)/10;
        p.contract=makeContract(ns2,p.contract.years||2,0,Math.round(ns2*2*10)/10);
      });
    }
  }
  return roster;
}
function initTeams(ui,usePresets){
  return TD.map(function(td,i){
    var roster;
    if(usePresets&&PRESET_ROSTERS[td.id]){
      roster=genPresetRoster(td.id);
    }else{
      var q=i===ui?"avg":pick(["elite","good","avg","avg","bad"]);roster=genRoster(q);
    }
    var ovrAvg=avg(roster,function(p){return p.ovr;});
    var goal=ovrAvg>74?"title":ovrAvg>68?"playoff":"rebuild";
    return normalizeTeamFranchise976(applyLeagueAlignment97({id:td.id,city:td.city,name:td.name,abbr:td.abbr,icon:td.icon,c1:td.c1,
      roster:roster,practiceSquad:[],wins:0,losses:0,pf:0,pa:0,streak:0,isUser:i===ui,
      schemeOff:pick(OFF_SCHEMES).id,schemeDef:pick(DEF_SCHEMES).id,gameplan:GAMEPLANS[0].id,gameplanOff:"balanced_o",gameplanDef:"balanced_d",
      staff:{hc:genCoach("HC"),oc:genCoach("OC"),dc:genCoach("DC")},staffBudgetSpent:0,
        posCoaches:{qb_coach:generatePosCoach(RNG.ai),ol_coach:generatePosCoach(RNG.ai),dl_coach:generatePosCoach(RNG.ai),db_coach:generatePosCoach(RNG.ai)},// v60
      capUsed:capCalc(roster),deadCap:0,deadCapByYear:{},prestige:50+rng(-10,10),
      cash:((DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).startCash||50)+rng(-5,10),facilities:{gym:1,med:1,stad:1},ticketPrice:75,fanbase:55+rng(-10,15),
        revenue:0,expenses:0,attendance:0,scoutPts:SCOUT_POINT_BASE86,// v95: start with 1000
        _pipelineTripsWeekly:4,// v97.1: weekly college pipeline trips
        reSignNeg84:{},fitAlertPrefs84:{},fitAlertProfile85:"strict",
      scouts:[genScout(),genScout(),genScout()],
      cashSpent:0,ownerSpendRate:Math.round((0.85+RNG.ai()*0.3)*100)/100,// 0.85-1.15
      ownerMood:70,ownerGoal:goal,rivals:[],
      franchiseTag973:null,
      aiStrategy:goal==="title"?"contend":goal==="playoff"?"bubble":"rebuild",
      gmArchetype90:getTeamGMArchetypeId90({id:td.id}),
      draftPicks:[1,2,3,4,5,6,7].map(function(r){return makePick(r,td.id,td.id,2026);})}));
  });
}
function proposeTrade(ut,ai,uP,aP,uPks,aPks,cap,userStrategy,trustBonus69){
  var aiN=getTeamNeeds(ai);
  var uV=uP.reduce(function(s,p){return s+getTradeValue(p,aiN,ai);},0)+(uPks||[]).reduce(function(s,pk){return s+pickValue(pk.round);},0);
  var aV=aP.reduce(function(s,p){return s+getTradeValue(p,null,ai);},0)+(aPks||[]).reduce(function(s,pk){return s+pickValue(pk.round);},0);
  var gmMod=getGMTradeThresholdMod(userStrategy||"neutral");
  var isSelling=uP.length>0&&uP.reduce(function(s,p){return s+p.ovr;},0)/Math.max(1,uP.length)>=(aP.length>0?aP.reduce(function(s,p){return s+p.ovr;},0)/Math.max(1,aP.length):0);
  var stratMod=isSelling?gmMod.sellMod:gmMod.buyMod;
  var uCapDelta=aP.reduce(function(s,p){return s+v36_capHit(p.contract);},0)-uP.reduce(function(s,p){return s+v36_capHit(p.contract);},0);
  var userDeadCap=uP.reduce(function(s,p){return s+v36_deadIfTraded(p.contract);},0);
  var theCap=cap||getSalaryCap(2026);
  if(ut.capUsed+(ut.deadCap||0)+uCapDelta+userDeadCap>theCap){
    var ex=pickEx("cap","overCap");
    return {ok:false,msg:"Over your cap! Trading sends $"+Math.round(userDeadCap*10)/10+"M dead cap to your books.",uV:uV,aV:aV,explain:ex};
  }
  var aiCapSpace=theCap-(ai.capUsed+(ai.deadCap||0));
  var dS=DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro;
  var thresh=(1.0+(0.12*dS.tradeMod))*stratMod;// v52: GM posture adjusts acceptance threshold
  var aiArch90=getTeamGMArchetype90(ai);
  var aiTrade90=aiArch90.trade||{};
  var aiGetsStar90=uP.some(function(p){return (p.ovr||0)>=80;});
  var aiGetsTrench90=uP.some(function(p){return p.pos==="OL"||p.pos==="DL";});
  var aiSendsTrench90=aP.some(function(p){return p.pos==="OL"||p.pos==="DL";});
  var aiSendsCore90=aP.some(function(p){return (p.teamTenure||0)>=3;});
  var aiSendsVet90=aP.some(function(p){return (p.age||0)>28;});
  var aiGetsVet90=uP.some(function(p){return (p.age||0)>28;});
  var aiGetsPick90=(uPks||[]).length>0;
  var aiCapIn90=uP.reduce(function(s,p){return s+v36_capHit(p.contract);},0);
  var aiCapOut90=aP.reduce(function(s,p){return s+v36_capHit(p.contract);},0);
  var aiCapRelief90=aiCapOut90-aiCapIn90;
  var archBlockReason90="";
  if(aiTrade90.strictPositive)thresh*=1.03;
  if(aiTrade90.contenderStarPush&&aiGetsStar90)thresh*=0.82;
  if(aiTrade90.rebuilderVetForPicks){
    if(aiSendsVet90&&aiGetsPick90)thresh*=0.78;
    if(aiGetsVet90&&!aiGetsPick90)thresh*=1.22;
  }
  if(aiTrade90.loyalCoreLock&&aiSendsCore90)thresh*=1.25;// v93: tuned from 1.40 â€” was too aggressive
  if(aiTrade90.moneyballCapRelief){
    if(aiCapRelief90>=4)thresh*=0.82;
    else if(aiCapRelief90<=-4)thresh*=1.18;
  }
  if(aiTrade90.oldSchoolTrenches){
    if(aiSendsTrench90)archBlockReason90="oldSchoolTrench";
    else if(aiGetsTrench90)thresh*=0.86;
  }
  var trustAdj=trustBonus69||0;// -6 to +6
  var foTradesBonus79=FRONT_OFFICE.getBonus(ut.frontOffice||[],"trades");
  var uVBoosted=Math.floor(uV*(1+(foTradesBonus79*0.3)));// Max +15% at OVR 99 GM
  var effectiveUV=uVBoosted+trustAdj*15;// Trust bonus converts to ~value points
  if(aiTrade90.strictPositive&&effectiveUV<aV)archBlockReason90=archBlockReason90||"analyticsStrict";
  if(aiTrade90.loyalCoreLock&&aiSendsCore90&&effectiveUV<aV*1.20)archBlockReason90=archBlockReason90||"loyalCore";// v93: tuned from 1.35
  if(aiTrade90.rebuilderVetForPicks&&aiGetsVet90&&!aiGetsPick90&&effectiveUV<aV*1.15)archBlockReason90=archBlockReason90||"rebuilderTimeline";
  if(!archBlockReason90&&effectiveUV>=aV*thresh) return {ok:true,msg:"Trade accepted!",uV:uV,aV:aV,valueDelta:Math.round(aV-uV)};
  var reason="valueDiff";
  if(archBlockReason90==="analyticsStrict")reason="valueDiff";
  else if(archBlockReason90==="oldSchoolTrench")reason="trenchAnchor";// v93: was incorrectly "contending"
  else if(archBlockReason90==="loyalCore")reason="cornerstone";
  else if(archBlockReason90==="rebuilderTimeline")reason="rebuilderTimeline";// v93: was incorrectly "contending"
  var isLowTrust=trustAdj<=-3&&uV>=aV*thresh*0.95;// Close deal killed by bad trust
  if(!archBlockReason90&&isLowTrust)reason="lowTrust";
  else if(aiCapSpace<aP.reduce(function(s,p){return s+v36_capHit(p.contract);},0))reason="capImpact";
  else if(aP.length===1&&aP[0].ovr>=90&&aP[0].age<=28)reason="cornerstone";
  else if(ai.wins>=8)reason="contending";
  var ex2=pickEx("trade",reason);
  var exOld=EXPLAIN.trade(uV,Math.round(aV*thresh),aiCapSpace,ai.abbr);
  var archMsg90="";
  if(archBlockReason90==="analyticsStrict")archMsg90="âŒ "+ai.abbr+" (Analytics GM) won't trade at a loss on the value chart.";
  else if(archBlockReason90==="oldSchoolTrench")archMsg90="âŒ "+ai.abbr+" (Old School GM) refuses to trade away trench anchors.";
  else if(archBlockReason90==="loyalCore")archMsg90="âŒ "+ai.abbr+" (Loyalist GM) won't move core players with 3+ years in-house.";
  else if(archBlockReason90==="rebuilderTimeline")archMsg90="âŒ "+ai.abbr+" (Rebuilder GM) avoids adding older veterans without draft capital.";
  var rejectMsg=archMsg90||(reason==="lowTrust"?"âŒ "+ai.abbr+" doesn't trust you enough for this deal. Build trust with fair trades.":exOld.text);
  return {ok:false,msg:rejectMsg,reason:reason,uV:uV,aV:aV,need:Math.round(aV*thresh),explain:ex2,valueDelta:Math.round(aV-uV)};
}
function archiveSeason(teams,wId,yr,sched){try{return _archiveSeasonInner(teams,wId,yr,sched);}catch(archErr){console.error("archiveSeason crash:",archErr);return {year:yr,champ:{name:"",abbr:"",icon:"",w:0,l:0},mvp:null,allPro1st:{},allPro2nd:{},proBowl:[],proBowlGame74:{scoreA:0,scoreB:0,mvp:null},opoy:null,dpoy:null,roy:null,coty:null,standings:[],winnerId:wId,supGames:{highScore:null,blowout:null,upset:null},teamRecords:[]};}}
function _archiveSeasonInner(teams,wId,yr,sched){
  var ch=teams.find(function(t){return t.id===wId;});
  // Compute records from schedule if team.wins is 0 (stale state fix)
  var schedRec={};
  if(sched&&sched.length>0){
    sched.forEach(function(g){if(!g.played||!g.result)return;
      if(!schedRec[g.home])schedRec[g.home]={w:0,l:0,pf:0,pa:0};
      if(!schedRec[g.away])schedRec[g.away]={w:0,l:0,pf:0,pa:0};
      schedRec[g.home].pf+=g.result.home;schedRec[g.home].pa+=g.result.away;
      schedRec[g.away].pf+=g.result.away;schedRec[g.away].pa+=g.result.home;
      if(g.result.home>g.result.away){schedRec[g.home].w++;schedRec[g.away].l++;}
      else{schedRec[g.away].w++;schedRec[g.home].l++;}
    });
  }
  function _tw(t){return (t.wins||0)||(schedRec[t.id]?schedRec[t.id].w:0);}
  function _tl(t){return (t.losses||0)||(schedRec[t.id]?schedRec[t.id].l:0);}
  function _tpf(t){return (t.pf||0)||(schedRec[t.id]?schedRec[t.id].pf:0);}
  function _tpa(t){return (t.pa||0)||(schedRec[t.id]?schedRec[t.id].pa:0);}
  var all=teams.reduce(function(acc,t){return acc.concat(t.roster.map(function(p){return assign({},p,{tA:t.abbr,tW:_tw(t),tL:_tl(t),tIcon:t.icon,tId:t.id});}));},[]);
  var perfScore=function(p){
    var s=p.stats||{};var pff=p.pff||50;
    var pffMod=(pff-60)*2;// Reduced â€” was (pff-50)*5-8
    if(p.pos==="QB") return (s.passYds*1.1+s.passTD*25-s.int*35+(s.rushTD||0)*18)+pffMod*1.5+p.ovr*0.8;
    if(p.pos==="RB") return (s.rushYds*1.1+s.rushTD*35+(s.rec||0)*6+(s.recYds||0)*0.6)+pffMod+p.ovr*0.5;
    if(p.pos==="WR"||p.pos==="TE") return (s.recYds*1.1+s.recTD*45+s.rec*3)+pffMod+p.ovr*0.5;
    if(p.pos==="DL"||p.pos==="LB") return (s.sacks*90+s.tackles*4+s.defINT*55)+pffMod+p.ovr*0.5;
    if(p.pos==="CB"||p.pos==="S") return (s.defINT*90+s.tackles*4)+pffMod+p.ovr*0.5;
    if(p.pos==="K") return (s.fgM||0)*55+pffMod*0.8+p.ovr*0.3;
    if(p.pos==="OL") return p.ovr*10+pffMod*1.2-(s.sacksAllowed||0)*22;
    if(p.pos==="P"){var pAvg3=s.punts>0?(s.puntYds/s.punts):0;return((s.punts||0)*4+(pAvg3-38)*10)+pffMod*0.8+p.ovr*0.3;}
    return p.ovr;
  };
  var mvpPool=all.filter(function(p){return p.stats&&p.stats.gp>=6&&p.tW>=6;});
  var mvpScored=mvpPool.map(function(p){
    var base=perfScore(p);
    var teamBonus=p.tW>=12?1.20:p.tW>=10?1.12:p.tW>=8?1.06:1.0;
    var posBonus=p.pos==="QB"?1.25:(["RB","WR","TE"].indexOf(p.pos)>=0?1.0:0.7);
    return assign({},p,{mvpScore:Math.round(base*teamBonus*posBonus)});
  }).sort(function(a,b){return b.mvpScore-a.mvpScore;});
  var mvp=mvpScored[0]||null;
  var opoyPool=all.filter(function(p){return ["RB","WR","TE"].indexOf(p.pos)>=0&&p.stats&&p.stats.gp>=6;})
    .sort(function(a,b){return perfScore(b)-perfScore(a);});
  var opoy=opoyPool[0]||null;
  var defP=all.filter(function(p){return ["DL","LB","CB","S"].indexOf(p.pos)>=0&&p.stats&&p.stats.gp>=6;}).sort(function(a,b){return perfScore(b)-perfScore(a);});
  var dpoy=defP[0]||null;
  var rookies=all.filter(function(p){return p.age<=22&&p.stats&&p.stats.gp>=4;}).sort(function(a,b){return perfScore(b)-perfScore(a);});
  var roy=rookies[0]||null;
  var cotyTeam=teams.slice().sort(function(a,b){
    var aOver=_tw(a)-(a.roster.reduce(function(s,p){return s+p.ovr;},0)/Math.max(1,a.roster.length))/5;
    var bOver=_tw(b)-(b.roster.reduce(function(s,p){return s+p.ovr;},0)/Math.max(1,b.roster.length))/5;
    return bOver-aOver;
  })[0];
  var AP_SLOTS={QB:1,RB:1,WR:2,TE:1,OL:3,DL:2,LB:2,CB:2,S:1,K:1,P:1};
  var allPro1st={};var allPro2nd={};
  Object.keys(AP_SLOTS).forEach(function(pos){
    var n=AP_SLOTS[pos];
    var pool=all.filter(function(p){return p.pos===pos&&p.stats&&p.stats.gp>=4;});
    var sorted=pos==="OL"?pool.sort(function(a,b){return (b.pff||50)-(a.pff||50)||(b.ovr-a.ovr);}):
      pool.sort(function(a,b){return perfScore(b)-perfScore(a);});
    allPro1st[pos]=sorted.slice(0,n).map(function(p){return {name:p.name,ovr:p.ovr,pff:p.pff||50,tm:p.tA,tIcon:p.tIcon,score:Math.round(perfScore(p))};});
    allPro2nd[pos]=sorted.slice(n,n*2).map(function(p){return {name:p.name,ovr:p.ovr,pff:p.pff||50,tm:p.tA,tIcon:p.tIcon,score:Math.round(perfScore(p))};});
  });
  var proBowl=[];
  ["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"].forEach(function(pos){
    var n2=pos==="OL"?5:pos==="WR"?4:pos==="DL"||pos==="LB"?3:pos==="CB"?3:pos==="K"||pos==="P"?1:2;
    var pool2=all.filter(function(p){return p.pos===pos&&p.stats&&p.stats.gp>=4;});
    var sorted2=pos==="OL"?pool2.sort(function(a,b){return (b.pff||50)-(a.pff||50);}):pool2.sort(function(a,b){return perfScore(b)-perfScore(a);});
    sorted2.slice(0,n2).forEach(function(p){proBowl.push({name:p.name,pos:p.pos,ovr:p.ovr,pff:p.pff||50,tm:p.tA,tIcon:p.tIcon});});
  });
  all.forEach(function(p){
    Object.keys(allPro1st).forEach(function(pos){
      if(allPro1st[pos].some(function(a){return a.name===p.name;})){
        var orig=teams.reduce(function(acc,t){return acc.concat(t.roster);},[]).find(function(x){return x.name===p.name;});
        if(orig){orig.careerStats.allPros=(orig.careerStats.allPros||0)+1;}
      }
    });
    if(proBowl.some(function(pb){return pb.name===p.name;})){
      var orig2=teams.reduce(function(acc,t){return acc.concat(t.roster);},[]).find(function(x){return x.name===p.name;});
      if(orig2){orig2.careerStats.proBowls=(orig2.careerStats.proBowls||0)+1;}
    }
  });
  var proBowlScore74={teamA:rng(17,35),teamB:rng(14,38)};
  var pbMVP74=proBowl.length>0?proBowl[Math.floor(RNG.play()*proBowl.length)]:null;
  var mvpRunnerUp74=mvpScored.length>1?mvpScored[1]:null;
  var mvpMargin74=mvp&&mvpRunnerUp74?Math.round(mvp.mvpScore-mvpRunnerUp74.mvpScore):0;
  var opoyRunnerUp74=opoyPool.length>1?opoyPool[1]:null;
  var dpoyRunnerUp74=defP.length>1?defP[1]:null;
  var royRunnerUp74=rookies.length>1?rookies[1]:null;
  // v93.19: Build rich stat lines for each award winner
  function statLine(p){
    if(!p||!p.stats)return "";
    var s=p.stats;
    if(p.pos==="QB") return (s.passYds||0)+"yd "+(s.passTD||0)+"TD "+(s.int||0)+"INT "+(s.rushYds>200?(s.rushYds+"rushYd "):"");
    if(p.pos==="RB") return (s.rushYds||0)+"rushYd "+(s.rushTD||0)+"TD "+(s.recYds>100?(s.recYds+"recYd "):"");
    if(p.pos==="WR"||p.pos==="TE") return (s.rec||0)+"rec "+(s.recYds||0)+"yd "+(s.recTD||0)+"TD";
    if(["DL","LB"].indexOf(p.pos)>=0) return (s.sacks||0)+"sacks "+(s.tackles||0)+"tkl "+(s.defINT||0)+"INT";
    if(p.pos==="CB"||p.pos==="S") return (s.defINT||0)+"INT "+(s.tackles||0)+"tkl "+(s.sacks||0)+"sacks";
    return (s.tackles||0)+"tkl "+(s.sacks||0)+"sacks";
  }
  // Build superlative game data with full boxscore
  var supGames={highScore:null,blowout:null,upset:null};
  var hscore=0,bmargin=0,udiff=0;
  if(sched&&sched.length>0){
    sched.forEach(function(g){
      if(!g.played||!g.result)return;
      var hT3=teams.find(function(t){return t.id===g.home;});
      var aT3=teams.find(function(t){return t.id===g.away;});
      if(!hT3||!aT3)return;
      var total=g.result.home+g.result.away;
      var margin=Math.abs(g.result.home-g.result.away);
      var winner=g.result.home>g.result.away?hT3:aT3;
      var loser=g.result.home>g.result.away?aT3:hT3;
      var winScore=Math.max(g.result.home,g.result.away);
      var loseScore=Math.min(g.result.home,g.result.away);
      if(total>hscore){hscore=total;supGames.highScore={wTeam:winner.abbr,wIcon:winner.icon,wScore:winScore,lTeam:loser.abbr,lIcon:loser.icon,lScore:loseScore,total:total,week:g.week};}
      if(margin>bmargin){bmargin=margin;supGames.blowout={wTeam:winner.abbr,wIcon:winner.icon,wScore:winScore,lTeam:loser.abbr,lIcon:loser.icon,lScore:loseScore,margin:margin,week:g.week};}
      var hW=_tw(hT3);var aW=_tw(aT3);var wW=_tw(winner);var lW=_tw(loser);
      var diff=lW-wW;
      if(diff>udiff){udiff=diff;supGames.upset={wTeam:winner.abbr,wIcon:winner.icon,wScore:winScore,lTeam:loser.abbr,lIcon:loser.icon,lScore:loseScore,diff:diff,week:g.week};}
    });
  }
  var playoffField97=null;
  var playoffIds97={};
  try{
    if(typeof buildPlayoffField97==="function"&&teams&&teams.length>=30){
      playoffField97=buildPlayoffField97(teams);
    }
  }catch(_archPO97){
    playoffField97=null;
  }
  if(playoffField97&&playoffField97.seeds){
    playoffField97.seeds.forEach(function(s){
      if(s&&s.id)playoffIds97[s.id]={isDivChamp:!!s.isDivChamp};
    });
  }
  return {year:yr,champ:{name:ch?ch.name:"",abbr:ch?ch.abbr:"",icon:ch?ch.icon:"",w:ch?_tw(ch):0,l:ch?_tl(ch):0},
    mvp:mvp?{name:mvp.name,pos:mvp.pos,tm:mvp.tA,ovr:mvp.ovr,pff:mvp.pff||0,
      hl:statLine(mvp),gp:(mvp.stats&&mvp.stats.gp)||0,
      margin74:mvpMargin74,runnerUp74:mvpRunnerUp74?{name:mvpRunnerUp74.name,pos:mvpRunnerUp74.pos,tm:mvpRunnerUp74.tA}:null}:null,
    allPro1st:allPro1st,allPro2nd:allPro2nd,proBowl:proBowl,
    proBowlGame74:{scoreA:proBowlScore74.teamA,scoreB:proBowlScore74.teamB,mvp:pbMVP74?{name:pbMVP74.name,pos:pbMVP74.pos,tm:pbMVP74.tm}:null},
    opoy:opoy?{name:opoy.name,pos:opoy.pos,tm:opoy.tA,pff:opoy.pff||0,
      hl:statLine(opoy),gp:(opoy.stats&&opoy.stats.gp)||0,
      runnerUp74:opoyRunnerUp74?{name:opoyRunnerUp74.name,pos:opoyRunnerUp74.pos,tm:opoyRunnerUp74.tA}:null}:null,
    dpoy:dpoy?{name:dpoy.name,pos:dpoy.pos,tm:dpoy.tA,pff:dpoy.pff||0,
      hl:statLine(dpoy),gp:(dpoy.stats&&dpoy.stats.gp)||0,
      runnerUp74:dpoyRunnerUp74?{name:dpoyRunnerUp74.name,pos:dpoyRunnerUp74.pos,tm:dpoyRunnerUp74.tA}:null}:null,
    roy:roy?{name:roy.name,pos:roy.pos,tm:roy.tA,pff:roy.pff||0,
      hl:statLine(roy),gp:(roy.stats&&roy.stats.gp)||0,
      runnerUp74:royRunnerUp74?{name:royRunnerUp74.name,pos:royRunnerUp74.pos,tm:royRunnerUp74.tA}:null}:null,
    coty:cotyTeam?{name:cotyTeam.staff&&cotyTeam.staff.hc?cotyTeam.staff.hc.name:"HC",tm:cotyTeam.abbr,icon:cotyTeam.icon,w:_tw(cotyTeam),l:_tl(cotyTeam)}:null,
    standings:teams.map(function(t){return {a:t.abbr,i:t.icon,w:_tw(t),l:_tl(t)};}).sort(function(a,b){return b.w-a.w;}),
    winnerId:wId,supGames:supGames,
    teamRecords:teams.map(function(t){
      var pInfo97=playoffIds97[t.id]||null;
      return {
        id:t.id,abbr:t.abbr,wins:_tw(t),losses:_tl(t),pf:_tpf(t),pa:_tpa(t),
        conf:t.conf||"",divId:t.divId||"",
        madePlayoffs:pInfo97?true:!!t.madePlayoffs,
        isDivChamp:pInfo97?!!pInfo97.isDivChamp:false
      };
    })};
}
function unitR(players,n,attr){
  var s=players.filter(function(p){return !(p.injury&&p.injury.games>0);}).sort(function(a,b){return(b.ratings[attr]||50)-(a.ratings[attr]||50);}).slice(0,n);
  return s.length?avg(s,function(p){return p.ratings[attr]||50;}):40;
}
function starters(r,pos,n){
  var healthy=r.filter(function(p){return p.pos===pos&&!(p.injury&&p.injury.games>0);});
  healthy.sort(function(a,b){var aS=a.isStarter?1:0;var bS=b.isStarter?1:0;return bS-aS||b.ovr-a.ovr;});
  return healthy.slice(0,n||1);
}
function aiPickOffGPPreview(t){
  if(t.gameplanOff) return t.gameplanOff;
  var gGp=function(roster,pos){return roster.filter(function(p){return pos.indexOf(p.pos)>=0&&!(p.injury&&p.injury.games>0);});};
  var qbs=gGp(t.roster,["QB"]);var rbs=gGp(t.roster,["RB"]);var wrs=gGp(t.roster,["WR","TE"]);
  var qbOvr=qbs.length?qbs[0].ovr:50;var rbOvr=rbs.length?rbs[0].ovr:50;
  var wrOvr=wrs.length?Math.round(wrs.slice(0,3).reduce(function(s,p){return s+p.ovr;},0)/Math.min(3,wrs.length)):50;
  if(qbOvr>=78&&wrOvr>=74) return "air_raid";
  if(rbOvr>=78&&qbOvr<72) return "ground_pound";
  if(qbOvr>=76&&rbOvr>=72) return "play_action";
  if(qbOvr>=74) return "west_coast";
  return "balanced_o";
}
function aiPickDefGPPreview(t){
  if(t.gameplanDef) return t.gameplanDef;
  var gGp=function(roster,pos){return roster.filter(function(p){return pos.indexOf(p.pos)>=0&&!(p.injury&&p.injury.games>0);});};
  var dls=gGp(t.roster,["DL","LB"]);var cbs=gGp(t.roster,["CB","S"]);
  var dlOvr=dls.length?Math.round(dls.slice(0,5).reduce(function(s,p){return s+p.ovr;},0)/Math.min(5,dls.length)):50;
  var cbOvr=cbs.length?Math.round(cbs.slice(0,3).reduce(function(s,p){return s+p.ovr;},0)/Math.min(3,cbs.length)):50;
  if(dlOvr>=78&&cbOvr<70) return "blitz_heavy";
  if(cbOvr>=78) return "man_press";
  if(dlOvr>=76) return "run_stuff";
  if(cbOvr>=74&&dlOvr<72) return "zone_cov";
  return "balanced_d";
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v98.6: PLAY-BY-PLAY ENGINE â€” Real football. Every snap. Every down.
// Inspired by Madden NFL 2001. Down & distance. Clock. Field position. 
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


// â”€â”€ DEEPSEEK v99.2: MATH ENGINE FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Win Probability lookup table (sigmoid: 1/(1+exp(-scoreDiff*0.15*leverage)))
// leverage = 1 + (quarter-1)*0.55
var WP_TABLE_DEEPSEEK={
  "neg21_q1":4,"neg14_q1":11,"neg7_q1":26,"0_q1":50,
  "pos7_q1":74,"pos14_q1":89,"pos21_q1":96,
  "neg21_q2":3,"neg14_q2":9,"neg7_q2":22,"0_q2":50,
  "pos7_q2":78,"pos14_q2":91,"pos21_q2":97,
  "neg21_q3":2,"neg14_q3":6,"neg7_q3":16,"0_q3":50,
  "pos7_q3":84,"pos14_q3":94,"pos21_q3":98,
  "neg21_q4":1,"neg14_q4":3,"neg7_q4":9,"0_q4":50,
  "pos7_q4":91,"pos14_q4":97,"pos21_q4":99
};

// Momentum decay: slowly drifts toward 0 each play
function momentumDecay991(currentMomentum){
  var decay=0.5;
  if(currentMomentum>0)return Math.max(0,currentMomentum-decay);
  else if(currentMomentum<0)return Math.min(0,currentMomentum+decay);
  return 0;
}

// Edge-to-probability: maps edge (-15 to +15) to win prob [0.30, 0.70]
// edge=0â†’0.50, edge=+10â†’~0.65, edge=-10â†’~0.35
function edgeToProbability991(edge){
  var k=0.1946;
  return 0.3+0.4/(1+Math.exp(-k*edge));
}

// Draft pick overall rating: Box-Muller normal distribution per round
// round: 1-7, pick: 1-32 within round. Returns integer 40-99.
function draftPickOvr991(round,pick){
  var ranges=[{min:78,max:85},{min:72,max:79},{min:68,max:74},{min:65,max:71},{min:62,max:68},{min:58,max:64},{min:55,max:61}];
  var idx=Math.min(6,Math.max(0,round-1));
  var min=ranges[idx].min;var max=ranges[idx].max;
  var spread=max-min;var mid=(min+max)/2;var step=spread/31;
  var mean=mid+(16.5-pick)*step;var stdDev=5;
  var u=0,v=0;while(u===0)u=Math.random();while(v===0)v=Math.random();
  var z=Math.sqrt(-2.0*Math.log(u))*Math.cos(2.0*Math.PI*v);
  var rating=Math.round(mean+z*stdDev);
  if(rating<40)rating=40;if(rating>99)rating=99;return rating;
}
// â”€â”€ END DEEPSEEK v99.2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// v99.3 â€” Claude: Special Teams Plays + Coverage Packages
var SPECIAL_PLAYS_993 = {
  trickPlays: [
    {
      id: "fake_punt",
      label: "Fake Punt",
      icon: "ðŸŽ­",
      desc: "Punter takes the snap and runs â€” catches the coverage unit completely off guard",
      type: "run",
      ydsBase: [-2, 18],
      bigPlay: 0.35,
      fumble: 0.06,
      incPct: 0,
      intPct: 0,
      sackPct: 0,
      isTrick: true,
      shortYdsOk: false,
      noHuddleOk: false,
      commentary: [
        "FAKE PUNT! The punter tucks it and runs!",
        "They kept the offense out there â€” it's a fake! He's got room!",
        "Fake punt â€” the coverage unit is caught completely flat-footed!",
        "WHAT A CALL! The punter takes off and the defense has no answer!"
      ]
    },
    {
      id: "flea_flicker",
      label: "Flea Flicker",
      icon: "ðŸª°",
      desc: "RB takes the handoff and tosses it back to the QB for a deep bomb",
      type: "pass",
      ydsBase: [12, 45],
      bigPlay: 0.45,
      fumble: 0.04,
      incPct: 0.40,
      intPct: 0.06,
      sackPct: 0.12,
      isTrick: true,
      shortYdsOk: false,
      noHuddleOk: false,
      commentary: [
        "Flea flicker! RB pitches it back â€” QB lets it fly!",
        "It's a flea flicker! The secondary bit HARD on that run fake!",
        "FLEA FLICKER! The defense is turned around â€” wide open downfield!",
        "Handoff, pitch back, LAUNCH! That's the flea flicker at its finest!"
      ]
    },
    {
      id: "hook_lateral",
      label: "Hook & Lateral",
      icon: "ðŸ”€",
      desc: "WR catches a short hook then laterals to a trailing teammate at full speed",
      type: "pass",
      ydsBase: [0, 25],
      bigPlay: 0.32,
      fumble: 0.08,
      incPct: 0.30,
      intPct: 0.04,
      sackPct: 0.06,
      isTrick: true,
      shortYdsOk: false,
      noHuddleOk: false,
      commentary: [
        "Hook and lateral! The pitch is clean â€” he's got blockers!",
        "Short catch â€” AND HE LATERALS! The trailing man has the ball!",
        "HOOK AND LATERAL! They practiced this one all week!",
        "Catch, pitch, AND HE'S GONE! The hook and lateral breaks the defense wide open!"
      ]
    },
    {
      id: "qb_sneak",
      label: "QB Sneak",
      icon: "ðŸ",
      desc: "QB dives behind the center â€” the ultimate short yardage play",
      type: "run",
      ydsBase: [0, 3],
      bigPlay: 0.02,
      fumble: 0.01,
      incPct: 0,
      intPct: 0,
      sackPct: 0,
      isTrick: false,
      shortYdsOk: true,
      noHuddleOk: true,
      commentary: [
        "QB sneak! He pushes forward behind the center!",
        "Quarterback dives over the top â€” did he get it?",
        "Sneak play! The pile pushes forward â€” tough, physical football!",
        "QB lowers his shoulder and burrows through the line â€” pure grit!"
      ]
    }
  ],
  passVariants: [
    {
      id: "fake_fg_pass",
      label: "Fake FG Pass",
      icon: "ðŸ¹",
      desc: "Holder stands up and fires to the tight end leaking into the flat",
      type: "pass",
      ydsBase: [8, 22],
      bigPlay: 0.28,
      fumble: 0.02,
      incPct: 0.35,
      intPct: 0.05,
      sackPct: 0.08,
      isTrick: true,
      shortYdsOk: false,
      noHuddleOk: false,
      commentary: [
        "FAKE FIELD GOAL! The holder stands up â€” he's throwing!",
        "It's a fake! The holder fires to the tight end in the flat!",
        "Nobody picked up the tight end â€” FAKE FG and he's wide open!",
        "WHAT A PLAY CALL! Fake field goal, holder to TE â€” first down!"
      ]
    },
    {
      id: "end_around_pass",
      label: "End Around Pass",
      icon: "ðŸŒ€",
      desc: "WR takes the reverse handoff and throws back across the field",
      type: "pass",
      ydsBase: [-3, 30],
      bigPlay: 0.30,
      fumble: 0.05,
      incPct: 0.38,
      intPct: 0.08,
      sackPct: 0.10,
      isTrick: true,
      shortYdsOk: false,
      noHuddleOk: false,
      commentary: [
        "End around â€” AND HE THROWS! The receiver is a quarterback tonight!",
        "Reverse handoff â€” he pulls up and launches it downfield!",
        "It's an end around pass! The defense is scrambling!",
        "WR takes the reverse and FIRES across the field â€” what a design!"
      ]
    },
    {
      id: "shovel_pass",
      label: "Shovel Pass",
      icon: "ðŸ¥„",
      desc: "QB flips an underhand shovel to the RB slipping through the line",
      type: "pass",
      ydsBase: [1, 8],
      bigPlay: 0.06,
      fumble: 0.02,
      incPct: 0.10,
      intPct: 0.01,
      sackPct: 0.04,
      isTrick: false,
      shortYdsOk: true,
      noHuddleOk: true,
      commentary: [
        "Shovel pass! Quick flip to the back â€” he slips through!",
        "Underhand shovel to the running back â€” picks up the first down!",
        "QB shovels it underneath â€” the defense was looking downfield!",
        "Quick shovel pass right through the heart of the line â€” clever call!"
      ]
    }
  ]
};

var SPECIAL_COVERAGES_993 = [
  {
    id: "dime",
    label: "Dime Package",
    icon: "ðŸ’Ž",
    desc: "Six defensive backs blanket every receiver â€” maximum coverage, vulnerable against the run",
    mods: { short: -2, deep: 5, rush: -8, blitz: 0.08, sackMod: 0.02 }
  },
  {
    id: "goal_line",
    label: "Goal Line Defense",
    icon: "ðŸ°",
    desc: "Extra linemen and linebackers stacked in the box â€” built to stuff the run at the goal line",
    mods: { short: -5, deep: -8, rush: 12, blitz: 0.15, sackMod: 0.05 }
  },
  {
    id: "cover3_zone",
    label: "Cover 3 Zone",
    icon: "ðŸ›¡ï¸",
    desc: "Three-deep zone with four underneath â€” balanced and reliable across the field",
    mods: { short: 1, deep: 2, rush: 1, blitz: 0.10, sackMod: 0.01 }
  },
  {
    id: "bear_defense",
    label: "Bear Defense",
    icon: "ðŸ»",
    desc: "Overloaded front with four DL and three stacked linebackers â€” collapses the pocket and destroys the run game",
    mods: { short: -1, deep: -6, rush: 10, blitz: 0.22, sackMod: 0.08 }
  }
];

// v99.3 â€” Win Probability Engine v2 â†’ extracted to src/systems/win-probability.js (module swap #10)

var PLAYBOOK_986={
  // â”€â”€ OFFENSIVE PLAYS â”€â”€
  offense:{
    run:[
      {id:"hb_dive",label:"HB Dive",icon:"ðŸˆ",desc:"A-gap power",type:"run",
        ydsBase:[1,5],bigPlay:0.06,fumble:0.02,commentary:["Dives into the A-gap","Runs straight up the gut","Between the guards"]},
      {id:"hb_toss",label:"HB Toss",icon:"âš¡",desc:"Outside speed",type:"run",
        ydsBase:[-2,8],bigPlay:0.12,fumble:0.03,commentary:["Toss to the left side","Pitch play to the outside!","Sweeps around the edge"]},
      {id:"hb_counter",label:"Counter",icon:"ðŸ”„",desc:"Misdirection run",type:"run",
        ydsBase:[0,7],bigPlay:0.10,fumble:0.02,commentary:["Counter play â€” misdirection!","Fakes left, cuts right!","Counter run behind the pulling guard"]},
      {id:"hb_draw",label:"Draw Play",icon:"ðŸŽ­",desc:"Fake pass, delayed run",type:"run",
        ydsBase:[0,9],bigPlay:0.09,fumble:0.02,commentary:["Draw play!","Fake drop-back â€” it's a run!","Delayed handoff â€” the DL bit!"]},
      {id:"qb_sneak",label:"QB Sneak",icon:"ðŸ¤«",desc:"Short yardage â€” push the pile",type:"run",
        ydsBase:[0,3],bigPlay:0.01,fumble:0.01,commentary:["QB sneak!","Push the pile!","Tush push!","Quarterback wedge"]},
      {id:"power_sweep",label:"Power Sweep",icon:"ðŸ¦¬",desc:"Pulling guards lead the way",type:"run",
        ydsBase:[0,6],bigPlay:0.08,fumble:0.02,commentary:["Power sweep!","Guards pulling â€” follow the blockers!","Sweep to the strong side!"]},
      {id:"jet_sweep",label:"Jet Sweep",icon:"ðŸ’¨",desc:"WR takes pitch on jet motion â€” explosive outside run",type:"run",
        ydsBase:[-2,18],bigPlay:0.30,fumble:0.03,commentary:["Jet sweep!","WR takes the pitch on jet motion!","Speedy receiver turns the corner â€” huge gain possible!","Fly sweep â€” he's got daylight!"]},
      {id:"wr_reverse",label:"WR Reverse",icon:"ðŸ”„",desc:"WR takes handoff going opposite direction â€” misdirection",type:"run",
        ydsBase:[-4,22],bigPlay:0.28,fumble:0.04,commentary:["WR Reverse!","Wide receiver on the end-around!","Misdirection â€” the defense is confused!","Handoff to the wide receiver going the other way!"]}
    ],
    shortPass:[
      {id:"slant",label:"Quick Slant",icon:"â†—ï¸",desc:"Inside route, fast throw",type:"pass",
        ydsBase:[4,10],incPct:0.22,intPct:0.02,sackPct:0.04,bigPlay:0.05,
        commentary:["Quick slant over the middle","Fires inside â€” slant route","Slot receiver on the slant"]},
      {id:"curl",label:"Curl Route",icon:"ðŸ”",desc:"Sit in the zone",type:"pass",
        ydsBase:[5,12],incPct:0.25,intPct:0.02,sackPct:0.05,bigPlay:0.04,
        commentary:["Curl route â€” sitting in the zone","Hooks up at the sticks","Out route, turns back to the quarterback"]},
      {id:"screen",label:"WR Screen",icon:"ðŸª¤",desc:"Quick throw, blockers lead",type:"pass",
        ydsBase:[-1,15],incPct:0.15,intPct:0.01,sackPct:0.02,bigPlay:0.10,
        commentary:["Screen pass!","Quick throw to the flat","Tunnel screen â€” blockers in front!"]},
      {id:"flat",label:"Check Down",icon:"â¬‡ï¸",desc:"Dump to RB in flat",type:"pass",
        ydsBase:[2,7],incPct:0.18,intPct:0.01,sackPct:0.03,bigPlay:0.03,
        commentary:["Check down to the back","Dumps it off to the flat","Safety valve â€” out to the running back"]},
      {id:"te_drag",label:"TE Drag",icon:"ðŸŽ¯",desc:"TE across the middle",type:"pass",
        ydsBase:[4,11],incPct:0.20,intPct:0.02,sackPct:0.04,bigPlay:0.04,
        commentary:["Tight end drag across the formation","TE over the middle!","Drags underneath, finds the soft spot"]},
      {id:"te_seam",label:"TE Seam Route",icon:"ðŸ”±",desc:"Tight end splits the safeties down the seam â€” high pct",type:"pass",
        ydsBase:[8,22],incPct:0.28,intPct:0.03,sackPct:0.06,bigPlay:0.20,
        commentary:["TE up the seam!","Tight end splits the safeties!","Seam route â€” right between the deep defenders!","The tight end finds the open lane!"]},
      {id:"rpo_slant",label:"RPO Slant",icon:"âš¡",desc:"Run-pass option â€” QB reads the linebacker at the mesh point",type:"pass",
        ydsBase:[4,16],incPct:0.24,intPct:0.03,sackPct:0.04,bigPlay:0.12,
        commentary:["RPO â€” reading the linebacker!","Run-pass option â€” QB makes the call!","Mesh point decision â€” he throws the slant!","The RPO keeps the defense honest!"]},
      {id:"quick_screen",label:"Quick Screen",icon:"ðŸ“º",desc:"Fast WR screen with blockers set â€” nearly uncoverable, low ceiling",type:"pass",
        ydsBase:[1,10],incPct:0.12,intPct:0.01,sackPct:0.02,bigPlay:0.08,
        commentary:["Quick screen!","WR screen with blockers set up in front!","Short throw, lots of green grass!","Screen pass â€” wide receivers blocking downfield!"]}
    ],
    deepPass:[
      {id:"go_route",label:"Go Route",icon:"ðŸš€",desc:"Fly pattern â€” home run ball",type:"pass",
        ydsBase:[0,55],incPct:0.50,intPct:0.06,sackPct:0.08,bigPlay:0.25,
        commentary:["GO ROUTE! Throwing deep!","Launches it downfield!","Bombs away!","9 route â€” all or nothing!"]},
      {id:"post",label:"Post Route",icon:"ðŸ“",desc:"Break toward the middle deep",type:"pass",
        ydsBase:[10,35],incPct:0.38,intPct:0.04,sackPct:0.07,bigPlay:0.18,
        commentary:["Post route â€” breaking inside!","Deep over the middle!","Cutting across â€” the post!"]},
      {id:"corner",label:"Corner Route",icon:"ðŸ“",desc:"7 route to the sideline",type:"pass",
        ydsBase:[12,30],incPct:0.40,intPct:0.03,sackPct:0.06,bigPlay:0.15,
        commentary:["Corner route to the sideline!","7 route â€” back shoulder!","Breaks to the flag!"]},
      {id:"play_action",label:"Play Action",icon:"ðŸŽ­",desc:"Fake run, deep shot",type:"pass",
        ydsBase:[5,40],incPct:0.35,intPct:0.04,sackPct:0.09,bigPlay:0.20,
        commentary:["Play action fake!","The linebackers BITE!","Beautiful fake â€” throws deep!","Play action rollout!"]},
      {id:"pa_boot",label:"Play Action Boot",icon:"ðŸ¥¾",desc:"Fake the run, QB rolls out â€” deadly if defense bites on the fake",type:"pass",
        ydsBase:[5,28],incPct:0.30,intPct:0.04,sackPct:0.08,bigPlay:0.25,
        commentary:["Play action boot!","Fake the run, QB rolls out!","The linebackers BITE on the fake!","Bootleg pass â€” rolling to his right â€” FIRES!"]}
    ],
    special:[
      {id:"hail_mary",label:"Hail Mary",icon:"ðŸ™",desc:"Last resort â€” throw it up",type:"pass",
        ydsBase:[0,70],incPct:0.75,intPct:0.12,sackPct:0.03,bigPlay:0.15,
        commentary:["HAIL MARY!","Heaves it to the end zone!","Prayer at the buzzer!"]},
      {id:"hurry_up",label:"Hurry-Up",icon:"â±ï¸",desc:"No huddle â€” save clock",type:"pass",
        ydsBase:[3,15],incPct:0.30,intPct:0.03,sackPct:0.05,bigPlay:0.08,clockSave:15,
        commentary:["Hurry-up! No huddle!","Racing to the line!","Quick snap â€” no time to waste!"]},
      {id:"kneel",label:"Victory Kneel",icon:"ðŸ§Ž",desc:"Run out the clock",type:"run",
        ydsBase:[-2,-1],bigPlay:0,fumble:0,clockBurn:40,
        commentary:["Takes a knee.","Victory formation.","Kneels it down â€” burning clock."]},
      {id:"spike",label:"Spike Ball",icon:"â¬‡ï¸",desc:"Stop clock â€” costs a down",type:"spike",
        ydsBase:[0,0],bigPlay:0,fumble:0,clockBurn:3,
        commentary:["Spikes it! Clock stops!","Quick spike to stop the clock!","Ball is spiked â€” saving time!"]}
    ],
    trick:[
      {id:"flea_flicker",label:"Flea Flicker",icon:"ðŸª°",desc:"Handoff â†’ pitch back â†’ deep bomb",type:"pass",
        ydsBase:[5,55],incPct:0.40,intPct:0.05,sackPct:0.10,bigPlay:0.30,
        commentary:["FLEA FLICKER!","Fake handoff â€” RB pitches back â€” THROWS DEEP!","The oldest trick in the book!"]},
      {id:"philly_special",label:"Philly Special",icon:"ðŸ¦…",desc:"QB lines up as receiver, TD pass from RB/TE",type:"pass",
        ydsBase:[0,25],incPct:0.45,intPct:0.06,sackPct:0.02,bigPlay:0.20,isTrick:true,
        commentary:["PHILLY SPECIAL!","Direct snap to the running back â€” THROWS TO THE QB!","YOU GOTTA BE KIDDING ME!"]},
      {id:"hb_pass",label:"HB Pass",icon:"ðŸƒ",desc:"RB takes handoff, throws downfield",type:"pass",
        ydsBase:[0,40],incPct:0.55,intPct:0.08,sackPct:0.02,bigPlay:0.18,isTrick:true,
        commentary:["HB PASS! The running back throws it!","Halfback option! He's looking downfield!","RB pulls up â€” FIRES!"]},
      {id:"fake_punt",label:"Fake Punt",icon:"ðŸŽ­",desc:"Punter runs or throws â€” huge risk",type:"pass",
        ydsBase:[0,30],incPct:0.50,intPct:0.10,sackPct:0.04,bigPlay:0.22,isTrick:true,is4thOnly:true,
        commentary:["FAKE PUNT!","They're NOT punting! Direct snap to the upback!","BOLD CALL!"]},
      {id:"fake_fg",label:"Fake FG",icon:"ðŸŽª",desc:"Holder keeps it or throws â€” FG range only",type:"pass",
        ydsBase:[0,25],incPct:0.50,intPct:0.08,sackPct:0.03,bigPlay:0.20,isTrick:true,is4thOnly:true,
        commentary:["FAKE FIELD GOAL!","The holder keeps it!","IT'S A FAKE! FIRE! FIRE!"]},
      {id:"hook_lateral",label:"Hook & Lateral",icon:"ðŸ”€",desc:"WR catches short hook then laterals to trailing teammate",type:"pass",
        ydsBase:[0,25],incPct:0.30,intPct:0.04,sackPct:0.06,bigPlay:0.32,fumble:0.08,isTrick:true,shortYdsOk:false,noHuddleOk:false,
        commentary:["Hook and lateral! The pitch is clean â€” he's got blockers!","Short catch â€” AND HE LATERALS! The trailing man has the ball!","HOOK AND LATERAL! They practiced this one all week!","Catch, pitch, AND HE'S GONE! The hook and lateral breaks the defense wide open!"]},
      {id:"end_around_pass",label:"End Around Pass",icon:"ðŸŒ€",desc:"WR takes the reverse handoff and throws back across the field",type:"pass",
        ydsBase:[-3,30],incPct:0.38,intPct:0.08,sackPct:0.10,bigPlay:0.30,fumble:0.05,isTrick:true,shortYdsOk:false,noHuddleOk:false,
        commentary:["End around â€” AND HE THROWS! The receiver is a quarterback tonight!","Reverse handoff â€” he pulls up and launches it downfield!","It's an end around pass! The defense is scrambling!","WR takes the reverse and FIRES across the field â€” what a design!"]},
      {id:"shovel_pass",label:"Shovel Pass",icon:"ðŸ¥„",desc:"QB flips an underhand shovel to the RB slipping through the line",type:"pass",
        ydsBase:[1,8],incPct:0.10,intPct:0.01,sackPct:0.04,bigPlay:0.06,fumble:0.02,isTrick:false,shortYdsOk:true,noHuddleOk:true,
        commentary:["Shovel pass! Quick flip to the back â€” he slips through!","Underhand shovel to the running back â€” picks up the first down!","QB shovels it underneath â€” the defense was looking downfield!","Quick shovel pass right through the heart of the line â€” clever call!"]}
    ]
  },
  // â”€â”€ DEFENSIVE PLAYS â”€â”€
  defense:{
    coverage:[
      {id:"cover_2",label:"Cover 2",icon:"ðŸ›¡ï¸",desc:"Two deep safeties â€” protect sidelines",
        mods:{short:2,deep:-4,rush:1,blitz:0,sackMod:0}},
      {id:"cover_3",label:"Cover 3",icon:"ðŸ”·",desc:"Three deep â€” balanced zone",
        mods:{short:0,deep:-2,rush:0,blitz:0,sackMod:0}},
      {id:"man_press",label:"Man Press",icon:"ðŸ‘¤",desc:"Press at the line â€” risky vs speed",
        mods:{short:-3,deep:4,rush:-1,blitz:0,sackMod:0.01}},
      {id:"cover_0",label:"Cover 0 Blitz",icon:"ðŸ”¥",desc:"All-out â€” zero safety help!",
        mods:{short:-5,deep:8,rush:-4,blitz:0.12,sackMod:0.08}},
      {id:"spy",label:"QB Spy",icon:"ðŸ•µï¸",desc:"LB spies the QB â€” stops scrambles",
        mods:{short:1,deep:0,rush:2,blitz:-0.02,sackMod:-0.02}},
      {id:"prevent",label:"Prevent",icon:"ðŸ°",desc:"Protect the deep ball â€” give up short",
        mods:{short:5,deep:-10,rush:3,blitz:-0.05,sackMod:-0.04}},
      {id:"tampa_2",label:"Tampa 2",icon:"ðŸ´â€â˜ ï¸",desc:"Modified Cover 2 â€” MLB drops deep to cover the seam, balanced run/pass",
        mods:{short:1,deep:-3,rush:0,blitz:0.01,sackMod:-0.01}},
      {id:"dime",label:"Dime Package",icon:"ðŸ’Ž",desc:"Six defensive backs blanket every receiver â€” maximum coverage, vulnerable against the run",
        mods:{short:-2,deep:5,rush:-8,blitz:0.08,sackMod:0.02}},
      {id:"goal_line",label:"Goal Line Defense",icon:"ðŸ°",desc:"Extra linemen and linebackers stacked in the box â€” built to stuff the run at the goal line",
        mods:{short:-5,deep:-8,rush:12,blitz:0.15,sackMod:0.05}},
      {id:"cover3_zone",label:"Cover 3 Zone",icon:"ðŸ›¡ï¸",desc:"Three-deep zone with four underneath â€” balanced and reliable across the field",
        mods:{short:1,deep:2,rush:1,blitz:0.10,sackMod:0.01}},
      {id:"bear_defense",label:"Bear Defense",icon:"ðŸ»",desc:"Overloaded front with four DL and three stacked linebackers â€” collapses the pocket and destroys the run game",
        mods:{short:-1,deep:-6,rush:10,blitz:0.22,sackMod:0.08}}
    ]
  },
  // Resolve a single play
  resolvePlay:function(offPlay,defPlay,off,def,state){
    // â”€â”€ PLAYER LOOKUPS â”€â”€
    var qb=off.roster.find(function(p){return p.pos==="QB"&&p.isStarter&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});
    var rb=off.roster.find(function(p){return p.pos==="RB"&&p.isStarter&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});
    var wr=off.roster.find(function(p){return p.pos==="WR"&&p.isStarter&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});
    var wr2=off.roster.filter(function(p){return p.pos==="WR"&&p.isStarter&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;})[1];
    var te=off.roster.find(function(p){return p.pos==="TE"&&p.isStarter&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});
    var k=off.roster.find(function(p){return p.pos==="K"&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});
    var dlD=def.roster.find(function(p){return p.pos==="DL"&&p.isStarter&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});
    var cbD=def.roster.find(function(p){return p.pos==="CB"&&p.isStarter&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});
    var lbD=def.roster.find(function(p){return p.pos==="LB"&&p.isStarter&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});
    var sD=def.roster.find(function(p){return p.pos==="S"&&p.isStarter&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});
    var ols=off.roster.filter(function(p){return p.pos==="OL"&&p.isStarter;});
    // Fallbacks when starters are injured mid-game
    if(!qb){qb=off.roster.find(function(p){return p.pos==="QB"&&!(p.injury&&p.injury.games>0)&&!p._gameInjured;});}
    if(!qb)return{type:"incomplete",yards:0,desc:"No QB available!",clock:30};
    if(!rb){rb=off.roster.find(function(p){return p.pos==="RB"&&!p._gameInjured;});}
    if(!wr){wr=off.roster.find(function(p){return p.pos==="WR"&&!p._gameInjured;});}
    if(!te){te=off.roster.find(function(p){return p.pos==="TE"&&!p._gameInjured;});}
    if(!dlD){dlD=def.roster.find(function(p){return p.pos==="DL"&&!p._gameInjured;});}
    if(!cbD){cbD=def.roster.find(function(p){return p.pos==="CB"&&!p._gameInjured;});}

    // â”€â”€ ATTRIBUTE HELPER â€” null-safe, defaults to 50 (league average) â”€â”€
    function a(p,key){return p&&p.ratings?(p.ratings[key]||50):50;}
    function olAvg(key){var s=0,c=0;ols.forEach(function(p){if(p&&p.ratings){s+=(p.ratings[key]||50);c++;}});return c?s/c:50;}

    var dm=defPlay&&defPlay.mods?defPlay.mods:{short:0,deep:0,rush:0,blitz:0,sackMod:0};

    // â”€â”€ BASE OVR EDGE (lighter weight â€” individual attributes do the real work now) â”€â”€
    var offOvr=0,offCt=0;[qb,rb,wr,wr2,te].forEach(function(p){if(p){offOvr+=p.ovr;offCt++;}});
    offOvr=offCt>0?offOvr/offCt:60;
    var defOvr=0,defCt=0;
    def.roster.filter(function(p){return["DL","LB","CB","S"].indexOf(p.pos)>=0&&p.isStarter;}).forEach(function(p){defOvr+=p.ovr;defCt++;});
    defOvr=defCt>0?defOvr/defCt:60;
    var edge=(offOvr-defOvr)*0.08;// reduced â€” attributes now carry the story

    // â”€â”€ SITUATIONAL MODIFIERS â”€â”€
    if(state.homeField){edge+=state.homeField;}
    var isClutch=state.isClutch||false;
    if(isClutch){
      var clutchBoost=0;
      if(qb.traits){qb.traits.forEach(function(tr){if(tr.id==="clutch"||tr.id==="ice_veins")clutchBoost+=2;if(tr.id==="choker")clutchBoost-=2;});}
      edge+=clutchBoost;
    }
    if(state.crowdMod){edge+=state.crowdMod;}
    if(state.halfAdjMod991){edge+=state.halfAdjMod991;}

    var commentary=offPlay.commentary?offPlay.commentary[Math.floor(RNG.play()*offPlay.commentary.length)]:"";
    var clockUse=offPlay.clockBurn||offPlay.clockSave||(offPlay.type==="run"?28+Math.floor(RNG.play()*15):22+Math.floor(RNG.play()*18));

    // â”€â”€ SPIKE â”€â”€
    if(offPlay.type==="spike"){
      return{type:"spike",yards:0,desc:(qb?qb.name:"QB")+" spikes the football! Clock stops!",
        player:qb?qb.name:"QB",clock:3,commentary:commentary,isSpike:true};
    }

    // â”€â”€ RUN PLAYS â”€â”€
    if(offPlay.type==="run"){
      // â”€â”€ RUN ATTRIBUTES â”€â”€
      var rbSpd=a(rb,"speed"),rbElus=a(rb,"elusiveness"),rbVis=a(rb,"ballCarrierVision");
      var rbPow=a(rb,"power"),rbAcc=a(rb,"acceleration"),rbTruck=a(rb,"truckPower"),rbBT=a(rb,"breakTackle");
      var olRunBlk=olAvg("runBlock");
      var dlShed=a(dlD,"blockShedding"),dlPursuit=a(dlD,"pursuit");
      var lbStop=a(lbD,"runStop")||a(lbD,"tackle")||50;

      // Line battle: OL run block vs DL block shedding
      var runLineEdge=(olRunBlk-dlShed)*0.04;
      // Open field: RB speed + elusiveness + vision
      var rbOpenEdge=(rbSpd-50)*0.02+(rbElus-50)*0.02+(rbVis-50)*0.01;
      var runEdge=edge+runLineEdge+rbOpenEdge;

      // Matchup panel (now shows actual attributes)
      var matchups=[];
      matchups.push({off:"OL (blk:"+Math.round(olRunBlk)+")",
        def:(dlD?dlD.name.split(" ").pop():"DL")+" (shed:"+Math.round(dlShed)+")",
        winner:olRunBlk>dlShed+5?"off":dlShed>olRunBlk+5?"def":"push",
        desc:olRunBlk>dlShed+5?"O-line mauls the front â€” hole opens up":dlShed>olRunBlk+5?"DL blows up the blocking assignment!":"Even battle at the line of scrimmage"});
      if(rb){var rbVsLb=(rbSpd+rbElus)/2-lbStop;
        matchups.push({off:rb.name.split(" ").pop()+" (spd:"+Math.round(rbSpd)+" elu:"+Math.round(rbElus)+")",
          def:"LB corps (stop:"+Math.round(lbStop)+")",
          winner:rbVsLb>5?"off":rbVsLb<-5?"def":"push",
          desc:rbVsLb>5?"He outruns the pursuit â€” daylight!":rbVsLb<-5?"Linebackers swarm â€” no room":"Closing angles on the ball carrier"});}

      // Fumble: vision + awareness reduce risk
      var fumChance=(offPlay.fumble||0.02)-(rbVis-50)*0.0002-(a(rb,"awareness")-50)*0.0002;
      fumChance=Math.max(0.005,Math.min(0.08,fumChance));
      if(RNG.play()<fumChance){
        var fumRunner=offPlay.id==="qb_sneak"?qb:rb;
        return{type:"fumble",yards:Math.floor(RNG.play()*5),
          desc:(fumRunner?fumRunner.name:"RB")+" FUMBLES! Ball is loose â€” defense recovers!",
          player:fumRunner?fumRunner.name:"RB",clock:clockUse,commentary:commentary,turnover:true,matchups:matchups};}

      // Big play: speed + acceleration + elusiveness, suppressed by DL pursuit
      var bigChance=(offPlay.bigPlay||0.06)+(rbSpd-50)*0.0008+(rbAcc-50)*0.0006+(rbElus-50)*0.0006-(dlPursuit-50)*0.0005+runEdge*0.005-(dm.rush||0)*0.005;
      bigChance=Math.max(0.01,Math.min(0.28,bigChance));
      if(RNG.play()<bigChance){
        var bigYds=15+Math.floor(RNG.play()*35);
        var bigRunner=offPlay.id==="qb_sneak"?qb:rb;
        var bigDesc=rbSpd>=82?"JETS! "+(bigRunner?bigRunner.name:"RB")+" turns on the afterburners â€” "+bigYds+" yards!":
          rbPow>=80?"TRUCKS HIM! "+(bigRunner?bigRunner.name:"RB")+" runs through the tackle for "+bigYds+"!":
          "BREAKAWAY! "+(bigRunner?bigRunner.name:"RB")+" breaks free for "+bigYds+" yards!";
        return{type:"run",yards:bigYds,desc:bigDesc,player:bigRunner?bigRunner.name:"RB",
          clock:clockUse,commentary:commentary,big:true,isRush:true,matchups:matchups};}

      // Base yards â€” attribute-driven
      var base=offPlay.ydsBase;
      var runYds=base[0]+Math.floor(RNG.play()*(base[1]-base[0]+1))+Math.round(runEdge*0.3)-(dm.rush||0)*0.3;
      // Elite vision finds the crease when the hole is small
      if(rbVis>=80&&runYds<3&&RNG.play()<0.30){runYds+=Math.floor(RNG.play()*4);}
      // Break tackle on contact â€” truckers and wiggle backs
      if(runYds>0&&runYds<=5&&rbBT>=72&&RNG.play()<(rbBT-65)*0.008){runYds+=2+Math.floor(RNG.play()*3);}
      // Power back pushes the pile on short gains
      if(rbPow>=78&&runYds>0&&(dm.rush||0)<4){runYds+=Math.floor((rbPow-72)*0.04);}
      runYds=Math.max(-5,Math.round(runYds));

      var runner=offPlay.id==="qb_sneak"?qb:rb;
      var runDesc=(runner?runner.name:"RB")+(runYds>0?" gains "+runYds+(runYds===1?" yard":" yards"):" stuffed for "+(runYds===0?"no gain":"a loss of "+Math.abs(runYds)));
      return{type:"run",yards:runYds,desc:runDesc,player:runner?runner.name:"RB",clock:clockUse,commentary:commentary,isRush:true,matchups:matchups};
    }

    // â”€â”€ PASS PLAYS (including trick plays) â”€â”€
    // â”€â”€ PASS ATTRIBUTES â”€â”€
    var qbAcc=a(qb,"accuracy"),qbAware=a(qb,"awareness"),qbDecision=a(qb,"decisionSpeed");
    var qbDeepAcc=a(qb,"deepAccuracy")||qbAcc,qbShortAcc=a(qb,"shortAccuracy")||qbAcc;
    var qbPocket=a(qb,"pocketPresence"),qbTough=a(qb,"toughness");

    var wrSep=a(wr,"separation"),wrSpeed=a(wr,"speed"),wrSpec=a(wr,"spectacularCatch"),wrCIT=a(wr,"catchInTraffic");
    var wrDeepRt=a(wr,"deepRoute"),wrShortRt=a(wr,"shortRoute");

    var cbCov=a(cbD,"coverage")||a(cbD,"manCoverage")||a(cbD,"zoneCoverage")||(cbD?cbD.ovr:65);
    var cbBOB=a(cbD,"breakOnBall");
    var sCov=a(sD,"coverage")||a(sD,"zoneCoverage")||(sD?sD.ovr:65);
    var sRange=a(sD,"rangeAbility");

    var olPassBlk=olAvg("passBlock")||olAvg("passBlockFinesse")||50;
    var olAnchor=olAvg("anchorStrength"),olFinesse=olAvg("passBlockFinesse");
    var dlRush=a(dlD,"passRush")||a(dlD,"powerMoves")||(dlD?dlD.ovr:65);
    var dlPowMov=a(dlD,"powerMoves"),dlFinMov=a(dlD,"finesseMoves");

    var isDeep=offPlay.id==="go_route"||offPlay.id==="post"||offPlay.id==="corner"||offPlay.id==="play_action"||offPlay.id==="hail_mary"||offPlay.id==="flea_flicker"||offPlay.id==="pa_boot";
    var isTEPlay=offPlay.id==="te_drag"||offPlay.id==="te_seam";

    // QB effective accuracy scales to route depth
    var effectiveQbAcc=isDeep?(qbDeepAcc*0.7+qbAcc*0.3):(qbShortAcc*0.7+qbAcc*0.3);
    var wrRouteEff=isDeep?wrDeepRt:wrShortRt;

    // Pass edge: accuracy vs coverage, separation vs DB, route skill
    var passEdge=edge+(effectiveQbAcc-50)*0.015+(wrSep-50)*0.012-(cbCov-50)*0.012+(wrRouteEff-50)*0.010;

    // Matchup panel (attribute-driven)
    var matchups=[];
    if(wr&&cbD){var sepVsCov=wrSep-cbCov;
      matchups.push({off:wr.name.split(" ").pop()+" (sep:"+Math.round(wrSep)+")",
        def:cbD.name.split(" ").pop()+" (cov:"+Math.round(cbCov)+")",
        winner:sepVsCov>5?"off":sepVsCov<-5?"def":"push",
        desc:sepVsCov>5?"WR creates separation â€” he's open!":sepVsCov<-5?"CB has him locked down â€” no daylight":"Tight man coverage â€” going to be contested"});}
    if(qb&&dlD){var pktBattle=olPassBlk-dlRush;
      matchups.push({off:qb.name.split(" ").pop()+" (pkt:"+Math.round(qbPocket)+")",
        def:dlD.name.split(" ").pop()+" (rush:"+Math.round(dlRush)+")",
        winner:pktBattle>5?"off":pktBattle<-5?"def":"push",
        desc:pktBattle>5?"Clean pocket â€” all day to throw":pktBattle<-5?"Pass rush collapsing the pocket":"QB feeling pressure in the pocket"});}
    if(te&&sD){var teSep2=a(te,"separation");var teVsS=teSep2-sCov;
      matchups.push({off:te.name.split(" ").pop()+" (sep:"+Math.round(teSep2)+")",
        def:sD.name.split(" ").pop()+" (cov:"+Math.round(sCov)+")",
        winner:teVsS>5?"off":teVsS<-5?"def":"push",
        desc:teVsS>5?"TE has the size and leverage over the safety":teVsS<-5?"Safety blankets the middle â€” no seam":"Contested matchup in the intermediate zone"});}

    // QB Scramble: speed + elusiveness drive upside
    var scrambleChance=0.07+(a(qb,"speed")-50)*0.002+(a(qb,"elusiveness")-50)*0.001;
    if(defPlay&&defPlay.id==="spy")scrambleChance*=0.2;
    if(dm.blitz>0)scrambleChance+=0.04;
    if(!offPlay.isTrick&&offPlay.id!=="hail_mary"&&offPlay.id!=="hurry_up"&&RNG.play()<scrambleChance){
      var scramYds=Math.floor(RNG.play()*15)-2+Math.round(passEdge*0.2);
      scramYds=Math.max(-3,scramYds);
      var scramBig=scramYds>12;
      var scramDesc=scramYds>0?(qb.name+" scrambles for "+scramYds+" yards!"+(scramBig?" WHAT A RUN!":"")):(qb.name+" tries to scramble â€” brought down for "+(scramYds===0?"no gain":"a loss of "+Math.abs(scramYds))+"!");
      if(scramBig)scramDesc=qb.name+" takes off! Scrambles "+scramYds+" yards!";
      return{type:"run",yards:scramYds,desc:scramDesc,player:qb.name,clock:clockUse,
        commentary:"QB flushes from the pocket!",big:scramBig,isRush:true,isScramble:true,matchups:matchups};}

    // SACK: OL passBlock + anchorStrength vs DL powerMoves + finesseMoves + QB pocket presence
    var sackPct=(offPlay.sackPct||0.05)+(dm.sackMod||0)+(dm.blitz||0);
    sackPct-=(olPassBlk-dlRush)*0.0004;     // OL protection dominates DL rush = fewer sacks
    sackPct-=(olAnchor-dlPowMov)*0.0002;    // anchor strength holds against bull rush
    sackPct-=(olFinesse-dlFinMov)*0.0002;   // finesse technique counters speed rush
    sackPct-=(qbPocket-50)*0.0004;          // pocket presence buys extra time
    sackPct-=edge*0.003;
    sackPct=Math.max(0.02,Math.min(0.20,sackPct));
    if(RNG.play()<sackPct){
      var sackLoss=-(4+Math.floor(RNG.play()*8));
      return{type:"sack",yards:sackLoss,
        desc:(dlD?dlD.name:"DL")+" SACKS "+(qb?qb.name:"QB")+" for a loss of "+Math.abs(sackLoss)+"!",
        player:dlD?dlD.name:"DL",clock:clockUse,commentary:commentary,matchups:matchups};}

    // INT: QB accuracy + awareness + decisionSpeed vs CB breakOnBall
    var intPct=(offPlay.intPct||0.03);
    intPct-=(qbAcc-60)*0.0008;             // accurate QB avoids bad throws
    intPct-=(qbAware-60)*0.0006;           // awareness = sees coverage pre-snap
    intPct-=(qbDecision-50)*0.00035;       // quick decision = ball out before coverage closes
    intPct+=(cbBOB-50)*0.0003;             // ball-hawk CB jumps routes
    if(isDeep)intPct+=(dm.deep||0)*0.003;else intPct+=(dm.short||0)*0.002;
    if(offPlay.isTrick)intPct+=0.02;
    intPct-=passEdge*0.003;
    intPct=Math.max(0.01,Math.min(0.18,intPct));
    if(RNG.play()<intPct){
      var intDesc=offPlay.isTrick?(offPlay.label+" â€” INTERCEPTED! The trick play backfires!"):
        ((qb?qb.name:"QB")+" INTERCEPTED by "+(cbD?cbD.name:"DB")+"!"+(isDeep?" Deep ball picked off!":""));
      return{type:"interception",yards:0,desc:intDesc,
        player:cbD?cbD.name:"DB",clock:clockUse,commentary:commentary,turnover:true,matchups:matchups};}

    // INCOMPLETE: QB accuracy (depth-specific) + WR route skill vs CB coverage
    var incPct=(offPlay.incPct||0.25);
    incPct-=(effectiveQbAcc-50)*0.004;     // accurate QB completes more
    incPct-=(wrRouteEff-50)*0.003;         // clean routes get separation
    incPct+=(cbCov-50)*0.003;              // lockdown CB forces incompletions
    if(isDeep)incPct+=(dm.deep||0)*0.02;else incPct+=(dm.short||0)*0.015;
    incPct-=passEdge*0.005;
    // Spectacular catch saves tight-window throws
    if(wrSpec>=78&&RNG.play()<0.12){incPct-=0.06;}
    // Catch in traffic helps TE/slot routes over the middle
    if(isTEPlay&&wrCIT>=75){incPct-=0.04;}
    incPct=Math.max(0.10,Math.min(0.75,incPct));
    if(RNG.play()<incPct){
      var incTargets=[wr,wr2,te,rb].filter(function(x){return!!x;});
      var incT=incTargets[Math.floor(RNG.play()*incTargets.length)];
      var incDescs=offPlay.isTrick?
        [offPlay.label+" â€” pass falls incomplete! The gamble doesn't pay off.",offPlay.label+" â€” thrown away! Coverage was there."]:
        ["Pass incomplete â€” "+(incT?incT.name:"WR")+" can't haul it in",
        "Thrown away â€” nobody open","Dropped! "+(incT?incT.name:"WR")+" had it but couldn't hold on",
        "Pass falls incomplete â€” good coverage by the defense",
        "Batted at the line! Pass deflected!","Overthrown! "+(qb?qb.name:"QB")+" puts too much on it"];
      return{type:"incomplete",yards:0,desc:incDescs[Math.floor(RNG.play()*incDescs.length)],
        player:incT?incT.name:"WR",clock:clockUse<25?clockUse:8,commentary:commentary,matchups:matchups};}

    // COMPLETION â€” big play check driven by WR speed + separation vs CB coverage + safety range
    var bigChance2=(offPlay.bigPlay||0.05)+(wrSpeed-50)*0.0008+(wrSep-50)*0.0006-(cbCov-50)*0.0006-(sRange-50)*0.0005;
    if(isDeep){bigChance2+=(wrDeepRt-50)*0.0005;}
    bigChance2+=passEdge*0.005;
    bigChance2=Math.max(0.02,Math.min(0.35,bigChance2));
    var isBig=RNG.play()<bigChance2;
    var base2=offPlay.ydsBase;
    var passYds;
    if(isBig){
      passYds=base2[1]+5+Math.floor(RNG.play()*20);
      // Elite speed turns big plays into jaw-droppers
      if(wrSpeed>=85){passYds+=Math.floor((wrSpeed-80)*0.5);}
    }else{passYds=base2[0]+Math.floor(RNG.play()*(base2[1]-base2[0]+1))+Math.round(passEdge*0.3);}
    if(isDeep)passYds-=Math.round((dm.deep||0)*0.5);else passYds-=Math.round((dm.short||0)*0.4);
    passYds=Math.max(1,Math.round(passYds));
    var targets=[wr,wr2,te,rb].filter(function(x){return!!x;});
    var catcher=isDeep?(wr||targets[0]):(targets[Math.floor(RNG.play()*targets.length)]||wr);
    var passDesc;
    if(offPlay.isTrick){
      passDesc=offPlay.label+"! Complete for "+passYds+" yards!"+(isBig?" IT WORKED BEAUTIFULLY!":"");
    }else{
      passDesc="Complete to "+(catcher?catcher.name:"WR")+" for "+passYds+(passYds===1?" yard":" yards")+"!";
      if(isBig)passDesc="BIG PLAY! "+(qb?qb.name:"QB")+" connects with "+(catcher?catcher.name:"WR")+" for "+passYds+" yards!";
    }
    return{type:"complete",yards:passYds,desc:passDesc,player:catcher?catcher.name:"WR",
      passer:qb?qb.name:"QB",clock:clockUse,commentary:commentary,big:isBig,matchups:matchups};
  }
};

// â”€â”€ BROADCAST VOICES v99.1 â€” Named commentators for key moments â”€â”€

// â”€â”€ BROADCAST_COMMENTARY_EXPANDED v99.2 (Gemini) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Extended commentary arrays â€” merged into BROADCAST_COMMENTARY on init
var BROADCAST_COMMENTARY_EXPANDED={
  drives:{
    TD:["What a sequence of plays â€” the offense clicked on all cylinders and found the end zone!",
        "They marched right down the field with poise and precision. Textbook scoring drive.",
        "That's six! The offensive line opened a highway and the skill players did the rest.",
        "Can't stop what you can't predict â€” the playcalling tonight has been absolutely masterful.",
        "TOUCHDOWN! They made it look effortless and it was anything but.",
        "The drive of the season. Every call, every execution, perfectly synchronized.",
        "They punished the defense for every mistake. That's how champions score.",
        "End zone celebration is well-deserved. That was a clinic in offensive football.",
        "Seven plays, sixty-three yards, zero wasted snaps. The offense is cooking.",
        "The signal caller reads the defense like a book and the offense follows his lead.",
        "Physical, violent, relentless â€” they ran it right at them and dared them to stop it.",
        "An 8-play drive that took four minutes off the clock and put six on the board. Beautiful.",
        "Short passes, intermediate routes, then the go route â€” textbook three-level attack.",
        "They took what the defense gave them on every play. That's trust in the system.",
        "Capping it off with a score! The drive started in their own territory and ended in paydirt.",
        "The defense had answers for everything â€” except the last play. That's all you need.",
        "They went no-huddle late in the drive and the defense was completely overwhelmed.",
        "Red zone efficiency on full display. No settling for field goals tonight.",
        "What a moment for the offense! The crowd erupts as they punch it in.",
        "From the opening snap of the drive, you could feel momentum building. TOUCHDOWN!"],
    TO:["The pocket collapses â€” the ball is out! The defense comes up huge when it matters most.",
        "INTERCEPTION! The quarterback stared down his receiver and the cornerback was waiting.",
        "Fumble! The ball is loose and the defense has it â€” momentum COMPLETELY shifts!",
        "A catastrophic error at the worst possible time. The offense will need to answer.",
        "The defensive back read that route from the start. PICKED OFF! Beautiful technique.",
        "Stripped! The linebacker punches it free and the defense pounces! Unbelievable effort.",
        "That's the play that changes the game. Turnover, other team's ball, crowd on its feet.",
        "The defense needed a momentum swing and they created their own. What a play!",
        "Picked off in the red zone! The defense saves four points with that takeaway.",
        "The quarterback forced it into double coverage â€” and paid the price. INTERCEPTED!",
        "Fumble at the goal line! The defense rips the ball out in the most critical moment.",
        "The defensive lineman got his hands on it â€” batted up, picked off, TURNOVER!",
        "Tipped at the line of scrimmage, floats up in the air... picked off! Disaster!",
        "Screen pass jumped by the linebacker â€” he read the offensive line perfectly. INTERCEPTION!",
        "The ball hits the turf â€” FUMBLE! Both teams scrambling and the defense comes up with it.",
        "Under pressure, the quarterback throws into traffic and lives to regret it.",
        "The crowd senses it before it happens â€” the pass is up for grabs and INTERCEPTED!",
        "The defense created that turnover with nothing but relentless effort and preparation.",
        "That's the fifth turnover in the last two weeks. Protecting the football is a crisis.",
        "They gave the defense the ball and a short field. This game just got complicated."],
    FG:["The kicker splits the uprights â€” three points and a sigh of relief.",
        "Long distance, perfect form, dead center. The kicker continues to be automatic.",
        "They couldn't punch it in but they didn't waste the drive. Three points on the board.",
        "A 52-yard attempt and the kicker drills it. What a leg on that young man.",
        "It has the distance... and the accuracy. GOOD! The kicker is money tonight.",
        "Three points instead of seven â€” the defense bends but doesn't break. A moral win.",
        "End over end, splitting the uprights with ease. This kicker is having a season.",
        "The hold is clean, the snap is perfect, and the kick... GOOD! Three more points.",
        "In a close game, field goals are touchdowns. Three points could be the margin.",
        "The kicker converts from 47 yards like it's an extra point. Automatic.",
        "Pressure kick in a tight game and the kicker is ice cold. Right down the middle.",
        "They had a 4th-and-short option. They went with the kicker. Smart football.",
        "The offense stalled but the field goal unit kept the momentum. Three points matter.",
        "From deep in the parking lot, the kicker makes it look routine. What a professional.",
        "The wind is howling but the kicker accounts for it perfectly. GOOD!",
        "Special teams are keeping this team in the game. Another successful field goal.",
        "An efficient drive capped by a reliable kicker. This team knows how to get points.",
        "They methodically moved into field goal range and finished the job. Three.",
        "The snap, the hold, the kick â€” all perfect. The special teams excellence continues.",
        "Two field goals today for the kicker â€” both from distance. Difference maker."],
    PUNT:["The defense digs in and forces a three-and-out. Exactly what they needed.",
          "The offense couldn't sustain the drive. The punt team takes the field.",
          "Defensive front completely controlled the line of scrimmage. Forced punt.",
          "A drive that never found its footing ends in a punt. The defense wins this one.",
          "The punt pins them inside their own ten yard line. Field position is a weapon.",
          "They go three-and-out for the second consecutive possession. The offense needs answers.",
          "The defense reads every play. Complete shutdown â€” the punt team trots out.",
          "A monster punt flips the field. The coverage team does its job.",
          "Three plays, five yards, punt. The defense is absolutely suffocating today.",
          "The third consecutive three-and-out. There's something deeply wrong with the offense.",
          "The defense held and now gets the ball back with excellent field position.",
          "Punting on 4th and short from midfield â€” a conservative choice that may come back to bite.",
          "The defense wins another down. The punt team takes over.",
          "They couldn't get into a rhythm on that possession. Punt.",
          "The crowd goes quiet as the punt team takes the field. The offense is struggling.",
          "A well-placed punt gives the defense a short field and a chance to extend the lead.",
          "The offense answers the defense's big stop with a three-and-out of their own.",
          "Three downs, two yards gained. The punt team accepts the assignment.",
          "The defensive scheme adjustments are clearly working. Forced another punt.",
          "The drive sputters on 3rd down â€” incomplete â€” and out comes the punt team."],
    SAFETY:["SAFETY! Two points the hard way â€” the defense records one of football's rarest plays!",
            "They tackled the quarterback in his own end zone! SAFETY! How do you even prepare for this?!",
            "A bad snap, a bobbled hold, a desperate quarterback â€” SAFETY! The crowd goes absolutely berserk!",
            "Two points and the ball! The safety is a game-changer in the most dramatic fashion!",
            "The defense pins the quarterback against the back wall and â€” SAFETY! What a moment!",
            "From a punting situation, the punter is swarmed and dropped in the end zone! SAFETY!",
            "The defense called timeout one play ago â€” and then records a SAFETY! Brilliant adjustment!",
            "Two points from the defense! It's not just the score â€” it's the momentum! SAFETY!",
            "The blocked punt stays in the end zone â€” the defense falls on it! SAFETY! Stunning!",
            "You score points on BOTH sides of the ball â€” the safety gives the defense two points!",
            "A holding penalty in the end zone converts to an automatic safety. How costly!",
            "Nobody scores from the safety formation â€” except the defense, apparently. TWO POINTS!",
            "The center snap goes sailing â€” the quarterback chases it into the end zone â€” SAFETY!",
            "The defense forces a fumble in the back of the end zone and covers it â€” SAFETY!",
            "Not since the last time has a safety been this perfectly executed. TEXT BOOK!",
            "The defensive lineman was unblockable â€” and the proof is a safety on the scoreboard.",
            "They blitz from every direction â€” the quarterback is engulfed in the end zone! SAFETY!",
            "The most dramatic two points in football. SAFETY! The stadium is absolutely losing its mind!",
            "A rare safety changes the entire game â€” the defense now gets the ball and momentum.",
            "Two points! They're so rare and so crushing â€” the SAFETY swings the game right now!"]
  },
  momentum:{
    takeLead:["They've seized control of this contest! The lead has changed hands!",
              "Against all odds, they have done it â€” they have taken the lead!",
              "The turnaround is complete. They are ahead. The crowd cannot believe it.",
              "Incredible resilience. Down and out thirty minutes ago â€” now they lead.",
              "The momentum in this building has shifted so dramatically you can feel it.",
              "From playing not to lose to playing to win â€” the lead changes everything.",
              "They outscored their opponent across the last two drives. Now they're ahead.",
              "The script has been flipped. They have the lead and they intend to keep it.",
              "An enormous play gives them the lead. Now they need to finish.",
              "This team has found something. They've taken the lead and the energy is palpable.",
              "Championship-caliber focus produces a championship-level result. They lead!",
              "The comeback is complete. The lead is real. The crowd is electrified.",
              "They said the game was over. Somebody forgot to tell this team.",
              "Momentum looked gone â€” then they took it back. Now they have the lead too.",
              "From the brink of defeat to the edge of victory. They. Have. The. Lead.",
              "The offense exploded when it mattered most. They're in front.",
              "Defense set it up, offense finished it. They have the lead for the first time.",
              "Character. Grit. Execution. They took the lead when others would have quit.",
              "The scoreboard tells the only story that matters right now: they are ahead.",
              "They needed to make plays. They made plays. They took the lead."],
    extendLead:["They're running away with it now â€” a significant cushion building.",
                "The advantage grows. The opponent must respond or this game will escape them.",
                "Every score stretches the deficit. Time is becoming the ultimate opponent.",
                "They're not letting up. The lead extends and the pressure is relentless.",
                "The gap widens. A comfortable lead becoming a potentially decisive one.",
                "They are playing complete football. The lead is a direct result of it.",
                "Two scores. Three scores. The margin isn't just comfortable â€” it's commanding.",
                "They've answered every question tonight and the scoreboard reflects it.",
                "The offensive rhythm is perfect and the defense is suffocating. Lead extending.",
                "Control. Patience. Execution. The lead grows because they demand it.",
                "The blowout potential is real. They are playing their best football.",
                "They've locked in and the other team can't find the answer. EXTENDING.",
                "A dominating stretch of play extends the lead to what could be a final margin.",
                "They can taste victory. The lead tells you everything you need to know.",
                "The opponent is starting to feel the weight of the deficit. It shows.",
                "They've been relentless all night and the scoreboard is the reward.",
                "The challenge now is to close it out. The lead is real and needs protecting.",
                "Every possession is worth its weight in points tonight. Extending the lead.",
                "The lead extension sends a message: we are not going to give this back.",
                "They have done everything right. The extended lead is just and deserved."],
    comeback:["They're within striking distance! This game is FAR from over!",
              "The deficit is shrinking. The momentum is shifting. Can they complete it?",
              "One score game. Suddenly the team that was down is very much alive.",
              "They've closed the gap. The crowd senses a comeback is possible.",
              "One possession. That's all that separates these teams right now.",
              "The momentum has flipped â€” the team that was sleepwalking is now ALIVE!",
              "They're coming back. You can feel it. One score game with time on the clock.",
              "The comeback is on! From ten down to within reach â€” don't count them out!",
              "Heart. The team shows heart when it would be easy to fold. They're in it!",
              "This crowd went from silent to electric â€” one score game, all to play for.",
              "The defense stepped up and the offense cashed in. They're back in this!",
              "Within one possession. The game within a game has just reset itself.",
              "You never count out a team with this kind of heart. They're RIGHT there.",
              "One play can define a game. One play made this a one-score game. ALIVE!",
              "The opponent just lost their cushion. Now they have to protect a single score.",
              "From out of it to right back in it â€” the comeback is officially alive.",
              "They refused to go quietly. Down one score, plenty of time. Let's GO.",
              "The opponent scored twice. This team answered twice. NOW we have a game.",
              "Six points. That's the difference. That's one score. That's everything.",
              "The comeback is within reach. Will they finish what they started?"]
  },
  clutch:{
    twoMinute:["Inside the two-minute warning now â€” every snap is a playoff game.",
               "The clock is the opponent now. Every second is precious.",
               "Two-minute drill: compressed, urgent, pressure-filled. Let's see what they're made of.",
               "This is where championship DNA shows itself. Two minutes to change destiny.",
               "The no-huddle is in full effect. They need to manage every second perfectly.",
               "Heart rate elevated. Stakes maximum. The two-minute drill begins NOW.",
               "The clock ticks down. The stakes tick up. This is football in its purest form.",
               "Under two minutes and trailing â€” this is the moment you play your whole career for.",
               "Clock management becomes an art form in these final moments. Every second counts.",
               "The quarterback must be surgical. No wasted plays. No wasted seconds.",
               "Two-minute warning: the natural break before the most intense stretch of the game.",
               "This offense needs to travel 65 yards in under two minutes. It's been done before.",
               "The defense knows what's coming. The offense knows the defense knows. Let's go.",
               "Crunch time doesn't get crunchier than this. Two minutes, one score needed.",
               "First and ten from their own 25 with 1:47 left. The game within a game begins.",
               "Everyone in the building knows what has to happen. The question is: can they execute?",
               "Time outs, clock management, fourth-down decisions â€” this is chess at 200 miles per hour.",
               "The quarterback's eyes calm while everyone else's racing. That's what makes him elite.",
               "Inside two minutes and everything is on the line. Football at its most beautiful.",
               "The last two minutes of a close game are why they invented this sport."],
    goalLine:["They're at the one-yard line. This is not finesse football. This is will.",
              "Five yards or less. The goal line stand or the goal line score. One side wins.",
              "The crowd is standing. This is why they call it a goal line stand â€” it's a war.",
              "GOAL LINE. Short yardage. Physical football. Whoever wants it more gets it.",
              "Both lines are ready. Every inch of real estate is contested ground.",
              "Goal to go. The offense needs inches. The defense needs a wall. Let's see it.",
              "This is where the five-yard penalty on 1st and goal becomes the five-yard drive.",
              "The goal line makes legends. We're about to find out who wants it more.",
              "Two yards. Could be two thousand yards with this defense digging in.",
              "The moment of truth. The goal line doesn't care about your stats.",
              "Goal line stand â€” the defense holds and the crowd erupts! What a stop!",
              "Short yardage is decided in the trenches. Right now, this is everything.",
              "They didn't come this far to settle. Goal to go â€” they want SIX.",
              "The center is over the ball. The defense is in a stance. TIME TO DECIDE.",
              "Power versus power at the goal line. This is why football is beautiful.",
              "The goal line is only six inches away. It might as well be six miles.",
              "Compact, physical, violent â€” goal line football is the sport distilled.",
              "One yard. The defense has held for three downs. Fourth down coming.",
              "It's not where you start â€” it's whether you can finish it at the goal line.",
              "GOAL LINE STAND! The defense comes through at the most critical moment!"],
    redZone:["Inside the twenty! Red zone opportunities define seasons. Make it count.",
             "They've worked so hard to get here â€” don't leave empty-handed in the red zone.",
             "Red zone offense is a completely different game. Spacing is gone. Windows are tight.",
             "In the red zone, every down is precious and every play call is scrutinized.",
             "They've entered the red zone with energy and purpose. Convert or go home.",
             "The defense tightens when the field shrinks. This is where touchdowns are earned.",
             "Twenty yards of field and everything is compressed. Red zone football is fascinating.",
             "Three opportunities in the red zone. They need points on every one of them.",
             "The touchdown-to-field-goal conversion rate in the red zone separates good teams from great ones.",
             "They've crossed the 20 â€” now finish. The red zone demands execution.",
             "The defense called their best coverage. The offense needs to counter.",
             "Passing windows shrink in the red zone. Route combinations become critical.",
             "Red zone efficiency: the statistic that predicts championships. Execute here.",
             "The end zone is twenty yards away and the defense is gambling on every snap.",
             "Creative playcalling in the red zone separates offensive coordinators.",
             "The field compresses, the pressure amplifies, and the crowd holds its breath.",
             "They got to the red zone with brilliant play calling. Now finish the job.",
             "Tight coverage. Compressed space. High stakes. Welcome to the red zone.",
             "The defense is playing their best football precisely because they're inside the twenty.",
             "Red zone stop â€” the defense comes up enormous in the most important area of the field!"]
  },
  weather:{
    wind:["The wind is howling today. Forget about the deep ball â€” this is a ground-and-pound afternoon.",
          "Flags are horizontal. Field goal range just became a concept, not a given.",
          "The wind gusts hit 25 miles per hour on that drive. You can see it affecting trajectory.",
          "A passing game becomes a liability in these conditions. The run game is the answer.",
          "The kicker steps back and recalculates. The wind is a factor on every kick.",
          "Windy conditions favor the defense. Passing windows are literal and figurative today.",
          "They're adapting the gameplan to the elements. Short, quick routes. Nothing downfield.",
          "The ball is moving in the air â€” you can see the wind pushing it off course.",
          "Quarterbacks hate playing in the wind. They're making due today with short routes.",
          "The wind chill makes the ball feel like a brick. Both passing games are compromised.",
          "Crosswind from the northwest â€” the kicker will need to adjust both attempts.",
          "Both teams are adjusting game plans on the fly. The wind is a free defensive coordinator.",
          "Play-action loses its effectiveness when everybody knows you're not throwing deep.",
          "The deep ball is essentially off the menu in these conditions. Adapt or suffer.",
          "Football is a game of adjustments â€” the team that adjusts fastest to the wind wins.",
          "The wind was a factor on the last play and will continue to be all afternoon.",
          "They're leaning on the run game for a reason â€” wind-aided games favor the trenches.",
          "A 40-yard field goal into the wind is a 55-yard field goal in calm air.",
          "The offense is smart enough to know that today is not a day to test the elements.",
          "Gusty conditions add a random element â€” even good throws can be pushed off target."],
    cold:["This is cold-weather football at its most unforgiving. The ball is slippery, the hands are numb.",
          "Breath clouds rising from every player. The temperature is in the single digits.",
          "The receivers are wearing hand warmers and they still can't feel their fingers.",
          "Cold-weather football favors the defense. The elements are working against the passing game.",
          "The field is frozen solid. Footing is an issue on every cut and every tackle.",
          "This is a November road environment that separates playoff teams from pretenders.",
          "The ball goes in the heated sideline bag between every drive. That bad.",
          "You can see the frost on the field. The footing is treacherous for skill players.",
          "This is the kind of cold that tests character. Who wants to play in these conditions?",
          "Cold weather running games win in January. They're establishing the run for a reason.",
          "Every drop and every fumble tonight can be partially attributed to the temperature.",
          "Both teams are wearing the extra underlayers. Speed is compromised in this cold.",
          "Frozen tundra conditions â€” the home team has the advantage of knowing these elements.",
          "The cold affects the mental game too. Concentration breaks faster when you're freezing.",
          "Warm hands, hot blood, frozen field â€” the team that blocks better will win this one.",
          "Single-digit temperatures and a packed stadium â€” this is football the way it was meant to be.",
          "The visiting team came from a warm-weather climate and you can see the adjustment happening.",
          "Cold weather is when the big offensive lines earn their contracts. Run the football.",
          "You talk about cold weather warriors â€” tonight we find out who they are.",
          "The heaters are on the sidelines and everybody wishes they were on the field."],
    rain:["The rain is coming down and the ball is a wet bar of soap out there.",
          "Wet conditions and everybody knows it â€” run the football, protect the ball.",
          "The field is slick and the turf is separating. Cuts are dangerous in this weather.",
          "Rain changes everything about the passing game. Grip, trajectory, concentration.",
          "A wet ball in the hands of a receiver with numb fingers is a turnover waiting to happen.",
          "The tarp came off and the rain intensified. This is going to be a tough night for passers.",
          "Rain game protocol â€” both teams running more than passing. The elements dictate the game plan.",
          "Every deep throw tonight carries extra risk. The rain-soaked ball moves unpredictably.",
          "The center is having trouble snapping the wet ball cleanly. Watch for bad snaps.",
          "Rain equalizes talent. Bad weather is the great equalizer in professional football.",
          "The running back's hands are slick. They've wiped the ball dry twice this drive.",
          "Under the rain, in the mud â€” this is the version of football that built the game.",
          "The defensive backs are slipping on cuts. The rain is helping the receivers tonight.",
          "When it rains like this, the team that runs the ball physically wins. Period.",
          "A fumble in the rain is a catastrophe waiting to happen. Ball security is paramount.",
          "Both quarterbacks are having trouble with the grip. Expect more checkdowns tonight.",
          "Wet field, wet ball, wet uniforms â€” and somehow, somebody still has to make plays.",
          "The rain hasn't stopped the crowd. These fans are committed to this game.",
          "Every completed pass in this rain is an achievement. The passer deserves credit.",
          "Rain games have a different kind of drama â€” the slip, the fumble, the unexpected moment."]
  }
};
// â”€â”€ END BROADCAST_COMMENTARY_EXPANDED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// v99.3 â€” Gemini: MFSN Broadcast Expansion
var MFSN_EXPANDED_993 = {   drives: {     PUNT_RETURN_TD: [       "He fields the punt, makes one man miss, and it is an absolute footrace to the end zone for a touchdown!",       "A seam opens up on the return and he hits the afterburners, taking it all the way to the house!",       "Spectacular blocking by the return unit springs him loose for a breathtaking punt return touchdown.",       "He dances around the first wave of defenders and finds daylight, housing this punt for six points!",       "What an electrifying punt return! He completely flipped the field and put points on the board.",       "The coverage team broke down, and he made them pay with a dazzling sprint to the end zone.",       "He catches the punt, sees a crease, and explodes through it for a massive special teams touchdown!",       "They set up the wall perfectly on the sideline, allowing him to coast in for a punt return score.",       "An incredible individual effort on the return breaks the game wide open with a stunning touchdown.",       "He secures the punt and weaves through traffic like a magician, taking it the distance.",       "The punter outkicked his coverage, and the returner sliced through the defense for a spectacular score.",       "A devastating punt return! You simply cannot afford to give up special teams touchdowns like that.",       "He hits the sideline and turns on the jets, outrunning everyone for a phenomenal punt return touchdown!",       "The returner catches it in stride and never looks back, turning a routine punt into an explosive touchdown.",       "An absolute dagger on special teams! He returns the punt all the way for a game-changing score.",       "He breaks two tackles, spins out of another, and finds the painted grass for a brilliant return.",       "The blocking was flawless, but you have to admire the sheer speed on that touchdown return.",       "He took a massive hit, kept his balance, and sprinted away for a miraculous punt return touchdown.",       "A special teams masterclass culminates in a dazzling, untouched punt return for six critical points.",       "The stadium erupts as he weaves through the coverage and houses the punt for a monumental touchdown!"     ],     KICK_RETURN_TD: [       "He takes the kickoff at the goal line and erupts through the middle for a phenomenal touchdown!",       "A massive momentum swing right out of the gate with an electrifying kickoff return for a touchdown.",       "The kickoff return unit executes a flawless wedge, springing the returner for a spectacular score.",       "He catches the kickoff, hits the hole at full speed, and is gone! A devastating return.",       "What a dynamic answer! He takes the ensuing kickoff and houses it to silence the opposing sideline.",       "He burst through the initial wave of coverage and found absolutely nothing but green grass ahead of him.",       "A kickoff return touchdown! That is the ultimate backbreaker for any kickoff coverage team.",       "He bobbled the kick initially, gathered it, and still managed to weave his way for a miraculous touchdown!",       "The speedster takes the kickoff and simply outruns the angles, securing a massive special teams touchdown.",       "An absolute rocket on the return! He hit the crease so fast the coverage team never had a chance.",       "He fields the kickoff deep, follows his blocks brilliantly, and takes it coast to coast for six.",       "The special teams coordinator has to be thrilled with that perfectly executed kickoff return touchdown.",       "A stunning kickoff return! He dodged tackles, kept his feet moving, and found the end zone.",       "He takes the kick and slices through the defense like a hot knife through butter for the score.",       "A gigantic kickoff return for a touchdown breathes massive life into this sideline and the entire stadium.",       "He hits the wedge, bounces outside, and it is a track meet that he easily wins for a touchdown.",       "You do not see kickoff returns like that every day! An absolute masterclass in vision and speed.",       "The coverage lanes completely disintegrated, and the returner gladly accepted the invitation to the end zone.",       "He takes the kickoff right up the gut, breaking an arm tackle and racing away for the touchdown.",       "An unbelievable kickoff return touchdown completely alters the complexion of this football game."     ],     BLOCKED_PUNT: [       "The rush gets home! They block the punt and create absolute chaos in the backfield!",       "A massive push up the middle allows the defense to get a hand on the punt for a crucial block.",       "They completely overwhelmed the punt protection and smothered the kick right off his foot!",       "A monumental blocked punt! The special teams unit delivers a game-altering play when they needed it most.",       "He came completely unblocked off the edge and laid out to block the punt beautifully!",       "A catastrophic breakdown in protection leads to a devastating blocked punt deep in their own territory.",       "The special teams pressure is relentless, resulting in a phenomenal blocked punt and a huge momentum swing.",       "They schemed up the perfect rush and executed it flawlessly to block that punt.",       "A diving effort completely stuffs the punt! That is a highlight-reel special teams play right there.",       "The punt is blocked! An absolute disaster for the kicking team and a massive victory for the rush.",       "He timed the snap perfectly, shot the gap, and easily swatted the punt out of the air.",       "They brought the house on fourth down, completely overpowering the blockers to reject the punt.",       "A critical blocked punt dramatically flips the field position and energizes the entire sideline.",       "The interior line collapsed instantly, allowing a free rusher to secure a massive blocked punt.",       "He sacrifices his body, diving in front of the punter to secure a heroic blocked kick.",       "A blocked punt! You can feel the energy in the stadium instantly shift after that colossal play.",       "They sniffed out the protection scheme and exploited it perfectly for a clean, devastating blocked punt.",       "The punter never had a chance. The rush was on him before he could even swing his leg.",       "An incredible athletic display to leap up and reject the punt right off the kicker's boot.",       "That blocked punt is a nightmare scenario for the offense and a dream come true for the returning unit."     ],     BLOCKED_FG: [       "The kick is up, but it is batted down! A colossal blocked field goal keeps points off the board.",       "They penetrate the line of scrimmage and reject the field goal attempt with a massive block!",       "A game-saving blocked field goal! The defense refused to let them walk away with three points.",       "The edge rusher timed it perfectly, leaping up to swat away the field goal attempt.",       "A devastating blocked field goal entirely shifts the momentum of this closely contested matchup.",       "They got an enormous surge up the middle and easily got a hand on the field goal.",       "The kicking unit breaks down, and the defense capitalizes with a phenomenal blocked field goal.",       "He elevates over the line and absolutely stuffs the field goal! What a magnificent athletic play.",       "A blocked kick! The special teams unit comes through in the clutch to deny the scoring opportunity.",       "They schemed a beautiful overload pressure, resulting in an unblocked man and a rejected field goal.",       "The field goal is blocked! An absolute heartbreaker for the offense after a promising drive.",       "A heroic effort to block the field goal and keep this game within striking distance.",       "The big men inside got their hands up and managed to deflect the crucial field goal attempt.",       "A catastrophic failure by the blocking unit leads to a clean rejection of the field goal.",       "The field goal attempt is smothered! You cannot ask for a better play from the field goal block team.",       "He timed the snap count perfectly, exploding through the gap for a spectacular blocked kick.",       "A massive momentum swing as the defense flexes its muscles and blocks the field goal try.",       "The trajectory was low, and the defensive line easily batted down the field goal attempt.",       "An unbelievable blocked field goal breathes new life into the sideline and changes everything.",       "They empty the tank on the rush, and the effort pays off with a massive blocked field goal."     ],     MISSED_FG: [       "The kick is up, and it sails wide of the uprights. A brutal missed opportunity for three points.",       "He hooked it terribly! The field goal attempt is no good, and the drive ends with nothing.",       "The kick has the distance, but it clanks loudly off the upright! An agonizing missed field goal.",       "A disastrous miss from close range. You simply have to convert those easy field goal attempts.",       "The wind caught it, pushing the field goal attempt wide right and leaving points on the field.",       "He pushes the kick wide! The coaching staff will be absolutely furious with that missed field goal.",       "The snap was good, the hold was clean, but the kicker just flat-out missed the mark.",       "A dreadful miss on a crucial field goal attempt. That could come back to haunt them later.",       "He completely misjudged the angle, and the field goal attempt misses by a wide margin.",       "The kicker looks completely crushed after shanking that vital field goal attempt into the netting.",       "A massive sigh of relief for the defense as the field goal attempt sails harmlessly wide.",       "He left it short! The field goal attempt lacks the leg and drops dead in the end zone.",       "An uncharacteristic miss from a normally reliable kicker keeps the scoreboard exactly where it was.",       "The pressure might have gotten to him. The field goal is pulled badly to the left.",       "A terrible miss from distance. The offense comes away entirely empty-handed after a long, grueling drive.",       "He hit it fat, and the field goal attempt never even had a chance of going through.",       "The defense celebrates wildly as the field goal attempt goes wide. A massive bullet dodged.",       "A crucial misfire in the kicking game. The field goal is no good, and momentum stalls.",       "He struck it poorly, and the ball flutters wide of the target for a painful missed field goal.",       "The kicker walks off in disbelief after missing a totally manageable field goal attempt."     ]   },   injuries: {     minor: [       "He is slow to get up after that collision. The training staff is heading out to take a look.",       "A player is down on the field, grabbing his ankle. Hopefully, it is just a minor tweak.",       "The trainers are out looking at him. It seems like he just got the wind knocked out of him.",       "He is limping off under his own power. It looks like a minor stinger on that rough play.",       "Play is stopped for a brief injury timeout. The player is walking it off on the sideline.",       "He took a hard shot to the ribs and needs a moment to catch his breath on the turf.",       "The medical staff is checking his shoulder on the bench, but he appears to be in good spirits.",       "He got rolled up on awkwardly in the pile. He is heading to the medical tent for a quick check.",       "A minor tweak on that cut. He is jogging on the sideline trying to loosen the muscle up.",       "He is shaking his arm out after that block. Looks like a minor issue that he can play through.",       "The trainers are taping his wrist on the sideline. He should be back in the game shortly.",       "He caught a cleat on that tackle and is limping slightly, but it does not appear serious.",       "A quick evaluation on the field, and he is walking to the sideline without any assistance.",       "He got the wind knocked out of him on that massive collision but is finally back on his feet.",       "Just a minor cramp. The trainers are stretching his leg out on the sideline right now.",       "He is wincing in pain after that awkward landing, but the trainers say it is just a bruise.",       "The medical staff gives him a quick evaluation on the bench. He looks eager to return to action.",       "He took a helmet to the thigh. It looks like a classic dead leg that he needs to walk off.",       "A brief stoppage as the training staff attends to a minor ding sustained during the pileup.",       "He is getting his ankle re-taped on the sideline. Expect him to be back in the lineup very soon."     ],     major: [       "This does not look good at all. The cart is being brought out for the injured player.",       "The stadium has gone completely silent as the medical staff attends to a very serious injury on the field.",       "He went down clutching his knee in agonizing pain. This looks like a potentially season-ending situation.",       "An absolutely brutal collision, and the player is not moving. The medical team is rushing out quickly.",       "The players are taking a knee around their injured teammate. You absolutely hate to see this happen.",       "A catastrophic looking injury on that awkward tackle. The medical staff is stabilizing him carefully.",       "He is being loaded onto the stretcher. A devastating blow for this football team and the player.",       "The training staff immediately signaled for help. This is a very concerning medical situation on the field.",       "He suffered a massive hit and is visibly in tremendous pain. The cart is making its way out.",       "You never want to see a player go down like that. A truly terrifying moment in this game.",       "The air has been completely sucked out of the stadium following that gruesome injury.",       "He got bent backward very awkwardly in the pile. This looks incredibly serious for the young athlete.",       "The medical staff is taking every precaution as they prepare to cart the injured player off the field.",       "Teammates look visibly distraught on the sideline as the medical team works on the injured player.",       "A horrific lower body injury on the play. The broadcast will politely refrain from showing the replay.",       "The injury cart is out. This is a massive, crushing loss for this roster moving forward.",       "He is clutching his shoulder in sheer agony. That looked like a devastating dislocation or break.",       "A hushed crowd watches as the injured player is finally stabilized and carefully lifted onto the cart.",       "The trainers are putting an air cast on his leg. This is a heartbreaking scene on the gridiron.",       "A brutal, frightening injury causes a lengthy delay. We are all hoping for the best possible outcome."     ],     return: [       "Great news from the sideline! The injured player has his helmet back and is returning to the game.",       "He is jogging back onto the field to a massive ovation from the home crowd after that injury scare.",       "The medical staff clears him, and he is right back in the huddle. What a tough football player.",       "He shook off that nasty knock and is returning to the lineup, showing absolute incredible toughness.",       "A sigh of relief for the coaching staff as their key player steps back onto the field of play.",       "He spent some time in the medical tent, but he is fully taped up and ready to resume playing.",       "The trainers give the thumbs up, and he is back out there, determined not to miss a snap.",       "He bounds out of the medical tent looking energized and ready to get right back into the physical battle.",       "It looked bad initially, but he has stretched it out and is officially returning to the action.",       "He refused to stay on the bench. The injured player is back on the field, showing immense grit.",       "The training staff worked their magic, and he is trotting back out to rejoin his teammates.",       "He is a warrior! He takes the field again after an injury scare that held everyone's breath.",       "The crowd erupts as they see him sprinting back into the offensive formation after his brief exit.",       "He got his ankle heavily taped on the sideline and is returning to the defensive secondary immediately.",       "Medical clearance is granted, and he is strapping his helmet back on, eager to make an impact.",       "You cannot keep a competitor like that down for long. He is back in the game and focused.",       "He tested the injury on the sideline with a few sprints and is now cleared to return completely.",       "The toughness of these athletes is unbelievable. He is re-entering the game after a painful collision.",       "He waves off the trainers and jogs back to the huddle. A phenomenal display of resilience.",       "Back in the lineup! He shakes off the injury and returns to provide a massive boost to his squad."     ]   },   crowd: {     homeTeamScoring: [       "The stadium absolutely erupts! The hometown fans are going completely ballistic after that monumental score.",       "Listen to the deafening roar of this crowd! They are shaking the foundation of the stadium right now.",       "The home crowd is in an absolute frenzy, celebrating a massive, momentum-shifting touchdown.",       "A tidal wave of noise washes over the field as the home team punches it into the end zone.",       "The roar is absolutely deafening! The home fans are loving every single second of this offensive showcase.",       "You can barely hear yourself think! The stadium is electric after that brilliant score by the home team.",       "The home crowd goes wild! Towels are waving, and the energy in this building is off the charts.",       "A massive eruption from the loyal fans! This stadium has become an absolute fortress of noise.",       "The home crowd rewards that incredible execution with a thunderous, standing ovation.",       "It is pure pandemonium in the stands! The home team strikes, and the fans are losing their minds.",       "The decibel level just shattered records here! The home crowd is energized by that spectacular touchdown.",       "A wall of sound hits the field! The hometown faithful are reveling in that magnificent scoring drive.",       "The atmosphere is absolutely intoxicating as the home crowd celebrates another phenomenal touchdown.",       "The fans are jumping out of their seats! The home team delivers a brilliant score to ignite the crowd.",       "Listen to this place! The stadium is rocking, and the home team is firmly in the driver's seat.",       "The crowd noise is completely overwhelming! A massive home team score sets this building on fire.",       "The sea of hometown colors goes absolutely crazy as their team lights up the scoreboard.",       "A chaotic, joyous eruption from the home crowd follows that flawlessly executed trip to the end zone.",       "The fans are providing an incredible home-field advantage with this deafening celebration.",       "The roof might blow off this stadium! The home team scores, and the crowd noise is legendary."     ],     awayTeamScoring: [       "The stadium goes completely dead silent. A devastating score by the visiting team sucks the life out of the building.",       "You can hear a pin drop in here. The away team strikes, and the home crowd is absolutely stunned.",       "A smattering of cheers from the traveling fans, but otherwise, this stadium is shockingly quiet.",       "The visiting team silences the hostile crowd with a methodical, backbreaking drive into the end zone.",       "All the energy just drained out of the building. The away team silenced this massive crowd perfectly.",       "The home fans sit down in complete disbelief as the visiting squad punches in a massive touchdown.",       "A masterful drive by the away team completely takes the raucous home crowd out of the football game.",       "The visiting section is going wild, but the rest of the stadium is trapped in a stunned, miserable silence.",       "They came into a hostile environment and quieted the crowd with an absolutely brilliant offensive possession.",       "The groan from the home fans is audible. The away team executed perfectly to steal the momentum.",       "A hushed silence falls over the loyal home fans as the visitors celebrate in their end zone.",       "The visiting team delivers a gut punch to the home crowd, scoring an unexpected and brutal touchdown.",       "You love to play spoiler on the road, and the away team just silenced seventy thousand screaming fans.",       "The road warriors strike! A beautiful touchdown that leaves the home crowd feeling absolutely deflated.",       "The away team completely ignores the noise and executes a flawless touchdown, silencing the stadium.",       "A devastating blow delivered by the visitors, plunging the home stadium into a deep, depressing quiet.",       "The traveling fans make their presence known in a stadium that has suddenly gone totally silent.",       "The home crowd watches in horror as the visiting offense systematically dismantles their defense for a score.",       "A brilliant road performance continues as they quiet the roaring crowd with another spectacular touchdown.",       "The away team silences the critics and the crowd with a magnificent, confidence-crushing score."     ],     blowoutHome: [       "The fans are throwing an absolute party in the stands! This home blowout is a joyous celebration.",       "It is a total carnival atmosphere right now. The home team is putting on a clinic for their adoring fans.",       "The wave is going around the stadium! The home crowd is thoroughly enjoying this absolute demolition.",       "The fans are chanting and singing. This game was over a long time ago, and the home team dominated.",       "A relaxed, joyous mood in the stadium. The home team has provided a stress-free, spectacular blowout victory.",       "The loyal fans are soaking in every single minute of this dominant, lopsided home performance.",       "It is garbage time, but the home fans do not care. They are loving this absolute blowout victory.",       "The stadium is incredibly loud, not with tension, but with pure, unadulterated joy over this massive blowout.",       "The home crowd is demanding even more points! They are absolutely loving this ruthless display of power.",       "A party atmosphere sweeps across the bleachers. The home team is cruising to an incredibly easy victory.",       "The fans are giving the backups a massive ovation as they enter this completely lopsided home game.",       "This has turned into a coronation for the home team. The fans are reveling in the total domination.",       "The stadium is a sea of happy faces. The home team delivered a flawless, blowout performance today.",       "The crowd is having the time of their lives watching their team completely dismantle the opposition.",       "A stress-free afternoon for the home crowd. They are sitting back and enjoying a spectacular blowout.",       "The stadium DJ is playing the hits, and the home fans are dancing to celebrate this massive victory.",       "An absolute rout! The home crowd is eating it up and cheering every single positive yard gained.",       "The home fans are mocking the visitors now. It is a complete blowout, and the crowd is relentless.",       "A joyous, overwhelming celebration in the stands. This blowout win is exactly what the home fans wanted.",       "The atmosphere is incredibly festive. The home team utterly destroyed the competition today."     ],     blowoutAway: [       "The stadium is practically empty now. The home fans have seen enough of this brutal away team blowout.",       "Fans are heading for the exits in droves. This lopsided home defeat is just too painful to watch.",       "A massive chorus of boos rains down from the few home fans remaining in this totally empty stadium.",       "The visiting team has absolutely emptied the building. This is a humiliating blowout on home turf.",       "The away team is showing no mercy, and the disappointed home fans are rapidly fleeing the stadium.",       "It is incredibly quiet, except for the cheers of the small pocket of visiting fans enjoying this blowout.",       "The home crowd is completely shell-shocked. They expected a battle, and instead got a miserable blowout.",       "A depressing atmosphere hangs over the stadium. The home team was totally outclassed in every aspect today.",       "The visiting sideline is throwing a party, while the home stands look like an absolute ghost town.",       "The fans who stayed are letting the coaching staff hear their extreme displeasure with this blowout loss.",       "A humiliating performance at home. The fans are voting with their feet and leaving the stadium early.",       "The away team came in and completely dismantled them, leaving the home crowd angry and totally deflated.",       "The stands are barren. A dreadful blowout loss has completely ruined the weekend for the home fans.",       "The visiting team completely dominated from the opening kickoff, sending the heartbroken home fans to the exits.",       "A completely embarrassing showing at home. The remaining crowd is hostile, angry, and incredibly frustrated.",       "The visitors put on an absolute clinic, completely silencing the crowd and emptying the massive stadium.",       "The home fans cover their eyes. This blowout has been a total disaster from the very first snap.",       "An eerie silence in a mostly empty stadium. The away team executed a flawless, devastating blowout.",       "The visiting team imposed their will, and the home crowd simply surrendered and headed for the parking lot.",       "A miserable, lopsided affair. The home fans are bitterly disappointed by this completely uncompetitive blowout."     ]   },   coach: {     challengeWon: [       "The referee announces the reversal! The coach won the challenge and made a brilliant decision.",       "A fantastic use of the red challenge flag! The review clearly shows the coach was absolutely right.",       "The call on the field is overturned! The coach's challenge pays off with a massive momentum swing.",       "He threw the flag with supreme confidence, and the replay booth confirms the coach made the correct call.",       "The coach wins the challenge! A sharp eye on the sideline saves the team a crucial possession.",       "The reversal is official! The coaching staff was all over that mistake by the officiating crew.",       "A brilliant challenge by the head coach! He trusted his instinct and the call was successfully overturned.",       "The referee flips the call! The coach pumps his fist after winning a heavily contested challenge.",       "The challenge flag worked perfectly! The coach essentially forces a turnover with that successful replay review.",       "The coach looks like a genius right now. He threw the challenge flag and got the exact result he wanted.",       "A massive sigh of relief on the sideline as the coach officially wins the crucial replay challenge.",       "The review overturns the ruling! The coach celebrates a beautifully timed and perfectly executed challenge.",       "He keeps his timeout and gets the call reversed! A masterful stroke of coaching strategy right there.",       "The challenge is successful! The coach made a high-stakes gamble and it paid off beautifully.",       "The coaching staff up in the booth saw the replay and relayed the perfect challenge down to the field.",       "A victorious challenge for the coach! The replay undeniably showed the initial call on the field was wrong.",       "The referee corrects the mistake after the review. The coach's challenge rescues a dying drive.",       "The coach trusted his eyes, threw the red flag, and successfully got the bad call completely overturned.",       "A game-altering successful challenge! The coach completely outsmarted the officials on that controversial play.",       "The ruling is reversed! The coach wears a smug grin after winning a desperately needed replay challenge."     ],     challengeLost: [       "The call on the field stands. The coach loses the challenge and burns a precious, valuable timeout.",       "A wasted challenge flag! The review confirms the original call, and the coach looks incredibly frustrated.",       "The ruling is confirmed. The coach lost that gamble and cost his team a vital second-half timeout.",       "The coach gambled with the red flag and lost. The replay did not provide enough evidence to overturn.",       "An unsuccessful challenge! The coach shakes his head in total disbelief as the referee announces the decision.",       "The coach loses the challenge and the timeout. A very costly mistake in a tight football game.",       "The review booth upholds the call. The coach angrily puts the red flag back in his pocket.",       "A brutal break for the coach. He challenged the spot, but the officials refused to overturn the play.",       "The challenge is denied! The coach's frustration is evident as he completely disagrees with the replay official.",       "He threw the flag in a panic, and it backfired terribly. The challenge is officially lost.",       "The call stands as called on the field. The coach looks totally completely exasperated by that replay decision.",       "A failed challenge leaves the coach fuming on the sideline, having wasted a critical timeout for nothing.",       "The referee announces the bad news. The coach lost the challenge, and the opposing sideline is cheering.",       "The coach misread the play entirely. A terribly ill-advised challenge results in a lost timeout.",       "An unsuccessful review! The coach is letting the officials hear his intense displeasure regarding that decision.",       "The challenge fails to overturn the ruling. The coach buries his face in his hands in absolute frustration.",       "He took a huge risk throwing the flag, but the replay booth confirmed he was completely wrong.",       "The coach loses the replay challenge. That missing timeout could be a huge factor late in this game.",       "A disappointing result from the replay booth. The coach lost the challenge and the vital momentum.",       "The ruling stands! The coach gambled horribly and is now furiously arguing with the line judge."     ],     furious: [       "The coach is absolutely furious on the sideline, screaming at the officials after that controversial penalty marker.",       "He is completely losing his mind! The coach is throwing his headset in total disgust over that blown coverage.",       "The head coach is absolutely irate, tearing into the defensive coordinator after that massive breakdown in communication.",       "He is absolutely seething! The coach is pacing the sideline, screaming at anyone who makes eye contact.",       "The coach is throwing a massive temper tantrum on the sideline over that incredibly undisciplined false start.",       "An absolute explosion from the head coach! He is letting his players have it after a dreadful turnover.",       "The coach is bright red in the face, furiously chewing out the referee over a missed holding call.",       "He is absolutely livid! The coach slams his clipboard to the turf in a fit of pure rage.",       "The coach is reading the riot act to the offensive line after they allowed another devastating sack.",       "He is steaming mad on the sideline, completely furious with the lack of effort on that last play.",       "The coach is absolutely unhinged right now, screaming at the top of his lungs after that sloppy mistake.",       "He looks completely disgusted with his team's performance. The coach is glaring at the bench in silent fury.",       "The coach is visibly furious, wildly gesturing at the officials to explain that completely baffling penalty call.",       "He is giving the quarterback an absolute earful on the sideline after that terribly thrown interception.",       "The coach is boiling over with anger, furiously ripping off his headset and marching down the sideline.",       "He is incredibly frustrated and completely irate with the officiating crew's total lack of consistency today.",       "The head coach is going ballistic! He is furious about the terrible clock management on that last drive.",       "He is absolutely furious with the special teams unit after they allowed a massive, game-changing punt return.",       "The coach is shouting incredibly harsh words at his defense. He is absolutely disgusted with their tackling.",       "He is completely enraged, visibly screaming obscenities into his headset at the offensive coordinator up top."     ],     celebrating: [       "The coach is absolutely ecstatic, pumping his fists wildly and hugging his assistants after that massive touchdown!",       "He is jumping up and down on the sideline! The coach is celebrating a brilliant, game-winning play call.",       "The head coach is wearing a massive smile, high-fiving every single player coming off the field right now.",       "He is absolutely thrilled! The coach points to the sky in celebration of that phenomenal defensive stand.",       "The coach is sprinting down the sideline, cheering aggressively as his player breaks free for a massive score.",       "An incredible celebration on the sideline! The coach is mobbed by his players after securing the huge victory.",       "He is absolutely beaming with pride. The coach claps vigorously, congratulating his team on a perfectly executed drive.",       "The coach is fired up! He chest-bumps the defensive coordinator after they secure a game-changing turnover.",       "He is grinning from ear to ear, clearly delighted with the incredible effort his team displayed today.",       "The coach throws his arms up in total triumph! A brilliant strategic masterclass is resulting in a victory.",       "He is celebrating wildly with the offensive line, recognizing their completely dominant physical performance in the trenches.",       "The coach lets out a massive yell of pure joy! That touchdown entirely validates his aggressive playcalling.",       "He is absolutely jubilant on the sideline, hugging the quarterback after a beautifully thrown touchdown pass.",       "The coach is clapping emphatically, immensely proud of the resilience and grit his squad showed to come back.",       "An emotional celebration for the head coach, who is wiping away a tear after a hard-fought, legendary win.",       "He points directly to the cheering crowd, encouraging them to get even louder while celebrating the big stop.",       "The coach is laughing and joking with the players. He knows they have officially secured the blowout victory.",       "He enthusiastically slaps the helmet of the running back, completely celebrating a bruising, tone-setting touchdown run.",       "The coach is caught on camera celebrating passionately, demonstrating exactly how much this crucial game means to him.",       "A joyous, uninhibited celebration on the sideline! The coach is absolutely loving every second of this dominant performance."     ]   } };

// v99.4 â€” Gemini: MFSN Situational Commentary (blowout/drama/milestones/atmosphere)
var MFSN_SITUATIONAL_994 = {
  situational: {
    blowoutOffense: [
      "They are showing absolutely no mercy, keeping their foot firmly on the gas pedal despite the massive lead.",
      "The offensive coordinator is still dialing up deep shots, treating this like a one-score game.",
      "They are pouring it on right now! There is no let-up from this relentless offensive attack.",
      "Even with a commanding lead, they are executing with the ruthless efficiency of a team trailing by seven.",
      "Running up the score? Perhaps, but this offense is simply executing the plays that are called.",
      "They want to send a message to the rest of the league with this absolute offensive clinic today.",
      "The backups are begging for snaps, but the starters are still out here hunting for more points.",
      "This has turned into a glorified track meet for an offense that simply refuses to slow down.",
      "Why fix what is not broken? They are attacking the defense vertically even with a three-touchdown advantage.",
      "They are treating this opponent with zero respect right now, throwing the ball aggressively with a huge lead.",
      "It is an absolute onslaught! The offense is determined to break the scoreboard before this game ends.",
      "You have to wonder when the coaching staff will call off the dogs, because the offense certainly will not.",
      "They are stat-padding at this point, marching down the field against a completely demoralized defensive unit.",
      "A ruthless, unforgiving offensive philosophy is on full display as they look to extend an already massive blowout.",
      "They are keeping the playbook wide open, executing trick plays while up by multiple touchdowns.",
      "This is a statement game for the offense, and that statement is absolute, unquestioned dominance.",
      "The defense is begging for mercy, but the offensive unit is out for blood this afternoon.",
      "They are treating every single possession like the playoffs are on the line, regardless of the massive score.",
      "A merciless display of offensive firepower continues as they march effortlessly into opposing territory once again.",
      "They are not just beating them; they are trying to completely humiliate this defense on national television."
    ],
    blowoutDefense: [
      "This defensive unit is playing with legendary pride, refusing to give up a single inch despite the blowout.",
      "A dominant, suffocating defensive performance! They are determined to pitch a shutout this afternoon.",
      "The score is completely out of hand, but this defense is flying around like it is a tie ballgame.",
      "They are pitching a masterpiece on the defensive side of the ball, entirely overwhelming the opposition.",
      "An absolute defensive clinic! They have completely broken the spirit of the opposing offensive line.",
      "Even in a massive blowout, this defensive front refuses to yield a single garbage-time yard.",
      "The defense is swarming to the football with terrifying speed, fully intent on preserving their massive effort.",
      "They have put a permanent padlock on the end zone today. What a historically dominant defensive showing.",
      "The backups are in on defense, but the standard remains exactly the same: relentless, punishing football.",
      "They are treating every single blade of grass as sacred ground, refusing to let the offense move the chains.",
      "This defense has been an impenetrable brick wall from the very first snap of the game.",
      "A truly terrifying defensive performance. They are dominating the line of scrimmage and dictating every single play.",
      "The shutout is clearly on their minds! You can see the intensity radiating from the defensive huddle.",
      "They are pitching a perfect game on defense, leaving the opposing quarterback completely out of answers.",
      "A masterclass in defensive execution! They have completely erased the opposing game plan today.",
      "The defensive coordinator is still dialing up aggressive blitzes, completely refusing to back down in this blowout.",
      "They are punishing every single ball carrier, sending a violent message despite their massive lead on the scoreboard.",
      "This defense is playing for a spot in the history books with this absolute shutdown performance.",
      "The pride on that side of the ball is unbelievable. They will not surrender a single consolation point.",
      "An incredibly disciplined, ferocious defensive effort that has totally neutralized the opposing attack for sixty minutes."
    ],
    garbageTime: [
      "They finally find the end zone, but it is much too little, much too late in this contest.",
      "A garbage-time score makes the box score look slightly better, but this game was decided hours ago.",
      "They get on the board late, strictly a cosmetic score against a relaxed prevent defense.",
      "The offense punches it in for a late touchdown, searching for any positive momentum to take into next week.",
      "A completely meaningless touchdown in the grand scheme of things, but the offense finally executes a drive.",
      "They score late in the fourth quarter, merely applying lipstick to a very ugly performance.",
      "The defense was playing incredibly soft coverage, allowing a purely statistical touchdown drive in garbage time.",
      "They find paydirt when it absolutely does not matter, slightly narrowing an insurmountable deficit.",
      "A late touchdown drive provides a tiny silver lining in an otherwise completely disastrous afternoon.",
      "They cross the goal line for a late score, but the celebration is understandably very muted.",
      "The backups manage to string together a scoring drive against a defense just trying to run the clock out.",
      "A purely academic touchdown. The outcome of this football game was decided a very long time ago.",
      "They salvage a tiny bit of pride with a late touchdown, but the blowout loss is already secured.",
      "The prevent defense does exactly what it is designed to do: trade a late, meaningless score for precious time.",
      "They get a garbage-time touchdown to avoid the humiliating shutout, but the sting of defeat remains.",
      "A late score pads the offensive stats, but it will not change the horrific reality of the scoreboard.",
      "They execute a solid drive against a completely disinterested defense for a totally irrelevant touchdown.",
      "The offense finally clicks, but you have to wonder where that execution was during the first three quarters.",
      "A late, entirely inconsequential score in a game that has been thoroughly dominated by the opposition.",
      "They fight until the bitter end to grab a garbage-time score, showing at least a little bit of pride."
    ]
  },
  drama: {
    fight: [
      "We have a massive scuffle breaking out after the whistle! Emotions are completely boiling over on the field.",
      "Flags are flying everywhere! The referees are desperately trying to separate the players in this massive pileup.",
      "Things are getting incredibly chippy out there! Pushing and shoving after the play as tempers absolutely flare.",
      "A huge skirmish erupts in the middle of the field! The coaches are sprinting out to restore order immediately.",
      "The whistle blew a long time ago, but these two teams are exchanging blows in a massive fracas.",
      "Absolute chaos on the gridiron! The bad blood between these two rosters is finally spilling over into a brawl.",
      "We have a fight on our hands! Helmets are getting ripped off as a massive pile of bodies forms.",
      "The referees are completely losing control of this game as a violent scuffle breaks out near the sideline.",
      "Tempers are running dangerously high! We have a full-blown skirmish developing after that controversial late hit.",
      "They are exchanging punches in the pile! This is an ugly scene that the league will definitely review.",
      "A massive altercation halts the game! Both benches are clearing as the officials struggle to regain total control.",
      "The animosity is palpable! A vicious shoving match escalates quickly into a serious incident on the field.",
      "Cooler heads must prevail, but right now, there is an absolute melee occurring near the line of scrimmage.",
      "We have extracurricular activities after the play! The referees are tossing penalty flags into the massive brawl.",
      "A nasty scuffle ensues after a highly questionable hit! These teams genuinely despise one another.",
      "The officials are stepping between massive bodies, trying to break up a very dangerous and heated altercation.",
      "An ugly fight tarnishes the game! Players are losing their composure entirely in the heat of the moment.",
      "The whistle is completely ignored as players lock up and start throwing hands in the center of the field.",
      "A total breakdown of discipline! The coaching staff is desperately trying to pull their players away from the fight.",
      "Emotions reach a boiling point, resulting in a chaotic and dangerous scuffle that halts the football game entirely."
    ],
    ejection: [
      "The referee points directly to the locker room! He has been officially ejected from this football game.",
      "A massive blow to the roster as a key player is disqualified and escorted off the field immediately.",
      "You simply cannot do that on a football field. He is tossed from the game for that egregious foul.",
      "An incredibly costly lack of discipline results in an immediate ejection! He is headed straight to the showers.",
      "The officials have seen absolutely enough! He is thrown out of the game following that completely unacceptable action.",
      "He loses his cool and loses his spot on the field. The referee ejects him without a second thought.",
      "A devastating penalty and an ejection! The coaching staff is absolutely furious with that selfish mistake.",
      "He crosses the line entirely, and the officiating crew rightly throws him out of the contest.",
      "The umpire waves him off the field! That malicious hit rightfully results in an automatic ejection.",
      "A catastrophic loss of composure leads directly to an ejection. He let his entire team down right there.",
      "He is being marched to the locker room by the staff. An ejection that will definitely trigger a massive fine.",
      "The referee makes the signal! He is disqualified for completely un-sportsmanlike conduct and has to leave the stadium.",
      "A purely selfish act results in an immediate ejection! He has nobody to blame but his own stupidity.",
      "The officials confer and make the right call: an ejection for a completely unnecessary and highly dangerous play.",
      "He is tossed! That level of aggression after the whistle simply will not be tolerated by this officiating crew.",
      "A totally inexcusable action gets him thrown out of the ballgame! His afternoon is officially and abruptly over.",
      "The head coach is livid, but the referee was left with absolutely no choice but to eject the player.",
      "He takes a completely unnecessary cheap shot and is immediately disqualified by the furious officiating crew.",
      "An ejection completely alters the landscape of this matchup! You cannot lose your temper like that.",
      "He is sent packing to the locker room! A completely foolish penalty costs his team a tremendously valuable asset."
    ],
    taunting: [
      "A ridiculous taunting penalty! You simply cannot spin the football in the defender's face like that.",
      "He makes a spectacular play, but completely ruins it by aggressively taunting the opponent right in front of the official.",
      "A foolish fifteen-yard penalty for unsportsmanlike conduct! He let his ego get the absolute best of him.",
      "The flag flies for taunting! You have to hand the ball to the referee and celebrate with your own teammates.",
      "He is flagged for staring down the opponent! The league has made it very clear they will penalize that.",
      "A totally unnecessary celebration in the opponent's face draws an immediate and costly taunting penalty.",
      "He makes a massive mistake, drawing a taunting flag for pointing directly at the defensive back after the catch.",
      "The referee throws the laundry for taunting! A complete lack of situational awareness from the emotional player.",
      "He flexes over the fallen opponent, and the official rightfully throws the flag for unsportsmanlike taunting.",
      "A truly selfish taunting penalty wipes out a huge chunk of yardage. The head coach is going to be irate.",
      "He crosses the line from celebrating to taunting, and the yellow flag comes flying in immediately.",
      "You love the passion, but you hate the execution! A taunting penalty gives the opposition free, crucial yardage.",
      "He talks a little too much trash after the whistle, drawing a highly detrimental fifteen-yard taunting penalty.",
      "The official drops the flag for taunting! He simply could not resist getting the final, arrogant word in.",
      "A foolish taunting foul! You have to act like you have been there before instead of baiting the opponent.",
      "He gets into the defender's face and draws a blatant taunting penalty that completely stalls the offensive momentum.",
      "An arrogant gesture costs his team dearly as the referee throws the flag for unsportsmanlike taunting.",
      "He celebrates directly at the opposing bench, drawing an easy, completely avoidable taunting call from the referee.",
      "A massive lack of discipline! The taunting penalty entirely negates a spectacular athletic achievement on the field.",
      "The flag comes out for taunting! He needs to learn to control his emotions after making a highly contested play."
    ]
  },
  milestones: {
    recordBroken: [
      "History is made! We have just witnessed a phenomenal, long-standing record completely shattered on this historic play.",
      "A monumental achievement! That play cements a legacy and puts a brand new name entirely alone in the record books.",
      "The stadium erupts as the record is officially broken! An absolutely unforgettable moment in the history of this franchise.",
      "We are witnessing absolute greatness today! A legendary milestone is surpassed with that spectacular, record-breaking performance.",
      "The record falls! A brilliant culmination of years of incredibly hard work and spectacular athletic dedication.",
      "A totally historic moment on the gridiron! The previous record holder is officially passing the torch today.",
      "He stands alone at the absolute pinnacle! A phenomenal record is broken, and the crowd recognizes the sheer greatness.",
      "The history books are officially rewritten today! A spectacular milestone that will be remembered for generations to come.",
      "A truly magical moment as a legendary, seemingly untouchable record is finally completely eclipsed right before our eyes.",
      "The game stops to recognize absolute history! The record is broken, and the entire stadium is on its feet applauding.",
      "A remarkable achievement! Breaking a record of this massive magnitude requires unparalleled skill and complete consistency.",
      "We are watching a living legend! The record is officially shattered, securing a permanent place in football immortality.",
      "The standard of excellence has officially been raised! A spectacular, record-breaking play that will be replayed forever.",
      "An absolutely historic milestone is achieved! The dedication to his craft is fully rewarded with this magnificent record.",
      "He writes his name into the absolute history of the sport! A magnificent record falls on this beautiful afternoon.",
      "A legendary mark is surpassed! You are watching a generational talent completely rewrite the history of this league.",
      "The record book needs an immediate update! A phenomenal achievement by an absolutely spectacular football player.",
      "A thunderous ovation for a completely historic moment! The record is broken, and the celebration is incredibly well-deserved.",
      "He reaches the absolute summit of his profession! A magnificent, record-setting performance that leaves us all totally speechless.",
      "History unfolds before our very eyes! The all-time record is officially broken, cementing a completely unforgettable legacy."
    ],
    careerHigh: [
      "An absolutely unbelievable performance! He has officially set a brand new career high in this spectacular football game.",
      "He is playing the absolute best football of his entire life! A phenomenal career-best performance is unfolding today.",
      "The best game of his entire career! He has been utterly unstoppable from the very first whistle this afternoon.",
      "A magical performance! He surpasses his previous career high, putting the entire offense squarely on his shoulders.",
      "He is in the absolute zone today! A career day for a player who simply cannot be contained by this defense.",
      "The game of his absolute life! He establishes a new career high with a spectacular, totally dominant showing.",
      "A phenomenal career milestone! He has never played better than he is playing right here on this beautiful afternoon.",
      "He shatters his own personal record! A career-best performance that will highlight his ultimate professional resume.",
      "An incredibly special day for the athlete! He achieves a totally brilliant career high in front of an adoring crowd.",
      "He has reached an entirely new level today! A magnificent career high is established with this completely flawless performance.",
      "The absolute defining game of his career thus far! He is putting up personal-best numbers with total, ruthless efficiency.",
      "A spectacularly memorable outing! He surpasses his career high, displaying an absolutely brilliant evolution of his skill set.",
      "He is enjoying a completely phenomenal career day! The defense has had absolutely no answers for his brilliance.",
      "A personal masterpiece! He achieves a new career high, putting together the most complete game of his professional life.",
      "He elevates his game to completely unprecedented heights! A career-best performance that is absolutely dazzling to watch.",
      "A historic personal milestone! He breaks his own career high with an incredibly dominant and relentless showing today.",
      "He is playing out of his absolute mind! A spectacular career game that will be talked about for a very long time.",
      "An unforgettable, career-defining performance! He sets a new personal best, completely taking over this crucial matchup.",
      "He is officially operating at peak capacity! A completely brilliant career high is reached with that last spectacular play.",
      "A career day for the ages! He reaches an entirely new statistical pinnacle with this totally unbelievable performance."
    ]
  },
  atmosphere: {
    primeTime: [
      "The lights are shining incredibly bright for this highly anticipated, prime-time national television matchup.",
      "Under the stadium lights, the absolute stars are coming out to shine on this spectacular prime-time stage.",
      "The entire country is watching this phenomenal night game! The atmosphere in the stadium is completely absolutely electric.",
      "Prime-time football always brings an entirely different level of intensity to the gridiron!",
      "A nationally televised spectacle! The players absolutely love performing under these brilliant, shining stadium lights.",
      "The whole world is tuning in! This is exactly what prime-time, high-stakes football is completely all about.",
      "A spectacular atmosphere for night football! The energy is absolutely palpable for this massive prime-time showdown.",
      "The bright lights of prime time demand absolute perfection, and these two teams are ready to deliver a classic.",
      "A prime-time stage separates the good from the truly great! The entire nation is incredibly captivated by this matchup.",
      "Under the completely majestic stadium lights, this prime-time clash is absolutely living up to all the massive hype.",
      "National television, massive stakes, and a totally electric crowd! This is prime-time football at its absolute finest.",
      "The stars shine incredibly bright at night! A phenomenal prime-time atmosphere sets the stage for a totally epic battle.",
      "A highly anticipated prime-time thriller! The players can absolutely feel the eyes of the entire football world watching.",
      "The glitz and absolute glamour of prime-time football! The intensity is dialed all the way up under the stadium lights.",
      "An incredibly electric night game atmosphere! This prime-time television audience is being treated to an absolute instant classic.",
      "The pressure is completely magnified under the lights! A phenomenal prime-time showcase between two incredibly talented football teams.",
      "A totally captivating prime-time event! The drama is heightened exponentially when the entire massive country is watching.",
      "Prime-time football provides the absolute ultimate stage! Players dream of making these massive plays under the stadium lights.",
      "The stadium is completely rocking for this national broadcast! A truly unforgettable prime-time football experience.",
      "Under the totally massive prime-time lights, legends are officially born and completely unforgettable football memories are created."
    ],
    rivalry: [
      "You can feel the pure, unadulterated hatred between these two historic franchises! This bitter rivalry is completely unmatched.",
      "Throw the absolute record books entirely out the window! When these two fierce rivals clash, absolutely anything can happen.",
      "The bad blood is completely evident on every single snap! This is a brutal, incredibly physical rivalry matchup.",
      "These two teams completely despise one another! A truly historic, incredibly violent rivalry game is unfolding before us.",
      "Every single yard is highly contested in this incredibly bitter rivalry! The physicality is entirely off the charts today.",
      "A totally fierce rivalry renewed! The utter animosity between these massive rosters is translating into brutally hard hits.",
      "There is absolutely no love lost between these bitter rivals! A completely highly charged, emotional battle is raging.",
      "Bragging rights are completely on the line! This historic rivalry always brings out the absolute best in both teams.",
      "A truly incredibly toxic rivalry! The hostility in this completely packed stadium is absolute, pure, and incredibly palpable.",
      "This is not just another football game; this is a completely bitter, deeply personal, and incredibly historic rivalry clash.",
      "The intensity is totally completely unmatched! This fierce rivalry always guarantees a heavily physical, incredibly taxing football game.",
      "Generations of pure hatred fuel this spectacular rivalry! Every single massive collision carries completely extra, profound weight.",
      "A brutally physical, completely grueling rivalry matchup! These two incredible squads are leaving absolutely everything on the field.",
      "The stakes are incredibly, massively high in this highly contested rivalry! A totally pure, unadulterated battle of sheer will.",
      "These rivals simply cannot totally stand each other! A truly vicious, highly entertaining, and absolutely massive football game.",
      "A totally classic rivalry showdown! The incredible pure, raw emotion on the field is completely entirely overwhelming today.",
      "The absolute historical hatred is boiling completely over! A truly nasty, incredibly fierce rivalry battle in the trenches.",
      "Every single massive play is a completely personal statement in this totally deep-rooted, heavily contested rivalry.",
      "An absolutely highly anticipated rivalry clash! The intense, totally brutal physicality is definitely meeting all expectations.",
      "This rivalry means absolutely everything to these deeply loyal fanbases! A totally epic, incredibly brutal war of attrition."
    ]
  }
};


// v99.5 â€” Gemini: MFSN Fourth Down & Two-Point Situations
var MFSN_FOURTH_DOWN_994 = {
  situational: {
    fourthDownGo: [
      "They are leaving the offense out on the field! A massive gamble on fourth down right here.",
      "The punting unit is staying on the sideline. They are going for it on fourth down!",
      "A bold decision by the coaching staff to roll the dice and go for it on fourth down.",
      "Fourth down and the game is on the line. The offense lines up to try and move the chains.",
      "They are not settling for a kick! The offense is staying out to attempt this crucial conversion.",
      "The analytics say go for it, and the head coach completely agrees. A massive fourth-down play is coming.",
      "The tension in the stadium is palpable as the offense huddles up for a do-or-die fourth down.",
      "High stakes football right here! They are risking field position to try and extend this drive on fourth down.",
      "A huge moment in this game! The offense steps back onto the field to challenge the defense on fourth down.",
      "The coaching staff is showing incredible faith in this offensive unit by going for it on fourth down.",
      "No hesitation from the sideline! The offense is determined to pick up this vital fourth down.",
      "The defense looks completely surprised! The offense is staying out to attempt a bold fourth-down conversion.",
      "It all comes down to this single play. Fourth down, and they desperately need to pick up the yardage.",
      "A totally aggressive approach! They are ignoring the punter and going for broke on fourth down.",
      "The crowd is on its feet! A critical fourth-down decision sets the stage for a dramatic collision.",
      "They are challenging the defense directly! A massive fourth-down attempt is about to unfold.",
      "The coaching staff is playing to win, keeping the offense on the field for a heavily contested fourth down.",
      "A critical juncture in this football game. The offense must convert this fourth-down opportunity.",
      "The offense is signaling that they want to stay on the field! A high-stakes fourth-down gamble is imminent.",
      "They need a single yard on fourth down, and the heavy personnel is trotting onto the gridiron."
    ],
    fourthDownConverted: [
      "They move the chains! A spectacular play call on fourth down keeps this critical drive alive.",
      "A massive fourth-down conversion! The gamble completely pays off for the aggressive coaching staff.",
      "They pick up the first down! The defense could not get off the field in a crucial fourth-down situation.",
      "The offense executes perfectly under extreme pressure, securing a highly contested fourth-down conversion.",
      "A brilliant play call absolutely fools the defense, resulting in an incredibly easy fourth-down conversion.",
      "They converted on fourth down! The offensive line got an amazing push when they needed it most.",
      "The risk totally pays off! The offense secures the necessary yardage to keep this dangerous drive going.",
      "An absolutely clutch performance on fourth down! They refuse to give the ball back to the opposition.",
      "The chains are moving! A phenomenal effort by the offense results in a successful fourth-down gamble.",
      "They just broke the defense's heart with that spectacular, drive-extending fourth-down conversion.",
      "A successful fourth-down try breathes entirely new life into this offensive possession.",
      "The gamble works flawlessly! They convert on fourth down and send a massive message to the defense.",
      "Incredible execution in a pressure-cooker situation! They convert the massive fourth down.",
      "The defense completely collapsed, allowing the offense to pick up the crucial fourth-down yardage.",
      "They roll the dice and come up huge! A phenomenal fourth-down conversion keeps hope alive.",
      "The offensive unit celebrates a hard-fought, incredibly physical fourth-down conversion in the trenches.",
      "They got exactly what they needed! A beautiful play on fourth down extends this marathon drive.",
      "The sideline erupts as the offense officially secures the yardage for a massive fourth-down conversion.",
      "A total dagger to the defense! The offense converts on fourth down and continues to march downfield.",
      "They convert on fourth down with absolute authority, completely imposing their will on the defense."
    ],
    fourthDownStopped: [
      "Stuffed on fourth down! The defense comes up with a monumental stop to force the turnover on downs.",
      "The defense holds! A phenomenal stand on fourth down swings the momentum completely to their sideline.",
      "Turnover on downs! The defense builds a brick wall and absolutely denies the fourth-down conversion attempt.",
      "They are stopped short! The massive fourth-down gamble completely backfires on the coaching staff.",
      "A heroic defensive stop! They completely shut down the offense on fourth down to reclaim the football.",
      "The defense flexes its muscles! They stuff the run on fourth down for a massive turnover on downs.",
      "A totally devastating result for the offense! They fail to convert on fourth down and hand the ball over.",
      "The defense read that play perfectly! An incredible stop on fourth down completely alters the game.",
      "They rolled the dice and lost! The defense celebrates a gigantic, momentum-shifting fourth-down stop.",
      "The offensive line simply got completely overpowered on that failed fourth-down conversion attempt.",
      "A colossal defensive stand! They force the turnover on downs with a brilliant, aggressive tackle.",
      "The defense gets off the field! They execute flawlessly to deny the critical fourth-down attempt.",
      "Turnover on downs! The defense brings the house and completely overwhelms the offensive line.",
      "A massive failure on fourth down leaves the offense looking frustrated and dejected.",
      "The defense rises to the occasion! A spectacular stop on fourth down gives their offense excellent field position.",
      "They fall just inches short! The defense makes a spectacular, game-saving tackle on fourth down.",
      "The defense answers the bell! A totally dominant fourth-down stop completely energizes the home crowd.",
      "A completely blown assignment ruins the fourth-down play! The defense gladly accepts the turnover on downs.",
      "The fourth-down gamble fails miserably! The defense forces a crucial mistake to secure the football.",
      "An impenetrable defensive wall crushes the offense's hope of a fourth-down conversion."
    ],
    twoPointSuccess: [
      "The two-point conversion is good! A perfectly executed play adds two massive points to the scoreboard.",
      "They punch it in for two! The offense executes the conversion attempt absolutely flawlessly.",
      "Two points! The extra effort completely pays off, changing the math for the remainder of this game.",
      "A brilliant play call secures the two-point conversion, putting massive pressure on the opposition.",
      "They successfully convert the two-point try! The momentum is swinging in their favor right now.",
      "The offense sneaks it in for two points! A critical execution that could decide this football game.",
      "A massive two-point conversion! They lined up with a heavy package and simply overpowered the defense.",
      "The pass is caught for the two-point conversion! A spectacular route beat the coverage.",
      "They convert for two! The coaching staff looks inspired for calling that aggressive play.",
      "The two-point conversion is successful! A phenomenal display of pure offensive execution in the clutch.",
      "They muscle their way into the end zone for a crucial, game-altering two-point conversion.",
      "The two points are firmly on the board! They refused to be denied on that critical conversion attempt.",
      "A clutch two-point conversion! The quarterback delivers a strike in a tight window.",
      "They add two points to their total! The defense was caught completely flat-footed on that play.",
      "The two-point attempt is good! A massive tactical victory for the aggressive offensive coordinator.",
      "They secure the two-point conversion with a beautiful, deceptive play-action pass.",
      "The offense celebrates a successful two-point conversion that closes the gap significantly."
    ]
  }
};

// v99.6 â€” Gemini: MFSN Drive/Momentum/Clutch/Weather Commentary
var MFSN_DRIVES_994 = {
  drives: {
    TD: [
      "What a sequence of plays â€” the offense clicked on all cylinders and found the end zone!",
      "Touchdown! The blocking was flawless and the execution was absolute perfection on that drive.",
      "They march right down the field and cap it off with six points!",
      "That is how you draw it up in the playbook, culminating in a beautiful trip to the end zone.",
      "Six points on the board! The defense had absolutely no answer for that offensive showcase.",
      "A spectacular finish to a methodical drive, punching it in for a crucial touchdown.",
      "The quarterback delivers a strike, and that is a text-book touchdown for this offense.",
      "You can feel the energy shift in the stadium after that magnificent scoring drive!",
      "They found the weak spot in the coverage and exploited it for a massive touchdown.",
      "A punishing drive ends exactly how the coaching staff wantedâ€”with a well-earned touchdown.",
      "That score is a testament to their preparation all week long. Simply magnificent execution!",
      "The offense breaks through! They refused to be denied on that march to the end zone.",
      "Touchdown! They imposed their will on the defense and finished the job in style.",
      "An absolute clinic in offensive football ends with the referee signaling a touchdown.",
      "They hit paydirt! A brilliant combination of playcalling and sheer athletic talent on display.",
      "There is the breakthrough they needed, putting six vital points on the scoreboard.",
      "The offensive line deserves the game ball for the push they got on that touchdown play.",
      "Dancing in the end zone! What a phenomenal way to cap off a grueling drive.",
      "The defense looked gassed, and the offense took full advantage to grab the touchdown.",
      "A massive strike for six! That play is going straight to the highlight reel."
    ],
    TO: [
      "The pocket collapses â€” the ball is out! The defense comes up huge when it matters most.",
      "Interception! He read the quarterback's eyes the whole way and made a spectacular play on the ball.",
      "A devastating turnover! You simply cannot afford to give the ball away in this situation.",
      "The defense swarms the ball carrier, popping it loose for a massive takeaway!",
      "Picked off! The coverage was incredibly tight and he jumped the route perfectly.",
      "Fumble on the play! The defense pounces on it, swinging the momentum completely.",
      "A costly mistake by the offense hands possession right back to a hungry defense.",
      "That is a defensive masterclass! They force the error and secure a game-changing turnover.",
      "He threw it right into double coverage, and the defense makes him pay the price.",
      "The ball is on the turf! Absolute chaos out there, but the defense comes away with it.",
      "An opportunistic defense strikes again, ripping the ball away and killing the offensive drive.",
      "They coughed it up! You have to protect the football, and they failed to do so.",
      "What a momentum swing! The defense steps up to force a critical interception.",
      "A disastrous decision by the quarterback results in a gift-wrapped turnover for the defense.",
      "The defensive line applied the pressure, forcing a hasty throw and a brilliant interception.",
      "Ball security is paramount, and that fumble could be a turning point in this matchup.",
      "He takes his eyes off the ball for a split second, and the defense makes a living off those mistakes.",
      "A bone-crushing hit jars the ball loose! The defense celebrates a massive takeaway.",
      "That pass was telegraphed from the start, and the defensive back gladly accepts the interception.",
      "Turnover! The defense bent, but they refused to break, stealing the ball away."
    ],
    FG: [
      "The kick is up, and it splits the uprights perfectly for three points.",
      "A solid strike from the kicker, salvaging three points after the drive stalled out.",
      "Right down the middle! You can always count on the special teams unit to deliver.",
      "The defense holds strong in the clutch, forcing the offense to settle for a field goal.",
      "Three points on the board. It is not a touchdown, but every single point matters today.",
      "The snap is good, the hold is clean, and the kick is right on the money.",
      "A beautiful, towering kick adds three vital points to the total score.",
      "They could not punch it in, so they bring out the kicking unit for a successful field goal.",
      "The kicker drills it! He struck that ball with absolute conviction.",
      "Good from distance! That leg is a serious weapon for this football team.",
      "The offense sputters in the red zone, but they walk away with three points.",
      "He sneaks it just inside the goalpost! A sigh of relief on the sideline.",
      "A methodical drive ends with a successful field goal to keep the scoreboard ticking.",
      "The special teams unit operates like a well-oiled machine, knocking through another field goal.",
      "It had the distance and the accuracy. Three more points are officially in the books.",
      "The defense bends but does not break, surrendering only a field goal attempt.",
      "A crucial three points to cap off a drive that ate up a lot of clock.",
      "He connects beautifully! The kicker remains ice cold under pressure today.",
      "The trajectory was perfect from the moment it left his foot. Good for three.",
      "They take the points where they can get them. A solid, drama-free field goal."
    ],
    PUNT: [
      "The defense does its job, forcing a quick three-and-out and a punt.",
      "Nowhere to go for the offense, and the punting unit is trotting out onto the field.",
      "A stellar defensive stand! They shut down the passing lanes and force the punt.",
      "The punt is away, a booming kick that will dramatically flip the field position.",
      "Offensive frustration continues as they are forced to punt the ball away yet again.",
      "The defense absolutely smothered them on that series. Time to punt it away.",
      "A high, majestic punt forces a fair catch deep in enemy territory.",
      "They fail to move the chains, and special teams will have to shift the field.",
      "An impressive defensive sequence forces the quarterback to throw it away, bringing up fourth down.",
      "The punter pins them deep! A masterful exhibition of special teams execution right there.",
      "The drive stalls near midfield, resulting in a conservative decision to punt the football.",
      "Brilliant coverage on the outside forces an incompletion, and the punting unit is coming on.",
      "The defensive front was unblockable on that possession, forcing an immediate punt.",
      "A booming punt with phenomenal hang time allows the coverage team to get downfield quickly.",
      "They could not establish any rhythm on that drive. The punter is out to clean it up.",
      "A massive stop on third down! The defense flexes its muscles and forces a punt.",
      "The punt rolls out of bounds, pinning the opposition deep in their own territory.",
      "Stifling defense leaves the offense with absolutely no options except to kick it away.",
      "The punt team executes flawlessly, forcing the offense to start from the shadow of their goalposts.",
      "Another drive bites the dust. The defense is playing with incredible intensity right now."
    ],
    SAFETY: [
      "Swarmed in the end zone! That is a devastating safety and a massive swing of momentum!",
      "He had nowhere to run, nowhere to hide! The defense traps him for a monumental safety!",
      "A catastrophic mistake backed up against their own goal line results in two points for the defense.",
      "Safety! The defensive line crashes through like a tidal wave to secure the two points.",
      "An absolute disaster for the offense! They give up two points and lose possession of the ball.",
      "The pressure was relentless, and it forces a game-altering safety in the end zone!",
      "Tackled behind the goal line! The defense executes flawlessly for a rare and thrilling safety.",
      "A botched snap in the end zone leads to a chaotic scramble and a crucial safety!",
      "They brought the blitz and it paid off beautifully with a safety!",
      "What a monumental defensive stand! They notch a safety and send the stadium into a frenzy.",
      "The offensive line just totally collapsed, leading to an inescapable safety in the end zone.",
      "Two points for the defense! They pinned their ears back and attacked the goal line.",
      "A safety! The defense forces the issue and reaps the ultimate reward for their aggression.",
      "He tried to escape the pocket, but the defense dragged him down for a dramatic safety.",
      "Total domination by the defensive front results in a safety and a huge tactical advantage.",
      "The defense smells blood in the water! A phenomenal tackle in the end zone for a safety.",
      "Unbelievable pressure! The defense forces a holding penalty in the end zone for a guaranteed safety.",
      "A nightmare scenario for the offense unfolds, yielding a safety and surrendering the football.",
      "The defense turns the field position advantage into points with a spectacular safety!",
      "Engulfed in his own end zone! You cannot ask for a better defensive play than that safety."
    ]
  },
  momentum: {
    takeLead: [
      "And just like that, we have a new leader in this ballgame! What a spectacular drive.",
      "They seize the lead! The momentum has completely shifted to their sideline after that monumental play.",
      "With that score, they jump out in front! The stadium is absolutely buzzing right now.",
      "They have battled all game long, and it finally pays off as they take the lead.",
      "The scoreboard flips! They grab the lead and put the pressure squarely on the opposition.",
      "What a resilient effort to fight back and capture the lead in this pivotal matchup.",
      "A massive momentum swing! They finally break through and establish their first lead of the day.",
      "They take the lead! The coaching staff has to be thrilled with that execution.",
      "The complexion of this entire game has changed as they vault into the lead!",
      "They refused to back down, and now they are rewarded with a hard-earned lead.",
      "From trailing to leading in the blink of an eye! The offense is clicking perfectly.",
      "That score changes everything! They possess the lead and all the momentum right now.",
      "A clutch performance gives them the advantage. Now it is up to the defense to hold it.",
      "They snatch the lead away! You can feel the confidence surging through this entire roster.",
      "A masterful series of plays puts them out in front when it matters the most.",
      "They hit the front! The sideline is electrified after capturing the crucial advantage.",
      "The lead changes hands once again! This game is turning into an absolute classic.",
      "They climb to the top of the mountain and secure a vital lead in this contest.",
      "A dramatic shift in power! They take the lead with a statement play on offense.",
      "They grab the steering wheel of this game, taking a massive lead late in the contest."
    ],
    extendLead: [
      "They are pouring it on now, extending the lead and taking total control of the game.",
      "Another devastating score pushes their lead to a very comfortable margin.",
      "The lead grows! They are completely dominating all three phases of the game right now.",
      "They stretch the advantage, leaving the opposition desperate for answers on both sides of the ball.",
      "Creating some much-needed breathing room with that score! The lead is looking secure.",
      "They put their foot on the gas and extend this lead to a very dangerous territory.",
      "A relentless attack increases the gap on the scoreboard. They smell victory in the air.",
      "They add to their total, making a comeback incredibly difficult for the opposing sideline.",
      "The cushion gets even bigger! They are operating with absolute ruthless efficiency today.",
      "Building an insurmountable lead! The offense is putting on a showcase for the fans.",
      "They stretch the lead further! The defense has absolutely no answers for this offensive onslaught.",
      "Padding the stats and padding the lead! This is a masterclass in game management.",
      "They widen the margin, demonstrating exactly why they are so tough to beat this season.",
      "More points on the board means a larger deficit for the opponents to miraculously overcome.",
      "They are running away with it now! The lead expands after another brilliant offensive series.",
      "Adding an insurance score! The lead is now stretched to a very commanding margin.",
      "They keep the pressure dialed up, expanding their advantage and breaking the opponent's will.",
      "A commanding lead gets even larger. This team is focused on finishing the job strongly.",
      "They double down on their advantage, making this a truly uphill battle for the trailing squad.",
      "The gap widens once again. It will take a miracle to erase this massive deficit."
    ],
    comeback: [
      "Do not count them out just yet! This comeback attempt is officially in full swing.",
      "They cut it to a one-score game! You can cut the tension in this stadium with a knife.",
      "A massive score breathes new life into this team. The comeback is absolutely on!",
      "They are within striking distance! Suddenly, this feels like an entirely new football game.",
      "Chipping away at the lead! The deficit is now manageable, and belief is returning.",
      "They make it a one-possession game! The pressure shifts entirely to the team defending the lead.",
      "A resilient drive shrinks the gap to single digits. We have a thriller on our hands!",
      "They pull within eight points! This team refuses to wave the white flag today.",
      "The margin shrinks! A late surge has this team believing they can pull off the unthinkable.",
      "They claw their way back into it, making this a tight contest heading down the stretch.",
      "A critical score closes the gap. The momentum is swinging wildly in their favor right now.",
      "They slice into the deficit! It is officially a one-score game with plenty of time remaining.",
      "The comeback trail is blazing! They are within a single possession of typing this game up.",
      "A heroic effort brings them right back into the mix. This finish will be incredible.",
      "They bridge the gap! A tremendous display of grit and determination to make this a game.",
      "Suddenly, the lead does not look so safe. They have closed to within a single score!",
      "The sleeping giant awakens! A huge score narrows the deficit and electrifies the loyal fanbase.",
      "They fight back to make it a one-possession affair. You cannot script drama like this!",
      "Shrinking the lead to a single score! The defensive unit desperately needs a stop right here.",
      "They are right back in the thick of it! An incredible surge to close the margin."
    ]
  },
  clutch: {
    twoMinute: [
      "Inside the two-minute warning now â€” every snap is a playoff game.",
      "The clock is the biggest enemy now as the two-minute drill commences in earnest.",
      "Two minutes remaining. No timeouts. This is where legends are made on the gridiron.",
      "The hurry-up offense is on the field. They must execute perfectly before the clock hits zero.",
      "Under two minutes to play! Every single decision from here on out is absolutely critical.",
      "The two-minute warning sounds. It is time for desperation football and finding the open man.",
      "They are racing against the clock! A frantic two-minute drill is underway to save the game.",
      "Clock management is paramount right now. They need chunks of yardage and the sidelines.",
      "We are under two minutes. The quarterback has to be flawless leading this quick-paced attack.",
      "The two-minute drill requires poise and precision, and they need both right this second.",
      "No huddle, high tempo. The two-minute offense is attacking the defense before they can substitute.",
      "Down to the final two minutes. This is the ultimate test of offensive execution and nerve.",
      "The final two minutes are ticking away. Expect a heavy dose of passing to preserve time.",
      "A chaotic two-minute sequence begins! The defense is exhausted, but they must hold their ground.",
      "Operating in the two-minute drill, the quarterback surveys the field looking for a quick, decisive strike.",
      "The clock is draining fast! They have to operate with absolute urgency in these final minutes.",
      "Two minutes left to determine a victor. The tension on both sidelines is absolutely palpable.",
      "They have entered the two-minute drill, where a single mistake can spell instant disaster.",
      "Spiking the ball to stop the clock! A classic two-minute maneuver to keep hope alive.",
      "The two-minute warning brings a pause, but the chaos is about to resume immediately."
    ],
    goalLine: [
      "Backed up against their own end zone, the defense digs in for a monumental goal-line stand.",
      "It is a heavy formation at the goal line. Power against power to determine the outcome.",
      "First and goal from the one-inch line! The trenches will decide who wins this crucial battle.",
      "The defense builds a brick wall on the goal line! An unbelievable show of sheer force.",
      "Goal-line offense is all about imposing your will, and they are trying to batter it in.",
      "Stuffed at the goal line! The linebackers filled the gaps perfectly to deny the score.",
      "They bring in the jumbo package! It is time for smashmouth football on the goal line.",
      "A magnificent goal-line stand preserves the lead! The defense celebrates a legendary sequence of plays.",
      "Knocking on the door! The offense is determined to punch this into the end zone.",
      "Goal to go! The field shrinks, making every passing window incredibly tight for the quarterback.",
      "The defensive tackles clog the middle, executing a flawless goal-line stand in a pressure situation.",
      "They try to leap over the pile at the goal line! Absolute chaos in the trenches.",
      "A crucial goal-line collision! The defense held their ground and prevented the ball from crossing.",
      "Down at the goal line, you throw out the playbook and rely on pure physical dominance.",
      "The offense rolls the dice on fourth and goal, banking everything on this single play.",
      "A heroic goal-line stand! The defense turned them away empty-handed when a touchdown seemed certain.",
      "The goal-line defense bows its neck and refuses to yield a single inch of turf.",
      "They pitch it outside on the goal line, trying to outrun the pursuit to the pylon.",
      "A formidable goal-line front meets a desperate offense. Something has to give right here.",
      "They run a play-action fake at the goal line! The defense bit hard on the run."
    ],
    redZone: [
      "Operating inside the red zone, the offense must avoid costly turnovers in this congested area.",
      "They have driven into the red zone! Now it is time to capitalize with seven points.",
      "The field compresses in the red zone, putting a premium on sharp routes and accurate throws.",
      "A trip to the red zone yields an opportunity, but the defense is tightening its coverage.",
      "Inside the twenty-yard line, the playbook shrinks, and execution becomes the only thing that matters.",
      "Red zone efficiency is the key to winning football games, and they are knocking on the door.",
      "The defense bends all the way to the red zone, but they are determined not to break.",
      "Entering the red zone, the offense looks to use their tight ends in the seam.",
      "A crucial red zone possession. Settling for a field goal here would feel like a defeat.",
      "The linebackers are dropping deep in the red zone, taking away the easy passing lanes.",
      "They march confidently into the red zone, looking to finish this drive with a devastating touchdown.",
      "A costly penalty in the red zone pushes the offense backward at the worst possible time.",
      "Red zone defense requires discipline, and this unit is playing with incredible focus right now.",
      "They utilize a quick screen in the red zone, trying to catch the heavy defense sleeping.",
      "Inside the twenty, the pressure intensifies for both the offensive coordinator and the quarterback.",
      "The red zone is where money is made, and the offense is cashing in on this drive.",
      "A spectacular red zone stop by the defense forces the kicking unit onto the field.",
      "They are threatening in the red zone again! The defense is scrambling to find an answer.",
      "A beautifully designed red zone concept leaves the receiver wide open for a massive play.",
      "The red zone defense holds firm, forcing a contested throw that falls incomplete."
    ]
  },
  weather: {
    wind: [
      "The wind is howling today. Forget about the deep ball â€” this is a ground-and-pound afternoon.",
      "Gale-force winds are dramatically altering the flight of the football on every single deep pass attempt.",
      "The kicker has to compensate heavily for this swirling wind. It is an absolute nightmare out there.",
      "Wind gusts are playing havoc with the passing game, forcing the quarterback to throw underneath.",
      "You can see the flags whipping in the wind. Throwing into that breeze is nearly impossible.",
      "The wind caught that pass and sailed it completely off target. Mother Nature is defending well.",
      "A heavy crosswind makes every kick an adventure. The special teams coordinator is holding his breath.",
      "They are running the ball heavily, likely because this gusty wind makes passing too much of a risk.",
      "The wind advantage flips this quarter, which could be a massive factor in the kicking game.",
      "A swirling, unpredictable wind is making it extremely difficult for receivers to track the deep ball.",
      "The quarterback has to put a lot of extra velocity on the throw to cut through this wind.",
      "Punting into the teeth of this wind is yielding terrible field position for the kicking team.",
      "With the wind at their backs, expect the offense to take some deep shots down the field.",
      "The wind knocks down the pass! It looked like a sure completion before the gust hit.",
      "Navigating this brutal wind requires a tight spiral, and the quarterback is struggling to deliver it.",
      "The wind is an invisible defender today, altering trajectories and causing absolute chaos in the secondary.",
      "They wisely decide to keep it on the ground and avoid challenging these high wind gusts.",
      "The kicker completely misjudged the wind, and that ball hooks violently wide of the uprights.",
      "A brilliant, low-trajectory throw beats the wind and finds the receiver's hands for a key first down.",
      "The elements are a major factor as the wind continues to dictate offensive playcalling."
    ],
    cold: [
      "It is freezing out there! The players are struggling to grip a ball that feels like a rock.",
      "Bitter cold temperatures are definitely affecting the tackling. Nobody wants to hit in this freezing weather.",
      "You can see the breath of the linemen in the freezing air. This is true winter football.",
      "The cold weather turns every hit into a stinger. It is a battle of attrition today.",
      "Frigid conditions make catching the football a painful endeavor for these shivering wide receivers.",
      "The ball is rock hard in these sub-zero temperatures, making fumbles a much higher probability.",
      "Both teams are struggling to stay warm on the sidelines during this absolute freezer of a game.",
      "The icy conditions are favoring the defense today. The offense just looks sluggish in the cold.",
      "Kicking a frozen football is no easy task, and the kicker's range is noticeably reduced today.",
      "Mental toughness is required to perform in this brutal, bone-chilling cold weather.",
      "The ground is frozen solid, making cuts and quick changes of direction very treacherous for runners.",
      "It is a frigid afternoon, and the running game will be absolutely vital to surviving the elements.",
      "The freezing temperatures have turned this matchup into a gritty, low-scoring defensive battle.",
      "Players are crowding around the sideline heaters trying to survive the biting cold of this winter clash.",
      "Passing is difficult when you cannot feel your fingers. The cold is a massive advantage for the defense.",
      "A brutal, unforgiving chill is in the air. This is old-school, blue-collar football weather.",
      "The extreme cold is limiting the playbook, forcing teams to rely on basic power running schemes.",
      "Dropping a pass hurts even more in this frigid weather. The receivers are clearly feeling the sting.",
      "Tackling is sloppy because the players are stiff from the freezing conditions gripping the stadium.",
      "The frozen turf is unforgiving, and every single impact is amplified by the bitter cold."
    ],
    rain: [
      "A torrential downpour is creating a slick, unpredictable surface for both the runners and the tacklers.",
      "The wet ball slips right through his hands! The rain is causing absolute misery for the receivers.",
      "Footing is treacherous on this waterlogged turf. Expect to see a lot of players losing their balance.",
      "Heavy rain is falling, making ball security the absolute number one priority for every single play.",
      "The quarterback struggles to grip the slick, muddy football in these horrible, rainy conditions.",
      "Raindrops are pouring down, washing away any hope for a sophisticated, high-flying passing attack.",
      "A muddy battle in the trenches! The rain turns this game into a messy physical brawl.",
      "The receivers are having a terrible time tracking the ball through this blinding rainstorm.",
      "Puddles are forming on the field, drastically slowing down the speed of the skill position players.",
      "A sloppy, wet game favors the team that commits fewer turnovers in these awful conditions.",
      "The rain is coming down sideways! Throwing the ball is a massive gamble in this weather.",
      "They are trying to keep the ball dry with towels, but the relentless rain is winning the battle.",
      "A slip in the rain leads to a massive breakdown in coverage. The elements strike again.",
      "The wet conditions claim another victim as the runner loses his footing in the open field.",
      "Kicking off wet turf is extremely dangerous, and the special teams unit must be incredibly careful.",
      "The downpour is relentless. It is an ugly, sloppy, beautiful game of football in the mud.",
      "The rain forces a conservative game plan. Nobody wants to make the critical mistake in the wet.",
      "A soaking wet football results in a terribly wobbly pass that falls harmlessly to the wet turf.",
      "The defense loves this wet weather. It makes the offense one-dimensional and predictable.",
      "Rain-soaked jerseys and muddy helmets. This is exactly what a gritty gridiron battle looks like."
    ]
  }
};

// v99.7 â€” ChatGPT: Social Feed (Fan/Analyst/Insider â€” 210 strings)
var SOCIAL_FEED_994 = {
    fans: {
      bigWin: [
       "WE ARE SO BACK. [TEAM] WITH THE [SCORE] VICTORY. I AM NEVER DOUBTING THIS TEAM AGAIN.",
       "i love football and football loves hurting me BUT NOT TODAY. [TEAM] WON [SCORE].",
       "THEY SAID IT COULDN'T BE DONE. THEY WERE WRONG. [TEAM] DID IT. [SCORE].",
       "my heart is doing cartwheels. [TEAM] just dropped [SCORE] like it's nothing.",
       "WHO NEEDS THERAPY WHEN YOU HAVE [TEAM] WINNING [SCORE]??? (i still need therapy)",
       "touch grass challenge: failed (because of that [TEAM] win, [SCORE])",
       "I APOLOGIZE TO NO ONE. [TEAM] WON [SCORE] AND I AM INSUFFERABLE NOW.",
       "the group chat is about to hear from me for 3â€“5 business days. [TEAM] W, [SCORE].",
       "EVERYONE WHO DOUBTED [TEAM] PLEASE FORM A SINGLE FILE LINE AND APOLOGIZE. [SCORE].",
       "i screamed so loud my dog left the room. worth it. [TEAM] [SCORE].",
       "we might never lose again. scientifically impossible for [TEAM] to lose after [SCORE].",
       "THEY TRIED TO TAKE THIS FROM US. [TEAM] SAID NO. [SCORE].",
       "my pulse is 190 and i regret nothing. [TEAM] W by [SCORE].",
       "football is a beautiful sport when [TEAM] wins [SCORE] and not a second before that.",
       "I AM NOT OKAY (POSITIVE). [TEAM] WON [SCORE].",
       "that was art. that was cinema. that was [TEAM] winning [SCORE].",
       "i have seen enough. build the statue. [TEAM] [SCORE].",
       "I LIED. I DO BELIEVE IN MIRACLES. [TEAM] [SCORE].",
       "i'm going to rewatch the highlights until my eyes dry out. [TEAM] [SCORE].",
       "WE DIDN'T JUST WIN, WE ASCENDED. [TEAM] [SCORE].",
       "the haters are sick to their stomachs. [TEAM] handled business: [SCORE].",
       "my entire personality is this football team and today it is HEALTHY. [TEAM] [SCORE].",
       "I HAVE NEVER SAID A BAD WORD ABOUT [TEAM] IN MY LIFE (do not check receipts). [SCORE].",
       "YES I'M YELLING. [TEAM] WON [SCORE].",
       "someone check on my heart because [TEAM] just won [SCORE] and i'm floating."
     ],
      badLoss: [
       "I will not be taking questions at this time. [TEAM] lost by [SCORE] and i am not okay.",
       "fire everyone. start from scratch. burn it down and rebuild. [TEAM] is cooked after [SCORE].",
       "i watched all of that for WHAT. [TEAM] lost [SCORE]. why is this happening to me specifically.",
       "my heart is in the trash. [TEAM] lost [SCORE].",
       "THIS GAME TOOK YEARS OFF MY LIFE. [TEAM] L by [SCORE].",
       "i'm going to stare at the ceiling in silence for 45 minutes. [TEAM] [SCORE].",
       "touch grass challenge: completed (i walked outside to scream). [TEAM] lost [SCORE].",
       "i can't believe i have to go to work tomorrow after [TEAM] lost [SCORE].",
       "WE HAD IT. WE HAD IT. AND THEN WE DIDN'T. [TEAM] [SCORE].",
       "the universe is cruel and football is proof. [TEAM] L, [SCORE].",
       "i am muting everything. i am blocking everyone. [TEAM] lost [SCORE].",
       "THIS IS A PERSONAL ATTACK. [TEAM] down bad: [SCORE].",
       "i'm not mad i'm just disappointed (i am mad). [TEAM] [SCORE].",
       "how do you even explain that. [TEAM] lost [SCORE] and i aged 12 years.",
       "someone tell my family i loved them. [TEAM] [SCORE].",
       "I KNEW IT. I DIDN'T KNOW IT. I KNEW IT. [TEAM] lost [SCORE].",
       "i cannot believe i defended [TEAM] all week just to get [SCORE].",
       "this loss is gonna haunt me in the shower. [TEAM] [SCORE].",
       "i'm going to become a person who 'doesn't watch sports' after [TEAM] [SCORE] (lying).",
       "THE COACHING. THE DROPS. THE PAIN. [TEAM] lost [SCORE].",
       "my group chat is asking if i'm alive. i'm not. [TEAM] [SCORE].",
       "i have officially entered my villain era. [TEAM] L, [SCORE].",
       "i will be thinking about this [SCORE] loss during my next three meals.",
       "i'm sorry but [TEAM] owes me compensation for emotional damages. [SCORE].",
       "football is fake and i am uninstalling it (see you next week). [TEAM] [SCORE]."
     ],
      clutchPlay: [
       "I KNEW IT I KNEW IT I KNEW IT I KNEW IT I KNEW IT",
       "my heart literally stopped and then restarted more powerful than before",
       "I AM SHAKING. WHO DO I BILL FOR THIS EXPERIENCE.",
       "i just yelled 'NO WAY' so loud the neighbors learned my name",
       "THAT PLAY WAS A RELIGIOUS EXPERIENCE",
       "i blacked out for five seconds and came back to a different reality",
       "PLEASE PUT A WARNING LABEL ON GAMES LIKE THAT",
       "i'm crying in a normal way (i am not crying in a normal way)",
       "THAT WAS ICE COLD. THAT WAS DISGUSTING. THAT WAS BEAUTIFUL.",
       "i said 'it's over' and then the universe said 'lol watch this'",
       "my smartwatch asked if i'm exercising. yes. i'm emotionally sprinting.",
       "THEY REALLY DID THAT. ON PURPOSE. IN PUBLIC.",
       "i need to lie down on the floor for a minute",
       "i cannot feel my hands. is that medically concerning. probably.",
       "SOMEONE HOLD ME I AM A WET PAPER TOWEL OF EMOTION",
       "i'm never slandering anyone again (i am)",
       "THAT WAS A HIGHLIGHT THAT WILL LIVE RENT FREE FOREVER",
       "i think i screamed my soul out of my body and it came back smiling",
       "that was the definition of 'clutch' and i'm mad i witnessed it",
       "i am going to rewatch that play until the heat death of the universe"
     ],
      tradeReact: [
       "WAIT [PLAYER] IS A [TEAM]???? NOBODY TOLD ME???",
       "[PLAYER] to [TEAM] is either genius or insane and i can't tell which yet",
       "i just refreshed the feed and my life changed. [PLAYER] -> [TEAM].",
       "I AM TRYING TO BE CALM BUT I CANNOT. [PLAYER] ON [TEAM]????",
       "okay but what did we GIVE UP though. [PLAYER] to [TEAM] has me suspicious.",
       "i love [PLAYER] but i'm terrified of hope. [PLAYER] joining [TEAM] is too much.",
       "this better not be one of those 'we traded the future for vibes' things. [PLAYER] to [TEAM].",
       "MY JAW HIT THE FLOOR. [PLAYER] IS NOW A [TEAM].",
       "if [PLAYER] is washed i'm going to become a monk. if not we are winning everything. [TEAM].",
       "i can't believe [TEAM] actually did something aggressive. [PLAYER] welcome??",
       "i'm seeing [PLAYER] in a [TEAM] jersey in my mind and it looks correct.",
       "WHY AM I CRYING. [PLAYER] leaving hurts. [PLAYER] was family and now it's [TEAM].",
       "i supported this franchise through darkness and THIS is the reward?? [PLAYER] to [TEAM]??",
       "somebody check on the salary cap. [PLAYER] to [TEAM] feels illegal.",
       "I DON'T KNOW IF I SHOULD CELEBRATE OR PANIC. [PLAYER] [TEAM].",
       "i'm choosing joy. [PLAYER] on [TEAM] is my personality now.",
       "if [PLAYER] doesn't instantly score i'm suing the concept of trading. [TEAM].",
       "i need a wellness check. [PLAYER] to [TEAM] just detonated my brain.",
       "this trade is going to age like wine or like milk and i will be there either way. [PLAYER], [TEAM].",
       "WELCOME [PLAYER]. PLEASE BE GOOD. I AM BEGGING. [TEAM]."
     ],
      draftDay: [
       "[PLAYER] in [ROUND]?? my team is so cooked. or a genius move. probably cooked. [TEAM].",
       "I looked up [PLAYER] for exactly four minutes and I already have strong opinions. [TEAM] [ROUND].",
       "if [PLAYER] is good i loved this pick the whole time. if not i never wanted it. [TEAM] [ROUND].",
       "WHO IS [PLAYER] AND WHY AM I EXPECTED TO FEEL THINGS. [TEAM] [ROUND].",
       "i'm a draft expert now (i watched one highlight reel). [PLAYER], [TEAM], [ROUND].",
       "we drafted [PLAYER] and i am choosing blind optimism. [TEAM] [ROUND].",
       "this pick is either a steal or a crime. [PLAYER] to [TEAM] in [ROUND].",
       "i trust the process (i do not trust the process). [TEAM] took [PLAYER] in [ROUND].",
       "my buddy says [PLAYER] is a 'high motor' guy which sounds like something you say when a guy can't catch. [TEAM] [ROUND].",
       "WELCOME [PLAYER]. PLEASE MAKE ME LOOK SMART FOR DEFENDING THIS PICK. [TEAM] [ROUND].",
       "i can't believe [TEAM] passed on my personal favorite prospect (who i invented). [ROUND].",
       "i'm coping by saying 'positional value' out loud. [TEAM] got [PLAYER] in [ROUND].",
       "if [PLAYER] becomes a star i will pretend i scouted him since middle school. [TEAM] [ROUND].",
       "draft night is just speed-dating with athletes and i fall in love too fast. [PLAYER] [TEAM] [ROUND].",
       "EVERYONE LAUGHING NOW WILL CRY LATER (or i will). [TEAM] picked [PLAYER] in [ROUND]."
     ],
      offseason: [
       "it's February and i'm already convinced my team is either going to the championship or picking top 5",
       "the offseason is fake football and i will watch every second of it",
       "i have constructed 17 unrealistic scenarios in my head and all of them end in glory",
       "why do i feel personally insulted by a rumor",
       "i am begging for any news. sign a long snapper. do something.",
       "i just argued with a stranger about a backup guard. this is who i am now.",
       "the draft can't come soon enough. my brain is a sports radio caller now.",
       "i refreshed the feed 40 times and got nothing. i'm in my flop era.",
       "every workout video is a sign. every caption is a prophecy.",
       "i miss football the way sailors miss land and also i am dramatic",
       "please let me enjoy one calm week without invented drama (impossible)",
       "my sleep schedule is based on rumors and that is not healthy",
       "i saw a blurry photo and decided it's confirmation. that's science.",
       "offseason optimism is a drug and i'm overdosing",
       "i will touch grass when the schedule drops (lying)"
     ]
    },
    analysts: {
      gameThread: [
       "What [TEAM] is doing with the [PLAY] concept against this coverage is really interesting. Thread:",
       "Everyone is reacting to the box score. Here's what the tape actually shows for [TEAM] running [PLAY].",
       "The adjustment to [PLAY] is subtle, but it changes the entire spacing for [TEAM].",
       "Thread: why [TEAM]'s [PLAY] usage is creating matchup stress even when the play doesn't hit big.",
       "What most people are missing: [TEAM] is winning early downs with [PLAY], which opens everything else up.",
       "The sequencing matters. [TEAM] used [PLAY] to force predictable responses, then punished them.",
       "You can see [TEAM] building answers in real time. [PLAY] is the foundation piece tonight.",
       "Here's why the [PLAY] call from [TEAM] is smarter than it looks (and yes, it's on tape).",
       "Reminder: good offenses don't spam plays. [TEAM] is dressing up [PLAY] with multiple looks.",
       "The leverage point on [PLAY] is the key. [TEAM] is manipulating defenders with alignment.",
       "The underlying numbers will like this: [TEAM] is generating efficient looks off [PLAY].",
       "Thread: [TEAM] isn't 'getting lucky' â€” [PLAY] is creating repeatable advantages.",
       "Most people won't notice it, but [TEAM]'s timing on [PLAY] is what keeps the chains moving.",
       "The best indicator is composure. [TEAM] is calling [PLAY] in high-leverage moments for a reason.",
       "You can tell [TEAM] expected this coverage. [PLAY] is the counter, and it's working.",
       "The footwork + route depth synergy on [PLAY] is clean. [TEAM] is executing details.",
       "What the tape shows: [TEAM] is using [PLAY] to simplify reads and speed up decisions.",
       "The defensive response tells the story. [TEAM]'s [PLAY] is forcing concessions.",
       "Thread: the hidden value of [TEAM]'s [PLAY] is how it sets up the next call.",
       "If you're wondering why [TEAM] looks settled, it's because [PLAY] is giving them structure."
     ],
      hotTake: [
       "Reminder that the team everyone is panicking about will probably be fine. â€” just a reminder.",
       "The metrics say this team is better than their record. The metrics are right. Trust the metrics.",
       "Hot take: wins aren't always proof of quality, and losses aren't always proof of collapse. Context matters.",
       "Everyone wants 'momentum.' The underlying numbers want efficiency. Efficiency wins more often.",
       "Here's why the narrative is backward: the roster is the issue, not the coordinator. Come back in six weeks.",
       "Most people are grading quarterbacks by vibes. The tape does not care about vibes.",
       "Contrarian take: the 'obvious fix' fans want is usually the wrong fix.",
       "Thread: why defensive scoring swings are noise over small samples. Stop overreacting.",
       "The real separator in this league is avoiding negative plays. Not highlight plays. It's boring. It's true.",
       "Reminder: one game is not a trend. A month can be a trend. Chill.",
       "Hot take: teams should trade down more often than they trade up. Scarcity is frequently overstated.",
       "What most people are missing is how much scheduling variance drives early narratives.",
       "If you can't explain the coverage, you're probably overconfident about your conclusion.",
       "The market overprices 'leadership' and underprices 'play-to-play consistency.'",
       "Most 'breakout' talk is just opportunity plus regression. Not magic.",
       "If you want to predict next week, stop using last week. Use the process on tape.",
       "Thread: why second-half adjustments are often just better execution, not a mystical coaching shift.",
       "Hot take: your favorite team's issues are usually structural, not emotional.",
       "Reminder: you can like a player and still admit the role doesn't fit. That's analysis.",
       "Most people confuse 'aggressive' with 'smart.' They're not the same thing. Trust the process."
     ],
      tradeTake: [
       "Most people are reacting to [PLAYER] going to [TEAM] emotionally. Here's the structural read:",
       "[PLAYER] to [TEAM] makes sense when you look at their cap structure over the next 3 years.",
       "Thread: the value in [PLAYER] to [TEAM] isn't just talent â€” it's role clarity and contract timing.",
       "What most people are missing: [TEAM] is buying optionality with [PLAYER], not just production.",
       "This trade is about sequencing windows. [PLAYER] aligns with [TEAM]'s competitive timeline.",
       "On tape, [PLAYER] solves a specific problem for [TEAM]. That's why the cost was tolerable.",
       "The underlying numbers suggest [PLAYER]'s efficiency is more stable than the highlights imply. [TEAM] benefits.",
       "Cap note: [TEAM] can absorb [PLAYER] now because of how their next offseason cash flow sets up.",
       "Trade grades are lazy. The question is: did [TEAM] create a new pathway to wins with [PLAYER]?",
       "Most fans will say 'we got better.' The better question: did [TEAM] reduce volatility with [PLAYER]?",
       "Thread: why [PLAYER] is a better fit for [TEAM] than he was for his previous situation.",
       "This is a classic market correction. [PLAYER] was miscast; [TEAM] is re-casting him.",
       "Reminder: the best trades are about opportunity cost. [TEAM] decided [PLAYER] was worth the foregone alternatives.",
       "The value hinges on usage. If [TEAM] uses [PLAYER] in his highest-leverage reps, this is a win.",
       "Most people won't mention it, but [PLAYER] helps [TEAM] in the margins â€” third down, red zone, and situational snaps."
     ]
    },
    insiders: {
      sources: [
       "Per sources: [TEAM] has had multiple conversations about [PLAYER] this week. Talks are ongoing.",
       "I'm told the [PLAYER] situation is more complicated than it appears. Stay tuned.",
       "Sources say [TEAM] has checked in on [PLAYER] multiple times in the last 48 hours. Exploratory.",
       "Per sources: [PLAYER] has interest in [TEAM], but nothing is close. More to come on this.",
       "I'm told [TEAM] is monitoring the [PLAYER] market closely. Preliminary calls made.",
       "Sources: [TEAM] has an internal debate on whether to pursue [PLAYER]. Decision not finalized.",
       "Per sources: [PLAYER] has a short list, and [TEAM] is on it. No timeline yet.",
       "I'm told [TEAM] has been gathering medical info on [PLAYER]. Ongoing diligence.",
       "Sources confirm [TEAM] has discussed [PLAYER] as a trade target. Talks are fluid.",
       "Per sources: a framework involving [PLAYER] and [TEAM] has been discussed. Not imminent.",
       "I'm told [TEAM] is open to moving assets for [PLAYER] if the price drops.",
       "Sources: [PLAYER] is not satisfied with his current role. [TEAM] has awareness of that.",
       "Per sources: [TEAM] has had multiple internal meetings on [PLAYER]. More soon.",
       "I'm told [PLAYER] has been in contact with people around [TEAM]. Nothing formal.",
       "Sources say [TEAM] is considering a restructure to create room for a move involving [PLAYER].",
       "Per sources: [TEAM] is doing background on [PLAYER] ahead of potential talks.",
       "I'm told a [TEAM] decision-maker is pushing hard for [PLAYER]. Others remain cautious.",
       "Sources: [PLAYER] could become available sooner than expected. [TEAM] is one of several teams tracking it.",
       "Per sources: [TEAM] has a contingency plan if [PLAYER] doesn't materialize. Names are being vetted.",
       "I'm told the next 24â€“72 hours could matter for [PLAYER] and [TEAM]. Stay tuned."
     ],
      breaking: [
       "BREAKING: [PLAYER] and [TEAM] have agreed to terms, per sources.",
       "SOURCES: [PLAYER] has requested a meeting with [TEAM] front office.",
       "BREAKING: [TEAM] is finalizing a deal involving [PLAYER], per sources.",
       "SOURCES CONFIRM: [PLAYER] has been traded to [TEAM]. More to come.",
       "BREAKING: [TEAM] has completed a contract restructure tied to plans for [PLAYER], per sources.",
       "SOURCES: [PLAYER] is expected to sign with [TEAM]. Imminent.",
       "BREAKING: [TEAM] has pulled back from talks for [PLAYER], per sources.",
       "SOURCES: [PLAYER] will undergo a visit with [TEAM] this week.",
       "BREAKING: [TEAM] and [PLAYER] are in advanced discussions, per sources.",
       "SOURCES CONFIRM: [PLAYER] has been granted permission to seek a trade; [TEAM] is in contact.",
       "BREAKING: [TEAM] has placed [PLAYER] on the trade block, per sources.",
       "SOURCES: [PLAYER] is expected to be active at practice with [TEAM] after the move.",
       "BREAKING: [TEAM] has emerged as the leading candidate for [PLAYER], per sources.",
       "SOURCES CONFIRM: Contract terms between [PLAYER] and [TEAM] are being finalized.",
       "BREAKING: [PLAYER] has informed his camp he wants [TEAM]. Sources confirm."
     ]
    }
  };

// v99.8 â€” ChatGPT: MFSN Overtime (twoPointFailed + overtimeStart â€” 40 strings)
var MFSN_OVERTIME_994 = {
  situational: {
    twoPointFailed: [
      "The two-point conversion is no good! The defense makes a statement with that stop.",
      "They come up short on the two-point try! The margin stays exactly the same.",
      "No good on the conversion attempt. A huge stand by the defense when it mattered most.",
      "Stopped! They went for two and came away with nothing.",
      "The gamble doesnâ€™t pay off â€” the two-point try is denied.",
      "They had to have itâ€¦ and they donâ€™t get it. Two points left on the field.",
      "Denied at the goal line! What a stop by the defense on the conversion try.",
      "Incomplete! The two-point attempt fails, and that changes the math the rest of the way.",
      "Stuffed! The defense slams the door on the two-point conversion.",
      "No signal for good â€” the two-point try fails, and now the pressure shifts.",
      "Broken up! The defense wins that rep, and the score stays right where it was.",
      "They tried to steal twoâ€¦ and the defense steals it right back.",
      "Short of the line! The conversion attempt comes up empty, and the margin holds.",
      "They went for the knockout punch, and the defense took it away.",
      "They had the look, but the defense had the answer. Two-point try is no good.",
      "Stopped cold! A massive stop that keeps this from turning into a different game.",
      "No good on the two-point attempt. That is a stand you remember.",
      "They needed execution â€” they got resistance. Two-point conversion fails.",
      "The play breaks down and the conversion is denied. That stop looms large.",
      "They go for two and get turned away. The scoreboard doesnâ€™t move an inch."
    ],
    overtimeStart: [
      "Free football! We are heading into overtime, and anything can happen.",
      "Regulation couldnâ€™t settle it. Now someone has to find a way to win.",
      "Overtime. One more period, one more chance â€” and no room for mistakes.",
      "Weâ€™re tied after four quarters. Now itâ€™s about poise, not panic.",
      "The stadiumâ€™s holding its breath â€” overtime is here, and the next swing could decide it.",
      "This one goes beyond regulation. The margin is zero, the tension is not.",
      "Overtime football. Every snap feels heavier, every decision matters more.",
      "Nobody blinked for four quarters. Now somebody has to blink first in overtime.",
      "The coin toss matters, but execution decides everything from here.",
      "Itâ€™s overtime â€” the kind of moment where one play becomes a memory forever.",
      "New chapter, same story: two teams, one winner. Overtime begins.",
      "The clock resets and so does everything else. Overtime football.",
      "This is the silence before the storm. Overtime is underway.",
      "You can feel the nerves and the electricity at the same time. Overtime now.",
      "Tied up after regulation, and the stakes just doubled. Welcome to overtime.",
      "Nobody wanted it to end, but now it has to end. Overtime will decide it.",
      "Overtime: one mistake can be fatal, one drive can be immortal.",
      "The crowd is roaring, the players are exhausted, and the game still needs a winner. Overtime.",
      "Weâ€™ve got extra football, and the next possession could be the last one.",
      "This is where legends get written. Overtime â€” letâ€™s see who wants it more."
    ]
  }
};

var BROADCAST_VOICES_991={
  voices:[
    {name:"Joe Buck",calls:{
      td:"TOUCHDOWN! Right through the heart of the defense!",
      int:"INTERCEPTED! What a read by the defense â€” stunning!",
      sack:"He's SACKED! Never had a chance! They got him!",
      big:"Oh my â€” WHAT a play! The crowd is going absolutely WILD!",
      fumble:"FUMBLE! The ball is OUT! Chaos on the field!",
      fg:"IT IS GOOD! Right down the middle â€” no doubt about it!",
      fgMiss:"No good! Wide right! He's going to hear about that one.",
      safety:"SAFETY! Two points for the defense! Incredible turn of events!"}},
    {name:"Al Michaels",calls:{
      td:"TOUCHDOWN! You simply cannot script it any better than that!",
      int:"PICKED OFF! The defense reads it perfectly â€” huge momentum shift!",
      sack:"DOWN he goes! Brought down hard â€” that's going to hurt!",
      big:"Do you BELIEVE in miracles? Because that just happened right before our eyes!",
      fumble:"FUMBLE! The ball is loose â€” it's a scramble! Who's going to come up with it?",
      fg:"IT'S GOOD! Right between the uprights â€” pressure? What pressure?",
      fgMiss:"Wide left! He had the leg â€” just no accuracy tonight!",
      safety:"SAFETY! That is just extraordinary â€” two points the hard way!"}},
    {name:"Chris Collinsworth",calls:{
      td:"LOOK AT THAT! What a play â€” you just can't coach that kind of talent!",
      int:"Oh, that was a terrible decision. Just terrible. He forced it and paid the price.",
      sack:"And DOWN he goes! The pocket completely collapsed around him!",
      big:"That's just special. You can't teach that. That kid is SPECIAL.",
      fumble:"He's fumbled it! The ball is out! That's going to be a backbreaker!",
      fg:"Splits the uprights! Cool as ice under pressure â€” outstanding!",
      fgMiss:"He missed it badly. That's a kick you have to make at this level.",
      safety:"A safety! You almost never see that but when you do it completely changes the game!"}}
  ],
  pick:function(lg){return BROADCAST_VOICES_991.voices[((lg&&lg.totalPlays)||0)%3];},
  getCall:function(lg,type){var v=BROADCAST_VOICES_991.pick(lg);return v.calls[type]||null;}
};

// â”€â”€ LIVE GAME STATE MACHINE v2 â€” Full special teams & game flow â”€â”€
// v99.2: Merge BROADCAST_COMMENTARY_EXPANDED into BROADCAST_COMMENTARY
(function(){
  var bc=BROADCAST_COMMENTARY;var bce=BROADCAST_COMMENTARY_EXPANDED;
  if(!bc.drives)bc.drives={};if(!bc.momentum)bc.momentum={};
  if(!bc.clutch)bc.clutch={};if(!bc.weather)bc.weather={};
  ["TD","TO","FG","PUNT","SAFETY"].forEach(function(k){
    if(bce.drives[k])bc.drives[k]=(bc.drives[k]||[]).concat(bce.drives[k]);});
  ["takeLead","extendLead","comeback"].forEach(function(k){
    if(bce.momentum[k])bc.momentum[k]=(bc.momentum[k]||[]).concat(bce.momentum[k]);});
  ["twoMinute","goalLine","redZone"].forEach(function(k){
    if(bce.clutch[k])bc.clutch[k]=(bc.clutch[k]||[]).concat(bce.clutch[k]);});
  ["wind","cold","rain"].forEach(function(k){
    if(bce.weather[k])bc.weather[k]=(bc.weather[k]||[]).concat(bce.weather[k]);});
})();

// v99.2: Use TEAM_FLAVOR_991 homeAdvLine when home crowd fires
function getHomeAdvLine991(team){
  if(!team||!team.abbr)return null;
  var flavor=TEAM_FLAVOR_991&&TEAM_FLAVOR_991[team.abbr];
  if(flavor&&flavor.homeAdvLine)return flavor.homeAdvLine;
  return "ðŸŸï¸ The home crowd gives them a boost!";
}
var LIVE_GAME_986={
  create:function(hTeam,aTeam,userId){
    return{
      homeTeam:hTeam,awayTeam:aTeam,userId:userId,
      hScore:0,aScore:0,quarter:1,clock:900,
      possession:"away",// away kicks off â†’ home receives
      fieldPos:25,down:1,yardsToGo:10,
      log:[],driveLog:[],
      qtrs:{h:[0,0,0,0],a:[0,0,0,0]},
      // Phases: coin_toss â†’ kickoff â†’ play_call â†’ play_result â†’ fourth_down â†’ turnover_on_downs â†’ pat â†’ halftime â†’ postgame
      phase:"coin_toss",
      driveNum:0,playNum:0,totalPlays:0,
      stats:{home:{passYds:0,rushYds:0,passTD:0,rushTD:0,int:0,sacks:0,fgM:0,fgA:0,punts:0,fumbles:0,firstDowns:0,plays:0,kickRetYds:0,puntRetYds:0,penalties:0,penYds:0,TOP:0},
             away:{passYds:0,rushYds:0,passTD:0,rushTD:0,int:0,sacks:0,fgM:0,fgA:0,punts:0,fumbles:0,firstDowns:0,plays:0,kickRetYds:0,puntRetYds:0,penalties:0,penYds:0,TOP:0}},
      momentum:0,playCallHistory:[],_gameRef:null,
      pendingResult:null,patPending:false,lastPlay:null,isOT:false,
      // NEW: Special teams & game management
      receivedFirst:null,// "home" or "away" â€” who received opening kickoff
      timeouts:{home:3,away:3},
      twoMinWarned:false,// already showed 2MW this half?
      wentForItOn4th:false,// track if user chose "go for it" to handle turnover on downs
      kickType:"normal",// "normal" or "onside"
      otPoss:{home:false,away:false},// track OT possessions
      otSuddenDeath:false,
      // v98.7: Box scores â€” track individual player stats during game
      boxScore:{},// { "PlayerName": {comp:0,att:0,passYds:0,passTD:0,int:0,rushAtt:0,rushYds:0,rushTD:0,rec:0,recYds:0,recTD:0,sacks:0} }
      // v98.7: Drive tracking
      driveStart:{fieldPos:25,clock:900,quarter:1,plays:0,yards:0},
      driveSummary:null,// set after each possession change
      // v98.7: Pre-snap read for next play
      preSnapRead:null,
      // v98.7: Player of the Game tracking
      potgTracker:{},// { "PlayerName": score }
      // v98.7: Other scores ticker
      otherScores:null,// [{home:"DAL",away:"HOU",hScore:0,aScore:0,quarter:1,status:"live"}]
      // v98.7: Watch drive mode for defense
      watchDriveActive:false,watchDriveQueue:[],watchDriveCoverage:null,
      // v98.7+: Next Gen features
      crowd:3,// -10 to 10 â€” crowd noise, starts with slight home advantage
      isGWD:false,// game-winning drive active?
      challenged:false,// has challenge been used on current play?
      injuries:[],// in-game injuries [{name,pos,type,severity,team}]
      // Coin toss state
      coinTossState:"call",coinTossCall:null,coinTossResult:null,coinTossUserWon:null,
      deferredTo2ndHalf:null,// side that deferred
      // No-huddle QB mode
      noHuddle:false,// is QB calling plays?
      noHuddlePlay:null,// the play QB auto-selected (shown to user)
      // v99.1: Halftime tactical adjustment
      halfAdj991:null// {type, offEdge, defEdge, label} â€” set at halftime
    };
  },
  clockStr:function(secs){
    var m=Math.floor(secs/60);var s=secs%60;
    return m+":"+(s<10?"0":"")+s;
  },
  sideStr:function(fieldPos){
    if(fieldPos<=50)return"OWN "+fieldPos;
    return"OPP "+(100-fieldPos);
  },
  isUserPoss:function(g){
    var userHome=g.userId===g.homeTeam.id;
    return(g.possession==="home"&&userHome)||(g.possession==="away"&&!userHome);
  },
  offTeam:function(g){return g.possession==="home"?g.homeTeam:g.awayTeam;},
  defTeam:function(g){return g.possession==="home"?g.awayTeam:g.homeTeam;},
  side:function(g){return g.possession;},
  defSide:function(g){return g.possession==="home"?"away":"home";},

  // â•â•â• KICKOFF RESOLUTION â•â•â•
  resolveKickoff:function(g,type){
    var rng=Math.random;var kicker=LIVE_GAME_986.offTeam(g);var returner=LIVE_GAME_986.defTeam(g);
    var kickerK=kicker.roster.find(function(p){return p.pos==="K";});
    var retNames=returner.roster.filter(function(p){return(p.pos==="WR"||p.pos==="RB")&&p.isStarter;});
    var retName=retNames.length>0?retNames[Math.floor(rng()*retNames.length)].name:"Returner";
    var recSide=g.possession==="home"?"away":"home";

    if(type==="onside"){
      // Onside kick: 12% recovery rate
      var recovered=rng()<0.12;
      if(recovered){
        g.log.push("ðŸˆ ONSIDE KICK! "+kicker.abbr+" RECOVERS!");
        g.pendingResult={type:"onside_recover",desc:"ONSIDE KICK RECOVERED by "+kicker.abbr+"!",clock:5,isKick:true};
        g.fieldPos=45;// midfield-ish
        // Kicking team keeps possession (don't flip)
      }else{
        g.log.push("ðŸˆ Onside kick â€” "+returner.abbr+" recovers safely.");
        g.pendingResult={type:"onside_fail",desc:"Onside kick recovered by "+returner.abbr+" at their own 45.",clock:5,isKick:true};
        g.possession=recSide;g.fieldPos=55;// good field position for receiving team
      }
    }else{
      // Normal kickoff
      var kickPow=kickerK?(kickerK.ovr*0.5+25):55;
      var r=rng();
      if(r<0.55){
        // Touchback (most common in modern NFL)
        g.log.push("ðŸˆ Kickoff â€” touchback. "+returner.abbr+" ball at the 25.");
        g.pendingResult={type:"touchback",desc:"Kickoff sails into the end zone. Touchback â€” starting at the 25.",clock:5,isKick:true};
        g.possession=recSide;g.fieldPos=25;
      }else if(r<0.78){
        // Short return (15-25 yards from goal line)
        var retYds=15+Math.floor(rng()*11);
        g.stats[recSide].kickRetYds+=retYds;
        g.log.push("ðŸˆ Kickoff return by "+retName+" to the "+retYds+".");
        g.pendingResult={type:"kick_return",desc:retName+" fields the kick and returns it to the "+retYds+" yard line.",yards:retYds,clock:8,isKick:true};
        g.possession=recSide;g.fieldPos=retYds;
      }else if(r<0.92){
        // Medium return (26-40)
        var retYds2=26+Math.floor(rng()*15);
        g.stats[recSide].kickRetYds+=retYds2;
        g.log.push("ðŸˆ Good return! "+retName+" to the "+retYds2+"!");
        g.pendingResult={type:"kick_return",desc:retName+" breaks a tackle! Great return to the "+retYds2+"!",yards:retYds2,clock:10,isKick:true,big:true};
        g.possession=recSide;g.fieldPos=retYds2;
      }else if(r<0.97){
        // Big return (41-70)
        var retYds3=41+Math.floor(rng()*30);
        g.stats[recSide].kickRetYds+=retYds3;
        g.log.push("âš¡ BIG return! "+retName+" breaks free to the "+retYds3+"!");
        g.pendingResult={type:"kick_return",desc:"HUGE RETURN! "+retName+" weaves through traffic, breaks into the open field â€” out to the "+retYds3+"!",yards:retYds3,clock:12,isKick:true,big:true};
        g.possession=recSide;g.fieldPos=retYds3;
        g.momentum+=(recSide==="home"?2:-2);
      }else if(r<0.99){
        // Muffed kickoff (fumble)
        g.log.push("ðŸ’¨ MUFFED KICKOFF! "+kicker.abbr+" recovers!");
        g.pendingResult={type:"kick_fumble",desc:"MUFFED KICK! "+retName+" can't handle it â€” "+kicker.abbr+" falls on the ball!",clock:6,isKick:true,turnover:true};
        // Kicking team gets it â€” don't flip possession
        g.fieldPos=Math.max(20,35+Math.floor(rng()*15));
        g.momentum+=(g.possession==="home"?3:-3);
      }else{
        // KICK RETURN TD! (1%)
        g.stats[recSide].kickRetYds+=100;
        var qi=Math.min(g.qtrs.h.length-1,g.quarter-1);
        g.possession=recSide;
        if(recSide==="home"){g.hScore+=6;g.qtrs.h[qi]+=6;}else{g.aScore+=6;g.qtrs.a[qi]+=6;}
        g.log.push("ðŸˆðŸ’¨ KICK RETURN TOUCHDOWN! "+retName+" TAKES IT ALL THE WAY!");
        g.pendingResult={type:"kick_return_td",desc:"KICK RETURN TOUCHDOWN!!! "+retName+" finds the seam, makes one man miss â€” HE'S GONE! 100 YARDS TO THE HOUSE!",clock:12,isKick:true,isTD:true};
        g.fieldPos=100;g.patPending=true;g.phase="pat";
        g.momentum+=(recSide==="home"?5:-5);
        g.lastPlay=g.pendingResult;return g;
      }
    }
    g.down=1;g.yardsToGo=10;g.driveNum++;g.playNum=0;g.driveLog=[];
    g.phase="play_call";g.lastPlay=g.pendingResult;
    LIVE_GAME_986.startDrive(g);
    LIVE_GAME_986.generatePreSnap(g);
    LIVE_GAME_986.checkQuarter(g);
    return g;
  },

  // â•â•â• PUNT RESOLUTION â•â•â•
  resolvePunt:function(g){
    var rng=Math.random;var off=LIVE_GAME_986.offTeam(g);var side=LIVE_GAME_986.side(g);
    var punter=off.roster.find(function(p){return p.pos==="P";});
    var puntPow=punter?Math.round(35+(punter.ovr-50)*0.4):40;
    var puntDist=puntPow+Math.floor(rng()*15)-5;// Â±variance
    puntDist=Math.max(20,Math.min(65,puntDist));
    g.stats[side].punts++;

    var recSide=LIVE_GAME_986.defSide(g);
    var retTeam=LIVE_GAME_986.defTeam(g);
    var retNames=retTeam.roster.filter(function(p){return(p.pos==="WR"||p.pos==="RB")&&p.isStarter;});
    var retName=retNames.length>0?retNames[Math.floor(rng()*retNames.length)].name:"Returner";

    var landSpot=g.fieldPos+puntDist;// from own perspective
    var r=rng();

    // Check for blocked punt (2%)
    if(r<0.02){
      var blockYds=Math.floor(rng()*10);
      g.log.push("ðŸš« BLOCKED PUNT! Recovered by "+retTeam.abbr+"!");
      g.pendingResult={type:"blocked_punt",desc:"PUNT BLOCKED! The defense gets a hand on it! "+retTeam.abbr+" recovers at the "+(100-g.fieldPos+blockYds)+"!",clock:8,turnover:true};
      g.possession=recSide;g.fieldPos=Math.max(1,Math.min(99,100-(g.fieldPos-blockYds)));
      g.momentum+=(recSide==="home"?4:-4);
      g.down=1;g.yardsToGo=10;g.driveNum++;g.playNum=0;g.driveLog=[];
      g.phase="play_call";g.lastPlay=g.pendingResult;
      LIVE_GAME_986.checkQuarter(g);return g;
    }

    // Punt lands â€” check touchback
    if(landSpot>=100){
      // Touchback on punt
      g.log.push("ðŸ¦µ "+off.abbr+": Punt into the end zone â€” touchback.");
      g.pendingResult={type:"punt",desc:(punter?punter.name:"Punter")+" booms it "+puntDist+" yards into the end zone. Touchback â€” "+retTeam.abbr+" ball at the 20.",clock:8};
      g.possession=recSide;g.fieldPos=20;
    }else{
      // Ball lands in field â€” return phase
      var recFieldPos=100-landSpot;// field position from returner's perspective
      var r2=rng();
      if(r2<0.30){
        // Fair catch
        g.log.push("ðŸ¦µ "+off.abbr+": Punt "+puntDist+" yds â€” fair catch at "+recFieldPos+".");
        g.pendingResult={type:"punt",desc:(punter?punter.name:"Punter")+" punts "+puntDist+" yards. "+retName+" calls for the fair catch at the "+recFieldPos+".",clock:8};
        g.possession=recSide;g.fieldPos=recFieldPos;
      }else if(r2<0.70){
        // Short return (0-8 yds)
        var retY=Math.floor(rng()*9);
        g.stats[recSide].puntRetYds+=retY;
        var newPos=recFieldPos+retY;
        g.log.push("ðŸ¦µ "+off.abbr+": Punt "+puntDist+" yds, returned "+retY+" to the "+newPos+".");
        g.pendingResult={type:"punt",desc:(punter?punter.name:"Punter")+" punts "+puntDist+" yards. "+retName+" returns it "+retY+" yards to the "+newPos+".",yards:retY,clock:10};
        g.possession=recSide;g.fieldPos=Math.min(99,newPos);
      }else if(r2<0.88){
        // Medium return (9-20 yds)
        var retY2=9+Math.floor(rng()*12);
        g.stats[recSide].puntRetYds+=retY2;
        var newPos2=recFieldPos+retY2;
        g.log.push("ðŸ¦µ Punt "+puntDist+" yds â€” nice return by "+retName+" for "+retY2+"!");
        g.pendingResult={type:"punt",desc:(punter?punter.name:"Punter")+" punts "+puntDist+" yards. "+retName+" makes a man miss â€” returns it "+retY2+" yards to the "+newPos2+"!",yards:retY2,clock:12,big:true};
        g.possession=recSide;g.fieldPos=Math.min(99,newPos2);
      }else if(r2<0.96){
        // Big return (21-45 yds)
        var retY3=21+Math.floor(rng()*25);
        g.stats[recSide].puntRetYds+=retY3;
        var newPos3=Math.min(99,recFieldPos+retY3);
        g.log.push("âš¡ HUGE punt return! "+retName+" for "+retY3+" yards!");
        g.pendingResult={type:"punt",desc:"WHAT A RETURN! "+retName+" catches the punt and breaks free â€” "+retY3+" yards! Out to the "+newPos3+"!",yards:retY3,clock:14,big:true};
        g.possession=recSide;g.fieldPos=newPos3;
        g.momentum+=(recSide==="home"?2:-2);
      }else if(r2<0.99){
        // Muffed punt (3%)
        g.log.push("ðŸ’¨ MUFFED PUNT! "+off.abbr+" recovers!");
        g.pendingResult={type:"muffed_punt",desc:"MUFFED PUNT! "+retName+" can't handle it â€” "+off.abbr+" falls on the loose ball!",clock:8,turnover:true};
        // Kicking team recovers â€” keep possession
        g.fieldPos=Math.min(99,100-recFieldPos);
        g.momentum+=(side==="home"?3:-3);
        g.down=1;g.yardsToGo=10;g.driveNum++;g.playNum=0;g.driveLog=[];
        g.phase="play_call";g.lastPlay=g.pendingResult;
        LIVE_GAME_986.checkQuarter(g);return g;
      }else{
        // PUNT RETURN TD! (1%)
        var retYTD=100-recFieldPos;
        g.stats[recSide].puntRetYds+=retYTD;
        var qi3=Math.min(g.qtrs.h.length-1,g.quarter-1);
        g.possession=recSide;
        if(recSide==="home"){g.hScore+=6;g.qtrs.h[qi3]+=6;}else{g.aScore+=6;g.qtrs.a[qi3]+=6;}
        g.log.push("ðŸˆðŸ’¨ PUNT RETURN TOUCHDOWN! "+retName+" TAKES IT ALL THE WAY!");
        g.pendingResult={type:"punt_return_td",desc:"PUNT RETURN TOUCHDOWN!!! "+retName+" catches the punt, cuts left, breaks a tackle â€” NOBODY'S GONNA CATCH HIM! "+retYTD+" YARDS!",clock:14,isTD:true};
        g.fieldPos=100;g.patPending=true;g.phase="pat";
        g.momentum+=(recSide==="home"?5:-5);
        g.lastPlay=g.pendingResult;
        g.down=1;g.yardsToGo=10;g.driveNum++;g.playNum=0;g.driveLog=[];
        return g;
      }
    }
    g.down=1;g.yardsToGo=10;g.driveNum++;g.playNum=0;g.driveLog=[];
    g.phase="play_call";g.lastPlay=g.pendingResult;
    LIVE_GAME_986.startDrive(g);
    LIVE_GAME_986.generatePreSnap(g);
    LIVE_GAME_986.checkQuarter(g);
    return g;
  },

  // â•â•â• EXECUTE A SINGLE PLAY â•â•â•
  executePlay:function(g,offPlay,defPlay){
    var off=LIVE_GAME_986.offTeam(g);var def=LIVE_GAME_986.defTeam(g);
    // Clear previous drive summary after showing for one play
    if(g.driveSummary)g.driveSummary=null;

    // â”€â”€ SPIKE BALL â€” special handling (blocked on 4th down) â”€â”€
    if(offPlay.type==="spike"){
      if(g.down>=4)return g;// Can't spike on 4th down â€” would be turnover on downs
      g.totalPlays++;g.playNum++;g.stats[LIVE_GAME_986.side(g)].plays++;
      g.down++;g.clock=Math.max(0,g.clock-3);
      var spikeResult={type:"spike",yards:0,desc:off.roster.find(function(p){return p.pos==="QB"&&p.isStarter;})?off.roster.find(function(p){return p.pos==="QB"&&p.isStarter;}).name+" spikes the ball! Clock stops!":"Spike! Clock stops!",clock:3,isSpike:true};
      g.driveLog.push({icon:"â¬‡ï¸",text:off.abbr+": "+spikeResult.desc,type:"spike"});
      g.log.push("â¬‡ï¸ "+spikeResult.desc);
      g.pendingResult=spikeResult;g.lastPlay=spikeResult;
      if(g.down>4){g.phase="fourth_down";g.down=4;}else{g.phase="play_call";}
      LIVE_GAME_986.generatePreSnap(g);
      LIVE_GAME_986.checkQuarter(g);return g;
    }

    // â”€â”€ Compute situational modifiers â”€â”€
    var userHome3=g.userId===g.homeTeam.id;
    var isHome=g.possession==="home";
    var homeFieldMod=isHome?1.5:-1.5;// home team gets edge
    // Crowd noise effect
    var crowd=g.crowd||0;// -10 to 10
    var crowdMod=isHome?(crowd*0.15):(-crowd*0.15);
    // Clutch check â€” Q4/OT, score within 8
    var scoreDiff3=Math.abs(g.hScore-g.aScore);
    var isClutch3=(g.quarter>=4&&scoreDiff3<=8)||(g.isOT);
    // Game-winning drive check
    var userSide3=userHome3?"home":"away";
    var userScore3=userHome3?g.hScore:g.aScore;var oppScore3=userHome3?g.aScore:g.hScore;
    var isGWD=isClutch3&&g.clock<=300&&oppScore3>userScore3&&oppScore3-userScore3<=8&&LIVE_GAME_986.isUserPoss(g);
    g.isGWD=isGWD;
    if(isGWD)homeFieldMod+=0.5;// GWD adrenaline

    // v99.1: Halftime adjustment â€” offEdge when user has ball, defEdge (negative = hurts opp) when user defends
    var halfAdjMod991=(function(){
      if(!g.halfAdj991)return 0;
      return LIVE_GAME_986.isUserPoss(g)?(g.halfAdj991.offEdge||0):(g.halfAdj991.defEdge||0);
    })();
    var result=PLAYBOOK_986.resolvePlay(offPlay,defPlay,off,def,{
      down:g.down,ytg:g.yardsToGo,fp:g.fieldPos,clock:g.clock,qtr:g.quarter,
      homeField:homeFieldMod,isClutch:isClutch3,crowdMod:crowdMod,halfAdjMod991:halfAdjMod991
    });
    var side=LIVE_GAME_986.side(g);

    // â”€â”€ PENALTY CHECK (FIRST â€” before clock, before stats, before box score) â”€â”€
    // Pre-snap penalties mean the play never happened
    var penRoll=Math.random();
    if(penRoll<0.025){
      // Offensive penalty â€” play nullified
      var penYds=[5,5,5,10,10,15][Math.floor(Math.random()*6)];
      var penNames=["False Start","Holding","Illegal Formation","Offensive Pass Interference","Delay of Game"];
      var penName=penNames[Math.floor(Math.random()*penNames.length)];
      if(penName==="False Start"||penName==="Delay of Game")penYds=5;
      if(penName==="Offensive Pass Interference")penYds=10;
      var preSnap=(penName==="False Start"||penName==="Delay of Game");
      g.fieldPos=Math.max(1,g.fieldPos-penYds);
      g.stats[side].penalties++;g.stats[side].penYds+=penYds;
      var penClockTick=preSnap?0:Math.floor(Math.random()*8+5);// pre-snap = no clock, post-snap = some clock
      g.clock=Math.max(0,g.clock-penClockTick);
      result={type:"penalty",yards:-penYds,desc:"ðŸš© FLAG! "+penName+" on "+off.abbr+". "+penYds+"-yard penalty. Replay the down.",
        clock:penClockTick,commentary:"",isPenalty:true};
      g.driveLog.push({icon:"ðŸš©",text:result.desc,type:"penalty"});
      g.log.push("ðŸš© "+result.desc);
      g.pendingResult=result;g.lastPlay=result;
      g.phase="play_call";
      g.momentum=Math.max(-10,Math.min(10,g.momentum));
      LIVE_GAME_986.updateCrowd(g,result);
      LIVE_GAME_986.checkQuarter(g);return g;
    }else if(penRoll<0.05){
      // Defensive penalty â€” play nullified
      var dPenYds=[5,5,10,15][Math.floor(Math.random()*4)];
      var dPenNames=["Offsides","Defensive Holding","Pass Interference","Roughing the Passer"];
      var dPenName=dPenNames[Math.floor(Math.random()*dPenNames.length)];
      if(dPenName==="Offsides")dPenYds=5;
      if(dPenName==="Pass Interference")dPenYds=Math.max(10,Math.min(40,Math.floor(Math.random()*25)+5));
      if(dPenName==="Roughing the Passer")dPenYds=15;
      g.fieldPos=Math.min(99,g.fieldPos+dPenYds);
      var defSid=LIVE_GAME_986.defSide(g);
      g.stats[defSid].penalties++;g.stats[defSid].penYds+=dPenYds;
      var autoFD=(dPenYds>=g.yardsToGo)||dPenName==="Roughing the Passer"||dPenName==="Pass Interference";
      if(autoFD){g.down=1;g.yardsToGo=10;g.stats[side].firstDowns++;}
      var dPreSnap=(dPenName==="Offsides");
      var dPenClock=dPreSnap?0:Math.floor(Math.random()*8+5);
      g.clock=Math.max(0,g.clock-dPenClock);
      result={type:"penalty",yards:dPenYds,desc:"ðŸš© FLAG! "+dPenName+" on "+def.abbr+". "+dPenYds+" yards"+(autoFD?", automatic first down!":"."),
        clock:dPenClock,commentary:"",isPenalty:true};
      g.driveLog.push({icon:"ðŸš©",text:result.desc,type:"penalty"});
      g.log.push("ðŸš© "+result.desc);
      if(g.fieldPos>=100){g.fieldPos=99;g.down=1;g.yardsToGo=1;g.stats[side].firstDowns++;}
      g.pendingResult=result;g.lastPlay=result;
      g.phase="play_call";
      g.momentum=Math.max(-10,Math.min(10,g.momentum));
      LIVE_GAME_986.updateCrowd(g,result);
      LIVE_GAME_986.checkQuarter(g);return g;
    }

    // â”€â”€ No penalty â€” count play and tick clock â”€â”€
    g.totalPlays++;g.playNum++;g.stats[side].plays++;
    if(g.driveStart)g.driveStart.plays++;

    // â”€â”€ NEXT GEN STATS â”€â”€
    var ngs=null;
    if(result.type==="complete"||result.type==="incomplete"||result.type==="interception"){
      var compProb=Math.round((1-(offPlay.incPct||0.25))*100);
      if(result.type==="complete"&&result.big)compProb=Math.max(8,compProb-25);// big plays had low prob
      ngs={compProb:compProb,completed:result.type==="complete"};
    }
    if(result.type==="run"||result.type==="complete"){
      var expYds=Math.round((offPlay.ydsBase[0]+offPlay.ydsBase[1])/2);
      var actual=result.yards;
      ngs=ngs||{};ngs.expYds=expYds;ngs.actualYds=actual;ngs.yoe=actual-expYds;
    }
    result.ngs=ngs;

    // â”€â”€ IN-GAME INJURY (~2% per play) â”€â”€
    if(Math.random()<0.018&&!result.isSpike){
      var injTeam=Math.random()<0.5?off:def;
      var injSide2=injTeam===off?side:LIVE_GAME_986.defSide(g);
      var injCandidates=injTeam.roster.filter(function(p){return p.isStarter&&!p._gameInjured&&p.pos!=="K"&&p.pos!=="P";});
      if(injCandidates.length>0){
        var injP=injCandidates[Math.floor(Math.random()*injCandidates.length)];
        injP._gameInjured=true;
        var injTypes=["ankle","knee","hamstring","shoulder","wrist","ribs"];
        var injType=injTypes[Math.floor(Math.random()*injTypes.length)];
        var injSeverity=Math.random()<0.6?"questionable":"out for the game";
        result.injury={name:injP.name,pos:injP.pos,type:injType,severity:injSeverity,team:injTeam.abbr};
        if(!g.injuries)g.injuries=[];
        g.injuries.push(result.injury);
        g.log.push("ðŸ¥ INJURY: "+injP.name+" ("+injP.pos+") â€” "+injType+" â€” "+injSeverity);
      }
    }

    // â”€â”€ CROWD UPDATE â”€â”€
    LIVE_GAME_986.updateCrowd(g,result);

    // Tick clock â€” incomplete/OOB stops clock (shorter tick)
    var clockTick=result.clock||25;
    if(result.type==="incomplete"||result.isSpike)clockTick=Math.min(clockTick,5);
    var finalTwoMin=(g.quarter===2||g.quarter===4||g.quarter>=5)&&g.clock<=120;
    if(finalTwoMin&&result.type==="run"&&!result.isTD&&Math.random()<0.15){
      clockTick=Math.min(clockTick,8);result.desc+=" â€” out of bounds!";result.oob=true;
    }
    var prevClock=g.clock;
    g.clock=Math.max(0,g.clock-clockTick);
    g.stats[side].TOP+=(prevClock-g.clock);

    // â”€â”€ 2-MINUTE WARNING CHECK â”€â”€
    if(!g.twoMinWarned&&(g.quarter===2||g.quarter===4)&&prevClock>120&&g.clock<=120){
      g.twoMinWarned=true;
      g.pendingTwoMin=true;
    }

    // â”€â”€ BOX SCORE TRACKING â”€â”€
    LIVE_GAME_986.updateBoxScore(g,result,side);

    // â”€â”€ NORMAL PLAY RESOLUTION â”€â”€
    if(result.type==="run"||result.type==="complete"){
      if(result.type==="run")g.stats[side].rushYds+=result.yards;// track actual yards including negative
      else g.stats[side].passYds+=result.yards;
      g.fieldPos+=result.yards;
      g.yardsToGo-=result.yards;
      if(g.yardsToGo<=0){g.down=1;g.yardsToGo=10;g.stats[side].firstDowns++;g.fieldPos=Math.min(99,g.fieldPos);}
      else{g.down++;}
      // TOUCHDOWN?
      if(g.fieldPos>=100){
        g.fieldPos=100;
        var pts=6;var qi=Math.min(g.qtrs.h.length-1,g.quarter-1);
        if(side==="home"){g.hScore+=pts;g.qtrs.h[qi]+=pts;}
        else{g.aScore+=pts;g.qtrs.a[qi]+=pts;}
        if(result.type==="run")g.stats[side].rushTD++;else g.stats[side].passTD++;
        g.momentum+=(side==="home"?3:-3);
        result.isTD=true;
        result.desc+=(result.desc.indexOf("TOUCHDOWN")<0?" TOUCHDOWN!":"");
        g.driveLog.push({icon:"ðŸˆ",text:off.abbr+": "+result.desc,type:"td"});
        g.log.push("ðŸˆ "+off.abbr+": "+result.desc);
        g.pendingResult=result;g.lastPlay=result;
        g.patPending=true;g.phase="pat";
        LIVE_GAME_986.endDrive(g,"TOUCHDOWN");
        // OT sudden death check
        if(g.isOT&&g.otSuddenDeath){g.phase="postgame";g.lastPlay=result;g.log.push("â”€â”€ FINAL â”€â”€");return g;}
        return g;
      }
    }else if(result.type==="sack"){
      g.fieldPos+=result.yards;
      g.yardsToGo-=result.yards;// sack yards are negative, so this INCREASES yardsToGo
      g.stats[LIVE_GAME_986.defSide(g)].sacks++;
      g.down++;
      g.momentum+=(side==="home"?-1:1);
    }else if(result.type==="incomplete"){
      g.down++;
    }else if(result.type==="fumble"||result.type==="interception"){
      if(result.type==="fumble")g.stats[side].fumbles++;
      else g.stats[side].int++;
      g.momentum+=(side==="home"?-3:3);
      result._prevDown=g.down;result._prevYTG=g.yardsToGo;result._prevFP=g.fieldPos;result._prevSide=side;// for challenge
      g.challenged=false;// reset challenge flag
      result.turnover=true;// ensure turnover flag is set
      g.driveLog.push({icon:result.type==="fumble"?"ðŸ’¨":"ðŸ–ï¸",text:off.abbr+": "+result.desc,type:"to"});
      g.log.push((result.type==="fumble"?"ðŸ’¨":"ðŸ–ï¸")+" "+off.abbr+": "+result.desc);
      g.pendingResult=result;g.lastPlay=result;
      // End drive BEFORE flipping so yards/plays calculate correctly
      LIVE_GAME_986.endDrive(g,result.type==="fumble"?"FUMBLE":"INTERCEPTION");
      // NOW flip possession and field position
      g.possession=g.possession==="home"?"away":"home";
      g.fieldPos=Math.max(1,Math.min(99,100-g.fieldPos));
      g.down=1;g.yardsToGo=10;g.driveNum++;g.playNum=0;g.driveLog=[];g.wentForItOn4th=false;
      g.phase="play_call";
      LIVE_GAME_986.startDrive(g);
      // OT check
      if(g.isOT){g.otPoss[side]=true;if(g.otPoss.home&&g.otPoss.away)g.otSuddenDeath=true;}
      LIVE_GAME_986.generatePreSnap(g);
      LIVE_GAME_986.checkQuarter(g);return g;
    }

    // Safety check
    if(g.fieldPos<=0){
      g.fieldPos=1;
      var defS=LIVE_GAME_986.defSide(g);
      var qi2=Math.min(g.qtrs.h.length-1,g.quarter-1);
      if(defS==="home"){g.hScore+=2;g.qtrs.h[qi2]+=2;}else{g.aScore+=2;g.qtrs.a[qi2]+=2;}
      result.desc+=" SAFETY! 2 points for the defense!";result.isSafety=true;
      g.driveLog.push({icon:"ðŸš¨",text:result.desc,type:"safety"});g.log.push("ðŸš¨ "+result.desc);
      g.pendingResult=result;g.lastPlay=result;
      LIVE_GAME_986.endDrive(g,"SAFETY");// end drive BEFORE flip
      g.possession=g.possession==="home"?"away":"home";
      g.phase="kickoff";g.kickType="normal";
      g.driveNum++;g.playNum=0;g.driveLog=[];g.wentForItOn4th=false;
      LIVE_GAME_986.startDrive(g);
      LIVE_GAME_986.checkQuarter(g);return g;
    }

    // Log the play
    var icon2=result.type==="sack"?"ðŸ’¥":result.type==="incomplete"?"â­•":result.big?"âš¡":"â–¶ï¸";
    g.driveLog.push({icon:icon2,text:off.abbr+": "+result.desc,type:result.type});
    g.log.push(icon2+" "+off.abbr+": "+result.desc);
    g.pendingResult=result;g.lastPlay=result;

    // Turnover on downs?
    if(g.down>4&&g.wentForItOn4th){
      g.wentForItOn4th=false;
      g.pendingResult={type:"turnover_on_downs",desc:"TURNOVER ON DOWNS! "+off.abbr+" fails to convert on 4th down!",clock:0};
      g.lastPlay=g.pendingResult;
      g.driveLog.push({icon:"ðŸ“‰",text:g.pendingResult.desc,type:"to"});
      g.log.push("ðŸ“‰ "+g.pendingResult.desc);
      LIVE_GAME_986.endDrive(g,"TURNOVER ON DOWNS");
      g.possession=g.possession==="home"?"away":"home";
      g.fieldPos=Math.max(1,Math.min(99,100-g.fieldPos));
      g.down=1;g.yardsToGo=10;g.driveNum++;g.playNum=0;g.driveLog=[];
      g.phase="play_call";
      LIVE_GAME_986.startDrive(g);
      if(g.isOT){g.otPoss[side]=true;if(g.otPoss.home&&g.otPoss.away)g.otSuddenDeath=true;}
      LIVE_GAME_986.generatePreSnap(g);
      LIVE_GAME_986.checkQuarter(g);return g;
    }

    // Fourth down decision needed?
    if(g.down>4){
      g.phase="fourth_down";g.down=4;
    }else{
      g.phase="play_call";
      LIVE_GAME_986.generatePreSnap(g);
    }
    g.momentum=Math.max(-10,Math.min(10,momentumDecay991(g.momentum)));// v99.2: DeepSeek decay
    LIVE_GAME_986.checkQuarter(g);return g;
  },

  // â•â•â• 4TH DOWN DECISION â•â•â•
  fourthDown:function(g,choice){
    var side=LIVE_GAME_986.side(g);var off=LIVE_GAME_986.offTeam(g);
    var qi=Math.min(g.qtrs.h.length-1,g.quarter-1);
    if(choice==="punt"){
      LIVE_GAME_986.endDrive(g,"PUNT");
      LIVE_GAME_986.resolvePunt(g);
      LIVE_GAME_986.startDrive(g);
      return g;
    }else if(choice==="fg"){
      var fgDist=100-g.fieldPos+17;
      g.stats[side].fgA++;
      var k2=off.roster.find(function(p){return p.pos==="K";});
      var pct=k2?(0.65+(k2.ovr-60)*0.008-(fgDist>50?0.25:fgDist>45?0.15:fgDist>35?0.05:0)):0.65;
      if(Math.random()<pct){
        LIVE_GAME_986.endDrive(g,"FIELD GOAL");
        g.stats[side].fgM++;
        if(side==="home"){g.hScore+=3;g.qtrs.h[qi]+=3;}else{g.aScore+=3;g.qtrs.a[qi]+=3;}
        g.log.push("ðŸŽ¯ "+off.abbr+": "+fgDist+"-yard FG is GOOD! âœ…");
        g.pendingResult={type:"fg_good",desc:(k2?k2.name:"K")+" lines up from "+fgDist+" yards... the snap is down, the kick is up... IT'S GOOD!",clock:5};
        g.momentum+=(side==="home"?1:-1);
        // OT scoring check
        if(g.isOT&&g.otSuddenDeath){g.lastPlay=g.pendingResult;g.phase="postgame";g.log.push("â”€â”€ FINAL â”€â”€");return g;}
      }else{
        LIVE_GAME_986.endDrive(g,"MISSED FG");
        g.log.push("âŒ "+off.abbr+": "+fgDist+"-yard FG NO GOOD!");
        var missDescs=["WIDE RIGHT! No good!","WIDE LEFT! He missed it!","Blocked at the line!","Short! Doesn't have the leg!"];
        g.pendingResult={type:"fg_miss",desc:(k2?k2.name:"K")+" from "+fgDist+" yards... "+missDescs[Math.floor(Math.random()*missDescs.length)],clock:5};
        g.momentum+=(side==="home"?-1:1);
      }
      g.lastPlay=g.pendingResult;g.driveLog=[];g.playNum=0;g.driveNum++;g.wentForItOn4th=false;
      // After FG: kickoff if good, turnover if miss
      if(g.pendingResult.type==="fg_good"){
        // Scoring team kicks off
        g.phase="kickoff";g.kickType="normal";
        // OT possession tracking
        if(g.isOT){g.otPoss[side]=true;if(g.otPoss.home&&g.otPoss.away)g.otSuddenDeath=true;}
      }else{
        // Missed FG â€” other team takes over at spot of kick (or own 20, whichever is further back)
        g.possession=g.possession==="home"?"away":"home";
        g.fieldPos=Math.max(20,100-g.fieldPos);
        g.down=1;g.yardsToGo=10;g.phase="play_call";
        LIVE_GAME_986.startDrive(g);LIVE_GAME_986.generatePreSnap(g);
        if(g.isOT){g.otPoss[side]=true;if(g.otPoss.home&&g.otPoss.away)g.otSuddenDeath=true;}
      }
      LIVE_GAME_986.checkQuarter(g);return g;
    }else{
      // Go for it on 4th
      g.down=4;g.wentForItOn4th=true;g.phase="play_call";g.pendingResult=null;
      LIVE_GAME_986.generatePreSnap(g);
      return g;
    }
  },

  // â•â•â• PAT / 2-POINT CONVERSION â•â•â•
  handlePAT:function(g,choice){
    var side=LIVE_GAME_986.side(g);var qi=Math.min(g.qtrs.h.length-1,g.quarter-1);
    var off=LIVE_GAME_986.offTeam(g);
    var k=off.roster.find(function(p){return p.pos==="K";});
    if(choice==="xp"){
      var xpPct=k?0.90+(k.ovr-60)*0.001:0.94;
      xpPct=Math.max(0.85,Math.min(0.97,xpPct));
      if(Math.random()<xpPct){
        if(side==="home"){g.hScore+=1;g.qtrs.h[qi]+=1;}else{g.aScore+=1;g.qtrs.a[qi]+=1;}
        g.pendingResult={type:"xp_good",desc:(k?k.name:"Kicker")+" â€” extra point is GOOD!",clock:0};
      }else{
        var missType=Math.random()<0.5?"BLOCKED!":"WIDE! No good!";
        g.pendingResult={type:"xp_miss",desc:"Extra point "+missType,clock:0};
      }
    }else{
      if(Math.random()<0.48){
        if(side==="home"){g.hScore+=2;g.qtrs.h[qi]+=2;}else{g.aScore+=2;g.qtrs.a[qi]+=2;}
        g.pendingResult={type:"two_good",desc:"TWO-POINT CONVERSION IS GOOD! "+off.abbr+" pushes it in!",clock:0};
      }else{
        var failDesc=(MFSN_OVERTIME_994.situational.twoPointFailed&&MFSN_OVERTIME_994.situational.twoPointFailed.length)?MFSN_OVERTIME_994.situational.twoPointFailed:["Two-point attempt STUFFED at the line!","Pass falls incomplete on the two-point try!","Two-point conversion FAILS!"];
        g.pendingResult={type:"two_fail",desc:failDesc[Math.floor(Math.random()*failDesc.length)],clock:0};
      }
    }
    g.lastPlay=g.pendingResult;g.patPending=false;g.wentForItOn4th=false;
    // After PAT â†’ kickoff (scoring team kicks)
    // Possession stays with scoring team (they kick off)
    g.phase="kickoff";g.kickType="normal";
    g.driveNum++;g.playNum=0;g.driveLog=[];
    // OT: if first possession scored, other team gets a chance (unless sudden death)
    if(g.isOT){g.otPoss[side]=true;if(g.otPoss.home&&g.otPoss.away)g.otSuddenDeath=true;}
    LIVE_GAME_986.checkQuarter(g);return g;
  },

  // â•â•â• USE TIMEOUT â•â•â•
  useTimeout:function(g,who){
    if(g.timeouts[who]>0){
      g.timeouts[who]--;
      g.log.push("â¸ï¸ TIMEOUT "+who.toUpperCase()+" ("+g.timeouts[who]+" remaining)");
      g.pendingResult={type:"timeout",desc:"Timeout called. "+(who==="home"?g.homeTeam.abbr:g.awayTeam.abbr)+" has "+g.timeouts[who]+" remaining.",clock:0};
      g.lastPlay=g.pendingResult;
    }
    return g;
  },

  // â•â•â• BOX SCORE TRACKING â•â•â•
  updateBoxScore:function(g,result,side){
    if(!g.boxScore)g.boxScore={};
    var bs=g.boxScore;
    function ensure(name){if(!bs[name])bs[name]={comp:0,att:0,passYds:0,passTD:0,int:0,rushAtt:0,rushYds:0,rushTD:0,rec:0,recYds:0,recTD:0,sacks:0,pos:""};return bs[name];}
    var off=side==="home"?g.homeTeam:g.awayTeam;
    var qb=off.roster.find(function(p){return p.pos==="QB"&&p.isStarter;});
    var qbName=qb?qb.name:"QB";

    if(result.type==="complete"){
      var qbBS=ensure(qbName);qbBS.pos="QB";qbBS.att++;qbBS.comp++;qbBS.passYds+=result.yards;
      if(result.isTD)qbBS.passTD++;
      if(result.player){var recBS=ensure(result.player);recBS.rec++;recBS.recYds+=result.yards;if(result.isTD)recBS.recTD++;}
    }else if(result.type==="incomplete"){
      var qbBS2=ensure(qbName);qbBS2.pos="QB";qbBS2.att++;
    }else if(result.type==="interception"){
      var qbBS3=ensure(qbName);qbBS3.pos="QB";qbBS3.att++;qbBS3.int++;
    }else if(result.type==="sack"){
      var qbBS4=ensure(qbName);qbBS4.pos="QB";qbBS4.sacks++;
      if(result.player){var dlBS=ensure(result.player);dlBS.sacks++;dlBS.pos="DL";}
    }else if(result.type==="run"&&!result.isSpike){
      var runner=result.player||"RB";
      var rbBS=ensure(runner);rbBS.rushAtt++;rbBS.rushYds+=result.yards;
      if(result.isTD)rbBS.rushTD++;
      if(result.isScramble)rbBS.pos="QB";else rbBS.pos="RB";
    }
    // Update POTG
    LIVE_GAME_986.updatePOTG(g,result);
  },

  // â•â•â• PLAYER OF THE GAME TRACKING â•â•â•
  updatePOTG:function(g,result){
    if(!g.potgTracker)g.potgTracker={};
    var pt=g.potgTracker;
    function add(name,pts){if(!name)return;pt[name]=(pt[name]||0)+pts;}
    if(result.type==="complete"){add(result.passer||result.player,result.yards*0.1+(result.isTD?8:0)+(result.big?3:0));add(result.player,result.yards*0.08+(result.isTD?6:0));}
    if(result.type==="run"){add(result.player,result.yards*0.12+(result.isTD?8:0)+(result.big?4:0));}
    if(result.type==="interception"&&result.player){add(result.player,5);}
    if(result.type==="sack"&&result.player){add(result.player,3);}
  },

  // â•â•â• GET POTG â•â•â•
  getPOTG:function(g){
    if(!g.potgTracker)return null;
    var best=null,bestScore=0;
    Object.keys(g.potgTracker).forEach(function(name){
      if(g.potgTracker[name]>bestScore){bestScore=g.potgTracker[name];best=name;}
    });
    return best?{name:best,score:Math.round(bestScore)}:null;
  },

  // â•â•â• DRIVE SUMMARY â•â•â•
  startDrive:function(g){
    g.driveStart={fieldPos:g.fieldPos,clock:g.clock,quarter:g.quarter,plays:0,yards:0};
    g.driveSummary=null;
  },
  endDrive:function(g,result){
    if(!g.driveStart)return;
    var ds=g.driveStart;
    var plays=g.playNum;
    var yards=g.fieldPos-ds.fieldPos;
    var time=(ds.clock-g.clock)+((g.quarter-ds.quarter)*900);
    var timeStr=Math.floor(time/60)+":"+(("0"+(time%60)).slice(-2));
    g.driveSummary={plays:plays,yards:yards,time:timeStr,result:result};
    var _dmap994={td:"TD",fg:"FG",punt:"PUNT",safety:"SAFETY"};
    var _darr994=MFSN_DRIVES_994.drives[_dmap994[result]]||MFSN_DRIVES_994.drives.PUNT;
    g.driveComment994=_darr994&&_darr994.length?pick(_darr994):"";
    if(result==="td"&&MFSN_DRIVES_994.clutch){var _cln994=g.fieldPos>=95?MFSN_DRIVES_994.clutch.goalLine:g.fieldPos>=80?MFSN_DRIVES_994.clutch.redZone:null;if(_cln994&&_cln994.length)g.driveComment994=pick(_cln994);}
    if(g.quarter>=4){var _us994=g.userId===g.homeTeam.id?"home":"away";var _cs994=_us994==="home"?g.hScore:g.aScore;var _os994=_us994==="home"?g.aScore:g.hScore;if(_os994-_cs994>=10&&COMEBACK_994.slumpToBaller&&COMEBACK_994.slumpToBaller.length)g.log.push("ðŸ”¥ "+pick(COMEBACK_994.slumpToBaller));}
  },

  // â•â•â• PRE-SNAP READ â•â•â•
  generatePreSnap:function(g){
    var def=g.possession==="home"?g.awayTeam:g.homeTeam;
    var defOvr=0,cnt=0;
    def.roster.filter(function(p){return["DL","LB","CB","S"].indexOf(p.pos)>=0&&p.isStarter;}).forEach(function(p){defOvr+=p.ovr;cnt++;});
    defOvr=cnt>0?defOvr/cnt:65;

    var reads=[];
    // Situational reads
    if(g.down<=2&&g.yardsToGo>=7)reads.push("ðŸ” Defense is in a base look â€” could be zone or man");
    if(g.down===3&&g.yardsToGo<=3)reads.push("ðŸ” Short yardage â€” they're stacking the box! "+Math.floor(55+Math.random()*20)+"% run look");
    if(g.down===3&&g.yardsToGo>=8)reads.push("ðŸ” Obvious passing down â€” expect a nickel/dime package");
    if(g.fieldPos>=80)reads.push("ðŸ”´ Red zone â€” defense will tighten coverage");
    if(g.clock<=120&&(g.quarter===2||g.quarter===4))reads.push("â° 2-minute drill â€” watch for prevent defense");

    // Random formation hints
    var hints=["Showing two high safeties â€” could be Cover 2 or Cover 4",
      "Single high safety â€” possible Cover 1 or Cover 3",
      "Linebacker creeping toward the line â€” blitz alert!",
      "Nickel package â€” extra DB on the field",
      "Heavy front â€” 6 in the box, expecting the run",
      "Corners in press coverage â€” aggressive look",
      "Defense showing soft zone â€” cushion on the outside",
      "Extra rusher showing â€” could be a blitz or a spy"];
    reads.push("ðŸ‘ï¸ "+hints[Math.floor(Math.random()*hints.length)]);

    g.preSnapRead=reads[Math.floor(Math.random()*reads.length)];
    return g;
  },

  // â•â•â• NO-HUDDLE QB PLAY-CALLING â•â•â•
  noHuddleQBPick:function(g){
    var off=LIVE_GAME_986.offTeam(g);
    var qb=off.roster.find(function(p){return p.pos==="QB"&&p.isStarter&&!p._gameInjured;});
    if(!qb)qb=off.roster.find(function(p){return p.pos==="QB"&&!p._gameInjured;});
    var awareness=(qb&&qb.ratings&&qb.ratings.awareness)?qb.ratings.awareness:65;
    var isSmartQB=awareness>=75;

    // Gather all available plays
    var allPlays=[];
    ["run","short","deep","special"].forEach(function(cat){
      (PLAYBOOK_986.offense[cat]||[]).forEach(function(p){
        if(!p.is4thOnly||g.down===4)allPlays.push(p);
      });
    });
    // Include tricks if momentum >= 3 or 4th down
    if((g.momentum>=3||g.down===4)&&PLAYBOOK_986.offense.trick){
      PLAYBOOK_986.offense.trick.forEach(function(p){
        if(!p.is4thOnly||g.down===4)allPlays.push(p);
      });
    }

    var pick=null;var reason="";
    var scoreDiff=g.possession==="home"?(g.hScore-g.aScore):(g.aScore-g.hScore);

    if(isSmartQB){
      // Smart QB â€” reads the situation
      if(g.down<=2&&g.yardsToGo<=3){pick=allPlays.find(function(p){return p.id==="hb_dive"||p.id==="qb_sneak";});reason="Short yardage â€” ground game";}
      else if(g.down===3&&g.yardsToGo>=8){pick=allPlays.find(function(p){return p.id==="post"||p.id==="slant";});reason="Need a big chunk â€” going downfield";}
      else if(g.fieldPos>=85){pick=allPlays.find(function(p){return p.id==="slant"||p.id==="hb_dive";});reason="Red zone â€” high percentage";}
      else if(g.clock<=120&&(g.quarter===2||g.quarter===4)&&scoreDiff<0){pick=allPlays.find(function(p){return p.id==="go_route"||p.id==="post";});reason="Hurry-up â€” need a quick strike";}
      else if(scoreDiff>14&&g.quarter>=3){pick=allPlays.find(function(p){return p.type==="run";});reason="Protecting the lead â€” running clock";}
      else if(g.down===1){
        var r=Math.random();
        if(r<0.45){pick=allPlays.find(function(p){return p.type==="run";});reason="Setting up play-action";}
        else if(r<0.75){pick=allPlays.find(function(p){return p.id==="slant"||p.id==="curl";});reason="Timing route to move the chains";}
        else{pick=allPlays.find(function(p){return p.id==="play_action";});reason="Taking a shot with play-action";}
      }
      if(!pick){pick=allPlays[Math.floor(Math.random()*allPlays.length)];reason="Reading the defense";}
    }else{
      // Average/below QB â€” more random, occasional bad reads
      pick=allPlays[Math.floor(Math.random()*allPlays.length)];
      var reasons=["Checking the defense","Likes what he sees","Going with his gut","Trusting his arm",
        "Audibling based on the look","Reading the safety","Quick snap before they adjust"];
      reason=reasons[Math.floor(Math.random()*reasons.length)];
      // Bad QBs sometimes force deep shots or run into blitzes
      if(awareness<60&&Math.random()<0.15){
        pick=allPlays.find(function(p){return p.id==="go_route"||p.id==="hail_mary";});
        reason="Forcing a deep shot â€” risky read!";
      }
    }
    return{play:pick||allPlays[0],reason:reason,qbName:qb?qb.name:"QB",awareness:awareness};
  },

  // â•â•â• SMART AI PLAY-CALLING â•â•â•
  aiSmartOffPlay:function(g){
    var allRun=PLAYBOOK_986.offense.run;
    var allShort=PLAYBOOK_986.offense.shortPass;
    var allDeep=PLAYBOOK_986.offense.deepPass;
    var allSpec=PLAYBOOK_986.offense.special;
    var all=[].concat(allRun,allShort,allDeep);
    var rng=Math.random;
    var side=g.possession;
    var score=side==="home"?g.hScore-g.aScore:g.aScore-g.hScore;
    var late=g.quarter>=4&&g.clock<=300;
    var veryLate=g.quarter>=4&&g.clock<=120;

    // Winning late â†’ run heavy / kneel
    if(score>0&&veryLate&&score<=8){
      if(score>0&&g.clock<=80)return allSpec.find(function(p){return p.id==="kneel";})||allRun[0];
      return rng()<0.7?allRun[Math.floor(rng()*allRun.length)]:allShort[Math.floor(rng()*allShort.length)];
    }
    // Losing late â†’ hurry up / deep shots
    if(score<0&&late){
      if(score<-14)return rng()<0.5?allDeep[Math.floor(rng()*allDeep.length)]:allSpec.find(function(p){return p.id==="hurry_up";})||allDeep[0];
      return rng()<0.4?allDeep[Math.floor(rng()*allDeep.length)]:rng()<0.6?allShort[Math.floor(rng()*allShort.length)]:allSpec.find(function(p){return p.id==="hurry_up";})||allShort[0];
    }
    // Red zone â†’ conservative
    if(g.fieldPos>=80){
      return rng()<0.45?allRun[Math.floor(rng()*allRun.length)]:allShort[Math.floor(rng()*allShort.length)];
    }
    // Short yardage
    if(g.yardsToGo<=3&&g.down>=3){
      return rng()<0.6?allRun[Math.floor(rng()*allRun.length)]:allShort[Math.floor(rng()*allShort.length)];
    }
    // Default balanced
    return all[Math.floor(rng()*all.length)];
  },
  aiSmartDefPlay:function(g){
    var covs=PLAYBOOK_986.defense.coverage;
    var rng=Math.random;
    var side=g.possession;
    var score=side==="home"?g.hScore-g.aScore:g.aScore-g.hScore;// from offense perspective
    var late=g.quarter>=4&&g.clock<=300;

    // Offense losing late â†’ they'll throw deep â†’ prevent
    if(score<-8&&late)return rng()<0.5?covs.find(function(c){return c.id==="prevent";}):covs[Math.floor(rng()*covs.length)];
    // Red zone â†’ blitz or man
    if(g.fieldPos>=75)return rng()<0.4?covs.find(function(c){return c.id==="cover_0";}):covs.find(function(c){return c.id==="man_press";});
    // Short yardage â†’ stack the box (cover 0 or spy)
    if(g.yardsToGo<=3&&g.down>=3)return rng()<0.5?covs.find(function(c){return c.id==="cover_0";}):covs.find(function(c){return c.id==="spy";});
    // Obvious pass â†’ mix zone/blitz
    if(g.down===3&&g.yardsToGo>=8)return rng()<0.3?covs.find(function(c){return c.id==="cover_0";}):covs[Math.floor(rng()*covs.length)];
    // Default
    return covs[Math.floor(rng()*covs.length)];
  },

  // â•â•â• GENERATE OTHER SCORES (ticker) â•â•â•
  generateOtherScores:function(g,teams,sched,week){
    if(g.otherScores)return;
    var games=[];
    sched.forEach(function(s){
      if(s.week===week&&!(s.home===g.homeTeam.id&&s.away===g.awayTeam.id)){
        var hT=teams.find(function(t){return t.id===s.home;});
        var aT=teams.find(function(t){return t.id===s.away;});
        if(hT&&aT){
          var hS=Math.floor(Math.random()*7)*3+Math.floor(Math.random()*5)*7;
          var aS=Math.floor(Math.random()*7)*3+Math.floor(Math.random()*5)*7;
          hS=Math.max(0,Math.min(45,hS+Math.round((hT.ovr-aT.ovr)*0.2)));
          aS=Math.max(0,Math.min(45,aS-Math.round((hT.ovr-aT.ovr)*0.2)));
          games.push({homeAbbr:hT.abbr,awayAbbr:aT.abbr,homeEmoji:hT.emoji||"ðŸˆ",awayEmoji:aT.emoji||"ðŸˆ",
            hScore:hS,aScore:aS,quarter:4,status:"FINAL"});
        }
      }
    });
    g.otherScores=games;
  },

  // â•â•â• CROWD / ATMOSPHERE SYSTEM â•â•â•
  updateCrowd:function(g,result){
    // Crowd ranges from -10 (dead silent/away dominant) to +10 (deafening home crowd)
    if(g.crowd===undefined)g.crowd=3;// slight home advantage start
    var isHomePoss=g.possession==="home";
    // Scoring boosts
    if(result.isTD){g.crowd+=(isHomePoss?3:-4);}
    if(result.type==="fg_good"){g.crowd+=(isHomePoss?1:-2);}
    // Turnovers
    if(result.turnover){g.crowd+=(isHomePoss?-3:3);}
    // Big plays
    if(result.big){g.crowd+=(isHomePoss?1:-1);}
    // Sacks (defense excites crowd)
    if(result.type==="sack"){g.crowd+=(isHomePoss?-1:1);}
    // Natural decay toward 0
    g.crowd*=0.95;
    g.crowd=Math.max(-10,Math.min(10,Math.round(g.crowd*10)/10));
  },
  getCrowdLevel:function(g){
    var c=g.crowd||0;
    if(c>=7)return{label:"ðŸ“£ DEAFENING",color:"#ef4444",mod:2};
    if(c>=4)return{label:"ðŸ”Š LOUD",color:"#f59e0b",mod:1};
    if(c>=1)return{label:"ðŸ“¢ BUZZ",color:"#22c55e",mod:0.5};
    if(c>=-1)return{label:"ðŸ˜ QUIET",color:"#64748b",mod:0};
    if(c>=-4)return{label:"ðŸ¤« NERVOUS",color:"#94a3b8",mod:-0.5};
    return{label:"ðŸ”‡ SILENT",color:"#475569",mod:-1};
  },

  // â•â•â• COACH'S CHALLENGE â•â•â•
  challengePlay:function(g){
    if(!g.lastPlay||!g.lastPlay.turnover)return g;// can only challenge turnovers
    var userSideC=g.userId===g.homeTeam.id?"home":"away";
    if(g.timeouts[userSideC]<=0)return g;// need a timeout

    var overturned=Math.random()<0.40;
    if(overturned){
      // Overturn! Reverse the turnover â€” restore original possession and field position
      // Undo turnover stats
      var prevSide2=g.lastPlay._prevSide;
      if(prevSide2&&g.stats[prevSide2]){
        if(g.lastPlay.desc&&g.lastPlay.desc.indexOf("FUMBLE")>=0)g.stats[prevSide2].fumbles=Math.max(0,g.stats[prevSide2].fumbles-1);
        else g.stats[prevSide2].int=Math.max(0,g.stats[prevSide2].int-1);
      }
      g.possession=g.possession==="home"?"away":"home";
      g.fieldPos=g.lastPlay._prevFP||Math.max(1,Math.min(99,100-g.fieldPos));
      g.down=Math.max(1,(g.lastPlay._prevDown||1)+1);// advance the down (the play did happen)
      g.yardsToGo=g.lastPlay._prevYTG||10;
      g.driveNum--;
      g.pendingResult={type:"challenge_won",desc:"ðŸš© CHALLENGE SUCCESSFUL! The call is OVERTURNED! The turnover is reversed!",clock:0};
      g.log.push("ðŸš© CHALLENGE WON â€” play overturned!");
      g.lastPlay=g.pendingResult;
      g.challenged=true;
      LIVE_GAME_986.startDrive(g);
      g.phase="play_call";
    }else{
      // Challenge fails â€” lose a timeout
      g.timeouts[userSideC]--;
      g.pendingResult={type:"challenge_lost",desc:"ðŸš© CHALLENGE FAILS! The call stands. "+((g.userId===g.homeTeam.id)?g.homeTeam.abbr:g.awayTeam.abbr)+" loses a timeout.",clock:0};
      g.log.push("ðŸš© CHALLENGE FAILED â€” timeout lost");
      g.lastPlay=g.pendingResult;
      g.challenged=true;
    }
    return g;
  },

  // â•â•â• PLAY DIAGRAMS â€” Simple formation data for SVG rendering â•â•â•
  getPlayDiagram:function(playId){
    var diagrams={
      // Runs
      hb_dive:{routes:[{x:50,y:40,ex:50,ey:15,type:"run"}],label:"HB Dive",formation:"I"},
      hb_toss:{routes:[{x:50,y:40,ex:80,ey:25,type:"run"}],label:"HB Toss",formation:"I"},
      hb_counter:{routes:[{x:50,y:40,ex:30,ey:20,type:"run"},{x:50,y:40,ex:65,ey:35,type:"fake"}],label:"Counter",formation:"I"},
      hb_draw:{routes:[{x:50,y:40,ex:50,ey:18,type:"run"},{x:50,y:50,ex:50,ey:40,type:"fake"}],label:"Draw",formation:"SG"},
      qb_sneak:{routes:[{x:50,y:50,ex:50,ey:30,type:"run"}],label:"QB Sneak",formation:"I"},
      power_sweep:{routes:[{x:50,y:40,ex:20,ey:20,type:"run"}],label:"Power Sweep",formation:"I"},
      // Short passes
      slant:{routes:[{x:30,y:30,ex:50,ey:10,type:"route"},{x:70,y:30,ex:55,ey:15,type:"route"}],label:"Slant",formation:"SG"},
      curl:{routes:[{x:25,y:30,ex:25,ey:10,type:"route"},{x:75,y:30,ex:75,ey:12,type:"route"}],label:"Curl",formation:"SG"},
      screen:{routes:[{x:50,y:40,ex:25,ey:38,type:"route"},{x:35,y:35,ex:25,ey:30,type:"block"}],label:"Screen",formation:"SG"},
      flat:{routes:[{x:50,y:40,ex:25,ey:35,type:"route"}],label:"Check Down",formation:"SG"},
      te_drag:{routes:[{x:60,y:32,ex:30,ey:25,type:"route"}],label:"TE Drag",formation:"SG"},
      // Deep passes
      go_route:{routes:[{x:25,y:30,ex:25,ey:2,type:"route"},{x:75,y:30,ex:75,ey:5,type:"route"}],label:"Go Route",formation:"SG"},
      post:{routes:[{x:25,y:30,ex:45,ey:5,type:"route"},{x:75,y:30,ex:55,ey:8,type:"route"}],label:"Post",formation:"SG"},
      corner:{routes:[{x:30,y:30,ex:15,ey:5,type:"route"},{x:70,y:30,ex:85,ey:8,type:"route"}],label:"Corner",formation:"SG"},
      play_action:{routes:[{x:50,y:40,ex:50,ey:35,type:"fake"},{x:30,y:30,ex:40,ey:5,type:"route"}],label:"Play Action",formation:"I"},
      // Tricks
      flea_flicker:{routes:[{x:50,y:40,ex:50,ey:35,type:"fake"},{x:50,y:35,ex:50,ey:40,type:"run"},{x:25,y:30,ex:25,ey:3,type:"route"}],label:"Flea Flicker",formation:"I"},
      philly_special:{routes:[{x:50,y:50,ex:25,ey:35,type:"route"},{x:50,y:40,ex:60,ey:38,type:"run"}],label:"Philly Special",formation:"SG"}
    };
    return diagrams[playId]||null;
  },

  // â•â•â• QUARTER / HALF / GAME MANAGEMENT â•â•â•
  checkQuarter:function(g){
    if(g.clock<=0){
      if(g.quarter===2){
        g.quarter=3;g.clock=900;g.phase="halftime";g.twoMinWarned=false;
        // 2nd half: team that DIDN'T receive first now receives
        var firstReceiver=g.receivedFirst||"home";
        g.possession=(firstReceiver==="home")?"away":"home";// kicking team kicks
        // Actually the OTHER team receives, so the one who received first kicks
        // possession = kicking team, then kickoff resolves to give ball to other team
        g.possession=firstReceiver;// firstReceiver KICKS in 2nd half
        g.driveLog=[];g.driveNum++;
        g.log.push("â”€â”€ HALFTIME â”€â”€");
        // Reset half timeouts
        g.timeouts={home:3,away:3};
        return;
      }
      if(g.quarter===4){
        if(g.hScore===g.aScore){
          g.quarter=5;g.clock=600;g.isOT=true;g.twoMinWarned=false;
          g.noHuddle=false;g.noHuddlePlay=null;// reset no-huddle for OT
          g.log.push("â”€â”€ OVERTIME â”€â”€");
          if(MFSN_OVERTIME_994.situational.overtimeStart.length)g.log.push(pick(MFSN_OVERTIME_994.situational.overtimeStart));
          g.qtrs.h.push(0);g.qtrs.a.push(0);
          // OT coin toss â€” user receives
          var userHome=g.userId===g.homeTeam.id;
          g.possession=userHome?"away":"home";// opponent kicks
          g.phase="kickoff";g.kickType="normal";
          g.timeouts={home:2,away:2};
          return;
        }
        g.phase="postgame";g.log.push("â”€â”€ FINAL â”€â”€");return;
      }
      if(g.quarter>=5){g.phase="postgame";g.log.push("â”€â”€ FINAL â”€â”€");return;}
      g.quarter++;g.clock=900;
      g.log.push("â”€â”€ Q"+g.quarter+" â”€â”€");
    }
  }
};

function simGame(hT,aT,isPreseason,halftimeFx){
  var gG=function(t,pl){return t.roster.filter(function(p){return pl.indexOf(p.pos)>=0&&!(p.injury&&p.injury.games>0);});};
  var aiPickOffGP=function(t){
    if(t.isUser&&t.gameplanOff) return t.gameplanOff;
    var qbOvr=0;var rbOvr=0;var wrOvr=0;
    var qbs=gG(t,["QB"]);var rbs=gG(t,["RB"]);var wrs=gG(t,["WR","TE"]);
    if(qbs.length)qbOvr=qbs[0].ovr;if(rbs.length)rbOvr=rbs[0].ovr;
    if(wrs.length)wrOvr=Math.round(avg(wrs.slice(0,3),function(p){return p.ovr;}));
    if(qbOvr>=78&&wrOvr>=74) return "air_raid";
    if(rbOvr>=78&&qbOvr<72) return "ground_pound";
    if(qbOvr>=76&&rbOvr>=72) return "play_action";// Good at both
    if(qbOvr>=74) return "west_coast";
    if(RNG.play()<0.25) return pick(["balanced_o","air_raid","ground_pound","west_coast","play_action","hurry_up"]);
    return "balanced_o";
  };
  var aiPickDefGP=function(t){
    if(t.isUser&&t.gameplanDef) return t.gameplanDef;
    var dlOvr=0;var cbOvr=0;var lbOvr=0;
    var dls=gG(t,["DL","LB"]);var cbs=gG(t,["CB","S"]);var lbs=gG(t,["LB"]);
    if(dls.length)dlOvr=Math.round(avg(dls.slice(0,5),function(p){return p.ovr;}));
    if(cbs.length)cbOvr=Math.round(avg(cbs.slice(0,3),function(p){return p.ovr;}));
    if(lbs.length)lbOvr=Math.round(avg(lbs.slice(0,3),function(p){return p.ovr;}));
    if(dlOvr>=78&&cbOvr<70) return "blitz_heavy";// Great pass rush, weak secondary
    if(cbOvr>=78) return "man_press";// Elite corners
    if(dlOvr>=76&&lbOvr>=74) return "run_stuff";// Stout front
    if(cbOvr>=74&&dlOvr<72) return "zone_cov";// Good secondary, weak rush
    if(RNG.play()<0.25) return pick(["balanced_d","blitz_heavy","zone_cov","man_press","run_stuff"]);
    return "balanced_d";
  };
  var hOffId=aiPickOffGP(hT);var hDefId=aiPickDefGP(hT);
  var aOffId=aiPickOffGP(aT);var aDefId=aiPickDefGP(aT);
  var hOffGP=OFF_PLANS.find(function(g){return g.id===hOffId;})||OFF_PLANS[0];
  var hDefGP=DEF_PLANS.find(function(g){return g.id===hDefId;})||DEF_PLANS[0];
  var aOffGP=OFF_PLANS.find(function(g){return g.id===aOffId;})||OFF_PLANS[0];
  var aDefGP=DEF_PLANS.find(function(g){return g.id===aDefId;})||DEF_PLANS[0];
  var hFitCache86={},aFitCache86={};
  function fitCacheForTeam86(team){return team===hT?hFitCache86:aFitCache86;}
  function playerFitScore86(team,player){
    if(!player)return 60;
    var key86=player.id||player.name||"unknown";
    var cache86=fitCacheForTeam86(team);
    if(cache86[key86]===undefined)cache86[key86]=calcPlayerIdentityFit(player,team).score;
    return cache86[key86];
  }
  function avgFitScore86(team,players){
    var vals=(players||[]).filter(function(x){return !!x;});
    if(!vals.length)return 60;
    return vals.reduce(function(s,p){return s+playerFitScore86(team,p);},0)/vals.length;
  }
  var hOffBonus=(SCHEME_COUNTERS[hOffGP.id]||{})[aDefGP.id]||0;
  var aOffBonus=(SCHEME_COUNTERS[aOffGP.id]||{})[hDefGP.id]||0;
  var moraleMod=function(t){var m=avg(t.roster.filter(function(p){return !(p.injury&&p.injury.games>0);}),function(p){return p.morale||70;});return(m-70)*0.15;};
  var clutchCount=function(t){return t.roster.filter(function(p){return hasTrait95(p,"clutch")&&p.isStarter&&!(p.injury&&p.injury.games>0);}).length;};// v95.6: uses hasTrait95 â€” catches multi-trait clutch players
  var depthScore=function(t){
    var healthy=t.roster.filter(function(p){return !(p.injury&&p.injury.games>0);});
    var posCounts={};healthy.forEach(function(p){posCounts[p.pos]=(posCounts[p.pos]||0)+1;});
    var thin=0;
    if((posCounts.QB||0)<2)thin+=3;if((posCounts.OL||0)<5)thin+=(5-(posCounts.OL||0))*2;
    if((posCounts.WR||0)<3)thin+=2;if((posCounts.CB||0)<2)thin+=2;
    return -thin;// Penalty for thin depth
  };
  var archMod=function(t,phase){
    if(!t.staff)return 0;
    var coach=phase==="off"?t.staff.oc:t.staff.dc;
    var boosts=ARCH_BOOST[coach?coach.arch:""]||{};var total=0;
    Object.keys(boosts).map(function(k){return boosts[k];}).forEach(function(v){total+=v*0.3;});return total;
  };
  var filmBonus=function(t){return getFacilFx("film",t.facilities?t.facilities.film||0:0)*0.3;};
  var hTraitMods=getCoachTraitMods(hT),aTraitMods=getCoachTraitMods(aT);
  var coachTriggers={home:{},away:{}};
  function logTrigger(side,traitKey,effect){
    var t=side==="home"?coachTriggers.home:coachTriggers.away;
    if(!t[traitKey])t[traitKey]={effect:effect,count:0};
    t[traitKey].count++;
  }
  var calcM=function(o,d){return {pocket:unitR(gG(o,["OL"]),5,"passBlock")-unitR(gG(d,["DL","LB"]),5,"passRush")+((o===hT?hTraitMods:aTraitMods).pocketBoost||0)*20,
    windows:unitR(gG(o,["WR","TE"]),4,"routeRunning")-unitR(gG(d,["CB","S"]),4,"coverage"),
    runLanes:unitR(gG(o,["OL","TE"]),6,"runBlock")-unitR(gG(d,["DL","LB"]),7,"runStop"),
    olP:unitR(gG(o,["OL"]),5,"passBlock"),dlP:unitR(gG(d,["DL","LB"]),5,"passRush"),
    wrR:unitR(gG(o,["WR","TE"]),4,"routeRunning"),dbC:unitR(gG(d,["CB","S"]),4,"coverage"),
    olR:unitR(gG(o,["OL","TE"]),6,"runBlock"),dlR:unitR(gG(d,["DL","LB"]),7,"runStop")};};
  var hM=calcM(hT,aT),aM=calcM(aT,hT);
  var cMod=function(t,ph){var s=t.staff;if(!s||!s.oc||!s.hc||!s.dc)return 0;var ocR=s.oc.ratings||{};var hcR=s.hc.ratings||{};var dcR=s.dc.ratings||{};return ph==="off"?((ocR.gameplan||50)-50)*0.04+((hcR.strategy||50)-50)*0.03+archMod(t,"off")*0.5
    :((dcR.gameplan||50)-50)*0.04+((hcR.strategy||50)-50)*0.03+archMod(t,"def")*0.5;};
  var hC_base=cMod(hT,"off")+1+moraleMod(hT)*0.5;
  var aC_base=cMod(aT,"off")+moraleMod(aT)*0.5;
  if(!isPreseason){
    if(hT.isUser||aT.isUser){
      assertFitInvariants(hT,"simGame_home");
      assertFitInvariants(aT,"simGame_away");
    }
    var rivBonus=getRivalryBonus(hT,aT);
    hC_base+=HOME_FIELD_ADV+rivBonus.crowdMod+hOffBonus+depthScore(hT)*0.3+filmBonus(hT);
    aC_base+=aOffBonus+depthScore(aT)*0.3+filmBonus(aT);
    var hFit=calcTeamFit(hT),aFit=calcTeamFit(aT);
    hC_base+=(hFit.total-70)*0.06;// +1.8 for perfect 100 fit, -1.2 for poor 50 fit
    aC_base+=(aFit.total-70)*0.06;
    hC_base+=chemistryMod(hT);// -2 to +3 based on avg chemistry
    aC_base+=chemistryMod(aT);
    var hStreak=hT.streak||0;var aStreak=aT.streak||0;
    if(hStreak>=3)hC_base+=2;else if(hStreak>=2)hC_base+=1;
    if(hStreak<=-3)hC_base-=1.5;
    if(aStreak>=3)aC_base+=2;else if(aStreak>=2)aC_base+=1;
    if(aStreak<=-3)aC_base-=1.5;
    var hWinPct=(hT.wins||0)/Math.max(1,(hT.wins||0)+(hT.losses||0));
    var aWinPct=(aT.wins||0)/Math.max(1,(aT.wins||0)+(aT.losses||0));
    hC_base+=(hWinPct-0.5)*3;// +1.5 for 12-0, -1.5 for 0-12
    aC_base+=(aWinPct-0.5)*3;
    var parityMod=DNA_ACTIVE.parity||1.0;
    if(parityMod!==1.0){
      var midBase=(hC_base+aC_base)/2;
      hC_base=midBase+(hC_base-midBase)/parityMod;// Higher parity = closer to average
      aC_base=midBase+(aC_base-midBase)/parityMod;
    }
    if(hT.staff&&hT.staff.hc&&hT.staff.hc.formerTeam===aT.id)hC_base+=3;// Home HC knows away's schemes
    if(aT.staff&&aT.staff.hc&&aT.staff.hc.formerTeam===hT.id)aC_base+=3;// Away HC knows home's schemes
    var revengeInfo75=REVENGE_GAME.check(hT,aT,typeof rivalries!=="undefined"?rivalries:[]);
    var hRevBonus=REVENGE_GAME.getBonus(revengeInfo75,hT.id);
    var aRevBonus=REVENGE_GAME.getBonus(revengeInfo75,aT.id);
    hC_base+=hRevBonus*0.4;// Revenge game = up to +2 coaching edge
    aC_base+=aRevBonus*0.4;
    var hOcSpec=getSpecialtyBonus(hT,"off");
    var aOcSpec=getSpecialtyBonus(aT,"off");
    var hDcSpec=getSpecialtyBonus(hT,"def");
    var aDcSpec=getSpecialtyBonus(aT,"def");
    if(hOcSpec&&hOcSpec.effect)hC_base+=(hOcSpec.effect.passMod||0)*0.3+(hOcSpec.effect.rushMod||0)*0.2;
    if(aOcSpec&&aOcSpec.effect)aC_base+=(aOcSpec.effect.passMod||0)*0.3+(aOcSpec.effect.rushMod||0)*0.2;
  }
  if(typeof gamePlan77!=="undefined"&&gamePlan77&&(hT.isUser||aT.isUser)){
    var gpUser77=hT.isUser?hT:aT;
    var gpOpp77=hT.isUser?aT:hT;
    var oppOffTend=(gpOpp77.schemeOff||"balanced");
    var oppDefTend=(gpOpp77.schemeDef||"bend_dont_break");
    var gpBonus77=GAME_PLAN_OPTIONS.getBonus(gamePlan77.off||"balanced",gamePlan77.def||"bend_dont_break",oppOffTend,oppDefTend);
    if(hT.isUser)hC_base+=gpBonus77;
    else aC_base+=gpBonus77;
  }
  if(typeof frontOffice78!=="undefined"&&frontOffice78&&frontOffice78.length>0){
    var foBonus78=FRONT_OFFICE.getBonus(frontOffice78,"gameplan");
    if(hT.isUser)hC_base+=foBonus78;
    else if(aT.isUser)aC_base+=foBonus78;
  }
  var gameWeather=WEATHER.getConditions(hT.id,typeof season!=="undefined"?season.week||1:1,SEED_GLOBAL);
  var wxFx=WEATHER.getImpact(gameWeather);
  hC_base+=wxFx.passAccMod*8;// -0.8 for snow, -0.24 for rain
  aC_base+=wxFx.passAccMod*8;
  function drive(t,opp,m,cm,gp,ogp,driveNum,scoreDiff,qtrNum){
    var offMods=t===hT?hTraitMods:aTraitMods;
    var defMods=opp===hT?hTraitMods:aTraitMods;
    var offSide=t===hT?"home":"away";var defSide=opp===hT?"home":"away";
    var sfx73=(SCHEME_FX[gp.id]||{})[ogp.id]||{passMod:0,rushMod:0,blitzAdj:0,covAdj:0,bigPlayAdj:0,turnoverAdj:0};
    var qb=starters(t.roster,"QB")[0],rb=starters(t.roster,"RB")[0],wr=starters(t.roster,"WR")[0],wr2=starters(t.roster,"WR",2)[1],te=starters(t.roster,"TE")[0],k=starters(t.roster,"K")[0],punt=starters(t.roster,"P")[0];
    if(!qb) return {pts:0,type:"PUNT",d:"No QB available"};
    var defDL86=starters(opp.roster,"DL")[0]||starters(opp.roster,"LB")[0];
    var defLB86=starters(opp.roster,"LB")[0]||defDL86;
    var defCB86=starters(opp.roster,"CB")[0]||starters(opp.roster,"S")[0];
    var defS86=starters(opp.roster,"S")[0]||defCB86;
    var qbFit86=playerFitScore86(t,qb);
    var rbFit86=playerFitScore86(t,rb);
    var wrFit86=avgFitScore86(t,[wr,wr2,te]);
    var offSkillFit86=avgFitScore86(t,[qb,rb,wr,wr2,te]);
    var defFrontFit86=avgFitScore86(opp,[defDL86,defLB86]);
    var defBackFit86=avgFitScore86(opp,[defCB86,defS86]);
    var fitEdge86=((offSkillFit86-70)-(((defFrontFit86+defBackFit86)/2)-70));
    var revengeBoost=0;
    [qb,rb,wr,wr2,te].forEach(function(pl){
      if(pl&&pl.formerTeam&&pl.formerTeam===opp.id)revengeBoost+=1;
    });
    var isRedZone=RNG.play()<0.28;// v34: was 0.22, NFL red zone rate ~30%
    var isLate=driveNum>=9;
    var trailing=(scoreDiff||0)<0;
    var is4Q=(qtrNum===3);
    var isClose4Q=is4Q&&Math.abs(scoreDiff||0)<=7;
    var startYd=rng(15,40);if(RNG.play()<0.08)startYd=rng(40,65);
    var yardLine=startYd;
    var defCovMod=((ogp.covMod||0)+(sfx73.covAdj||0))*0.003;// v73: scheme FX coverage adjustment
    var stallChance=0.12-(cm*0.002)-(m.pocket>3?0.04:0)-(m.runLanes>3?0.04:0)+(ogp.blitz>0?0.03:0)+(sfx73.blitzAdj||0)*0.15+defCovMod*0.5-(offMods.stallReduction||0);// v73: scheme FX blitz adjustment
    var offSysFit=systemFitMod(t);// positive = good fit, negative = poor fit
    if(offSysFit<0)stallChance+=Math.abs(offSysFit)*1.5;// Low system knowledge â†’ more stalls
    else stallChance-=offSysFit*0.5;// High knowledge â†’ slightly fewer stalls
    stallChance-=cl((offSkillFit86-70)*0.0012,-0.03,0.03);// v86: better identity fit sustains drives
    var stallBase=0.12-(cm*0.002)-(m.pocket>3?0.04:0)-(m.runLanes>3?0.04:0)+(ogp.blitz>0?0.03:0)+defCovMod*0.5;
    if((offMods.stallReduction||0)>0){logTrigger(offSide,"stallReduction","Prevented stall");}
    if(RNG.play()<stallChance){
      var stallYds=rng(0,8);yardLine+=stallYds;
      var stallPlays=["3 & out â€” "+stallYds+"yds gained","Offense stalls after "+stallYds+"yds","Quick 3 & out","Goes nowhere â€” punt"];
      return {pts:0,type:"PUNT",d:pick(stallPlays),yds:stallYds,plays:3};
    }
    var rp=0.44+gp.rb+(m.runLanes>5?0.08:0)-(m.runLanes<-5?0.06:0)+(m.pocket<-5?0.04:0)-(ogp.runStopMod||0)*0.006;
    if(isLate&&trailing)rp-=0.10;
    var gsMult=calcGameScriptMult(0,-(scoreDiff||0),"RB","rb1");// positive scoreDiff = we're ahead
    if((scoreDiff||0)>=14)rp+=0.06;// Blowout lead â†’ ground and pound
    else if((scoreDiff||0)<=-14)rp-=0.06;// Down big â†’ pass game
    else if((scoreDiff||0)<=-7)rp-=0.03;// Down a score
    var fatiguePenalty=calcFatigueMultiplier(driveNum,12);// 12 drives = rough max
    var fatigueOvr=fatiguePenalty<1.0?-2:0;// -2 OVR equivalent in late game
    var clutchBoost=(isLate&&Math.abs(scoreDiff||0)<=10)?clutchCount(t)*1.5:0;
    if(qb&&isLate&&Math.abs(scoreDiff||0)<=10){
      var pressScalar=traitScalar(getPersonality(qb).pressure);
      clutchBoost+=cl(pressScalar*10,-12,12);
      if(typeof season!=="undefined"&&season&&season.phase==="playoffs")clutchBoost+=pressScalar*2;
    }
    var traitClutchSwing95=0;
    if(is4Q){
      [qb,rb,wr,wr2,te].forEach(function(pl){
        if(!pl)return;
        if(isClose4Q&&hasTrait95(pl,"stat_padder")){
          traitClutchSwing95+=((TRAIT_FX.stat_padder&&TRAIT_FX.stat_padder.clutch)||0)*0.35;
        }
        if(trailing&&hasTrait95(pl,"comeback_kid")){
          traitClutchSwing95+=((TRAIT_FX.comeback_kid&&TRAIT_FX.comeback_kid.clutch)||0)*0.22;
        }
        // v95.5: clutch trait â€” pure clutch performer bonus in 4Q
        if(is4Q&&hasTrait95(pl,"clutch")){
          var clutchPL95=(pl.traitPowerLevel95&&pl.traitPowerLevel95["clutch"])||0;
          traitClutchSwing95+=((TRAIT_FX.clutch&&TRAIT_FX.clutch.clutch)||0)*0.20*(1+clutchPL95*0.15);// v95.9: milestone power bonus
        }
        // v95.5: showtime â€” big-moment performer, smaller but real clutch bonus
        if(isClose4Q&&hasTrait95(pl,"showtime")){
          traitClutchSwing95+=((TRAIT_FX.showtime&&TRAIT_FX.showtime.clutch)||0)*0.15;
        }
        // v95.7: hothead â€” clutch PENALTY in pressure moments (undisciplined)
        if(is4Q&&hasTrait95(pl,"hothead")){
          traitClutchSwing95+=((TRAIT_FX.hothead&&TRAIT_FX.hothead.clutch)||0)*0.25;// -1 * 0.25 = -0.25 per hothead
        }
      });
      traitClutchSwing95=cl(traitClutchSwing95,-4,8);// v95.5: raised cap slightly for multi-clutch stacks
    }
    var clutchDefPenalty=0;
    if(isLate&&Math.abs(scoreDiff||0)<=10&&opp._clinicMods&&opp._clinicMods.clutchDefBoost){
      clutchDefPenalty=opp._clinicMods.clutchDefBoost*100;// ~3 point quality reduction for opponent
    }
    var dnaUpset=(DNA_ACTIVE.upsetChance||1.0);
    if(dnaUpset>1.0&&trailing)clutchBoost+=(dnaUpset-1.0)*4;// Trailing teams get extra chaos boost
    var dCS=(DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).clutchSwing;
    if(isLate&&dCS>0.4) clutchBoost+=rng(-Math.round(dCS*5),Math.round(dCS*4));
    // v95.4: Opponent Film Study scout spend â€” +5 clutch for user team in this week's game
    if(t.isUser&&t.opponentFilmWeek&&typeof season!=="undefined"&&t.opponentFilmWeek===season.week)clutchBoost+=5;
    if(isRedZone)rp+=0.04;
    if(htApplied&&htFx&&htFx.runRateMod&&t.isUser)rp+=htFx.runRateMod;// Run Heavy: more run plays
    var isPass=RNG.play()>rp;var pts=0,type="PUNT",d="";
    var totalYds=0;var numPlays=rng(4,9);
    var snapPlayers=[qb,rb,wr,wr2,te].filter(function(x){return !!x;});
    snapPlayers.forEach(function(sp){sp.stats.snaps=(sp.stats.snaps||0)+numPlays;});
    var ols70=starters(t.roster,"OL",5);
    var dl70=starters(opp.roster,"DL")[0]||starters(opp.roster,"LB")[0];
    if(isPass){
      var q=((qb.ratings.accuracy||50)+(qb.ratings.awareness||50))/3+cm*0.35+gp.pm+clutchBoost+sfx73.passMod+traitClutchSwing95;// v73: scheme FX pass modifier
      q+=(qbFit86-70)*0.05+(wrFit86-70)*0.03+fitEdge86*0.04;// v86: identity-fit edge
      var wrSep=wr?((wr.ratings.separation||50)-50):0;
      q+=wrSep*0.02;// separation boosts pass quality (Â±1.0 max)
      var teSep=te?((te.ratings.separation||50)-50):0;
      q+=teSep*0.01;// TE separation smaller impact
      var qbShort=(qb.ratings.shortAccuracy||50)-50;
      var qbDeep=(qb.ratings.deepAccuracy||50)-50;
      if(gp.id==="west_coast"||gp.id==="balanced_o"){q+=qbShort*0.015;}
      if(gp.id==="air_raid"||gp.id==="play_action"){q+=qbDeep*0.012;}
      var wrShort=wr?((wr.ratings.shortRoute||50)-50):0;
      var wrDeep=wr?((wr.ratings.deepRoute||50)-50):0;
      if(gp.id==="west_coast"){q+=wrShort*0.010;}
      if(gp.id==="air_raid"||gp.id==="play_action"){q+=wrDeep*0.010;}
      if(driveNum>=Math.max(10,12-(t.offGP&&t.offGP.tempoMod?1:0))&&Math.abs(scoreDiff)>=7){
        q+=((qb.ratings.fieldVision||50)-50)*0.010;
      }
      if(m.pocket<-3&&(qb.ratings.toughness||50)<80){
        q+=(((qb.ratings.throwOnRun||50)-50)-((qb.ratings.accuracy||50)-50))*0.010;
      }
      if(gp.id==="play_action"&&rb&&rb.ovr>=68){q+=3;d="Play-action!";}
      if(gp.id==="west_coast"){q+=1.5;}
      var pressureRoll=RNG.play();
      var pressureThresh=0.14+(ogp.blitz||0)*0.18+(sfx73.blitzAdj||0)+(m.pocket<-5?0.08:0)-(m.pocket>5?0.04:0)+(m.dlP>75?0.04:0)+(defMods.pressureBoost||0);// v73: scheme FX blitz modifier
      var olAnchor=avg(ols70,function(p){return p&&(p.ratings.anchorStrength||50);})||50;
      var olFinesse=avg(ols70,function(p){return p&&(p.ratings.passBlockFinesse||50);})||50;
      var olIQ=avg(ols70,function(p){return p&&(p.ratings.assignmentIQ||50);})||50;
      pressureThresh-=((qb.ratings.pocketPresence||50)-50)*0.0006;// up to ~3% fewer pressures
      if((ogp.blitz||0)>0){pressureThresh-=((olAnchor-50))*0.0005;}
      if(m.dlP>75){pressureThresh-=((olFinesse-50))*0.00045;}
      if(rb&&(ogp.blitz||0)>0){pressureThresh-=((rb.ratings.passProtection||50)-50)*0.0005;}
      pressureThresh-=((olIQ-50))*0.00025;
      if(dl70){
        var dlPow=(dl70.ratings.powerMoves||50);
        var dlFin=(dl70.ratings.finesseMoves||50);
        if(dlPow>olAnchor){pressureThresh+=((dlPow-olAnchor))*0.00035;}
        if(dlFin>olFinesse){pressureThresh+=((dlFin-olFinesse))*0.00030;}
        if(driveNum>=10){pressureThresh+=((dl70.ratings.motorEffort||50)-50)*0.00020;}
      }
      pressureThresh-=cl((qbFit86-70)*0.0007,-0.02,0.02);// v86: better fit handles pressure calls cleaner
      pressureThresh=cl(pressureThresh,0.03,0.28);
      if(opp._clinicMods&&opp._clinicMods.sackBoost&&ogp.id!=="balanced_d"){pressureThresh+=opp._clinicMods.sackBoost;}
      if(htApplied&&htFx){
        if(htFx.defPressureMod&&opp.isUser)pressureThresh+=htFx.defPressureMod;// Blitz More: user D pressures more
        if(htFx.offProtectMod&&t.isUser)pressureThresh-=htFx.offProtectMod;// Protect QB: user O protects better
      }
      if((defMods.pressureBoost||0)>0){logTrigger(defSide,"pressureBoost","Generated pressure");}
      if((offMods.pocketBoost||0)>0){logTrigger(offSide,"pocketBoost","Protected pocket");}
      if(pressureRoll<pressureThresh){
        if(RNG.play()<0.50){var dl=starters(opp.roster,"DL")[0]||starters(opp.roster,"LB")[0];if(dl)dl.stats.sacks++;
          var sackLoss=rng(5,12);qb.stats.sacksAllowed=(qb.stats.sacksAllowed||0)+1;
          return {pts:0,type:"SACK",d:BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.sack),
            {dl:dl?dl.name:"DL",qb:qb?qb.name:"QB",loss:sackLoss}),yds:-sackLoss,plays:numPlays};}
        else{q-=15;d="Hurry! ";}
      }
      if(m.pocket<-8){q-=6;d+="Pressure!";
      }else if(m.pocket>5){q+=3;d="Clean pocket.";}
      q+=m.windows*0.5;if(m.pocket<-3&&(qb.ratings.toughness||50)>=80){q+=2;d+=" Tough!";}
      q+=fatigueOvr;// v49: fatigue penalty in late drives      q-=(ogp.covMod||0)*0.3;
      if(ogp.id==="prevent")q-=4;
      var intProb=0.075-((qb.ratings.accuracy||50)-60)*0.0008-((qb.ratings.awareness||50)-60)*0.0006;
      intProb-=( (qb.ratings.decisionSpeed||50)-50 )*0.00035;
      var cb70=starters(opp.roster,"CB")[0]||starters(opp.roster,"S")[0];
      if(cb70){intProb+=((cb70.ratings.breakOnBall||50)-50)*0.00030;}
      if(gp.id==="west_coast")intProb-=0.015;
      if(ogp.id==="man_press")intProb+=0.02;
      if(ogp.blitz>0)intProb+=0.012;
      intProb+=(sfx73.turnoverAdj||0);// v73: scheme FX turnover adjustment
      if(m.pocket<-5)intProb+=0.015;
      intProb+=(defMods.intBoost||0);// Ball Hawks DC increases INTs
      intProb-=(offMods.intReduction||0);// Discipline reduces mistakes
      intProb-=(offMods.qbBoost||0)*0.001;// QB Whisperer helps decision-making
      if((defMods.intBoost||0)>0){logTrigger(defSide,"intBoost","Forced turnover opportunity");}
      if((offMods.intReduction||0)>0){logTrigger(offSide,"intReduction","Reduced mistake risk");}
      intProb-=systemFitMod(t);// High systemFit reduces INT chance
      intProb-=cl((qbFit86-70)*0.0009,-0.02,0.02);// v86: identity fit trims turnover risk
      if(htApplied&&htFx&&htFx.intAvoidMod&&t.isUser)intProb-=htFx.intAvoidMod;
      if(htApplied&&htFx&&htFx.intBoostMod&&opp.isUser)intProb+=htFx.intBoostMod;// Blitz More: force more turnovers
      intProb=Math.max(0.015,Math.min(0.16,intProb));
      if(RNG.play()<intProb){
        type="INT";totalYds=rng(5,25);numPlays=rng(2,6);
        if(qb)qb.stats.int++;var db=starters(opp.roster,"CB")[0]||starters(opp.roster,"S")[0];if(db)db.stats.defINT++;
        if(qb)qb.stats.passYds+=rng(3,18);
        d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.interception),
          {qb:qb?qb.name:"QB",db:db?db.name:"DB",plays:numPlays,yds:totalYds});
        return {pts:0,type:type,d:d,yds:totalYds,plays:numPlays};
      }
      var rollRng=RNG.play();
      var roll=rollRng*100+q+revengeBoost+(offMods.qbBoost||0)-clutchDefPenalty;// v38: QB Whisperer boost, v68: def2 clutch D
      var spec=wr?((wr.ratings.spectacularCatch||50)-50):0;
      if(spec>10&&roll>fgThresh-8&&roll<=fgThresh&&rollRng<0.18){roll+=spec*0.06;d+=" WOW!";}
      var cit=wr?((wr.ratings.catchInTraffic||50)-50):0;
      if(cit>0&&(wr?(wr.ratings.speed||50):50)<(m.dbC+5)){roll+=cit*0.05;}
      if(t._clinicMods&&t._clinicMods.scoringBoost&&gp.id!=="balanced_o"){roll+=t._clinicMods.scoringBoost*100;}
      if((offMods.qbBoost||0)>0){logTrigger(offSide,"qbBoost","QB decision boost");}
      var explosiveChance=0.10+(gp.bigPlayMod||0)+(ogp.bigPlayRisk||0)+(offMods.bigPlayBoost||0)+(defMods.bigPlayAllowed||0)+(sfx73.bigPlayAdj||0);// v73: scheme FX big play adjustment
      if(htApplied&&htFx){
        if(htFx.explosiveReduction&&t.isUser)explosiveChance-=htFx.explosiveReduction;// Protect QB: fewer big plays
        if(htFx.oppExplosiveMod&&opp.isUser)explosiveChance+=htFx.oppExplosiveMod;// Blitz More: opponent fewer explosives
      }
      var defSysFit=systemFitMod(opp);
      if(defSysFit<0)explosiveChance+=Math.abs(defSysFit)*1.5;// Poor system knowledge = blown coverages
      if((offMods.bigPlayBoost||0)>0){logTrigger(offSide,"bigPlayBoost","Big play opportunity");}
      if(gp.id==="play_action"&&ogp.id==="run_stuff")explosiveChance+=0.06;
      var explosive=(ogp.blitz||0)>0.05&&(wr?(wr.ratings.speed||50):50)>(m.dbC+10);
      var cov70=0;
      var db70=starters(opp.roster,ogp.id==="zone_cov"?"S":"CB")[0]||starters(opp.roster,"CB")[0]||starters(opp.roster,"S")[0];
      if(db70){
        if(ogp.id==="zone_cov"){cov70=((db70.ratings.zoneCoverage||50)-50);}
        if(ogp.id==="man_press"){cov70=((db70.ratings.manCoverage||50)-50);}
      }
      var s70=starters(opp.roster,"S")[0];
      var range70=s70?((s70.ratings.rangeAbility||50)-50):0;
      var pursuit70=dl70?((dl70.ratings.pursuit||50)-50):0;
      explosiveChance-=cov70*0.0008;
      explosiveChance-=range70*0.0007;
      explosiveChance-=pursuit70*0.0006;
      var routeDeepBonus=wr?((wr.ratings.deepRoute||50)-50):0;
      if(gp.id==="air_raid"||gp.id==="play_action"){explosiveChance+=routeDeepBonus*0.0007;}
      explosiveChance+=cl((wrFit86-defBackFit86)*0.0008,-0.03,0.03);// v86: receiver-group fit vs coverage fit
      explosiveChance=cl(explosiveChance,0.02,0.32);
      if(!explosive&&(gp.bigPlayMod||0)>=0.04&&(wr?(wr.ratings.speed||50):50)>75)explosive=true;
      if(explosive&&RNG.play()<explosiveChance){roll+=18;d+=" EXPLOSIVE!";}
      var tdThresh=isRedZone?(121-(offMods.rzTdBoost||0)):148;var fgThresh=isRedZone?92:113;
      if(isRedZone&&(offMods.rzTdBoost||0)>0){logTrigger(offSide,"rzTdBoost","Red zone boost");}
      var pickTarget=function(){
        var r3=RNG.play();
        if(r3<0.40) return wr;
        if(r3<0.65) return wr2||wr;
        if(r3<0.85) return te||wr;
        return rb||wr;
      };
      if(roll>tdThresh){pts=7;type="TD(Pass)";totalYds=100-startYd;numPlays=rng(5,12);
        var driveYds=rng(18,44);if(qb){qb.stats.passTD++;qb.stats.passYds+=driveYds;}
        var rc=pickTarget();
        var catchYds=rng(15,Math.max(25,Math.round(driveYds*0.8)));
        d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.passTD),
          {qb:qb?qb.name:"QB",wr:rc?rc.name:"WR",plays:numPlays,yds:totalYds});
        if(rc){rc.stats.recTD++;rc.stats.rec++;rc.stats.recYds+=catchYds;rc.stats.targets=(rc.stats.targets||0)+1;rc.stats.yac=(rc.stats.yac||0)+rng(2,12);}
        var sec=pickTarget();if(sec&&sec!==rc){sec.stats.targets=(sec.stats.targets||0)+rng(1,2);sec.stats.rec+=rng(0,1);sec.stats.recYds+=rng(0,18);}
      }else if(roll>fgThresh){totalYds=rng(30,55);numPlays=rng(6,11);
        var fgDist=100-startYd-totalYds+17;
        var fgMakeChance=k?(0.65+(k.ovr-60)*0.008-(fgDist>45?0.15:fgDist>35?0.05:0)):0.7;
        if(RNG.play()<fgMakeChance){
          pts=3;type="FG";
          d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.fgGood),
            {k:k?k.name:"K",dist:fgDist>0?fgDist:"?",plays:numPlays,yds:totalYds});
          if(k){k.stats.fgA++;k.stats.fgM++;}
        }else{
          type="FG_MISS";
          d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.fgMiss),
            {k:k?k.name:"K",dist:fgDist>0?fgDist:"?",plays:numPlays,yds:totalYds});
          if(k){k.stats.fgA++;}
        }
        if(qb)qb.stats.passYds+=rng(10,30);
        var recvr=pickTarget();if(recvr){recvr.stats.rec+=rng(1,3);recvr.stats.recYds+=rng(10,35);recvr.stats.targets=(recvr.stats.targets||0)+rng(1,3);}
      }else if(roll>116){totalYds=rng(18,42);numPlays=rng(5,10);
        d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.punt),{plays:numPlays,yds:totalYds});
        if(qb)qb.stats.passYds+=rng(9,24);
        var recvrs=[wr,wr2,te,rb].filter(function(x){return !!x;});
        recvrs.forEach(function(rv){if(RNG.play()<0.50){rv.stats.targets=(rv.stats.targets||0)+1;if(RNG.play()<0.60){rv.stats.rec++;rv.stats.recYds+=rng(5,22);}}});
      }else{totalYds=rng(8,30);numPlays=rng(4,8);
        d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.threeAndOut),{plays:numPlays,yds:totalYds});
        if(qb)qb.stats.passYds+=rng(4,13);
        var rv2=pickTarget();if(rv2){rv2.stats.targets=(rv2.stats.targets||0)+1;if(RNG.play()<0.50){rv2.stats.rec++;rv2.stats.recYds+=rng(3,16);}}}
    }else{
      var q2=((rb?(rb.ratings.speed||50):50)+(rb?(rb.ratings.elusiveness||50):50))/3+m.runLanes*0.8+cm*0.3+traitClutchSwing95;
      q2+=(rbFit86-70)*0.05+fitEdge86*0.03;// v86: run-game identity fit edge
      if(rb){q2+=((rb.ratings.ballCarrierVision||50)-50)*0.015;}
      if(rb&& (ogp.id==="zone_cov"||ogp.id==="run_stuff")){q2+=((rb.ratings.changeOfDirection||50)-50)*0.010;}
      var pullOL=avg(ols70,function(p){return p&&(p.ratings.pullBlock||50);})||50;
      if(gp.id==="ground_pound"||gp.id==="smashmouth"){q2+=((pullOL-50))*0.010;}
      if(dl70){q2-=((dl70.ratings.blockShedding||50)-50)*0.010;}
      q2+=fatigueOvr;// v49: fatigue penalty in late drives
      if(gp.id==="ground_pound")q2+=2;
      if(rb&&(rb.ratings.power||50)>=82&&m.runLanes>-3){q2+=2;}
      if(rb&&(rb.ratings.power||50)>=82&&m.runLanes>-3){q2+=((rb.ratings.truckPower||50)-50)*0.010;}
      q2-=(ogp.runStopMod||0)*0.4;
      q2+=(sfx73.rushMod||0);// v73: scheme FX rush modifier
      var bigPlayChance=rb?((rb.ratings.speed||50)>=85&&(rb.ratings.elusiveness||50)>=80?0.07:(rb.ratings.speed||50)>=78?0.04:0.015):0;
      if(rb){
        bigPlayChance+=((rb.ratings.acceleration||50)-50)*0.0006;
        if(dl70){bigPlayChance-=((dl70.ratings.pursuit||50)-50)*0.0005;}
        bigPlayChance+=cl((rbFit86-defFrontFit86)*0.0006,-0.02,0.02);// v86: fit amplifies/bottlenecks explosive runs
        bigPlayChance=cl(bigPlayChance,0.005,0.12);
      }
      if(RNG.play()<bigPlayChance){q2+=20;d="BREAKAWAY! ";}
      var roll2rng=RNG.play();
      var roll2=roll2rng*100+q2+revengeBoost-clutchDefPenalty;// v68: def2 clutch D penalty
      if(rb&&roll2>88&&roll2<=103){
        var bt=(rb.ratings.breakTackle||50)-50;
        if(bt>10&&roll2rng<0.22){roll2+=bt*0.10;d="BROKE A TACKLE! "+(d||"");}
      }
      if(t._clinicMods&&t._clinicMods.scoringBoost&&gp.id!=="balanced_o"){roll2+=t._clinicMods.scoringBoost*100;}
      if(roll2>138){pts=7;type="TD(Rush)";totalYds=100-startYd;numPlays=rng(6,14);
        var rushYdsGain=rng(11,36);
        d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.rushTD),
          {rb:rb?rb.name:"RB",plays:numPlays,yds:totalYds});
        if(rb){rb.stats.rushTD++;rb.stats.rushYds+=rushYdsGain;}
      }else if(roll2>110){totalYds=rng(25,47);numPlays=rng(7,13);
        var fgDist2=100-startYd-totalYds+17;
        var fgMakeChance2=k?(0.65+(k.ovr-60)*0.008-(fgDist2>45?0.15:fgDist2>35?0.05:0)):0.7;
        if(RNG.play()<fgMakeChance2){
          pts=3;type="FG";
          d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.fgGood),
            {k:k?k.name:"K",dist:fgDist2>0?fgDist2:"?",plays:numPlays,yds:totalYds});
          if(k){k.stats.fgA++;k.stats.fgM++;}
        }else{
          type="FG_MISS";
          d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.fgMiss),
            {k:k?k.name:"K",dist:fgDist2>0?fgDist2:"?",plays:numPlays,yds:totalYds});
          if(k){k.stats.fgA++;}
        }
        if(rb)rb.stats.rushYds+=rng(6,17);
      }else if(roll2>97){totalYds=rng(12,35);numPlays=rng(5,9);
        d=(rb?rb.name:"RB")+" grinds "+totalYds+"yds on "+numPlays+" carries â€” but can't punch it in. Punt.";
        if(rb)rb.stats.rushYds+=rng(3,9);
      }else{totalYds=rng(3,16);numPlays=rng(3,6);type="3OUT";
        d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.threeAndOut),{plays:numPlays,yds:totalYds});
        if(rb)rb.stats.rushYds+=rng(1,5);
        if(RNG.play()<0.10+(wxFx?wxFx.fumbleMod||0:0)){type="FUM";totalYds=rng(5,18);
          d=BROADCAST_COMMENTARY.fill986(BROADCAST_COMMENTARY.pick986(BROADCAST_COMMENTARY.pbp986.fumble),
            {rb:rb?rb.name:"RB",yds:totalYds})+(wxFx&&wxFx.fumbleMod>0?" (slippery conditions!)":"");
          if(rb)rb.stats.fumbles=(rb.stats.fumbles||0)+1;
          var dlF=starters(opp.roster,"DL")[0]||starters(opp.roster,"LB")[0];if(dlF)dlF.stats.tackles+=2;
        }
      }
      if(type!=="TD(Rush)"&&type!=="FMB"&&type!=="FUM"&&rb){
        var lb71=starters(opp.roster,"LB")[0];
        var fumbleForce=lb71?(lb71.ratings.hitPower||50):50;
        var fumbleProtect=rb?(rb.ratings.ballCarrierVision||50):50;
        var fumbleGap=fumbleForce-fumbleProtect;
        var wxFumbleMod=wxFx?wxFx.fumbleMod||0:0;// v73: snow +5%, cold +2%
        if(fumbleGap>10&&roll2rng<0.04+fumbleGap*0.001+wxFumbleMod){
          type="FMB";pts=0;
          totalYds=rng(8,28);numPlays=rng(3,9);
          d=(rb?rb.name:"RB")+" FUMBLES! Forced by "+(lb71?lb71.name:"LB")+"! "+totalYds+"yds";
          rb.stats.fumbles=(rb.stats.fumbles||0)+1;
          if(lb71)lb71.stats.tackles=(lb71.stats.tackles||0)+2;
          return {pts:0,type:type,d:d,yds:totalYds,plays:numPlays};
        }
      }
    }
    if((type==="PUNT"||type==="3OUT")&&punt){
      var puntDist=rng(35,55)+Math.round((punt.ratings.kickPower||50)*0.1);
      punt.stats.punts=(punt.stats.punts||0)+1;
      punt.stats.puntYds=(punt.stats.puntYds||0)+puntDist;
      punt.stats.snaps=(punt.stats.snaps||0)+1;
    }
    return {pts:pts,type:type,d:d,yds:totalYds,plays:numPlays};
  }
  var hS=0,aS=0,log=[];
  var preGameSnap={};
  [hT,aT].forEach(function(t){
    t.roster.forEach(function(p){
      preGameSnap[p.id]={
        passYds:p.stats.passYds||0,passTD:p.stats.passTD||0,int:p.stats.int||0,
        rushYds:p.stats.rushYds||0,rushTD:p.stats.rushTD||0,
        recYds:p.stats.recYds||0,recTD:p.stats.recTD||0,rec:p.stats.rec||0,
        sacks:p.stats.sacks||0,defINT:p.stats.defINT||0,tackles:p.stats.tackles||0
      };
    });
  });
  function gameStatDelta(p,field){return Math.max(0,(p.stats[field]||0)-(preGameSnap[p.id]?preGameSnap[p.id][field]||0:0));}
  var tempoExtra=Math.max(hOffGP.tempoMod||0,aOffGP.tempoMod||0);
  var DR=rng(11,13)+tempoExtra;// v16+v17: 12-14 base + tempo bonus
  var halfwayDrive=Math.floor(DR/2);
  var htFx=halftimeFx||null;// null if no adjustment selected
  var htApplied=false;// true once we've crossed halftime
  var captMomentLog=[];
  var captInfo=htFx&&htFx._captain?htFx._captain:null;
  var captRemaining=captInfo?captInfo.momentsLeft:0;
  var qtrs={h:[0,0,0,0],a:[0,0,0,0]};
  var hC=hC_base,aC=aC_base;
  var lastQtr=-1;
  for(var i=0;i<DR;i++){
    if(i>=halfwayDrive&&!htApplied&&htFx){
      htApplied=true;
      // v93.18: Look up the right strategy from the plans map based on actual score
      var htScoreDiff=hT.isUser?(hS-aS):(aS-hS);// positive = user winning
      var htMatchedCond=htScoreDiff<=-8?"losing_big":htScoreDiff<0?"losing_close":htScoreDiff===0?"tied":htScoreDiff<=7?"winning_close":"winning_big";
      var htPlansMap=htFx._htPlansMap||{};
      var htStratId=htPlansMap[htMatchedCond]||null;
      var htStrat=htStratId?HT_STRATEGIES.find(function(s){return s.id===htStratId;}):null;
      var fx=htStrat?assign({},htStrat.effect,{_id:htStrat.id,_label:htStrat.label,_cond:htMatchedCond}):{};
      var htScale=1.0;
      if(hT._clinicMods&&hT._clinicMods.halftimeBoost)htScale+=hT._clinicMods.halftimeBoost;
      if(fx.offProtectMod){hC+=fx.offProtectMod*4*htScale;}// Better pocket protection
      if(fx.runLaneBoost){hC+=fx.runLaneBoost*3*htScale;}// Run game boost
      if(fx.intAvoidMod){hC+=fx.intAvoidMod*2*htScale;}// Safer decisions
      if(fx.defPressureMod){aC-=fx.defPressureMod*3*htScale;}// More pressure hurts opponent
      if(fx.oppExplosiveMod){aC+=fx.oppExplosiveMod*3*htScale;}// Reduce opponent explosives
      if(fx.stallReduction){hC+=fx.stallReduction*3*htScale;}// User stalls less with defensive pressure
      if(fx.paceReduction&&DR>10){DR=Math.max(10,DR-1);}// Fewer drives = clock control
            if(htStrat){log.push("â”€â”€ âš¡ HALFTIME ADJ: "+htStrat.label+" ("+htMatchedCond+", "+htScoreDiff+"pts) â”€â”€");}
      else{log.push("â”€â”€ âš¡ HALFTIME: No plan set for "+htMatchedCond+" â”€â”€");}
    }
    var qtr=i<Math.floor(DR*0.25)?0:i<Math.floor(DR*0.5)?1:i<Math.floor(DR*0.75)?2:3;
    if(qtr!==lastQtr){log.push("â”€â”€ Q"+(qtr+1)+" â”€â”€");lastQtr=qtr;}
    var hD=drive(hT,aT,hM,hC,hOffGP,aDefGP,i,hS-aS,qtr);
    if(captInfo&&captRemaining>0&&i>=CAPTAIN_RULES.clutchDriveMin&&Math.abs(hS-aS)<=CAPTAIN_RULES.scoreDiffMax&&hT.isUser){
      if(RNG.play()<0.25){// 25% chance per eligible drive
        var cmType=CAPTAIN_MOMENT_TYPES[Math.floor(RNG.play()*CAPTAIN_MOMENT_TYPES.length)];
        if(cmType.fx.scoringBoost&&hD.pts===0){hD.pts=3;hD.type="FG";hD.d="â­ CAPTAIN "+captInfo.name+": "+cmType.desc+" â†’ "+hD.d;}
        else if(cmType.fx.intReduction&&hD.type==="INT"){hD.pts=0;hD.type="PUNT";hD.d="â­ CAPTAIN "+captInfo.name+": "+cmType.desc+" â€” INT avoided!";}
        else{hD.d="â­ CAPTAIN "+captInfo.name+" rallied! "+hD.d;}
        captMomentLog.push({week:typeof season!=="undefined"?season.week||0:0,type:cmType.id,label:cmType.label,emoji:cmType.emoji,
          text:captInfo.name+" ("+captInfo.pos+"): "+cmType.desc,drive:i});
        captRemaining--;
        log.push("â­ CAPTAIN MOMENT: "+captInfo.name+" â€” "+cmType.label+"!");
      }
    }
    hS+=hD.pts;qtrs.h[qtr]+=hD.pts;
    var hIcon=hD.pts===7?"ðŸˆ":hD.pts===3?"ðŸŽ¯":hD.type==="INT"?"ðŸ–ï¸":hD.type==="FUM"?"ðŸ’¨":hD.type==="SACK"?"ðŸ’¥":"ðŸ“‹";
    log.push(hIcon+" "+hT.abbr+": "+hD.d);
    var aD=drive(aT,hT,aM,aC,aOffGP,hDefGP,i,aS-hS,qtr);
    if(captInfo&&captRemaining>0&&i>=CAPTAIN_RULES.clutchDriveMin&&Math.abs(hS-aS)<=CAPTAIN_RULES.scoreDiffMax&&aT.isUser===false&&hT.isUser){
      if(aD.pts>0&&RNG.play()<0.18){// Defensive captain moment â€” stop a scoring drive
        var cmDef=CAPTAIN_MOMENT_TYPES[1];// big_stop
        aD.pts=0;aD.type="PUNT";aD.d="â­ CAPTAIN "+captInfo.name+": "+cmDef.desc+" â€” stopped the drive!";
        captMomentLog.push({week:typeof season!=="undefined"?season.week||0:0,type:cmDef.id,label:cmDef.label,emoji:cmDef.emoji,
          text:captInfo.name+": "+cmDef.desc,drive:i});
        captRemaining--;
        log.push("ðŸ›‘ CAPTAIN MOMENT: "+captInfo.name+" â€” Big Stop!");
      }
    }
    aS+=aD.pts;qtrs.a[qtr]+=aD.pts;
    var aIcon=aD.pts===7?"ðŸˆ":aD.pts===3?"ðŸŽ¯":aD.type==="INT"?"ðŸ–ï¸":aD.type==="FUM"?"ðŸ’¨":aD.type==="SACK"?"ðŸ’¥":"ðŸ“‹";
    log.push(aIcon+" "+aT.abbr+": "+aD.d);
  }
  if(hS===aS&&!isPreseason){
    log.push("â”€â”€ OT â”€â”€");
    qtrs.h.push(0);qtrs.a.push(0);
    var otDrives=rng(2,4);var hHad=false;var aHad=false;
    for(var oi=0;oi<otDrives;oi++){
      if(hS!==aS&&hHad&&aHad) break;// Both possessed, someone leads = done
      var oH=drive(hT,aT,hM,hC,hOffGP,aDefGP,DR+oi,hS-aS,4);hS+=oH.pts;qtrs.h[4]+=oH.pts;hHad=true;
      var ohI=oH.pts===7?"ðŸˆ":oH.pts===3?"ðŸŽ¯":oH.type==="INT"?"ðŸ–ï¸":oH.type==="FUM"?"ðŸ’¨":oH.type==="SACK"?"ðŸ’¥":"ðŸ“‹";
      log.push(ohI+" "+hT.abbr+": "+oH.d);
      if(hS!==aS&&hHad&&aHad) break;
      var oA=drive(aT,hT,aM,aC,aOffGP,hDefGP,DR+oi,aS-hS,4);aS+=oA.pts;qtrs.a[4]+=oA.pts;aHad=true;
      var oaI=oA.pts===7?"ðŸˆ":oA.pts===3?"ðŸŽ¯":oA.type==="INT"?"ðŸ–ï¸":oA.type==="FUM"?"ðŸ’¨":oA.type==="SACK"?"ðŸ’¥":"ðŸ“‹";
      log.push(oaI+" "+aT.abbr+": "+oA.d);
    }
    if(hS===aS){var coinW=RNG.play()<0.5;if(coinW)hS+=3;else aS+=3;log.push("âš¡ "+(coinW?hT.abbr:aT.abbr)+": Walk-off FG in OT!");}
  }
  [hT,aT].forEach(function(t){
    var defPlayers=t.roster.filter(function(p){return ["DL","LB","CB","S"].indexOf(p.pos)>=0&&!(p.injury&&p.injury.games>0);});
    defPlayers.forEach(function(p){
      if(p.isStarter){
        p.stats.tackles+=rng(2,8);
        if(p.pos==="DL"&&RNG.play()<0.10)p.stats.sacks+=1;
        if(p.pos==="LB"&&RNG.play()<0.06)p.stats.sacks+=1;
        if(p.pos==="LB"&&RNG.play()<0.03)p.stats.defINT++;
        if(p.pos==="CB"&&RNG.play()<0.05)p.stats.defINT++;
        if(p.pos==="S"&&RNG.play()<0.04)p.stats.defINT++;
      }else{
        p.stats.tackles+=rng(0,2);
      }
    });
  });
  [hT,aT].forEach(function(t){t.roster.filter(function(p){return !(p.injury&&p.injury.games>0);}).slice(0,46).forEach(function(p){p.stats.gp++;});});
  [hT,aT].forEach(function(t){var medLvl=t.facilities?t.facilities.med||0:0;
    var dS2=DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro;
    var injChance=(0.38-(medLvl*0.04))*dS2.injMod*(DNA_ACTIVE.injuryRate||1.0);// v53: DNA slider
    if(t.isUser&&halftimeFx&&halftimeFx._pracInjMod){injChance*=(1+halftimeFx._pracInjMod);}// Recovery=-10%, Dev=+8%
    if(RNG.injury()<injChance){
      var pool=(t.roster||[]).filter(function(p){return p&&!(p.injury&&p.injury.games>0)&&p.pos!=="K"&&p.pos!=="P";});
      if(pool.length===0)return;
      // v95.3: IRONMAN skips 60% of injury draws in simGame; v95.7: WORKHORSE skips 30%
      var eligPool95sg=pool.filter(function(p){
        if(hasTrait95(p,"ironman")&&RNG.injury()<0.60)return false;
        if(hasTrait95(p,"workhorse")&&RNG.injury()<0.30)return false;// v95.7: workhorse injury resistance
        return true;
      });
      if(eligPool95sg.length===0)eligPool95sg=pool;
      var glassPriority=eligPool95sg.filter(function(p){return hasTrait95(p,"glass");});
      var v=(glassPriority.length>0&&RNG.injury()<0.5)?pick(glassPriority):pick(eligPool95sg);
      if(v)setPlayerInjury92(v,pick(["hamstring","knee","ankle","shoulder","concussion"]),rng(1,hasTrait95(v,"glass")?8:hasTrait95(v,"ironman")?3:hasTrait95(v,"workhorse")?4:6));}});
  [hT,aT].forEach(function(t){
    var starters2=t.roster.filter(function(p){return p.isStarter&&!(p.injury&&p.injury.games>0)&&p.pos!=="K"&&p.pos!=="P";});
    starters2.forEach(function(p){
      var risk=calc4QInjuryRisk(p,DR);
      if(risk>0&&RNG.injury()<risk){
        setPlayerInjury92(p,pick(["4Q fatigue strain","4Q hamstring","4Q cramp","late-game knee"]),rng(1,hasTrait95(p,"glass")?6:3));
      }
    });
  });
  [hT,aT].forEach(function(t,ii){var won=ii===0?hS>aS:aS>hS;
    var dMM=(DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).moraleMod;
    var hasCaptainSgTeam=t.roster.some(function(x){return hasTrait95(x,"captain")&&!(x.injury&&x.injury.games>0);});
    var hasCancerSgTeam=t.roster.some(function(x){return hasTrait95(x,"cancer")&&!(x.injury&&x.injury.games>0);});
    var hasMentorSgTeam=t.roster.some(function(x){return hasTrait95(x,"mentor")&&!(x.injury&&x.injury.games>0);});
    var hasVocalLeaderSgTeam=false;
    var vlFloorSg95=45;
    (t.roster||[]).forEach(function(x){
      if(!(hasTrait95(x,"vocal_leader")&&x.isStarter&&!(x.injury&&x.injury.games>0)))return;
      hasVocalLeaderSgTeam=true;
      var vlPowerSg95=(x.traitPowerLevel95&&x.traitPowerLevel95["vocal_leader"])||0;
      if(vlPowerSg95>=2)vlFloorSg95=Math.max(vlFloorSg95,52);
      else if(vlPowerSg95>=1)vlFloorSg95=Math.max(vlFloorSg95,48);
    });
    t.roster.forEach(function(p){
      var md=won?rng(1,3):Math.round(rng(-4,-1)*dMM);
      getPlayerTraits95(p).forEach(function(tk){
        var fx95=TRAIT_FX[tk];
        if(fx95&&typeof fx95.morale==="number")md+=Math.round(fx95.morale*0.3);
      });// Personal trait effects (v95 multi-trait safe)
      if(hasTrait95(p,"comeback_kid")&&!won)md+=2;// v95.3 parity with weekly morale path
      if(hasTrait95(p,"hometown_hero")&&won)md+=1;
      if(hasCaptainSgTeam)md+=1;if(hasCancerSgTeam)md-=1;
      if(hasMentorSgTeam&&p.age<=24&&!won)md+=1;// mentor steadies young players after losses
      var tMods=ii===0?hTraitMods:aTraitMods;
      if(tMods.moraleBoost)md+=Math.round(tMods.moraleBoost*0.15);// PLAYER_COACH: steady lift
      if(tMods.moraleStability&&md<0)md=Math.round(md*(1-tMods.moraleStability));// DISCIPLINE: dampens drops
      var newMoraleSg=cl((p.morale||70)+md,30,99);
      // v95.7/v95.9: team-level vocal leader morale floor (uses highest active vocal_leader power)
      if(hasVocalLeaderSgTeam&&!won&&newMoraleSg<vlFloorSg95)newMoraleSg=vlFloorSg95;
      p.morale=newMoraleSg;});});
  [hT,aT].forEach(function(t){
    t.roster.filter(function(p){return !(p.injury&&p.injury.games>0);}).forEach(function(p){
      if(!p.stats)p.stats={gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0,fumbles:0,punts:0,puntYds:0};
      if(p.isStarter)p.stats.snaps+=(isPreseason?30:60);
      else p.stats.snaps+=(isPreseason?35:rng(2,10));
    });
  });
  [hT,aT].forEach(function(t){
    var wrs=starters(t.roster,"WR",3).concat(starters(t.roster,"TE",1));
    var ols=starters(t.roster,"OL",5);
    var passAttempts=rng(20,40);
    for(var pi=0;pi<passAttempts;pi++){
      var tgt=pick(wrs);if(!tgt)continue;
      if(!tgt.stats)continue;
      tgt.stats.targets=(tgt.stats.targets||0)+1;
      var catchChance=(tgt.ratings.catching||60)/100+0.15;
      if(RNG.play()>catchChance){tgt.stats.drops=(tgt.stats.drops||0)+1;}
      else{
        var yacVal=Math.round((tgt.ratings.speed||60)*0.08*RNG.play());
        tgt.stats.yac=(tgt.stats.yac||0)+yacVal;
      }
    }
    var sackChance=Math.max(0.02,0.12-(avg(ols,function(p){return p.ratings.passBlock||50;})/500));
    for(var si=0;si<passAttempts;si++){
      if(RNG.play()<sackChance){var lin=pick(ols);if(lin&&lin.stats)lin.stats.sacksAllowed=(lin.stats.sacksAllowed||0)+1;}
    }
  });
  if(!isPreseason){
    [hT,aT].forEach(function(t){
      t.roster.forEach(function(p){
        if(!p.gameLog)p.gameLog=[];
        var impact=0;
        if(p.pos==="QB")impact=(p.stats.passYds||0)/50+(p.stats.passTD||0)*3-(p.stats.int||0)*4;
        else if(p.pos==="RB")impact=(p.stats.rushYds||0)/30+(p.stats.rushTD||0)*3;
        else if(p.pos==="WR"||p.pos==="TE")impact=(p.stats.recYds||0)/25+(p.stats.recTD||0)*3;
        else if(POS_DEF[p.pos]&&POS_DEF[p.pos].side==="D")impact=(p.stats.tackles||0)*0.5+(p.stats.sacks||0)*3+(p.stats.defINT||0)*5;
        else if(p.pos==="K")impact=(p.stats.fgM||0)*3;
        else if(p.pos==="P")impact=(p.stats.punts||0)*0.5+((p.stats.punts>0?p.stats.puntYds/p.stats.punts:0)-38)*0.3;
        p.gameLog.push(Math.round(cl(impact,0,30)));
        if(p.gameLog.length>8)p.gameLog=p.gameLog.slice(-8);// Keep last 8 games
        var pffBase=55;
        var gp3=Math.max(1,p.stats.gp);
        if(p.pos==="QB"){
          var qbEff=((p.stats.passTD||0)*8-(p.stats.int||0)*12+(p.stats.passYds||0)/45+(p.stats.rushTD||0)*5)/gp3;
          pffBase=cl(48+qbEff*1.3,30,99);
        }else if(p.pos==="RB"){
          var rbEff=((p.stats.rushYds||0)/18+(p.stats.rushTD||0)*7+(p.stats.rec||0)*2-(p.stats.fumbles||0)*10)/gp3;
          pffBase=cl(46+rbEff*1.2,30,99);
        }else if(p.pos==="WR"||p.pos==="TE"){
          var wrEff=((p.stats.recYds||0)/16+(p.stats.recTD||0)*8+(p.stats.rec||0)*1.5-(p.stats.drops||0)*4)/gp3;
          pffBase=cl(46+wrEff*1.2,30,99);
        }else if(p.pos==="OL"){
          var olPen=(p.stats.sacksAllowed||0)*(-5);
          var olBase=p.ovr*0.8+(p.ratings.passBlock||50)*0.1+(p.ratings.runBlock||50)*0.1;
          pffBase=cl(olBase*0.75+olPen/gp3+rng(-4,4),30,99);
        }else if(["DL","LB"].indexOf(p.pos)>=0){
          var dlEff=((p.stats.sacks||0)*14+(p.stats.tackles||0)*1.5+(p.stats.defINT||0)*12)/gp3;
          pffBase=cl(44+dlEff*1.3,30,99);
        }else if(["CB","S"].indexOf(p.pos)>=0){
          var dbEff=((p.stats.defINT||0)*16+(p.stats.tackles||0)*1.3)/gp3;
          pffBase=cl(46+dbEff*1.2,30,99);
        }else if(p.pos==="K"){
          var kEff=(p.stats.fgM||0)*10/gp3;
          pffBase=cl(44+kEff*1.3,30,99);
        }else if(p.pos==="P"){
          var pAvg=p.stats.punts>0?(p.stats.puntYds/p.stats.punts):0;
          var pEff=(pAvg-38)*2.0+(p.stats.punts||0)*0.4;
          pffBase=cl(44+pEff/gp3*1.2,30,99);
        }
        var ovrAnchor=p.ovr>=90?85:p.ovr>=80?72:p.ovr>=70?62:p.ovr>=60?52:42;
        var consistency=p.gameLog.length>=3?(1-Math.abs(p.gameLog[p.gameLog.length-1]-(p.gameLog.reduce(function(a2,b2){return a2+b2;},0)/p.gameLog.length))/15):0;
        var pffGrade=Math.round(pffBase*0.50+ovrAnchor*0.30+(pffBase*cl(consistency,0,1))*0.10+rng(40,85)*0.10);
        pffGrade=cl(pffGrade+rng(-3,3),25,99);
        p.pffWeek=pffGrade;
        if(!p.pffHistory)p.pffHistory=[];
        p.pffHistory.push(pffGrade);
        if(p.pffHistory.length>17)p.pffHistory=p.pffHistory.slice(-17);
        p.pff=Math.round(p.pffHistory.reduce(function(a3,b3){return a3+b3;},0)/p.pffHistory.length);
      });
    });
  }
  var tape={home:{t:hT.abbr,s:hS,pocket:"OL"+Math.round(hM.olP)+"vDL"+Math.round(hM.dlP)+"("+(hM.pocket>0?"+":"")+Math.round(hM.pocket)+")",
    cov:"WR"+Math.round(hM.wrR)+"vDB"+Math.round(hM.dbC)+"("+(hM.windows>0?"+":"")+Math.round(hM.windows)+")",
    run:"OL"+Math.round(hM.olR)+"vDL"+Math.round(hM.dlR)+"("+(hM.runLanes>0?"+":"")+Math.round(hM.runLanes)+")"},
    away:{t:aT.abbr,s:aS,pocket:"OL"+Math.round(aM.olP)+"vDL"+Math.round(aM.dlP)+"("+(aM.pocket>0?"+":"")+Math.round(aM.pocket)+")",
    cov:"WR"+Math.round(aM.wrR)+"vDB"+Math.round(aM.dbC)+"("+(aM.windows>0?"+":"")+Math.round(aM.windows)+")",
    run:"OL"+Math.round(aM.olR)+"vDL"+Math.round(aM.dlR)+"("+(aM.runLanes>0?"+":"")+Math.round(aM.runLanes)+")"}};
  var buildRecap=function(t,opp,m,s,oS2,driveLog){
    var turnovers=driveLog.filter(function(d){return d.indexOf(t.abbr)>=0&&(d.indexOf("INT")>=0||d.indexOf("FUM")>=0);}).length;
    var oppTurnovers=driveLog.filter(function(d){return d.indexOf(opp.abbr)>=0&&(d.indexOf("INT")>=0||d.indexOf("FUM")>=0);}).length;
    var tds=driveLog.filter(function(d){return d.indexOf(t.abbr)>=0&&d.indexOf("TD")>=0;}).length;
    var pressureRate=Math.round(Math.max(0,Math.min(100,(50+m.pocket*2))));
    var coverageWin=Math.round(Math.max(0,Math.min(100,(50+m.windows*2))));
    var runLaneAdv=Math.round(Math.max(0,Math.min(100,(50+m.runLanes*2))));
    var rzEff=tds>0?Math.round(tds/(tds+1)*100):0;
    return {pressureRate:pressureRate,coverageWin:coverageWin,runLaneAdv:runLaneAdv,
      turnovers:turnovers,oppTurnovers:oppTurnovers,rzEff:rzEff,score:s,oppScore:oS2};
  };
  var homeRecap=buildRecap(hT,aT,hM,hS,aS,log);
  var awayRecap=buildRecap(aT,hT,aM,aS,hS,log);
  var hFitAvg=hT.roster.length>0?Math.round(hT.roster.reduce(function(s,p){return s+(p.systemFit||30);},0)/hT.roster.length):50;
  var aFitAvg=aT.roster.length>0?Math.round(aT.roster.reduce(function(s,p){return s+(p.systemFit||30);},0)/aT.roster.length):50;
  homeRecap.systemFitAvg=hFitAvg;awayRecap.systemFitAvg=aFitAvg;
  var recommend=function(rc,m){
    if(rc.pressureRate<35) return "Your OL is getting dominated. Upgrade pass protection or change to quick-release schemes.";
    if(rc.coverageWin<35) return "DBs are getting torched. Invest in secondary or switch to zone-heavy defense.";
    if(rc.runLaneAdv<35) return "Run game is dead. Upgrade OL run-blocking or add a power RB.";
    if(rc.turnovers>=2) return "Turnovers killed you. Bench turnover-prone players or protect the football with conservative playcalls.";
    if(rc.rzEff<30) return "Red zone offense is stalling. Add a big-bodied TE or use goal-line packages.";
    return "Solid performance across the board. Stay the course.";
  };
  homeRecap.fix=recommend(homeRecap,hM);
  awayRecap.fix=recommend(awayRecap,aM);
  var statLeaders=function(t){
    var qb=starters(t.roster,"QB")[0];var rb=starters(t.roster,"RB")[0];
    var wrs=t.roster.filter(function(p){return(p.pos==="WR"||p.pos==="TE")&&gameStatDelta(p,"rec")>0;})
      .sort(function(a,b){return gameStatDelta(b,"recYds")-gameStatDelta(a,"recYds");}).slice(0,3);
    var sackL=t.roster.filter(function(p){return gameStatDelta(p,"sacks")>0;})
      .sort(function(a,b){return gameStatDelta(b,"sacks")-gameStatDelta(a,"sacks");}).slice(0,2);
    var intL=t.roster.filter(function(p){return gameStatDelta(p,"defINT")>0;})
      .sort(function(a,b){return gameStatDelta(b,"defINT")-gameStatDelta(a,"defINT");}).slice(0,2);
    return {
      pass:qb?{name:qb.name,yds:gameStatDelta(qb,"passYds"),td:gameStatDelta(qb,"passTD"),int:gameStatDelta(qb,"int")}:null,
      rush:rb?{name:rb.name,yds:gameStatDelta(rb,"rushYds"),td:gameStatDelta(rb,"rushTD")}:null,
      rec:wrs.map(function(w){return {name:w.name,rec:gameStatDelta(w,"rec"),yds:gameStatDelta(w,"recYds"),td:gameStatDelta(w,"recTD")};}),
      sack:sackL.map(function(s2){return {name:s2.name,n:gameStatDelta(s2,"sacks")};}),
      ints:intL.map(function(d){return {name:d.name,n:gameStatDelta(d,"defINT")};})
    };
  };
  var buildBox=function(t,isH){
    var qb2=starters(t.roster,"QB")[0];var rb2=starters(t.roster,"RB")[0];
    var sks=t.roster.reduce(function(s2,p){return s2+(gameStatDelta(p,"sacks")||0);},0);
    var ints2=t.roster.filter(function(p){return p.pos==="QB";}).reduce(function(s2,p){return s2+(gameStatDelta(p,"int")||0);},0);
    var tds=log.filter(function(l){return l.indexOf(t.abbr)>=0&&l.indexOf("TD")>=0;}).length;
    var fgs=log.filter(function(l){return l.indexOf(t.abbr)>=0&&l.indexOf("FG")>=0;}).length;
    var sacked=log.filter(function(l){return l.indexOf(t.abbr)>=0&&l.indexOf("SACK")>=0;}).length;
    var punts=log.filter(function(l){return l.indexOf(t.abbr)>=0&&(l.indexOf("PUNT")>=0||l.indexOf("3OUT")>=0);}).length;
    return {passYds:qb2?gameStatDelta(qb2,"passYds"):0,passTD:qb2?gameStatDelta(qb2,"passTD"):0,int:qb2?gameStatDelta(qb2,"int"):0,
      rushYds:rb2?gameStatDelta(rb2,"rushYds"):0,rushTD:rb2?gameStatDelta(rb2,"rushTD"):0,
      sacks:sacked,fgM:fgs,punts:punts,totalTDs:tds,totalFGs:fgs,
      penalties:rng(3,10),penYds:rng(20,85),thirdDown:rng(8,15),thirdConv:rng(2,7),
      TOP:isH?rng(28,34):rng(26,32)};
  };
  var hBox=buildBox(hT,true);var aBox=buildBox(aT,false);
  var coachImpact={
    home:{traits:[],edge:Math.round((hC_base-aC_base)*10)/10},
    away:{traits:[],edge:Math.round((aC_base-hC_base)*10)/10}
  };
  [hT,aT].forEach(function(t,ii){
    var tm=ii===0?hTraitMods:aTraitMods;
    var side=ii===0?"home":"away";
    Object.keys(tm).forEach(function(k){if(tm[k]>0){
      coachImpact[side].traits.push({key:k,val:tm[k]});
    }});
  });
  return {home:hS,away:aS,log:log,tape:tape,homeId:hT.id,awayId:aT.id,
    recap:{home:homeRecap,away:awayRecap},
    qtrs:qtrs,box:{home:hBox,away:aBox},
    leaders:{home:statLeaders(hT),away:statLeaders(aT)},
    coachImpact:coachImpact,coachTriggers:coachTriggers,
    weather:gameWeather,// v61: Weather conditions
    halftime:htFx?{id:htFx._id||"unknown",label:htFx._label||"Adjustment",applied:htApplied}:null,// v63: Halftime adjustment
    captainMoments:captMomentLog.length>0?captMomentLog:null,// v64: Captain moments
    practiceFocus:htFx&&htFx._pracId?{id:htFx._pracId,label:htFx._pracLabel}:null,// v64: Practice focus
    gameplan:htFx?{off:htFx._planOff||null,def:htFx._planDef||null}:null};// v64: Gameplan Lab
}
var LEAGUE_AVG={pressureRate:55,rzEff:50,coverageWin:52,turnovers:1.5,runLane:50,systemFit:55};
function buildExplain3(result,isHome){
  var recap=result.recap?result.recap[isHome?"home":"away"]:null;
  var triggers=result.coachTriggers?result.coachTriggers[isHome?"home":"away"]:{};
  var oppTriggers=result.coachTriggers?result.coachTriggers[isHome?"away":"home"]:{};
  var myScore=isHome?result.home:result.away;
  var oppScore=isHome?result.away:result.home;
  var won=myScore>oppScore;
  var reasons=[];var fixMenus=[];
  if(!recap)return null;
  var ev=function(val,avg,unit){var d=val-avg;return " [yours: "+val+(unit||"")+", avg: "+avg+(unit||"")+", Î”"+(d>=0?"+":"")+d+"]";};
  if(recap.pressureRate!==undefined){
    if(recap.pressureRate>=55){
      reasons.push({icon:"ðŸ›¡ï¸",text:"Pocket held on "+recap.pressureRate+"% of dropbacks"+ev(recap.pressureRate,LEAGUE_AVG.pressureRate,"%")+(triggers.pocketBoost?" (Pass Pro Tech Ã—"+triggers.pocketBoost.count+")":"")});
    }else if(recap.pressureRate<40){
      reasons.push({icon:"ðŸ’¥",text:"Pocket collapsed â€” only "+recap.pressureRate+"% protection"+ev(recap.pressureRate,LEAGUE_AVG.pressureRate,"%")+(oppTriggers.pressureBoost?" (opp Blitz trait Ã—"+oppTriggers.pressureBoost.count+")":"")});
      fixMenus.push({label:"OL Collapse",options:[
        {text:"Upgrade OL starters (trade/FA for 75+ OVR)",action:null},
        {text:"Switch to Quick Pass gameplan",action:"quick_pass"},
        {text:"Increase run rate to neutralize pass rush",action:"run_more"}]});
    }
  }
  if(recap.rzEff!==undefined){
    if(recap.rzEff>=60){
      reasons.push({icon:"ðŸŽ¯",text:"Red zone converted at "+recap.rzEff+"%"+ev(recap.rzEff,LEAGUE_AVG.rzEff,"%")+(triggers.rzTdBoost?" (RZ Script Ã—"+triggers.rzTdBoost.count+")":"")});
    }else if(recap.rzEff<40){
      reasons.push({icon:"ðŸš«",text:"Red zone stalled at "+recap.rzEff+"% TD rate"+ev(recap.rzEff,LEAGUE_AVG.rzEff,"%")});
      fixMenus.push({label:"Red Zone",options:[
        {text:"Hire coach with Red Zone Script trait",action:null},
        {text:"Switch to Power Run gameplan",action:"power_run"},
        {text:"Target TE in red zone (upgrade TE OVR)",action:null}]});
    }
  }
  if(recap.turnovers!==undefined){
    if(recap.turnovers>=2){
      reasons.push({icon:"ðŸ¦‹",text:recap.turnovers+" turnovers killed drives"+ev(recap.turnovers,LEAGUE_AVG.turnovers,"")+(oppTriggers.intBoost?" (Ball Hawks Ã—"+oppTriggers.intBoost.count+")":"")});
      fixMenus.push({label:"Turnovers",options:[
        {text:"Hire coach with Discipline trait",action:null},
        {text:"Switch to Conservative gameplan",action:"conservative"},
        {text:"Keep scheme stable for 3+ weeks",action:null}]});
    }else if(recap.turnovers===0){
      reasons.push({icon:"âœ…",text:"Zero turnovers â€” clean execution"+ev(0,LEAGUE_AVG.turnovers,"")+(triggers.intReduction?" (Discipline Ã—"+triggers.intReduction.count+")":"")});
    }
  }
  if(recap.coverageWin!==undefined&&recap.coverageWin<40){
    reasons.push({icon:"ðŸ“¡",text:"Secondary exposed â€” only "+recap.coverageWin+"% coverage wins"+ev(recap.coverageWin,LEAGUE_AVG.coverageWin,"%")});
    fixMenus.push({label:"Coverage",options:[
      {text:"Upgrade CB/S starters (target 72+ OVR)",action:null},
      {text:"Switch to Zone defense",action:"zone_def"},
      {text:"Hire DC with Coverage Guru trait",action:null}]});
  }
  if(recap.runLaneAdv!==undefined&&recap.runLaneAdv>=60){
    reasons.push({icon:"ðŸƒ",text:"Run game dominated â€” "+recap.runLaneAdv+"% lane advantage"+ev(recap.runLaneAdv,LEAGUE_AVG.runLane,"%")});
  }
  if(triggers.stallReduction&&triggers.stallReduction.count>=3){
    reasons.push({icon:"ðŸ“‰",text:"Coaching prevented "+triggers.stallReduction.count+" stalls"});
  }
  if(recap.systemFitAvg!==undefined){
    if(recap.systemFitAvg<40){
      reasons.push({icon:"ðŸ§¬",text:"Low system knowledge ("+recap.systemFitAvg+"%)"+ev(recap.systemFitAvg,LEAGUE_AVG.systemFit,"%")+" â€” busted assignments"});
      fixMenus.push({label:"System Fit",options:[
        {text:"Keep current scheme stable for 3+ weeks",action:null},
        {text:"Avoid mid-season scheme changes",action:null},
        {text:"Sign veterans with higher systemFit",action:null}]});
    }else if(recap.systemFitAvg>=80){
      reasons.push({icon:"ðŸ§¬",text:"Elite system mastery ("+recap.systemFitAvg+"%)"+ev(recap.systemFitAvg,LEAGUE_AVG.systemFit,"%")+" â€” scheme continuity paying off"});
    }
  }
  reasons=reasons.slice(0,3);
  var fixHeadline;
  if(fixMenus.length>0){
    fixHeadline=fixMenus[0].options[0];
  }else{
    fixHeadline=won?"Keep current gameplan â€” execution was strong":"Review depth chart for matchup upgrades";
  }
  var fixText=fixHeadline&&typeof fixHeadline==="object"?fixHeadline.text:fixHeadline;
  return {reasons:reasons,fix:fixText,fixMenus:fixMenus,won:won,score:myScore+"-"+oppScore};
}
function buildPowerRanks(teams,sched){
  var played=sched.filter(function(g){return g.played&&g.result;});
  var rows=teams.map(function(t){
    var gp=Math.max(1,t.wins+t.losses);
    var winp=t.wins/gp;
    var pdpg=(t.pf-t.pa)/gp;var pd=Math.max(-1,Math.min(1,pdpg/14));
    var oppGames=played.filter(function(g){return g.home===t.id||g.away===t.id;});
    var sosSum=0;var sosN=0;
    oppGames.forEach(function(g){
      var oppId=g.home===t.id?g.away:g.home;
      var opp=teams.find(function(x){return x.id===oppId;});
      if(opp){var ogp=Math.max(1,opp.wins+opp.losses);sosSum+=opp.wins/ogp;sosN++;}
    });
    var sos=sosN>0?sosSum/sosN:0.5;
    var last3=played.filter(function(g){return g.home===t.id||g.away===t.id;}).slice(-3);
    var mom=0;
    last3.forEach(function(g){
      var isH=g.home===t.id;var my=isH?g.result.home:g.result.away;var opp2=isH?g.result.away:g.result.home;
      if(my>opp2)mom++;else if(my<opp2)mom--;
    });
    var score=winp*0.45+pd*0.20+sos*0.15+(mom/3)*0.10+Math.min(0.10,t.wins*0.01);
    return {id:t.id,abbr:t.abbr,icon:t.icon,name:t.city+" "+t.name,wins:t.wins,losses:t.losses,
      winp:winp,pdpg:Math.round(pdpg*10)/10,sos:Math.round(sos*100),mom:mom,score:Math.round(score*1000)/1000};
  });
  rows.sort(function(a,b){return b.score-a.score;});
  rows.forEach(function(r,i){r.rank=i+1;});
  return rows;
}
function findUpsetOfWeek(weekGames,powerRanks,teams){
  var rankById={};powerRanks.forEach(function(r){rankById[r.id]=r.rank;});
  var best=null;
  weekGames.forEach(function(g){
    if(!g.result)return;
    var winnerId=g.result.home>g.result.away?g.home:g.away;
    var loserId=winnerId===g.home?g.away:g.home;
    var wr=rankById[winnerId]||99;var lr=rankById[loserId]||99;
    var margin=Math.abs(g.result.home-g.result.away);
    var gap=lr-wr;// positive = upset (loser was ranked higher)
    if(gap>=4&&(margin>=7||gap>=8)){
      var weight=gap*10+margin;
      if(!best||weight>best.weight){
        var wt=teams.find(function(t){return t.id===winnerId;});
        var lt=teams.find(function(t){return t.id===loserId;});
        best={winnerId:winnerId,loserId:loserId,winnerAbbr:wt?wt.icon+wt.abbr:"?",loserAbbr:lt?lt.icon+lt.abbr:"?",
          margin:margin,gap:gap,weight:weight,score:(g.result.home>g.result.away?g.result.home+"-"+g.result.away:g.result.away+"-"+g.result.home)};
      }
    }
  });
  return best;
}
function pushTop(arr,obj,key,n){arr.push(obj);arr.sort(function(a,b){return(b[key]||0)-(a[key]||0);});if(arr.length>n)arr.pop();}
function updateLeagueLeaders(teams){
  var L={passYds:[],passTD:[],rushYds:[],rushTD:[],recYds:[],recTD:[],sacks:[],defINT:[],tackles:[],puntAvg:[]};
  teams.forEach(function(t){(t.roster||[]).forEach(function(p){
    var s=p.stats||{};
    pushTop(L.passYds,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:s.passYds||0},"val",5);
    pushTop(L.passTD,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:s.passTD||0},"val",5);
    pushTop(L.rushYds,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:s.rushYds||0},"val",5);
    pushTop(L.rushTD,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:s.rushTD||0},"val",5);
    pushTop(L.recYds,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:s.recYds||0},"val",5);
    pushTop(L.recTD,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:s.recTD||0},"val",5);
    pushTop(L.sacks,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:s.sacks||0},"val",5);
    pushTop(L.defINT,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:s.defINT||0},"val",5);
    pushTop(L.tackles,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:s.tackles||0},"val",5);
    if(p.pos==="P"&&(s.punts||0)>0){pushTop(L.puntAvg,{pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,val:Math.round(s.puntYds/s.punts*10)/10},"val",5);}
  });});
  return L;
}
function buildAwardRaces(teams){
  var races={mvp:[],opoy:[],dpoy:[],roy:[],coty:[]};
  teams.forEach(function(t){
    var gp=Math.max(1,t.wins+t.losses);var winp=t.wins/gp;
    var teamMod=0.80+0.40*winp;
    (t.roster||[]).forEach(function(p){
      var s=p.stats||{};var side=POS_DEF[p.pos]?POS_DEF[p.pos].side:"O";
      var pffBonus=(p.pff||60)-60;
      var offScore=((s.passYds||0)/45+(s.passTD||0)*9+(s.rushYds||0)/22+(s.rushTD||0)*9+(s.recYds||0)/25+(s.recTD||0)*9+pffBonus*0.25+p.ovr*0.1)*teamMod;
      var defScore=((s.tackles||0)*2.5+(s.sacks||0)*14+(s.defINT||0)*18+pffBonus*0.25+p.ovr*0.1)*teamMod;
      var entry={pid:p.id,name:p.name,pos:p.pos,team:t.abbr,icon:t.icon,ovr:p.ovr,pff:p.pff||0};
      if(side==="O"){
        var mvpMult=p.pos==="QB"?1.25:1.0;
        pushTop(races.mvp,assign({},entry,{score:Math.round(offScore*mvpMult)}),"score",5);
        if(p.pos!=="QB"){
          pushTop(races.opoy,assign({},entry,{score:Math.round(offScore)}),"score",5);
        }
      }else if(side==="D"){
        pushTop(races.mvp,assign({},entry,{score:Math.round(defScore*0.7)}),"score",5);// Defense rarely wins MVP
        pushTop(races.dpoy,assign({},entry,{score:Math.round(defScore)}),"score",5);
      }
      if(p.age<=23){
        var rookScore=side==="O"?Math.round(offScore):Math.round(defScore);
        pushTop(races.roy,assign({},entry,{score:rookScore}),"score",5);
      }
    });
    var avgOvr=t.roster.reduce(function(s2,p){return s2+p.ovr;},0)/Math.max(1,t.roster.length);
    var expected=avgOvr/5;// rough expected wins from talent
    var overperformance=t.wins-expected;
    pushTop(races.coty,{name:t.staff.hc.name,team:t.abbr,icon:t.icon,score:Math.round(overperformance*10+t.wins*2)},"score",5);
  });
  return races;
}
function generateGameKeys(result,homeTeam,awayTeam){
  var hr=result.recap?result.recap.home:{};var ar=result.recap?result.recap.away:{};
  var metrics=[
    {label:"Pocket Protection",homeVal:hr.pressureRate||50,awayVal:ar.pressureRate||50,scale:25,higherWins:true},
    {label:"Coverage Battle",homeVal:hr.coverageWin||50,awayVal:ar.coverageWin||50,scale:25,higherWins:true},
    {label:"Run Game",homeVal:hr.runLaneAdv||50,awayVal:ar.runLaneAdv||50,scale:25,higherWins:true},
    {label:"Turnovers",homeVal:hr.turnovers||0,awayVal:ar.turnovers||0,scale:2,higherWins:false},
    {label:"Red Zone Efficiency",homeVal:hr.rzEff||0,awayVal:ar.rzEff||0,scale:50,higherWins:true}
  ];
  metrics.forEach(function(m){
    m.gap=Math.abs(m.homeVal-m.awayVal)/(m.scale||1);
    m.winner=m.higherWins?(m.homeVal>m.awayVal?"home":m.awayVal>m.homeVal?"away":"tie"):(m.homeVal<m.awayVal?"home":m.awayVal<m.homeVal?"away":"tie");
  });
  metrics.sort(function(a,b){return b.gap-a.gap;});
  var keys=metrics.slice(0,3).map(function(m){return{label:m.label,homeVal:m.homeVal,awayVal:m.awayVal,winner:m.winner};});
  var tp={quarter:2,desc:"Second-quarter swing decided the tone."};
  if(result.qtrs&&result.qtrs.h&&result.qtrs.a){
    var bestQ=1,bestDiff=0;
    for(var qi=0;qi<Math.min(result.qtrs.h.length,result.qtrs.a.length);qi++){
      var d=Math.abs((result.qtrs.h[qi]||0)-(result.qtrs.a[qi]||0));
      if(d>bestDiff){bestDiff=d;bestQ=qi+1;}
    }
    tp={quarter:bestQ,desc:"Q"+bestQ+" was the decisive quarter ("+bestDiff+" pt swing)."};
  }
  var pog={name:"",pos:"",stat:"",reason:""};
  if(result.leaders){
    var candidates=[];
    var addC=function(side,team){
      var l=result.leaders[side];if(!l)return;
      if(l.pass)candidates.push({name:l.pass.name,pos:"QB",stat:l.pass.yds+"yds/"+l.pass.td+"TD",score:(l.pass.yds||0)/10+(l.pass.td||0)*15,team:team});
      if(l.rush)candidates.push({name:l.rush.name,pos:"RB",stat:l.rush.yds+"yds/"+l.rush.td+"TD",score:(l.rush.yds||0)/5+(l.rush.td||0)*12,team:team});
      if(l.rec&&l.rec[0])candidates.push({name:l.rec[0].name,pos:"WR",stat:l.rec[0].rec+"rec/"+l.rec[0].yds+"yds",score:(l.rec[0].yds||0)/5+(l.rec[0].td||0)*12,team:team});
      if(l.sack&&l.sack[0])candidates.push({name:l.sack[0].name,pos:"DL",stat:l.sack[0].n+"sacks",score:(l.sack[0].n||0)*20,team:team});
    };
    addC("home",homeTeam.abbr);addC("away",awayTeam.abbr);
    candidates.sort(function(a,b){return b.score-a.score;});
    if(candidates[0]){var c=candidates[0];pog={name:c.name,pos:c.pos,stat:c.stat,reason:c.team+" star carried the day."};}
  }
  return{keys:keys,turningPoint:tp,playerOfGame:pog};
}
function generateWeekShow(teams,sched,season){
  var week=season.week;var year=season.year;
  var weekGames=sched.filter(function(g){return g.week===week&&g.played&&g.result;});
  var pr=buildPowerRanks(teams,sched);
  var upset=findUpsetOfWeek(weekGames,pr,teams);
  var leaders=updateLeagueLeaders(teams);
  var awards=buildAwardRaces(teams);
  var hotSeat=[];
  teams.forEach(function(t){
    if((t.ownerMood||70)<50){
      hotSeat.push({teamId:t.id,abbr:t.abbr,icon:t.icon,coach:t.staff?t.staff.hc.name:"Coach",mood:t.ownerMood||50,
        risk:(t.ownerMood||70)<30?"CRITICAL":(t.ownerMood||70)<40?"HOT":"WARM"});
    }
  });
  hotSeat.sort(function(a,b){return a.mood-b.mood;});
  var gotw=null;
  if(weekGames.length>0){
    var closest=weekGames.slice().sort(function(a,b){return Math.abs(a.result.home-a.result.away)-Math.abs(b.result.home-b.result.away);})[0];
    var hT2=teams.find(function(t){return t.id===closest.home;});
    var aT2=teams.find(function(t){return t.id===closest.away;});
    if(hT2&&aT2)gotw={homeAbbr:hT2.icon+hT2.abbr,awayAbbr:aT2.icon+aT2.abbr,score:closest.result.home+"-"+closest.result.away,
      margin:Math.abs(closest.result.home-closest.result.away)};
  }
  var headlines=[];
  if(pr[0])headlines.push("ðŸ† "+pr[0].icon+pr[0].abbr+" holds #1 Power Ranking ("+pr[0].wins+"-"+pr[0].losses+")");
  if(upset)headlines.push("ðŸ˜± UPSET! "+upset.winnerAbbr+" stuns "+upset.loserAbbr+" ("+upset.score+")");
  if(hotSeat[0])headlines.push("ðŸ”¥ "+hotSeat[0].icon+hotSeat[0].abbr+" HC "+hotSeat[0].coach+" on the HOT SEAT (Mood: "+hotSeat[0].mood+")");
  if(leaders.passYds[0]&&leaders.passYds[0].val>0)headlines.push("ðŸ“Š Passing leader: "+leaders.passYds[0].name+" ("+leaders.passYds[0].val+" yds)");
  if(leaders.rushYds[0]&&leaders.rushYds[0].val>0)headlines.push("ðŸƒ Rushing leader: "+leaders.rushYds[0].name+" ("+leaders.rushYds[0].val+" yds)");
  if(awards.mvp[0])headlines.push("ðŸ… MVP Race: "+awards.mvp[0].name+" ("+awards.mvp[0].pos+", "+awards.mvp[0].team+")");
  teams.forEach(function(t){(t.roster||[]).forEach(function(p){
    var s=p.stats||{};
    if((s.passYds||0)>=4000)headlines.push("ðŸŽ¯ "+p.name+" ("+t.abbr+") 4,000+ passing yards!");
    else if((s.passYds||0)>=3000)headlines.push("ðŸ“ˆ "+p.name+" ("+t.abbr+") cracks 3,000 passing yards");
    if((s.rushYds||0)>=1500)headlines.push("ðŸ’ª "+p.name+" ("+t.abbr+") 1,500+ rushing yards!");
    else if((s.rushYds||0)>=1000)headlines.push("ðŸƒ "+p.name+" ("+t.abbr+") joins 1,000 yard rushing club");
    if((s.sacks||0)>=15)headlines.push("ðŸ’€ "+p.name+" ("+t.abbr+") terrorizing QBs with "+s.sacks+" sacks!");
  });});
  // ARC_SPOTLIGHT: inject arc-aware analyst lines for user's team
  var myTeam=teams.find(function(t){return t.isUser;});
  var arcSpots=[];
  if(myTeam&&myTeam.roster){
    var myGame=weekGames.find(function(g){return g.home===myTeam.id||g.away===myTeam.id;});
    var myWon=myGame&&myGame.result?(myGame.home===myTeam.id?myGame.result.home>myGame.result.away:myGame.result.away>myGame.result.home):false;
    arcSpots=ARC_SPOTLIGHT.generate(myTeam.roster,myWon,week,myTeam);
    // Also inject arc headlines into the ticker
    arcSpots.forEach(function(sp){
      headlines.push((sp.badge||sp.arcKey)+" | "+sp.playerName+": \u201C"+sp.line.substring(0,60)+(sp.line.length>60?"\u2026":"")+"\u201D");
    });
  }
  return{week:week,year:year,powerRanks:pr.slice(0,12),upset:upset,gotw:gotw,hotSeat:hotSeat.slice(0,3),
    leaders:leaders,awards:awards,headlines:headlines.slice(0,10),arcSpots:arcSpots};
}
function genWeeklyWrap(teams,week,sched){
  var wg=sched.filter(function(g){return g.week===week&&g.played&&g.result;});var wrap=[];
  if(wg.length){var closest=wg.slice().sort(function(a,b){return Math.abs(a.result.home-a.result.away)-Math.abs(b.result.home-b.result.away);})[0];
    if(closest&&closest.result){var diff=Math.abs(closest.result.home-closest.result.away);
      var h2=teams.find(function(t){return t.id===closest.home;}),a2=teams.find(function(t){return t.id===closest.away;});
      if(diff<=6)wrap.push("ðŸŽ® GOTW: "+(h2?h2.icon+h2.abbr:"")+" "+closest.result.home+"-"+closest.result.away+" "+(a2?a2.icon+a2.abbr:""));}}
  var all=teams.reduce(function(acc,t){return acc.concat(t.roster.map(function(p){return assign({},p,{tA:t.abbr});}));},[]);
  var topQB=all.filter(function(p){return p.pos==="QB";}).sort(function(a,b){return b.stats.passYds-a.stats.passYds;})[0];
  var topRB=all.filter(function(p){return p.pos==="RB";}).sort(function(a,b){return b.stats.rushYds-a.stats.rushYds;})[0];
  var topSK=all.filter(function(p){return p.stats.sacks>0;}).sort(function(a,b){return b.stats.sacks-a.stats.sacks;})[0];
  if(topQB)wrap.push("ðŸˆ Pass: "+topQB.name+"("+topQB.tA+") "+topQB.stats.passYds+"yds");
  if(topRB)wrap.push("ðŸƒ Rush: "+topRB.name+"("+topRB.tA+") "+topRB.stats.rushYds+"yds");
  if(topSK)wrap.push("ðŸ’¥ Sacks: "+topSK.name+"("+topSK.tA+") "+topSK.stats.sacks);
  var ranked=teams.slice().sort(function(a,b){return(b.wins*10+b.pf-b.pa+(b.prestige||50))-(a.wins*10+a.pf-a.pa+(a.prestige||50));});
  wrap.push("ðŸ“Š #1 "+(ranked[0]?ranked[0].icon+ranked[0].abbr:"")+" #2 "+(ranked[1]?ranked[1].icon+ranked[1].abbr:"")+" #3 "+(ranked[2]?ranked[2].icon+ranked[2].abbr:""));
  var moments=[];
  wg.forEach(function(g){
    if(!g.result) return;
    var h3=teams.find(function(t){return t.id===g.home;});var a3=teams.find(function(t){return t.id===g.away;});
    if(!h3||!a3) return;
    var diff=Math.abs(g.result.home-g.result.away);
    var winner=g.result.home>g.result.away?h3:a3;var loser=g.result.home>g.result.away?a3:h3;
    var wS=Math.max(g.result.home,g.result.away);var lS=Math.min(g.result.home,g.result.away);
    if(diff>=21)moments.push("ðŸ’£ "+winner.icon+winner.abbr+" DEMOLISHES "+loser.icon+loser.abbr+" "+wS+"-"+lS);
    if(lS===0)moments.push("ðŸš« "+winner.icon+winner.abbr+" records SHUTOUT vs "+loser.icon+loser.abbr);
    if(wS+lS>=60)moments.push("ðŸ”¥ SHOOTOUT! "+h3.icon+h3.abbr+" "+g.result.home+"-"+g.result.away+" "+a3.icon+a3.abbr+" combines for "+(wS+lS)+" pts");
    if(g.result.log&&g.result.log.some(function(l){return l.indexOf("â”€â”€ OT â”€â”€")>=0;}))moments.push("âš¡ "+winner.icon+winner.abbr+" survives OT thriller vs "+loser.icon+loser.abbr);
    if(winner.wins<loser.wins-2&&diff<=7)moments.push("ðŸ˜± UPSET! "+winner.icon+winner.abbr+"("+(winner.wins||0)+"-"+(winner.losses||0)+") stuns "+loser.icon+loser.abbr);
    if(loser.streak&&loser.streak<=-5)moments.push("ðŸ“‰ "+loser.icon+loser.abbr+" drops "+Math.abs(loser.streak)+" straight â€” hot seat brewing?");
    if(winner.streak&&winner.streak>=5)moments.push("ðŸ”¥ "+winner.icon+winner.abbr+" extends win streak to "+winner.streak+"!");
  });
  teams.forEach(function(t){
    var rQB=t.roster.find(function(p){return p.pos==="QB"&&p.isStarter&&p.age<=23;});
    if(rQB&&rQB.stats.passTD>=3)moments.push("â­ Rookie "+rQB.name+"("+t.abbr+") has "+rQB.stats.passTD+" TD passes this season!");
  });
  teams.forEach(function(t){
    if(t.losses>=8&&t.ownerMood&&t.ownerMood<40)moments.push("ðŸª‘ "+t.icon+t.abbr+" HC on HOT SEAT â€” owner mood at "+t.ownerMood);
  });
  teams.forEach(function(t){
    t.roster.forEach(function(p){
      if(p.pos==="QB"&&p.stats.passYds>=2500&&p.stats.passYds<2600)moments.push("ðŸ“ˆ "+p.name+"("+t.abbr+") passes 2,500 yards!");
      if(p.pos==="RB"&&p.stats.rushYds>=1000&&p.stats.rushYds<1100)moments.push("ðŸ“ˆ "+p.name+"("+t.abbr+") joins the 1,000-yard club!");
      if(p.pos==="WR"&&p.stats.recYds>=1000&&p.stats.recYds<1100)moments.push("ðŸ“ˆ "+p.name+"("+t.abbr+") WR hits 1,000 receiving yards!");
      if(p.stats.sacks>=10&&p.stats.sacks<11)moments.push("ðŸ’¥ "+p.name+"("+t.abbr+") reaches double-digit sacks!");
    });
    var injStar=t.roster.find(function(p){return p.injury&&p.injury.games>=3&&p.ovr>=80&&p.isStarter;});
    if(injStar)moments.push("ðŸ¤• "+t.icon+t.abbr+" star "+injStar.name+"("+injStar.pos+" "+injStar.ovr+") out "+injStar.injury.games+" weeks â€” "+injStar.injury.type);
    if(t.wins>=6&&t.losses===0)moments.push("ðŸ† "+t.icon+t.abbr+" remains UNDEFEATED at "+t.wins+"-0!");
    if(t.losses>=6&&t.wins===0)moments.push("ðŸ˜° "+t.icon+t.abbr+" winless at 0-"+t.losses+"...");
  });
  wg.forEach(function(g){
    if(!g.result) return;
    var h3=teams.find(function(t){return t.id===g.home;});var a3=teams.find(function(t){return t.id===g.away;});
    if(!h3||!a3) return;
    [h3,a3].forEach(function(t){
      var opp=t===h3?a3:h3;
      var revPlayers=t.roster.filter(function(p){return p.formerTeam&&p.formerTeam===opp.id&&p.ovr>=70;});
      revPlayers.forEach(function(p){
        var won=(g.home===t.id&&g.result.home>g.result.away)||(g.away===t.id&&g.result.away>g.result.home);
        if(won)moments.push("ðŸ”¥ REVENGE! "+p.name+"("+p.pos+") gets payback vs former team "+opp.icon+opp.abbr);
      });
    });
    if(h3.staff&&h3.staff.hc&&h3.staff.hc.formerTeam===a3.id){
      var won2=g.result.home>g.result.away;
      moments.push("ðŸŽ“ "+h3.staff.hc.name+(won2?" beats":" falls to")+" former team "+a3.icon+a3.abbr+" â€” Coaching Tree showdown!");
    }
    if(a3.staff&&a3.staff.hc&&a3.staff.hc.formerTeam===h3.id){
      var won3=g.result.away>g.result.home;
      moments.push("ðŸŽ“ "+a3.staff.hc.name+(won3?" beats":" falls to")+" former team "+h3.icon+h3.abbr+" â€” Coaching Tree showdown!");
    }
  });
  if(moments.length>0){
    for(var mi2=moments.length-1;mi2>0;mi2--){var mj=Math.floor(RNG.play()*(mi2+1));var tmp2=moments[mi2];moments[mi2]=moments[mj];moments[mj]=tmp2;}
    moments.slice(0,4).forEach(function(m2){wrap.push(m2);});
  }
  return wrap;
}
function genScheduleLegacy97(teams){
  if(!teams||teams.length<2)return[];
  var realIds=teams.map(function(t){return t.id;});
  var ids=realIds.slice();
  var byeGhost="__BYE97__";
  if(ids.length%2===1)ids.push(byeGhost);
  var n=ids.length;
  var rounds=[];
  var fixed=ids[0];
  var rot=ids.slice(1);
  for(var r=0;r<n-1;r++){
    var games=[];
    var firstHome=(r%2===0)?fixed:rot[0];
    var firstAway=(r%2===0)?rot[0]:fixed;
    if(firstHome!==byeGhost&&firstAway!==byeGhost)games.push({home:firstHome,away:firstAway});
    for(var k=1;k<n/2;k++){
      var a1=rot[k];
      var a2=rot[n-1-k];
      var h2=((r+k)%2===0)?a1:a2;
      var aw2=((r+k)%2===0)?a2:a1;
      if(h2!==byeGhost&&aw2!==byeGhost)games.push({home:h2,away:aw2});
    }
    rounds.push(games);
    rot.unshift(rot.pop());
  }
  var maxWeeks=Math.min(REG_SEASON_WEEKS97,rounds.length);
  var selected=rounds.slice(0,maxWeeks);
  var targetGames=Math.min(REG_SEASON_GAMES97,realIds.length-1);
  var gameCounts={};realIds.forEach(function(id){gameCounts[id]=0;});
  selected.forEach(function(weekGames){
    (weekGames||[]).forEach(function(g){
      if(gameCounts[g.home]!=null)gameCounts[g.home]++;
      if(gameCounts[g.away]!=null)gameCounts[g.away]++;
    });
  });
  var byeRemaining={};var totalRemovals=0;
  realIds.forEach(function(id){
    byeRemaining[id]=Math.max(0,(gameCounts[id]||0)-targetGames);
    totalRemovals+=byeRemaining[id];
  });
  totalRemovals=Math.floor(totalRemovals/2);
  if(totalRemovals>0&&selected.length>0){
    var center=(selected.length-1)/2;
    var weekOrder=[];
    for(var wi=0;wi<selected.length;wi++)weekOrder.push(wi);
    weekOrder.sort(function(a,b){
      var da=Math.abs(a-center),db=Math.abs(b-center);
      if(da!==db)return da-db;
      return a-b;
    });
    var teamKeyOrder=realIds.slice().sort();
    var memoSearch={};
    function remainingNeed97(){
      var s=0;
      teamKeyOrder.forEach(function(id){s+=(byeRemaining[id]||0);});
      return s;
    }
    function needKey97(idx,rem){
      var out=[idx,rem];
      teamKeyOrder.forEach(function(id){
        var v=byeRemaining[id]||0;
        if(v>0)out.push(id+":"+v);
      });
      return out.join("|");
    }
    function chooseByeRemovals97(idx,rem,picks){
      if(rem===0)return remainingNeed97()===0;
      if(idx>=weekOrder.length)return false;
      if((weekOrder.length-idx)<rem)return false;
      var memoKey=needKey97(idx,rem);
      if(memoSearch[memoKey])return false;
      var weekIdx=weekOrder[idx];
      var weekGames=selected[weekIdx]||[];
      var cands=[];
      for(var gi=0;gi<weekGames.length;gi++){
        var g=weekGames[gi];
        if((byeRemaining[g.home]||0)>0&&(byeRemaining[g.away]||0)>0){
          cands.push({gi:gi,score:(byeRemaining[g.home]||0)+(byeRemaining[g.away]||0)});
        }
      }
      cands.sort(function(a,b){return b.score-a.score;});
      for(var ci=0;ci<cands.length;ci++){
        var pick=weekGames[cands[ci].gi];
        byeRemaining[pick.home]--;
        byeRemaining[pick.away]--;
        picks.push({week:weekIdx,gi:cands[ci].gi});
        if(chooseByeRemovals97(idx+1,rem-1,picks))return true;
        picks.pop();
        byeRemaining[pick.home]++;
        byeRemaining[pick.away]++;
      }
      if(chooseByeRemovals97(idx+1,rem,picks))return true;
      memoSearch[memoKey]=1;
      return false;
    }
    var byePicks=[];
    if(chooseByeRemovals97(0,totalRemovals,byePicks)){
      var byWeekMap={};
      byePicks.forEach(function(p){
        if(!byWeekMap[p.week])byWeekMap[p.week]=[];
        byWeekMap[p.week].push(p.gi);
      });
      Object.keys(byWeekMap).forEach(function(wk){
        var list=byWeekMap[wk].slice().sort(function(a,b){return b-a;});
        list.forEach(function(gi){
          if(selected[wk]&&selected[wk][gi])selected[wk].splice(gi,1);
        });
      });
    }else{
      // Hard fallback: preserve exact counts with a league-wide bye week if search fails.
      var cutWeek=Math.max(0,Math.min(selected.length-1,Math.floor(center)));
      selected[cutWeek]=[];
    }
  }
  var sched=[];
  for(var w=0;w<selected.length;w++){
    var week=w+1;
    selected[w].forEach(function(g){
      sched.push({home:g.home,away:g.away,week:week,played:false,result:null});
    });
  }
  return sched.sort(function(a,b){return a.week-b.week;});
}
function hashPair97(a,b,seed){
  var s=String(a||"")+"|"+String(b||"")+"|"+String(seed||0);
  var h=5381;
  for(var i=0;i<s.length;i++)h=((h<<5)+h+s.charCodeAt(i))|0;
  return h|0;
}
function getScheduleStructure97(teams){
  if(!teams||teams.length<2)return null;
  var teamMap={};teams.forEach(function(t){if(t&&t.id)teamMap[t.id]=t;});
  var divs=[];var confTeams={EC:[],WC:[]};var allIds=[];var missing=0;
  LEAGUE_STRUCTURE.divisions.forEach(function(div){
    var present=[];
    (div.teams||[]).forEach(function(id){
      if(teamMap[id])present.push(id);else missing++;
    });
    if(present.length>0){
      divs.push({id:div.id,conf:div.conf,name:div.name,icon:div.icon,teams:present});
      if(div.conf==="EC")confTeams.EC=confTeams.EC.concat(present);
      else if(div.conf==="WC")confTeams.WC=confTeams.WC.concat(present);
      allIds=allIds.concat(present);
    }
  });
  if(teams.length===30){
    if(missing>0)return null;
    if(divs.length!==6)return null;
    if(confTeams.EC.length!==15||confTeams.WC.length!==15)return null;
    for(var di=0;di<divs.length;di++)if((divs[di].teams||[]).length!==5)return null;
  }
  if(allIds.length!==teams.length)return null;
  return {divisions:divs,confTeams:confTeams,teamIds:allIds};
}
function rotateArray97(arr,off){
  if(!arr||arr.length===0)return[];
  var n=arr.length;
  var o=((off%n)+n)%n;
  return arr.slice(o).concat(arr.slice(0,o));
}
function orientGame97(a,b,seed,type){
  var hh=(hashPair97(a,b,seed)>>>0)%2===0?a:b;
  return {home:hh,away:hh===a?b:a,type:type||"reg"};
}
function validateAssignedSchedule97(sched,teamIds,expectedCounts){
  var weekSeen={};var counts={};var playedWeeks={};var i,key,g;
  teamIds.forEach(function(id){
    counts[id]={total:0,div:0,conf:0,cross:0};
    playedWeeks[id]=0;
  });
  for(i=0;i<sched.length;i++){
    g=sched[i];
    if(!counts[g.home]||!counts[g.away])return {ok:false,error:"Unknown team in schedule"};
    key=g.home+"@"+g.week;
    if(weekSeen[key])return {ok:false,error:"Duplicate weekly appearance "+key};
    weekSeen[key]=1;
    key=g.away+"@"+g.week;
    if(weekSeen[key])return {ok:false,error:"Duplicate weekly appearance "+key};
    weekSeen[key]=1;
    counts[g.home].total++;counts[g.away].total++;
    playedWeeks[g.home]++;playedWeeks[g.away]++;
    if(g.type==="div"){counts[g.home].div++;counts[g.away].div++;}
    else if(g.type==="conf"){counts[g.home].conf++;counts[g.away].conf++;}
    else if(g.type==="cross"){counts[g.home].cross++;counts[g.away].cross++;}
  }
  for(i=0;i<teamIds.length;i++){
    var tid=teamIds[i],c=counts[tid];
    if(c.total!==(expectedCounts.total||17))return {ok:false,error:"Bad total for "+tid+": "+c.total};
    if(expectedCounts.div!=null&&c.div!==expectedCounts.div)return {ok:false,error:"Bad div count for "+tid+": "+c.div};
    if(expectedCounts.conf!=null&&c.conf!==expectedCounts.conf)return {ok:false,error:"Bad conf count for "+tid+": "+c.conf};
    if(expectedCounts.cross!=null&&c.cross!==expectedCounts.cross)return {ok:false,error:"Bad cross count for "+tid+": "+c.cross};
    if(playedWeeks[tid]!==c.total)return {ok:false,error:"Week duplication for "+tid};
  }
  return {ok:true};
}
function buildDivisionRounds97(div,year){
  var yr=year||2026;
  var teams=rotateArray97((div.teams||[]).slice(),(yr+Math.abs(hashPair97(div.id,div.conf,yr)))%Math.max(1,(div.teams||[]).length));
  if(teams.length!==5)return[];
  var ids=teams.slice().concat(["__BYE97__"]);
  var n=ids.length;
  var fixed=ids[0];
  var rot=ids.slice(1);
  var firstCycle=[];
  for(var r=0;r<5;r++){
    var arr=[fixed].concat(rot);
    var games=[];
    var bye=null;
    for(var i=0;i<n/2;i++){
      var a=arr[i],b=arr[n-1-i];
      if(a==="__BYE97__")bye=b;
      else if(b==="__BYE97__")bye=a;
      else games.push(orientGame97(a,b,yr+r*31+Math.abs(hashPair97(div.id,"div",yr)),"div"));
    }
    firstCycle.push({games:games,bye:bye});
    rot.unshift(rot.pop());
  }
  var rounds=[];
  for(var c=0;c<5;c++)rounds.push(firstCycle[c]);
  for(var c2=0;c2<5;c2++){
    rounds.push({
      games:firstCycle[c2].games.map(function(g){return {home:g.away,away:g.home,type:"div"};}),
      bye:firstCycle[c2].bye
    });
  }
  return rounds;
}
function buildConfNonDivEdges97(confId,year){
  var yr=year||2026;
  var confDivs=LEAGUE_STRUCTURE.divisions.filter(function(d){return d.conf===confId;});
  var edges=[];var seen={};
  function addEdge97(a,b){
    var key=[a,b].sort().join("-");
    if(seen[key])return;
    seen[key]=1;
    edges.push(orientGame97(a,b,yr+Math.abs(hashPair97(a,b,yr))+(confId==="WC"?500:0),"conf"));
  }
  for(var p1=0;p1<confDivs.length;p1++){
    for(var p2=p1+1;p2<confDivs.length;p2++){
      var A=(confDivs[p1].teams||[]).slice();
      var B=(confDivs[p2].teams||[]).slice();
      var base=((yr%5)+p1*2+p2*3+(confId==="WC"?1:0))%5;
      var offs=[base,(base+2)%5];
      for(var oi=0;oi<offs.length;oi++){
        for(var i=0;i<5;i++){
          addEdge97(A[i],B[(i+offs[oi])%5]);
        }
      }
    }
  }
  var teamIds=[];
  confDivs.forEach(function(d){teamIds=teamIds.concat(d.teams||[]);});
  return {edges:edges,teamIds:teamIds};
}
function colorEdgesBalanced97(edges,teamIds,colorCount,targetPerColor){
  var idIdx={};teamIds.forEach(function(id,i){idIdx[id]=i;});
  var m=edges.length,n=teamIds.length;
  var u=[],v=[],adj=[];
  for(var i=0;i<n;i++)adj[i]=[];
  for(i=0;i<m;i++){
    u[i]=idIdx[edges[i].home];
    v[i]=idIdx[edges[i].away];
    adj[u[i]].push(i);
    adj[v[i]].push(i);
  }
  var colors=new Array(m);for(i=0;i<m;i++)colors[i]=0;
  var vMask=new Array(n);for(i=0;i<n;i++)vMask[i]=0;
  var cCount=new Array(colorCount+1);for(i=0;i<=colorCount;i++)cCount[i]=0;
  var full=(1<<colorCount)-1;
  function popcount97(x){
    x=x-((x>>>1)&0x55555555);
    x=(x&0x33333333)+((x>>>2)&0x33333333);
    return (((x+(x>>>4))&0x0F0F0F0F)*0x01010101)>>>24;
  }
  var order=[];
  for(i=0;i<m;i++)order.push(i);
  order.sort(function(a,b){
    var da=adj[u[a]].length+adj[v[a]].length;
    var db=adj[u[b]].length+adj[v[b]].length;
    if(db!==da)return db-da;
    return a-b;
  });
  function dom97(e){return full & ~(vMask[u[e]]|vMask[v[e]]);}
  function chooseEdge97(){
    var best=-1,bestCt=999,bestScore=-1;
    for(var oi=0;oi<order.length;oi++){
      var e=order[oi];
      if(colors[e])continue;
      var d=dom97(e),ct=0;
      for(var c=1;c<=colorCount;c++)if((d&(1<<(c-1)))&&cCount[c]<targetPerColor)ct++;
      if(ct===0)return-2;
      var sc=adj[u[e]].length+adj[v[e]].length;
      if(ct<bestCt||(ct===bestCt&&sc>bestScore)){
        best=e;bestCt=ct;bestScore=sc;
        if(ct===1)break;
      }
    }
    return best;
  }
  function solve97(depth){
    if(depth===m){
      for(var c=1;c<=colorCount;c++)if(cCount[c]!==targetPerColor)return false;
      return true;
    }
    var e=chooseEdge97();
    if(e<0)return false;
    var d=dom97(e),cands=[];
    for(var c2=1;c2<=colorCount;c2++)if((d&(1<<(c2-1)))&&cCount[c2]<targetPerColor)cands.push(c2);
    cands.sort(function(a,b){
      if(cCount[a]!==cCount[b])return cCount[a]-cCount[b];
      return a-b;
    });
    for(var ci=0;ci<cands.length;ci++){
      var col=cands[ci],bit=1<<(col-1);
      colors[e]=col;
      vMask[u[e]]|=bit;
      vMask[v[e]]|=bit;
      cCount[col]++;
      var ok=true;
      var lists=[adj[u[e]],adj[v[e]]];
      for(var li=0;li<lists.length&&ok;li++){
        for(var j=0;j<lists[li].length;j++){
          var ee=lists[li][j];
          if(colors[ee])continue;
          var dd=dom97(ee),has=false;
          for(var cc=1;cc<=colorCount;cc++){
            if((dd&(1<<(cc-1)))&&cCount[cc]<targetPerColor){has=true;break;}
          }
          if(!has){ok=false;break;}
        }
      }
      if(ok&&solve97(depth+1))return true;
      cCount[col]--;
      vMask[u[e]]&=~bit;
      vMask[v[e]]&=~bit;
      colors[e]=0;
    }
    return false;
  }
  if(!solve97(0))return null;
  return colors;
}
function buildPhase1CrossPairs97(byeWeeks,forbiddenCrossSet){
  var result=[];var used={};
  function key97(a,b){return a+"|"+b;}
  function rec97(idx){
    if(idx>=byeWeeks.length)return true;
    var ec=byeWeeks[idx].ec||[];
    var wc=byeWeeks[idx].wc||[];
    var perms=[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]];
    for(var pi=0;pi<perms.length;pi++){
      var p=perms[(pi+idx)%perms.length];
      var games=[];var ok=true;
      for(var i=0;i<3;i++){
        var k=key97(ec[i],wc[p[i]]);
        if(used[k]||forbiddenCrossSet[k]){ok=false;break;}
        games.push([ec[i],wc[p[i]]]);
      }
      if(!ok)continue;
      for(i=0;i<games.length;i++)used[key97(games[i][0],games[i][1])]=1;
      result[idx]=games;
      if(rec97(idx+1))return true;
      for(i=0;i<games.length;i++)delete used[key97(games[i][0],games[i][1])];
    }
    return false;
  }
  return rec97(0)?result:null;
}
function buildConstructedSchedule97(structure,year){
  var yr=year||2026;
  var divRoundsById={};
  structure.divisions.forEach(function(div){
    divRoundsById[div.id]=buildDivisionRounds97(div,yr);
  });
  var ecTeamIds=structure.confTeams.EC.slice();
  var wcTeamIds=structure.confTeams.WC.slice();
  var residualCrossOffsetGroups=[[1,6,11],[2,7,12],[3,8,13],[4,9,14],[0,5,10]];
  var residualCrossWeeks=null;
  var phase1CrossPairs=null;
  for(var og=0;og<residualCrossOffsetGroups.length&&!residualCrossWeeks;og++){
    var residualCrossSet={};
    var weekBuckets=[];
    var offs=residualCrossOffsetGroups[og].map(function(v){return (v+(yr%15))%15;});
    offs.forEach(function(off,oi){
      var weekGames=[];
      for(var i=0;i<15;i++){
        var a=ecTeamIds[i];
        var b=wcTeamIds[(i+off)%15];
        residualCrossSet[a+"|"+b]=1;
        residualCrossSet[b+"|"+a]=1;
        weekGames.push(orientGame97(a,b,yr*101+oi*17+i,"cross"));
      }
      weekBuckets.push(weekGames);
    });
    var byeWeeks=[];
    for(var w=0;w<10;w++){
      var ecBye=[],wcBye=[];
      structure.divisions.forEach(function(div){
        var bye=(divRoundsById[div.id]&&divRoundsById[div.id][w])?divRoundsById[div.id][w].bye:null;
        if(div.conf==="EC")ecBye.push(bye);else wcBye.push(bye);
      });
      byeWeeks.push({ec:ecBye,wc:wcBye});
    }
    var p1=buildPhase1CrossPairs97(byeWeeks,residualCrossSet);
    if(p1){
      residualCrossWeeks=weekBuckets;
      phase1CrossPairs=p1;
    }
  }
  if(!residualCrossWeeks||!phase1CrossPairs)return null;
  var ecConf=buildConfNonDivEdges97("EC",yr);
  var wcConf=buildConfNonDivEdges97("WC",yr);
  var ecColors=colorEdgesBalanced97(ecConf.edges,ecConf.teamIds,5,6);
  var wcColors=colorEdgesBalanced97(wcConf.edges,wcConf.teamIds,5,6);
  if(!ecColors||!wcColors)return null;
  var confWeeks=[];
  for(var col=1;col<=5;col++){
    var wkGames=[];
    for(var ei=0;ei<ecConf.edges.length;ei++)if(ecColors[ei]===col)wkGames.push(ecConf.edges[ei]);
    for(var wi=0;wi<wcConf.edges.length;wi++)if(wcColors[wi]===col)wkGames.push(wcConf.edges[wi]);
    confWeeks.push(wkGames);
  }
  var divisionHeavyWeeks=[];
  for(var dw=0;dw<10;dw++){
    var divGames=[];
    structure.divisions.forEach(function(div){
      if(divRoundsById[div.id]&&divRoundsById[div.id][dw])divGames=divGames.concat(divRoundsById[div.id][dw].games||[]);
    });
    for(var m=0;m<3;m++){
      var pair=phase1CrossPairs[dw][m];
      divGames.push(orientGame97(pair[0],pair[1],yr*313+dw*19+m,"cross"));
    }
    divisionHeavyWeeks.push(divGames);
  }
  var calendar=[null];
  var divSlots=[1,2,3,4,10,12,14,16,17,18];
  var confSlots=[5,6,7,8,9];
  var crossSlots=[11,13,15];
  for(var ds=0;ds<divSlots.length;ds++)calendar[divSlots[ds]]=divisionHeavyWeeks[ds];
  for(var cs=0;cs<confSlots.length;cs++)calendar[confSlots[cs]]=confWeeks[cs];
  for(var xs=0;xs<crossSlots.length;xs++)calendar[crossSlots[xs]]=residualCrossWeeks[xs];
  var sched=[];
  for(var week=1;week<=18;week++){
    (calendar[week]||[]).forEach(function(g){
      sched.push({home:g.home,away:g.away,week:week,played:false,result:null,type:g.type,gameType97:g.type});
    });
  }
  return sched.sort(function(a,b){
    if(a.week!==b.week)return a.week-b.week;
    return String(a.home+"-"+a.away).localeCompare(String(b.home+"-"+b.away));
  });
}
function genSchedule97(teams,year){
  var yr=year||2026;
  if(!teams||teams.length<30)return genScheduleLegacy97(teams);
  var structure=getScheduleStructure97(teams);
  if(!structure||teams.length!==30){
    return genScheduleLegacy97(teams);
  }
  var sched97=buildConstructedSchedule97(structure,yr);
  if(!sched97){
    console.warn("genSchedule97 construction failed, falling back to legacy scheduler");
    return genScheduleLegacy97(teams);
  }
  var v97=validateAssignedSchedule97(sched97,structure.teamIds,{total:17,div:8,conf:4,cross:5});
  if(!v97.ok){
    console.warn("genSchedule97 validation failed:",v97.error);
    return genScheduleLegacy97(teams);
  }
  return sched97;
}
function genSchedule(teams,year){
  if(teams&&teams.length===30)return genSchedule97(teams,year);
  return genScheduleLegacy97(teams);
}
var SLOT_SALARY=(function(){
  var s=[0];
  var i;
  for(i=1;i<=30;i++)s.push(Math.round((14.0-(i-1)*0.39)*10)/10);
  for(i=1;i<=30;i++)s.push(Math.round((2.4-(i-1)*0.041)*10)/10);
  for(i=1;i<=30;i++)s.push(Math.round(Math.max(0.5,1.1-(i-1)*0.014)*10)/10);
  for(i=91;i<=210;i++)s.push(0.5);
  return s;
})();
var DRAFT_CLASS_THEMES=[
  {id:"year_of_qb",label:"Year of the Quarterback",icon:"ðŸˆ",desc:"Deepest QB class in years. Multiple franchise QBs available.",posBoost:"QB",posCt:5},
  {id:"defensive_draft",label:"Defensive Draft",icon:"ðŸ›¡ï¸",desc:"Elite defensive talent top to bottom. Pass rushers and shutdown corners galore.",posBoost:"DL",posCt:4},
  {id:"weak_class",label:"Weak Draft Class",icon:"ðŸ“‰",desc:"Scouts say this is a down year. No sure things, lots of projects.",posBoost:null,posCt:0},
  {id:"wr_factory",label:"Receiver Revolution",icon:"ðŸ“¡",desc:"Historic receiver class. Five potential WR1s available.",posBoost:"WR",posCt:5},
  {id:"trench_class",label:"Built in the Trenches",icon:"ðŸ—ï¸",desc:"Dominant OL and DL prospects. Win the line of scrimmage in this draft.",posBoost:"OL",posCt:4},
  {id:"athletic_freaks",label:"Athletic Freaks",icon:"âš¡",desc:"Fastest, strongest combine class ever measured. Raw but explosive.",posBoost:null,posCt:0},
  {id:"running_back_renaissance",label:"RB Renaissance",icon:"ðŸƒ",desc:"Running backs are BACK. Multiple three-down backs with elite vision.",posBoost:"RB",posCt:4},
  {id:"generational",label:"Generational Class",icon:"ðŸ‘‘",desc:"Once-in-a-decade talent at the top. A true franchise-changer awaits.",posBoost:null,posCt:0},
  {id:"secondary_loaded",label:"Secondary Loaded",icon:"ðŸ”’",desc:"Deep class of cornerbacks and safeties. Lock down your defense.",posBoost:"CB",posCt:4},
  {id:"balanced_class",label:"Well-Rounded Class",icon:"âš–ï¸",desc:"Solid talent across every position. No weakness, no standout position group.",posBoost:null,posCt:0}
];
var PROSPECT_STORYLINES=[
  {id:"comeback_kid",label:"Comeback Kid",icon:"ðŸ’ª",templates:[
    "{name} tore his ACL two years ago. Scouts questioned if he'd ever play again. He came back stronger.",
    "After a devastating injury, {name} rebuilt himself from scratch. His combine proved the doubters wrong."]},
  {id:"small_town_hero",label:"Small Town Hero",icon:"ðŸ«",templates:[
    "{name} from tiny {school} â€” population 3,000. Nobody recruited him. Now he's a projected Day 1 pick.",
    "From a town nobody's heard of, {name} dominated a level of competition scouts couldn't ignore."]},
  {id:"dynasty_bloodline",label:"Football Royalty",icon:"ðŸ‘‘",templates:[
    "{name}'s father was a 10-year pro starter. The bloodline runs deep. Can the son surpass the father?",
    "Third-generation football player {name} carries the weight of a legendary family name."]},
  {id:"raw_tools",label:"The Project",icon:"ðŸ”§",templates:[
    "{name} only started playing football 3 years ago. The athletic tools are otherworldly, but the technique needs work.",
    "A former track star, {name} is the rawest prospect in the class â€” but the ceiling is the highest."]},
  {id:"controversy",label:"Off-Field Questions",icon:"ðŸš©",templates:[
    "Teams can't ignore {name}'s talent, but character concerns have some GMs hesitant to pull the trigger.",
    "{name}'s college career was brilliant but turbulent. The interview circuit will determine his draft stock."]},
  {id:"four_year_starter",label:"Battle-Tested Captain",icon:"ðŸŽ–ï¸",templates:[
    "{name} started 48 consecutive college games. The production is undeniable. The floor is the highest in the class.",
    "No prospect has played more meaningful snaps than {name}. He's been a captain since his sophomore year."]},
  {id:"physical_freak",label:"Combine Darling",icon:"ðŸ‹ï¸",templates:[
    "{name}'s combine performance broke the internet. Historic numbers in every drill. But can he play football?",
    "The measurables are unfair â€” {name} tested in the 99th percentile across the board."]},
  {id:"fallen_star",label:"The Fallen Star",icon:"â­",templates:[
    "Once projected #1 overall, {name}'s stock has plummeted after a disappointing senior season.",
    "{name} was a Heisman favorite before injuries derailed his final year. How far does he fall?"]},
  {id:"late_riser",label:"Late Riser",icon:"ðŸ“ˆ",templates:[
    "Nobody talked about {name} before the Senior Bowl. Now he's shooting up draft boards after a dominant week.",
    "A late-season surge and electric bowl game performance have {name} skyrocketing up the rankings."]},
  {id:"hometown_kid",label:"Hometown Connection",icon:"ðŸ ",templates:[
    "{name} grew up watching your team. He's dreamed of wearing this jersey since he was 8 years old.",
    "A local product, {name} played high school ball 20 minutes from your stadium."]}
];
function generateDraftClassNarrative(draftClass){
  if(!draftClass||draftClass.length===0)return null;
  var posCounts={};
  draftClass.forEach(function(p){posCounts[p.pos]=(posCounts[p.pos]||0)+1;});
  var starsByPos={};
  draftClass.slice(0,30).forEach(function(p){starsByPos[p.pos]=(starsByPos[p.pos]||0)+1;});
  var dominantPos=null;var maxCt=0;
  Object.keys(starsByPos).forEach(function(pos){if(starsByPos[pos]>maxCt){maxCt=starsByPos[pos];dominantPos=pos;}});
  var themes=DRAFT_CLASS_THEMES.slice();
  var matched=null;
  if(dominantPos==="QB"&&maxCt>=4)matched=themes.find(function(t){return t.id==="year_of_qb";});
  else if((dominantPos==="DL"||dominantPos==="LB")&&maxCt>=5)matched=themes.find(function(t){return t.id==="defensive_draft";});
  else if(dominantPos==="WR"&&maxCt>=5)matched=themes.find(function(t){return t.id==="wr_factory";});
  else if(dominantPos==="OL"&&maxCt>=4)matched=themes.find(function(t){return t.id==="trench_class";});
  else if(dominantPos==="RB"&&maxCt>=4)matched=themes.find(function(t){return t.id==="running_back_renaissance";});
  else if(dominantPos==="CB"&&maxCt>=4)matched=themes.find(function(t){return t.id==="secondary_loaded";});
  if(!matched&&draftClass[0]&&draftClass[0].ovr>=88)matched=themes.find(function(t){return t.id==="generational";});
  if(!matched&&draftClass[0]&&draftClass[0].ovr<76)matched=themes.find(function(t){return t.id==="weak_class";});
  if(!matched)matched=themes[Math.floor(RNG.draft()*themes.length)];
  var storylines=[];
  var usedIds={};
  draftClass.slice(0,5).forEach(function(p,idx){
    var available=PROSPECT_STORYLINES.filter(function(s){return !usedIds[s.id];});
    if(p.character75&&p.character75.id==="character_concern"){
      var cv=available.find(function(s){return s.id==="controversy";});
      if(cv){available=[cv].concat(available);}
    }
    if(p.character75&&p.character75.id==="small_school"){
      var ss=available.find(function(s){return s.id==="small_town_hero";});
      if(ss){available=[ss].concat(available);}
    }
    if(p.character75&&p.character75.id==="workout_warrior"){
      var ww=available.find(function(s){return s.id==="physical_freak";});
      if(ww){available=[ww].concat(available);}
    }
    if(p.character75&&p.character75.id==="pro_ready"){
      var pr=available.find(function(s){return s.id==="four_year_starter";});
      if(pr){available=[pr].concat(available);}
    }
    if(p.isBust){
      var fs=available.find(function(s){return s.id==="fallen_star";});
      if(fs){available=[fs].concat(available);}
    }
    if(p.isGem){
      var lr=available.find(function(s){return s.id==="late_riser";});
      if(lr){available=[lr].concat(available);}
    }
    var chosen=available.length>0?available[Math.floor(RNG.draft()*Math.min(3,available.length))]:PROSPECT_STORYLINES[0];
    usedIds[chosen.id]=true;
    var template=chosen.templates[Math.floor(RNG.draft()*chosen.templates.length)];
    var text=template.replace(/\{name\}/g,p.name).replace(/\{school\}/g,p.college?p.college.school:"State U");
    storylines.push({prospectId:p.id,prospectName:p.name,pos:p.pos,ovr:p.ovr,
      storylineId:chosen.id,label:chosen.label,icon:chosen.icon,text:text,
      resolved:false,resolution:null});
    p.storyline76={id:chosen.id,label:chosen.label,icon:chosen.icon,text:text};
  });
  return{theme:matched,storylines:storylines,year:0};
}
function resolveDraftStorylines(narrative,teams,myId){
  if(!narrative||!narrative.storylines)return narrative;
  narrative.storylines.forEach(function(sl){
    if(sl.resolved)return;
    var foundPlayer=null;var foundTeam=null;
    teams.forEach(function(t){
      var p=t.roster.find(function(r){return r.id===sl.prospectId;});
      if(p){foundPlayer=p;foundTeam=t;}
    });
    if(!foundPlayer)return;
    sl.resolved=true;
    var isStarter=foundPlayer.isStarter;
    var isGood=(foundPlayer.ovr||50)>=72;
    var isBust=(foundPlayer.ovr||50)<60;
    if(sl.storylineId==="comeback_kid"){
      sl.resolution=isGood?"âœ… The comeback is COMPLETE. "+sl.prospectName+" is a starter!":"â³ Still fighting back. The road continues.";
    }else if(sl.storylineId==="small_town_hero"){
      sl.resolution=isStarter?"âœ… Small town, BIG league. "+sl.prospectName+" proved them all wrong.":"â³ Adjusting to the big stage. Give him time.";
    }else if(sl.storylineId==="controversy"){
      sl.resolution=isBust?"âŒ The red flags were real. "+sl.prospectName+" couldn't overcome the off-field issues.":"âœ… Matured and focused. The gamble is paying off.";
    }else if(sl.storylineId==="physical_freak"){
      sl.resolution=isGood?"âœ… The athleticism TRANSLATES. "+sl.prospectName+" is the real deal.":"âš ï¸ Still raw. The tools are there but the football isn't.";
    }else if(sl.storylineId==="fallen_star"){
      sl.resolution=isGood?"âœ… REDEMPTION. "+sl.prospectName+" silenced the doubters.":"ðŸ“‰ The fall continues. Was the hype ever real?";
    }else if(sl.storylineId==="late_riser"){
      sl.resolution=isGood?"âœ… The rise was REAL. "+sl.prospectName+" is a steal!":"â³ Back to earth. The Senior Bowl magic faded.";
    }else{
      sl.resolution=isGood?"âœ… Living up to the billing.":isStarter?"â³ Developing nicely.":"ðŸ“‹ Still finding his footing.";
    }
  });
  return narrative;
}
function genDraftClass(n,opts){
  var ps=["QB","QB","QB","RB","RB","RB","RB","WR","WR","WR","WR","WR","WR","WR","WR",
    "TE","TE","TE","OL","OL","OL","OL","OL","OL","OL","OL","OL",
    "DL","DL","DL","DL","DL","DL","DL","LB","LB","LB","LB","LB","LB",
    "CB","CB","CB","CB","CB","CB","S","S","S","S","K","K","K","P","P","P"];
  function gradeL(v){return v>=92?"A+":v>=86?"A":v>=80?"A-":v>=76?"B+":v>=72?"B":v>=68?"B-":v>=64?"C+":v>=60?"C":v>=55?"C-":v>=50?"D+":v>=45?"D":"F";}
  var total=n||450;
  var teamPipeline=(opts&&opts.pipeline)||null;
  // v95.5: pipelineBoostYear â€” scout spend "pipeline" flag boosts draft class quality
  var pipelineActive95=(opts&&opts.qualityBoost)||false;
  return Array.from({length:total},function(_,i){
    var pos=ps[i%ps.length];
    var tier=i<8?"star":i<32?"good":i<152?"avg":"bad";
    // v95.5: pipeline active â†’ double gem/late-riser rates
    if(i>=120&&RNG.draft()<(pipelineActive95?0.06:0.03))tier="star";// gem: 3%â†’6% with pipeline
    if(i>=60&&RNG.draft()<(pipelineActive95?0.10:0.06))tier="good";// late-riser: 6%â†’10% with pipeline
    var p=genPlayer(pos,tier,rng(21,23));
    var draftNerf=tier==="star"?rng(3,8):tier==="good"?rng(5,12):tier==="avg"?rng(8,16):rng(10,18);
    if(pipelineActive95)draftNerf=Math.max(0,draftNerf-2);// v95.5: pipeline â†’ -2 nerf (prospects more polished)
    var def=POS_DEF[pos];if(def){def.r.forEach(function(r){p.ratings[r]=cl((p.ratings[r]||50)-draftNerf,38,95);});}
    p.ovr=calcOvr(p);
    // v99.2: DeepSeek round-curve blend â€” 60% attribute-based, 40% round/pick expectation
    var dR991=Math.min(7,Math.floor(i/32)+1),dP991=(i%32)+1;
    p.ovr=Math.round(p.ovr*0.6+draftPickOvr991(dR991,dP991)*0.4);
    // v95.5: pipeline active â†’ 5% superstar, 12% star total (vs 2% / 6% base)
    var devRoll95=RNG.draft();
    var ssPct95=pipelineActive95?0.05:0.02;
    var starPct95=pipelineActive95?0.12:0.06;
    if(devRoll95<ssPct95)p.devTrait="superstar";
    else if(devRoll95<starPct95)p.devTrait="star";
    else p.devTrait="normal";
    p.pot=cl(p.ovr+rng(0,tier==="star"?10:tier==="good"?8:5),p.ovr,95);
    var hypeVar=rng(-15,10);// Skewed negative = more undervalued gems
    p.hypeOvr=cl(p.ovr+hypeVar,40,99);
    p.scouted={measurables:false,interview:false,film:false,complete:false};p.scoutNotes=[];
    p.isGem=hypeVar<=-8;p.isBust=hypeVar>=8;
    if(pipelineActive95)p._pipelineActivated=true;// v95.5: mark for UI badge
    var slotVal=SLOT_SALARY[i+1]||MIN_SALARY;
    if(pos==="K"||pos==="P")p.contract=makeContract(MIN_SALARY,4,0,0);
    else{var rkBonus=Math.round(slotVal*4*0.5*10)/10;// 50% of total as bonus (ChatGPT flag #7: no uncuttable rookies)
      p.contract=makeContract(Math.max(Math.round(slotVal*0.5*10)/10,MIN_SALARY),4,rkBonus,rkBonus);}
    p.scoutGrade=gradeL(p.hypeOvr);p.trueGrade=gradeL(p.ovr);
    p.potLabel=p.pot>=88?"Elite":p.pot>=80?"High":p.pot>=72?"Average":p.pot>=65?"Below Avg":"Project";
    var def2=POS_DEF[pos];var topR=def2?p.ratings[def2.r[0]]||60:60;
    var isEliteProspect=tier==="star"||tier==="good";
    // PIPELINE integration: use pipeline-weighted school selection when pipeline data available
    var schoolData=teamPipeline?PIPELINE.pickSchoolForProspect(pos,tier,teamPipeline):null;
    var school=schoolData?schoolData.name:pickCollege(isEliteProspect);
    // Apply pipeline dev bonus: boost pot + chance of better devTrait from feeder schools
    if(schoolData&&schoolData.devBonus>0){
      var potBoost=Math.round(schoolData.devBonus*20);// 0.02â†’0, 0.05â†’1, 0.08â†’1-2
      p.pot=cl(p.pot+potBoost,p.ovr,97);
      p.potLabel=p.pot>=88?"Elite":p.pot>=80?"High":p.pot>=72?"Average":p.pot>=65?"Below Avg":"Project";
      // Feeder schools (devBonus 0.08) have small chance to bump devTrait
      if(schoolData.devBonus>=0.08&&p.devTrait==="normal"&&RNG.draft()<0.12)p.devTrait="star";
      p._pipelineSchoolId=schoolData.id;// Track for scouting intel bonus
      p._pipelineBonus=schoolData.devBonus;
    }
    if(pos==="QB")p.college={school:school,
      passYds:Math.round(topR*35+rng(-200,400)),passTD:Math.round(topR*0.35+rng(-3,5)),int:Math.round((100-topR)*0.12+rng(0,4)),
      comp:cl(Math.round(topR*0.6+rng(-3,5)),52,74)};
    else if(pos==="RB")p.college={school:school,
      rushYds:Math.round(topR*18+rng(-100,300)),rushTD:Math.round(topR*0.2+rng(-2,5)),ypc:Math.round((topR/16+rng(-5,8))*10)/10};
    else if(pos==="WR"||pos==="TE")p.college={school:school,
      rec:Math.round(topR*0.7+rng(-5,15)),recYds:Math.round(topR*12+rng(-80,200)),recTD:Math.round(topR*0.12+rng(-1,4))};
    else p.college={school:school,
      starts:Math.round(topR*0.4+rng(-3,8)),awards:topR>=80?pick(["All-American","All-Conference","None"]):topR>=70?pick(["All-Conference","None"]):"None"};
    var COMBINE_RANGES={
      QB:  {forty:[4.55,5.10],bench:[12,22],vert:[28,36],shuttle:[4.05,4.50]},
      RB:  {forty:[4.35,4.65],bench:[16,28],vert:[30,40],shuttle:[3.95,4.35]},
      WR:  {forty:[4.28,4.62],bench:[8,18],vert:[32,42],shuttle:[3.90,4.30]},
      TE:  {forty:[4.45,4.85],bench:[18,28],vert:[30,38],shuttle:[4.05,4.45]},
      OL:  {forty:[4.95,5.40],bench:[24,38],vert:[24,34],shuttle:[4.35,4.75]},
      DL:  {forty:[4.60,5.15],bench:[22,36],vert:[28,38],shuttle:[4.15,4.55]},
      LB:  {forty:[4.45,4.85],bench:[18,32],vert:[30,40],shuttle:[4.00,4.40]},
      CB:  {forty:[4.30,4.58],bench:[8,18],vert:[33,42],shuttle:[3.90,4.25]},
      S:   {forty:[4.35,4.65],bench:[12,22],vert:[32,40],shuttle:[3.95,4.30]},
      K:   {forty:[4.70,5.20],bench:[8,16],vert:[24,32],shuttle:[4.20,4.60]},
      P:   {forty:[4.70,5.20],bench:[8,16],vert:[24,32],shuttle:[4.20,4.60]}
    };
    var cr=COMBINE_RANGES[pos]||COMBINE_RANGES.WR;
    var qualMod=p.ovr>=85?0.85:p.ovr>=78?0.7:p.ovr>=70?0.5:p.ovr>=62?0.3:0.1;// 0-1, higher = more athletic
    var jitter=function(lo,hi,qm){
      var range=hi-lo;var base=hi-range*qm;// Better players start closer to elite end
      return Math.round((base+rng(0,range*0.3)-range*0.1)*100)/100;// Small random variance
    };
    var fortyBase=cr.forty[1]-(cr.forty[1]-cr.forty[0])*qualMod;
    p.combine={
      forty:Math.round((fortyBase+rng(-8,8)*0.01)*100)/100,
      bench:Math.round(cr.bench[0]+(cr.bench[1]-cr.bench[0])*qualMod+rng(-3,3)),
      vertical:Math.round(cr.vert[0]+(cr.vert[1]-cr.vert[0])*qualMod+rng(-2,3)),
      shuttle:Math.round((cr.shuttle[1]-(cr.shuttle[1]-cr.shuttle[0])*qualMod+rng(-5,5)*0.01)*100)/100
    };
    p.combine.forty=cl(p.combine.forty,cr.forty[0],cr.forty[1]);
    p.combine.bench=cl(p.combine.bench,cr.bench[0],cr.bench[1]);
    p.combine.vertical=cl(p.combine.vertical,cr.vert[0],cr.vert[1]);
    p.combine.shuttle=cl(p.combine.shuttle,cr.shuttle[0],cr.shuttle[1]);
    p.trueOvr=p.ovr;
    // v99.2: Populate scoutNotes from SCOUTING_TEMPLATES_991 (ChatGPT scouting reports)
    try{var stPos991=pos,stTier991=tier==="star"?"elite":tier==="good"?"solid":"project";
      var stTmpl991=SCOUTING_TEMPLATES_991&&SCOUTING_TEMPLATES_991[stPos991]&&SCOUTING_TEMPLATES_991[stPos991][stTier991];
      if(stTmpl991&&stTmpl991.length){
        var stT991=stTmpl991[Math.floor(Math.random()*stTmpl991.length)];
        var stSchool991=(p.college&&p.college.school)||"a major program";
        var stNote991=stT991.replace(/\[PLAYER\]/g,p.name||"Prospect").replace(/\[COLLEGE\]/g,stSchool991).replace(/\[YEAR\]/g,"Senior");
        p.scoutNotes=[stNote991];}
    }catch(e){}
    p.scouting=initScoutState(false,true);// draft prospects: unknown, rookie volatility
    p.hypeOvr=getScoutedOvr(p.trueOvr,60,0.0,true);
    p.scoutGrade=gradeL(p.hypeOvr);p.trueGrade=gradeL(p.trueOvr);
    var initRange=getScoutRange(p.trueOvr,60,0.0,true);
    p.scoutRange={min:initRange.min,max:initRange.max,est:initRange.est,tier:"blind"};
    p.isGem=(p.trueOvr-p.hypeOvr)>=8;// true OVR much higher than perceived
    p.isBust=(p.hypeOvr-p.trueOvr)>=8;// perceived much higher than true OVR
    p.character75=PROSPECT_CHARACTER.assign(p,tier);
    var secSchools78=["Alabama","Georgia","LSU","Florida","Tennessee","Auburn","Texas A&M","Ole Miss","Arkansas","Missouri","Kentucky","South Carolina","Mississippi St","Vanderbilt"];
    var big10Schools78=["Ohio State","Michigan","Penn State","Wisconsin","Iowa","Michigan State","Minnesota","Indiana","Purdue","Illinois","Nebraska","Northwestern","Maryland","Rutgers"];
    var big12Schools78=["Oklahoma","Texas","TCU","Kansas State","Baylor","Oklahoma State","West Virginia","Iowa State","Kansas","Cincinnati","Houston","UCF","BYU","Colorado"];
    var accSchools78=["Clemson","Florida State","Miami","North Carolina","NC State","Pittsburgh","Louisville","Virginia Tech","Duke","Wake Forest","Syracuse","Boston College","Virginia","Georgia Tech"];
    var pac12Schools78=["USC","Oregon","Washington","UCLA","Utah","Stanford","Arizona State","Oregon State","Cal","Arizona","Washington State","Colorado"];
    var sch78=p.college?p.college.school:"";
    if(secSchools78.indexOf(sch78)>=0)p._scoutRegion78="sec";
    else if(big10Schools78.indexOf(sch78)>=0)p._scoutRegion78="big10";
    else if(big12Schools78.indexOf(sch78)>=0)p._scoutRegion78="big12";
    else if(accSchools78.indexOf(sch78)>=0)p._scoutRegion78="acc";
    else if(pac12Schools78.indexOf(sch78)>=0)p._scoutRegion78="pac12";
    else p._scoutRegion78="other";
    return p;
  }).sort(function(a,b){return b.hypeOvr-a.hypeOvr;});
  // v98.6 #17: Generational Talent injection
  // (called externally after genDraftClass returns)
}
function genFreeAgents(n){
  var ps=["QB","RB","WR","WR","TE","OL","OL","DL","DL","LB","LB","CB","CB","S","K","P"];
  var base=Array.from({length:n||30},function(_,i){var p=genPlayer(ps[i%ps.length],pick(["avg","bad","bad","good"]),rng(26,33));
    p.faYears=0;
    if(p.ovr>78){
      var def=POS_DEF[p.pos];if(def){def.r.forEach(function(r){p.ratings[r]=cl(p.ratings[r]-rng(3,8),40,80);});}
      p.ovr=calcOvr(p);
    }
    p.trueOvr=p.ovr;p.scouting=initScoutState(false,false);p.scouting.confidence=0.4;// FAs are somewhat known
    p.agentType=assignAgentType(p,RNG.ai);// v62: Agent personality
    if(p.pos==="K"||p.pos==="P")p.contract=makeContract(MIN_SALARY,rng(1,2),0,0);
    else{var faSal=p.ovr>=74?rng(4,12):rng(1,5);faSal=Math.round(faSal*10)/10;var faYrs=rng(1,3);
      var faBonus=faSal>3?Math.round(faSal*0.25*faYrs*10)/10:0;
      p.contract=makeContract(Math.max(Math.round((faSal-(faYrs>0?faBonus/faYrs:0))*10)/10,MIN_SALARY),faYrs,faBonus,Math.round(faSal*10)/10);}
    return p;});
  var minPos=["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"];
  var mins=[];
  minPos.forEach(function(pos){
    for(var mi=0;mi<5;mi++){
      var mp=genPlayer(pos,pick(["bad","avg"]),rng(27,35));
      mp.faYears=1;// Already been FA 1 year = accepts minimum
      mp.agentType=assignAgentType(mp,RNG.ai);// v62
      mp.contract=makeContract(MIN_SALARY,1,0,0);
      mins.push(mp);
    }
  });
  return base.concat(mins);
}
function progressPlayer(p,coach,gymLvl,traitDevBonus,teamCtx){
  var def=POS_DEF[p.pos];if(!def) return p;p.age++;p.contract.years=Math.max(0,p.contract.years-1);
  if(p.contract.restructured)p.contract.restructured=false;
  if(p.contract.baseSalary!==undefined)p.contract.salary=calcCapHit(p.contract);
  var db=(coach&&coach.ratings?((coach.ratings.development||50)-50)*0.04:0)+((gymLvl||0)*0.3);
  var devMult=p.devTrait==="superstar"?1.5:p.devTrait==="star"?1.2:1.0;
  var allT95pp=getPlayerTraits95(p);
  if(hasTrait95(p,"workhorse"))devMult+=0.2;// v95.6: hasTrait95 â€” multi-trait workhorse players get dev bonus
  devMult+=(traitDevBonus||0);
  var traitDevFx95=0;
  allT95pp.forEach(function(tk){
    if(["hometown_hero","late_bloomer","ironman","chip","media_darling","streaky","stat_padder","comeback_kid"].indexOf(tk)<0)return;
    var fx95=TRAIT_FX[tk];
    if(fx95&&typeof fx95.dev==="number")traitDevFx95+=fx95.dev;
  });
  if(traitDevFx95!==0)devMult+=cl(traitDevFx95*0.03,-0.12,0.22);// v95.2 multi-trait dev loop (safe, capped)
  // v95.3: LATE_BLOOMER age arc â€” slow start then massive late-career surge
  if(allT95pp.indexOf("late_bloomer")>=0){
    if(p.age>=27&&p.age<=32){devMult+=0.35;}// Late-career surge: prime arrives late
    else if(p.age<25){devMult-=0.10;}// Slow start: raw and unpolished early
  }
  // v95.3: STREAKY â€” volatile dev each season (already handled by TRAIT_FX dev generic, but add variance swing)
  if(allT95pp.indexOf("streaky")>=0){
    devMult+=RNG.dev()<0.5?0.15:-0.10;// Additional Â±swing beyond generic TRAIT_FX dev
  }
  devMult+=traitScalar(getPersonality(p).workEthic)*0.22;// v83: workEthic drives dev speed
  if(teamCtx){
    var fitDev86=calcPlayerIdentityFit(p,teamCtx);
    devMult+=cl((fitDev86.score-70)*0.004,-0.22,0.18);
    if(fitDev86.score<58&&p.age<=25)devMult-=0.05;
  }
  devMult=cl(devMult,0.55,2.35);
  var curve=ARCHETYPE_AGING.getCurve(p);
  var isPrime=p.age>=curve.prime[0]&&p.age<=curve.prime[1];
  var isPastCliff=p.age>curve.cliff;
  var isPrePrime=p.age<curve.prime[0];
  var staffDev=coach&&coach.ratings?coach.ratings.development||50:50;
  var roleDevB=calcRoleDevBonus(p,staffDev);
  if(roleDevB>0&&isPrePrime)devMult+=roleDevB*0.08;// Scaled by role position + stability + staff
  var snaps=p.stats?p.stats.snaps||0:0;
  var hasChip95pp=allT95pp.indexOf("chip")>=0;
  var snapMult=snaps>500?1.3:snaps>200?1.1:snaps>50?1.0:0.6;
  if(hasTrait95(p,"gym_rat"))snapMult=Math.max(snapMult,1.0);// v95.6: hasTrait95 â€” gym_rat as secondary trait now counts
  def.r.forEach(function(r,ri){
    var d=0;
    var w=def.w[ri]||3;// v70: weight for AGING_V2
    if(isPrePrime){
      d=(rng(0,5)+db)*devMult*snapMult;
      var ageMult70=AGING_V2.getMultiplier(r,"peak",w);
      if(ageMult70<0)d=Math.max(d,Math.abs(ageMult70)*rng(0,2));// Mental bonus
    }else if(isPrime){
      d=(rng(-1,2)+db*0.5)*devMult*snapMult;
      var primeMult70=AGING_V2.getMultiplier(r,"prime",w);
      if(primeMult70<0)d=Math.max(d,Math.abs(primeMult70)*rng(0,1));
    }else if(isPastCliff){
      var yearsOver=p.age-curve.cliff;
      d=rng(Math.round(-2*curve.decayRate*yearsOver),-1);
      var cliffMult70=AGING_V2.getMultiplier(r,"decline",w);
      if(cliffMult70<0){d=rng(0,1);}// Mental ratings still improve!
      else if(cliffMult70<0.5){d=Math.round(d*0.4);}// Technique holds
      else{d=Math.round(d*Math.min(cliffMult70,2.0));}// Physical decays fast
    }else{
      d=(rng(-3,1)+db*0.3)*snapMult;
      var gentleMult70=AGING_V2.getMultiplier(r,"decline",w);
      if(gentleMult70<0)d=Math.max(d,0);// Mental: no decline
      else if(gentleMult70>1.0)d=Math.round(d*1.2);// Physical: slightly worse
    }
    p.ratings[r]=cl((p.ratings[r]||50)+Math.round(d*(DNA_ACTIVE.devSpeed||1.0)),35,99);// v53: DNA slider
  });
  p.ovr=calcOvr(p);p.pot=cl(p.pot+rng(-3,1),p.ovr,99);
  var chipUpgradeBoost=(hasChip95pp&&p.age<=26&&snaps>=350)?(snaps>=700?0.05:snaps>=550?0.035:0.02):0;
  if(p.devTrait==="normal"&&snaps>400&&p.ovr>=78&&p.age<=26&&RNG.ai()<Math.min(0.20,0.08+chipUpgradeBoost)){
    p.devTrait="star";// Breakout!
  }else if(p.devTrait==="star"&&snaps>500&&p.ovr>=85&&p.age<=28&&RNG.ai()<Math.min(0.12,0.04+((hasChip95pp&&p.age<=26&&snaps>=500)?Math.max(0.01,chipUpgradeBoost*0.5):0))){
    p.devTrait="superstar";// Ascension!
  }
  if(!p.careerStats)p.careerStats={gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0,seasons:0,fumbles:0,punts:0,puntYds:0,proBowls:0,allPros:0};
  ["gp","snaps","passYds","passTD","int","rushYds","rushTD","recYds","recTD","rec","targets","drops","yac","sacksAllowed","tackles","sacks","defINT","fgM","fgA","fumbles","punts","puntYds"].forEach(function(k){p.careerStats[k]=(p.careerStats[k]||0)+(p.stats?p.stats[k]||0:0);});
  p.careerStats.seasons=(p.careerStats.seasons||0)+1;
  if(!p.careerStats.ovrHistory)p.careerStats.ovrHistory=[];
  p.careerStats.ovrHistory.push(p.ovr);
  // v95.9: Check trait milestones after career stat update
  p._newMilestones95=checkTraitMilestones95(p);
  p.stats={gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0,fumbles:0,punts:0,puntYds:0};
  setPlayerInjury92(p,null,0);
  p.pff=0;p.pffWeek=0;p.pffHistory=[];p.gameLog=[];
  var moraleReset=p.morale>=70?rng(-3,2):rng(-2,5);
  p.morale=cl((p.morale||70)+moraleReset,40,99);
  return p;
}
var DB = {
  name: "MrFootballDynasty", version: 1, db: null, ready: false,
  open: function() {
    return new Promise(function(resolve, reject) {
      if (DB.db) { DB.ready = true; return resolve(DB.db); }
      if (typeof indexedDB === "undefined") return reject("No IndexedDB");
      try {
        var req = indexedDB.open(DB.name, DB.version);
        req.onupgradeneeded = function(e) {
          var db = e.target.result;
          if (!db.objectStoreNames.contains("saves")) db.createObjectStore("saves", { keyPath: "id" });
          if (!db.objectStoreNames.contains("archive")) db.createObjectStore("archive", { keyPath: "seasonId" });
        };
        req.onsuccess = function(e) { DB.db = e.target.result; DB.ready = true; resolve(DB.db); };
        req.onerror = function() { reject("IDB Error"); };
      } catch(e) { reject(e); }
    });
  },
  write: function(store, item) {
    return new Promise(function(resolve, reject) {
      if (!DB.db) return reject("Vault Locked");
      try {
        var tx = DB.db.transaction([store], "readwrite");
        tx.objectStore(store).put(item);
        tx.oncomplete = function() { resolve(true); };
        tx.onerror = function(e) { reject(e); };
      } catch(e) { reject(e); }
    });
  },
  read: function(store, key) {
    return new Promise(function(resolve) {
      if (!DB.db) return resolve(null);
      try {
        var tx = DB.db.transaction([store], "readonly");
        var req = tx.objectStore(store).get(key);
        req.onsuccess = function() { resolve(req.result || null); };
        req.onerror = function() { resolve(null); };
      } catch(e) { resolve(null); }
    });
  },
  getAllKeys: function(store) {
    return new Promise(function(resolve) {
      if (!DB.db) return resolve([]);
      try {
        var tx = DB.db.transaction([store], "readonly");
        var req = tx.objectStore(store).getAllKeys();
        req.onsuccess = function() { resolve(req.result || []); };
      } catch(e) { resolve([]); }
    });
  },
  remove: function(store, key) {
    return new Promise(function(resolve) {
      if (!DB.db) return resolve(false);
      try {
        var tx = DB.db.transaction([store], "readwrite");
        tx.objectStore(store).delete(key);
        tx.oncomplete = function() { resolve(true); };
      } catch(e) { resolve(false); }
    });
  }
};
var ECS = {
  toMap: function(arr, key) {
    key = key || "id"; var map = {};
    for (var i = 0; i < arr.length; i++) map[arr[i][key]] = arr[i];
    return map;
  },
  toArray: function(map) {
    var arr = []; for (var k in map) if (map.hasOwnProperty(k)) arr.push(map[k]); return arr;
  },
  get: function(map, id) { return map[id] || null; }
};
var _save=null;
function compressHistory(hist){
  if(!hist||hist.length<=3) return hist;
  return hist.map(function(s,i){
    if(i>=hist.length-3) return s;// Keep recent 3 fully intact
    return {year:s.year,champ:s.champ,champId:s.champId,mvp:s.mvp,winner:s.winner,compressed:true};
  });
}
function compressSchedule(sched2,currentWeek,userId){
  if(!sched2)return sched2;
  return sched2.map(function(g){
    if(!g.result||!g.result.drives)return g;
    var isUserGame=g.home===userId||g.away===userId;
    var isRecent=g.week>=currentWeek-3;
    if(isUserGame||isRecent)return g;
    var r2=assign({},g.result);
    r2.driveSummary={count:r2.drives?r2.drives.length:0,stripped:true};
    delete r2.drives;
    return assign({},g,{result:r2});
  });
}
function saveG(d){
  try{
    _save=JSON.parse(JSON.stringify(d));
    if(DB.ready){
      var raw=JSON.stringify(_save);
      var compressed="LZW1:"+LZW.compress(raw);
      DB.write("saves",{id:"autosave",data:compressed,timestamp:Date.now(),version:SAVE_VERSION}).catch(function(){
        if(typeof window!=="undefined"&&window.storage&&window.storage.set){
          window.storage.set("mr-football-save",compressed).catch(function(){});
        }
      });
    } else if(typeof window!=="undefined"&&window.storage&&window.storage.set){
      var raw2=JSON.stringify(_save);
      var compressed2="LZW1:"+LZW.compress(raw2);
      window.storage.set("mr-football-save",compressed2).catch(function(){
        window.storage.set("mr-football-save",raw2).catch(function(){});
      });
    }
  }catch(e){}
}
function loadG(){return _save;}
function loadPersistent(cb){
  if(DB.ready){
    DB.read("saves","autosave").then(function(result){
      if(result&&result.data){
        try{
          var val=result.data;
          if(val.indexOf("LZW1:")===0) val=LZW.decompress(val.slice(5));
          _save=JSON.parse(val);cb(_save);
        }catch(e){
          _loadFromWindowStorage(cb);
        }
      } else { _loadFromWindowStorage(cb); }
    }).catch(function(){ _loadFromWindowStorage(cb); });
  } else { _loadFromWindowStorage(cb); }
}
function _loadFromWindowStorage(cb){
  if(typeof window!=="undefined"&&window.storage&&window.storage.get){
    window.storage.get("mr-football-save").then(function(result){
      if(result&&result.value){
        try{
          var val=result.value;
          if(val.indexOf("LZW1:")===0) val=LZW.decompress(val.slice(5));
          _save=JSON.parse(val);cb(_save);
        }catch(e){cb(null);}
      } else{cb(null);}
    }).catch(function(){cb(null);});
  }else{cb(null);}
}
function saveBoxScores(bs){
  if(typeof window!=="undefined"&&window.storage&&window.storage.set){
    try{window.storage.set("mr-football-boxscores",JSON.stringify(bs)).catch(function(){});}catch(e){}
  }
}
function loadBoxScores(cb){
  if(typeof window!=="undefined"&&window.storage&&window.storage.get){
    window.storage.get("mr-football-boxscores").then(function(result){
      if(result&&result.value){try{cb(JSON.parse(result.value));}catch(e){cb([]);}}
      else{cb([]);}
    }).catch(function(){cb([]);});
  }else{cb([]);}
}
var ToastContainer = memo(function(props){
  var toasts=props.toasts;var remove=props.remove;var onAction=props.onAction;
  return React.createElement("div",{style:S.toastArea},
    toasts.map(function(t){
      var color=t.type==="red"?T.red:t.type==="green"?T.green:t.type==="gold"?T.gold:T.blue;
      var hasAction=!!t.action;
      return React.createElement("div",{key:t.id,onClick:function(){if(hasAction&&onAction){onAction(t.action);remove(t.id);}},
        style:mS(S.toast,{borderLeft:"4px solid "+color,cursor:hasAction?"pointer":"default"})},
        React.createElement("div",{style:{fontSize:14}},t.type==="red"?"ðŸš¨":t.type==="green"?"âœ…":t.type==="gold"?"ðŸ†":"â„¹ï¸"),
        React.createElement("div",{style:{flex:1}},
          React.createElement("div",{style:{fontWeight:700,color:color,fontSize:9,marginBottom:1}},t.title||"UPDATE"),
          React.createElement("div",{style:{color:T.dim,fontSize:10,lineHeight:1.3}},t.text),
          hasAction?React.createElement("div",{style:{fontSize:8,color:T.faint,marginTop:2}},"TAP â†’"):null
        ),
        React.createElement("button",{onClick:function(e){e.stopPropagation();remove(t.id);},style:{marginLeft:"auto",background:"none",border:"none",color:T.faint,cursor:"pointer",fontSize:14}},"âœ•")
      );
    }),
    React.createElement("style",{},"@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}")
  );
});
var PlayoffBracket = memo(function(props){
  var br=props.bracket;var pr=props.powerRanks||[];var myId2=props.myId;
  if(!br) return null;
  var confAware=!!(br.seedsEC&&br.seedsWC);
  function getWinProb(hId,aId){
    if(!hId||!aId||pr.length===0) return null;
    var hR=pr.find(function(r){return r.id===hId;});
    var aR=pr.find(function(r){return r.id===aId;});
    if(!hR||!aR) return null;
    var total=hR.score+aR.score;
    return Math.round((hR.score/total)*100);
  }
  function MatchCard(game,label){
    if(!game||!game.home) return React.createElement("div",{style:{width:150,height:60,opacity:0.3,background:T.bg2,borderRadius:RAD.md,border:"1px dashed "+T.border,display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:T.faint}},"TBD");
    var h=game.home;var a=game.away||{abbr:"TBD",icon:"?",c1:T.dim,wins:0,losses:0};
    var res=game.result;var wID=game.winner?game.winner.id:null;
    var prob=(!res&&game.home&&game.away)?getWinProb(h.id,a.id):null;
    var isMyGame=wID&&wID===myId2;
    function TeamRow(tObj,score,isWin){
      return React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"2px 0",opacity:wID&&!isWin?0.5:1}},
        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:5}},
          React.createElement(TeamLogo,{team:tObj,size:16}),
          React.createElement("span",{style:{fontSize:11,fontWeight:700,color:isWin?T.gold:T.text}},tObj.abbr),
          React.createElement("span",{style:{fontSize:8,color:T.faint}},tObj.wins+"-"+tObj.losses)
        ),
        React.createElement("span",{style:{fontSize:12,fontWeight:isWin?900:400,color:isWin?T.gold:T.text}},score!==null?score:"")
      );
    }
    return React.createElement("div",{style:mS(S.matchCard,{borderColor:isMyGame?"rgba(251,191,36,0.6)":wID?T.gold:T.border,boxShadow:isMyGame?"0 0 15px rgba(251,191,36,0.2)":wID?"0 0 8px rgba(251,191,36,0.08)":"none"})},
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4,fontSize:8,color:T.faint,textTransform:"uppercase",fontWeight:700}},
        React.createElement("span",null,label),
        prob?React.createElement("span",{style:{color:T.cyan}},h.abbr+" "+prob+"%"):null
      ),
      TeamRow(h,res?res.home:null,wID===h.id),
      TeamRow(a,res?res.away:null,wID===a.id),
      wID?React.createElement("div",{style:{fontSize:8,color:isMyGame?T.gold:T.green,fontWeight:700,marginTop:3,textAlign:"center"}},"âœ… "+game.winner.icon+" "+game.winner.abbr+" advances"):null
    );
  }
  function BracketGroup(g1,g2,nextG,label1,label2,labelNext){
    return React.createElement("div",{style:{display:"flex",alignItems:"center"}},
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:20}},
        MatchCard(g1,label1),
        MatchCard(g2,label2)
      ),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",width:20}},
        React.createElement("div",{style:{flex:1,borderBottom:"1px solid "+T.dim,borderRight:"1px solid "+T.dim}}),
        React.createElement("div",{style:{flex:1,borderTop:"1px solid "+T.dim,borderRight:"1px solid "+T.dim}})
      ),
      React.createElement("div",{style:{width:15,height:1,background:T.dim}}),
      MatchCard(nextG,labelNext)
    );
  }
  var roundLabel=br.round==="QF"?(confAware?"CONFERENCE ROUND 1":"QUARTERFINALS"):br.round==="SF"?(confAware?"CONFERENCE FINALS":"SEMIFINALS"):br.round==="CHAMP"?"CHAMPIONSHIP":br.round==="DONE"?"ðŸ† CHAMPION CROWNED":"PLAYOFFS";
  var leftG1=br.qf[0],leftG2=confAware?br.qf[1]:br.qf[3],rightG1=confAware?br.qf[2]:br.qf[1],rightG2=confAware?br.qf[3]:br.qf[2];
  var leftL1=confAware?"EC #1 vs #4":"#1 vs #8";
  var leftL2=confAware?"EC #2 vs #3":"#4 vs #5";
  var leftNext=confAware?"EC FINAL":"SEMI A";
  var rightL1=confAware?"WC #1 vs #4":"#2 vs #7";
  var rightL2=confAware?"WC #2 vs #3":"#3 vs #6";
  var rightNext=confAware?"WC FINAL":"SEMI B";
  return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:12}},
    React.createElement("div",{style:{fontWeight:900,fontSize:14,color:T.gold,textAlign:"center",letterSpacing:2}},(br.year||"")+" PLAYOFFS â€” "+roundLabel),
    React.createElement("div",{style:S.bracketContainer},
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:40}},
        BracketGroup(leftG1,leftG2,br.sf[0],leftL1,leftL2,leftNext),
        BracketGroup(rightG1,rightG2,br.sf[1],rightL1,rightL2,rightNext)
      ),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",width:30,justifyContent:"center"}},
        React.createElement("div",{style:{height:120,borderRight:"1px solid "+T.dim,borderTop:"1px solid "+T.dim,borderBottom:"1px solid "+T.dim}}),
        React.createElement("div",{style:{width:15,height:1,background:T.dim,alignSelf:"flex-end",marginTop:-60}})
      ),
      React.createElement("div",{style:{marginLeft:0}},
        React.createElement("div",{style:{textAlign:"center",marginBottom:5,color:T.gold,fontSize:br.round==="DONE"?28:18}},br.round==="DONE"?"ðŸ†":"ðŸ†"),
        MatchCard(br.champ,"CHAMPIONSHIP"),
        br.round==="DONE"&&br.champ.winner?React.createElement("div",{style:{textAlign:"center",marginTop:8,fontWeight:900,fontSize:12,color:T.gold,letterSpacing:1}},br.champ.winner.icon+" "+br.champ.winner.name+" â€” CHAMPIONS!"):null
      )
    ),
    confAware?React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:4}},
      ["EC","WC"].map(function(confCode){
        var list=confCode==="EC"?(br.seedsEC||[]):(br.seedsWC||[]);
        return React.createElement("div",{key:confCode,style:{background:"rgba(255,255,255,0.02)",border:"1px solid "+T.border,borderRadius:6,padding:6}},
          React.createElement("div",{style:{fontSize:9,fontWeight:800,color:confCode==="EC"?T.cyan:T.orange,marginBottom:4,letterSpacing:1}},confCode+" SEEDS"),
          list.map(function(s){
            var isMe3=s.id===myId2;
            return React.createElement("div",{key:s.id,style:{display:"flex",alignItems:"center",gap:4,padding:"3px 4px",borderRadius:4,background:isMe3?"rgba(251,191,36,0.08)":"transparent",fontSize:10}},
              React.createElement("span",{style:{fontWeight:900,color:s.seed<=3?T.green:T.cyan,width:14}},s.seed),
              React.createElement("span",null,s.icon),
              React.createElement("span",{style:{fontWeight:isMe3?800:500,color:isMe3?T.gold:T.text}},s.abbr),
              s.isDivChamp?React.createElement("span",{style:{fontSize:7,color:T.green,fontWeight:800}},"DIV"):React.createElement("span",{style:{fontSize:7,color:T.orange,fontWeight:800}},"WC"),
              React.createElement("span",{style:{fontSize:8,color:T.faint,marginLeft:"auto"}},s.wins+"-"+s.losses)
            );
          })
        );
      })
    ):br.seeds?React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:4,marginTop:4}},
      br.seeds.map(function(s,i){
        var isMe3=s.id===myId2;
        return React.createElement("div",{key:i,style:{display:"flex",alignItems:"center",gap:4,padding:"3px 6px",borderRadius:4,background:isMe3?"rgba(251,191,36,0.08)":"rgba(255,255,255,0.02)",fontSize:10}},
          React.createElement("span",{style:{fontWeight:900,color:i<3?T.gold:T.dim,width:14}},i+1),
          React.createElement("span",null,s.icon),
          React.createElement("span",{style:{fontWeight:isMe3?800:500,color:isMe3?T.gold:T.text}},s.abbr),
          React.createElement("span",{style:{fontSize:8,color:T.faint,marginLeft:"auto"}},s.wins+"-"+s.losses)
        );
      })
    ):null
  );
});
function makePregameCard(hT2, aT2, homePR, awayPR, spread){
  var hRank = homePR && homePR.rank ? homePR.rank : "?";
  var aRank = awayPR && awayPR.rank ? awayPR.rank : "?";
  var hScore = homePR && homePR.score !== undefined ? Math.round(homePR.score * 100) / 100 : 0;
  var aScore = awayPR && awayPR.score !== undefined ? Math.round(awayPR.score * 100) / 100 : 0;
  var lineTxt = "Line: " + (spread >= 0 ? (hT2.abbr + " -" + spread) : (aT2.abbr + " -" + Math.abs(spread)));
  var prTxt = "Power: " + hScore + " vs " + aScore;
  var wrap = mS(S.studioCard, {position:"relative",marginBottom:10,padding:12,borderRadius:RAD.lg,boxShadow:SH.lg});
  function teamBox(t, rank){
    return React.createElement("div",{style:mS(S.card,{flex:1,minWidth:180,padding:10,borderRadius:RAD.md,border:"1px solid "+T.border,background:T.bg2})},
      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:10}},
        React.createElement(TeamLogo,{team:t,size:34}),
        React.createElement("div",null,
          React.createElement("div",{style:{fontSize:14,fontWeight:900,color:T.text,lineHeight:"16px"}},t.city+" "+t.name),
          React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:2}},"#"+rank+" â€¢ "+t.abbr)
        )
      )
    );
  }
  function kpi(label, value){
    return React.createElement("div",{style:mS(S.kpiBox,{padding:"8px 10px",borderRadius:RAD.md,border:"1px solid "+T.border,background:T.bg3,minWidth:140})},
      React.createElement("div",{style:{fontSize:10,color:T.dim,letterSpacing:0.6}},label),
      React.createElement("div",{style:{fontSize:12,fontWeight:900,color:T.text,marginTop:2}},value)
    );
  }
  return React.createElement("div",{style:wrap},
    React.createElement("div",{style:{fontSize:16,fontWeight:900,color:T.text,marginBottom:4,letterSpacing:0.6}},"PREGAME â€” "+hT2.abbr+" vs "+aT2.abbr),
    React.createElement("div",{style:{fontSize:11,color:T.dim,marginBottom:8}},"Broadcast Preview â€¢ Rankings, line, and a simple truth: trenches decide the movie."),
    React.createElement("div",{style:{display:"flex",alignItems:"stretch",justifyContent:"space-between",gap:10,marginTop:8,flexWrap:"wrap"}},teamBox(hT2,hRank),teamBox(aT2,aRank)),
    React.createElement("div",{style:{display:"flex",gap:10,marginTop:10,flexWrap:"wrap"}},kpi("POWER",prTxt),kpi("SPREAD",lineTxt),kpi("KEY","Protect QB â€¢ win 3rd down â€¢ finish red zone"))
  );
}
function makeHalftimeCard(hScore, aScore, hT2, aT2, qtrs){
  var hQ1=qtrs&&qtrs.h?qtrs.h[0]:null;var hQ2=qtrs&&qtrs.h?qtrs.h[1]:null;
  var aQ1=qtrs&&qtrs.a?qtrs.a[0]:null;var aQ2=qtrs&&qtrs.a?qtrs.a[1]:null;
  var firstHalfTxt=(hQ1!==null&&hQ2!==null&&aQ1!==null&&aQ2!==null)?("Q1 "+hQ1+"-"+aQ1+" â€¢ Q2 "+hQ2+"-"+aQ2):"First Half";
  var note="Keys: win 3rd down â€¢ protect the ball â€¢ red zone TDs";
  if(hScore<aScore)note="Keys: speed up tempo â€¢ attack mismatches â€¢ steal a possession";
  if(hScore>aScore)note="Keys: shorten game â€¢ force punts â€¢ no cheap turnovers";
  return React.createElement("div",{style:mS(S.studioCard,{marginTop:10,marginBottom:10,padding:12,borderRadius:RAD.lg,boxShadow:SH.lg})},
    React.createElement("div",{style:{fontSize:16,fontWeight:900,color:T.gold}},"HALFTIME SHOW"),
    React.createElement("div",{style:{fontSize:12,fontWeight:900,color:T.text,marginTop:4}},hT2.abbr+" "+hScore+" â€” "+aScore+" "+aT2.abbr),
    React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:2}},firstHalfTxt),
    React.createElement("div",{style:mS(S.card,{marginTop:10,padding:10,borderRadius:RAD.md,border:"1px solid "+T.border,background:T.bg2})},
      React.createElement("div",{style:{fontSize:10,color:T.dim,letterSpacing:0.6}},"COACHING NOTE"),
      React.createElement("div",{style:{fontSize:13,fontWeight:900,color:T.text,marginTop:6}},note),
      React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:6}},"Second half: one swing play changes everything.")
    )
  );
}
function extractHighlights(log){
  var highlights=[];if(!log)return highlights;
  for(var i=0;i<log.length;i++){
    var entry=log[i];if(!entry)continue;if(entry.indexOf("â”€â”€ Q")===0)continue;
    var yMatch=entry.match(/(\d+)yd/);var yds=yMatch?parseInt(yMatch[1],10):0;
    var isTD=entry.indexOf("TD")>=0;var isINT=entry.indexOf("INT")>=0;var isFUM=entry.indexOf("FUM")>=0;
    var isSack=String(entry).toLowerCase().indexOf("sack")>=0;
    if(isTD||isINT||isFUM||isSack){highlights.push({entry:entry,yds:yds,isTD:isTD,isTO:(isINT||isFUM),isSack:isSack,idx:i});}
  }
  highlights.sort(function(a,b){
    if(a.isTD&&!b.isTD)return -1;if(!a.isTD&&b.isTD)return 1;
    if(a.isTO&&!b.isTO)return -1;if(!a.isTO&&b.isTO)return 1;
    return(b.yds||0)-(a.yds||0);
  });
  return highlights.slice(0,3);
}
function makePostgameCard(res, highlights, hT2, aT2, leaders){
  var hScore=res&&res.home!==undefined?res.home:0;var aScore=res&&res.away!==undefined?res.away:0;
  var hL=leaders&&leaders.home?leaders.home:null;var aL=leaders&&leaders.away?leaders.away:null;
  function cleanLogEntry(s){if(!s)return "";return String(s).replace(/^[^\s]+\s+[A-Z]{2,4}:\s*/,"");}
  function hlRow(h){
    var tag=h.isTD?"TD":(h.isTO?"TO":(h.isSack?"SACK":"PLAY"));var clean=cleanLogEntry(h.entry);
    return React.createElement("div",{key:"hl_"+h.idx,style:{display:"flex",gap:10,alignItems:"flex-start",padding:"6px 0",borderBottom:"1px solid "+T.border}},
      React.createElement("div",{style:{minWidth:54,fontSize:10,fontWeight:900,color:(tag==="TD"?T.green:(tag==="TO"?T.red:T.cyan)),padding:"2px 6px",borderRadius:RAD.sm,border:"1px solid "+T.border,background:T.bg3,textAlign:"center"}},tag),
      React.createElement("div",{style:{flex:1,minWidth:0}},
        React.createElement("div",{style:{fontSize:12,fontWeight:900,color:T.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},clean),
        h.yds?React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:2}},h.yds+" yards"):null
      )
    );
  }
  function leaderLine(sideName, L){
    if(!L)return null;
    var pass=L.pass?(L.pass.name+" ("+L.pass.yds+"y, "+L.pass.td+"TD)"):"â€”";
    var rush=L.rush?(L.rush.name+" ("+L.rush.yds+"y, "+L.rush.td+"TD)"):"â€”";
    var topRec=(L.rec&&L.rec[0])?L.rec[0]:null;
    var rec=topRec?(topRec.name+" ("+topRec.rec+"rec, "+topRec.yds+"y, "+topRec.td+"TD)"):"â€”";
    return React.createElement("div",{style:mS(S.card,{padding:10,borderRadius:RAD.md,border:"1px solid "+T.border,background:T.bg2})},
      React.createElement("div",{style:{fontSize:10,color:T.dim,letterSpacing:0.6}},sideName+" STARS"),
      React.createElement("div",{style:{fontSize:12,color:T.text,marginTop:6}},React.createElement("span",{style:{color:T.dim}},"QB: "),pass),
      React.createElement("div",{style:{fontSize:12,color:T.text,marginTop:4}},React.createElement("span",{style:{color:T.dim}},"RB: "),rush),
      React.createElement("div",{style:{fontSize:12,color:T.text,marginTop:4}},React.createElement("span",{style:{color:T.dim}},"WR: "),rec)
    );
  }
  return React.createElement("div",{style:mS(S.studioCard,{marginTop:12,padding:12,borderRadius:RAD.lg,boxShadow:SH.lg})},
    React.createElement("div",{style:{fontSize:16,fontWeight:900,color:T.gold}},"POSTGAME â€” FINAL"),
    React.createElement("div",{style:{fontSize:12,fontWeight:900,color:T.text,marginTop:4}},hT2.abbr+" "+hScore+" â€” "+aScore+" "+aT2.abbr),
    React.createElement("div",{style:{display:"flex",gap:12,marginTop:10,flexWrap:"wrap"}},
      React.createElement("div",{style:mS(S.card,{flex:1,minWidth:260,padding:10,borderRadius:RAD.md,border:"1px solid "+T.border,background:T.bg2})},
        React.createElement("div",{style:{fontSize:10,color:T.dim,letterSpacing:0.6}},"TOP PLAYS"),
        (highlights&&highlights.length)?React.createElement("div",{style:{marginTop:6}},highlights.map(hlRow)):React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:8}},"No highlights found.")
      ),
      React.createElement("div",{style:{flex:1,minWidth:220,display:"flex",flexDirection:"column",gap:10}},leaderLine(hT2.abbr,hL),leaderLine(aT2.abbr,aL))
    )
  );
}
var S_RECAP={
  hero:{background:"linear-gradient(180deg,rgba(251,191,36,0.18) 0%,rgba(15,23,42,0) 100%)",padding:"50px 20px 30px",textAlign:"center",position:"relative",overflow:"hidden"},
  aCard:{background:"rgba(255,255,255,0.03)",border:"1px solid "+T.border,borderRadius:RAD.md,padding:10,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center"},
  grid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(130px, 1fr))",gap:10,marginBottom:20},
  sRow:{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid "+T.border,fontSize:11}
};
var SeasonRecap=memo(function(props){
  var history=props.history||[];var teams=props.teams||[];var sched=props.sched||[];
  var onNext=props.onNext;var onConfetti=props.onConfetti;var myId=props.myId||"";
  var entry=history[history.length-1];
  if(!entry)return React.createElement("div",{style:{padding:20}},"No season data available.");
  useEffect(function(){if(onConfetti)onConfetti(true);},[]);
  function handleShareChamp(){
    var champTeam=teams.find(function(t){return t.id===(entry.winnerId||entry.champId);});
    SHARE_CARD.generate({
      icon:"ðŸ†",teamIcon:entry.champ.icon||"ðŸˆ",teamName:entry.champ.name||"Champions",
      teamColor:(champTeam&&champTeam.color)||"#0f172a",
      headline:"WORLD CHAMPIONS â€” "+entry.year,
      season:entry.year,record:_champW+"-"+_champL,
      stats:[
        {label:"WINS",val:_champW},{label:"LOSSES",val:_champL},
        {label:"CHAMP SEASON",val:entry.year},
        {label:"DYNASTY",val:history.filter(function(h){return h.winnerId===myId||h.champId===myId;}).length+"xðŸ†"}
      ]
    },"dynasty-champ-"+entry.year);
  }
  function handleShareMyRecord(){
    var myRec=entry.teamRecords?entry.teamRecords.find(function(r){return r.id===myId;}):null;
    var myTeam=teams.find(function(t){return t.id===myId;});
    var isChamp=entry.winnerId===myId||entry.champId===myId;
    SHARE_CARD.generate({
      icon:isChamp?"ðŸ†":"ðŸ“Š",teamIcon:(myTeam&&myTeam.icon)||"ðŸˆ",
      teamName:(myTeam&&myTeam.name)||"My Team",
      teamColor:(myTeam&&myTeam.color)||"#0f172a",
      headline:isChamp?"WORLD CHAMPIONS â€” "+entry.year:(myRec?"Season "+entry.year+" â€” "+myRec.wins+"-"+myRec.losses:"Season "+entry.year),
      season:entry.year,record:myRec?myRec.wins+"-"+myRec.losses:"",
      stats:myRec?[
        {label:"WINS",val:myRec.wins},{label:"LOSSES",val:myRec.losses},
        {label:"PF",val:myRec.pf||"--"},{label:"PA",val:myRec.pa||"--"}
      ]:[]
    },"my-season-"+entry.year);
  }
  var allPlayers=[];
  var _champId=entry.winnerId||entry.champId;
  var _champRec=entry.teamRecords?entry.teamRecords.find(function(r){return r.id===_champId;}):null;
  var _champW=(entry.champ.w||0)||(_champRec?_champRec.wins:0);
  var _champL=(entry.champ.l||0)||(_champRec?_champRec.losses:0);
  if(!_champW&&!_champL&&sched&&sched.length>0){
    sched.forEach(function(g){if(!g.played||!g.result)return;
      if(g.home===_champId){if(g.result.home>g.result.away)_champW++;else _champL++;}
      else if(g.away===_champId){if(g.result.away>g.result.home)_champW++;else _champL++;}
    });
  }
  teams.forEach(function(t){t.roster.forEach(function(p){allPlayers.push(p);});});
  function findPlayer(name){return allPlayers.find(function(p){return p.name===name;})||null;}

  function hexToRgb(hex){
    var map={"#fbbf24":"251,191,36","#22d3ee":"34,211,238","#34d399":"52,211,153","#f97316":"249,115,22","#a855f7":"168,85,247","#60a5fa":"96,165,250","#ef4444":"239,68,68","#fb923c":"251,146,60"};
    return map[hex]||"255,255,255";
  }

  // Compute superlatives if not stored (old saves compat)
  var sg=entry.supGames||{};
  if(!sg.highScore&&sched.length>0){
    var hscore=0,bmargin=0,udiff=0;
    sched.forEach(function(g){
      if(!g.played||!g.result)return;
      var hT3=teams.find(function(t){return t.id===g.home;});
      var aT3=teams.find(function(t){return t.id===g.away;});
      if(!hT3||!aT3)return;
      var total=g.result.home+g.result.away;
      var margin=Math.abs(g.result.home-g.result.away);
      var winner=g.result.home>g.result.away?hT3:aT3;
      var loser=g.result.home>g.result.away?aT3:hT3;
      var winScore=Math.max(g.result.home,g.result.away);
      var loseScore=Math.min(g.result.home,g.result.away);
      if(total>hscore){hscore=total;sg.highScore={wTeam:winner.abbr,wIcon:winner.icon,wScore:winScore,lTeam:loser.abbr,lIcon:loser.icon,lScore:loseScore,total:total,week:g.week};}
      if(margin>bmargin){bmargin=margin;sg.blowout={wTeam:winner.abbr,wIcon:winner.icon,wScore:winScore,lTeam:loser.abbr,lIcon:loser.icon,lScore:loseScore,margin:margin,week:g.week};}
      var diff=(loser.wins||0)-(winner.wins||0);
      if(diff>udiff){udiff=diff;sg.upset={wTeam:winner.abbr,wIcon:winner.icon,wScore:winScore,lTeam:loser.abbr,lIcon:loser.icon,lScore:loseScore,diff:diff,week:g.week};}
    });
  }

  var cS2={borderRadius:RAD.lg,border:"1px solid "+T.border,background:"rgba(255,255,255,0.02)",padding:"16px"};
  var divider=React.createElement("div",{style:{height:"1px",background:"linear-gradient(90deg,transparent,"+T.border+",transparent)",margin:"20px 16px"}});

  function AwardCard(label,pDat,icon,accentColor){
    if(!pDat)return null;
    var isCoach=label==="COACH";
    var fp=isCoach?null:findPlayer(pDat.name);
    var subText=isCoach?(pDat.icon||"ðŸˆ")+" "+pDat.tm:(pDat.pos||"?")+" â€¢ "+pDat.tm;
    var pffVal=pDat.pff?Math.round(pDat.pff):"â€”";
    var pffColor=pDat.pff>=85?T.green:pDat.pff>=75?T.gold:T.text;
    return React.createElement("div",{style:assign({},cS2,{borderColor:accentColor+"40",background:"rgba("+hexToRgb(accentColor)+",0.04)",display:"flex",flexDirection:"column",alignItems:"center",gap:4,padding:"14px 10px"})},
      React.createElement("div",{style:{fontSize:9,color:accentColor,fontWeight:800,letterSpacing:2,marginBottom:4,textTransform:"uppercase"}},icon+" "+label),
      React.createElement("div",{style:{marginBottom:6}},fp?React.createElement(PlayerFace,{id:fp.id,morale:fp.morale||70,size:42,age:fp.age}):React.createElement("span",{style:{fontSize:32}},isCoach?"ðŸ§¢":"ðŸˆ")),
      React.createElement("div",{style:{fontWeight:800,fontSize:13,color:T.text,lineHeight:1.2,marginBottom:2,textAlign:"center"}},pDat.name),
      React.createElement("div",{style:{fontSize:10,color:T.dim,marginBottom:6,textAlign:"center"}},subText),
      isCoach
        ?React.createElement("div",{style:{fontSize:11,fontWeight:700,color:T.gold}},pDat.w+"-"+pDat.l+" Record")
        :React.createElement("div",{style:{textAlign:"center"}},
          React.createElement("div",{style:{fontSize:11,fontWeight:700,color:pffColor,marginBottom:2}},"MFDF "+pffVal+(pDat.gp?" | "+pDat.gp+" GP":"")),
          pDat.hl?React.createElement("div",{style:{fontSize:9,color:T.faint,lineHeight:1.5,maxWidth:130,marginTop:2}},pDat.hl):null
        ),
      pDat.runnerUp74?React.createElement("div",{style:{fontSize:8,color:T.dim,marginTop:6,borderTop:"1px solid "+T.border,paddingTop:4,width:"100%",textAlign:"center"}},
        "Runner-up: "+pDat.runnerUp74.name+" ("+pDat.runnerUp74.pos+", "+pDat.runnerUp74.tm+")"
      ):null
    );
  }

  function GameChip(sg2,label,icon,accent){
    if(!sg2)return React.createElement("div",{style:assign({},cS2,{opacity:0.35,textAlign:"center",padding:20})},React.createElement("div",{style:{fontSize:10,color:T.faint}},"No data"));
    return React.createElement("div",{style:assign({},cS2,{borderColor:accent+"40",background:"rgba("+hexToRgb(accent)+",0.03)"})},
      React.createElement("div",{style:{fontSize:9,color:accent,fontWeight:800,letterSpacing:1,marginBottom:8}},icon+" "+label+(sg2.week?" â€” WEEK "+sg2.week:"")),
      React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:16}},
        React.createElement("div",{style:{textAlign:"center"}},
          React.createElement("div",{style:{fontSize:22}},sg2.wIcon||"ðŸˆ"),
          React.createElement("div",{style:{fontSize:11,fontWeight:700,color:T.text,marginBottom:2}},sg2.wTeam),
          React.createElement("div",{style:{fontSize:26,fontWeight:900,color:accent,lineHeight:1}},sg2.wScore)
        ),
        React.createElement("div",{style:{fontSize:13,color:T.faint,fontWeight:800,letterSpacing:1}},"VS"),
        React.createElement("div",{style:{textAlign:"center"}},
          React.createElement("div",{style:{fontSize:22}},sg2.lIcon||"ðŸˆ"),
          React.createElement("div",{style:{fontSize:11,fontWeight:700,color:T.dim,marginBottom:2}},sg2.lTeam),
          React.createElement("div",{style:{fontSize:26,fontWeight:900,color:T.faint,lineHeight:1}},sg2.lScore)
        )
      ),
      label==="BIGGEST BLOWOUT"&&sg2.margin?React.createElement("div",{style:{textAlign:"center",fontSize:9,color:accent,fontWeight:700,marginTop:8,padding:"3px 8px",background:accent+"15",borderRadius:10,display:"inline-block",width:"100%"}},"Won by "+sg2.margin+" points"):null,
      label==="BIGGEST UPSET"&&sg2.diff?React.createElement("div",{style:{textAlign:"center",fontSize:9,color:accent,fontWeight:700,marginTop:8,padding:"3px 8px",background:accent+"15",borderRadius:10,display:"inline-block",width:"100%"}},"Underdog by "+sg2.diff+" wins"):null,
      label==="HIGHEST SCORING"&&sg2.total?React.createElement("div",{style:{textAlign:"center",fontSize:9,color:accent,fontWeight:700,marginTop:8,padding:"3px 8px",background:accent+"15",borderRadius:10,display:"inline-block",width:"100%"}},sg2.total+" combined points"):null
    );
  }

  var top5=entry.standings?entry.standings.slice(0,5):[];
  var bot5=entry.standings?entry.standings.slice(-5).reverse():[];
  var apPositions=entry.allPro1st?Object.keys(entry.allPro1st):[];

  return React.createElement("div",{style:{maxWidth:800,margin:"0 auto",paddingBottom:100}},

    // HERO
    React.createElement("div",{style:S_RECAP.hero},
      React.createElement("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:"radial-gradient(ellipse at 50% 0%,rgba(251,191,36,0.13) 0%,transparent 70%)"}}),
      React.createElement("div",{style:{position:"relative",zIndex:1}},
        React.createElement("div",{style:{fontSize:9,letterSpacing:6,color:T.gold,marginBottom:8,fontWeight:800,opacity:0.8,textTransform:"uppercase"}},"World Champions"),
        React.createElement("div",{style:{fontSize:48,fontWeight:900,color:"#fff",textShadow:"0 0 50px rgba(251,191,36,0.5)",lineHeight:1,letterSpacing:-1}},entry.champ.icon+" "+(entry.champ.name||"").toUpperCase()),
        React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:10,marginTop:14,flexWrap:"wrap"}},
          React.createElement("div",{style:{background:"rgba(251,191,36,0.12)",border:"1px solid rgba(251,191,36,0.3)",borderRadius:20,padding:"4px 14px",fontSize:11,color:T.gold,fontWeight:700}},entry.year+" SEASON"),
          React.createElement("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid "+T.border,borderRadius:20,padding:"4px 14px",fontSize:11,color:T.text,fontWeight:700}},_champW+"-"+_champL+" Record")
        ),
        React.createElement("div",{style:{marginTop:16,fontSize:48,filter:"drop-shadow(0 0 20px rgba(251,191,36,0.6))"}},"\uD83C\uDFC6"),
        // â”€â”€ SHARE_CARD Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:8,marginTop:14,flexWrap:"wrap"}},
          React.createElement("button",{
            onClick:handleShareChamp,
            title:"Download a shareable Championship card",
            style:{background:"rgba(251,191,36,0.15)",border:"1px solid rgba(251,191,36,0.5)",borderRadius:20,
              padding:"6px 16px",fontSize:10,color:"#fbbf24",fontWeight:700,cursor:"pointer",
              display:"flex",alignItems:"center",gap:4}
          },"ðŸ“¸ Share Championship Card"),
          myId?React.createElement("button",{
            onClick:handleShareMyRecord,
            title:"Download your season card",
            style:{background:"rgba(255,255,255,0.05)",border:"1px solid "+T.border,borderRadius:20,
              padding:"6px 16px",fontSize:10,color:T.dim,fontWeight:600,cursor:"pointer",
              display:"flex",alignItems:"center",gap:4}
          },"ðŸ“Š Share My Season"):null
        )
      )
    ),

    // AWARDS
    React.createElement("div",{style:{padding:"20px 16px 0"}},
      React.createElement("div",{style:{fontWeight:900,fontSize:13,color:T.gold,letterSpacing:2,marginBottom:12}},"\uD83C\uDFC5 HALL OF HARDWARE"),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(140px,1fr))",gap:10,marginBottom:4}},
        AwardCard("MVP",entry.mvp,"\uD83D\uDC51","#fbbf24"),
        AwardCard("OFF. PLAYER",entry.opoy||entry.stat,"\uD83C\uDFC8","#34d399"),
        AwardCard("DEF. PLAYER",entry.dpoy,"\uD83D\uDEE1\uFE0F","#60a5fa"),
        AwardCard("ROOKIE",entry.roy,"\u2B50","#a855f7"),
        AwardCard("COACH",entry.coty,"\uD83E\uDDE2","#f97316")
      )
    ),

    divider,

    // SEASON HIGHLIGHTS
    React.createElement("div",{style:{padding:"0 16px"}},
      React.createElement("div",{style:{fontWeight:900,fontSize:13,color:T.cyan,letterSpacing:2,marginBottom:12}},"\uD83D\uDCCA SEASON HIGHLIGHTS"),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:10,marginBottom:4}},
        GameChip(sg.highScore,"HIGHEST SCORING","\uD83D\uDD25",T.gold),
        GameChip(sg.blowout,"BIGGEST BLOWOUT","\uD83D\uDCA5","#fb923c"),
        GameChip(sg.upset,"BIGGEST UPSET","\uD83D\uDE31",T.purple)
      )
    ),

    divider,

    // FINAL STANDINGS
    React.createElement("div",{style:{padding:"0 16px"}},
      React.createElement("div",{style:{fontWeight:900,fontSize:13,color:T.green,letterSpacing:2,marginBottom:12}},"\uD83C\uDFC6 FINAL STANDINGS"),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:4}},
        React.createElement("div",{style:assign({},cS2,{borderColor:"rgba(52,211,153,0.3)"})},
          React.createElement("div",{style:{fontSize:9,color:T.green,fontWeight:800,letterSpacing:1,marginBottom:8}},"\uD83E\uDD47 TOP 5"),
          top5.map(function(t,i){
            return React.createElement("div",{key:i,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:i<4?"1px solid "+T.border:"none"}},
              React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center"}},
                React.createElement("span",{style:{fontSize:10,color:T.faint,minWidth:16}},i+1+"."),
                React.createElement("span",{style:{fontSize:14}},t.i),
                React.createElement("span",{style:{fontSize:11,fontWeight:i===0?800:600,color:i===0?T.gold:T.text}},t.a)
              ),
              React.createElement("span",{style:{fontSize:11,fontWeight:700,color:i===0?T.gold:T.text}},t.w+"-"+t.l)
            );
          })
        ),
        React.createElement("div",{style:assign({},cS2,{borderColor:"rgba(239,68,68,0.3)"})},
          React.createElement("div",{style:{fontSize:9,color:T.red,fontWeight:800,letterSpacing:1,marginBottom:8}},"\uD83D\uDCC9 BOTTOM 5"),
          bot5.map(function(t,i){
            return React.createElement("div",{key:i,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:i<4?"1px solid "+T.border:"none"}},
              React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center"}},
                React.createElement("span",{style:{fontSize:14}},t.i),
                React.createElement("span",{style:{fontSize:11,color:T.dim}},t.a)
              ),
              React.createElement("span",{style:{fontSize:11,color:T.red}},t.w+"-"+t.l)
            );
          })
        )
      )
    ),

    divider,

    // ALL-PRO FIRST TEAM
    entry.allPro1st&&apPositions.length>0?React.createElement("div",{style:{padding:"0 16px"}},
      React.createElement("div",{style:{fontWeight:900,fontSize:13,color:T.blue,letterSpacing:2,marginBottom:12}},"\u2B50 ALL-PRO FIRST TEAM"),
      React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:4}},
        apPositions.map(function(pos){
          var picks=entry.allPro1st[pos]||[];
          return picks.map(function(p,pi){
            return React.createElement("div",{key:pos+pi,style:{display:"flex",alignItems:"center",gap:5,padding:"4px 10px",borderRadius:20,background:"rgba(96,165,250,0.07)",border:"1px solid rgba(96,165,250,0.2)"}},
              React.createElement("span",{style:{fontSize:9,fontWeight:800,color:T.blue}},pos),
              React.createElement("span",{style:{fontSize:10,fontWeight:700,color:T.text}},p.name),
              React.createElement("span",{style:{fontSize:8,color:T.faint}},p.tm),
              p.pff?React.createElement("span",{style:{fontSize:8,color:T.gold,fontWeight:700}},"MFDF "+Math.round(p.pff)):null
            );
          });
        })
      )
    ):null,

    divider,

    // SEASON GOALS
    entry.goalResults?React.createElement("div",{style:{padding:"0 16px"}},
      React.createElement("div",{style:{fontWeight:900,fontSize:13,color:T.orange,letterSpacing:2,marginBottom:12}},"\uD83C\uDFAF SEASON GOALS"),
      React.createElement("div",{style:assign({},cS2,{marginBottom:4})},
        (entry.goalResults.completed||[]).length===0&&(entry.goalResults.failed||[]).length===0
          ?React.createElement("div",{style:{color:T.dim,fontSize:11,textAlign:"center",padding:8}},"No goals set this season")
          :null,
        (entry.goalResults.completed||[]).map(function(g,i){
          return React.createElement("div",{key:"gc"+i,style:{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid "+T.border,alignItems:"center"}},
            React.createElement("span",{style:{color:T.green,fontWeight:600,fontSize:11}},"âœ… "+(g.playerName?g.playerName+": ":g.layer==="owner"?"ðŸ›ï¸ ":"ðŸ“‹ ")+g.label),
            React.createElement("span",{style:{fontSize:10,color:T.green,fontWeight:800,background:"rgba(52,211,153,0.12)",padding:"2px 8px",borderRadius:10}},"MET")
          );
        }),
        (entry.goalResults.failed||[]).map(function(g,i){
          return React.createElement("div",{key:"gf"+i,style:{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid "+T.border,alignItems:"center",opacity:0.7}},
            React.createElement("span",{style:{color:T.red,fontSize:11}},"âŒ "+(g.playerName?g.playerName+": ":g.layer==="owner"?"ðŸ›ï¸ ":"ðŸ“‹ ")+g.label),
            React.createElement("span",{style:{fontSize:10,color:T.red,fontWeight:800,background:"rgba(239,68,68,0.12)",padding:"2px 8px",borderRadius:10}},"MISSED")
          );
        })
      )
    ):null,

    // CTA
    React.createElement("div",{style:{padding:"20px 16px 0"}},
      React.createElement("button",{onClick:onNext,style:mS(S.btn,S.btnPrimary,{width:"100%",padding:"18px 20px",fontSize:15,boxShadow:SH.glow,borderRadius:RAD.lg,letterSpacing:1,fontWeight:800})},
        "BEGIN OFFSEASON \u2192"
      )
    )
  );
});
var LEDGER={
  log:function(ledger,type,teamId,summary,data,season,week,phase){
    var entry={id:U(),tick:(season||0)+"-W"+(week||0),season:season||0,week:week||0,
      phase:phase||"",type:type,teamId:teamId,summary:summary,data:data||{}};
    return [entry].concat(ledger||[]).slice(0,500);
  },
  getByTeam:function(ledger,teamId){
    return (ledger||[]).filter(function(e){return e.teamId===teamId;});
  },
  getByType:function(ledger,type){
    return (ledger||[]).filter(function(e){return e.type===type;});
  }
};
var EXPLAIN={
  trade:function(offerVal,askVal,capSpace,aiTeam){
    var gap=askVal-offerVal;
    if(capSpace<0)return {res:false,reason:"CAP_HELL",text:aiTeam+" physically cannot afford this contract."};
    if(gap>500)return {res:false,reason:"LOWBALL",text:"That offer is insulting. "+aiTeam+" need way more value."};
    if(gap>100)return {res:false,reason:"LIGHT",text:"Value is light. "+aiTeam+" want a mid-round pick sweetener."};
    if(gap>0)return {res:false,reason:"CLOSE",text:"Very close, but "+aiTeam+" need a bit more to pull the trigger."};
    return {res:true,reason:"FAIR",text:"This helps "+aiTeam+". Deal."};
  },
  game:function(recap,myTeam,oppTeam,won){
    var factors=[];
    if(recap.pressureRate>=65)factors.push("OL dominated: "+recap.pressureRate+"% pocket safety");
    else if(recap.pressureRate<=35)factors.push("OL got mauled: only "+recap.pressureRate+"% clean pockets");
    if(recap.coverageWin>=65)factors.push("Secondary locked down: "+recap.coverageWin+"% coverage win rate");
    else if(recap.coverageWin<=35)factors.push("DBs got torched: "+recap.coverageWin+"% coverage win rate");
    if(recap.runLaneAdv>=60)factors.push("Run game ate: "+recap.runLaneAdv+"% lane advantage");
    else if(recap.runLaneAdv<=35)factors.push("Run game was DOA: "+recap.runLaneAdv+"% lane advantage");
    if(recap.oppTurnovers>=2)factors.push("Forced "+recap.oppTurnovers+" turnovers â€” defense created chaos");
    else if(recap.turnovers>=2)factors.push("Gave away "+recap.turnovers+" turnovers â€” self-inflicted damage");
    if(recap.rzEff>=60)factors.push("Red zone: "+recap.rzEff+"% TD rate (finishing drives)");
    else if(recap.rzEff<=25&&recap.score>0)factors.push("Red zone stalled: only "+recap.rzEff+"% TD rate");
    var top3=factors.slice(0,3);
    if(top3.length===0)top3.push(won?"Solid, balanced performance":"Outplayed across the board");
    return {factors:top3,fix:recap.fix,
      text:(won?myTeam+" won":"Lost")+" "+recap.score+"-"+recap.oppScore+". "+top3[0]+"."};
  }
};
function AppCore(){
  var _s=useState("title"),screen=_s[0],setScreen=_s[1];
  var _pdm=useState(null),pendingDraftMode=_pdm[0],setPendingDraftMode=_pdm[1]; // v80.2: stores chosen draft mode while FO setup runs
  var _foSC=useState(null),foSetupCandidates=_foSC[0],setFoSetupCandidates=_foSC[1]; // v80.2: hiring candidates on FO setup screen
  var _foSS=useState([]),foSetupStaff=_foSS[0],setFoSetupStaff=_foSS[1]; // v80.2: staff hired on FO setup screen
  var _ggTab=useState("basics"),ggTab=_ggTab[0],setGgTab=_ggTab[1]; // v80.3: active tab in game guide screen â€” must be top-level (Rules of Hooks)
  var ggTouchX=useRef(null); // v80.4: swipe gesture tracking for game guide
  var _ggScrolled=useState(false),ggScrolled=_ggScrolled[0],setGgScrolled=_ggScrolled[1]; // v80.5: tracks if user has scrolled on current tab
  var _foET=useState("gm"),foExplainTab=_foET[0],setFoExplainTab=_foET[1]; // v80.6: active role tab on FO explainer â€” top-level (Rules of Hooks)
  var _mvf=useState("All"),musicVibeFilter=_mvf[0],setMusicVibeFilter=_mvf[1];// v80.20: Music screen vibe filter
  var _t=useState([]),teams=_t[0],setTeams=_t[1];
  var _m=useState(null),myId=_m[0],setMyId=_m[1];
  var _sc=useState([]),sched=_sc[0],setSched=_sc[1];
  var _sn=useState({year:2026,week:1,phase:"regular",ledger:[]}),season=_sn[0],setSeason=_sn[1];
  var _dc=useState([]),dc=_dc[0],setDC=_dc[1];
  var _dcNarr=useState(null),draftNarrative76=_dcNarr[0],setDraftNarrative76=_dcNarr[1];// v76: Draft Class Storylines
  var _udfa76=useState(null),udfaPool76=_udfa76[0],setUdfaPool76=_udfa76[1];// v76: UDFA mini-game pool
  var _filmBD77=useState(null),filmBreakdown77=_filmBD77[0],setFilmBreakdown77=_filmBD77[1];// v77: Film breakdown
  var _negot77=useState(null),holdoutNegot77=_negot77[0],setHoldoutNegot77=_negot77[1];// v77: Holdout negotiation
  var _gamePlan77=useState({off:"balanced",def:"bend_dont_break"}),gamePlan77=_gamePlan77[0],setGamePlan77=_gamePlan77[1];// v77: Game plan
  var _powerRank77=useState(null),powerRankShow77=_powerRank77[0],setPowerRankShow77=_powerRank77[1];// v77: Power rankings show
  var _mfsnWeekly975=useState(null),mfsnWeekly975=_mfsnWeekly975[0],setMfsnWeekly975=_mfsnWeekly975[1];// v97.5: MFSN weekly show (transient)
  var _scoutUsed78=useState([]),scoutUsed78=_scoutUsed78[0],setScoutUsed78=_scoutUsed78[1];// v78: Scouted regions
  var _challenges78=useState(null),challenges78=_challenges78[0],setChallenges78=_challenges78[1];// v78: Weekly challenges
  var _challenge3xNext96=useState(false),challenge3xNext96=_challenge3xNext96[0],setChallenge3xNext96=_challenge3xNext96[1];// v96.1: 3x boost from focused challenge
  var _newsTicker78=useState([]),newsTicker78=_newsTicker78[0],setNewsTicker78=_newsTicker78[1];// v78: News ticker items
  var _frontOffice78=useState([]),frontOffice78=_frontOffice78[0],setFrontOffice78=_frontOffice78[1];// v78: Staff members
  var _foCandidates78=useState(null),foCandidates78=_foCandidates78[0],setFoCandidates78=_foCandidates78[1];// v78: Hiring candidates
  var _officePage79=useState("staff"),officePage79=_officePage79[0],setOfficePage79=_officePage79[1];// v79: "staff" or "warRoom"
  var _warRoomTab79=useState("analytics"),warRoomTab79=_warRoomTab79[0],setWarRoomTab79=_warRoomTab79[1];// v79: analytics|scouting|challenges
  var _draftShortlist79=useState([]),draftShortlist79=_draftShortlist79[0],setDraftShortlist79=_draftShortlist79[1];// v79: War Room shortlisted prospect IDs
  var _warRoomFlags79=useState({}),warRoomFlags79=_warRoomFlags79[0],setWarRoomFlags79=_warRoomFlags79[1];// v79: {prospectId: "target"|"reach"|"avoid"}
  var _mfsnGrade80=useState(null),mfsnDraftGrade80=_mfsnGrade80[0],setMfsnDraftGrade80=_mfsnGrade80[1];// v80: Current MFSN draft grade card
  var _draftPresser975=useState(null),draftPresser975=_draftPresser975[0],setDraftPresser975=_draftPresser975[1];// v97.5: post-draft press conference (transient)
  var _mfsnHistory80=useState([]),mfsnGradeHistory80=_mfsnHistory80[0],setMfsnGradeHistory80=_mfsnHistory80[1];// v80: All draft grades
  var _seasonPreds80=useState(null),seasonPreds80=_seasonPreds80[0],setSeasonPreds80=_seasonPreds80[1];// v80: Season predictions
  var _breakouts80=useState([]),breakouts80=_breakouts80[0],setBreakouts80=_breakouts80[1];// v80: Breakout candidates
  var _mentors80=useState({}),mentorships80=_mentors80[0],setMentorships80=_mentors80[1];// v80: {mentorId: menteeId}
  var _defMoments80=useState({}),defMoments80=_defMoments80[0],setDefMoments80=_defMoments80[1];// v80: {playerId: [badges]}
  var _offseasonNews80=useState([]),offseasonNews80=_offseasonNews80[0],setOffseasonNews80=_offseasonNews80[1];// v80: Offseason news cycle
  var _ownerPatience80=useState(100),ownerPatience80=_ownerPatience80[0],setOwnerPatience80=_ownerPatience80[1];// v80: 0-100 patience bar
  var _holdoutStage80=useState({}),holdoutStages80=_holdoutStage80[0],setHoldoutStages80=_holdoutStage80[1];// v80: {playerId: stage 1-5}
  var _scoutBudget81=useState({sec:2,big10:2,big12:1,acc:1,pac12:1,other:1}),scoutBudget81=_scoutBudget81[0],setScoutBudget81=_scoutBudget81[1];// v81: Regional scout budget (10 pts)
  var _staffPoach81=useState([]),staffPoachTargets81=_staffPoach81[0],setStaffPoachTargets81=_staffPoach81[1];// v81: FO staff poach targets
  var _ownerMeeting81=useState(null),ownerMeeting81=_ownerMeeting81[0],setOwnerMeeting81=_ownerMeeting81[1];// v81: Owner meeting modal data
  var _ownerPenalty81=useState(null),ownerPenalty81=_ownerPenalty81[0],setOwnerPenalty81=_ownerPenalty81[1];// v81: Active owner penalty
  var _ultimatum81=useState(null),ultimatumDeadline81=_ultimatum81[0],setUltimatumDeadline81=_ultimatum81[1];// v81: {type,week} deadline
  var _coachTree81=useState({}),coachSkillTree81=_coachTree81[0],setCoachSkillTree81=_coachTree81[1];// v81: {coachId:{branch,tier,archForLookup}}
  var _osEvents81=useState([]),offseasonEvents81=_osEvents81[0],setOffseasonEvents81=_osEvents81[1];// v81: Interactive offseason events
  var _activeOSE81=useState(null),activeOSEvent81=_activeOSE81[0],setActiveOSEvent81=_activeOSE81[1];// v81: Current displayed event
  var _dgYear81=useState(null),draftGradeYear81=_dgYear81[0],setDraftGradeYear81=_dgYear81[1];// v81: Selected draft grade year
  var _mentorView81=useState("active"),mentorView81=_mentorView81[0],setMentorView81=_mentorView81[1];// v81: mentors sub-view
  var _timeExp81=useState({}),timelineExpanded81=_timeExp81[0],setTimelineExpanded81=_timeExp81[1];// v81: {year:true/false}
  var _prHist81=useState([]),prHistory81=_prHist81[0],setPrHistory81=_prHist81[1];// v81: User weekly PR rank history
  var _capRTab81=useState("eligible"),capRestructTab=_capRTab81[0],setCapRestructTab=_capRTab81[1];// v81: Cap restructure sub-tab
  var _fa=useState([]),fas=_fa[0],setFAs=_fa[1];
  var _sg=useState(null),selGame=_sg[0],setSelGame=_sg[1];
  var _dp=useState(0),dPk=_dp[0],setDPk=_dp[1];
  var _dBoard=useState([]),draftBoard=_dBoard[0],setDraftBoard=_dBoard[1];
  var _tb=useState("home"),tab=_tb[0],setTab=_tb[1];
  var _pf=useState("ALL"),posF=_pf[0],setPosF=_pf[1];
  var _nw=useState([]),news=_nw[0],setNews=_nw[1];
  var _toasts=useState([]),toasts=_toasts[0],setToasts=_toasts[1];
  var _hi=useState([]),history=_hi[0],setHistory=_hi[1];
  var _tti=useState(null),tradeTeamId=_tti[0],setTTI=_tti[1];
  var _tmp=useState([]),tMyP=_tmp[0],setTMP=_tmp[1];
  var _tap=useState([]),tAiP=_tap[0],setTAP=_tap[1];
  var _tmpk=useState([]),tMyPk=_tmpk[0],setTMPk=_tmpk[1];
  var _tapk=useState([]),tAiPk=_tapk[0],setTAPk=_tapk[1];
  var _tmypkc972=useState({}),tMyPkCond972=_tmypkc972[0],setTMyPkCond972=_tmypkc972[1];// v97.2: manual trade conditional pick builder (your picks)
  var _taipkc972=useState({}),tAiPkCond972=_taipkc972[0],setTAiPkCond972=_taipkc972[1];// v97.2: manual trade conditional pick builder (their picks)
  var _tmsg=useState(""),tMsg=_tmsg[0],setTMsg=_tmsg[1];
  var _pendingCounter971=useState(null),pendingCounter971=_pendingCounter971[0],setPendingCounter971=_pendingCounter971[1];// v97.1: inbox AI counter-offer carry-over for Trade tab
  var _shopOff=useState([]),shopOffers=_shopOff[0],setShopOffers=_shopOff[1];
  var _sReport=useState(null),seasonReport=_sReport[0],setSeasonReport=_sReport[1];
  var _psReport=useState(null),preseasonReport=_psReport[0],setPreseasonReport=_psReport[1];
  var _posBattles974=useState([]),posBattles974=_posBattles974[0],setPosBattles974=_posBattles974[1];// v97.4: preseason position battles
  var _fitDrill=useState(null),fitDrilldown=_fitDrill[0],setFitDrilldown=_fitDrill[1];// v87: weekly identity fit drilldown modal payload
  var _fitDrillFilter=useState("all"),fitDrillFilter=_fitDrillFilter[0],setFitDrillFilter=_fitDrillFilter[1];// all|up|down
  var _forecastOffSel84=useState(""),forecastOffSel84=_forecastOffSel84[0],setForecastOffSel84=_forecastOffSel84[1];
  var _forecastDefSel84=useState(""),forecastDefSel84=_forecastDefSel84[0],setForecastDefSel84=_forecastDefSel84[1];
  var _gmShortlist84=useState(null),gmShortlist84=_gmShortlist84[0],setGmShortlist84=_gmShortlist84[1];// v85: transient GM shortlist targets
  var _og=useState([]),ownerGoals=_og[0],setOwnerGoals=_og[1];
  var _cg=useState([]),coachGoals=_cg[0],setCoachGoals=_cg[1];
  var _pg=useState([]),playerGoals=_pg[0],setPlayerGoals=_pg[1];
  var _st=useState({blowoutLosses:0,shutoutLosses:0,bestWinStreak:0,currentStreak:0,madePlayoffs:false,isChamp:false}),seasonTracking=_st[0],setSeasonTracking=_st[1];
  var _leg=useState(false),showLegacy=_leg[0],setShowLegacy=_leg[1];
  var _showHelp=useState(false),showHelp=_showHelp[0],setShowHelp=_showHelp[1];
  var _unlocks=useState(DEFAULT_UNLOCKS),unlocks=_unlocks[0],setUnlocks=_unlocks[1];
  var _importModal=useState(false),importModal=_importModal[0],setImportModal=_importModal[1];
  var _importStr=useState(""),importStr=_importStr[0],setImportStr=_importStr[1];
  var _showKbHelp=useState(false),showKbHelp=_showKbHelp[0],setShowKbHelp=_showKbHelp[1];
  var _showScoutSpend95=useState(false),showScoutSpend95=_showScoutSpend95[0],setShowScoutSpend95=_showScoutSpend95[1];// v95.1: Scout spend panel toggle
  var _autoSaveInd=useState(""),autoSaveInd=_autoSaveInd[0],setAutoSaveInd=_autoSaveInd[1];
  var _fieldGuide=useState(null),fieldGuide=_fieldGuide[0],setFieldGuide=_fieldGuide[1];
  var _pendDraft=useState(null),pendingDraft=_pendDraft[0],setPendingDraft=_pendDraft[1];
  var seenGuidesRef=useRef({});

// â•â•â• v98 GUIDE STYLES â•â•â•
var GS={
  overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:95,background:"rgba(2,6,18,0.97)",display:"flex",alignItems:"center",justifyContent:"center",padding:10,backdropFilter:"blur(4px)"},
  modal:{maxWidth:620,width:"100%",maxHeight:"92vh",overflowY:"auto",background:"linear-gradient(180deg,#0c1a30 0%,#0f1520 40%,#131b2e 100%)",borderRadius:12,border:"1px solid rgba(251,191,36,0.35)",boxShadow:"0 0 60px rgba(251,191,36,0.12), 0 20px 60px rgba(0,0,0,0.6)",padding:0},
  hdr:{background:"linear-gradient(180deg,rgba(251,191,36,0.12),rgba(251,191,36,0.02))",padding:"20px 24px 14px",borderBottom:"2px solid rgba(251,191,36,0.4)",position:"relative"},
  hdrGold:{position:"absolute",top:0,left:0,right:0,height:3,background:"linear-gradient(90deg,transparent,#fbbf24,transparent)"},
  hdrBadge:{display:"inline-block",fontSize:8,fontWeight:800,letterSpacing:2,color:"#fbbf24",background:"rgba(251,191,36,0.12)",border:"1px solid rgba(251,191,36,0.3)",padding:"3px 10px",borderRadius:3,marginBottom:8,textTransform:"uppercase"},
  hdrTitle:{fontSize:22,fontWeight:900,color:"#fbbf24",letterSpacing:1,lineHeight:1.2},
  hdrSub:{fontSize:11,color:"#94a3b8",marginTop:4,fontStyle:"italic"},
  body:{padding:"16px 24px 8px",fontSize:11,color:"#f1f5f9",lineHeight:1.75},
  sec:{fontWeight:800,fontSize:13,letterSpacing:1.5,textTransform:"uppercase",color:"#fbbf24",marginTop:20,marginBottom:8,paddingLeft:12,borderLeft:"3px solid #fbbf24",lineHeight:1.3},
  secAlt:function(c){return{fontWeight:800,fontSize:13,letterSpacing:1.5,textTransform:"uppercase",color:c,marginTop:20,marginBottom:8,paddingLeft:12,borderLeft:"3px solid "+c,lineHeight:1.3};},
  intel:{background:"rgba(251,191,36,0.07)",border:"1px solid rgba(251,191,36,0.22)",borderRadius:8,padding:"10px 14px",marginBottom:12,fontSize:10,lineHeight:1.65,color:"#e2e8f0"},
  intelLabel:{fontSize:9,fontWeight:800,letterSpacing:2,color:"#fbbf24",marginBottom:4,textTransform:"uppercase"},
  tip:{background:"rgba(34,211,238,0.07)",border:"1px solid rgba(34,211,238,0.25)",borderRadius:8,padding:"8px 12px",marginBottom:12,fontSize:10,color:"#67e8f9",lineHeight:1.5},
  tipLabel:{fontSize:9,fontWeight:800,letterSpacing:2,color:"#22d3ee",marginBottom:3},
  warn:{background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.25)",borderRadius:8,padding:"8px 12px",marginBottom:12,fontSize:10,color:"#fca5a5",lineHeight:1.5},
  warnLabel:{fontSize:9,fontWeight:800,letterSpacing:2,color:"#f87171",marginBottom:3},
  p:{color:"#cbd5e1",marginBottom:10,lineHeight:1.7},
  row:{display:"flex",gap:6,marginBottom:4,alignItems:"flex-start"},
  dot:{width:5,height:5,borderRadius:"50%",background:"#fbbf24",flexShrink:0,marginTop:6},
  dotCyan:{width:5,height:5,borderRadius:"50%",background:"#22d3ee",flexShrink:0,marginTop:6},
  li:{color:"#cbd5e1",fontSize:10,flex:1,lineHeight:1.55},
  tbl:{width:"100%",borderCollapse:"collapse",marginBottom:12,fontSize:10},
  th:{textAlign:"left",padding:"6px 8px",fontWeight:700,fontSize:9,letterSpacing:1,color:"#fbbf24",borderBottom:"2px solid rgba(251,191,36,0.3)",textTransform:"uppercase",background:"rgba(251,191,36,0.05)"},
  td:{padding:"5px 8px",color:"#cbd5e1",borderBottom:"1px solid rgba(255,255,255,0.07)"},
  footer:{padding:"14px 24px",borderTop:"2px solid rgba(251,191,36,0.25)",background:"rgba(251,191,36,0.04)",display:"flex",justifyContent:"center"},
  closeBtn:{padding:"10px 24px",fontSize:12,fontWeight:800,letterSpacing:1,borderRadius:8,cursor:"pointer",border:"1px solid rgba(251,191,36,0.4)",background:"linear-gradient(135deg,rgba(251,191,36,0.15),rgba(251,191,36,0.06))",color:"#fbbf24",transition:"all 0.15s"},
  goldBtn:{padding:"10px 24px",fontSize:12,fontWeight:800,letterSpacing:1,borderRadius:8,cursor:"pointer",border:"none",background:"linear-gradient(135deg,#fbbf24,#d97706)",color:"#0f172a",transition:"all 0.15s"},
  divider:{height:1,background:"linear-gradient(90deg,transparent,rgba(251,191,36,0.25),transparent)",margin:"16px 0"},
  grid2:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:10},
  grid3:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6,marginBottom:10},
  chip:{padding:"4px 8px",borderRadius:5,background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",fontSize:9,color:"#e2e8f0",lineHeight:1.4},
  num:{fontSize:20,fontWeight:900,color:"#fbbf24",lineHeight:1},
  numLabel:{fontSize:8,color:"#94a3b8",letterSpacing:1,marginTop:2,textTransform:"uppercase"}
};

  function showGuide(key){if(!seenGuidesRef.current[key]){seenGuidesRef.current[key]=true;setFieldGuide(key);}}
  var _wkShow=useState(null),weekShow=_wkShow[0],setWeekShow=_wkShow[1];
  var _almDrill=useState(null),almDrill=_almDrill[0],setAlmDrill=_almDrill[1];// v47: Almanac season drill-down
  var _titleCar=useState(0),titleCarIdx=_titleCar[0],setTitleCarIdx=_titleCar[1];
  var _tickerIdx=useState(0),tickerIdx=_tickerIdx[0],setTickerIdx=_tickerIdx[1];
  var _rDensity=useState("normal"),rDensity=_rDensity[0],setRDensity=_rDensity[1];
  var _recCat=useState("passYds"),recCat=_recCat[0],setRecCat=_recCat[1];
  var _rSort=useState("ovr"),rSort=_rSort[0],setRSort=_rSort[1];
  var _showScanlines=useState(true),showScanlines=_showScanlines[0],setShowScanlines=_showScanlines[1];
  var _wkShowExpand=useState(false),wkShowExpand=_wkShowExpand[0],setWkShowExpand=_wkShowExpand[1];
  var _draftSort=useState("hypeOvr"),draftSort=_draftSort[0],setDraftSort=_draftSort[1];
  var _draftSortDir=useState(-1),draftSortDir=_draftSortDir[0],setDraftSortDir=_draftSortDir[1];
  var _hc=useState(null),hiringPool=_hc[0],setHiringPool=_hc[1];
  var _rec=useState({passYds:{v:0,h:"â€”",yr:0},rushYds:{v:0,h:"â€”",yr:0},sacks:{v:0,h:"â€”",yr:0},defINT:{v:0,h:"â€”",yr:0},recYds:{v:0,h:"â€”",yr:0},fgM:{v:0,h:"â€”",yr:0},puntYds:{v:0,h:"â€”",yr:0}}),records=_rec[0],setRecords=_rec[1];
  var _dOff=useState([]),draftOffers=_dOff[0],setDraftOffers=_dOff[1];
  var _txLog=useState([]),txLog=_txLog[0],setTxLog=_txLog[1];
  var _inbox=useState([]),inbox=_inbox[0],setInbox=_inbox[1];
  var _inboxRead=useState(false),inboxRead=_inboxRead[0],setInboxRead=_inboxRead[1];
  var _rsPool=useState([]),reSignPool=_rsPool[0],setReSignPool=_rsPool[1];
  var _coP=useState(null),customOfferPid=_coP[0],setCustomOfferPid=_coP[1];// v80.10: custom offer
  var _coV=useState(""),customOfferVal=_coV[0],setCustomOfferVal=_coV[1];
  var _dpView=useState("ALL"),dpView=_dpView[0],setDpView=_dpView[1];
  var _dpShowAttr=useState(false),dpShowAttr=_dpShowAttr[0],setDpShowAttr=_dpShowAttr[1];
  var _dpRatCat=useState("CORE"),dpRatCat=_dpRatCat[0],setDpRatCat=_dpRatCat[1];// v69: Rating category filter
  var _dpSortAttr=useState("ovr"),dpSortAttr=_dpSortAttr[0],setDpSortAttr=_dpSortAttr[1];
  var _hof=useState([]),hallOfFame=_hof[0],setHallOfFame=_hof[1];
  var _godMode=useState(false),godMode=_godMode[0],setGodMode=_godMode[1];
  var _godTarget=useState(null),godTarget=_godTarget[0],setGodTarget=_godTarget[1];// v98: null=my team
  var _recap=useState(null),gameRecap=_recap[0],setGameRecap=_recap[1];
  var _prevRecap=useState(null),prevRecap=_prevRecap[0],setPrevRecap=_prevRecap[1];// v49: What Changed?
  var _rivBroadcast=useState(null),rivBroadcast=_rivBroadcast[0],setRivBroadcast=_rivBroadcast[1];// v49: Broadcast
  var _gameDayPhase977=useState(null),gameDayPhase977=_gameDayPhase977[0],setGameDayPhase977=_gameDayPhase977[1];// v97.7
  var _pregameTalk977=useState(null),pregameTalk977=_pregameTalk977[0],setPregameTalk977=_pregameTalk977[1];// v97.7
  var _pregameChoice977=useState(null),pregameChoice977=_pregameChoice977[0],setPregameChoice977=_pregameChoice977[1];// v97.7
  var _halftimePanel977=useState(null),halftimePanel977=_halftimePanel977[0],setHalftimePanel977=_halftimePanel977[1];// v97.7
  var _halftimeChoice977=useState(null),halftimeChoice977=_halftimeChoice977[0],setHalftimeChoice977=_halftimeChoice977[1];// v97.7
  var _postgameLocker977=useState(null),postgameLocker977=_postgameLocker977[0],setPostgameLocker977=_postgameLocker977[1];// v97.7
  var _gotwData977=useState(null),gotwData977=_gotwData977[0],setGotwData977=_gotwData977[1];// v97.7
  var _oppTeam977=useState(null),oppTeam977=_oppTeam977[0],setOppTeam977=_oppTeam977[1];// v97.7
  var _rivalryAtmo977=useState(null),rivalryAtmo977=_rivalryAtmo977[0],setRivalryAtmo977=_rivalryAtmo977[1];// v97.7
  var _standView977=useState("standings"),standView977=_standView977[0],setStandView977=_standView977[1];// v97.7
  var _speechFxRef977=React.useRef(null);// v97.7
  var _halftimeFxRef977=React.useRef(null);// v97.7
  var _gmStrat=useState("neutral"),gmStrategy=_gmStrat[0],setGmStrategy=_gmStrat[1];// v51: GM Macro
  var _dna=useState(DEFAULT_DNA),leagueDNA=_dna[0],setLeagueDNA=_dna[1];// v53: League DNA sliders
  var _owner=useState(null),owner=_owner[0],setOwner=_owner[1];// v54: Front Office owner
  var _bcast=useState(null),broadcast=_bcast[0],setBroadcast=_bcast[1];// v54: Weekly Broadcast
  var _mandates=useState([]),mandates=_mandates[0],setMandates=_mandates[1];// v55: Owner mandates
  var _gotw=useState(null),gotw=_gotw[0],setGotw=_gotw[1];// v55: Game of the Week
  var _potw=useState(null),potw=_potw[0],setPotw=_potw[1];// v55: Players of the Week
  var _deadlineShow=useState(null),deadlineShow=_deadlineShow[0],setDeadlineShow=_deadlineShow[1];// v56: Trade Deadline
  var _seasonAwards=useState(null),seasonAwards=_seasonAwards[0],setSeasonAwards=_seasonAwards[1];// v56: Season Awards
  var _coachTreeLog=useState([]),coachTreeLog=_coachTreeLog[0],setCoachTreeLog=_coachTreeLog[1];// v56: Coaching Tree
  var _trophyNames=useState({}),trophyNames=_trophyNames[0],setTrophyNames=_trophyNames[1];// v57: Trophy Names
  var _draftShowLog=useState([]),draftShowLog=_draftShowLog[0],setDraftShowLog=_draftShowLog[1];// v57: Draft Night Show
  var _draftHistory98=useState([]),draftHistory98=_draftHistory98[0],setDraftHistory98=_draftHistory98[1];// v98.5: Permanent draft archive
  // v98.6: 20 new feature states
  var _powerRankings986=useState([]),powerRankings986=_powerRankings986[0],setPowerRankings986=_powerRankings986[1];
  var _pressConf986=useState(null),pressConf986=_pressConf986[0],setPressConf986=_pressConf986[1];
  var _gmRep986=useState({fairDealer:50,aggressive:50,loyalty:50,overall:50}),gmRep986=_gmRep986[0],setGmRep986=_gmRep986[1];
  var _timeline986=useState([]),timeline986=_timeline986[0],setTimeline986=_timeline986[1];
  var _compPicks986=useState([]),compPicks986=_compPicks986[0],setCompPicks986=_compPicks986[1];
  var _trainingResult986=useState(null),trainingResult986=_trainingResult986[0],setTrainingResult986=_trainingResult986[1];
  var _rivalTrophies986=useState([]),rivalTrophies986=_rivalTrophies986[0],setRivalTrophies986=_rivalTrophies986[1];
  var _retireCeremony986=useState(null),retireCeremony986=_retireCeremony986[0],setRetireCeremony986=_retireCeremony986[1];
  var _compareMode986=useState(null),compareMode986=_compareMode986[0],setCompareMode986=_compareMode986[1];
  var _prevRankings986=useState([]),prevRankings986=_prevRankings986[0],setPrevRankings986=_prevRankings986[1];
  var _hofCeremony986=useState(null),hofCeremony986=_hofCeremony986[0],setHofCeremony986=_hofCeremony986[1];
  // v98.6: PLAY CALLING MODE
  var _liveGame986=useState(null),liveGame986=_liveGame986[0],setLiveGame986=_liveGame986[1];
  var _liveResult986=useState(null),liveResult986=_liveResult986[0],setLiveResult986=_liveResult986[1];
  var _pracSquad986=useState([]),pracSquad986=_pracSquad986[0],setPracSquad986=_pracSquad986[1];
  var _expansionEvent986=useState(null),expansionEvent986=_expansionEvent986[0],setExpansionEvent986=_expansionEvent986[1];
  var _draftClockKey=useState(0),draftClockKey=_draftClockKey[0],setDraftClockKey=_draftClockKey[1];// WAR_ROOM: clock restart key
  var _draftClockSec=useState(30),draftClockSec=_draftClockSec[0],setDraftClockSec=_draftClockSec[1];// WAR_ROOM: current clock seconds
  var _mfsnTicker=useState([]),mfsnTicker=_mfsnTicker[0],setMfsnTicker=_mfsnTicker[1];// WAR_ROOM: MFSN draft ticker
  var _mfsnPickCard=useState(null),mfsnPickCard=_mfsnPickCard[0],setMfsnPickCard=_mfsnPickCard[1];// MFSN SHOW v2: latest AI pick analyst card
  var _mfsnPickLog=useState([]),mfsnPickLog=_mfsnPickLog[0],setMfsnPickLog=_mfsnPickLog[1];// MFSN SHOW v2: scrolling pick log
  var _shareCardQueue=useState([]),shareCardQueue=_shareCardQueue[0],setShareCardQueue=_shareCardQueue[1];// SHARE_CARD auto-triggers: queue of pending record-break cards
  var _crisisRoom=useState(null),crisisRoom=_crisisRoom[0],setCrisisRoom=_crisisRoom[1];// CRISIS_ROOM v15: locker room crisis dramatic popup
  var _globalBoard=useState(null),globalBoard=_globalBoard[0],setGlobalBoard=_globalBoard[1];// GLOBAL_BOARD: leaderboard data
  var _globalBoardLoading=useState(false),globalBoardLoading=_globalBoardLoading[0],setGlobalBoardLoading=_globalBoardLoading[1];// GLOBAL_BOARD: loading state
  var _globalBoardRank=useState(null),globalBoardRank=_globalBoardRank[0],setGlobalBoardRank=_globalBoardRank[1];// GLOBAL_BOARD: user rank after submit
  var _dnaReport=useState(null),dnaReport=_dnaReport[0],setDnaReport=_dnaReport[1];// v57: DNA Impact Report
  var _faMarket=useState([]),faMarket=_faMarket[0],setFaMarket=_faMarket[1];// v58: FA Frenzy market
  var _faHeadlines=useState([]),faHeadlines=_faHeadlines[0],setFaHeadlines=_faHeadlines[1];// v58: FA headlines
  var _draftPreview=useState(null),draftPreview=_draftPreview[0],setDraftPreview=_draftPreview[1];// v58: Draft Preview
  var _rivalryGD=useState(null),rivalryGD=_rivalryGD[0],setRivalryGD=_rivalryGD[1];// v58: Rivalry Game Day
  var _careerPage=useState(null),careerPage=_careerPage[0],setCareerPage=_careerPage[1];// v59: Career Pages
  var _faDay=useState(0),faDay=_faDay[0],setFaDay=_faDay[1];// v59: FA Bidding day counter
  var _faBids82=useState([]),faBids82=_faBids82[0],setFaBids82=_faBids82[1];
  var _faPhase82=useState("tampering"),faPhase82=_faPhase82[0],setFaPhase82=_faPhase82[1];
  var _faRound82=useState(0),faRound82=_faRound82[0],setFaRound82=_faRound82[1];
  var _faVisits82=useState({used:0,max:3,log:[]}),faVisits82=_faVisits82[0],setFaVisits82=_faVisits82[1];
  var _faAlerts82=useState([]),faAlerts82=_faAlerts82[0],setFaAlerts82=_faAlerts82[1];
  var _faRFA82=useState([]),faRFA82=_faRFA82[0],setFaRFA82=_faRFA82[1];
  var _faSignings82=useState([]),faSignings82=_faSignings82[0],setFaSignings82=_faSignings82[1];
  var _faBidRole82=useState("STARTER"),faBidRole82=_faBidRole82[0],setFaBidRole82=_faBidRole82[1];
  var _faIntel92=useState({}),faIntel92=_faIntel92[0],setFaIntel92=_faIntel92[1];// v92: FA contract intel reveal map
  var _awardsCeremony=useState(null),awardsCeremony=_awardsCeremony[0],setAwardsCeremony=_awardsCeremony[1];// v59: Awards Ceremony
  var _stDeals976=useState(null),stDeals976=_stDeals976[0],setStDeals976=_stDeals976[1];// v97.6: Stadium naming rights offers (ephemeral)
  var _relocDest976=useState(null),relocDest976=_relocDest976[0],setRelocDest976=_relocDest976[1];// v97.6: Selected relocation destination
  var _relocName976=useState(""),relocName976=_relocName976[0],setRelocName976=_relocName976[1];// v97.6: Custom team name input
  var _relocAbbr976=useState(""),relocAbbr976=_relocAbbr976[0],setRelocAbbr976=_relocAbbr976[1];// v97.6: Custom abbr input
  var _tradeBuilder=useState({my:[],their:[]}),tradeBuilder=_tradeBuilder[0],setTradeBuilder=_tradeBuilder[1];// v60: Trade Package Builder
  var _tradeTarget=useState(null),tradeTarget=_tradeTarget[0],setTradeTarget=_tradeTarget[1];// v60: Selected trade partner
  var _filmRoom=useState(null),filmRoom=_filmRoom[0],setFilmRoom=_filmRoom[1];// v62: Post-game film analysis
  var _htPlans=useState({}),halftimePlans=_htPlans[0],setHalftimePlans=_htPlans[1];// v93.18: map {condId:stratId} per condition
  var halftimePlan=null;// legacy compat â€” not used directly anymore
  var _pracFocus=useState("scout"),pracFocus=_pracFocus[0],setPracFocus=_pracFocus[1];// v64: Weekly practice focus
  var _pracXpWeek87=useState(""),pracXpWeek87=_pracXpWeek87[0],setPracXpWeek87=_pracXpWeek87[1];// v87: anti-farm key for clinic XP on focus changes
  var _pracStarBoost=useState(null),pracStarBoost=_pracStarBoost[0],setPracStarBoost=_pracStarBoost[1];// v93.15: {playerId,boost,week,name,pos,ovr}
  var _captainId=useState(null),captainId=_captainId[0],setCaptainId=_captainId[1];// v64: Team captain
  var _captMoments=useState({season:0,used:0,log:[]}),captMoments=_captMoments[0],setCaptMoments=_captMoments[1];// v64: Captain moment tracker
  var _pressConf=useState(null),pressConf=_pressConf[0],setPressConf=_pressConf[1];// v65: Post-game press conference
  var _scoutRpt=useState(null),scoutRpt=_scoutRpt[0],setScoutRpt=_scoutRpt[1];// v65: Opponent scout report
  var _scoutDB=useState({}),scoutDB=_scoutDB[0],setScoutDB=_scoutDB[1];// v66: Persistent scout dossier
  var _mediaState=useState({tags:[],credibility:50}),mediaState=_mediaState[0],setMediaState=_mediaState[1];// v66: Media persona tracker
  var _prospectDB=useState({}),prospectDB=_prospectDB[0],setProspectDB=_prospectDB[1];// v67: Prospect dossier DB
  var _coachClinic=useState({xp:{},perks:[]}),coachClinic=_coachClinic[0],setCoachClinic=_coachClinic[1];// v67: Coach clinic progress
  var _tradeState69=useState({gmTrustByTeam:{},recentTrades:[]}),tradeState=_tradeState69[0],setTradeState=_tradeState69[1];// v69: GM Trust
  var _showReceipts=useState(null),showReceipts=_showReceipts[0],setShowReceipts=_showReceipts[1];// v51: Receipts
  var _gameKeys=useState(null),gameKeys=_gameKeys[0],setGameKeys=_gameKeys[1];
  var _box=useState(null),boxScore=_box[0],setBoxScore=_box[1];
  var _lf=useState("ALL"),lFilter=_lf[0],setLFilter=_lf[1];
  var _ltf=useState("ALL"),lTeamFilter=_ltf[0],setLTeamFilter=_ltf[1];
  var _moreOpen=useState(false),moreOpen=_moreOpen[0],setMoreOpen=_moreOpen[1];
  var _capPickerOpen=useState(false),capPickerOpen=_capPickerOpen[0],setCapPickerOpen=_capPickerOpen[1];
  var _pd=useState(null),playerDetail=_pd[0],setPlayerDetail=_pd[1];
  var _theater=useState(null),theater=_theater[0],setTheater=_theater[1];
  var _presser=useState(null),presser=_presser[0],setPresser=_presser[1];
  var _selPlayers=useState([]),selPlayers=_selPlayers[0],setSelPlayers=_selPlayers[1];
  var TRAIN_GROUPS=[
    {id:"qb",name:"Quarterbacks",pos:["QB"],icon:"ðŸŽ¯",opts:[
      {id:"arm",name:"Arm Strength",attr:"arm",desc:"Deep ball power"},
      {id:"accuracy",name:"Accuracy",attr:"accuracy",desc:"Completion %"},
      {id:"awareness",name:"Film Study",attr:"awareness",desc:"Read defenses"},
      {id:"speed",name:"Scramble Drills",attr:"speed",desc:"Pocket mobility"}]},
    {id:"skill",name:"Skill Players",pos:["RB","WR","TE"],icon:"âš¡",opts:[
      {id:"speed",name:"Speed Training",attr:"speed",desc:"Straight-line burst"},
      {id:"catching",name:"Hands Drills",attr:"catching",desc:"Secure catches"},
      {id:"route",name:"Route Tree",attr:"routeRunning",desc:"Route precision"},
      {id:"elusiveness",name:"Agility",attr:"elusiveness",desc:"Broken tackles"}]},
    {id:"oline",name:"O-Line",pos:["OL"],icon:"ðŸ—ï¸",opts:[
      {id:"passBlock",name:"Pass Pro",attr:"passBlock",desc:"Keep QB clean"},
      {id:"runBlock",name:"Run Blocking",attr:"runBlock",desc:"Open holes"},
      {id:"strength",name:"Strength",attr:"strength",desc:"Raw power"}]},
    {id:"dline",name:"Front Seven",pos:["DL","LB"],icon:"ðŸ¦¬",opts:[
      {id:"passRush",name:"Pass Rush",attr:"passRush",desc:"Get after the QB"},
      {id:"runStop",name:"Run Stuff",attr:"runStop",desc:"Plug gaps"},
      {id:"tackle",name:"Tackling",attr:"tackle",desc:"Sure tackles"},
      {id:"coverage",name:"Drop Coverage",attr:"coverage",desc:"LB zone drops"}]},
    {id:"secondary",name:"Secondary",pos:["CB","S"],icon:"ðŸ›¡ï¸",opts:[
      {id:"coverage",name:"Coverage",attr:"coverage",desc:"Lock down routes"},
      {id:"ballSkills",name:"Ball Skills",attr:"ballSkills",desc:"Turnover creation"},
      {id:"speed",name:"Speed Training",attr:"speed",desc:"Keep up deep"},
      {id:"tackling",name:"Tackling",attr:"tackling",desc:"Run support"}]},
    {id:"gameplan",name:"Gameplan Study",pos:["QB","RB","WR","TE","OL","DL","LB","CB","S"],icon:"ðŸ“‹",
      isGameplan:true,
      opts:[
        {id:"awareness",name:"Film Study",attr:"awareness",desc:"Read the whole field",
          schemeDesc:"Boosts AWR â€” helps every player react faster pre-snap"},
        {id:"playRecognition",name:"Play Recognition",attr:"playRecognition",desc:"Diagnose plays at the line",
          schemeDesc:"Boosts PRE â€” reduces blown assignments & missed reads"},
        {id:"assignmentIQ",name:"Assignment IQ",attr:"assignmentIQ",desc:"Execute scheme without mistakes",
          schemeDesc:"Boosts AIQ â€” tightens scheme fit, fewer mental errors"},
        {id:"schemeInstall",name:"Scheme Install",attr:"awareness",desc:"Run the playbook in your sleep",
          multiAttr:["awareness","playRecognition"],
          schemeDesc:"Splits gain across AWR + PRE â€” broadest scheme fit boost"}
      ]}
  ];
  var _trainAssign=useState({}),trainAssign=_trainAssign[0],setTrainAssign=_trainAssign[1];// {qb:"arm",skill:"speed",...}
  var _schemeConfirm=useState(null),schemeConfirm=_schemeConfirm[0],setSchemeConfirm=_schemeConfirm[1];// {side:"off"|"def",newScheme:id,avgFit,fitLoss}
  var _vaultArchives=useState(null),vaultArchives=_vaultArchives[0],setVaultArchives=_vaultArchives[1];
  var _lastFix=useState(null),lastFix=_lastFix[0],setLastFix=_lastFix[1];// {type, weekApplied, beforeMetrics}
  var _chemActions=useState(0),chemActions=_chemActions[0],setChemActions=_chemActions[1];// actions taken this week
  var _scoutPosF=useState("ALL"),scoutPosF=_scoutPosF[0],setScoutPosF=_scoutPosF[1];
  var _audioM=useState(true),audioMuted=_audioM[0],setAudioMuted=_audioM[1];
  var _np=useState(""),nowPlaying=_np[0],setNowPlaying=_np[1];// v80.10: now-playing
  var _dbg=useState(false),debugMode=_dbg[0],setDebugMode=_dbg[1];// v80.12: debug overlay
  var _detSmoke=useState(null),determinismSmoke=_detSmoke[0],setDeterminismSmoke=_detSmoke[1];// v83: manual determinism smoke result
  var MFD_JUKEBOX_ALL=["legends","gears","neon","drive","wakeup",
    "afterburn","lobby","sunny","plains","steel","silicon",
    "turnstile","tapedeck","backfield","ghosts","clockwork","bathroom","noend"];
  var _upl=useState(MFD_JUKEBOX_ALL.slice()),userPlaylist=_upl[0],setUserPlaylist=_upl[1];
  var _gdt=useState(null),gamedayTrack=_gdt[0],setGamedayTrack=_gdt[1];// null = phase default
  var _confetti=useState(false),showConfetti=_confetti[0],setShowConfetti=_confetti[1];
  var confettiRef=useRef(null);
  var _expPool=useState([]),expPool=_expPool[0],setExpPool=_expPool[1];
  var _expPick=useState(0),expPick=_expPick[0],setExpPick=_expPick[1];// current pick index (snake)
  var _expOrder=useState([]),expOrder=_expOrder[0],setExpOrder=_expOrder[1];// full snake order
  var _expLog=useState([]),expLog=_expLog[0],setExpLog=_expLog[1];
  var _expPosF=useState("ALL"),expPosF=_expPosF[0],setExpPosF=_expPosF[1];
  var _expBudgets=useState({}),expBudgets=_expBudgets[0],setExpBudgets=_expBudgets[1];// auction
  var _expNom=useState(null),expNom=_expNom[0],setExpNom=_expNom[1];// current nominee
  var _expBid=useState(0),expBid=_expBid[0],setExpBid=_expBid[1];// current high bid $
  var _expBidder=useState(null),expBidder=_expBidder[0],setExpBidder=_expBidder[1];// current high bidder id
  var _expUserBid=useState(0),expUserBid=_expUserBid[0],setExpUserBid=_expUserBid[1];
  var _expAucRound=useState(0),expAucRound=_expAucRound[0],setExpAucRound=_expAucRound[1];
  var _expAucPhase=useState("nom"),expAucPhase=_expAucPhase[0],setExpAucPhase=_expAucPhase[1];// nom|bid|aiBid
  var _expAiQueue=useState([]),expAiQueue=_expAiQueue[0],setExpAiQueue=_expAiQueue[1];// AI nominations queued for user to bid on
  var _expTeamIdx=useState(0),expTeamIdx=_expTeamIdx[0],setExpTeamIdx=_expTeamIdx[1];// which team picked (for team pick screen)
  var _expDepth=useState(53),expDepth=_expDepth[0],setExpDepth=_expDepth[1];// user picks before auto-complete (53=full,25=core,10=stars)
  var _expUserPicks=useState(0),expUserPicks=_expUserPicks[0],setExpUserPicks=_expUserPicks[1];// how many picks user has made
  var _expDraftType=useState("snake"),expDraftType=_expDraftType[0],setExpDraftType=_expDraftType[1];// snake|auction
  var _expDraftOrder96=useState(null),expDraftOrder96=_expDraftOrder96[0],setExpDraftOrder96=_expDraftOrder96[1];// v96.1: Draft order setup
  var _diff=useState("pro"),difficulty=_diff[0],setDifficulty=_diff[1];
  var _expPoolSnap=useState([]),expPoolSnap=_expPoolSnap[0],setExpPoolSnap=_expPoolSnap[1];
  var _poBracket=useState(null),poBracket=_poBracket[0],setPoBracket=_poBracket[1];
  useEffect(function(){DIFF_ACTIVE=difficulty;},[difficulty]);
  useEffect(function(){
    function handleKeydown(e){
      var tag=e.target&&e.target.tagName;
      if(tag==="INPUT"||tag==="TEXTAREA"||tag==="SELECT")return;
      if(e.target&&e.target.contentEditable==="true")return;
      if(screen!=="game")return;// Only in game screen
      var k=e.key;
      if((e.ctrlKey||e.metaKey)&&k==="s"){e.preventDefault();doSave();setAutoSaveInd("ðŸ’¾ Saved");setTimeout(function(){setAutoSaveInd("");},1400);return;}
      if((e.ctrlKey||e.metaKey)&&e.shiftKey&&(k==="C"||k==="c")){e.preventDefault();exportClipboard();return;}
      if((e.ctrlKey||e.metaKey)&&k==="o"){e.preventDefault();setImportModal(true);return;}
      if(k==="?"||k==="/"){setShowKbHelp(function(v){return !v;});return;}
      if(k==="Escape"){setShowKbHelp(false);setImportModal(false);setPlayerDetail(null);setWeekShow(null);setFitDrilldown(null);setSchemeConfirm(null);return;}
      if(showKbHelp||importModal||weekShow||playerDetail||fitDrilldown||schemeConfirm)return;
      if(k>="1"&&k<="9"){var idx=parseInt(k)-1;if(idx<TAB_ORDER.length){
        if(!isTabUnlocked(TAB_ORDER[idx],unlocks,godMode)){addN("ðŸ”’ Tab locked â€” keep playing to unlock!","info");return;}
        setTab(TAB_ORDER[idx]);}return;}
      if(k==="["){var ci=TAB_ORDER.indexOf(tab);for(var bi=1;bi<TAB_ORDER.length;bi++){var ni=(ci-bi+TAB_ORDER.length)%TAB_ORDER.length;if(isTabUnlocked(TAB_ORDER[ni],unlocks,godMode)){setTab(TAB_ORDER[ni]);break;}}return;}
      if(k==="]"){var ci2=TAB_ORDER.indexOf(tab);for(var bi2=1;bi2<TAB_ORDER.length;bi2++){var ni2=(ci2+bi2)%TAB_ORDER.length;if(isTabUnlocked(TAB_ORDER[ni2],unlocks,godMode)){setTab(TAB_ORDER[ni2]);break;}}return;}
      var navKey=KEYMAP[k.toLowerCase()];
      if(navKey){if(!isTabUnlocked(navKey,unlocks,godMode)){addN("ðŸ”’ Tab locked â€” keep playing to unlock!","info");return;}setTab(navKey);return;}
      if(k===" "||k==="w"||k==="W"){e.preventDefault();/* simWeek handled by space */}
    }
    window.addEventListener("keydown",handleKeydown);
    return function(){window.removeEventListener("keydown",handleKeydown);};
  },[screen,tab,showKbHelp,importModal,weekShow,playerDetail,fitDrilldown,schemeConfirm,unlocks,godMode]);
  useEffect(function(){
    if(screen!=="game"||!myId)return;
    var iv=setInterval(function(){
      doSave();setAutoSaveInd("ðŸ’¾ Autosaved");setTimeout(function(){setAutoSaveInd("");},1400);
    },60000);
    return function(){clearInterval(iv);};
  },[screen,myId]);
  var prevUnlocksRef=useRef(unlocks);
  useEffect(function(){
    if(screen!=="league"||!myId||!teams.length)return;
    var newU=checkUnlocks(unlocks,season,teams,myId,godMode);
    var prev=prevUnlocksRef.current;
    var changed=false;
    UNLOCK_DEFS.forEach(function(def){
      if(newU[def.id]&&!prev[def.id]){
        changed=true;
        addN(def.toast,"gold");
        if(def.inbox){
          var newInbox=inbox.slice();
          newInbox.unshift({type:"unlock",icon:"ðŸ”“",text:def.inbox,color:"gold",id:U()});
          setInbox(newInbox);
        }
      }
    });
    if(changed){setUnlocks(newU);prevUnlocksRef.current=newU;}
  },[season.week,season.year,season.phase]);
  var _stories=useState([]),stories=_stories[0],setStories=_stories[1];
  var _calAlert=useState(null),calAlert=_calAlert[0],setCalAlert=_calAlert[1];
  var _ownerMtg=useState(null),ownerMtg=_ownerMtg[0],setOwnerMtg=_ownerMtg[1];
  var _lastGame=useState(null),lastGameCtx=_lastGame[0],setLastGameCtx=_lastGame[1];
  useEffect(function(){AUDIO.onToggle(function(m){setAudioMuted(m);});
    AUDIO.onNext(function(k){setNowPlaying(AUDIO.getName(k));});// v80.10
    if(!audioMuted&&userPlaylist.length>0){
      AUDIO._userPlaylist=userPlaylist;
    }
  },[]);
  var TITLE_CAROUSEL=["DRAFT THE FUTURE","BUILD A DYNASTY","BECOME A LEGEND","OUTSMART 29 AI GMs","SURVIVE THE OWNER","WIN THE CHAMPIONSHIP"];
  useEffect(function(){
    if(screen!=="title")return;
    var interval=setInterval(function(){setTitleCarIdx(function(i){return(i+1)%TITLE_CAROUSEL.length;});},2500);
    return function(){clearInterval(interval);};
  },[screen]);
  useEffect(function(){
    if(!weekShow||!weekShow.headlines||weekShow.headlines.length===0)return;
    var interval=setInterval(function(){setTickerIdx(function(i){return(i+1)%weekShow.headlines.length;});},3000);
    return function(){clearInterval(interval);};
  },[weekShow]);
  useEffect(function(){
    if(audioMuted) return;
    if(screen==="title"||screen==="pick"||screen==="draftMode"||screen==="draftOrderSetup"||screen==="foExplain"||screen==="foSetup"||screen==="gameGuide"){AUDIO.play("legends");}// v80.9: "Pretend We're Legends"
    else if(screen==="expansionSnake"||screen==="expansionAuction"){AUDIO.play("gears");}// v80.9: "Gears in the Glow"
    else if(theater){AUDIO.play("neon");}// v80.9: "Neon Fever Dream"
    else if(season.phase==="combine"||season.phase==="draft"||season.phase==="drafting"){AUDIO.play("gears");}// v80.9
    else if(season.phase==="playoffs"){AUDIO.play("drive");}// v80.9: "Eight-Minute Drive"
    else if(season.phase==="offseason"||season.phase==="reSign"||season.phase==="freeAgency"||season.phase==="seasonRecap"){AUDIO.play("offseason");}
    else{AUDIO.play("hub");}
  },[screen,season.phase,audioMuted,theater]);
  useEffect(function(){
    if(!showConfetti) return;
    var cvs=document.createElement("canvas");
    cvs.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999";
    document.body.appendChild(cvs);confettiRef.current=cvs;
    var c2d=cvs.getContext("2d");var W=window.innerWidth;var H=window.innerHeight;
    cvs.width=W;cvs.height=H;
    var colors=[T.gold,"#fff",T.green,T.blue,T.red,T.purple,T.cyan];
    var pieces=[];
    for(var ci=0;ci<200;ci++)pieces.push({x:RNG.ui()*W,y:RNG.ui()*H-H,w:rng(4,10),h:rng(3,8),c:colors[ci%colors.length],
      dx:(RNG.ui()-0.5)*2,dy:RNG.ui()*3+2,rot:RNG.ui()*360,drot:(RNG.ui()-0.5)*8});
    var anim=setInterval(function(){
      c2d.clearRect(0,0,W,H);
      pieces.forEach(function(p){p.y+=p.dy;p.x+=p.dx;p.rot+=p.drot;if(p.y>H){p.y=-10;p.x=RNG.ui()*W;}
        c2d.save();c2d.translate(p.x,p.y);c2d.rotate(p.rot*Math.PI/180);
        c2d.fillStyle=p.c;c2d.fillRect(-p.w/2,-p.h/2,p.w,p.h);c2d.restore();});
    },25);
    var timer=setTimeout(function(){clearInterval(anim);if(cvs.parentNode)document.body.removeChild(cvs);setShowConfetti(false);},6000);
    return function(){clearInterval(anim);clearTimeout(timer);if(cvs.parentNode)document.body.removeChild(cvs);};
  },[showConfetti]);
  var _scoutSort=useState("hypeOvr"),scoutSort=_scoutSort[0],setScoutSort=_scoutSort[1];
  var _scoutDir=useState(-1),scoutDir=_scoutDir[0],setScoutDir=_scoutDir[1];
  var _bsHist=useState([]),boxHistory=_bsHist[0],setBoxHistory=_bsHist[1];
  var _saveLoading=useState(true),saveLoading=_saveLoading[0],setSaveLoading=_saveLoading[1];
  var _isSaving=useState(false),isSaving=_isSaving[0],setIsSaving=_isSaving[1];
  var _vaultReady=useState(false),vaultReady=_vaultReady[0],setVaultReady=_vaultReady[1];
  useEffect(function(){
    DB.open().then(function(){ setVaultReady(true); }).catch(function(){ setVaultReady(false); }).finally(function(){
      loadPersistent(function(d){
        if(d){ _save=d; }
        setSaveLoading(false);
      });
      loadBoxScores(function(bs){if(bs&&bs.length)setBoxHistory(bs);});
    });
  },[]);
  var theaterTimer=useRef(null);
  useEffect(function(){
    if(theater&&!theater.paused&&theater.driveIdx<(theater.result?theater.result.log.length:0)){
      if(theater.decisions&&theater.decisions.length>0&&!theater.decisionActive){
        var nextDec=(theater.decisions||[]).find(function(d){return d.driveIdx===theater.driveIdx;});
        if(nextDec){
          setTheater(assign({},theater,{decisionActive:nextDec,paused:true}));
          return;
        }
      }
      var drv=theater.result.log[theater.driveIdx]||"";
      var isQtrHeader=drv.indexOf("â”€â”€ Q")===0;
      var delay=isQtrHeader?200:(theater.speed==="fast"?250:700);
      theaterTimer.current=setTimeout(function(){
        setTheater(function(prev){
          if(!prev) return null;
          return assign({},prev,{driveIdx:prev.driveIdx+1});
        });
      },delay);
    }
    return function(){if(theaterTimer.current)clearTimeout(theaterTimer.current);};
  },[theater]);
  useEffect(function(){
    if(season.phase!=="freeAgency")setFaIntel92({});
  },[season.phase]);
  useEffect(function(){
    if(tab!=="trade"){
      if(pendingCounter971)setPendingCounter971(null);
      return;
    }
    if(pendingCounter971&&!tradeTeamId){
      setTTI(pendingCounter971.aiId||null);
      setTMP([]);setTAP([]);setTMPk([]);setTAPk([]);setTMyPkCond972({});setTAiPkCond972({});setTMsg("");
    }
  },[tab,tradeTeamId,pendingCounter971]);
  var my=teams.find(function(t){return t.id===myId;});
  function calcTheaterScore972(log,hAbbr,aAbbr){
    var out={home:0,away:0};
    (log||[]).forEach(function(entry){
      if(!entry||entry.indexOf("â”€â”€ Q")===0)return;
      var pts=0;
      if(entry.indexOf("TOUCHDOWN")>=0)pts=7;
      else if(entry.indexOf("FG GOOD")>=0)pts=3;
      if(!pts)return;
      if(hAbbr&&entry.indexOf(hAbbr+":")>=0)out.home+=pts;
      else if(aAbbr&&entry.indexOf(aAbbr+":")>=0)out.away+=pts;
    });
    return out;
  }
  function detectDecisionPoints972(result,homeTeam,awayTeam,myId2){
    var decisions=[];var log=(result&&result.log)||[];
    var isUserHome=homeTeam&&homeTeam.id===myId2;
    var userAbbr=isUserHome?(homeTeam&&homeTeam.abbr||""):(awayTeam&&awayTeam.abbr||"");
    var totalDrives=log.length;
    if(!userAbbr||totalDrives<=0)return decisions;
    for(var i=0;i<totalDrives;i++){
      var entry=log[i];
      if(!entry||entry.indexOf("â”€â”€ Q")===0)continue;
      if(entry.indexOf(userAbbr+":")<0)continue;
      var isPunt=entry.indexOf("punt")>=0||entry.indexOf("PUNT")>=0||entry.indexOf("3 & out")>=0;
      var yMatch=entry.match(/(\d+)yds/);
      var yds=yMatch?parseInt(yMatch[1],10):0;
      if(isPunt&&yds>=15&&decisions.filter(function(d){return d.type==="4th_down";}).length<4){
        decisions.push({driveIdx:i,type:"4th_down",original:entry,yardLine:Math.min(95,25+yds)});
      }
      var qtr=i<Math.floor(totalDrives*0.25)?1:i<Math.floor(totalDrives*0.5)?2:i<Math.floor(totalDrives*0.75)?3:4;
      var isQtrEnd=(qtr===2&&i>=Math.floor(totalDrives*0.45))||(qtr===4&&i>=Math.floor(totalDrives*0.85));
      if(isQtrEnd&&!isPunt&&decisions.filter(function(d){return d.type==="two_min";}).length<2){
        decisions.push({driveIdx:i,type:"two_min",original:entry,quarter:qtr});
      }
      var isTO=entry.indexOf("INTERCEPT")>=0||entry.indexOf("FUMBLE")>=0;
      if(isTO&&RNG.play()<0.30&&decisions.filter(function(d){return d.type==="challenge";}).length<1){
        decisions.push({driveIdx:i,type:"challenge",original:entry});
      }
    }
    var q4Start=Math.floor(totalDrives*0.75);
    for(var j=q4Start;j<totalDrives;j++){
      if(log[j]&&log[j].indexOf("â”€â”€ Q")!==0&&log[j].indexOf(userAbbr+":")>=0){
        if(decisions.filter(function(d){return d.type==="timeout";}).length<1){
          decisions.push({driveIdx:j,type:"timeout",original:log[j]});
          break;
        }
      }
    }
    decisions.sort(function(a,b){return a.driveIdx-b.driveIdx;});
    return decisions;
  }
  function resolveDecision972(decision,choice){
    setTheater(function(prev){
      if(!prev||!prev.result||!decision)return prev;
      var newLog=(prev.result.log||[]).slice();
      var idx=decision.driveIdx;
      var userIsHome=prev.homeTeam&&prev.homeTeam.id===myId;
      var userAbbr=userIsHome?(prev.homeTeam&&prev.homeTeam.abbr||""):(prev.awayTeam&&prev.awayTeam.abbr||"");
      if(idx<0||idx>=newLog.length)return assign({},prev,{decisionActive:null,paused:false});
      if(decision.type==="4th_down"){
        if(choice==="go"){
          var qb97=null;
          var userTeam97=userIsHome?prev.homeTeam:prev.awayTeam;
          if(userTeam97&&userTeam97.roster)qb97=userTeam97.roster.find(function(p){return p.pos==="QB"&&p.isStarter;})||userTeam97.roster.find(function(p){return p.pos==="QB";});
          var qbBonus97=qb97?Math.max(-0.10,Math.min(0.15,((qb97.ovr||75)-75)*0.01)):0;
          var clutchBonus97=qb97&&hasTrait95(qb97,"clutch")?0.05:0;
          var success=RNG.play()<Math.max(0.15,Math.min(0.85,0.45+qbBonus97+clutchBonus97));
          if(success){
            var tdChance=decision.yardLine>=80?0.60:0.30;
            if(RNG.play()<tdChance)newLog[idx]=userAbbr+": ðŸˆ GUTSY 4th down call â€” TOUCHDOWN! "+(100-(decision.yardLine||50))+"yd drive";
            else newLog[idx]=userAbbr+": ðŸˆ 4th down CONVERTED! Drive stays alive â€” FG GOOD from "+(100-(decision.yardLine||50))+"yds";
          }else newLog[idx]=userAbbr+": ðŸˆ 4th down STUFFED! Turnover on downs at the "+(100-(decision.yardLine||50));
        }else if(choice==="fg"){
          var fgPct=decision.yardLine>=75?0.80:decision.yardLine>=65?0.60:0.35;
          var made=RNG.play()<fgPct;
          newLog[idx]=userAbbr+": "+(made?"FG GOOD":"FG MISSED")+" from "+(100-(decision.yardLine||50))+"yds"+(made?" âœ…":" âŒ");
        }
      }else if(decision.type==="two_min"){
        if(choice==="aggressive"){
          var nextUserDrive=-1;
          for(var k=idx+1;k<newLog.length;k++){
            if(newLog[k]&&newLog[k].indexOf("â”€â”€ Q")!==0&&newLog[k].indexOf(userAbbr+":")>=0){nextUserDrive=k;break;}
          }
          if(nextUserDrive>=0){
            var boost=RNG.play()<0.55;
            if(boost&&newLog[nextUserDrive].indexOf("TOUCHDOWN")<0)newLog[nextUserDrive]=userAbbr+": âš¡ 2-MIN DRILL â€” TOUCHDOWN! Aggressive playcalling pays off!";
            else if(!boost&&newLog[nextUserDrive].indexOf("INTERCEPT")<0)newLog[nextUserDrive]=userAbbr+": âš¡ 2-min drill BACKFIRES â€” INTERCEPTION! Too aggressive.";
          }
        }else if(choice==="conservative"){
          newLog.splice(Math.min(newLog.length,idx+1),0,"ðŸ§Š "+userAbbr+" leans conservative â€” draining clock and protecting the ball.");
        }
      }else if(decision.type==="challenge"){
        if(choice==="challenge"){
          var reversed=RNG.play()<0.40;
          if(reversed)newLog[idx]=newLog[idx].replace(/INTERCEPT[A-Z]*/g,"OVERTURNED â€” Challenge successful! ðŸš©âœ…").replace(/FUMBLE[A-Z]*/g,"OVERTURNED â€” Challenge successful! ðŸš©âœ…");
          else newLog[idx]=newLog[idx]+" (ðŸš© Challenge FAILED â€” timeout lost)";
        }
      }
      if(decision.type==="timeout"){
        if(choice==="timeout")newLog.splice(Math.min(newLog.length,idx+1),0,"â±ï¸ TIMEOUT called by "+userAbbr+" â€” stopping the clock");
        else newLog.splice(Math.min(newLog.length,idx+1),0,"â³ "+userAbbr+" lets the clock run â€” trusting defensive momentum.");
      }
      var hAbbr2=prev.homeTeam&&prev.homeTeam.abbr||"";var aAbbr2=prev.awayTeam&&prev.awayTeam.abbr||"";
      var score972=calcTheaterScore972(newLog,hAbbr2,aAbbr2);
      var newResult=assign({},prev.result,{log:newLog,home:score972.home,away:score972.away});
      var newDecisions=(prev.decisions||[]).filter(function(d){return !(d.driveIdx===decision.driveIdx&&d.type===decision.type);});
      return assign({},prev,{result:newResult,decisions:newDecisions,decisionActive:null,paused:false});
    });
  }
  function buildDeterminismSig(result){
    if(!result)return "NULL";
    var rh=result.recap&&result.recap.home?result.recap.home:{};
    var ra=result.recap&&result.recap.away?result.recap.away:{};
    var qh=result.qtrs?((result.qtrs.h||result.qtrs.home||[])):[];
    var qa=result.qtrs?((result.qtrs.a||result.qtrs.away||[])):[];
    var log=result.log||[];
    var firstLog=log.length?log[0]:"";
    var lastLog=log.length?log[log.length-1]:"";
    return [
      result.home||0,result.away||0,
      Math.round((rh.pressureRate||0)*10)/10,Math.round((rh.rzEff||0)*10)/10,Math.round((rh.turnovers||0)*10)/10,
      Math.round((ra.pressureRate||0)*10)/10,Math.round((ra.rzEff||0)*10)/10,Math.round((ra.turnovers||0)*10)/10,
      qh.join(","),qa.join(","),log.length,firstLog,lastLog
    ].join("|");
  }
  function runDeterminismSmokeTest(){
    if(!teams||teams.length<2){addN("âš ï¸ Determinism smoke skipped: not enough teams.","orange");return;}
    var g=(sched||[]).find(function(x){return x&&x.week===season.week&&!x.played;});
    var home=g?teams.find(function(t){return t.id===g.home;}):teams[0];
    var away=g?teams.find(function(t){return t.id===g.away;}):teams[1];
    if(!home||!away){addN("âš ï¸ Determinism smoke skipped: missing matchup.","orange");return;}
    var label=home.abbr+" vs "+away.abbr+" (Wk "+season.week+")";
    var seedChain=(SEED_GLOBAL^(season.year*1000)^season.week)>>>0;
    var rngSnapshot=RNG;
    var t0=Date.now();
    var aSig="";var bSig="";var errMsg=null;
    try{
      function runOnce(){
        RNG={play:mulberry32(seedChain),injury:mulberry32(seedChain+1),draft:mulberry32(seedChain+2),ai:mulberry32(seedChain+3),dev:mulberry32(seedChain+4),trade:mulberry32(seedChain+5),ui:mulberry32(seedChain+6)};
        var h=JSON.parse(JSON.stringify(home));
        var a=JSON.parse(JSON.stringify(away));
        return simGame(h,a,season.phase==="preseason",null);
      }
      aSig=buildDeterminismSig(runOnce());
      bSig=buildDeterminismSig(runOnce());
    }catch(e){
      errMsg=e&&e.message?e.message:String(e);
    }finally{
      RNG=rngSnapshot;// restore live stream state exactly
    }
    var dt=Date.now()-t0;
    var ok=!errMsg&&aSig===bSig;
    setDeterminismSmoke({ok:ok,label:label,seed:SEED_GLOBAL,year:season.year,week:season.week,durationMs:dt,sigA:aSig,sigB:bSig,error:errMsg,ts:Date.now()});
    if(errMsg){addN("âŒ Determinism smoke errored: "+errMsg,"red");}
    else if(ok){addN("âœ… Determinism smoke passed: "+label+" ("+dt+"ms)","green");}
    else{
      addN("âš ï¸ Determinism smoke mismatch: "+label,"red");
      GOLDEN_SEED_DRIFT={seed:SEED_GLOBAL,year:season.year,version:"v"+SAVE_VERSION,drifts:["Manual smoke mismatch for "+label],msg:"âš ï¸ DETERMINISM SMOKE TEST FAILED"};
    }
  }
  function addN(text,type,action){
    setNews(function(h){return [{text:text,type:type||"info",id:U(),action:action||null}].concat(h).slice(0,50);});
    if(type==="gold"||type==="red"||type==="green"||type==="purple"||type==="cyan"){
      var tid=U();
      setToasts(function(prev){return [{id:tid,text:text,type:type,title:type==="gold"?"MAJOR EVENT":type==="red"?"ALERT":type==="green"?"SUCCESS":"UPDATE",action:action||null}].concat(prev).slice(0,2);});
      setTimeout(function(){setToasts(function(prev){return prev.filter(function(t2){return t2.id!==tid;});});},2500);
    }
  }
  function removeToast(tid){setToasts(function(prev){return prev.filter(function(t2){return t2.id!==tid;});});}
  function handleToastAction(act){
    if(!act)return;
    if(act.type==="tab"){setTab(act.tab||"home");}
    else if(act.type==="boxScore"&&act.game){setSelGame(act.game);}
    else if(act.type==="phase"&&act.phase){
      if(act.phase==="reSign")setTab("reSign");
      else if(act.phase==="combine")setTab("combine");
      else if(act.phase==="draft")setTab("draft");
      else if(act.phase==="fa")setTab("fa");
      else setTab("home");
    }
    else if(act.type==="roster"){setTab("roster");}
    else if(act.type==="modal"&&act.modal==="preseasonReport"){setPreseasonReport(act.data);}
  }  // v7: Transaction Log
  var txSeqRef=useRef(0);// v58: Deterministic ordering counter (credit: ChatGPT v58 QA)
  function logTx(type,detail){txSeqRef.current++;setTxLog(function(h){return [{type:type,detail:detail,week:season.week,year:season.year,id:U(),seq:txSeqRef.current,tsWall:Date.now()}].concat(h).slice(0,200);});}
  function ledgerLog(type,teamId,summary,data){
    setSeason(function(s){return assign({},s,{ledger:LEDGER.log(s.ledger||[],type,teamId,summary,data,s.year,s.week,s.phase)});});
  }
  function addDefMoment80(playerId,icon,text,year){
    setDefMoments80(function(prev){
      var updated=assign({},prev);
      var existing=updated[playerId]||[];
      updated[playerId]=existing.concat([{icon:icon,text:text,year:year,id:U()}]).slice(-5);// Keep last 5 moments per player
      return updated;
    });
  }
  function tickStories(nt,wk){
    var active=stories.slice();var newStories=[];var u=nt.find(function(t){return t.id===myId;});
    if(!u) return;
    if(active.filter(function(s){return !s.resolved;}).length<5){
      STORY_TEMPLATES.forEach(function(tmpl){
        if(active.some(function(s){return s.templateId===tmpl.id&&!s.resolved;}))return;
        var healthy=u.roster.filter(function(p){return p.ovr>=74&&!(p.injury&&p.injury.games>0);}).sort(function(a,b){return b.ovr-a.ovr;});
        var injured=u.roster.filter(function(p){return p.injury&&p.injury.games>=4&&p.ovr>=75;});
        var rookies=u.roster.filter(function(p){return p.age<=23;});
        var contractYr=u.roster.filter(function(p){return p.contract.years===1&&p.ovr>=74&&p.age<=28;});
        var candidate=healthy[0]||null;
        if(tmpl.id==="injury_comeback")candidate=injured[0]||null;
        else if(tmpl.id==="rookie_spotlight"||tmpl.id==="rookie_wall")candidate=rookies.sort(function(a,b){return b.ovr-a.ovr;})[0]||null;
        else if(tmpl.id==="contract_year")candidate=contractYr[0]||null;
        else if(tmpl.id==="record_chase")candidate=healthy[0]||null;
        var ctx={phase:season.phase,weekNum:wk,player:candidate,losses:u.losses||0,wins:u.wins||0,roster:u.roster};
        if(tmpl.triggerFn(ctx)&&RNG.play()<0.12){
          var cast=candidate?{playerId:candidate.id,playerName:candidate.name,teamId:myId}:{teamId:myId};
          var rival=nt.filter(function(t){return t.id!==myId;}).sort(function(a,b){return (b.wins||0)-(a.wins||0);})[0];
          var story={id:U(),templateId:tmpl.id,type:tmpl.type,icon:tmpl.icon,stateIdx:0,weekStarted:wk,weekExpires:wk+tmpl.duration,cast:cast,resolved:false,pendingFx:[],sourceRefs:{}};
          newStories.push(story);
          var headline=tmpl.headlines[0].replace("{name}",cast.playerName||"Player").replace("{team1}",u.abbr).replace("{team2}",rival?rival.abbr:"OPP").replace("{deadline}",String(wk+tmpl.duration));
          var statLine=getStatHeadline(lastGameCtx);
          if(statLine)headline=statLine+", "+headline.charAt(0).toLowerCase()+headline.slice(1);
          addN(tmpl.icon+" "+headline,"gold");
        }
      });
    }
    active.forEach(function(s){
      if(s.resolved)return;
      var tmpl=STORY_TEMPLATES.find(function(t){return t.id===s.templateId;});
      if(!tmpl)return;
      var sCast=s.cast||{};
      if(wk>=s.weekExpires){s.resolved=true;s.stateIdx=tmpl.states.length-1;
        var endLine=tmpl.headlines[tmpl.headlines.length-1].replace("{name}",sCast.playerName||"Player").replace("{team1}",u?u.abbr:"").replace("{team2}","OPP");
        addN(tmpl.icon+" "+endLine,"green");return;}
      var progress=Math.floor((wk-s.weekStarted)/(tmpl.duration/tmpl.states.length));
      if(progress>s.stateIdx&&progress<tmpl.states.length){
        s.stateIdx=progress;
        var midLine=(tmpl.headlines[progress]||"").replace("{name}",sCast.playerName||"Player").replace("{team1}",u?u.abbr:"").replace("{team2}","OPP");
        addN(tmpl.icon+" "+midLine,"orange");
      }
    });
    setStories(active.concat(newStories).filter(function(s){return !s.resolved||wk-s.weekExpires<4;}));
  }
  function handleStoryAction(storyId,actionId){
    var ns=stories.slice();var story=ns.find(function(s){return s.id===storyId;});
    if(!story)return;story.resolved=true;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var storyCast=story.cast||{};
    var p=storyCast.playerId&&u2?u2.roster.find(function(x){return x.id===storyCast.playerId;}):null;
    var name=storyCast.playerName||"Player";
    if(actionId==="pay"&&p){
      p.contract.baseSalary=Math.round(((p.contract.baseSalary||p.contract.salary||0)+4)*10)/10;
      p.contract.salary=calcCapHit(p.contract);// v35: recalc compat field
      p.morale=cl((p.morale||70)+15,40,99);u2.capUsed=capCalc(u2.roster);
      addN("ðŸ’° Paid "+name+" â€” morale boosted, cap hit +$4M","green");
      ledgerLog("EXTENSION",myId,"Holdout payoff: "+name+" +$4M/yr",{name:name,bump:4});
    }else if(actionId==="fire"){addN("ðŸª‘ Coaching change! New coach search begins.","red");
    }else if(actionId==="hold"){addN("ðŸ›¡ï¸ Holding firm on "+name+". Let's see how it plays out.","orange");
      if(p)p.morale=cl((p.morale||70)-8,30,99);
    }else if(actionId==="bench"){addN("ðŸ“š "+name+" moves to bench for development.","cyan");
      if(p){p.isStarter=false;p.morale=cl((p.morale||70)-5,30,99);}
    }else if(actionId==="start"){addN("â­ "+name+" stays in the starting lineup.","green");
      if(p)p.morale=cl((p.morale||70)+5,40,99);
    }else if(actionId==="rush"){addN("ðŸ¥ Rushing "+name+" back â€” risk of re-injury!","red");
      if(p){setPlayerInjury92(p,"Setback Risk",rng(0,3));p.morale=cl((p.morale||70)+8,40,99);}
    }else if(actionId==="patient"){addN("ðŸ‹ï¸ "+name+" taking the full rehab route. +2 weeks.","cyan");
      if(p&&p.injury)setPlayerInjury92(p,p.injury.type||"Injury",(p.injury.games||0)+2);
    }else if(actionId==="deny"){addN("ðŸ“± 'Not true.' Trade rumors denied publicly.","green");
      if(p)p.morale=cl((p.morale||70)+4,40,99);
    }else if(actionId==="listen"){addN("ðŸ“ž Taking calls on "+name+"... locker room uneasy.","orange");
      if(u2)u2.roster.forEach(function(pl){pl.morale=cl((pl.morale||70)-2,30,99);});
    }else if(actionId==="spend"){addN("ðŸ’µ Opening the wallet for free agents!","green");
      if(u2)u2.cash=(u2.cash||0)+10;
    }else if(actionId==="wait"){addN("â³ Staying patient. FA money stays in the vault.","dim");
    }else if(actionId==="block"){addN("ðŸš« Blocked coordinator interview. Staff loyalty boosted.","green");
    }else if(actionId==="allow"){addN("ðŸ‘‹ Letting coordinator interview. Could lose them.","orange");
    }else if(actionId==="start_vet"){addN("ðŸˆ Sticking with the veteran QB. Stability wins.","green");
      var qbs=u2?u2.roster.filter(function(x){return x.pos==="QB";}):[];
      if(qbs[0])qbs[0].morale=cl((qbs[0].morale||70)+8,40,99);
      if(qbs[1])qbs[1].morale=cl((qbs[1].morale||70)-6,30,99);
    }else if(actionId==="start_kid"){addN("ðŸ”¥ THE KID STARTS. New era begins.","gold");
      var qbs2=u2?u2.roster.filter(function(x){return x.pos==="QB";}).sort(function(a,b){return a.age-b.age;}):[];
      if(qbs2[0]){qbs2[0].isStarter=true;qbs2[0].morale=cl((qbs2[0].morale||70)+12,40,99);}
      if(qbs2.length>1)qbs2[qbs2.length-1].isStarter=false;
    }else if(actionId==="side_vet"){addN("Â©ï¸ Backed the captain. Locker room stabilized.","green");
      if(u2)u2.roster.filter(function(x){return hasTrait95(x,"captain")||hasTrait95(x,"mentor");}).forEach(function(x){x.morale=cl((x.morale||70)+6,40,99);});
      if(u2)u2.roster.filter(function(x){return hasTrait95(x,"hothead")||hasTrait95(x,"cancer");}).forEach(function(x){x.morale=cl((x.morale||70)-8,30,99);});
    }else if(actionId==="side_hot"){addN("ðŸŒ¶ï¸ Backed the firestarter. Energy is electric... or toxic.","orange");
      if(u2)u2.roster.filter(function(x){return hasTrait95(x,"hothead");}).forEach(function(x){x.morale=cl((x.morale||70)+10,40,99);});
      if(u2)u2.roster.filter(function(x){return hasTrait95(x,"captain");}).forEach(function(x){x.morale=cl((x.morale||70)-6,30,99);});
    }else if(actionId==="mediate"){addN("ðŸ¤ Mediated the conflict. Neutral ground.","cyan");
      if(u2)u2.roster.forEach(function(x){x.morale=cl((x.morale||70)+2,40,99);});
    }else if(actionId==="extend"&&p){
      p.contract.years+=3;p.contract.baseSalary=Math.round(((p.contract.baseSalary||p.contract.salary||0)+6)*10)/10;
      p.contract.salary=calcCapHit(p.contract);// v35: recalc compat
      p.morale=cl((p.morale||70)+15,40,99);u2.capUsed=capCalc(u2.roster);
      addN("âœï¸ Extended "+name+" â€” 3 years, +$6M/yr","green");
      ledgerLog("EXTENSION",myId,"Event extension: "+name+" +3yr/$"+p.contract.salary+"M",{name:name});
    }else if(actionId==="wait_fa"){addN("ðŸª Letting "+name+" walk to free agency.","orange");
      if(p)p.morale=cl((p.morale||70)-10,30,99);
    }else if(actionId==="rest"&&p){addN("ðŸ˜´ Reducing "+name+"'s snaps. Saving the legs.","cyan");
      p.isStarter=false;
    }else if(actionId==="push"){addN("ðŸ’ª Pushing "+name+" through the wall. Sink or swim.","orange");
    }else if(actionId==="trade"){addN("ðŸ“ž Shopping "+name+" around the league.","orange");
      if(p)p.morale=cl((p.morale||70)-10,30,99);
    }
    setTeams(nt);setStories(ns);logTx("STORY",{type:story.type,action:actionId});
  }
  function checkPresserTags(tags){
    if(!tags||!tags.length)return;
    var ns=stories.slice();
    PRESSER_TAG_TRIGGERS.forEach(function(trigger){
      var match=trigger.tags.every(function(tag){return tags.indexOf(tag)>=0;});
      if(!match)return;
      var existing=ns.find(function(s){return s.templateId===trigger.storyId&&!s.resolved;});
      if(existing&&trigger.advance>0){
        var tmpl=STORY_TEMPLATES.find(function(t){return t.id===trigger.storyId;});
        if(tmpl&&existing.stateIdx+trigger.advance<tmpl.states.length){
          existing.stateIdx+=trigger.advance;
          addN("ðŸ“° Press conference accelerated the "+tmpl.type+" storyline!","orange");
        }
      }
    });
    setStories(ns);
  }
  function genInbox(nt,wk,gameResult){
    var items=[];var u=nt.find(function(t){return t.id===myId;});if(!u) return items;
    if(gameResult){
      var won=gameResult.isHome?(gameResult.result.home>gameResult.result.away):(gameResult.result.away>gameResult.result.home);
      var uS=gameResult.isHome?gameResult.result.home:gameResult.result.away;
      var oS2=gameResult.isHome?gameResult.result.away:gameResult.result.home;
      items.push({type:"game",icon:"ðŸˆ",text:(won?"WIN":"LOSS")+" vs "+gameResult.oppAbbr+" "+uS+"-"+oS2,color:won?"green":"red",id:U()});
      if(gameResult.result&&gameResult.result.recap){
        var rc=gameResult.isHome?gameResult.result.recap.home:gameResult.result.recap.away;
        items.push({type:"recap",icon:"ðŸ“Š",text:"WHY YOU "+(won?"WON":"LOST"),color:won?"green":"red",id:U(),
          recap:rc,actionType:"recap"});
      }
      if(gameResult.result&&gameResult.result.coachImpact){
        var ci=gameResult.isHome?gameResult.result.coachImpact.home:gameResult.result.coachImpact.away;
        if(ci&&ci.traits.length>0){
          var traitNames=ci.traits.map(function(tr){
            var label=tr.key==="stallReduction"?"Fewer stalls":tr.key==="pressureBoost"?"More pressure":tr.key==="qbBoost"?"QB boost":
              tr.key==="rzTdBoost"?"Red zone":tr.key==="intBoost"?"Turnovers":tr.key==="pocketBoost"?"Pass pro":
              tr.key==="bigPlayBoost"?"Explosives":tr.key==="devRate"?"Dev boost":tr.key==="moraleBoost"?"Morale":tr.key;
            return label;}).join(", ");
          items.push({type:"coach",icon:"ðŸŽ©",text:"Coaching edge: "+(ci.edge>0?"+":"")+ci.edge+" pts ("+traitNames+")",
            color:ci.edge>0?"gold":"dim",id:U()});
        }
      }
      if(gameResult.result&&gameResult.result.coachTriggers){
        var ct=gameResult.isHome?gameResult.result.coachTriggers.home:gameResult.result.coachTriggers.away;
        var triggerList=Object.keys(ct).filter(function(k){return ct[k].count>0;}).map(function(k){
          var label=k==="stallReduction"?"Stall prevention":k==="pressureBoost"?"Pressure":k==="pocketBoost"?"Pass protection":
            k==="intBoost"?"Ball hawking":k==="intReduction"?"Discipline":k==="qbBoost"?"QB coaching":
            k==="bigPlayBoost"?"Explosive plays":k==="rzTdBoost"?"Red zone script":k;
          return label+" Ã—"+ct[k].count;
        });
        if(triggerList.length>0){
          items.push({type:"trigger",icon:"ðŸŽ¯",text:"Trait triggers: "+triggerList.join(", "),color:"purple",id:U()});
        }
      }
      if(gameResult.result){
        var explain3=buildExplain3(gameResult.result,gameResult.isHome);
        if(explain3&&explain3.reasons.length>0){
          explain3.reasons.forEach(function(r,ri){
            items.push({type:"explain3",icon:r.icon,text:r.text,color:won?"green":"red",id:U()});
          });
          items.push({type:"fix",icon:"ðŸ”§",text:"Fix: "+explain3.fix,color:"cyan",id:U()});
          if(explain3.fixMenus&&explain3.fixMenus.length>0){
            explain3.fixMenus.forEach(function(menu){
              var optTexts=menu.options.map(function(o){return typeof o==="string"?o:o.text;});
              items.push({type:"fixMenu",icon:"ðŸ“‹",text:"Fix "+menu.label+": "+optTexts.join(" | "),color:"cyan",id:U(),
                fixOptions:menu.options});
            });
          }
        }
      }
    }
    u.roster.filter(function(p){return p.injury&&p.injury.games>0;}).forEach(function(p){
      items.push({type:"injury",icon:"ðŸ¤•",text:p.name+"("+p.pos+") "+p.injury.type+" â€” "+p.injury.games+"wk",color:"red",id:U()});
    });
    var sal=u.capUsed/14;
    items.push({type:"finance",icon:"ðŸ’°",text:"Weekly salary: -$"+Math.round(sal*10)/10+"M | Cash: $"+Math.round(u.cash*10)/10+"M | Cap: $"+capCalc(u.roster).toFixed(1)+"M/$"+getSalaryCap(season.year)+"M",color:"info",id:U()});
    if(u.ownerMood<40){items.push({type:"owner",icon:"ðŸ”¥",text:"OWNER WARNING: \"Win games or I'm cleaning house.\" Mood: "+u.ownerMood,color:"red",urgent:true,id:U()});}
    else if(u.ownerMood>85){items.push({type:"owner",icon:"ðŸ˜Š",text:"Owner pleased. \"Keep it up.\" Mood: "+u.ownerMood,color:"green",id:U()});}
    if(u.scoutPts>=10){items.push({type:"scout",icon:"ðŸ”",text:"ðŸ” "+u.scoutPts+" scout points available (10% decay on unused). Use 'em or lose 'em!",color:"cyan",id:U()});}
    var expiring=u.roster.filter(function(p){return p.contract.years===1&&p.ovr>=68;});
    if(expiring.length>0&&wk%3===0){var pe=expiring[Math.floor(RNG.ai()*expiring.length)];
      if(pe){
        var inflate=1+Math.max(0,(season.year-2026)*0.03);// +3% per year
        var askSalary=Math.round(pe.contract.salary*(hasTrait95(pe,"mercenary")?1.4:hasTrait95(pe,"loyal")?1.0:1.2)*inflate*10)/10;
        var askYears=rng(2,4);
        items.push({type:"extension",icon:"âœï¸",
          text:pe.name+"("+pe.pos+", "+pe.ovr+" OVR) wants extension: $"+askSalary+"M/"+askYears+"yr",
          color:"orange",id:U(),actionType:"extension",playerId:pe.id,playerName:pe.name,playerPos:pe.pos,playerOvr:pe.ovr,playerTrait:pe.trait,
          askSalary:askSalary,askYears:askYears});
      }
    }
    var injured=u.roster.filter(function(p){return p.injury&&p.injury.games>=3;});
    if(injured.length>0&&wk%2===0){var ip=injured[Math.floor(RNG.ai()*injured.length)];
      if(ip)items.push({type:"medical",icon:"ðŸ¥",
        text:ip.name+"("+ip.pos+") "+ip.injury.type+" â€” "+ip.injury.games+"wk left. Rush back or play it safe?",
        color:"blue",id:U(),actionType:"medical",playerId:ip.id,playerName:ip.name,injuryGames:ip.injury.games});
    }
    var unhappy=u.roster.filter(function(p){return p.morale<45&&p.ovr>=75&&p.contract.years>=2;});
    if(unhappy.length>0&&wk%5===0){var hp=unhappy[0];
      if(hp){
        var holdoutTier86=getPosMarketTier86(hp.pos);
        var holdoutPct86=holdoutTier86.holdoutRaisePct||0.15;
        var holdoutBump=Math.round(hp.contract.salary*holdoutPct86*10)/10;
        items.push({type:"holdout",icon:"ðŸ˜¤",
          text:hp.name+"("+hp.pos+", "+hp.ovr+") is holding out! Demanding $"+holdoutBump+"M raise or morale tanks further.",
          color:"red",id:U(),urgent:true,actionType:"holdout",playerId:hp.id,playerName:hp.name,bumpAmount:holdoutBump});
      }
    }
    u.roster.forEach(function(p){var cs=p.careerStats||{};
      if((cs.passYds||0)>0&&(cs.passYds||0)%5000<200)items.push({type:"milestone",icon:"ðŸ†",text:p.name+" approaching "+Math.ceil((cs.passYds||0)/5000)*5000+" career passing yards!",color:"purple",id:U()});
    });
    if(wk===12)items.push({type:"calendar",icon:"ðŸ“…",text:"TRADE DEADLINE in 2 weeks. Make your moves.",color:"orange",id:U()});
    if(wk===14)items.push({type:"calendar",icon:"ðŸš¨",text:"TRADE DEADLINE! Last chance to deal this season.",color:"red",urgent:true,id:U()});
    return items;
  }
  function doSave(nt,ns,nse,nf,nh){
    var saveSched=compressSchedule(ns||sched,(nse||season).week,myId);
    var saveTeams973=(nt||teams)||[];
    saveTeams973.forEach(function(t){if(t&&t.franchiseTag973===undefined)t.franchiseTag973=null;});
    var saveData={saveVersion:SAVE_VERSION,difficulty:difficulty,godMode:godMode,teams:saveTeams973,myId:myId,sched:saveSched,season:nse||season,fas:nf||fas,dc:dc,history:compressHistory(nh||history),records:records,txLog:txLog,seed:SEED_GLOBAL,hallOfFame:hallOfFame,unlocks:unlocks,dna:leagueDNA,owner:owner,mandates:mandates,coachTree:COACHING_TREE_LOG,seasonAwards:seasonAwards,trophyNames:trophyNames,awardHistory:AWARD_HISTORY_LOG,coachLegacy:COACH_LEGACY_LOG,ringOfHonor:RING_OF_HONOR_LOG,hallOfFameLog:HALL_OF_FAME_LOG,broadcastSeq:BROADCAST_SEQ,captainId:captainId,captMoments:captMoments,pracFocus:pracFocus,pracXpWeek87:pracXpWeek87,scoutDB:scoutDB,mediaState:mediaState,prospectDB:prospectDB,coachClinic:coachClinic,tradeState:tradeState,frontOffice78:frontOffice78,userPlaylist:userPlaylist,gamedayTrack:gamedayTrack,draftShortlist79:draftShortlist79,warRoomFlags79:warRoomFlags79,mfsnGradeHistory80:mfsnGradeHistory80,breakouts80:breakouts80,mentorships80:mentorships80,defMoments80:defMoments80,ownerPatience80:ownerPatience80,offseasonNews80:offseasonNews80,seasonPreds80:seasonPreds80,mfsnDraftGrade80:mfsnDraftGrade80,holdoutStages80:holdoutStages80,scoutBudget81:scoutBudget81,staffPoachTargets81:staffPoachTargets81,ownerMeeting81:ownerMeeting81,ownerPenalty81:ownerPenalty81,ultimatumDeadline81:ultimatumDeadline81,coachSkillTree81:coachSkillTree81,offseasonEvents81:offseasonEvents81,prHistory81:prHistory81,faBids82:faBids82,faPhase82:faPhase82,faRound82:faRound82,faVisits82:faVisits82,faRFA82:faRFA82,faSignings82:faSignings82,posBattles974:posBattles974,draftHistory98:draftHistory98,powerRankings986:powerRankings986,gmRep986:gmRep986,timeline986:timeline986,compPicks986:compPicks986,rivalTrophies986:rivalTrophies986,prevRankings986:prevRankings986};
    saveData.checksum=computeSaveChecksum(saveData);saveG(saveData);
  }
  function exportSave(){
    var data={save:_save,boxHistory:boxHistory,version:"12.2",exported:new Date().toISOString()};
    var blob=new Blob([JSON.stringify(data)],{type:"application/json"});
    var url=URL.createObjectURL(blob);
    var a=document.createElement("a");a.href=url;a.download="mr-football-save-"+season.year+"-wk"+season.week+".json";
    document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);
    addN("ðŸ’¾ Save exported! Check your downloads.","green");
  }
  function loadVaultArchives(){
    if(!DB.ready){addN("âš ï¸ Vault not available â€” using fallback storage","orange");setVaultArchives([]);return;}
    DB.getAllKeys("archive").then(function(keys){
      if(!keys||keys.length===0){setVaultArchives([]);return;}
      var promises=keys.map(function(k){return DB.read("archive",k);});
      Promise.all(promises).then(function(results){
        var archives=results.filter(Boolean).sort(function(a,b){return(b.year||0)-(a.year||0);});
        setVaultArchives(archives);
      });
    }).catch(function(){setVaultArchives([]);});
  }
  function deleteVaultArchive(seasonId){
    if(!DB.ready)return;
    DB.remove("archive",seasonId).then(function(){
      addN("ðŸ—‘ï¸ Season "+seasonId+" archive deleted from Vault.","orange");
      loadVaultArchives();// Refresh list
    });
  }
  function exportClipboard(){
    try{
      var raw=JSON.stringify({save:_save,version:SAVE_VERSION,exported:new Date().toISOString()});
      var b64=LZW.compressToBase64(raw);
      if(navigator.clipboard&&navigator.clipboard.writeText){
        navigator.clipboard.writeText(b64).then(function(){addN("ðŸ“‹ Save copied to clipboard.","green");});
      }else{
        var ta=document.createElement("textarea");ta.value=b64;document.body.appendChild(ta);ta.select();
        document.execCommand("copy");document.body.removeChild(ta);
        addN("ðŸ“‹ Save copied to clipboard.","green");
      }
    }catch(e){addN("âŒ Export failed: "+e.message,"red");}
  }
  function importClipboard(str){
    if(!str||!str.trim()){addN("âŒ Import failed. Save string is invalid.","red");return;}
    try{
      var raw=LZW.decompressFromBase64(str.trim());
      var data=JSON.parse(raw);
      if(data.save){
        _save=data.save;saveG(data.save);
        loadSave2();
        addN("âœ… Save imported.","green");
      }else{addN("âŒ Import failed. Save string is invalid.","red");}
    }catch(e){
      try{
        var data2=JSON.parse(str.trim());
        if(data2.save){_save=data2.save;saveG(data2.save);loadSave2();addN("âœ… Save imported.","green");}
        else{addN("âŒ Import failed. Save string is invalid.","red");}
      }catch(e2){addN("âŒ Couldn't decode that save. Try copying again.","red");}
    }
  }
  function validateSaveData(data){
    var errors=[];
    if(!data)return["No data found in file."];
    if(!data.save&&!data.teams)return["Missing save data structure."];
    var s=data.save||data;
    if(!s.saveVersion&&!s.version)errors.push("Missing save version.");
    if(s.saveVersion&&s.saveVersion>SAVE_VERSION+5)errors.push("Save version "+s.saveVersion+" is too far ahead (max supported: "+SAVE_VERSION+").");
    if(!s.teams||!Array.isArray(s.teams))errors.push("Missing or invalid teams array.");
    if(s.teams&&s.teams.length<24)errors.push("Expected 24+ teams, found "+s.teams.length+".");
    if(s.teams&&s.teams.length>35)errors.push("Too many teams ("+s.teams.length+") â€” suspicious data.");
    if(!s.myId)errors.push("Missing user team ID (myId).");
    if(s.teams){
      var userTeam=s.teams.find(function(t){return t.id===s.myId;});
      if(!userTeam)errors.push("User team ID '"+s.myId+"' not found in teams array.");
      s.teams.forEach(function(t,i){
        if(!t.id)errors.push("Team #"+i+" missing id.");
        if(!t.roster||!Array.isArray(t.roster))errors.push("Team "+(t.abbr||t.id||i)+" has no roster array.");
        if(t.roster&&t.roster.length<15)errors.push("Team "+(t.abbr||i)+" roster too small ("+t.roster.length+").");
        if(t.roster&&t.roster.length>80)errors.push("Team "+(t.abbr||i)+" roster too large ("+t.roster.length+").");
      });
    }
    if(!s.season)errors.push("Missing season state.");
    if(s.season&&(!s.season.year||s.season.year<2020||s.season.year>2100))errors.push("Season year out of range: "+((s.season||{}).year));
    return errors;
  }
  function repairSaveData(data){
    var repairs=[];var s=data.save||data;
    if(!s.saveVersion&&s.version){s.saveVersion=s.version;repairs.push("Mapped versionâ†’saveVersion");}
    if(!s.saveVersion){s.saveVersion=1;repairs.push("Set missing saveVersion to 1");}
    if(!s.season){s.season={year:2026,week:1,phase:"regular"};repairs.push("Created default season state");}
    if(!s.season.year||s.season.year<2020){s.season.year=2026;repairs.push("Fixed season year to 2026");}
    if(!s.season.rivalries)s.season.rivalries={};
    if(!s.teams)return{repaired:false,repairs:["Cannot repair: no teams array"],data:data};
    s.teams.forEach(function(t,i){
      if(!t.id){t.id=i;repairs.push("Assigned id "+i+" to team #"+i);}
      if(!t.roster){t.roster=[];repairs.push("Created empty roster for team "+(t.abbr||i));}
      if(!Array.isArray(t.roster)){t.roster=[];repairs.push("Reset corrupted roster for team "+(t.abbr||i));}
      if(!t.staff){t.staff={hc:{name:"HC",ratings:{strategy:50,gameplan:50,development:50}},oc:{name:"OC",ratings:{gameplan:50,development:50}},dc:{name:"DC",ratings:{gameplan:50,development:50}}};repairs.push("Created default staff for "+(t.abbr||i));}
      if(t.capUsed===undefined)t.capUsed=0;
      if(t.wins===undefined){t.wins=0;t.losses=0;}
      if(!t.facilities)t.facilities={gym:0,med:0,scout:0,stad:0};
      t.roster.forEach(function(p){
        if(!p.id){p.id=U();repairs.push("Generated ID for unnamed player on "+(t.abbr||i));}
        if(!p.ratings)p.ratings={};
        if(!p.contract){p.contract={salary:0.5,years:1,bonus:0,guarantee:0};repairs.push("Created default contract for "+p.name);}
        if(!p.stats)p.stats={gp:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,rec:0,recYds:0,recTD:0,sacks:0,tackles:0,defINT:0,fgM:0,fgA:0};
        if(!p.careerStats)p.careerStats={seasons:0,allPros:0,proBowls:0};
      });
    });
    if(!s.myId&&s.teams.length>0){s.myId=s.teams[0].id;repairs.push("Set myId to first team");}
    if(!s.sched)s.sched=[];
    if(!s.fas)s.fas=[];
    if(!s.history)s.history=[];
    if(data.save)data.save=s;
    return{repaired:repairs.length>0,repairs:repairs,data:data};
  }
  function importSave(e){
    var file=e.target.files[0];if(!file) return;
    var reader=new FileReader();
    reader.onload=function(ev){
      try{
        var data=JSON.parse(ev.target.result);
        var errors=validateSaveData(data);
        if(errors.length>0){
          addN("âš ï¸ Import found "+errors.length+" issue(s) â€” attempting repair...","orange");
          var repairResult=repairSaveData(data);
          if(repairResult.repaired){
            repairResult.repairs.slice(0,8).forEach(function(r){addN("  ðŸ”§ "+r,"info");});
            if(repairResult.repairs.length>8)addN("  ...and "+(repairResult.repairs.length-8)+" more repairs","info");
            ledgerLog("IMPORT_REPAIR",myId||0,"Auto-repaired "+repairResult.repairs.length+" issues on import",{repairs:repairResult.repairs.slice(0,20)});
            data=repairResult.data;
            var errors2=validateSaveData(data);
            if(errors2.length>0){
              addN("âŒ Import still has "+errors2.length+" unfixable issue(s):","red");
              errors2.slice(0,5).forEach(function(err){addN("  âš ï¸ "+err,"orange");});
              return;
            }
            addN("âœ… Repair successful! Importing...","green");
          }else{
            addN("âŒ Import failed â€” cannot auto-repair:","red");
            errors.slice(0,5).forEach(function(err){addN("  âš ï¸ "+err,"orange");});
            return;
          }
        }
        if(data.save){
          _save=data.save;saveG(data.save);
          if(data.boxHistory){setBoxHistory(data.boxHistory);saveBoxScores(data.boxHistory);}
          loadSave2();
          addN("ðŸ“‚ Save imported successfully! Season "+(_save.season?_save.season.year:"?"),"green");
        }else{addN("âŒ Invalid save file.","red");}
      }catch(ex){addN("âŒ Failed to parse save file: "+ex.message,"red");}
    };
    reader.readAsText(file);
  }
  function handleLockerChoice(item,action){
    if(!my)return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return;
    var roster=u2.roster||[];
    if(action==="call_meeting"){
      roster.forEach(function(p){if(!p)return;p.morale=cl((p.morale||70)+3,30,99);});
      if(RNG.ai()<0.30){roster.forEach(function(p){if(!p)return;p.chemistry=cl((p.chemistry||60)-2,15,100);});
        addN("ðŸ—£ï¸ Team meeting helped morale (+3) but some players didn't respond well (-2 chemistry)","orange");}
      else{addN("ðŸ—£ï¸ Team meeting fired up the locker room! +3 morale","green");}
    }else if(action==="stay_quiet"){
      addN("ðŸ¤« You stayed quiet. Players will handle it themselves.","info");
    }else if(action==="back_star"){
      var star=roster.find(function(p){return p&&p.contractDispute&&p.ovr>=82;});
      if(star)star.chemistry=cl((star.chemistry||60)+6,15,100);
      roster.forEach(function(p){if(!p)return;if(p.id!==(star||{}).id)p.chemistry=cl((p.chemistry||60)-2,15,100);});
      addN("ðŸ’ª You backed "+(star?star.name:"the star")+" publicly. Star chemistry +6, team -2.","gold");
    }else if(action==="stay_neutral"){
      roster.forEach(function(p){if(!p)return;p.chemistry=cl((p.chemistry||60)+1,15,100);});
      addN("ðŸ¢ Stayed neutral. Team chemistry +1, but the star remains unhappy.","info");
    }else if(action==="fine_player"){
      roster.forEach(function(p){if(!p)return;p.morale=cl((p.morale||70)-3,30,99);});
      u2.discipline=(u2.discipline||50)+2;// Fewer penalties next game
      addN("ðŸ’° Player fined! Morale dipped (-3) but discipline improved (+2).","orange");
    }else if(action==="private_talk"){
      var cancer=roster.find(function(p){return p&&hasTrait95(p,"cancer")&&(p.chemistry||60)<35;});// v95.6: hasTrait95
      if(cancer)cancer.chemistry=cl((cancer.chemistry||60)+1,15,100);
      roster.forEach(function(p){if(!p)return;p.morale=cl((p.morale||70)-1,30,99);});
      addN("ðŸ¤ Private talk with the troublemaker. Slight chemistry gain, slight morale dip.","info");
    }
    // â”€â”€ CRISIS_ROOM v15 new action handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    else if(action==="lock_star_in"){
      var star_li=roster.find(function(p){return p&&p.ovr>=85&&(p.morale||70)<40;});
      if(star_li){star_li.morale=cl((star_li.morale||70)+8,30,99);star_li.contractDispute=false;
        if(star_li.contract)star_li.contract.years=Math.max(star_li.contract.years,4);}
      addN("ðŸ”’ LOCKED IN: Emergency extension offer out. "+((star_li&&star_li.name)||"Star")+" morale +8. Cap implications incoming.","gold");
    }else if(action==="go_public_trade"){
      var star_gp=roster.find(function(p){return p&&p.ovr>=85&&(p.morale||70)<40;});
      if(star_gp){if(RNG.ai()<0.45){star_gp.morale=cl((star_gp.morale||70)+5,30,99);star_gp.contractDispute=false;
        addN("ðŸ“£ CALLED OUT "+star_gp.name+" publicly â€” forced their hand! Crisis resolved, respect earned.","green");
      }else{roster.forEach(function(p){if(!p)return;p.morale=cl((p.morale||70)-3,30,99);});
        addN("ðŸ“£ Going public BACKFIRED â€” locker room fractured. Morale -3 team-wide.","red");}}
    }else if(action==="listen_offers"){
      var star_lo=roster.find(function(p){return p&&p.ovr>=85&&(p.morale||70)<40;});
      if(star_lo){star_lo.onBlock=true;roster.forEach(function(p){if(!p||p.id===star_lo.id)return;p.morale=cl((p.morale||70)-2,30,99);});}
      addN("ðŸ“ž Shopping "+((star_lo&&star_lo.name)||"the star")+"... locker room uneasy. Check trade tab for offers.","orange");
    }else if(action==="back_vets"){
      roster.forEach(function(p){if(!p)return;if(p.age>=28){p.morale=cl((p.morale||70)+8,30,99);p.chemistry=cl((p.chemistry||60)+5,15,100);}
        else if(p.age<=23)p.morale=cl((p.morale||70)-5,30,99);});
      var mvp_vet=roster.filter(function(p){return p&&p.age>=28&&p.ovr>=75;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      if(mvp_vet&&mvp_vet.devBonus!==undefined)mvp_vet.devBonus=(mvp_vet.devBonus||0)+2;
      addN("ðŸ§“ Backed the veterans! Vet morale +8, young core morale -5. Experience leads the way.","gold");
    }else if(action==="back_youngcore"){
      roster.forEach(function(p){if(!p)return;if(p.age<=23){p.morale=cl((p.morale||70)+10,30,99);p.chemistry=cl((p.chemistry||60)+6,15,100);}
        else if(p.age>=28)p.morale=cl((p.morale||70)-4,30,99);});
      var mvp_rook=roster.filter(function(p){return p&&p.age<=23&&p.ovr>=70;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
      if(mvp_rook&&mvp_rook.devBonus!==undefined)mvp_rook.devBonus=(mvp_rook.devBonus||0)+3;
      addN("âš¡ Backed the young core! New gen morale +10, veterans morale -4. Next gen takes over!","cyan");
    }else if(action==="force_bonding"){
      roster.forEach(function(p){if(!p)return;p.morale=cl((p.morale||70)+3,30,99);p.chemistry=cl((p.chemistry||60)+4,15,100);});
      addN("ðŸ¤ Mandatory team bonding â€” EVERYONE +3 morale, +4 chemistry. Practice took a hit this week.","gold");
    }else if(action==="face_music"){
      roster.forEach(function(p){if(!p)return;p.morale=cl((p.morale||70)-2,30,99);});
      u2.ownerMood=cl((u2.ownerMood||50)+5,0,100);
      addN("ðŸŽ™ï¸ Held press conference. Owned the losses publicly. Owner respect +5, team morale -2.","orange");
    }else if(action==="close_doors"){
      roster.forEach(function(p){if(!p)return;p.morale=cl((p.morale||70)+3,30,99);p.chemistry=cl((p.chemistry||60)+3,15,100);});
      u2.ownerMood=cl((u2.ownerMood||50)-3,0,100);
      addN("ðŸšª Media blackout. Team bonding internally. Team morale +3, owner patience -3.","gold");
    }else if(action==="shake_depth"){
      var starters=roster.filter(function(p){return p&&p.isStarter;}).slice(0,6);
      starters.forEach(function(p){if(RNG.ai()<0.5){p.morale=cl((p.morale||70)+5,30,99);addN("âš¡ "+p.name+" RESPONDS to depth chart shake-up! Playing with fire.","green");}
        else{p.morale=cl((p.morale||70)-4,30,99);addN("ðŸ˜¤ "+p.name+" rattled by bench threat. Morale dipped.","orange");}});
    }else if(action==="redemption_spotlight"){
      var slumper=roster.find(function(p){return p&&p._arcState==="SLUMP"&&p.ovr>=78;});
      if(slumper){if(RNG.ai()<0.55){slumper.morale=cl((slumper.morale||70)+15,30,99);slumper._arcState="ELITE";
        addN("ðŸŒŸ REDEMPTION! "+slumper.name+" DELIVERED in the spotlight! Arc resets to ELITE! DYNASTY MOMENT!","gold");
      }else{slumper.morale=cl((slumper.morale||70)-5,30,99);
        addN("ðŸ’” "+slumper.name+" crumbled under the spotlight. Slump deepens. Morale -5.","red");}}
    }else if(action==="redemption_slow"){
      var slumper2=roster.find(function(p){return p&&p._arcState==="SLUMP"&&p.ovr>=78;});
      if(slumper2){slumper2.morale=cl((slumper2.morale||70)+5,30,99);slumper2._arcTurns=(slumper2._arcTurns||0)-2;}
      addN("ðŸ“Š Easing "+((slumper2&&slumper2.name)||"them")+" back. Steady +5 morale. Arc resolution accelerated.","cyan");
    }else if(action==="redemption_organic"){
      addN("ðŸ”„ Letting it unfold naturally. No pressure added. Arc will resolve on its own timeline.","info");
    }
    ledgerLog("LOCKER_CHOICE",myId,"Locker room choice: "+action,{eventId:item?item.eventId:(crisisRoom?crisisRoom.eventId:""),action:action,week:season.week});
    setInbox(function(prev){return prev.filter(function(x){return x.id!==(item?item.id:"");});});
    setCrisisRoom(null);
    setTeams(nt);doSave(nt);
  }
  function applyPracticeFocusChoice(focusId,sourceTag,silent){
    var pf=PRACTICE_FOCUS.find(function(p){return p.id===focusId;});
    if(!pf)return;
    var already=pracFocus===focusId;
    if(already){
      if(!silent)addN("ðŸ‹ï¸ Practice Focus already set: "+pf.label,"dim");
      return;
    }
    setPracFocus(focusId);
    var wkKey=(season.year||0)+"-W"+(season.week||0);
    var canEarnXp=pracXpWeek87!==wkKey;
    if(canEarnXp){
      var clinicAct67=focusId==="scout"?"scout_practice":focusId==="dev"?"dev_camp":focusId==="recovery"?"recovery":"full_pads";
      setCoachClinic(function(prev){return CLINIC.earnXP(assign({},prev),clinicAct67,5);});
      setPracXpWeek87(wkKey);
    }
    if(silent)return;
    addN("ðŸ‹ï¸ Practice Focus â†’ "+pf.label+(sourceTag?" ("+sourceTag+")":"")+(canEarnXp?"":" | XP already earned this week"),"cyan");
  }
  function setFitAlertPref84(groupId,key,value,silent){
    if(!my||!groupId)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return;
    if(!u2.fitAlertPrefs84)u2.fitAlertPrefs84={};
    var cur=normalizeFitAlertPref85(u2.fitAlertPrefs84[groupId]||{});
    var next=assign({},cur);next[key]=value;
    if(next.minSeverity!=="high")next.minSeverity="any";
    if(next.snoozeUntil===undefined||next.snoozeUntil===null)next.snoozeUntil=null;
    if(next.highOnlyWeek===undefined||next.highOnlyWeek===null)next.highOnlyWeek=null;
    if(key==="minSeverity")next.highOnlyWeek=null;// Manual severity edit becomes explicit custom behavior
    if(next.highOnlyWeek!==null){
      var _hW=parseInt(next.highOnlyWeek,10);
      next.highOnlyWeek=isFinite(_hW)?_hW:null;
    }
    u2.fitAlertPrefs84[groupId]=next;
    u2.fitAlertProfile85=detectFitAlertProfile85(u2,season.week||1);
    setTeams(nt);doSave(nt);
    if(!silent)addN("ðŸ”• Fit alert preference updated for "+String(groupId).toUpperCase()+".","dim");
  }
  function applyFitAlertPreset84(groupId,presetId){
    if(!my||!groupId)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return;
    if(!u2.fitAlertPrefs84)u2.fitAlertPrefs84={};
    var next={snoozeUntil:null,minSeverity:"any",highOnlyWeek:null};
    if(presetId==="3wk"){next.snoozeUntil=(season.week||1)+3;}
    else if(presetId==="season"){next.snoozeUntil=(season.week||1)+20;}
    else if(presetId==="silent"){next.snoozeUntil=9999;next.minSeverity="high";}
    u2.fitAlertPrefs84[groupId]=next;
    u2.fitAlertProfile85=detectFitAlertProfile85(u2,season.week||1);
    setTeams(nt);doSave(nt);
    addN("ðŸ”• "+String(groupId).toUpperCase()+" alert preset â†’ "+(presetId==="active"?"Active":presetId==="3wk"?"Snooze 3wk":presetId==="season"?"Snooze Season":"Permanent Silent"),"dim");
  }
  function applyAlertProfile84(profileId){
    if(!my)return;
    var pid=(profileId==="balanced"||profileId==="minimal"||profileId==="strict")?profileId:"strict";
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return;
    if(!u2.fitAlertPrefs84)u2.fitAlertPrefs84={};
    var wk=season.week||1;
    var pref=profilePref85(pid,wk);
    FIT_GROUP_DEFS.forEach(function(gd){
      u2.fitAlertPrefs84[gd.id]=assign({},pref);
    });
    u2.fitAlertProfile85=pid;
    setTeams(nt);doSave(nt);
    addN("ðŸš¨ Fit alert profile set to "+(pid==="strict"?"Strict":pid==="balanced"?"Balanced":"Minimal")+".","cyan");
  }
  function resetFitAlertPrefs84(){
    if(!my)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return;
    u2.fitAlertPrefs84={};
    u2.fitAlertProfile85="strict";
    setTeams(nt);doSave(nt);
    addN("ðŸ”” Fit alert preferences reset to defaults.","cyan");
  }
  function activateGMShortlist84(alert){
    if(!my||!alert){setGmShortlist84(null);return;}
    var list=buildGMShortlist84(my,alert,fas,5);
    if(!list||list.length===0){
      setGmShortlist84(null);
      setPosF("ALL");
      setTTI(null);
      setTab("fa");
      addN("ðŸŽ¯ No upgrade targets found for "+(alert.label||"this group")+".","dim");
      return;
    }
    setGmShortlist84(list);
    setPosF("ALL");
    setTTI(null);
    setTab("fa");
    addN("ðŸŽ¯ "+list.length+" upgrade targets found for "+(alert.label||"this group")+".","gold");
  }
  function getFAContractIntel92(playerId,actualDemand){
    return getContractIntelRange92(actualDemand,frontOffice78,!!faIntel92[playerId]);
  }
  function callAgentContractIntel92(playerId,playerName){
    if(!my)return;
    var cost=30;
    if((my.scoutPts||0)<cost){
      addN("Not enough scout points! Need "+cost+", have "+(my.scoutPts||0)+".","red");
      return;
    }
    var nt=teams.slice();
    var u2=nt.find(function(t){return t.id===myId;});
    if(!u2)return;
    u2.scoutPts=(u2.scoutPts||0)-cost;
    setTeams(nt);
    setFaIntel92(function(prev){
      var next=assign({},prev);
      next[playerId]=1;
      return next;
    });
    doSave(nt);
    addN("ðŸ“ž Agent call complete: exact demand revealed for "+(playerName||"player")+".","cyan");
  }
  function handleInboxAction(item,action){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    if(item.actionType==="extension"){
      if(!godMode&&!canDoAction(season.phase,"canExtend")){addN("ðŸš« Cannot extend during "+(PHASE_RULES[season.phase]||{}).label+".","red");return;}
      var p=u2.roster.find(function(x){return x.id===item.playerId;});
      if(!p){addN("Player no longer on roster.","red");setInbox(function(prev){return prev.filter(function(x){return x.id!==item.id;});});return;}
      if(action==="accept"){
        if(u2.capUsed+(u2.deadCap||0)+item.askSalary-calcCapHit(p.contract)>getSalaryCap(season.year)){addN("Over cap! Can't afford extension.","red");return;}
        var extBonus=Math.round(item.askSalary*0.3*item.askYears*10)/10;
        p.contract=makeContract(Math.max(Math.round(item.askSalary*0.7*10)/10,MIN_SALARY),item.askYears,extBonus,Math.round(item.askSalary*2*10)/10);
        u2.capUsed=capCalc(u2.roster);
        addN("âœï¸ Extended "+p.name+" $"+item.askSalary+"M/"+item.askYears+"yr!","green");
        logTx("EXTENSION",{name:p.name,pos:p.pos,salary:item.askSalary,years:item.askYears});
      }else if(action==="counter"){
        var counterSal=Math.round(item.askSalary*0.85*10)/10;
        var demand=item.askSalary*(hasTrait95(p,"mercenary")?1.0:hasTrait95(p,"loyal")?0.75:0.9);// v95.6: hasTrait95
        if(counterSal>=demand){
          var ctrBonus=Math.round(counterSal*0.3*item.askYears*10)/10;
          p.contract=makeContract(Math.max(Math.round(counterSal*0.7*10)/10,MIN_SALARY),item.askYears,ctrBonus,Math.round(counterSal*2*10)/10);
          u2.capUsed=capCalc(u2.roster);
          addN("âœï¸ Counter accepted! "+p.name+" signed $"+counterSal+"M/"+item.askYears+"yr!","green");
          logTx("EXTENSION",{name:p.name,pos:p.pos,salary:counterSal,years:item.askYears,counter:true});
        }else{
          addN("âŒ "+p.name+" rejected counter ($"+counterSal+"M). Wanted $"+item.askSalary+"M.","red");
          if(hasTrait95(p,"mercenary")){p.morale=cl((p.morale||70)-15,30,99);addN("ðŸ’° "+p.name+" furious! Morale tanked.","orange");}// v95.6: hasTrait95
        }
      }else{// decline
        p.morale=cl((p.morale||70)-10,30,99);
        addN("âŒ Declined "+p.name+"'s extension request. Morale dropped.","orange");
        if(hasTrait95(p,"mercenary")){p.morale=cl((p.morale||70)-10,30,99);p.onTradeBlock=true;addN("ðŸ’° "+p.name+" demands trade!","red");}
      }
    }
    else if(item.actionType==="medical"){
      var mp=u2.roster.find(function(x){return x.id===item.playerId;});
      if(!mp||!mp.injury||mp.injury.games<=0){setInbox(function(prev){return prev.filter(function(x){return x.id!==item.id;});});return;}
      if(action==="rush"){
        setPlayerInjury92(mp,mp.injury.type||"Injury",Math.max(0,mp.injury.games-rng(2,3)));
        if(RNG.injury()<0.35){// 35% re-injury risk
          setPlayerInjury92(mp,"aggravated "+(mp.injury.type||"injury"),(mp.injury.games||0)+rng(3,6));
          addN("ðŸš‘ "+mp.name+" re-injured! "+mp.injury.type+" â€” "+mp.injury.games+"wk","red");
          logTx("MEDICAL",{name:mp.name,choice:"rush",reinjured:true,weeks:mp.injury.games});
        }else{
          addN("âœ… "+mp.name+" rushed back successfully! "+mp.injury.games+"wk remaining.","green");
          logTx("MEDICAL",{name:mp.name,choice:"rush",reinjured:false,weeks:mp.injury.games});
        }
      }else{// conservative
        setPlayerInjury92(mp,mp.injury.type||"Injury",Math.max(0,mp.injury.games-1));// Extra week of healing
        addN("ðŸ¥ "+mp.name+" on conservative rehab. "+mp.injury.games+"wk remaining. Safe recovery.","blue");
        logTx("MEDICAL",{name:mp.name,choice:"conservative",weeks:mp.injury.games});
      }
    }
    else if(item.actionType==="holdout"){
      var hp2=u2.roster.find(function(x){return x.id===item.playerId;});
      if(!hp2){setInbox(function(prev){return prev.filter(function(x){return x.id!==item.id;});});return;}
      if(action==="pay"){
        hp2.contract.baseSalary=Math.round(((hp2.contract.baseSalary||hp2.contract.salary||0)+item.bumpAmount)*10)/10;
        hp2.contract.salary=calcCapHit(hp2.contract);// v35: recalc compat
        u2.capUsed=capCalc(u2.roster);
        hp2.morale=cl((hp2.morale||70)+20,40,99);
        addN("ðŸ’° Gave "+hp2.name+" $"+item.bumpAmount+"M raise. Holdout over!","green");
        logTx("HOLDOUT",{name:hp2.name,choice:"pay",bump:item.bumpAmount});
      }else{
        hp2.morale=cl((hp2.morale||70)-15,20,99);
        addN("ðŸ˜¤ "+hp2.name+" holdout continues. Morale: "+hp2.morale,"red");
        logTx("HOLDOUT",{name:hp2.name,choice:"refuse"});
      }
    }
    else if(item.actionType==="schemePresser"){
      if(action==="open")openSchemePresser87(item);
      return;
    }
    setInbox(function(prev){return prev.filter(function(x){return x.id!==item.id;});});
    setTeams(nt);doSave(nt);
  }
  function handleAiTradeCounter(item){
    var aiTeam=teams.find(function(t){return t.id===item.aiId;});
    setPendingCounter971({
      aiId:item.aiId,
      aiAbbr:aiTeam?aiTeam.abbr:"AI",
      aiIcon:aiTeam?aiTeam.icon:"ðŸ¤–",
      giveId:item.giveId,
      giveName:item.giveName,
      givePos:item.givePos,
      giveOvr:item.giveOvr,
      getId:item.getId,
      getName:item.getName,
      getType:item.getType,
      pickRound:item.pickRound||null,
      offerPackage972:item.offerPackage972&&item.offerPackage972.length?item.offerPackage972.slice():null
    });
    setTTI(item.aiId||null);
    setTMP([]);setTAP([]);setTMPk([]);setTAPk([]);setTMyPkCond972({});setTAiPkCond972({});setTMsg("");
    setTab("trade");
    addN("ðŸ”„ Counter offer loaded â€” their proposal is shown on the Trade tab. Adjust and send!","cyan");
    setInbox(function(prev){return prev.filter(function(x){return x.id!==item.id;});});
  }
  function buildTradePickCondition972(pk,type){
    var r=Math.max(1,Math.min(7,(pk&&pk.round)||3));
    return {type:type||"playoff",upgradeRound:Math.max(1,r-1),downgradeRound:Math.min(7,r+1)};
  }
  function setTradePickCondition972(side,idx,nextCond){
    var setter=side==="my"?setTMyPkCond972:setTAiPkCond972;
    setter(function(prev){
      var out=assign({},prev||{});
      var k=String(idx);
      if(nextCond)out[k]=nextCond;else delete out[k];
      return out;
    });
  }
  function toggleTradePickConditional972(side,idx,pk){
    var k=String(idx);
    var cur=(side==="my"?(tMyPkCond972||{}):(tAiPkCond972||{}))[k];
    if(cur){setTradePickCondition972(side,idx,null);return;}
    setTradePickCondition972(side,idx,buildTradePickCondition972(pk,"playoff"));
  }
  function setTradePickConditionType972(side,idx,pk,type){
    var k=String(idx);
    var cur=(side==="my"?(tMyPkCond972||{}):(tAiPkCond972||{}))[k]||buildTradePickCondition972(pk,type);
    setTradePickCondition972(side,idx,assign({},cur,{type:type||"playoff"}));
  }
  function previewTradePickWithCondition972(pk,cond){
    if(!pk)return null;
    if(!cond)return pk;
    return assign({},pk,{condition:assign({},cond)});
  }
  function handleAiTrade(item,action){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var ai=nt.find(function(t){return t.id===item.aiId;});
    if(!ai){setInbox(function(prev){return prev.filter(function(x){return x.id!==item.id;});});return;}
    if(action==="accept"){
      var userP=u2.roster.find(function(x){return x.id===item.giveId;});
      if(userP){
        u2.roster=u2.roster.filter(function(x){return x.id!==item.giveId;});
        u2.capUsed-=userP.contract.salary;ai.roster.push(userP);ai.capUsed+=userP.contract.salary;
      }
      var pkg=item.offerPackage972&&item.offerPackage972.length?item.offerPackage972.slice():null;
      if(!pkg){
        pkg=[];
        var rawId=(item.getId!=null?String(item.getId):"");
        if(rawId.indexOf("|")>=0){
          rawId.split("|").forEach(function(tok,ti){
            if(!tok)return;
            if(ti===0&&item.getType==="player")pkg.push({type:"player",id:tok});
            else if(tok.indexOf("pk:")===0)pkg.push({type:"pick",id:tok.replace(/^pk:/,"")});
            else if(ti===0)pkg.push({type:item.getType||"pick",id:tok,pickRound:item.pickRound||null});
          });
        }else{
          pkg=[{type:item.getType,id:item.getId,pickRound:item.pickRound||null}];
        }
      }
      pkg.forEach(function(offer){
        if(!offer)return;
        if(offer.type==="player"){
          var aiP=ai.roster.find(function(x){return x.id===offer.id;});
          if(aiP){
            ai.roster=ai.roster.filter(function(x){return x.id!==offer.id;});
            ai.capUsed-=aiP.contract.salary;
            u2.roster.push(aiP);
            u2.capUsed+=aiP.contract.salary;
          }
        }else if(offer.type==="pick"){
          var pk=ai.draftPicks.find(function(x){return x.pid===offer.id;});
          if(pk){
            ai.draftPicks=ai.draftPicks.filter(function(x){return x.pid!==offer.id;});
            if(offer.condition)pk.condition=assign({},offer.condition);
            pk.currentOwner=u2.id;pk.owner=u2.id;
            u2.draftPicks=(u2.draftPicks||[]).concat([pk]);
          }
        }
      });
      u2.capUsed=capCalc(u2.roster);ai.capUsed=capCalc(ai.roster);
      addN("ðŸ¤ Trade completed with "+ai.abbr+"!","green");
      logTx("TRADE",{with:ai.abbr,sent:item.giveName,got:item.getName});
      ledgerLog("TRADE",myId,"Traded "+item.giveName+" to "+ai.abbr+" for "+item.getName,{sent:item.giveName,got:item.getName,partner:ai.abbr});
    }else{addN("âŒ Declined trade from "+ai.abbr+".","dim");}
    setPendingCounter971(null);
    setInbox(function(prev){return prev.filter(function(x){return x.id!==item.id;});});
    setTeams(nt);doSave(nt);
  }
  function genPresser(myTeam,opp,result,isHome){
    var won=isHome?(result.home>result.away):(result.away>result.home);
    var uS=isHome?result.home:result.away;var oS3=isHome?result.away:result.home;
    var margin=Math.abs(uS-oS3);var isBlowout=margin>=14;var isClose=margin<=3;
    var streak=myTeam.streak||0;var losingStreak=streak<=-3;var winStreak=streak>=3;
    var injured=myTeam.roster.filter(function(p){return p.injury&&p.injury.games>0;});
    var starDown=injured.find(function(p){return p.ovr>=80;});
    var record=myTeam.wins+"-"+myTeam.losses;
    var aboveFive=myTeam.wins>myTeam.losses+2;var belowFive=myTeam.losses>myTeam.wins+2;
    var shutout=oS3===0;var gotShutout=uS===0;
    var highScoring=uS+oS3>=50;var lowScoring=uS+oS3<=13;
    var comeback=won&&result.log&&result.log.filter(function(e){return e.indexOf("INT")>=0||e.indexOf("FUM")>=0;}).length>=2;
    var rookies=myTeam.roster.filter(function(p){return p.age<=23&&p.isStarter;});
    var vets=myTeam.roster.filter(function(p){return p.age>=30&&p.ovr>=78;});
    var qb=myTeam.roster.find(function(p){return p.pos==="QB"&&p.isStarter;});
    var topPlayer=myTeam.roster.slice().sort(function(a,b){return b.ovr-a.ovr;})[0];
    var isOppGood=opp&&(opp.wins||0)>=8;var isOppBad=opp&&(opp.losses||0)>=8;
    var divLeader=teams&&teams.slice().sort(function(a,b){return b.wins-a.wins;})[0];
    var isLeader=divLeader&&divLeader.id===myTeam.id;
    var oppAbbr=opp?(opp.icon||"")+opp.abbr:"next opponent";
    var rr=function(){return RNG.ai();};
    var pickR=function(arr){return arr[Math.floor(rr()*arr.length)];};
    var qs=[];
    var q1Pool=[];
    if(!won&&isBlowout){q1Pool.push(
      {q:"Coach, "+oS3+" points allowed. Is the defense broken?",opts:[
        {text:"We got exposed. Back to the drawing board.",fx:{morale:-1,owner:3,prep:0},label:"Accountable"},
        {text:"Scoreboard doesn't tell the full story.",fx:{morale:2,owner:-1,prep:0},label:"Deflect"},
        {text:"That's on me. I'll fix it.",fx:{morale:3,owner:0,prep:0},label:"Own it"}]},
      {q:"Fans are leaving at halftime. What do you say to the fanbase?",opts:[
        {text:"I don't blame them. We have to be better.",fx:{morale:0,owner:4,prep:0},label:"Humble"},
        {text:"The fans who stayed saw us fight in the 4th.",fx:{morale:3,owner:0,prep:0},label:"Rally"},
        {text:"We need them. This is a tough stretch.",fx:{morale:2,owner:2,prep:0},label:"Unite"}]},
      {q:"That was ugly from start to finish. What went wrong?",opts:[
        {text:"Everything. We didn't come to play.",fx:{morale:-2,owner:3,prep:0},label:"Brutally honest"},
        {text:"Give them credit. They executed their plan perfectly.",fx:{morale:1,owner:0,prep:0},label:"Tip cap"},
        {text:"I'm meeting with coordinators tonight. Expect changes.",fx:{morale:-1,owner:5,prep:0},label:"Action"}]},
      {q:"National media is clowning this performance. Thoughts?",opts:[
        {text:"They should. We earned every bit of that criticism.",fx:{morale:-1,owner:4,prep:0},label:"Own it"},
        {text:"I don't care what outsiders think. We know who we are.",fx:{morale:2,owner:-1,prep:0},label:"Dismiss"},
        {text:"We'll answer with play, not words.",fx:{morale:3,owner:1,prep:0},label:"Motivate"}]});}
    if(!won&&isClose){q1Pool.push(
      {q:"Lost by "+margin+". One play away. How do you process that?",opts:[
        {text:"Close doesn't count. We need to finish.",fx:{morale:1,owner:2,prep:0},label:"No moral victories"},
        {text:"I'm proud of how we competed.",fx:{morale:4,owner:-1,prep:0},label:"Positive"},
        {text:"The details cost us. We fix those, we win.",fx:{morale:2,owner:3,prep:0},label:"Detail-oriented"}]},
      {q:"You had opportunities to win that game. What happened late?",opts:[
        {text:"We didn't execute when it mattered most.",fx:{morale:0,owner:2,prep:0},label:"Honest"},
        {text:"Their guy made a play. Respect.",fx:{morale:2,owner:0,prep:0},label:"Tip cap"},
        {text:"I'll take the blame. My play-calling down the stretch.",fx:{morale:3,owner:1,prep:0},label:"Take heat"}]},
      {q:"Another heartbreaker. Are these close losses building toward something?",opts:[
        {text:"Moral victories don't show up in the standings.",fx:{morale:-1,owner:3,prep:0},label:"Realistic"},
        {text:"These guys believe. The wins are coming.",fx:{morale:4,owner:0,prep:0},label:"Faith"},
        {text:"We're one play away every week. That's a good sign.",fx:{morale:2,owner:1,prep:0},label:"Silver lining"}]});}
    if(won&&isBlowout){q1Pool.push(
      {q:"Dominant "+uS+"-"+oS3+" win. Is this the best this team has looked?",opts:[
        {text:"We're clicking. But the standard is the standard.",fx:{morale:3,owner:3,prep:0},label:"Stay hungry"},
        {text:"When we play like that, nobody beats us.",fx:{morale:5,owner:2,prep:8},label:"Bold"},
        {text:"Credit the entire staff. Prep was elite.",fx:{morale:2,owner:4,prep:0},label:"Team effort"}]},
      {q:"Your team looked unstoppable today. What's the ceiling?",opts:[
        {text:"We haven't peaked yet. Scary, right?",fx:{morale:4,owner:3,prep:5},label:"Confident"},
        {text:"One game at a time.",fx:{morale:1,owner:1,prep:0},label:"ClichÃ©"},
        {text:"Ask me in January.",fx:{morale:2,owner:2,prep:0},label:"Focused"}]},
      {q:uS+" points! Is this offense elite?",opts:[
        {text:"On our day, nobody can stop us.",fx:{morale:5,owner:2,prep:6},label:"Bold"},
        {text:"We put the work in all week. It showed.",fx:{morale:3,owner:3,prep:0},label:"Preparation"},
        {text:"One good game doesn't make a season.",fx:{morale:0,owner:0,prep:0},label:"Grounded"}]});}
    if(won&&isClose){q1Pool.push(
      {q:"Win by "+margin+". Relieved or satisfied?",opts:[
        {text:"A win's a win. Champions find ways.",fx:{morale:2,owner:2,prep:0},label:"Winner's mentality"},
        {text:"Honestly? We got lucky. Need to clean it up.",fx:{morale:0,owner:3,prep:0},label:"Self-critical"},
        {text:"The guys showed grit. That's what matters.",fx:{morale:4,owner:1,prep:0},label:"Praise grit"}]},
      {q:"You survived today. Is that sustainable?",opts:[
        {text:"We found a way. That's a playoff team trait.",fx:{morale:3,owner:2,prep:0},label:"Spin positive"},
        {text:"No. We need to be more consistent.",fx:{morale:0,owner:2,prep:0},label:"Honest"},
        {text:"Every week in this league is a dogfight.",fx:{morale:2,owner:1,prep:0},label:"Respectful"}]});}
    if(shutout&&won){q1Pool.push(
      {q:"A shutout! "+uS+"-0. That's rare in today's game.",opts:[
        {text:"Defense was suffocating. Buy those guys dinner.",fx:{morale:5,owner:3,prep:0},label:"Celebrate D"},
        {text:"That's our standard. Zero. Every week.",fx:{morale:3,owner:4,prep:3},label:"Set the bar"}]});}
    if(gotShutout){q1Pool.push(
      {q:"Zero points. A shutout. What do you say?",opts:[
        {text:"Embarrassing. No excuses.",fx:{morale:-2,owner:2,prep:0},label:"Brutal honesty"},
        {text:"Their defense was the best we've faced.",fx:{morale:1,owner:0,prep:0},label:"Credit them"},
        {text:"Offensive changes are coming. I promise.",fx:{morale:-1,owner:5,prep:0},label:"Shake-up"}]});}
    if(won){q1Pool.push(
      {q:"Good win today, "+uS+"-"+oS3+". What was the difference?",opts:[
        {text:"Execution across the board.",fx:{morale:2,owner:2,prep:0},label:"Credit team"},
        {text:"We won the turnover battle.",fx:{morale:1,owner:2,prep:0},label:"Analytics"},
        {text:"Defense set the tone early.",fx:{morale:3,owner:1,prep:0},label:"Praise D"}]},
      {q:"What are you most pleased about today?",opts:[
        {text:"The effort. I saw guys flying around.",fx:{morale:3,owner:1,prep:0},label:"Effort"},
        {text:"We stuck to the game plan. That's discipline.",fx:{morale:2,owner:3,prep:0},label:"Execution"},
        {text:"Honestly, the composure under pressure.",fx:{morale:2,owner:2,prep:0},label:"Poise"}]},
      {q:"This win feels different. Does the locker room feel it too?",opts:[
        {text:"The energy is incredible right now.",fx:{morale:4,owner:2,prep:0},label:"Ride the wave"},
        {text:"We're not getting caught up in one win.",fx:{morale:1,owner:1,prep:0},label:"Even keel"},
        {text:"I'll let the players speak to that. Ask them.",fx:{morale:0,owner:0,prep:0},label:"Redirect"}]});}
    if(!won){q1Pool.push(
      {q:"Tough loss. What's your message to the locker room?",opts:[
        {text:"Flush it and prepare for next week.",fx:{morale:2,owner:0,prep:0},label:"Move on"},
        {text:"I told them I believe in this team.",fx:{morale:4,owner:-1,prep:0},label:"Support"},
        {text:"I told them effort was unacceptable.",fx:{morale:-3,owner:5,prep:0},label:"Call out"}]},
      {q:"What needs to change starting tomorrow?",opts:[
        {text:"Practice intensity. It starts there.",fx:{morale:1,owner:3,prep:0},label:"Demand more"},
        {text:"Mindset. We have to believe we can close.",fx:{morale:3,owner:0,prep:0},label:"Mental"},
        {text:"Personnel. I'm looking at everything.",fx:{morale:-2,owner:4,prep:0},label:"Warning"}]},
      {q:"Are you losing the locker room?",opts:[
        {text:"Absolutely not. These guys fight for each other.",fx:{morale:4,owner:0,prep:0},label:"Defend team"},
        {text:"We'll see who shows up Monday.",fx:{morale:-1,owner:3,prep:0},label:"Test them"},
        {text:"That's a ridiculous question.",fx:{morale:2,owner:-2,prep:0},label:"Shut it down"}]});}
    var q2Pool=[];
    if(losingStreak){q2Pool.push(
      {q:Math.abs(streak)+" straight losses. Is this team in crisis?",opts:[
        {text:"No. We're close. Film shows it.",fx:{morale:2,owner:-1,prep:0},label:"Optimist"},
        {text:"I hear the noise. We have to earn our way out.",fx:{morale:1,owner:3,prep:0},label:"Accountable"},
        {text:"Changes are coming. That's all I'll say.",fx:{morale:-2,owner:6,prep:0},label:"Ominous"}]},
      {q:"The fanbase is calling for your job. How do you handle that?",opts:[
        {text:"That's part of the gig. I control what I can.",fx:{morale:3,owner:0,prep:0},label:"Steady"},
        {text:"I understand the frustration. I share it.",fx:{morale:1,owner:4,prep:0},label:"Empathize"},
        {text:"The people on Twitter don't know football.",fx:{morale:2,owner:-3,prep:0},label:"Dismiss"}]},
      {q:"Has the coaching staff discussed a quarterback change?",opts:[
        {text:"We're evaluating everything. Nothing is off the table.",fx:{morale:-3,owner:5,prep:0},label:"Open door"},
        {text:"Our QB gives us the best chance to win.",fx:{morale:3,owner:-1,prep:0},label:"Loyal"},
        {text:"I'm not going to discuss internal decisions.",fx:{morale:0,owner:1,prep:0},label:"No comment"}]});}
    if(winStreak){q2Pool.push(
      {q:streak+" wins in a row! Are you the team to beat?",opts:[
        {text:"We don't look at records. Just the next game.",fx:{morale:1,owner:1,prep:0},label:"Humble"},
        {text:"We're playing our best football. Let 'em come.",fx:{morale:5,owner:3,prep:6},label:"Bring it on"},
        {text:"The guys have earned every bit of this.",fx:{morale:4,owner:2,prep:0},label:"Credit players"}]},
      {q:"This streak is getting national attention. How do you keep the team focused?",opts:[
        {text:"We don't read the press. Next game mentality.",fx:{morale:2,owner:2,prep:0},label:"Disciplined"},
        {text:"Honestly? The guys are feeding off the energy.",fx:{morale:4,owner:1,prep:3},label:"Embrace it"},
        {text:"Champions handle success. That's what we're learning.",fx:{morale:3,owner:3,prep:0},label:"Growth"}]});}
    if(starDown){q2Pool.push(
      {q:starDown.name+" ("+starDown.pos+", "+starDown.ovr+" OVR) is out "+starDown.injury.games+" weeks. How do you adjust?",opts:[
        {text:"Next man up. That's the culture.",fx:{morale:3,owner:1,prep:0},label:"Rally"},
        {text:"You can't replace "+starDown.name+". But we'll try.",fx:{morale:0,owner:0,prep:0},label:"Realistic"},
        {text:"Adversity reveals character.",fx:{morale:2,owner:2,prep:0},label:"Philosophical"}]});}
    if(aboveFive){q2Pool.push(
      {q:"At "+record+", you're in the playoff picture. Feeling confident?",opts:[
        {text:"January is earned in November.",fx:{morale:2,owner:2,prep:0},label:"Process"},
        {text:"We expect to be there. That's the standard.",fx:{morale:3,owner:3,prep:4},label:"Confident"},
        {text:"Long way to go. A lot of football left.",fx:{morale:1,owner:0,prep:0},label:"Measured"}]});}
    if(belowFive){q2Pool.push(
      {q:"At "+record+", the season's slipping. Time for a rebuild?",opts:[
        {text:"We're evaluating everything.",fx:{morale:-1,owner:4,prep:0},label:"Non-committal"},
        {text:"The young guys need reps. Development time.",fx:{morale:1,owner:-2,prep:0},label:"Build future"},
        {text:"Every game matters. We're not giving up.",fx:{morale:3,owner:1,prep:0},label:"Fighter"}]});}
    if(rookies.length>=3){q2Pool.push(
      {q:"Starting "+rookies.length+" rookies. Growing pains or promising?",opts:[
        {text:"Both. They'll be great, but tuition is expensive.",fx:{morale:2,owner:1,prep:0},label:"Patient"},
        {text:"These kids are fearless. The future is NOW.",fx:{morale:4,owner:2,prep:0},label:"Hype"},
        {text:"We'd rather have vets, but these guys compete.",fx:{morale:0,owner:0,prep:0},label:"Honest"}]});}
    if(vets.length>=2){q2Pool.push(
      {q:"Your veteran core â€” still championship-caliber?",opts:[
        {text:"Absolutely. Experience wins in the playoffs.",fx:{morale:3,owner:2,prep:0},label:"Back them"},
        {text:"Father Time is undefeated. We need to transition.",fx:{morale:-3,owner:3,prep:0},label:"Cold truth"},
        {text:"These guys set the standard every day.",fx:{morale:4,owner:1,prep:0},label:"Respect"}]});}
    if(qb&&qb.ovr>=80){q2Pool.push(
      {q:qb.name+" has been elite this season. MVP conversation?",opts:[
        {text:"He's the best in the league right now.",fx:{morale:5,owner:2,prep:4},label:"Hype QB"},
        {text:"He'd be the first to tell you it's a team game.",fx:{morale:3,owner:1,prep:0},label:"Humble QB"},
        {text:"Awards are for the offseason. Wins matter now.",fx:{morale:1,owner:2,prep:0},label:"Focused"}]});}
    if(qb&&qb.ovr<70){q2Pool.push(
      {q:"The quarterback play has been inconsistent. What's the plan?",opts:[
        {text:"We're going to keep building around him.",fx:{morale:2,owner:-1,prep:0},label:"Loyal"},
        {text:"He needs to play better. Simple as that.",fx:{morale:-2,owner:3,prep:0},label:"Direct"},
        {text:"We're developing the whole offense together.",fx:{morale:1,owner:1,prep:0},label:"Diplomatic"}]});}
    if(topPlayer&&topPlayer.ovr>=85){q2Pool.push(
      {q:topPlayer.name+" ("+topPlayer.ovr+" OVR) is playing at an All-Pro level. Contract extension coming?",opts:[
        {text:"He's earned everything coming to him.",fx:{morale:4,owner:0,prep:0},label:"Validate"},
        {text:"That's between him and the front office.",fx:{morale:0,owner:2,prep:0},label:"Corporate"},
        {text:"We take care of our own. Always.",fx:{morale:3,owner:1,prep:0},label:"Loyal"}]});}
    if(highScoring){q2Pool.push(
      {q:"Fireworks today â€” "+uS+"-"+oS3+". Defense a concern?",opts:[
        {text:"We'd rather not be in shootouts. But we can.",fx:{morale:2,owner:1,prep:0},label:"Balanced"},
        {text:"Score that much, defense is secondary.",fx:{morale:1,owner:-1,prep:3},label:"Controversial"},
        {text:"Defense needs work. No sugarcoating.",fx:{morale:-1,owner:3,prep:0},label:"Direct"}]});}
    if(lowScoring){q2Pool.push(
      {q:"Only "+uS+" points. Is the offense a problem?",opts:[
        {text:"We need to find an identity on offense.",fx:{morale:0,owner:2,prep:0},label:"Searching"},
        {text:"Both defenses were elite today.",fx:{morale:2,owner:0,prep:0},label:"Contextualize"},
        {text:"We left points on the field. Fixable.",fx:{morale:1,owner:1,prep:0},label:"Optimistic"}]});}
    if(isLeader){q2Pool.push(
      {q:"First place! Does this team have what it takes to finish?",opts:[
        {text:"This isn't where we want to peak. We're climbing.",fx:{morale:3,owner:3,prep:0},label:"Building"},
        {text:"We have a target on our back now. We embrace that.",fx:{morale:4,owner:2,prep:3},label:"Embrace"},
        {text:"Regular season doesn't mean anything without a ring.",fx:{morale:1,owner:1,prep:0},label:"Big picture"}]});}
    if(myTeam.roster.filter(function(p){return p.age<=24;}).length>=15){q2Pool.push(
      {q:"This is one of the youngest rosters in the league. Advantage or liability?",opts:[
        {text:"Youth means speed, hunger, and cheap contracts.",fx:{morale:3,owner:3,prep:0},label:"Positive spin"},
        {text:"We're paying the rookie tax right now. It'll pay off.",fx:{morale:1,owner:1,prep:0},label:"Patient"},
        {text:"I wish we had more veterans to lead these guys.",fx:{morale:-1,owner:0,prep:0},label:"Honest"}]});}
    if(comeback){q2Pool.push(
      {q:"You forced multiple turnovers today. Is this defense elite?",opts:[
        {text:"When we take the ball away, different team.",fx:{morale:3,owner:3,prep:0},label:"Ball hawks"},
        {text:"Those guys study film like maniacs.",fx:{morale:4,owner:2,prep:0},label:"Preparation"}]});}
    q2Pool.push(
      {q:"How do you assess this roster right now?",opts:[
        {text:"I like our guys. We're building something.",fx:{morale:2,owner:1,prep:0},label:"Positive"},
        {text:"We have holes. I won't lie.",fx:{morale:-1,owner:3,prep:0},label:"Honest"},
        {text:"Young guys developing faster than expected.",fx:{morale:2,owner:2,prep:0},label:"Hopeful"}]},
      {q:"Walk us through the preparation for today's game.",opts:[
        {text:"Film study was exceptional this week.",fx:{morale:2,owner:2,prep:0},label:"Detail"},
        {text:"The players prepared themselves. I just stayed out of the way.",fx:{morale:3,owner:0,prep:0},label:"Humble"},
        {text:"We simplified things. Less is more.",fx:{morale:1,owner:1,prep:0},label:"Simplify"}]},
      {q:"How's the team chemistry in the locker room?",opts:[
        {text:"Best locker room I've ever been around.",fx:{morale:4,owner:2,prep:0},label:"Love fest"},
        {text:"We've got work to do. Not everyone's on the same page.",fx:{morale:-1,owner:2,prep:0},label:"Real talk"},
        {text:"The guys genuinely like each other. That matters.",fx:{morale:3,owner:1,prep:0},label:"Bond"}]},
      {q:"Any practice squad guys pushing for a roster spot?",opts:[
        {text:"Several. Competition breeds excellence.",fx:{morale:2,owner:2,prep:0},label:"Culture"},
        {text:"I'm always looking. Gotta earn your spot.",fx:{morale:1,owner:1,prep:0},label:"Meritocracy"},
        {text:"We've got some hungry guys down there.",fx:{morale:2,owner:1,prep:0},label:"Depth"}]});
    var q3Pool=[];
    if(opp){
      q3Pool.push(
        {q:"Up next: "+oppAbbr+". How do you approach that matchup?",opts:[
          {text:"They're a great team. We'll be ready.",fx:{morale:1,owner:1,prep:0},label:"Respectful"},
          {text:"We match up well. I like our chances.",fx:{morale:3,owner:2,prep:5},label:"Confident"},
          {text:"Us first, then we'll scheme them.",fx:{morale:2,owner:1,prep:0},label:"Process"}]},
        {q:oppAbbr+"'s coach had some words about your team. Response?",opts:[
          {text:"Let our play do the talking.",fx:{morale:3,owner:2,prep:0},label:"Above it"},
          {text:"Tell them to bring their A-game.",fx:{morale:5,owner:2,prep:8},label:"Fire back"},
          {text:"I respect them. We fear nobody.",fx:{morale:4,owner:3,prep:3},label:"Measured fire"}]});
      if(isOppGood){q3Pool.push(
        {q:oppAbbr+" is "+opp.wins+"-"+opp.losses+". That's a statement game. Ready?",opts:[
          {text:"We circle games like this. Big stage, big players show up.",fx:{morale:5,owner:3,prep:5},label:"Hyped"},
          {text:"Every game is a statement game when you're trying to build something.",fx:{morale:2,owner:1,prep:0},label:"Level-headed"},
          {text:"They're the measuring stick. Time to see where we are.",fx:{morale:3,owner:2,prep:0},label:"Test"}]});}
      if(isOppBad){q3Pool.push(
        {q:oppAbbr+" has struggled. Trap game mentality?",opts:[
          {text:"There are no easy games in this league.",fx:{morale:1,owner:1,prep:0},label:"Careful"},
          {text:"Trap games happen when you're not prepared. We'll be prepared.",fx:{morale:2,owner:3,prep:0},label:"Focused"},
          {text:"I expect us to handle business.",fx:{morale:2,owner:2,prep:2},label:"Business"}]});}
    }
    q3Pool.push(
      {q:"Playoff picture is getting tight. How do you manage the pressure?",opts:[
        {text:"Pressure is a privilege.",fx:{morale:3,owner:3,prep:0},label:"Embrace"},
        {text:"We treat every game the same.",fx:{morale:1,owner:1,prep:0},label:"Steady"},
        {text:"Championship or bust.",fx:{morale:4,owner:4,prep:5},label:"All in"}]},
      {q:"What's the identity of this football team?",opts:[
        {text:"Physical, disciplined, relentless.",fx:{morale:3,owner:3,prep:0},label:"Old school"},
        {text:"Explosive. We can score from anywhere.",fx:{morale:2,owner:1,prep:2},label:"Offensive"},
        {text:"Defense and toughness. That travels in January.",fx:{morale:3,owner:2,prep:0},label:"Defensive"},
        {text:"Still finding it. But we'll know when we do.",fx:{morale:0,owner:-1,prep:0},label:"Searching"}]},
      {q:"If you could tell the fans one thing right now, what is it?",opts:[
        {text:"Keep showing up. We're gonna make you proud.",fx:{morale:3,owner:3,prep:0},label:"Promise"},
        {text:"Trust the process. We're building the right way.",fx:{morale:1,owner:2,prep:0},label:"Patience"},
        {text:"Turn it up louder. We feed off your energy.",fx:{morale:4,owner:1,prep:0},label:"Rally"}]},
      {q:"Last question: what does this team need most right now?",opts:[
        {text:"Consistency. We're too hot and cold.",fx:{morale:1,owner:3,prep:0},label:"Self-aware"},
        {text:"Nothing. We have everything we need in that locker room.",fx:{morale:4,owner:1,prep:0},label:"Confident"},
        {text:"Health. Get our guys back and watch out.",fx:{morale:2,owner:2,prep:0},label:"Hopeful"},
        {text:"A short memory. Forget this and move forward.",fx:{morale:2,owner:1,prep:0},label:"Focused"}]},
      {q:"Any message for the next opponent?",opts:[
        {text:"We're coming. Simple as that.",fx:{morale:4,owner:2,prep:6},label:"Intimidate"},
        {text:"No message. We don't talk, we play.",fx:{morale:2,owner:2,prep:0},label:"Action"},
        {text:"We respect everybody and fear nobody.",fx:{morale:3,owner:3,prep:2},label:"Balanced"}]});
    var allPools=[];
    if(q1Pool.length>0)allPools.push(pickR(q1Pool));
    if(q2Pool.length>0)allPools.push(pickR(q2Pool));
    if(q3Pool.length>0)allPools.push(pickR(q3Pool));
    var numQ=RNG.ai()<0.5?1:2;
    for(var qi=allPools.length-1;qi>0;qi--){var rj=Math.floor(RNG.ai()*(qi+1));var tmp=allPools[qi];allPools[qi]=allPools[rj];allPools[rj]=tmp;}
    qs=allPools.slice(0,Math.min(numQ,allPools.length));
    return qs;
  }
  function handlePresserAnswer(optIdx){
    if(!presser||presser.current>=presser.questions.length) return;
    var q=presser.questions[presser.current];var opt=q.opts[optIdx];if(!opt) return;
    var na=presser.answers.concat([{q:q.q,a:opt.text,fx:opt.fx}]);
    if(presser.current+1>=presser.questions.length){
      var totalMorale=0,totalOwner=0,totalPrep=0;
      na.forEach(function(ans){totalMorale+=ans.fx.morale||0;totalOwner+=ans.fx.owner||0;totalPrep+=ans.fx.prep||0;});
      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
      if(u2){
        u2.roster.forEach(function(p){p.morale=cl((p.morale||70)+totalMorale,20,99);});
        u2.ownerMood=cl((u2.ownerMood||70)+totalOwner,5,99);
        if(totalPrep>0)u2.presserPrep=(u2.presserPrep||0)+totalPrep;
        // v95.5: media_darling trait â€” +1 prestige from press conference (max once per season)
        var hasMediaDarling95=u2.roster.some(function(rp){return hasTrait95(rp,"media_darling")&&rp.isStarter&&!(rp.injury&&rp.injury.games>0);});
        var mdBonus95=0;
        if(hasMediaDarling95&&totalOwner>=0){mdBonus95=1;u2.prestige=cl((u2.prestige||50)+1,0,100);}
      }
      setTeams(nt);doSave(nt);
      var mdStr95=(typeof mdBonus95!=="undefined"&&mdBonus95>0)?" ðŸŽ­ MEDIA_DARLING +1 prestige!":"";
      addN("ðŸŽ™ï¸ Press Conference: Morale "+(totalMorale>=0?"+":"")+totalMorale+", Owner "+(totalOwner>=0?"+":"")+totalOwner+(totalPrep>0?", Opponent prep +"+totalPrep+"% ðŸ”¥":"")+mdStr95,totalMorale>=0?"green":"orange");
      logTx("PRESSER",{morale:totalMorale,owner:totalOwner,prep:totalPrep});
      var presserTags=[];
      na.forEach(function(ans){
        var lbl=(ans.fx.label||"").toLowerCase();
        if(lbl.indexOf("action")>=0||lbl.indexOf("shake")>=0||lbl.indexOf("change")>=0)presserTags.push("promise_changes");
        if(lbl.indexOf("bold")>=0||lbl.indexOf("confident")>=0)presserTags.push("bold");
        if(lbl.indexOf("humble")>=0||lbl.indexOf("calm")>=0||lbl.indexOf("positive")>=0)presserTags.push("calm");
        if(lbl.indexOf("honest")>=0||lbl.indexOf("critical")>=0||lbl.indexOf("tough")>=0)presserTags.push("tough");
        if(lbl.indexOf("rookie")>=0||lbl.indexOf("kid")>=0)presserTags.push("praise_rookie");
      });
      if(u2&&(u2.streak||0)<=-3)presserTags.push("losing_streak");
      if(u2&&(u2.streak||0)>=3)presserTags.push("winning_streak");
      if(u2&&(u2.ownerMood||70)<45)presserTags.push("owner_low");
      var qb3=u2?u2.roster.find(function(x){return x.pos==="QB"&&x.isStarter;}):null;
      if(qb3&&(qb3.morale||70)<50)presserTags.push("qb_low_morale");
      if(presserTags.length>0)checkPresserTags(presserTags);
      setPresser(assign({},presser,{current:presser.questions.length,answers:na,done:true,summary:{morale:totalMorale,owner:totalOwner,prep:totalPrep}}));
    }else{
      setPresser(assign({},presser,{current:presser.current+1,answers:na}));
    }
  }
  function handleWeeklyPressAnswer975(optIndex){
    if(!mfsnWeekly975||mfsnWeekly975.pressAnswered975)return;
    var pressSeg=(mfsnWeekly975.segments||[]).find(function(s){return s&&s.type==="PRESS_CONFERENCE";});
    if(!pressSeg||!pressSeg.data||!pressSeg.data.opts)return;
    var opt=pressSeg.data.opts[optIndex];
    if(!opt)return;
    var nt=teams.slice();
    var u=nt.find(function(t){return t.id===myId;});
    if(!u)return;
    var fx=opt.effect||{};
    if(fx.morale)u.roster.forEach(function(p){p.morale=cl((p.morale||70)+fx.morale,15,100);});
    if(fx.chemistry)u.roster.forEach(function(p){p.chemistry=cl((p.chemistry||60)+fx.chemistry,15,100);});
    if(fx.ownerMood)u.ownerMood=cl((u.ownerMood||70)+fx.ownerMood,5,99);
    setTeams(nt);doSave(nt);
    addN("ðŸŽ¤ Weekly presser: \""+opt.text+"\"",fx.morale>0?"green":fx.morale<0?"red":"cyan");
    logTx("PRESS_CONF_975",{week:mfsnWeekly975.week,answer:opt.text,effects:fx});
    setMfsnWeekly975(function(prev){
      if(!prev)return prev;
      var updated=assign({},prev);
      updated.pressAnswered975=true;
      updated.pressChoice975=optIndex;
      updated.pressAnswerText975=opt.text;
      return updated;
    });
  }
  function handleDraftPressAnswer975(qIndex,optIndex){
    if(!draftPresser975)return;
    if(qIndex!==(draftPresser975.currentQ||0))return;
    var q=draftPresser975.questions&&draftPresser975.questions[qIndex];
    if(!q)return;
    var opt=q.opts&&q.opts[optIndex];
    if(!opt)return;
    var nt=teams.slice();
    var u=nt.find(function(t){return t.id===myId;});
    if(!u)return;
    var fx=opt.effect||{};
    if(fx.morale)u.roster.forEach(function(p){p.morale=cl((p.morale||70)+fx.morale,15,100);});
    if(fx.chemistry)u.roster.forEach(function(p){p.chemistry=cl((p.chemistry||60)+fx.chemistry,15,100);});
    if(fx.ownerMood)u.ownerMood=cl((u.ownerMood||70)+fx.ownerMood,5,99);
    setTeams(nt);doSave(nt);
    addN("ðŸŽ¤ Draft presser: \""+opt.text+"\"","cyan");
    logTx("DRAFT_PRESS_975",{year:draftPresser975.year,q:q.q,answer:opt.text,effects:fx});
    setDraftPresser975(function(prev){
      if(!prev)return prev;
      var updated=assign({},prev);
      updated.answers=(updated.answers||[]).concat([{qIndex:qIndex,optIndex:optIndex,text:opt.text}]);
      updated.currentQ=(updated.currentQ||0)+1;
      return updated;
    });
  }
  function runCombineTest(pid,type){
    if(!my) return;
    var cost=type==="measurables"?SCOUT_COSTS86.measurables:type==="interview"?SCOUT_COSTS86.interview:SCOUT_COSTS86.film;
    var dcc=dc.slice();var p=dcc.find(function(x){return x.id===pid;});
    if(!p) return;
    if(!p.scouted||typeof p.scouted!=="object")p.scouted={measurables:false,interview:false,film:false};
    if(p.scouted[type]) return;
    // v95.5: film_junkie prospect â€” 50% scout cost discount on film review (self-teaches)
    var filmJunkiePL95=(hasTrait95(p,"film_junkie")&&p.traitPowerLevel95)?((p.traitPowerLevel95["film_junkie"]||0)):0;
    var filmJunkieDisc95=(type==="film"&&hasTrait95(p,"film_junkie"))?Math.floor(cost*(filmJunkiePL95>=2?0.70:filmJunkiePL95>=1?0.60:0.50)):0;// v95.9: milestone raises discount
    var scoutCost95=Math.max(0,cost-filmJunkieDisc95);
    if((my.scoutPts||0)<scoutCost95){addN("Not enough scout points! Need "+scoutCost95+", have "+(my.scoutPts||0)+".","red");return;}
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    u2.scoutPts-=scoutCost95;
    p.scouted[type]=true;
    p.scoutLevel=Math.min(3,(p.scoutLevel||0)+1);
    if(p.scouted.measurables&&p.scouted.interview&&p.scouted.film){p.scouted.complete=true;p.scoutLevel=3;}
    if(p.scouting){
      var evtMap={measurables:"combine",interview:"interview",film:"film_study"};
      applyScoutEvent(p.scouting,evtMap[type]||type);
      var scAcc=(my.scouts&&my.scouts[0])?my.scouts[0].accuracy:60;
      p.hypeOvr=getScoutedOvr(p.trueOvr||p.ovr,scAcc,p.scouting.confidence,p.scouting.isRookie);
      var range=getScoutRange(p.trueOvr||p.ovr,scAcc,p.scouting.confidence,p.scouting.isRookie);
      p.scoutRange=range;p.scoutGrade=gradeL(p.hypeOvr);
    }
    setTeams(nt);setDC(dcc);
    var coachR67=(my.coachRatings?my.coachRatings.scouting||50:50);
    setProspectDB(function(prev){var db67=assign({},prev);
      var scType67=type==="measurables"?"combine":type;
      PROSPECT_DOSSIER.scout(db67,pid,season.year,season.week||0,p,scType67,coachR67,CLINIC_MATH.getMods(coachClinic).scoutConfBonus);return db67;});
    setCoachClinic(function(prev){return CLINIC.earnXP(assign({},prev),"prospect_scout",3);});
    var confStr=p.scouting?" ("+confTier(p.scouting.confidence).toUpperCase()+" "+Math.round(p.scouting.confidence*100)+"%)":"";
    var filmDisc95Str=(filmJunkieDisc95>0)?(" ðŸŽ¬ FILM_JUNKIE -"+filmJunkieDisc95+"pts!"):"";
    addN("ðŸ” Scouted "+p.name+" ("+type+"): "+(type==="measurables"?"40yd: "+p.combine.forty+"s":type==="interview"?("Trait: "+(TRAITS[p.trait]?TRAITS[p.trait].name:"Normal")):("Est OVR: "+p.hypeOvr))+confStr+filmDisc95Str,"cyan");
  }
  function batchScout(type){
    if(!my) return;
    var cost=type==="measurables"?SCOUT_COSTS86.measurables:type==="interview"?SCOUT_COSTS86.interview:type==="film"?SCOUT_COSTS86.film:SCOUT_COSTS86.full;
    var dcc=dc.slice();var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var filtered=dcc.filter(function(p){return scoutPosF==="ALL"||p.pos===scoutPosF;});
    var scAcc=(my.scouts&&my.scouts[0])?my.scouts[0].accuracy:60;
    var count=0;
    filtered.forEach(function(p){
      if(!p.scouted||typeof p.scouted!=="object")p.scouted={measurables:false,interview:false,film:false};
      if(type==="all"){
        var c2=0;
        if(!p.scouted.measurables)c2+=SCOUT_COSTS86.measurables;
        if(!p.scouted.interview)c2+=SCOUT_COSTS86.interview;
        if(!p.scouted.film)c2+=SCOUT_COSTS86.film;
        if(c2===0||u2.scoutPts<c2) return;
        u2.scoutPts-=c2;
        p.scouted.measurables=true;p.scouted.interview=true;p.scouted.film=true;p.scouted.complete=true;
        p.scoutLevel=3;
        if(p.scouting){applyScoutEvent(p.scouting,"combine");applyScoutEvent(p.scouting,"interview");applyScoutEvent(p.scouting,"film_study");
          p.hypeOvr=getScoutedOvr(p.trueOvr||p.ovr,scAcc,p.scouting.confidence,p.scouting.isRookie);
          p.scoutRange=getScoutRange(p.trueOvr||p.ovr,scAcc,p.scouting.confidence,p.scouting.isRookie);p.scoutGrade=gradeL(p.hypeOvr);}
        count++;
      }else{
        if(p.scouted[type]) return;
        if(u2.scoutPts<cost) return;
        u2.scoutPts-=cost;
        p.scouted[type]=true;
        p.scoutLevel=Math.min(3,(p.scoutLevel||0)+1);
        if(p.scouted.measurables&&p.scouted.interview&&p.scouted.film){p.scouted.complete=true;p.scoutLevel=3;}
        if(p.scouting){var evtMap={measurables:"combine",interview:"interview",film:"film_study"};
          applyScoutEvent(p.scouting,evtMap[type]||type);
          p.hypeOvr=getScoutedOvr(p.trueOvr||p.ovr,scAcc,p.scouting.confidence,p.scouting.isRookie);
          p.scoutRange=getScoutRange(p.trueOvr||p.ovr,scAcc,p.scouting.confidence,p.scouting.isRookie);p.scoutGrade=gradeL(p.hypeOvr);}
        count++;
      }
    });
    setTeams(nt);setDC(dcc);
    if(count>0){
      var coachR67b=(my.coachRatings?my.coachRatings.scouting||50:50);
      setProspectDB(function(prev){var db67b=assign({},prev);
        filtered.forEach(function(p){
          if(p.scouted&&(p.scouted[type]||type==="all")){
            var scType67b=type==="measurables"?"combine":type==="all"?"film":type;
            PROSPECT_DOSSIER.scout(db67b,p.id,season.year,season.week||0,p,scType67b,coachR67b,CLINIC_MATH.getMods(coachClinic).scoutConfBonus);
          }
        });return db67b;});
      setCoachClinic(function(prev){return CLINIC.earnXP(assign({},prev),"prospect_scout",count*2);});
    }
    if(count>0)addN("ðŸ” Batch scouted "+count+" prospects"+(type==="all"?" (FULL)":"")+" ("+type+")","cyan");
    else addN("No unscouted prospects"+(scoutPosF!=="ALL"?" at "+scoutPosF:"")+" for "+type+".","dim");
  }
  function cutSelected(){
    if(!my||selPlayers.length===0) return;
    if(!canDoAction(season.phase,"canCut")){addN("ðŸš« Cannot cut during "+(PHASE_RULES[season.phase]||{}).label+".","red");return;}
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var count=0;var deadNowTotal=0;var deadNextTotal=0;
    selPlayers.forEach(function(pid){
      var p=u2.roster.find(function(x){return x.id===pid;});if(!p) return;
      var dead=v36_deadIfCut(p.contract);
      var split=splitDeadCapCharge(dead,season.phase,season.week);
      applyDeadCapCharge(u2,season.year,split);
      deadNowTotal+=split.now||0;
      deadNextTotal+=split.next||0;
      u2.roster=u2.roster.filter(function(x){return x.id!==pid;});count++;
      if(dead>0)ledgerLog("DEAD_MONEY_CHARGE",myId,"Dead money: $"+dead+"M from "+p.name+" (bulk cut)",{name:p.name,amount:dead,amountNow:split.now||0,amountNext:split.next||0});
    });
    u2.capUsed=capCalc(u2.roster);
    addN("âœ‚ï¸ Bulk cut "+count+" players."+(deadNowTotal>0?" ðŸ’€ $"+Math.round(deadNowTotal*10)/10+"M dead now":"")+(deadNextTotal>0?" (+$"+Math.round(deadNextTotal*10)/10+"M next year)":""),"red");
    logTx("BULK_CUT",{count:count,deadNow:Math.round(deadNowTotal*10)/10,deadNext:Math.round(deadNextTotal*10)/10});
    setSelPlayers([]);setTeams(nt);doSave(nt);
  }
  function godModeEdit(pid,field,value){
    if(!godMode) return;var nt=teams.slice();
    // v98: Find player on ANY team, not just user's
    var u2=null;var p=null;
    for(var ti=0;ti<nt.length;ti++){var fp=nt[ti].roster.find(function(x){return x.id===pid;});if(fp){u2=nt[ti];p=fp;break;}}
    if(!u2||!p) return;
    if(field==="name"){p.name=value||p.name;}
    else if(field==="ovr"){
      var diff=parseInt(value)-p.ovr;
      var def=POS_DEF[p.pos];if(def){def.r.forEach(function(r){p.ratings[r]=cl((p.ratings[r]||50)+diff,35,99);});}
      p.ovr=calcOvr(p);
    }
    else if(field==="age"){p.age=cl(parseInt(value)||p.age,19,45);}
    else if(field==="morale"){p.morale=cl(parseInt(value)||70,0,99);}
    else if(field==="pot"){p.pot=cl(parseInt(value)||p.pot,1,99);}
    else if(field==="pos"){
      var newPos=value.toUpperCase();if(POS_DEF[newPos]){p.pos=newPos;p.ovr=calcOvr(p);p.archetype=PLAYER_ARCHETYPES.classify(p);}
    }
    else if(field==="salary"){var newSal=Math.max(0.5,parseFloat(value)||(p.contract.baseSalary||p.contract.salary));
      p.contract.baseSalary=newSal;p.contract.salary=calcCapHit(p.contract);}
    else if(field==="years"){p.contract.years=cl(parseInt(value)||1,1,8);}
    else if(field==="signingBonus"){p.contract.signingBonus=Math.max(0,parseFloat(value)||0);p.contract.prorated=Math.round(p.contract.signingBonus/Math.max(p.contract.years,1)*10)/10;p.contract.salary=calcCapHit(p.contract);}
    else if(field==="guaranteed"){p.contract.guaranteed=Math.max(0,parseFloat(value)||0);}
    else if(field==="trait"){if(TRAITS[value]){p.trait=value;if(!p.traits95)p.traits95=[];p.traits95[0]=value;}}
    else if(field==="devTrait"){p.devTrait=value;}
    else if(field==="injury"){
      if(value==="heal"){setPlayerInjury92(p,null,0);}
      else{setPlayerInjury92(p,"God Mode Injury",cl(parseInt(value)||1,1,20));}
    }
    else if(field==="isStarter"){p.isStarter=value==="true"||value===true;}
    else if(field==="rating"){
      var parts=value.split(":");if(parts.length===2){
        p.ratings[parts[0]]=cl(parseInt(parts[1])||50,1,99);
        p.ovr=calcOvr(p);
      }
    }
    // v98: NEW FIELDS â€” college, physical, personality, intangibles
    else if(field==="college"){if(!p.college)p.college={};p.college.school=value||"Unknown";}
    else if(field==="height"){p.height=cl(parseInt(value)||72,60,84);}
    else if(field==="weight"){p.weight=cl(parseInt(value)||220,140,380);}
    else if(field==="chemistry"){p.chemistry=cl(parseInt(value)||60,0,100);}
    else if(field==="systemFit"){p.systemFit=cl(parseInt(value)||50,0,100);}
    else if(field==="workEthic"){if(!p.personality)p.personality=generatePersonality(p.pos,p.age,p.devTrait);p.personality.workEthic=cl(parseInt(value)||5,1,10);}
    else if(field==="loyalty"){if(!p.personality)p.personality=generatePersonality(p.pos,p.age,p.devTrait);p.personality.loyalty=cl(parseInt(value)||5,1,10);}
    else if(field==="greed"){if(!p.personality)p.personality=generatePersonality(p.pos,p.age,p.devTrait);p.personality.greed=cl(parseInt(value)||5,1,10);}
    else if(field==="pressure"){if(!p.personality)p.personality=generatePersonality(p.pos,p.age,p.devTrait);p.personality.pressure=cl(parseInt(value)||5,1,10);}
    else if(field==="ambition"){if(!p.personality)p.personality=generatePersonality(p.pos,p.age,p.devTrait);p.personality.ambition=cl(parseInt(value)||5,1,10);}
    else if(field==="number"){p.number=parseInt(value)||0;}
    else if(field==="draftYear"){if(!p.draftInfo)p.draftInfo={};p.draftInfo.year=parseInt(value)||2026;}
    else if(field==="draftRound"){if(!p.draftInfo)p.draftInfo={};p.draftInfo.round=cl(parseInt(value)||1,1,7);}
    else if(field==="draftPick"){if(!p.draftInfo)p.draftInfo={};p.draftInfo.pick=cl(parseInt(value)||1,1,32);}
    else if(field==="tradeBlock"){p.onTradeBlock=value==="true"||value===true;}
    else if(field==="resetStats"){p.stats={gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0,fumbles:0,punts:0,puntYds:0};}
    else if(field==="resetCareer"){p.careerStats={gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0,seasons:0,fumbles:0,proBowls:0,allPros:0};}
    else if(field==="proBowls"){if(!p.careerStats)p.careerStats={};p.careerStats.proBowls=cl(parseInt(value)||0,0,20);}
    else if(field==="allPros"){if(!p.careerStats)p.careerStats={};p.careerStats.allPros=cl(parseInt(value)||0,0,20);}
    else if(field==="stat"){
      var sp=value.split(":");if(sp.length===2){if(!p.stats)p.stats={};p.stats[sp[0]]=parseInt(sp[1])||0;}
    }
    u2.capUsed=capCalc(u2.roster);
    logTx("GOD_MODE",{name:p.name,field:field,value:value});
    setTeams(nt);doSave(nt);
  }
  function godModeTeamEdit(field,value){
    if(!godMode||!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    if(field==="city")u2.city=value||u2.city;
    else if(field==="name")u2.name=value||u2.name;
    else if(field==="abbr")u2.abbr=(value||u2.abbr).toUpperCase().slice(0,4);
    else if(field==="icon")u2.icon=value||u2.icon;
    logTx("GOD_MODE",{team:true,field:field,value:value});
    setTeams(nt);doSave(nt);
  }
  // v98: ===== EXPANDED GOD MODE â€” LEAGUE-WIDE POWERS =====
  function godTargetTeam(){return teams.find(function(t){return t.id===(godTarget||myId);})||my;}
  function godModeAnyEdit(teamId,pid,field,value){
    if(!godMode) return;var nt=teams.slice();var tm=nt.find(function(t){return t.id===teamId;});if(!tm)return;
    var p=tm.roster.find(function(x){return x.id===pid;});if(!p)return;
    if(field==="name"){p.name=value||p.name;}
    else if(field==="ovr"){
      var diff=parseInt(value)-p.ovr;var def=POS_DEF[p.pos];
      if(def){def.r.forEach(function(r){p.ratings[r]=cl((p.ratings[r]||50)+diff,35,99);});}p.ovr=calcOvr(p);
    }
    else if(field==="age"){p.age=cl(parseInt(value)||p.age,19,45);}
    else if(field==="morale"){p.morale=cl(parseInt(value)||70,0,99);}
    else if(field==="pot"){p.pot=cl(parseInt(value)||p.pot,1,99);}
    else if(field==="pos"){var np=value.toUpperCase();if(POS_DEF[np]){p.pos=np;p.ovr=calcOvr(p);}}
    else if(field==="salary"){p.contract.baseSalary=Math.max(0.5,parseFloat(value)||1);p.contract.salary=calcCapHit(p.contract);}
    else if(field==="years"){p.contract.years=cl(parseInt(value)||1,1,8);}
    else if(field==="trait"){if(TRAITS[value])p.trait=value;}
    else if(field==="devTrait"){p.devTrait=value;}
    else if(field==="injury"){if(value==="heal")setPlayerInjury92(p,null,0);else setPlayerInjury92(p,"God Mode Injury",cl(parseInt(value)||1,1,20));}
    tm.capUsed=capCalc(tm.roster);
    logTx("GOD_MODE",{team:tm.abbr,name:p.name,field:field,value:value});
    setTeams(nt);doSave(nt);
  }
  function godModeAnyTeamEdit(teamId,field,value){
    if(!godMode) return;var nt=teams.slice();var tm=nt.find(function(t){return t.id===teamId;});if(!tm)return;
    if(field==="city")tm.city=value||tm.city;
    else if(field==="name")tm.name=value||tm.name;
    else if(field==="abbr")tm.abbr=(value||tm.abbr).toUpperCase().slice(0,4);
    else if(field==="icon")tm.icon=value||tm.icon;
    else if(field==="wins")tm.wins=parseInt(value)||0;
    else if(field==="losses")tm.losses=parseInt(value)||0;
    else if(field==="cash")tm.cash=parseFloat(value)||0;
    else if(field==="prestige")tm.prestige=cl(parseInt(value)||50,0,100);
    else if(field==="ownerMood")tm.ownerMood=cl(parseInt(value)||50,0,100);
    else if(field==="fanbase")tm.fanbase=cl(parseInt(value)||60,10,99);
    else if(field==="scoutPts")tm.scoutPts=parseInt(value)||0;
    logTx("GOD_MODE",{team:tm.abbr,field:field,value:value});
    setTeams(nt);doSave(nt);
  }
  function godModeStealPlayer(fromTeamId,pid){
    if(!godMode||!my) return;var nt=teams.slice();
    var src=nt.find(function(t){return t.id===fromTeamId;});if(!src)return;
    var tgt=nt.find(function(t){return t.id===myId;});
    var idx=src.roster.findIndex(function(p){return p.id===pid;});if(idx<0)return;
    var p=src.roster.splice(idx,1)[0];
    tgt.roster.push(p);
    src.capUsed=capCalc(src.roster);tgt.capUsed=capCalc(tgt.roster);
    logTx("GOD_MODE",{action:"steal",name:p.name,from:src.abbr});
    addN("âš¡ GOD: Stole "+p.name+" ("+p.pos+" "+p.ovr+") from "+src.icon+src.abbr,"purple");
    setTeams(nt);doSave(nt);
  }
  function godModeMovePlayer(pid,fromTeamId,toTeamId){
    if(!godMode) return;var nt=teams.slice();
    var src=nt.find(function(t){return t.id===fromTeamId;});
    var tgt=nt.find(function(t){return t.id===toTeamId;});
    if(!src||!tgt)return;
    var idx=src.roster.findIndex(function(p){return p.id===pid;});if(idx<0)return;
    var p=src.roster.splice(idx,1)[0];tgt.roster.push(p);
    src.capUsed=capCalc(src.roster);tgt.capUsed=capCalc(tgt.roster);
    logTx("GOD_MODE",{action:"move",name:p.name,from:src.abbr,to:tgt.abbr});
    addN("âš¡ GOD: Moved "+p.name+" â†’ "+tgt.icon+tgt.abbr,"purple");
    setTeams(nt);doSave(nt);
  }
  function godModeCreatePlayer(pos,ovr,age,name){
    if(!godMode||!my) return;var nt=teams.slice();var tgt=nt.find(function(t){return t.id===myId;});
    var tier=ovr>=85?"star":ovr>=72?"good":ovr>=62?"avg":"bad";
    var p=genPlayer(pos||"QB",tier,age||24);
    if(name)p.name=name;
    // Override OVR to exact value
    var diff=ovr-p.ovr;var def=POS_DEF[p.pos];
    if(def){def.r.forEach(function(r){p.ratings[r]=cl((p.ratings[r]||50)+diff,35,99);});}
    p.ovr=calcOvr(p);p.pot=cl(ovr+rng(0,10),ovr,99);
    p.contract=marketContract(p.ovr,p.age);
    tgt.roster.push(p);tgt.capUsed=capCalc(tgt.roster);
    logTx("GOD_MODE",{action:"create",name:p.name,pos:p.pos,ovr:p.ovr});
    addN("âš¡ GOD: Created "+p.name+" ("+p.pos+" "+p.ovr+" OVR, age "+p.age+")","purple");
    setTeams(nt);doSave(nt);
  }
  function godModeForceRetire(teamId,pid){
    if(!godMode) return;var nt=teams.slice();var tm=nt.find(function(t){return t.id===teamId;});if(!tm)return;
    var idx=tm.roster.findIndex(function(p){return p.id===pid;});if(idx<0)return;
    var p=tm.roster[idx];
    // Archive to career stats before removing
    if(!p.careerStats)p.careerStats={gp:0,seasons:0};
    p.careerStats.retired=true;p.careerStats.retiredYear=season.year;
    // Add to hall of fame check
    var cs=p.careerStats;
    var isHoF=(cs.passYds||0)>=25000||(cs.rushYds||0)>=8000||(cs.sacks||0)>=60||(cs.defINT||0)>=40||(cs.recYds||0)>=8000||((cs.proBowls||0)>=4)||((cs.seasons||0)>=8&&p.ovr>=85);
    if(isHoF&&hallOfFame){hallOfFame.push({name:p.name,pos:p.pos,ovr:p.ovr,team:tm.abbr,year:season.year,stats:assign({},cs)});}
    tm.roster.splice(idx,1);tm.capUsed=capCalc(tm.roster);
    logTx("GOD_MODE",{action:"retire",name:p.name,team:tm.abbr});
    addN("âš¡ GOD: "+p.name+" ("+p.pos+") forced into retirement"+(isHoF?" â†’ Hall of Fame!":""),"purple");
    // v98.6 #12/#20: Trigger ceremony
    (function(){try{
      var speech=CEREMONY_986.generateRetirementSpeech(p,tm,cs);
      if(isHoF){
        var hofLines=CEREMONY_986.generateHoFSpeech(p,cs);
        setRetireCeremony986({type:"hof",player:p.name+" ("+p.pos+")",lines:hofLines});
        setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year,0,"retire",p.name+" inducted into Hall of Fame","ðŸ›ï¸");});
      }else if((cs.seasons||0)>=5||p.ovr>=80){
        setRetireCeremony986({type:"retire",player:p.name+" ("+p.pos+")",lines:speech.lines});
        setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year,0,"retire",p.name+" retired after "+(cs.seasons||0)+" seasons","ðŸšª");});
      }
    }catch(e986c){console.error("v98.6 ceremony error:",e986c);}})();
    setTeams(nt);doSave(nt);setPlayerDetail(null);
  }
  function godModeClonePlayer(teamId,pid){
    if(!godMode) return;var nt=teams.slice();var tm=nt.find(function(t){return t.id===teamId;});if(!tm)return;
    var src=tm.roster.find(function(p){return p.id===pid;});if(!src)return;
    var clone=assign({},src,{id:Date.now()+"_"+Math.random().toString(36).slice(2,8),
      name:src.name+" Jr.",ratings:assign({},src.ratings),contract:assign({},src.contract),
      stats:{gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0},
      careerStats:null,age:Math.max(21,src.age-4)});
    clone.ovr=calcOvr(clone);
    tm.roster.push(clone);tm.capUsed=capCalc(tm.roster);
    logTx("GOD_MODE",{action:"clone",name:clone.name,from:src.name});
    addN("âš¡ GOD: Cloned "+src.name+" â†’ "+clone.name+" (age "+clone.age+")","purple");
    setTeams(nt);doSave(nt);
  }
  function godModeEditCoach(teamId,role,field,value){
    if(!godMode) return;var nt=teams.slice();var tm=nt.find(function(t){return t.id===teamId;});if(!tm||!tm.staff)return;
    var coach=role==="hc"?tm.staff.hc:role==="oc"?tm.staff.oc:tm.staff.dc;if(!coach)return;
    if(field==="name")coach.name=value||coach.name;
    else if(field==="strategy")coach.ratings.strategy=cl(parseInt(value)||50,1,99);
    else if(field==="development")coach.ratings.development=cl(parseInt(value)||50,1,99);
    else if(field==="gameplan")coach.ratings.gameplan=cl(parseInt(value)||50,1,99);
    else if(field==="arch")coach.arch=value||coach.arch;
    logTx("GOD_MODE",{action:"editCoach",team:tm.abbr,role:role,field:field,value:value});
    addN("âš¡ GOD: "+tm.abbr+" "+role.toUpperCase()+" "+field+" â†’ "+value,"purple");
    setTeams(nt);doSave(nt);
  }
  function godModeSwapTeam(newTeamId){
    if(!godMode) return;if(newTeamId===myId)return;
    var nt=teams.slice();var oldT=nt.find(function(t){return t.id===myId;});
    var newT=nt.find(function(t){return t.id===newTeamId;});if(!newT)return;
    if(oldT)oldT.isUser=false;newT.isUser=true;
    setMyId(newTeamId);
    logTx("GOD_MODE",{action:"swapTeam",from:oldT?oldT.abbr:"?",to:newT.abbr});
    addN("âš¡ GOD: Now controlling "+newT.icon+" "+newT.city+" "+newT.name,"purple");
    setTeams(nt);doSave(nt);
  }
  function godModeAddPick(round){
    if(!godMode||!my) return;
    var newPick={team:myId,round:round||1,originalTeam:myId,year:season.year+1,id:"gmpk_"+Date.now()};
    var ns=sched.slice();// picks stored alongside schedule or in dc
    // Store in draftCapital
    var ndc=assign({},dc);if(!ndc.picks)ndc.picks=[];
    ndc.picks.push(newPick);setDc(ndc);
    logTx("GOD_MODE",{action:"addPick",round:round});
    addN("âš¡ GOD: Added Round "+round+" pick for "+season.year,"purple");
  }
  function godModeBoostTeam(teamId,amount){
    if(!godMode) return;var nt=teams.slice();var tm=nt.find(function(t){return t.id===teamId;});if(!tm)return;
    tm.roster.forEach(function(p){
      var def=POS_DEF[p.pos];if(def){def.r.forEach(function(r){p.ratings[r]=cl((p.ratings[r]||50)+amount,35,99);});}
      p.ovr=calcOvr(p);p.pot=cl(p.pot+Math.round(amount*0.5),p.ovr,99);
    });
    tm.capUsed=capCalc(tm.roster);
    logTx("GOD_MODE",{action:"boostTeam",team:tm.abbr,amount:amount});
    addN("âš¡ GOD: "+tm.icon+tm.abbr+" all players "+(amount>0?"+":"")+amount+" OVR","purple");
    setTeams(nt);doSave(nt);
  }
  function godModeNukeTeam(teamId){
    if(!godMode) return;var nt=teams.slice();var tm=nt.find(function(t){return t.id===teamId;});if(!tm)return;
    tm.roster.forEach(function(p){
      var def=POS_DEF[p.pos];if(def){def.r.forEach(function(r){p.ratings[r]=cl((p.ratings[r]||50)-15,30,60);});}
      p.ovr=calcOvr(p);p.morale=rng(20,40);
    });
    tm.capUsed=capCalc(tm.roster);
    logTx("GOD_MODE",{action:"nuke",team:tm.abbr});
    addN("âš¡ GOD: ðŸ’¥ Nuked "+tm.icon+tm.abbr+" â€” all players -15 OVR","purple");
    setTeams(nt);doSave(nt);
  }
  // v98: Reset rosters back to original preset players
  function godModeResetRoster(teamId){
    if(!godMode) return;var nt=teams.slice();var tm=nt.find(function(t){return t.id===teamId;});if(!tm)return;
    var newRoster=genPresetRoster(tm.id);
    // Preserve team-level state, replace roster
    tm.roster=newRoster;tm.capUsed=capCalc(tm.roster);tm.deadCap=0;
    logTx("GOD_MODE",{action:"resetRoster",team:tm.abbr});
    addN("âš¡ GOD: "+tm.icon+tm.abbr+" roster reset to original presets","purple");
    setTeams(nt);doSave(nt);
  }
  function godModeResetAllRosters(){
    if(!godMode) return;
    var nt=teams.slice();
    nt.forEach(function(tm){
      var newRoster=genPresetRoster(tm.id);
      tm.roster=newRoster;tm.capUsed=capCalc(tm.roster);tm.deadCap=0;
    });
    logTx("GOD_MODE",{action:"resetAllRosters"});
    addN("âš¡ GOD: All 30 team rosters reset to original presets!","purple");
    setTeams(nt);doSave(nt);
  }
  function showBoxScore(result){
    if(!result) return;
    var hTeam=teams.find(function(t){return t.id===result.homeId;});
    var aTeam=teams.find(function(t){return t.id===result.awayId;});
    setBoxScore({result:result,hTeam:hTeam,aTeam:aTeam});
  }
  function draftPickSalary(round){
    if(round<=1)return rng(50,85)*0.1;// $5.0-8.5M
    if(round<=3)return rng(25,45)*0.1;// $2.5-4.5M
    if(round<=6)return rng(12,25)*0.1;// $1.2-2.5M
    if(round<=10)return rng(8,15)*0.1;// $0.8-1.5M
    return rng(5,10)*0.1;// $0.5-1.0M (deep depth picks)
  }
  function genExpansionPool(){
    var pool=[];
    var poolScale97=Math.max(1,(TD&&TD.length?TD.length:20)/20);
    var posSlots=[
      {pos:"QB",n:Math.round(60*poolScale97)},{pos:"RB",n:Math.round(80*poolScale97)},{pos:"WR",n:Math.round(140*poolScale97)},{pos:"TE",n:Math.round(70*poolScale97)},
      {pos:"OL",n:Math.round(200*poolScale97)},{pos:"DL",n:Math.round(160*poolScale97)},{pos:"LB",n:Math.round(140*poolScale97)},{pos:"CB",n:Math.round(120*poolScale97)},
      {pos:"S",n:Math.round(80*poolScale97)},{pos:"K",n:Math.round(25*poolScale97)},{pos:"P",n:Math.round(25*poolScale97)}
    ];
    posSlots.forEach(function(ps){
      for(var i=0;i<ps.n;i++){
        var tier=i<Math.round(ps.n*0.08)?"star":i<Math.round(ps.n*0.25)?"good":i<Math.round(ps.n*0.7)?"avg":"bad";
        var isRookie=i>=Math.round(ps.n*0.85);
        var p=genPlayer(ps.pos,tier,isRookie?rng(21,23):undefined);
        if(isRookie){p.isRookie=true;var rkSal=Math.round(calcCapHit(p.contract)*0.6*10)/10;p.contract=makeContract(Math.max(rkSal,MIN_SALARY),4,0,0);}
        p.expVal=p.ovr+(p.pot-p.ovr)*0.3+rng(-3,3);// combined value for AI decisions
        pool.push(p);
      }
    });
    // v96.1: GAMECHANGER ROOKIES â€” 3 elite prospects with 99 POT, mid-80s OVR
    var gcPositions=(TD&&TD.length>=30)?["QB","WR","DL","CB","RB"]:["QB","WR","DL"];// v97: 5 gamechangers for 30-team league
    var gcNames=[["Marcus","Jalen","Caleb","Drake","Bryce"],["Washington","Williams","Robinson","Carter","Brooks"]];
    gcPositions.forEach(function(gcPos,gi){
      var gcP=genPlayer(gcPos,"star",21);
      // Force mid-80s OVR and 99 POT
      var targetOvr=rng(84,87);
      var def=POS_DEF[gcPos];
      if(def){
        var currentOvr=gcP.ovr;var delta=targetOvr-currentOvr;
        if(delta!==0){
          def.r.forEach(function(rName){
            gcP.ratings[rName]=cl((gcP.ratings[rName]||60)+delta,45,96);
          });
        }
      }
      gcP.ovr=calcOvr(gcP);gcP.pot=99;gcP.trueOvr=gcP.ovr;
      gcP.name=pick(gcNames[0])+" "+pick(gcNames[1]);
      gcP.age=21;gcP.isRookie=true;
      gcP.devTrait="superstar";
      gcP.traits95=["chip"];// Chip on shoulder â€” driven to prove themselves
      gcP.trait="chip";
      gcP.contract=makeContract(Math.max(MIN_SALARY,1.2),4,0,0);
      gcP.college={school:pick(["Alabama","Georgia","Ohio State","USC","Texas"])};
      gcP.expVal=gcP.ovr+(99-gcP.ovr)*0.5+20;// AI values them highly
      gcP._gamechanger96=true;// v96.1: tag for UI display
      pool.push(gcP);
    });
    for(var si=pool.length-1;si>0;si--){var sj=Math.floor(RNG.draft()*(si+1));var tmp=pool[si];pool[si]=pool[sj];pool[sj]=tmp;}
    return pool;
  }
  var POS_VALUE={QB:30,OL:18,CB:16,DL:15,WR:14,LB:13,S:12,RB:11,TE:10,K:4,P:3};
  var ROSTER_TARGETS={QB:3,RB:4,WR:6,TE:3,OL:9,DL:7,LB:7,CB:6,S:4,K:1,P:1};
  var STARTER_COUNTS={QB:1,RB:1,WR:3,TE:1,OL:5,DL:4,LB:3,CB:3,S:2,K:1,P:1};
  function aiNeedScore(roster,pos){
    var counts={};Object.keys(POS_DEF).forEach(function(p){counts[p]=0;});
    roster.forEach(function(p){counts[p.pos]=(counts[p.pos]||0)+1;});
    var target=ROSTER_TARGETS[pos]||3;
    var have=counts[pos]||0;
    var starterNeed=STARTER_COUNTS[pos]||1;
    if(have<starterNeed) return 10;
    if(have<target) return Math.max(1,target-have);
    return Math.max(0,(target-have)*0.5);
  }
  function aiPlayerScore(p,roster,roundPct,strategy,teamCtx){
    var need=aiNeedScore(roster,p.pos);
    var posVal=POS_VALUE[p.pos]||10;
    var gmArchBias90=getGMDraftArchetypeBias90(teamCtx,p,need);
    var perceivedOvr=p.hypeOvr||p.ovr;
    var ageMod=p.age<=23?12:p.age<=25?8:p.age<=27?3:p.age<=29?0:p.age<=31?-8:-18;
    var potBonus=(p.pot-perceivedOvr)*(p.age<=25?1.5:0.6);
    var ovrVal=perceivedOvr*1.8*(gmArchBias90.ovrMult||1);
    var posWeight=posVal*0.8;
    var needWeight=need*(8+roundPct*20)*(gmArchBias90.needMult||1);// need matters more as draft progresses
    var counts={};roster.forEach(function(x){counts[x.pos]=(counts[x.pos]||0)+1;});
    var hoardPenalty=(counts[p.pos]||0)>=(ROSTER_TARGETS[p.pos]||3)?-40:0;
    var starPrem=perceivedOvr>=88?20:perceivedOvr>=82?10:0;
    var devBonus=p.devTrait==="superstar"?15:p.devTrait==="star"?8:0;
    var gmBias=strategy?getGMDraftBias(strategy,p):0;
    var fitBonus=0;
    if(teamCtx){
      var fitDraft86=calcPlayerIdentityFit(p,teamCtx);
      fitBonus=(fitDraft86.score-70)*0.9;
      if(fitDraft86.score<=55)fitBonus-=8;
    }
    return ovrVal+ageMod+potBonus+posWeight+needWeight+hoardPenalty+starPrem+devBonus+gmBias+fitBonus+(gmArchBias90.bonus||0)+rng(-3,3);
  }
  function aiExpPick(teamRoster,pool,roundPct,strategy2,teamCtx){
    var rp=roundPct||0;
    if(pool.length===0) return null;
    var qbCount=teamRoster.filter(function(p){return p.pos==="QB";}).length;
    var kCount=teamRoster.filter(function(p){return p.pos==="K";}).length;
    var pCount=teamRoster.filter(function(p){return p.pos==="P";}).length;
    var scored=pool.map(function(p){return {p:p,score:aiPlayerScore(p,teamRoster,rp,strategy2,teamCtx)};});
    scored.sort(function(a,b){return b.score-a.score;});
    if(qbCount===0&&teamRoster.length>=30){
      var qbCand=scored.find(function(s){return s.p.pos==="QB";});
      if(qbCand) return qbCand.p;
    }
    if(kCount===0&&teamRoster.length>=48){
      var kCand=scored.find(function(s){return s.p.pos==="K";});
      if(kCand) return kCand.p;
    }
    if(pCount===0&&teamRoster.length>=48){
      var pCand=scored.find(function(s){return s.p.pos==="P";});
      if(pCand) return pCand.p;
    }
    return scored[0]?scored[0].p:pool[0];
  }
  function buildSnakeOrder(teamIds){
    var order=[];
    for(var rd=0;rd<50;rd++){
      var rIds=teamIds.slice();
      if(rd%2===1)rIds.reverse();
      rIds.forEach(function(id){order.push({teamId:id,round:rd+1});});
    }
    return order;
  }
  function initExpSnakeDraft(idx,depth){
    try{
    var leagueSeed=Date.now();setSeed(leagueSeed);
    setExpDepth(depth||53);setExpUserPicks(0);setExpDraftType("snake");
    var t=TD.map(function(td,i){
      return normalizeTeamFranchise976(applyLeagueAlignment97({id:td.id,city:td.city,name:td.name,abbr:td.abbr,icon:td.icon,c1:td.c1,
        roster:[],practiceSquad:[],wins:0,losses:0,pf:0,pa:0,streak:0,isUser:i===idx,
        schemeOff:pick(OFF_SCHEMES).id,schemeDef:pick(DEF_SCHEMES).id,gameplan:GAMEPLANS[0].id,gameplanOff:"balanced_o",gameplanDef:"balanced_d",
        staff:{hc:genCoach("HC"),oc:genCoach("OC"),dc:genCoach("DC")},staffBudgetSpent:0,
        posCoaches:{qb_coach:generatePosCoach(RNG.ai),ol_coach:generatePosCoach(RNG.ai),dl_coach:generatePosCoach(RNG.ai),db_coach:generatePosCoach(RNG.ai)},// v60
        capUsed:0,deadCap:0,deadCapByYear:{},prestige:50+rng(-10,10),
        cash:(i===idx?(DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).startCash||55:50)+rng(-10,20),facilities:{gym:1,med:1,stad:1},ticketPrice:75,fanbase:55+rng(-10,15),
        revenue:0,expenses:0,attendance:0,scoutPts:1000,_pipelineTripsWeekly:4,
        reSignNeg84:{},fitAlertPrefs84:{},fitAlertProfile85:"strict",
        ownerMood:70,ownerGoal:"playoff",aiStrategy:"bubble",rivals:[],
        gmArchetype90:getTeamGMArchetypeId90({id:td.id}),
        draftPicks:[1,2,3,4,5,6,7].map(function(r){return makePick(r,td.id,td.id,2026);})}));
    });
    setTeams(t);setMyId(t[idx].id);
    // v96.1: Generate random initial order then let user customize
    var ids=t.map(function(tm){return tm.id;});
    for(var ri=ids.length-1;ri>0;ri--){var rj=Math.floor(RNG.draft()*(ri+1));var tmp=ids[ri];ids[ri]=ids[rj];ids[rj]=tmp;}
    setExpDraftOrder96(ids);
    var pool=genExpansionPool();
    setExpPool(pool);setExpPoolSnap(pool.slice());setExpPosF("ALL");setExpPick(0);setExpLog([]);
    setScreen("draftOrderSetup");// v96.1: Go to order setup first
    AUDIO.play("draft");
    }catch(e){console.error("initExpSnakeDraft error:",e);alert("Draft init error: "+e.message);}
  }
  // v96.1: Launch snake draft with confirmed order
  function launchSnakeDraft96(){
    var ids=expDraftOrder96;if(!ids)return;
    var order=buildSnakeOrder(ids);
    setExpOrder(order);
    setScreen("expansionSnake");
  }
  function expSnakeSelect(playerId){
    var pool=expPool.slice();var order=expOrder.slice();var t=teams.slice();var pk=order[expPick];
    if(!pk||pk.teamId!==myId) return;// Not your turn
    var pIdx=pool.findIndex(function(p){return p.id===playerId;});if(pIdx<0) return;
    var player=pool[pIdx];pool.splice(pIdx,1);
    var tm=t.find(function(x){return x.id===myId;});
    player.isStarter=tm.roster.filter(function(x){return x.pos===player.pos;}).length<(POS_DEF[player.pos]?3:1);
    player.contract=draftContract(player.ovr,pk.round);
    tm.roster.push(player);tm.capUsed=capCalc(tm.roster);
    var newUserPicks=expUserPicks+1;
    var logEntry="âœ… Rd"+pk.round+" #"+(expPick+1)+": "+tm.icon+tm.abbr+" â€” "+player.name+" ("+player.pos+" "+player.ovr+") ðŸ“‹ "+genPickBlurb(player,tm.roster);
    var log=expLog.slice();log.unshift(logEntry);
    setExpPool(pool);setTeams(t);setExpLog(log);setExpUserPicks(newUserPicks);
    if(newUserPicks>=expDepth&&expDepth<53){
      log.unshift("ðŸ¤– Auto-completing draft â€” "+newUserPicks+" picks made by GM");
      var idx2=expPick+1;var p3=pool.slice();var t3=t.slice();
      while(idx2<order.length&&p3.length>0){
        var pk3=order[idx2];
        var tm3=t3.find(function(x){return x.id===pk3.teamId;});
        if(!tm3||tm3.roster.length>=53){idx2++;continue;}
        var best3=aiExpPick(tm3.roster,p3,idx2/order.length,null,tm3);
        if(!best3) break;
        var bI3=p3.findIndex(function(x){return x.id===best3.id;});
        if(bI3>=0)p3.splice(bI3,1);
        best3.isStarter=tm3.roster.filter(function(x){return x.pos===best3.pos;}).length<(POS_DEF[best3.pos]?3:1);
        best3.contract=draftContract(best3.ovr,pk3.round);
        tm3.roster.push(best3);tm3.capUsed=capCalc(tm3.roster);
        idx2++;
      }
      setExpPool(p3);setTeams(t3);setExpLog(log);setExpPick(idx2);
      return;
    }
    expSnakeAutoSim(expPick+1,pool,t,log,order);
  }
  function expSnakeAutoSim(startIdx,pool,t,log,order){
    var idx=startIdx;var p2=pool.slice();var t2=t.slice();var lg=log.slice();
    while(idx<order.length){
      var pk=order[idx];
      if(pk.teamId===myId) break;// User's turn â€” stop
      var tm=t2.find(function(x){return x.id===pk.teamId;});
      if(!tm||tm.roster.length>=53||p2.length===0){idx++;continue;}
      var best=aiExpPick(tm.roster,p2,idx/order.length,null,tm);
      var bIdx=p2.findIndex(function(x){return x.id===best.id;});
      if(bIdx>=0)p2.splice(bIdx,1);
      best.isStarter=tm.roster.filter(function(x){return x.pos===best.pos;}).length<(POS_DEF[best.pos]?3:1);
      best.contract=draftContract(best.ovr,pk.round);
      tm.roster.push(best);tm.capUsed=capCalc(tm.roster);
      lg.unshift("ðŸ“‹ Rd"+pk.round+" #"+(idx+1)+": "+tm.icon+tm.abbr+" â€” "+best.name+" ("+best.pos+" "+best.ovr+")");
      idx++;
    }
    if(lg.length>60)lg=lg.slice(0,60);
    setExpPool(p2);setTeams(t2);setExpLog(lg);setExpPick(idx);
  }
  function expSnakeAutoFinish(){
    var pool=expPool.slice();var t=teams.slice();var order=expOrder.slice();var lg=expLog.slice();
    var idx=expPick;
    while(idx<order.length&&pool.length>0){
      var pk=order[idx];
      var tm=t.find(function(x){return x.id===pk.teamId;});
      if(!tm||tm.roster.length>=53){idx++;continue;}
      var best=aiExpPick(tm.roster,pool,idx/order.length,null,tm);
      var bIdx=pool.findIndex(function(x){return x.id===best.id;});
      if(bIdx>=0)pool.splice(bIdx,1);
      best.isStarter=tm.roster.filter(function(x){return x.pos===best.pos;}).length<(POS_DEF[best.pos]?3:1);
      best.contract=draftContract(best.ovr,pk.round);
      tm.roster.push(best);tm.capUsed=capCalc(tm.roster);
      idx++;
    }
    lg.unshift("â© Auto-drafted remaining picks");
    setExpPool(pool);setTeams(t);setExpLog(lg);setExpPick(idx);
  }
  function finishExpansionDraft(){
    var t=teams.slice();
    t.forEach(function(tm){
      while(tm.roster.length<53)tm.roster.push(genPlayer(pick(["WR","OL","DL","LB","CB"]),"bad"));
      tm.roster=tm.roster.slice(0,53);
      var ovrAvg=avg(tm.roster,function(p){return p.ovr;});
      tm.ownerGoal=ovrAvg>74?"title":ovrAvg>68?"playoff":"rebuild";
      tm.aiStrategy=tm.ownerGoal==="title"?"contend":tm.ownerGoal==="playoff"?"bubble":"rebuild";
      ensureTeamGMArchetype90(tm);
      tm.capUsed=capCalc(tm.roster);
    });
    var leagueSeed=Date.now();setSeed(leagueSeed);
    var s=genSchedule97(t,2026);var f=genFreeAgents(getScaledFreeAgentCount97());var d=genDraftClass(getScaledDraftClassCount97());
    setTeams(t);setSched(s);setFAs(f);setDC(d);setHistory([]);setTxLog([]);setInbox([]);setHallOfFame([]);
    setSeason({year:2026,week:1,phase:"regular",ledger:[]});
    setPracFocus("scout");setPracXpWeek87("");
    var my2=t.find(function(x){return x.id===myId;});
    setNews([{text:my2.icon+" "+my2.city+" "+my2.name+" â€” League Inaugural Draft complete! Your franchise is live.",type:"gold",id:U()}]);
    setTab("home");setScreen("league");
    saveG({saveVersion:SAVE_VERSION,difficulty:difficulty,teams:t,myId:myId,sched:s,season:{year:2026,week:1,phase:"regular",ledger:[]},fas:f,history:[],seed:leagueSeed,hallOfFame:[]});
  }
  function initExpAuctionDraft(idx,depth){
    try{
    var leagueSeed=Date.now();setSeed(leagueSeed);
    setExpDepth(depth||53);setExpUserPicks(0);setExpDraftType("auction");
    var t=TD.map(function(td,i){
      return normalizeTeamFranchise976(applyLeagueAlignment97({id:td.id,city:td.city,name:td.name,abbr:td.abbr,icon:td.icon,c1:td.c1,
        roster:[],practiceSquad:[],wins:0,losses:0,pf:0,pa:0,streak:0,isUser:i===idx,
        schemeOff:pick(OFF_SCHEMES).id,schemeDef:pick(DEF_SCHEMES).id,gameplan:GAMEPLANS[0].id,gameplanOff:"balanced_o",gameplanDef:"balanced_d",
        staff:{hc:genCoach("HC"),oc:genCoach("OC"),dc:genCoach("DC")},staffBudgetSpent:0,
        posCoaches:{qb_coach:generatePosCoach(RNG.ai),ol_coach:generatePosCoach(RNG.ai),dl_coach:generatePosCoach(RNG.ai),db_coach:generatePosCoach(RNG.ai)},// v60
        capUsed:0,deadCap:0,deadCapByYear:{},prestige:50+rng(-10,10),
        cash:(i===idx?(DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).startCash||55:50)+rng(-10,20),facilities:{gym:1,med:1,stad:1},ticketPrice:75,fanbase:55+rng(-10,15),
        revenue:0,expenses:0,attendance:0,scoutPts:1000,_pipelineTripsWeekly:4,
        reSignNeg84:{},fitAlertPrefs84:{},fitAlertProfile85:"strict",
        ownerMood:70,ownerGoal:"playoff",aiStrategy:"bubble",rivals:[],
        gmArchetype90:getTeamGMArchetypeId90({id:td.id}),
        draftPicks:[1,2,3,4,5,6,7].map(function(r){return makePick(r,td.id,td.id,2026);})}));
    });
    setTeams(t);setMyId(t[idx].id);
    var pool=genExpansionPool();
    pool.sort(function(a,b){return b.ovr-a.ovr;});
    var budgets={};t.forEach(function(tm){budgets[tm.id]=1000;});
    setExpPool(pool);setExpPoolSnap(pool.slice());setExpBudgets(budgets);setExpAucRound(0);setExpNom(null);
    setExpBid(0);setExpBidder(null);setExpUserBid(0);setExpLog([]);setExpPosF("ALL");
    setExpAucPhase("nom");
    setScreen("expansionAuction");
    AUDIO.play("draft");
    }catch(e){console.error("initExpAuctionDraft error:",e);alert("Auction draft init error: "+e.message);}
  }
  function aucMaxBid(teamId,budgets,rosterLen){
    var spotsNeeded=50-rosterLen;// must fill 50 roster spots
    if(spotsNeeded<=0) return 0;
    return Math.max(1,(budgets[teamId]||0)-(spotsNeeded-1));// reserve $1 per remaining spot
  }
  function aucNominate(playerId){
    var player=expPool.find(function(p){return p.id===playerId;});
    if(!player) return;
    setExpNom(player);setExpBid(1);setExpBidder(myId);setExpUserBid(1);setExpAucPhase("bid");
  }
  function aucRunBids(){
    if(!expNom) return;
    var t=teams.slice();var bud=assign({},expBudgets);
    var highBid=expBid;var highBidder=expBidder;
    for(var bidRound=0;bidRound<3;bidRound++){
      t.forEach(function(tm){
        if(tm.id===myId||tm.roster.length>=50) return;
        var need=aiNeedScore(tm.roster,expNom.pos);
        var maxB=aucMaxBid(tm.id,bud,tm.roster.length);
        if(maxB<=highBid) return;
        var posVal=POS_VALUE[expNom.pos]||10;
        var ageMod=expNom.age<=24?8:expNom.age<=27?4:expNom.age<=30?0:-6;
        var potUp=(expNom.pot-expNom.ovr)*(expNom.age<=25?0.8:0.3);
        var perceivedVal=Math.round(expNom.ovr*0.4+posVal*0.6+ageMod+potUp);
        var needMult=need>=8?2.2:need>=5?1.8:need>=2?1.3:need>0?1.0:0.4;
        var willPay=Math.round(perceivedVal*needMult*((DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).aiBidMod))+rng(-4,6);
        var budgetCap=Math.round((bud[tm.id]||0)*0.4);
        willPay=Math.min(willPay,budgetCap,maxB);
        if(willPay>highBid&&RNG.ai()<(0.45+need*0.08)){
          highBid=cl(highBid+rng(1,Math.max(1,Math.round((willPay-highBid)*0.5))),highBid+1,willPay);
          highBidder=tm.id;
        }
      });
    }
    setExpBid(highBid);setExpBidder(highBidder);
  }
  function aucUserBid(amount){
    var maxB=aucMaxBid(myId,expBudgets,teams.find(function(t){return t.id===myId;}).roster.length);
    var bid=cl(amount,expBid+1,maxB);
    if(bid<=expBid) return;
    setExpBid(bid);setExpBidder(myId);setExpUserBid(bid);
    var t=teams.slice();var bud=assign({},expBudgets);
    var highBid=bid;var highBidder=myId;
    t.forEach(function(tm){
      if(tm.id===myId||tm.roster.length>=50) return;
      var need=aiNeedScore(tm.roster,expNom.pos);
      var maxB2=aucMaxBid(tm.id,bud,tm.roster.length);
      if(maxB2<=highBid) return;
      var posVal=POS_VALUE[expNom.pos]||10;
      var ageMod=expNom.age<=24?8:expNom.age<=27?4:expNom.age<=30?0:-6;
      var potUp=(expNom.pot-expNom.ovr)*(expNom.age<=25?0.8:0.3);
      var perceivedVal=Math.round(expNom.ovr*0.4+posVal*0.6+ageMod+potUp);
      var needMult=need>=8?2.5:need>=5?1.9:need>=2?1.4:need>0?1.0:0.3;
      var willPay=Math.round(perceivedVal*needMult*((DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).aiBidMod))+rng(-3,5);
      var budgetCap=Math.round((bud[tm.id]||0)*0.4);
      willPay=Math.min(willPay,budgetCap,maxB2);
      if(willPay>highBid&&RNG.ai()<(0.35+need*0.1)){
        highBid=cl(highBid+rng(1,Math.max(1,Math.round((willPay-highBid)*0.4))),highBid+1,willPay);
        highBidder=tm.id;
      }
    });
    setExpBid(highBid);setExpBidder(highBidder);
  }
  function aucSold(){
    if(!expNom||!expBidder) return;
    var t=teams.slice();var bud=assign({},expBudgets);var pool=expPool.slice();
    // v93.10: Auto-run AI bids before finalizing so players can't be sniped for $1
    var highBid=expBid;var highBidder=expBidder;
    for(var bidRound=0;bidRound<3;bidRound++){
      t.forEach(function(tm){
        if(tm.id===myId||tm.roster.length>=50) return;
        var need=aiNeedScore(tm.roster,expNom.pos);
        var maxB=aucMaxBid(tm.id,bud,tm.roster.length);
        if(maxB<=highBid) return;
        var posVal=POS_VALUE[expNom.pos]||10;
        var ageMod=expNom.age<=24?8:expNom.age<=27?4:expNom.age<=30?0:-6;
        var potUp=(expNom.pot-expNom.ovr)*(expNom.age<=25?0.8:0.3);
        var perceivedVal=Math.round(expNom.ovr*0.4+posVal*0.6+ageMod+potUp);
        var needMult=need>=8?2.2:need>=5?1.8:need>=2?1.3:need>0?1.0:0.4;
        var willPay=Math.round(perceivedVal*needMult*((DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).aiBidMod))+rng(-4,6);
        var budgetCap=Math.round((bud[tm.id]||0)*0.4);
        willPay=Math.min(willPay,budgetCap,maxB);
        if(willPay>highBid&&RNG.ai()<(0.45+need*0.08)){
          highBid=cl(highBid+rng(1,Math.max(1,Math.round((willPay-highBid)*0.5))),highBid+1,willPay);
          highBidder=tm.id;
        }
      });
    }
    // If AI outbid the user, update state and DON'T finalize â€” let user respond
    if(highBidder!==expBidder){
      setExpBid(highBid);setExpBidder(highBidder);
      return;
    }
    var winner=t.find(function(x){return x.id===expBidder;});
    if(!winner) return;
    var player=assign({},expNom);
    player.isStarter=winner.roster.filter(function(x){return x.pos===player.pos;}).length<(POS_DEF[player.pos]?3:1);
    player.contract=aucContract(player.ovr,expBid,1000);// v93.12: OVR+bid â†’ realistic cap hit
    winner.roster.push(player);winner.capUsed=capCalc(winner.roster);
    bud[expBidder]=(bud[expBidder]||0)-expBid;
    var pIdx=pool.findIndex(function(p){return p.id===expNom.id;});
    if(pIdx>=0)pool.splice(pIdx,1);
    var lg=expLog.slice();
    lg.unshift("ðŸ’° "+winner.icon+winner.abbr+" wins "+player.name+" ("+player.pos+" "+player.ovr+") for $"+expBid+(winner.isUser?" ðŸ“‹ "+genPickBlurb(player,winner.roster):""));
    // v93.11: Build AI nomination queue so user can bid on every player
    var aiBatch=rng(2,4);
    var aiQueue=[];
    for(var ab=0;ab<aiBatch;ab++){
      var aiTeams=t.filter(function(x){return !x.isUser&&x.roster.length<50&&(bud[x.id]||0)>0;});
      if(aiTeams.length===0||pool.length===0) break;
      var nomTeam=aiTeams[Math.floor(RNG.ai()*aiTeams.length)];
      var aiBest=aiExpPick(nomTeam.roster,pool,nomTeam.roster.length/50,null,nomTeam);
      if(!aiBest) break;
      var posV=POS_VALUE[aiBest.pos]||10;
      var baseVal=Math.round(aiBest.ovr*0.35+posV*0.5)+(aiBest.age<=25?5:0);
      var aiHigh=cl(baseVal+rng(-3,5),1,aucMaxBid(nomTeam.id,bud,nomTeam.roster.length));var aiWinnerId=nomTeam.id;
      t.forEach(function(otm){
        if(otm.id===nomTeam.id||otm.roster.length>=50) return;
        var need2=aiNeedScore(otm.roster,aiBest.pos);
        var maxB3=aucMaxBid(otm.id,bud,otm.roster.length);
        if(maxB3<=aiHigh) return;
        var needMult2=need2>=5?1.8:need2>=2?1.3:need2>0?1.0:0.4;
        var bid3=cl(Math.round(baseVal*needMult2)+rng(-2,6),aiHigh+1,maxB3);
        var budgetCap3=Math.round((bud[otm.id]||0)*0.35);
        bid3=Math.min(bid3,budgetCap3);
        if(bid3>aiHigh&&RNG.ai()<(0.4+need2*0.08)){aiHigh=bid3;aiWinnerId=otm.id;}
      });
      // Mark player as spoken for in pool so next AI pick doesn't grab it
      var bIdx=pool.findIndex(function(x){return x.id===aiBest.id;});
      if(bIdx>=0)pool.splice(bIdx,1);
      aiQueue.push({player:aiBest,nomTeamId:nomTeam.id,aiHighBid:aiHigh,aiWinnerId:aiWinnerId,pool:null});
    }
    if(lg.length>60)lg=lg.slice(0,60);
    var newUserPicks2=expUserPicks+(expBidder===myId?1:0);
    setTeams(t);setExpBudgets(bud);setExpPool(pool);setExpLog(lg);setExpUserPicks(newUserPicks2);
    setExpNom(null);setExpBid(0);setExpBidder(null);setExpUserBid(0);
    setExpAucRound(expAucRound+1);
    if(aiQueue.length>0){
      // Present first AI nomination to user
      var first=aiQueue[0];
      setExpNom(first.player);setExpBid(first.aiHighBid);setExpBidder(first.aiWinnerId);setExpUserBid(0);
      setExpAiQueue(aiQueue.slice(1));
      setExpAucPhase("aiBid");
    }else{
      if(newUserPicks2>=expDepth&&expDepth<53){
        lg.unshift("ðŸ¤– Auto-completing auction â€” "+newUserPicks2+" nominations by GM");
        var rounds2=0;
        while(pool.length>0&&rounds2<2000){
          var need2T=t.filter(function(x){return x.roster.length<50&&(bud[x.id]||0)>0;});
          if(need2T.length===0) break;
          var tm2=need2T[rounds2%need2T.length];
          var best2=aiExpPick(tm2.roster,pool,tm2.roster.length/50,null,tm2);if(!best2) break;
          var posV3=POS_VALUE[best2.pos]||10;
          var bAmt2=cl(Math.round(best2.ovr*0.3+posV3*0.4)+rng(-2,4),1,aucMaxBid(tm2.id,bud,tm2.roster.length));
          best2.isStarter=tm2.roster.filter(function(x){return x.pos===best2.pos;}).length<(POS_DEF[best2.pos]?3:1);
          best2.contract=aucContract(best2.ovr,bAmt2,1000);
          tm2.roster.push(best2);tm2.capUsed=capCalc(tm2.roster);
          bud[tm2.id]=(bud[tm2.id]||0)-bAmt2;
          var bI2=pool.findIndex(function(x){return x.id===best2.id;});
          if(bI2>=0)pool.splice(bI2,1);
          rounds2++;
        }
        setTeams(t);setExpBudgets(bud);setExpPool(pool);setExpLog(lg);
      }
      setExpAucPhase("nom");
    }
    if(newUserPicks2>=expDepth&&expDepth<53&&aiQueue.length===0){/* handled above */}
  }
  function aucAdvanceAiQueue(t2,bud2,pool2,lg2,newUserPicks3){
    // v93.11: After resolving an aiBid item, check if more in queue
    var queue=expAiQueue.slice();
    if(queue.length>0){
      var next=queue[0];
      setTeams(t2);setExpBudgets(bud2);setExpPool(pool2);setExpLog(lg2);
      setExpNom(next.player);setExpBid(next.aiHighBid);setExpBidder(next.aiWinnerId);setExpUserBid(0);
      setExpAiQueue(queue.slice(1));
      setExpAucPhase("aiBid");
    }else{
      if((newUserPicks3||expUserPicks)>=expDepth&&expDepth<53){
        lg2.unshift("ðŸ¤– Auto-completing auction");
        var rounds3=0;var pool3=pool2.slice();var t3=t2.slice();var bud3=assign({},bud2);
        while(pool3.length>0&&rounds3<2000){
          var need3T=t3.filter(function(x){return x.roster.length<50&&(bud3[x.id]||0)>0;});
          if(need3T.length===0) break;
          var tm3=need3T[rounds3%need3T.length];
          var best3=aiExpPick(tm3.roster,pool3,tm3.roster.length/50,null,tm3);if(!best3) break;
          var posV4=POS_VALUE[best3.pos]||10;
          var bAmt3=cl(Math.round(best3.ovr*0.3+posV4*0.4)+rng(-2,4),1,aucMaxBid(tm3.id,bud3,tm3.roster.length));
          best3.isStarter=tm3.roster.filter(function(x){return x.pos===best3.pos;}).length<(POS_DEF[best3.pos]?3:1);
          best3.contract=aucContract(best3.ovr,bAmt3,1000);
          tm3.roster.push(best3);tm3.capUsed=capCalc(tm3.roster);
          bud3[tm3.id]=(bud3[tm3.id]||0)-bAmt3;
          var bI3=pool3.findIndex(function(x){return x.id===best3.id;});
          if(bI3>=0)pool3.splice(bI3,1);
          rounds3++;
        }
        setTeams(t3);setExpBudgets(bud3);setExpPool(pool3);setExpLog(lg2);
      }else{
        setTeams(t2);setExpBudgets(bud2);setExpPool(pool2);setExpLog(lg2);
      }
      setExpNom(null);setExpBid(0);setExpBidder(null);setExpUserBid(0);
      setExpAucPhase("nom");
    }
  }
  function aucPassAiBid(){
    // v93.11: User passes on AI-nominated player â€” AI winner gets it at their price
    if(!expNom||!expBidder) return;
    var t=teams.slice();var bud=assign({},expBudgets);var pool=expPool.slice();
    var winner=t.find(function(x){return x.id===expBidder;});
    if(!winner) return;
    var player=assign({},expNom);
    player.isStarter=winner.roster.filter(function(x){return x.pos===player.pos;}).length<(POS_DEF[player.pos]?3:1);
    player.contract=aucContract(player.ovr,expBid,1000);
    winner.roster.push(player);winner.capUsed=capCalc(winner.roster);
    bud[expBidder]=(bud[expBidder]||0)-expBid;
    var lg=expLog.slice();
    lg.unshift("ðŸ“‹ "+winner.icon+winner.abbr+" buys "+player.name+" ("+player.pos+" "+player.ovr+") for $"+expBid);
    if(lg.length>60)lg=lg.slice(0,60);
    aucAdvanceAiQueue(t,bud,pool,lg,expUserPicks);
  }
  function aucWinAiBid(){
    // v93.11: User wins an AI-nominated item â€” finalize and advance queue
    if(!expNom||!expBidder) return;
    // Run AI counter-bids first
    var highBid=expBid;var highBidder=expBidder;
    var t=teams.slice();var bud=assign({},expBudgets);var pool=expPool.slice();
    for(var br=0;br<2;br++){
      t.forEach(function(tm){
        if(tm.id===myId||tm.roster.length>=50) return;
        var need=aiNeedScore(tm.roster,expNom.pos);
        var maxB=aucMaxBid(tm.id,bud,tm.roster.length);
        if(maxB<=highBid) return;
        var posVal=POS_VALUE[expNom.pos]||10;
        var ageMod=expNom.age<=24?8:expNom.age<=27?4:expNom.age<=30?0:-6;
        var potUp=(expNom.pot-expNom.ovr)*(expNom.age<=25?0.8:0.3);
        var perceivedVal=Math.round(expNom.ovr*0.4+posVal*0.6+ageMod+potUp);
        var needMult=need>=8?2.2:need>=5?1.8:need>=2?1.3:need>0?1.0:0.4;
        var willPay=Math.round(perceivedVal*needMult*((DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).aiBidMod))+rng(-3,5);
        var budgetCap=Math.round((bud[tm.id]||0)*0.4);
        willPay=Math.min(willPay,budgetCap,maxB);
        if(willPay>highBid&&RNG.ai()<(0.45+need*0.08)){
          highBid=cl(highBid+rng(1,Math.max(1,Math.round((willPay-highBid)*0.5))),highBid+1,willPay);
          highBidder=tm.id;
        }
      });
    }
    if(highBidder!==myId){setExpBid(highBid);setExpBidder(highBidder);return;}
    var winner=t.find(function(x){return x.id===myId;});
    if(!winner) return;
    var player=assign({},expNom);
    player.isStarter=winner.roster.filter(function(x){return x.pos===player.pos;}).length<(POS_DEF[player.pos]?3:1);
    player.contract=aucContract(player.ovr,highBid,1000);
    winner.roster.push(player);winner.capUsed=capCalc(winner.roster);
    bud[myId]=(bud[myId]||0)-highBid;
    var lg=expLog.slice();
    lg.unshift("ðŸ’° "+winner.icon+winner.abbr+" wins "+player.name+" ("+player.pos+" "+player.ovr+") for $"+highBid+" ðŸ“‹ "+genPickBlurb(player,winner.roster));
    if(lg.length>60)lg=lg.slice(0,60);
    var newPicks=expUserPicks+1;
    setExpUserPicks(newPicks);
    setExpAucRound(expAucRound+1);
    aucAdvanceAiQueue(t,bud,pool,lg,newPicks);
  }
  function aucAutoFinish(){
    var t=teams.slice();var bud=assign({},expBudgets);var pool=expPool.slice();var lg=expLog.slice();
    var rounds=0;
    while(pool.length>0&&rounds<2000){
      var needTeams=t.filter(function(x){return x.roster.length<50&&(bud[x.id]||0)>0;});
      if(needTeams.length===0) break;
      var tm=needTeams[rounds%needTeams.length];
      var best=aiExpPick(tm.roster,pool,tm.roster.length/50,null,tm);if(!best) break;
      var posV2=POS_VALUE[best.pos]||10;
      var baseVal2=Math.round(best.ovr*0.3+posV2*0.4)+(best.age<=25?3:0);
      var bidAmt=cl(baseVal2+rng(-2,4),1,aucMaxBid(tm.id,bud,tm.roster.length));
      best.isStarter=tm.roster.filter(function(x){return x.pos===best.pos;}).length<(POS_DEF[best.pos]?3:1);
      best.contract=aucContract(best.ovr,bidAmt,1000);
      tm.roster.push(best);tm.capUsed=capCalc(tm.roster);
      bud[tm.id]=(bud[tm.id]||0)-bidAmt;
      var bIdx=pool.findIndex(function(x){return x.id===best.id;});
      if(bIdx>=0)pool.splice(bIdx,1);
      rounds++;
    }
    lg.unshift("â© Auto-filled remaining rosters ($1 bargain bin)");
    setTeams(t);setExpBudgets(bud);setExpPool(pool);setExpLog(lg);
  }
  function createLeague(idx,usePresets){
    try{
    var leagueSeed=Date.now();setSeed(leagueSeed);
    var t=initTeams(idx,usePresets);var s=genSchedule97(t,2026);var f=genFreeAgents(getScaledFreeAgentCount97());var d=genDraftClass(getScaledDraftClassCount97());
    setTeams(t);setMyId(t[idx].id);setSched(s);setFAs(f);setDC(d);setHistory([]);setTxLog([]);setInbox([]);setHallOfFame([]);
    setSeason({year:2026,week:1,phase:"regular",ledger:[]});
    setPracFocus("scout");setPracXpWeek87("");
    var newOwner=initOwner(RNG.ai);setOwner(newOwner);
    var newMandates=generateMandates(newOwner);setMandates(newMandates);
    var initTrust69={gmTrustByTeam:{},recentTrades:[]};
    t.forEach(function(tm){if(tm.id!==t[idx].id)initTrust69.gmTrustByTeam[tm.id]=50;});
    setTradeState(initTrust69);
    setNews([{text:t[idx].icon+" "+t[idx].city+" "+t[idx].name+" â€” The Franchise is live. Seed: "+leagueSeed,type:"gold",id:U()}]);
    setTab("home");setScreen("league");
    saveG({teams:t,myId:t[idx].id,sched:s,season:{year:2026,week:1,phase:"regular",ledger:[]},fas:f,history:[],seed:leagueSeed,hallOfFame:[]});
    }catch(e){console.error("createLeague error:",e);alert("League creation error: "+e.message);}
  }
  function loadSave2(){var d=loadG();if(!d) return;
    function normalizePlayerSaveFlags93(p){
      if(!p)return;
      if(p.contractDispute===undefined)p.contractDispute=false;else p.contractDispute=!!p.contractDispute;
      if(p.onBlock===undefined)p.onBlock=false;else p.onBlock=!!p.onBlock;
      // v95.9: trait milestone fields â€” backfill for old saves
      if(!p.traitMilestones95||typeof p.traitMilestones95!=="object"||Array.isArray(p.traitMilestones95))p.traitMilestones95={};
      if(!p.traitPowerLevel95||typeof p.traitPowerLevel95!=="object"||Array.isArray(p.traitPowerLevel95))p.traitPowerLevel95={};
      // v95.1: traits95 migration/hardening â€” backfill + sanitize + cap to 3
      var rawTraits95=Array.isArray(p.traits95)?p.traits95.slice():null;
      if(!rawTraits95)rawTraits95=(typeof p.trait==="string"&&p.trait!=="none")?[p.trait]:[];
      rawTraits95=rawTraits95.filter(function(tk,idx,arr){
        return typeof tk==="string"&&tk!=="none"&&!!TRAITS[tk]&&arr.indexOf(tk)===idx;
      }).slice(0,3);
      p.traits95=rawTraits95;
      if(typeof p.trait!=="string"||p.trait==="none"||!TRAITS[p.trait])p.trait=rawTraits95[0]||"none";
      else if(rawTraits95.length===0)p.traits95=[p.trait];
    }
    if(d.teams)(d.teams).forEach(function(t){applyLeagueAlignment97(t);if(t.draftPicks)t.draftPicks.forEach(function(pk){
      if(!pk.year)pk.year=d.season?d.season.year:2026;if(!pk.pid)pk.pid=U();
    });if(!t.practiceSquad)t.practiceSquad=[];});
    if(d.teams)(d.teams).forEach(function(t){
      (t.roster||[]).forEach(function(p){normalizePlayerSaveFlags93(p);STORY_ARC_ENGINE.normalizePlayer(p);if(!p.archetype)p.archetype=PLAYER_ARCHETYPES.classify(p);});
      (t.practiceSquad||[]).forEach(function(p){normalizePlayerSaveFlags93(p);STORY_ARC_ENGINE.normalizePlayer(p);if(!p.archetype)p.archetype=PLAYER_ARCHETYPES.classify(p);});
    });
    if(d.dc)(d.dc).forEach(function(p){normalizePlayerSaveFlags93(p);STORY_ARC_ENGINE.normalizePlayer(p);if(!p.archetype)p.archetype=PLAYER_ARCHETYPES.classify(p);});
    if(d.dc)d.dc.forEach(function(p){
      if(typeof p.scouted==="number"||!p.scouted){
        var old=p.scouted||0;
        p.scouted={measurables:old>=25,interview:old>=50,film:old>=75,complete:old>=100};
      }
    });
    setTeams(d.teams);setMyId(d.myId);setSched(d.sched);
    setSeason(d.season);setFAs(d.fas||[]);setDC(d.dc||[]);setHistory(d.history||[]);if(d.records)setRecords(d.records);
    if(d.txLog)setTxLog(d.txLog);if(d.seed)setSeed(d.seed);
    if(d.hallOfFame)setHallOfFame(d.hallOfFame);
    setDifficulty(d.difficulty||"pro");
    if(d.godMode)setGodMode(true);
    if(d.teams)d.teams.forEach(function(t){
      if(!t.weekLog)t.weekLog=[];
      if(t.franchiseTag973===undefined)t.franchiseTag973=null;
      if(t.ownerMood===undefined)t.ownerMood=70;
      if(!t.ownerGoal)t.ownerGoal="playoff";
      if(!t.aiStrategy)t.aiStrategy="bubble";
      if(!t.reSignNeg84)t.reSignNeg84={};
      if(!t.contractIntelRevealed||typeof t.contractIntelRevealed!=="object"||Array.isArray(t.contractIntelRevealed))t.contractIntelRevealed={};
      // v95.4: Scout Spend persistent flags (legacy-save backfill + type normalization)
      if(t.scoutTrainBoostWeek===undefined||t.scoutTrainBoostWeek===null)t.scoutTrainBoostWeek=null;
      else{
        var _tbw95=Number(t.scoutTrainBoostWeek);
        t.scoutTrainBoostWeek=(_tbw95>=0&&isFinite(_tbw95))?Math.round(_tbw95):null;
      }
      if(t.opponentFilmWeek===undefined||t.opponentFilmWeek===null)t.opponentFilmWeek=null;
      else{
        var _ofw95=Number(t.opponentFilmWeek);
        t.opponentFilmWeek=(_ofw95>=0&&isFinite(_ofw95))?Math.round(_ofw95):null;
      }
      if(t.pipelineBoostYear===undefined||t.pipelineBoostYear===null)t.pipelineBoostYear=null;
      else{
        var _pby95=Number(t.pipelineBoostYear);
        t.pipelineBoostYear=(_pby95>=1900&&isFinite(_pby95))?Math.round(_pby95):null;
      }
      if(!t.faIntelRevealed||typeof t.faIntelRevealed!=="object"||Array.isArray(t.faIntelRevealed))t.faIntelRevealed={};
      if(!t.fitAlertPrefs84)t.fitAlertPrefs84={};
      if(!t.fitAlertProfile85)t.fitAlertProfile85="strict";
      if(!t.rivals)t.rivals=[];
      if(t.rivals)t.rivals.forEach(function(r){if(r.trophy977===undefined)r.trophy977=null;});// v97.7
      if(!t.gameplanOff){
        var old=t.gameplan||"balanced";
        t.gameplanOff=old==="air_raid"?"air_raid":old==="ground_pound"?"ground_pound":"balanced_o";
        t.gameplanDef=old==="blitz_heavy"?"blitz_heavy":old==="prevent"?"prevent":"balanced_d";
      }
      t.roster.forEach(function(p){
        if(!p.devTrait)p.devTrait="normal";
        if(!p.trait)p.trait="none";
        if(!p.careerStats)p.careerStats={gp:0,seasons:0};
        if(p.everReached90===undefined)p.everReached90=(p.ovr||0)>=90;
      });
      (t.practiceSquad||[]).forEach(function(p){if(p.everReached90===undefined)p.everReached90=(p.ovr||0)>=90;});
    });
    (d.fas||[]).forEach(function(p){normalizePlayerSaveFlags93(p);STORY_ARC_ENGINE.normalizePlayer(p);if(p.everReached90===undefined)p.everReached90=(p.ovr||0)>=90;});
    (d.dc||[]).forEach(function(p){normalizePlayerSaveFlags93(p);STORY_ARC_ENGINE.normalizePlayer(p);if(p.everReached90===undefined)p.everReached90=(p.ovr||0)>=90;});
    if((d.saveVersion||0)<35&&d.teams){
      d.teams.forEach(function(t){
        t.roster.forEach(function(p){p.contract=migrateContract(p.contract);});
        t.capUsed=capCalc(t.roster);
        if(!t.deadCapByYear)t.deadCapByYear={};
      });
      if(d.fas)(Array.isArray(d.fas)?d.fas:[]).forEach(function(p){p.contract=migrateContract(p.contract);});
      d.saveVersion=35;
      setTeams(d.teams);if(d.fas)setFAs(d.fas);
      addN("ðŸ’° Save migrated to v35 â€” The Iron Bank is open! Contracts converted.","gold");
    }
    if((d.saveVersion||0)<36&&d.teams){
      d.teams.forEach(function(t){
        if(!t.scouts||!t.scouts.length)t.scouts=[genScout(),genScout(),genScout()];
        if(!t.ownerSpendRate)t.ownerSpendRate=Math.round((0.85+RNG.ai()*0.3)*100)/100;
        t.roster.forEach(function(p){
          if(!p.trueOvr)p.trueOvr=p.ovr;
          if(!p.scouting)p.scouting=initScoutState(true,p.age<=23);
          if(p.contract&&p.contract.baseSalary!==undefined)p.contract.salary=v36_capHit(p.contract);
        });
        t.capUsed=capCalc(t.roster);
      });
      if(d.fas)(Array.isArray(d.fas)?d.fas:[]).forEach(function(p){
        if(!p.trueOvr)p.trueOvr=p.ovr;
        if(!p.scouting)p.scouting=initScoutState(false,p.age<=23);
        p.scouting.confidence=0.4;// FAs are somewhat known
      });
      if(d.dc)(Array.isArray(d.dc)?d.dc:[]).forEach(function(p){
        if(!p.trueOvr)p.trueOvr=p.ovr;
        if(!p.scouting)p.scouting=initScoutState(false,true);// draft prospects
        if(!p.scoutRange)p.scoutRange={min:Math.max(40,p.hypeOvr-15),max:Math.min(99,p.hypeOvr+15),est:p.hypeOvr,tier:"blind"};
      });
      d.saveVersion=36;
      setTeams(d.teams);if(d.fas)setFAs(d.fas);if(d.dc)setDC(d.dc);
      addN("ðŸ¦ Save migrated to v36 â€” Iron Bank upgraded! Scouts hired, fog of war enabled.","gold");
    }
    if((d.saveVersion||0)<38&&d.teams){
      d.teams.forEach(function(t){
        if(t.staff){
          [t.staff.hc,t.staff.oc,t.staff.dc].forEach(function(c){
            if(c&&!c.traits){
              var pool=ARCH_TRAIT_POOLS[c.arch]||["DISCIPLINE"];
              c.traits=[pool[rng(0,pool.length-1)]];
              if(!c.reputation)c.reputation=rng(30,80);
              if(!c.hot)c.hot=rng(10,50);
            }
          });
        }
      });
      d.saveVersion=38;
      setTeams(d.teams);
      addN("ðŸŽ© Save migrated to v38 â€” Coaching Traits unlocked! Check your Staff tab.","gold");
    }
    if((d.saveVersion||0)<39&&d.teams){
      d.teams.forEach(function(t){
        if(t.staff){
          [t.staff.hc,t.staff.oc,t.staff.dc].forEach(function(c){
            if(c&&!c.xp){
              c.xp=0;c.level=1;c.mood=70;
              c.yearsLeft=c.contract||rng(1,3);
              c.history={wins:0,losses:0,playoffWins:0,rings:0,seasons:0};
            }
          });
        }
      });
      d.saveVersion=39;
      setTeams(d.teams);
      addN("ðŸ“ˆ Save migrated to v39 â€” Coaches now level up! Check Staff tab.","gold");
    }
    if((d.saveVersion||0)<40){
      d.saveVersion=40;
      if(DB.ready){
        var raw40=JSON.stringify(d);
        var comp40="LZW1:"+LZW.compress(raw40);
        DB.write("saves",{id:"autosave",data:comp40,timestamp:Date.now(),version:40}).catch(function(){});
      }
      addN("ðŸ›ï¸ Save migrated to v40 â€” The Vault is open!"+(DB.ready?" (IndexedDB active)":""),"gold");
    }
    if((d.saveVersion||0)<41&&d.teams){
      d.teams.forEach(function(t){
        (t.roster||[]).concat(t.practiceSquad||[]).forEach(function(p){
          if(p.cliqueId===undefined)p.cliqueId=p.age>=28?0:p.age<=23?1:2;
          if(p.chemistry===undefined)p.chemistry=cl(60+rng(-10,10),30,100);
          if(p.systemFit===undefined)p.systemFit=rng(30,60);
        });
      });
      d.saveVersion=41;
      addN("ðŸ‘¥ Save migrated to v41 â€” Locker Room Cliques + System Knowledge active!","gold");
    }
    if((d.saveVersion||0)<42&&d.teams){
      d.teams.forEach(function(t){
        (t.roster||[]).concat(t.practiceSquad||[]).forEach(function(p){
          if(p.chemistry===undefined)p.chemistry=cl(60+rng(-10,10),30,100);
          if(p.systemFit===undefined)p.systemFit=rng(30,60);
          if(p.cliqueId===undefined)p.cliqueId=p.age>=28?0:p.age<=23?1:(p.ovr>=80?2:1);
        });
      });
      d.saveVersion=42;
      addN("âš¡ Save migrated to v42 â€” Consequence Engine active! Clique consequences + Fix Menus + SystemFit v2","gold");
    }
    if((d.saveVersion||0)<43){
      d.saveVersion=43;
      addN("ðŸ“– Save migrated to v43 â€” Story Engine active! Locker Room Events + Scheme Change Preview + Vault UX","gold");
    }
    if((d.saveVersion||0)<44){
      if(!d.season.rivalries)d.season.rivalries={};
      d.teams.forEach(function(t){
        t.roster.forEach(function(p){if(!p)return;if(p.contractDispute===undefined)p.contractDispute=false;if(p.onBlock===undefined)p.onBlock=false;});
        if(t.lastMargin===undefined)t.lastMargin=0;
        if(t.lastEvent===undefined)t.lastEvent="";
      });
      d.saveVersion=44;
      addN("ðŸ”¥ Save migrated to v44 â€” Dynasty Stories active! Rivalries + Scheme Fit Grades + Event Chains + Fix Tracking","gold");
    }
    if((d.saveVersion||0)<45){
      if(d.season.rivalries){
        Object.keys(d.season.rivalries).forEach(function(k){
          var r=d.season.rivalries[k];
          if(!r.meetings)r.meetings=[];
          if(r.seriesA===undefined)r.seriesA=0;
          if(r.seriesB===undefined)r.seriesB=0;
        });
      }
      d.teams.forEach(function(t){if(t.discipline===undefined)t.discipline=50;});
      d.saveVersion=45;
      addN("ðŸ“– Save migrated to v45 â€” The Almanac active! Dynasty Tracker + Choice Events + Graduated Rivalries + Import Repair","gold");
    }
    if((d.saveVersion||0)<46){
      d.teams.forEach(function(t){
        if(t.discipline===undefined)t.discipline=50;
        t.roster.forEach(function(p){if(!p.role)p.role="";});
        assignDefaultRoles(t.roster);
      });
      d.saveVersion=46;
      addN("ðŸ”¥ Save migrated to v46 â€” Hate Week active! Roles + Dynasty Index + Highlights + Evidence Citations","gold");
    }
    if((d.saveVersion||0)<47){
      if(d.season.rivalries){
        Object.keys(d.season.rivalries).forEach(function(k){
          if(!d.season.rivalries[k].moments)d.season.rivalries[k].moments=[];
        });
      }
      d.saveVersion=47;
      addN("ðŸ“œ Save migrated to v47 â€” Era Cards active! Drill-down + Rivalry Moments + Dev-Role Coupling","gold");
    }
    if((d.saveVersion||0)<48){
      d.teams.forEach(function(t){
        t.roster.forEach(function(p){if(p.roleWeeks===undefined)p.roleWeeks=0;});
      });
      if(d.season.rivalries){
        Object.keys(d.season.rivalries).forEach(function(k){
          var r=d.season.rivalries[k];
          if(r.moments)r.moments.forEach(function(m){if(!m.gravity)m.gravity=MOMENT_GRAVITY[m.type]||1;});
        });
      }
      d.saveVersion=48;
      addN("ðŸ” Save migrated to v48 â€” Glass Box v2! Era Cards v2 + Drill-Down v2 + Moment Gravity + Dev Guardrails","gold");
    }
    if((d.saveVersion||0)<49){
      d.teams.forEach(function(t){
        t.roster.forEach(function(p){if(p.roleWeeks===undefined)p.roleWeeks=0;});
      });
      d.saveVersion=49;
      addN("ðŸ›ï¸ Save migrated to v49 â€” Hall of Seasons + What Changed? + Rivalry Broadcast + Snap Realism + Golden Seed","gold");
    }
    if((d.saveVersion||0)<50){
      d.teams.forEach(function(t){
        t.roster.forEach(function(p){if(p.weeklyFatigue===undefined)p.weeklyFatigue=0;});
      });
      d.saveVersion=50;
      addN("ðŸ›ï¸ Save migrated to v50 â€” Hall Plaques + Confidence Deltas + Actionable Keys + 4Q Injury Risk","gold");
    }
    if((d.saveVersion||0)<51){
      d.saveVersion=51;
      addN("ðŸ§¾ Save migrated to v51 â€” Receipts Mode + Rivalry Ladder + Fuel Events + GM Macros + Identity Tags","gold");
    }
    if((d.saveVersion||0)<52){
      d.saveVersion=52;
      addN("ðŸ” Save migrated to v52 â€” Seed Purity + GM Macros Wired + Receipts v2 + Museum Compression + Trust Panel","gold");
    }
    if((d.saveVersion||0)<53){
      d.saveVersion=53;
      if(!d.dna)d.dna=DEFAULT_DNA;
      addN("ðŸ“– Save migrated to v53 â€” Strategy Engine + Counterfactuals + Era Storylines + League DNA + Save Integrity","gold");
    }
    if(d.dna){setLeagueDNA(d.dna);DNA_ACTIVE=d.dna;}
    var intCheck=validateSaveChecksum(d);
    if(!intCheck.valid){addN(intCheck.msg,"red");}
    if((d.saveVersion||0)<54){
      d.saveVersion=54;
      if(!d.owner)d.owner=initOwner(function(){return 0.5;});// Default to middle archetype
      addN("ðŸ“º Save migrated to v54 â€” Broadcast Recap + Stats Leaders + Front Office + GM Macro v2 + DNA Presets","gold");
    }
    if(d.owner)setOwner(d.owner);
    if((d.saveVersion||0)<55){
      d.saveVersion=55;
      if(d.owner&&!d.mandates)d.mandates=generateMandates(d.owner);
      addN("ðŸ“° Save migrated to v55 â€” Broadcast v2 + Owner Mandates + Franchise Records + Milestones + Leaders Cache","gold");
    }
    if(d.mandates)setMandates(d.mandates);
    if((d.saveVersion||0)<56){
      d.saveVersion=56;
      addN("ðŸ“° Save migrated to v56 â€” Coaching Tree + Owner Events + Deadline Show + Awards + Timeline","gold");
    }
    if(d.coachTree)COACHING_TREE_LOG=d.coachTree;
    if(d.seasonAwards)setSeasonAwards(d.seasonAwards);
    if((d.saveVersion||0)<57){
      d.saveVersion=57;
      addN("ðŸŽ­ Save migrated to v57 â€” Draft Night Show + Award History + Trophy Names + Coach Legacy + DNA Report","gold");
    }
    if(d.trophyNames)setTrophyNames(d.trophyNames);
    if(d.awardHistory)AWARD_HISTORY_LOG=d.awardHistory;
    if(d.coachLegacy)COACH_LEGACY_LOG=d.coachLegacy;
    if(d.ringOfHonor)RING_OF_HONOR_LOG=d.ringOfHonor;// v60: Load Ring of Honor
    if(d.hallOfFameLog)HALL_OF_FAME_LOG=d.hallOfFameLog;// v61: Load Hall of Fame
    if(d.broadcastSeq)BROADCAST_SEQ=d.broadcastSeq;// v62: Restore sequence counter
    if(d.captainId)setCaptainId(d.captainId);
    if(d.captMoments)setCaptMoments(d.captMoments);
    if(d.pracFocus)setPracFocus(d.pracFocus);else setPracFocus("scout");
    if(d.pracXpWeek87)setPracXpWeek87(d.pracXpWeek87);else setPracXpWeek87("");
    if(d.userPlaylist&&d.userPlaylist.length)setUserPlaylist(d.userPlaylist);if(d.gamedayTrack)setGamedayTrack(d.gamedayTrack);
    if(d.scoutDB)setScoutDB(d.scoutDB);
    if(d.mediaState)setMediaState(d.mediaState);
    if(d.prospectDB)setProspectDB(d.prospectDB);
    if(d.coachClinic)setCoachClinic(d.coachClinic);
    if(d.tradeState)setTradeState(d.tradeState);
    if(d.frontOffice78)setFrontOffice78(d.frontOffice78);
    if(d.draftShortlist79)setDraftShortlist79(d.draftShortlist79);
    if(d.warRoomFlags79)setWarRoomFlags79(d.warRoomFlags79);
    if(d.mfsnGradeHistory80)setMfsnGradeHistory80(d.mfsnGradeHistory80);
    if(d.breakouts80)setBreakouts80(d.breakouts80);
    if(d.mentorships80)setMentorships80(d.mentorships80);
    if(d.defMoments80)setDefMoments80(d.defMoments80);
    if(typeof d.ownerPatience80==="number")setOwnerPatience80(d.ownerPatience80);
    if(d.offseasonNews80)setOffseasonNews80(d.offseasonNews80);
    if(d.seasonPreds80)setSeasonPreds80(d.seasonPreds80);
    if(d.mfsnDraftGrade80)setMfsnDraftGrade80(d.mfsnDraftGrade80);
    if(d.holdoutStages80)setHoldoutStages80(d.holdoutStages80);
    if(d.scoutBudget81)setScoutBudget81(d.scoutBudget81);
    if(d.staffPoachTargets81)setStaffPoachTargets81(d.staffPoachTargets81);
    if(d.ownerMeeting81)setOwnerMeeting81(d.ownerMeeting81);
    if(d.ownerPenalty81)setOwnerPenalty81(d.ownerPenalty81);
    if(d.ultimatumDeadline81)setUltimatumDeadline81(d.ultimatumDeadline81);
    if(d.coachSkillTree81)setCoachSkillTree81(d.coachSkillTree81);
    if(d.offseasonEvents81)setOffseasonEvents81(d.offseasonEvents81);
    if(d.prHistory81)setPrHistory81(d.prHistory81);
    if(d.faBids82)setFaBids82(d.faBids82);
    if(d.faPhase82)setFaPhase82(d.faPhase82);
    if(typeof d.faRound82==="number")setFaRound82(d.faRound82);
    if(d.faVisits82)setFaVisits82(d.faVisits82);
    if(d.faRFA82)setFaRFA82(d.faRFA82);
    if(d.faSignings82)setFaSignings82(d.faSignings82);
    if(d.posBattles974)setPosBattles974(d.posBattles974);else setPosBattles974([]);
    if(d.draftHistory98)setDraftHistory98(d.draftHistory98);else setDraftHistory98([]);
    // v98.6 load
    if(d.powerRankings986)setPowerRankings986(d.powerRankings986);
    if(d.gmRep986)setGmRep986(d.gmRep986);
    if(d.timeline986)setTimeline986(d.timeline986);
    if(d.compPicks986)setCompPicks986(d.compPicks986);
    if(d.rivalTrophies986)setRivalTrophies986(d.rivalTrophies986);
    if(d.prevRankings986)setPrevRankings986(d.prevRankings986);
    (d.teams||[]).forEach(function(t){if(!t.posCoaches)initPosCoaches(t,RNG.ai);});
    if((d.saveVersion||0)<58){
      d.saveVersion=58;
      addN("ðŸŽª Save migrated to v58 â€” FA Frenzy + Draft Preview + Rivalry Game Day + Cap Viz v2","gold");
    }
    if((d.saveVersion||0)<59){
      d.saveVersion=59;
      addN("ðŸŽ¬ Save migrated to v59 â€” Career Pages + FA Bidding Wars + Owner Personality + Awards Ceremony v2","gold");
    }
    if((d.saveVersion||0)<60){
      d.saveVersion=60;
      addN("ðŸŽ–ï¸ Save migrated to v60 â€” Fog of War v2 + Coaching Staff + Trade Evaluator + Ring of Honor","gold");
    }
    if((d.saveVersion||0)<61){
      d.saveVersion=61;
      addN("ðŸŒ Save migrated to v61 â€” Weather Engine + Hall of Fame + Cap Fix Assistant","gold");
    }
    if((d.saveVersion||0)<62){
      d.saveVersion=62;
      addN("ðŸŽ¥ Save migrated to v62 â€” Film Room + Agent Personalities + Trust Fixes","gold");
    }
    if((d.saveVersion||0)<63){
      d.saveVersion=63;
      if(d.fas){var migRng=mulberry32(12345);d.fas.forEach(function(p){if(!p.agentType)p.agentType=assignAgentType(p,migRng);});}
      addN("âš¡ Save migrated to v63 â€” Halftime Adjustments + Injury Report + Agent FA Wiring","gold");
    }
    if((d.saveVersion||0)<64){
      d.saveVersion=64;
      addN("ðŸ‹ï¸ Save migrated to v64 â€” Gameplan Lab + Practice Focus + Captain Moments","gold");
    }
    if((d.saveVersion||0)<65){
      d.saveVersion=65;
      addN("ðŸŽ™ï¸ Save migrated to v65 â€” Scout Reports + Press Conference + Weekly Headlines","gold");
    }
    if((d.saveVersion||0)<66){
      d.saveVersion=66;
      addN("ðŸ“‚ Save migrated to v66 â€” Scout Dossier + Media Persona + Rivalry Heat Math","gold");
    }
    if((d.saveVersion||0)<67){
      d.saveVersion=67;
      addN("ðŸ“š Save migrated to v67 â€” Prospect Dossier + Context Credibility + Coach Clinic","gold");
    }
    if((d.saveVersion||0)<68){
      d.saveVersion=68;
      if(d.coachClinic&&!d.coachClinic.perkStats)d.coachClinic.perkStats={};
      addN("ðŸ¥ Save migrated to v68 â€” Coach Clinic perks now wired to gameplay!","gold");
    }
    if((d.saveVersion||0)<69){
      d.saveVersion=69;
      if(!d.tradeState)d.tradeState={gmTrustByTeam:{},recentTrades:[]};
      if(!d.tradeState.gmTrustByTeam)d.tradeState.gmTrustByTeam={};
      (d.teams||[]).forEach(function(t){if(!t.isUser&&!d.tradeState.gmTrustByTeam[t.id])d.tradeState.gmTrustByTeam[t.id]=50;});
      var yr69=(d.season&&d.season.year)||2026;
      if(d.scoutDB){var r69=DB_CLEANER.prune(d.scoutDB,yr69,2);d.scoutDB=r69.db;if(r69.pruned>0)addN("ðŸ§¹ Pruned "+r69.pruned+" stale opponent dossiers","dim");}
      if(d.prospectDB){var r69b=DB_CLEANER.prune(d.prospectDB,yr69,3);d.prospectDB=r69b.db;if(r69b.pruned>0)addN("ðŸ§¹ Pruned "+r69b.pruned+" stale prospect dossiers","dim");}
      var migrated69=0;
      var migrateRatings69=function(player){
        if(!player||!player.pos||!player.ratings)return;
        var def=POS_DEF[player.pos];if(!def)return;
        var existing=player.ratings;var baseVal=player.ovr||60;
        var changed=false;
        def.r.forEach(function(r,i){
          if(existing[r]===undefined||existing[r]===null){
            changed=true;
            var w=def.w[i]||3;
            var anchor=baseVal;
            if(r==="acceleration"&&existing.speed)anchor=existing.speed+rng(-5,3);
            else if(r==="agility"&&existing.speed)anchor=existing.speed+rng(-6,2);
            else if(r==="strength"&&existing.power)anchor=existing.power+rng(-3,3);
            else if(r==="strength"&&existing.toughness)anchor=existing.toughness+rng(-3,5);
            else if(r==="stamina")anchor=baseVal+rng(-5,8);
            else if(r==="toughness"&&existing.strength)anchor=existing.strength+rng(-4,4);
            else if(r==="playRecognition"&&existing.awareness)anchor=existing.awareness+rng(-5,3);
            else if(r==="clutch")anchor=baseVal+rng(-10,10);
            else if(r==="shortAccuracy"&&existing.accuracy)anchor=existing.accuracy+rng(-3,5);
            else if(r==="deepAccuracy"&&existing.accuracy)anchor=existing.accuracy+rng(-8,2);
            else if(r==="throwOnRun"&&existing.accuracy)anchor=existing.accuracy+rng(-10,0);
            else if(r==="pocketPresence"&&existing.awareness)anchor=existing.awareness+rng(-3,5);
            else if(r==="ballCarrierVision"&&existing.elusiveness)anchor=existing.elusiveness+rng(-3,5);
            else if(r==="breakTackle"&&existing.power)anchor=existing.power+rng(-5,3);
            else if(r==="truckPower"&&existing.power)anchor=existing.power+rng(-3,5);
            else if(r==="catchInTraffic"&&existing.catching)anchor=existing.catching+rng(-5,3);
            else if(r==="spectacularCatch"&&existing.catching)anchor=existing.catching+rng(-8,5);
            else if(r==="separation"&&existing.routeRunning)anchor=existing.routeRunning+rng(-3,5);
            else if(r==="zoneCoverage"&&existing.coverage)anchor=existing.coverage+rng(-3,5);
            else if(r==="manCoverage"&&existing.coverage)anchor=existing.coverage+rng(-5,3);
            else if(r==="blockShedding"&&existing.passRush)anchor=existing.passRush+rng(-5,3);
            else if(r==="pursuit"&&existing.speed)anchor=existing.speed+rng(-3,5);
            else if(r==="powerMoves"&&existing.passRush)anchor=existing.passRush+rng(-3,5);
            else if(r==="finesseMoves"&&existing.passRush)anchor=existing.passRush+rng(-5,5);
            else if(r==="passBlockFinesse"&&existing.passBlock)anchor=existing.passBlock+rng(-3,5);
            else if(r==="anchorStrength"&&existing.strength)anchor=existing.strength+rng(-3,5);
            else if(r==="hitPower"&&existing.tackling)anchor=(existing.tackling||existing.tackle||50)+rng(-3,8);
            else if(r==="rangeAbility"&&existing.speed)anchor=existing.speed+rng(-5,3);
            else{anchor=baseVal+rng(w>=6?-5:w>=3?-8:-12,w>=6?5:w>=3?3:6);}
            existing[r]=cl(anchor,40,99);
          }
        });
        if(changed){player.ovr=calcOvr(player);migrated69++;}
      };
      (d.teams||[]).forEach(function(t){
        (t.roster||[]).forEach(migrateRatings69);
        (t.practiceSquad||[]).forEach(migrateRatings69);
      });
      (d.fas||[]).forEach(migrateRatings69);
      (d.dc||[]).forEach(migrateRatings69);
      if(migrated69>0)addN("ðŸ“Š Expanded "+migrated69+" players to 20 attributes each!","gold");
      addN("ðŸ¤ Save migrated to v69 â€” GM Trust + Verify 2.0 + 20 Attributes + DB Pruning!","gold");
    }
    if((d.saveVersion||0)<70){
      d.saveVersion=70;
      var migrated70=0;
      var migrateRatings70=function(player){
        if(!player||!player.pos||!player.ratings)return;
        var def=POS_DEF[player.pos];if(!def)return;
        var existing=player.ratings;var baseVal=player.ovr||60;
        var changed=false;
        def.r.forEach(function(r,i){
          if(existing[r]===undefined||existing[r]===null){
            changed=true;
            var w=def.w[i]||3;
            var anchor=baseVal;
            if(r==="acceleration"&&existing.speed)anchor=existing.speed+rng(-5,3);
            else if(r==="agility"&&existing.speed)anchor=existing.speed+rng(-6,2);
            else if(r==="strength"&&existing.power)anchor=existing.power+rng(-3,3);
            else if(r==="strength"&&existing.toughness)anchor=existing.toughness+rng(-3,5);
            else if(r==="stamina")anchor=baseVal+rng(-5,8);
            else if(r==="toughness"&&existing.strength)anchor=existing.strength+rng(-4,4);
            else if(r==="playRecognition"&&existing.awareness)anchor=existing.awareness+rng(-5,3);
            else if(r==="clutch")anchor=baseVal+rng(-10,10);
            else if(r==="shortAccuracy"&&existing.accuracy)anchor=existing.accuracy+rng(-3,5);
            else if(r==="deepAccuracy"&&existing.accuracy)anchor=existing.accuracy+rng(-8,2);
            else if(r==="throwOnRun"&&existing.accuracy)anchor=existing.accuracy+rng(-10,0);
            else if(r==="pocketPresence"&&existing.awareness)anchor=existing.awareness+rng(-3,5);
            else if(r==="ballCarrierVision"&&existing.elusiveness)anchor=existing.elusiveness+rng(-3,5);
            else if(r==="breakTackle"&&existing.power)anchor=existing.power+rng(-5,3);
            else if(r==="truckPower"&&existing.power)anchor=existing.power+rng(-3,5);
            else if(r==="catchInTraffic"&&existing.catching)anchor=existing.catching+rng(-5,3);
            else if(r==="spectacularCatch"&&existing.catching)anchor=existing.catching+rng(-8,5);
            else if(r==="separation"&&existing.routeRunning)anchor=existing.routeRunning+rng(-3,5);
            else if(r==="zoneCoverage"&&existing.coverage)anchor=existing.coverage+rng(-3,5);
            else if(r==="manCoverage"&&existing.coverage)anchor=existing.coverage+rng(-5,3);
            else if(r==="blockShedding"&&existing.passRush)anchor=existing.passRush+rng(-5,3);
            else if(r==="pursuit"&&existing.speed)anchor=existing.speed+rng(-3,5);
            else if(r==="powerMoves"&&existing.passRush)anchor=existing.passRush+rng(-3,5);
            else if(r==="finesseMoves"&&existing.passRush)anchor=existing.passRush+rng(-5,5);
            else if(r==="passBlockFinesse"&&existing.passBlock)anchor=existing.passBlock+rng(-3,5);
            else if(r==="anchorStrength"&&existing.strength)anchor=existing.strength+rng(-3,5);
            else if(r==="hitPower"&&existing.tackling)anchor=(existing.tackling||existing.tackle||50)+rng(-3,8);
            else if(r==="rangeAbility"&&existing.speed)anchor=existing.speed+rng(-5,3);
            else{anchor=baseVal+rng(w>=6?-5:w>=3?-8:-12,w>=6?5:w>=3?3:6);}
            existing[r]=cl(anchor,40,99);
          }
        });
        if(changed){player.ovr=calcOvr(player);migrated70++;}
      };
      (d.teams||[]).forEach(function(t){
        (t.roster||[]).forEach(migrateRatings70);
        (t.practiceSquad||[]).forEach(migrateRatings70);
      });
      (d.fas||[]).forEach(migrateRatings70);
      (d.dc||[]).forEach(migrateRatings70);
      if(migrated70>0)addN("ðŸ“Š v70: Expanded "+migrated70+" players to 20 attributes each!","gold");
      else addN("ðŸ“Š v70: All "+((d.teams||[]).reduce(function(a,t){return a+(t.roster||[]).length;},0))+" players already have 20 attributes!","dim");
    }
    if((d.saveVersion||0)<71){
      d.saveVersion=71;
      var arch71=0;
      var assignArch71=function(p){
        if(!p||!p.pos)return;
        if(!p.archetype){p.archetype=PLAYER_ARCHETYPES.classify(p);if(p.archetype)arch71++;}
      };
      (d.teams||[]).forEach(function(t){
        (t.roster||[]).forEach(assignArch71);
        (t.practiceSquad||[]).forEach(assignArch71);
      });
      (d.fas||[]).forEach(assignArch71);
      (d.dc||[]).forEach(assignArch71);
      if(d.tradeState&&d.tradeState.gmTrustByTeam){
        var snap71=TRUST.leagueSnapshot(d.tradeState,d.teams||[]);
        if(snap71)d.tradeState.lastSeasonTrustAvg=snap71.avgTrust;
      }
      if(arch71>0)addN("ðŸ·ï¸ v71: Classified "+arch71+" players with archetypes!","gold");
      addN("ðŸˆ Save migrated to v71 â€” Archetypes + Fumbles + Sim-Cull + Trust Trends!","gold");
    }
    if((d.saveVersion||0)<73){
      d.saveVersion=73;
      var voidMig73=0;
      var migContract73=function(p){
        if(p&&p.contract&&p.contract.baseSalary!==undefined){
          if(p.contract.voidYears===undefined){p.contract.voidYears=0;voidMig73++;}
        }
      };
      (d.teams||[]).forEach(function(t){
        (t.roster||[]).forEach(migContract73);
        (t.practiceSquad||[]).forEach(migContract73);
      });
      (d.fas||[]).forEach(migContract73);
      addN("ðŸˆ Save migrated to v73 â€” Void Years + Restructure Cascade + Comp Picks!","gold");
    }
    if((d.saveVersion||0)<74){
      d.saveVersion=74;
      var arc74=0;
      (d.teams||[]).forEach(function(t){
        (t.roster||[]).forEach(function(p){
          if(p.careerStats&&!p.careerStats.ovrHistory){
            p.careerStats.ovrHistory=[p.ovr];// Seed with current OVR as starting point
            arc74++;
          }
        });
      });
      if(arc74>0)addN("ðŸ“ˆ v74: Initialized career arc tracking for "+arc74+" players!","cyan");
      addN("ðŸˆ Save migrated to v74 â€” Career Arcs + Pro Bowl Game + Roster Intelligence + GM Intel!","gold");
    }
    if((d.saveVersion||0)<75){
      d.saveVersion=75;
      var spec75Count=0;
      (d.teams||[]).forEach(function(t){
        if(t.staff&&t.staff.oc&&!t.staff.oc.specialty75){
          assignCoordSpecialty(t.staff.oc,"OC");spec75Count++;
        }
        if(t.staff&&t.staff.dc&&!t.staff.dc.specialty75){
          assignCoordSpecialty(t.staff.dc,"DC");spec75Count++;
        }
        (t.roster||[]).forEach(function(p){if(p.holdout75)delete p.holdout75;});
      });
      if(d.dc){
        (d.dc).forEach(function(p){
          if(!p.character75){
            var tier75=(p.ovr||50)>=80?"star":(p.ovr||50)>=70?"good":(p.ovr||50)>=60?"avg":"bad";
            p.character75=PROSPECT_CHARACTER.assign(p,tier75);
          }
        });
      }
      addN("ðŸˆ Save migrated to v75 â€” Draft Intel V2 + Coordinator Specialties + Holdouts + Revenge Games + All-Time Records!","gold");
    }
    if((d.saveVersion||0)<76){
      d.saveVersion=76;
      var flex76Count=0;
      (d.teams||[]).forEach(function(t){
        (t.roster||[]).forEach(function(p){
          if(!p.flexPos76){
            p.flexPos76=FLEX_POSITIONS.assign(p);
            if(p.flexPos76)flex76Count++;
          }
          if(p._milestone76)delete p._milestone76;
        });
      });
      if(d.dc){
        (d.dc).forEach(function(p){
          if(!p.flexPos76)p.flexPos76=FLEX_POSITIONS.assign(p);
        });
      }
      addN("ðŸˆ Save migrated to v76 â€” Milestones + Trade Deadline Frenzy + Flex Positions ("+(flex76Count)+" assigned) + Practice Reports + UDFA Mini-Game + Division Tracker!","gold");
    }
    if((d.saveVersion||0)<77){
      d.saveVersion=77;
      (d.teams||[]).forEach(function(t){
        if(t.staff){
          if(t.staff.hc&&!t.staff.hc.seatTemp77)t.staff.hc.seatTemp77=20;
          if(t.staff.oc&&!t.staff.oc.seatTemp77)t.staff.oc.seatTemp77=20;
          if(t.staff.dc&&!t.staff.dc.seatTemp77)t.staff.dc.seatTemp77=20;
        }
      });
      addN("ðŸˆ Save migrated to v77 â€” Film Room Breakdown + Hot Seat Meter + Holdout Negotiations + AI Roster Moves Ticker + Game Plan Builder + Power Rankings Show!","gold");
    }
    if((d.saveVersion||0)<78){
      d.saveVersion=78;
      if(d.dc&&d.dc.length>0){
        SCOUT_NETWORK.assignRegions(d.dc);
      }
      if(!d.frontOffice78)d.frontOffice78=[];
      addN("ðŸˆ Save migrated to v78 â€” Advanced Analytics + Scout Network + Primetime Games + Training Room + Front Office + Weekly Challenges + News Ticker!","gold");
    }
    if((d.saveVersion||0)<80){
      d.saveVersion=80;
      addN("ðŸ† Save migrated to v80 â€” Dynasty Experience: Owner Patience, MFSN Grades, Breakout Watch, Mentor/ProtÃ©gÃ©, Records Wall, Holdout Ladder, Defining Moments, Offseason News!","gold");
    }
    if((d.saveVersion||0)<81){
      d.saveVersion=81;
      addN("ðŸŽ¯ Save migrated to v81 â€” Coach Skill Trees, Scout Budgets, Staff Poaching, Owner Mandates, Offseason Events, Restructure Center, Power Rankings v2, Dynasty Timeline v2, Mentor UI v2, Draft Grade Screen, Gameday DJ, Breakout Tracker!","gold");
    }
    if((d.saveVersion||0)<82){
      d.saveVersion=82;
      (d.teams||[]).forEach(function(t){(t.roster||[]).forEach(function(p){if(!p.teamTenure)p.teamTenure=Math.max(1,(p.careerStats&&p.careerStats.seasons)||1);});});
      addN("ðŸª Save migrated to v82 â€” FA Overhaul: Multi-Round Bidding, Contract Pitches, RFA, Visits, Market Value, Loyalty!","gold");
    }
    if((d.saveVersion||0)<83){
      d.saveVersion=83;
      var addPers83=function(p){if(p&&!p.personality)p.personality=generatePersonality(p.pos||"WR",p.age||25,p.devTrait||"normal");};
      (d.teams||[]).forEach(function(t){(t.roster||[]).forEach(addPers83);(t.practiceSquad||[]).forEach(addPers83);});
      (d.fas||[]).forEach(addPers83);(d.dc||[]).forEach(addPers83);
      addN("ðŸ§  Save migrated to v83 â€” Personality Traits: Work Ethic, Loyalty, Greed, Clutch, Ambition for every player!","gold");
    }
    if((d.saveVersion||0)<84){
      d.saveVersion=84;
      (d.teams||[]).forEach(function(t){
        if(!t.reSignNeg84)t.reSignNeg84={};
        if(!t.fitAlertPrefs84)t.fitAlertPrefs84={};
        if(!t.fitAlertProfile85)t.fitAlertProfile85="strict";
      });
      addN("ðŸ§­ Save migrated to v84 â€” Fit Forecast + Re-Sign Negotiations + Alert Controls.","gold");
    }
    if((d.saveVersion||0)<86){
      d.saveVersion=86;
      (d.teams||[]).forEach(function(t){
        if(!t.fitAlertProfile85)t.fitAlertProfile85="strict";
        if(!t.fitAlertPrefs84)t.fitAlertPrefs84={};
      });
      addN("ðŸš¨ Save migrated to v86 â€” Alert Profiles + Positional Holdout Market + Scout Budget Rebalance + New Schemes.","gold");
    }
    if((d.saveVersion||0)<87){
      d.saveVersion=87;
      (d.teams||[]).forEach(function(t){
        (t.roster||[]).forEach(function(p){if(p.everReached90===undefined)p.everReached90=(p.ovr||0)>=90;});
        (t.practiceSquad||[]).forEach(function(p){if(p.everReached90===undefined)p.everReached90=(p.ovr||0)>=90;});
      });
      (d.fas||[]).forEach(function(p){if(p.everReached90===undefined)p.everReached90=(p.ovr||0)>=90;});
      (d.dc||[]).forEach(function(p){if(p.everReached90===undefined)p.everReached90=(p.ovr||0)>=90;});
      addN("ðŸŽ™ï¸ Save migrated to v87 â€” Scheme press narratives, story beats, and matchup intelligence are live.","gold");
    }
    if((d.saveVersion||0)<88){
      d.saveVersion=88;
      addN("ðŸ” Save migrated to v88 â€” Scout confidence ceiling + draft reveal moments are live.","gold");
    }
    if((d.saveVersion||0)<89){
      d.saveVersion=89;
      addN("ðŸ“‹ Save migrated to v89 â€” Scout report cards, rival draft tension, and Draft Night commentary are live.","gold");
    }
    if((d.saveVersion||0)<90){
      d.saveVersion=90;
      (d.teams||[]).forEach(function(t){ensureTeamGMArchetype90(t);});
      addN("ðŸ§  Save migrated to v90 â€” AI GM archetypes now shape draft and free agency behavior.","gold");
    }
    if((d.saveVersion||0)<91){
      d.saveVersion=91;
      (d.teams||[]).forEach(function(t){if(!t._oppIntel91)t._oppIntel91={};});
      addN("ðŸ† Save migrated to v91 â€” Legacy Score, Opponent Scouting Intel, and GM Archetype rivalry news are live.","gold");
    }
    if((d.saveVersion||0)<92){
      d.saveVersion=92;
      (d.teams||[]).forEach(function(t){
        (t.roster||[]).forEach(function(p){
          if(p&&p.injury&&p.injury.games>0&&typeof p._trueInjuryWeeks!=="number")p._trueInjuryWeeks=p.injury.games;
        });
      });
      addN("ðŸ“ž Save migrated to v92 â€” Contract Intel, AI GM trade personalities, and injury uncertainty are live.","gold");
    }
    if((d.saveVersion||0)<93){
      d.saveVersion=93;
      addN("ðŸŽ™ï¸ Save migrated to v94 â€” Hall of Fame induction speeches, live broadcast commentary, GM trade personality pitches, and Practice Star system are live.","gold");
    }
    if((d.saveVersion||0)<97){
      (d.teams||[]).forEach(function(t){
        if(typeof applyLeagueAlignment97==="function")applyLeagueAlignment97(t);
      });
      d.saveVersion=97;
      addN("ðŸŸï¸ v97: 30-Team League Expansion!","gold");
    }
    if((d.saveVersion||0)<98){
      d.saveVersion=98;
      addN("ðŸˆ v98: Rivalry Trophies, Game Day Experience, MFSN Weekly Show, Relocation, Dynasty Legacy Dashboard, and more!","gold");
    }
    ensureLeagueGMArchetypes90(d.teams||[]);
    (d.teams||[]).forEach(function(t){
      (t.roster||[]).forEach(function(p){
        if(p&&p.injury&&p.injury.games>0&&typeof p._trueInjuryWeeks!=="number")p._trueInjuryWeeks=p.injury.games;
      });
    });
    var loadedUnlocks=d.unlocks||DEFAULT_UNLOCKS;
    var checkedUnlocks=checkUnlocks(loadedUnlocks,d.season,d.teams,d.myId,d.godMode);
    setUnlocks(checkedUnlocks);
    setTab("home");setScreen("league");}
  function _applyPositionBattleResult974(team,battle,winnerId,autoResolved){
    if(!team||!battle||!winnerId)return battle;
    var loserId=(battle.incumbent&&battle.incumbent.id)===winnerId?(battle.challenger&&battle.challenger.id):(battle.incumbent&&battle.incumbent.id);
    var winner=team.roster.find(function(p){return p.id===winnerId;});
    var loser=team.roster.find(function(p){return p.id===loserId;});
    if(winner){
      if(!autoResolved){
        winner.morale=cl((winner.morale||70)+5,15,100);
        winner.chemistry=cl((winner.chemistry||60)+3,15,100);
        var topRating=Object.keys(winner.ratings||{}).sort(function(a,b){return (winner.ratings[b]||0)-(winner.ratings[a]||0);})[0];
        if(topRating){
          winner.ratings[topRating]=cl((winner.ratings[topRating]||70)+2,40,99);
          winner.ovr=calcOvr(winner);winner.trueOvr=winner.ovr;
        }
      }
      winner.isStarter=true;
    }
    if(loser){
      if(!autoResolved)loser.morale=cl((loser.morale||70)-3,15,100);
      loser.isStarter=false;
    }
    var updated=assign({},battle,{resolved:true,winner:winnerId});
    if(autoResolved)updated.autoResolved=true;
    return updated;
  }
  function autoResolvePositionBattles974ForTeam(team,battleList){
    if(!team)return [];
    var current=Array.isArray(battleList)?battleList:(Array.isArray(posBattles974)?posBattles974:[]);
    return current.map(function(b){
      if(!b||b.resolved)return b;
      var winId=((b.incumbent&&b.incumbent.ovr||0)>=(b.challenger&&b.challenger.ovr||0))?(b.incumbent&&b.incumbent.id):(b.challenger&&b.challenger.id);
      return _applyPositionBattleResult974(team,b,winId,true);
    });
  }
  function buildPreseasonReport974(devPlayers,team,battleList){
    var improved=(devPlayers||[]).filter(function(p){return p.delta>0;});
    var report2={players:devPlayers||[],improved:improved.length,avgDelta:improved.length>0?Math.round(improved.reduce(function(s2,p){return s2+p.delta;},0)/improved.length*10)/10:0};
    var srcBattles974=Array.isArray(battleList)?battleList:(posBattles974||[]);
    report2.posBattles974=((srcBattles974||[]).filter(function(b){return b&&b.resolved;})).map(function(b){
      var winnerName=((b.incumbent&&b.incumbent.id)===b.winner?(b.incumbent&&b.incumbent.name):(b.challenger&&b.challenger.name))||"Unknown";
      var loserName=((b.incumbent&&b.incumbent.id)!==b.winner?(b.incumbent&&b.incumbent.name):(b.challenger&&b.challenger.name))||"Unknown";
      return {pos:b.pos,winner:winnerName,loser:loserName,autoResolved:!!b.autoResolved};
    });
    report2.campStandouts974=(improved.slice().sort(function(a,b){return b.delta-a.delta;}).slice(0,3)).map(function(p){
      return {name:p.name,pos:p.pos,delta:p.delta,newOvr:p.ovrAfter};
    });
    if(team)report2.cutAdvisor974=buildCutAdvisor974(team.roster||[],ROSTER_CAP);
    return report2;
  }
  function resolvePositionBattle974(battleIndex,choice){
    if(!my)return;
    var nt=teams.slice();
    var u2=nt.find(function(t){return t.id===myId;});
    if(!u2)return;
    setPosBattles974(function(prev){
      var updated=(prev||[]).slice();
      var battle=updated[battleIndex];
      if(!battle||battle.resolved)return prev;
      var winnerId=choice==="incumbent"?(battle.incumbent&&battle.incumbent.id):(battle.challenger&&battle.challenger.id);
      var loserId=choice==="incumbent"?(battle.challenger&&battle.challenger.id):(battle.incumbent&&battle.incumbent.id);
      var winnerName=choice==="incumbent"?(battle.incumbent&&battle.incumbent.name):(battle.challenger&&battle.challenger.name);
      var loserName=choice==="incumbent"?(battle.challenger&&battle.challenger.name):(battle.incumbent&&battle.incumbent.name);
      updated[battleIndex]=_applyPositionBattleResult974(u2,battle,winnerId,false);
      addN("âš”ï¸ "+winnerName+" wins the "+battle.pos+" battle! "+loserName+" moves to backup.",choice==="challenger"?"cyan":"green");
      logTx("POS_BATTLE_974",{pos:battle.pos,winner:winnerName,loser:loserName,choice:choice});
      setTeams(nt);doSave(nt);
      return updated;
    });
  }
  function simEntirePreseason(){
    // simEntirePreseason called
    try{
    if(season.phase!=="preseason")return;
    var nt=teams.map(function(t){return assign({},t,{roster:t.roster.map(function(p){return assign({},p,{ratings:assign({},p.ratings),stats:assign({},p.stats||{gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0,fumbles:0,punts:0,puntYds:0})});})});});
    var weeksLeft=3-season.week+1;// How many weeks remain (e.g., week 1 â†’ 3 weeks, week 2 â†’ 2 weeks)
    var myBefore={};
    var myT2=nt.find(function(t){return t.id===myId;});
    if(myT2){myT2.roster.forEach(function(p){myBefore[p.id]={name:p.name,pos:p.pos,ovr:p.ovr,age:p.age,devTrait:p.devTrait};});}
    var posBattlesLocal974=Array.isArray(posBattles974)?posBattles974.slice():[];
    if(myT2&&season.week===1){
      if(breakouts80.length===0){
        var boAll974=BREAKOUT_SYSTEM.pick(myT2.roster,RNG.dev);
        if(boAll974.length>0){
          setBreakouts80(boAll974);
          boAll974.forEach(function(bc){
            addN("ðŸŒŸ MFSN BREAKOUT WATCH: "+bc.name+" ("+bc.pos+", "+bc.ovrAtStart+" OVR) is a breakout candidate this season.","gold");
          });
        }
      }
      posBattlesLocal974=detectPositionBattles974(myT2.roster);
      setPosBattles974(posBattlesLocal974);
      if(posBattlesLocal974.length>0)addN("âš”ï¸ Position battles identified: "+posBattlesLocal974.length+" camp battle"+(posBattlesLocal974.length!==1?"s":"")+" to decide.","orange",{type:"tab",tab:"home"});
    }
    for(var wk=0;wk<weeksLeft;wk++){
      var ids=nt.map(function(t){return t.id;});
      for(var pi=0;pi<ids.length;pi+=2){
        var tA=nt.find(function(t){return t.id===ids[pi];});
        var tB=nt.find(function(t){return t.id===ids[pi+1<ids.length?pi+1:0];});
        if(tA&&tB){try{SIM_CULL.simAIGame(tA,tB,true);}catch(sg){console.error("[simEntirePreseason] simGame error wk"+wk+" pair "+pi+":",sg);}}
      }
      applyPreseasonDev(nt);
      nt.forEach(function(t){var medBonus=getFacilFx("med",t.facilities?t.facilities.med||0:0);
        t.roster.forEach(function(p){if(p.injury&&p.injury.games>0){var heal=RNG.injury()*10<medBonus?2:1;decrementPlayerInjury92(p,heal);}});});
    }
    var myAfter2=nt.find(function(t){return t.id===myId;});
    var resolvedBattles974=posBattlesLocal974;
    if(myAfter2&&(resolvedBattles974||[]).length>0){
      resolvedBattles974=autoResolvePositionBattles974ForTeam(myAfter2,resolvedBattles974);
      setPosBattles974(resolvedBattles974);
    }
    if(myAfter2&&Object.keys(myBefore).length>0){
      var devPlayers=[];
      myAfter2.roster.forEach(function(p){
        var before=myBefore[p.id];
        if(before){var delta=p.ovr-before.ovr;devPlayers.push({name:p.name,pos:p.pos,age:p.age,ovrBefore:before.ovr,ovrAfter:p.ovr,delta:delta,devTrait:p.devTrait});}
      });
      devPlayers.sort(function(a,b){return b.delta-a.delta;});
      var improved=devPlayers.filter(function(p){return p.delta>0;});
      if(improved.length>0){
        var report2=buildPreseasonReport974(devPlayers,myAfter2,resolvedBattles974);
        setPreseasonReport(report2);
        addN("ðŸ“ˆ Preseason Report: "+improved.length+" players improved! Avg +"+report2.avgDelta+" OVR","green",{type:"modal",modal:"preseasonReport",data:report2});
      }
    }
    setTeams(nt);
    setSeason(function(s){return assign({},s,{week:3,phase:"cutDay"});});
    addN("âœ‚ï¸ All 3 preseason weeks simmed. Cut to "+ROSTER_CAP+"!","purple",{type:"tab",tab:"roster"});
    setTab("roster");
    }catch(e){addN("âŒ Preseason sim error: "+e.message,"red");console.error("simEntirePreseason error:",e);alert("Preseason sim error â€” please try again.\n\n"+e.message);}
  }
  function applyPreseasonDev(nt){
    nt.forEach(function(t){
      var coach=t.staff?t.staff.oc:null;var gym=t.facilities?t.facilities.gym||0:0;
      var coachBonus=coach&&coach.ratings?(coach.ratings.development-50)*0.02:0;var gymBonus=(gym||0)*0.15;
      t.roster.forEach(function(p){
        var def=POS_DEF[p.pos];if(!def)return;
        var age=p.age;var snaps=p.stats?p.stats.snaps||0:0;
        var devMult=p.devTrait==="superstar"?1.4:p.devTrait==="star"?1.15:1.0;
        if(hasTrait95(p,"workhorse"))devMult+=0.15;// v95.6: hasTrait95
        var snapMult=snaps>30?1.2:snaps>10?1.0:0.5;
        if(hasTrait95(p,"gym_rat"))snapMult=Math.max(snapMult,0.9);// v95.6: hasTrait95
        var ageMult=age<=22?1.5:age<=24?1.2:age<=26?0.8:age<=28?0.3:0;
        if(ageMult<=0)return;// Vets don't develop in preseason
        def.r.forEach(function(r){
          var posCoachB=getPosCoachBonus(t,p.pos);// v60: Position coach bonus
          var d=(rng(0,2)+coachBonus+gymBonus+posCoachB*0.3)*devMult*snapMult*ageMult;
          d=Math.round(d*10)/10;// fractional precision
          if(d>0&&RNG.ai()<0.6){// 60% chance per attribute per week
            p.ratings[r]=cl((p.ratings[r]||50)+Math.round(d),35,99);
          }
        });
        p.ovr=calcOvr(p);
      });
    });
  }
  function simWeek(){
    // simWeek called
    try{
    logTx("SEED_SNAPSHOT",{seed:SEED_GLOBAL,week:season.week,year:season.year,phase:season.phase});
    if(season.phase==="preseason"){
      var nt=teams.map(function(t){return assign({},t,{roster:t.roster.map(function(p){return assign({},p,{ratings:assign({},p.ratings),stats:assign({},p.stats||{gp:0,snaps:0,passYds:0,passTD:0,int:0,rushYds:0,rushTD:0,recYds:0,recTD:0,rec:0,targets:0,drops:0,yac:0,sacksAllowed:0,tackles:0,sacks:0,defINT:0,fgM:0,fgA:0,fumbles:0,punts:0,puntYds:0})});})});});
      nt.slice().sort(function(a,b){return b.wins!==a.wins?b.wins-a.wins:(b.pf||0)-(b.pa||0)-((a.pf||0)-(a.pa||0));})
        .forEach(function(t,i){t._prevRank=i+1;});
      var myBefore={};
      var myT2=nt.find(function(t){return t.id===myId;});
      if(myT2){myT2.roster.forEach(function(p){myBefore[p.id]={name:p.name,pos:p.pos,ovr:p.ovr,age:p.age,devTrait:p.devTrait};});}
      if(myT2&&season.week===1){
        if(breakouts80.length===0){
          var boCandidates=BREAKOUT_SYSTEM.pick(myT2.roster,RNG.dev);
          if(boCandidates.length>0){
            setBreakouts80(boCandidates);
            boCandidates.forEach(function(bc){addN("ðŸŒŸ MFSN BREAKOUT WATCH: "+bc.name+" ("+bc.pos+", "+bc.ovrAtStart+" OVR) is a breakout candidate this season.","gold");});
          }
        }
        var battles974=detectPositionBattles974(myT2.roster);
        setPosBattles974(battles974);
        if(battles974.length>0)addN("âš”ï¸ Position battles identified: "+battles974.length+" camp battle"+(battles974.length!==1?"s":"")+" to decide.","orange",{type:"tab",tab:"home"});
      }
      var ids=nt.map(function(t){return t.id;});
      for(var pi=0;pi<ids.length;pi+=2){
        var tA=nt.find(function(t){return t.id===ids[pi];});
        var tB=nt.find(function(t){return t.id===ids[pi+1<ids.length?pi+1:0];});
        if(tA&&tB){try{SIM_CULL.simAIGame(tA,tB,true);}catch(sg){console.error("[simWeek] simGame error pair "+pi+":",sg);}}// isPreseason=true â†’ backups get snaps
      }
      applyPreseasonDev(nt);
      nt.forEach(function(t){var medBonus=getFacilFx("med",t.facilities?t.facilities.med||0:0);
        t.roster.forEach(function(p){if(p.injury&&p.injury.games>0){var heal=RNG.injury()*10<medBonus?2:1;decrementPlayerInjury92(p,heal);}});});
      setTeams(nt);
      if(season.week>=3){
        var myAfter2=nt.find(function(t){return t.id===myId;});
        var resolvedBattles974=(myAfter2&&Array.isArray(posBattles974)&&posBattles974.length>0)?autoResolvePositionBattles974ForTeam(myAfter2,posBattles974):posBattles974;
        if(myAfter2&&resolvedBattles974!==posBattles974)setPosBattles974(resolvedBattles974);
        if(myAfter2&&Object.keys(myBefore).length>0){
          var devPlayers=[];
          myAfter2.roster.forEach(function(p){
            var before=myBefore[p.id];
            if(before){var delta=p.ovr-before.ovr;devPlayers.push({name:p.name,pos:p.pos,age:p.age,ovrBefore:before.ovr,ovrAfter:p.ovr,delta:delta,devTrait:p.devTrait});}
          });
          devPlayers.sort(function(a,b){return b.delta-a.delta;});
          var improved=devPlayers.filter(function(p){return p.delta>0;});
          if(improved.length>0){
            var report2=buildPreseasonReport974(devPlayers,myAfter2,resolvedBattles974);
            setPreseasonReport(report2);
            addN("ðŸ“ˆ Preseason Report: "+improved.length+" players improved! Avg +"+report2.avgDelta+" OVR","green",{type:"modal",modal:"preseasonReport",data:report2});
          }
        }
        setSeason(function(s){return assign({},s,{phase:"cutDay"});});
        addN("âœ‚ï¸ Preseason complete. Cut down to "+ROSTER_CAP+" by Cut Day!","purple",{type:"tab",tab:"roster"});
        setTab("roster");
      }else{
        setSeason(function(s){return assign({},s,{week:s.week+1});});
        var myAfter3=nt.find(function(t){return t.id===myId;});
        var improvedThisWk=0;
        if(myAfter3&&Object.keys(myBefore).length>0){
          myAfter3.roster.forEach(function(p){var b2=myBefore[p.id];if(b2&&p.ovr>b2.ovr)improvedThisWk++;});
        }
        addN("ðŸˆ Preseason Wk"+season.week+" complete. "+improvedThisWk+" players gained from reps.","cyan",{type:"tab",tab:"roster"});
      }
      // preseason complete
      return;
    }
    if(season.phase!=="regular") return;
    var storyBeatQueue87=[];
    if(season.week===1&&my){
      var holdouts75=HOLDOUT_SYSTEM.checkHoldouts(my,true);
      holdouts75.forEach(function(p){
        addN("âš ï¸ HOLDOUT: "+p.name+" ("+p.pos+" "+p.ovr+" OVR) is holding out for a new contract!","red");
        if(getPersonality(p).greed>=8){
          storyBeatQueue87.push({type:"story",icon:STORY_BEATS86.holdout_saga.icon,
            text:p.name+"'s camp is making noise. Greed-driven holdout escalating.",
            color:STORY_BEATS86.holdout_saga.color,id:U(),storyBeat:STORY_BEATS86.holdout_saga.id,playerId:p.id,week:season.week,
            toast:p.name+" is holding out for top dollar."});
          addN(p.name+" is holding out for top dollar.","orange");
        }
      });
    }
    if(my){
      my.roster.forEach(function(p){
        if(p.holdout75){
          var hResult=HOLDOUT_SYSTEM.weeklyHoldout(p);
          if(hResult){
            var msgColor=hResult.stage>=4?"red":hResult.stage>=3?"red":"orange";
            addN(hResult.headline,msgColor);
            setHoldoutStages80(function(prev){var upd=assign({},prev);upd[p.id]=hResult.stage||1;return upd;});
            logTx("HOLDOUT_STAGE",{name:p.name,pos:p.pos,stage:hResult.stage||1,type:hResult.type,week:season.week});
          }
        }
      });
      if(season.phase==="preseason"&&season.week===1&&breakouts80.length===0){
        var boCandidates=BREAKOUT_SYSTEM.pick(my.roster,RNG.dev);
        if(boCandidates.length>0){
          setBreakouts80(boCandidates);
          boCandidates.forEach(function(bc){addN("ðŸŒŸ MFSN BREAKOUT WATCH: "+bc.name+" ("+bc.pos+", "+bc.ovrAtStart+" OVR) is a breakout candidate this season.","gold");});
        }
      }
    }
    teams.slice().sort(function(a,b){return b.wins!==a.wins?b.wins-a.wins:(b.pf||0)-(b.pa||0)-((a.pf||0)-(a.pa||0));})
      .forEach(function(t,i){t._prevRank=i+1;});
    reseedWeek(season.year,season.week);
    var wkLedger=season.ledger||[];
    if(ownerGoals.length===0&&my){
      var sg33i=generateSeasonGoals(my);setOwnerGoals(sg33i.ownerGoals);setCoachGoals(sg33i.coachGoals);
      var pg33i=generatePlayerGoals(my);setPlayerGoals(pg33i);
      setSeasonTracking({blowoutLosses:0,shutoutLosses:0,bestWinStreak:0,currentStreak:0,madePlayoffs:false,isChamp:false});
    }
    var wg=sched.filter(function(g){return g.week===season.week&&!g.played;});
    if(season.rivalries&&my){
      var myGame58=wg.find(function(g){return g.home===myId||g.away===myId;});
      if(myGame58){
        var oppId58=myGame58.home===myId?myGame58.away:myGame58.home;
        var oppTeam58=teams.find(function(t){return t.id===oppId58;});
        var rKey58=rivalryKey?rivalryKey(myId,oppId58):null;
        var riv58=rKey58&&season.rivalries[rKey58]?season.rivalries[rKey58]:null;
        if(riv58&&riv58.heat>=5){
          var rgd=buildRivalryGameDay(my,oppTeam58,riv58,trophyNames,sched,season);
          if(rgd)setRivalryGD(rgd);
        }else{setRivalryGD(null);}
      }else{setRivalryGD(null);}
    }
    var futureGames=sched.filter(function(g){return !g.played;});
    if(!wg.length&&futureGames.length===0){setSeason(function(s){return assign({},s,{phase:"playoffs"});});return;}
    if(!wg.length){
      addN("ðŸ“… Week "+season.week+": BYE WEEK","cyan");
      setSeason(function(s){return assign({},s,{week:s.week+1});});return;
    }
    var userBye=!wg.some(function(g){return g.home===myId||g.away===myId;});
    var nt=teams.slice();var ns=sched.slice();
    // v97.7: Game of the Week
    var gotw977=GAME_OF_WEEK977.pick(sched,nt,season.week,myId);
    setGotwData977(gotw977||null);
    if(gotw977&&gotw977.isUser){var u_gotw=nt.find(function(t){return t.id===myId;});if(u_gotw){u_gotw.cash=(u_gotw.cash||50)+gotw977.effects.revenueBoost;u_gotw.roster.forEach(function(p){p.morale=cl((p.morale||70)+gotw977.effects.moraleBoost,15,100);});}addN(gotw977.label+" â€” Your game has been nationally televised! +$"+gotw977.effects.revenueBoost+"M revenue","gold");}
    syncLeagueAIModes(nt,season.year);// v85: keep AI mode coherent across trade/FA/draft decisions
    runAICapOps973(nt,season.year);// v97.3: AI teams sometimes restructure/backload when cap-strapped
    // v93.15: Offseason study â€” all players on all teams start season at 55+ system knowledge
    if(season.week===1){
      nt.forEach(function(t){
        t.roster.forEach(function(p){
          if((p.systemFit||0)<55)p.systemFit=rng(55,68);
        });
      });
    }
    var pracMod=PRACTICE_FOCUS.find(function(pf){return pf.id===pracFocus;})||PRACTICE_FOCUS[0];
    var userT64=nt.find(function(t){return t.id===myId;});
    // v96.1: Remove last week's Practice Star REAL rating boosts
    if(pracStarBoost&&pracStarBoost.playerId&&userT64){
      var oldStar=userT64.roster.find(function(p){return p.id===pracStarBoost.playerId;});
      if(oldStar&&pracStarBoost.attrBreakdown){
        PRAC_STAR_ATTRS.removeBoost(oldStar,pracStarBoost.attrBreakdown);
        oldStar._pracStarActive=false;
      } else if(oldStar){oldStar.ovr=cl(oldStar.ovr-(pracStarBoost.boost||0),40,99);oldStar.trueOvr=oldStar.ovr;oldStar._pracStarActive=false;}
    }
    // v96.1: Pick new Practice Star â€” apply REAL individual rating boosts
    if(userT64){
      var starCandidates=userT64.roster.filter(function(p){return !(p.injury&&p.injury.games>0)&&(p.ovr||50)>=60;});
      if(starCandidates.length>0){
        var newStar=starCandidates[Math.floor(RNG.ai()*starCandidates.length)];
        var starBoost=rng(3,6);
        // v96.1: 3x challenge boost â€” if user completed focused challenge last week
        var challenge3x=challenge3xNext96;
        if(challenge3x){starBoost=starBoost*3;setChallenge3xNext96(false);}
        var prevOvr=newStar.ovr;
        var breakdown=PRAC_STAR_ATTRS.generateBreakdown(newStar.pos,starBoost,newStar);
        var ovrDelta=PRAC_STAR_ATTRS.applyBoost(newStar,breakdown);
        newStar._pracStarActive=true;
        var boostData={playerId:newStar.id,boost:ovrDelta,week:season.week,name:newStar.name,pos:newStar.pos,ovr:prevOvr,ovrAfter:newStar.ovr,
          attrBreakdown:breakdown,was3x:!!challenge3x};
        setPracStarBoost(boostData);
        addN("â­ PRACTICE STAR: "+newStar.name+" ("+newStar.pos+") +"+(ovrDelta>0?ovrDelta:starBoost)+" OVR this week!"+(challenge3x?" ðŸ”¥ðŸ”¥ðŸ”¥ 3x CHALLENGE BOOST!":""),"gold");
      }
    }
    if(userT64&&pracMod.fx.system){
      userT64.roster.forEach(function(p){
        p.systemFit=cl((p.systemFit||30)+Math.round(pracMod.fx.system*15),0,100);
      });
    }
    if(userT64&&pracMod.fx.morale){
      userT64.roster.forEach(function(p){
        p.morale=cl((p.morale||70)+Math.round(pracMod.fx.morale*50),30,99);
      });
    }
    if(pracMod.id==="scout"&&userT64){
      var myGame65=wg.find(function(g){return g.home===myId||g.away===myId;});
      if(myGame65){
        var oppId65=myGame65.home===myId?myGame65.away:myGame65.home;
        var oppT65=nt.find(function(t){return t.id===oppId65;});
        if(oppT65){
          var sr65=SCOUT_REPORT.generate(userT64,oppT65,sched,season,season.rivalries||{});
          setScoutRpt(sr65);
          var coachR66=userT64.coachRatings?userT64.coachRatings.scouting||50:50;
          var updatedDB66=assign({},scoutDB);
          var dossierEntry=DOSSIER.scout(updatedDB66,oppId65,season.year,season.week,sr65,coachR66,CLINIC_MATH.getMods(coachClinic).scoutConfBonus);
          DOSSIER.decay(updatedDB66,season.year,season.week);
          setScoutDB(updatedDB66);
          setCoachClinic(function(prev){
            var c=CLINIC.earnXP(assign({},prev),"dossier_scout",5);
            if(CLINIC.hasPerk(prev,"anl1"))CLINIC_MATH.logApply(c,"anl1");
            return c;
          });
          if(dossierEntry.scoutCount>1)addN("ðŸ” Dossier updated: "+oppT65.icon+oppT65.abbr+" confidence "+dossierEntry.conf+"%","cyan");
        }
      }
    }else{setScoutRpt(null);}
    wg.forEach(function(g){var h=nt.find(function(t){return t.id===g.home;}),a=nt.find(function(t){return t.id===g.away;});if(!h||!a) return;
      var isUserGame=(g.home===myId||g.away===myId);
      if(isUserGame){h.isUser=(g.home===myId);a.isUser=(g.away===myId);}
      if(isUserGame){
        var cm68=CLINIC_MATH.getMods(coachClinic);
        if(g.home===myId)h._clinicMods=cm68;else a._clinicMods=cm68;
      }
      var htMods=null;
      if(isUserGame){
        htMods={};
        // v93.18: pass the full plans map so sim can look up by actual halftime score
        if(halftimePlans&&Object.keys(halftimePlans).length>0){htMods._htPlansMap=halftimePlans;}
        // v97.7: inject pregame speech fx and halftime choice fx from refs
        if(_speechFxRef977.current){var sfx977=_speechFxRef977.current;htMods._turnoverMod977=sfx977.turnoverMod||0;htMods._injuryMod977=sfx977.injuryMod||0;htMods._clutchMod977=sfx977.clutchMod||0;_speechFxRef977.current=null;}
        if(_halftimeFxRef977.current){var hfx977=_halftimeFxRef977.current;htMods.scoringMod=(htMods.scoringMod||0)+(hfx977.scoringMod||0);htMods.turnoverMod=(htMods.turnoverMod||0)+(hfx977.turnoverMod||0);if(hfx977.clockMod)htMods.clockMod=hfx977.clockMod;if(hfx977.clutchMod)htMods.clutchMod=(htMods.clutchMod||0)+hfx977.clutchMod;_halftimeFxRef977.current=null;}
        htMods._pracInjMod=pracMod.fx.injuryRisk||0;
        if(pracMod.id==="pads"&&CLINIC.hasPerk(coachClinic,"dev2")){
          htMods._pracInjMod=Math.max(0,htMods._pracInjMod-CLINIC_MATH.getMods(coachClinic).padsInjReduction);
          setCoachClinic(function(prev){var c=assign({},prev);CLINIC_MATH.logApply(c,"dev2");return c;});
        }
        htMods._pracLabel=pracMod.label;
        htMods._pracId=pracMod.id;
        if(captainId){
          var capPlayer=userT64?userT64.roster.find(function(p){return p.id===captainId;}):null;
          if(capPlayer&&!(capPlayer.injury&&capPlayer.injury.games>0)){
            htMods._captain={name:capPlayer.name,pos:capPlayer.pos,ovr:capPlayer.ovr,
              momentsLeft:CAPTAIN_RULES.triggersPerSeason-(captMoments.used||0)};
          }
        }
        if(userT64){htMods._planOff=userT64.gameplanOff||"balanced_o";htMods._planDef=userT64.gameplanDef||"balanced_d";}
      }
      var r=isUserGame?simGame(h,a,false,htMods):SIM_CULL.simAIGame(h,a,false);
      var gi=ns.findIndex(function(x){return x.home===g.home&&x.away===g.away&&x.week===g.week;});
      if(gi>=0){ns[gi].played=true;ns[gi].result=r;}
      if(r.home>r.away){h.wins++;a.losses++;h.streak=Math.max(1,(h.streak||0)+1);a.streak=Math.min(-1,(a.streak||0)-1);}
      else{a.wins++;h.losses++;a.streak=Math.max(1,(a.streak||0)+1);h.streak=Math.min(-1,(h.streak||0)-1);}
      h.pf+=r.home;h.pa+=r.away;a.pf+=r.away;a.pa+=r.home;
      if(!h.weekLog)h.weekLog=[];h.weekLog.push(r.home-r.away);if(h.weekLog.length>8)h.weekLog=h.weekLog.slice(-8);
      if(!a.weekLog)a.weekLog=[];a.weekLog.push(r.away-r.home);if(a.weekLog.length>8)a.weekLog=a.weekLog.slice(-8);
      h.fanbase=cl((h.fanbase||60)+(r.home>r.away?2:-1),10,99);a.fanbase=cl((a.fanbase||60)+(r.away>r.home?2:-1),10,99);
      updateRivalries(nt,g.home,g.away,r,false,season.year,season.week);
      // v98.6 #10: Update rivalry trophies
      (function(){try{
        if(rivalTrophies986.length>0){
          var winAbbr=r.home>r.away?h.abbr:a.abbr;
          var updated986=rivalTrophies986.map(function(tr){
            if((tr.team1===h.abbr&&tr.team2===a.abbr)||(tr.team1===a.abbr&&tr.team2===h.abbr)){
              var newTr=assign({},tr);newTr.holder=winAbbr;
              if(!newTr.history)newTr.history=[];
              newTr.history.push({year:season.year,week:season.week,winner:winAbbr});
              return newTr;
            }
            return tr;
          });
          setRivalTrophies986(updated986);
        }
      }catch(e986t){console.error("v98.6 trophy error:",e986t);}})();
      // v97.7: trophy change notification
      if(isUserGame){var myT977n=nt.find(function(t){return t.id===myId;});if(myT977n){var oppId977n=g.home===myId?g.away:g.home;var uRiv977n=_findRivalObj(myT977n,oppId977n);if(uRiv977n&&uRiv977n.trophy977&&uRiv977n.trophy977.holderId&&uRiv977n.trophy977.history&&uRiv977n.trophy977.history.length>0){var hist977n=uRiv977n.trophy977.history;var isNewClaim977=(hist977n.length===1)||(hist977n.length>1&&hist977n[hist977n.length-1].winnerId!==hist977n[hist977n.length-2].winnerId);if(isNewClaim977){var gotTr977=uRiv977n.trophy977.holderId===myId;addN(uRiv977n.trophy977.icon+" "+(gotTr977?"YOU CLAIMED":"You LOST")+" "+uRiv977n.trophy977.name+"!",gotTr977?"gold":"red");}}}}
      if(g.home===myId||g.away===myId){
        var userWon80=(g.home===myId&&r.home>r.away)||(g.away===myId&&r.away>r.home);
        var myT80b=nt.find(function(t){return t.id===myId;});
        var newPatience80=OWNER_PATIENCE.tick(ownerPatience80,owner,myT80b||{},userWon80,false);
        var arcMood80=myT80b&&typeof myT80b.ownerMood==="number"?myT80b.ownerMood:70;
        var prevArc80=OWNER_CONFIDENCE_ARC.get(ownerPatience80,arcMood80);
        var nextArc80=OWNER_CONFIDENCE_ARC.get(newPatience80,arcMood80);
        setOwnerPatience80(newPatience80);
        var arcShift80=OWNER_CONFIDENCE_ARC.transition(prevArc80,nextArc80);
        if(arcShift80)addN(arcShift80.text,arcShift80.color);
        if(newPatience80<=9&&ownerPatience80>9){addN("ðŸš¨ OWNER PATIENCE CRITICAL: Meeting imminent. Win or face consequences.","red");}
        if(newPatience80>=90&&ownerPatience80<90){addN("ðŸ¤© OWNER IS ECSTATIC: Budget bonus unlocked!","gold");}
        var ps81=OWNER_PATIENCE.status(newPatience80);
        if(ps81.label==="CRISIS"&&!ownerMeeting81){
          var ults81=OWNER_CONSEQUENCES.generateUltimatums(RNG.ui);
          setOwnerMeeting81({ultimatums:ults81,startWeek:season.week,startRoster:myT80b?myT80b.roster.map(function(p){return{id:p.id};}):[]});
        }
        if(ps81.label==="FURIOUS"&&!ownerPenalty81){
          var penIdx81=Math.floor(RNG.ui()*OWNER_CONSEQUENCES.furiousPenalties.length);
          var pen81=OWNER_CONSEQUENCES.furiousPenalties[penIdx81];
          setOwnerPenalty81(pen81);addN("ðŸ”¥ OWNER PENALTY: "+pen81.label,"red");
        }
        if(ps81.label==="WATCHING"&&season.week%3===0){
          var wmIdx81=Math.floor(RNG.ui()*OWNER_CONSEQUENCES.watchingMessages.length);
          addN("ðŸ˜ "+OWNER_CONSEQUENCES.watchingMessages[wmIdx81],"orange");
        }
        if(ultimatumDeadline81&&season.week>ultimatumDeadline81.week){
          var met81=false;
          OWNER_CONSEQUENCES.ultimatums.forEach(function(u){
            if(u.id===ultimatumDeadline81.type){
              if(u.id==="cut_payroll")met81=u.check(null,ultimatumDeadline81.startCap||0,myT80b?(myT80b.capUsed||0):0);
              else met81=true;// For trade/fire, check is simpler
            }
          });
          if(!met81){addN("ðŸ’€ FIRED! Owner has lost all patience. Your dynasty is over.","red");setScreen("fired81");}
          else{setUltimatumDeadline81(null);setOwnerPatience80(Math.min(100,ownerPatience80+20));addN("âœ… Ultimatum met! Owner patience restored.","gold");}
        }
        var foRelBonus81=FRONT_OFFICE.getBonus(frontOffice78,"morale");
        if(foRelBonus81>0&&newPatience80<45){setOwnerPatience80(Math.min(100,newPatience80+Math.round(foRelBonus81*2)));}
      }
    });
    var u33=nt.find(function(t){return t.id===myId;});
    if(u33){
      setSeasonTracking(function(prev){
        var st=assign({},prev);
        var myGame=wg.find(function(g){return g.home===myId||g.away===myId;});
        if(myGame){
          var gIdx33=ns.findIndex(function(x){return x.home===myGame.home&&x.away===myGame.away&&x.week===myGame.week;});
          if(gIdx33>=0&&ns[gIdx33].result){
            var r33=ns[gIdx33].result;var isH33=myGame.home===myId;
            var myS33=isH33?r33.home:r33.away;var oppS33=isH33?r33.away:r33.home;
            if(oppS33>myS33&&(oppS33-myS33)>=21)st.blowoutLosses=(st.blowoutLosses||0)+1;
            if(myS33===0&&oppS33>0)st.shutoutLosses=(st.shutoutLosses||0)+1;
            if(myS33>oppS33){st.currentStreak=(st.currentStreak||0)+1;if(st.currentStreak>(st.bestWinStreak||0))st.bestWinStreak=st.currentStreak;}
            else{st.currentStreak=0;}
          }
        }
        return st;
      });
    }
    if(u33&&playerGoals.length>0){
      var newlyComplete=updateGoalProgress(u33,playerGoals);
      if(newlyComplete.length>0){
        setPlayerGoals(playerGoals.slice());
        newlyComplete.forEach(function(nc){addN("ðŸŽ¯ GOAL COMPLETE: "+nc.playerName+" â€” "+nc.label+"!","gold",{type:"tab",tab:"home"});});
      }
    }
    var userGame=wg.find(function(g){return g.home===myId||g.away===myId;});
    if(userGame){
      var oppId33=userGame.home===myId?userGame.away:userGame.home;
      var rLabel33=getRivalryLabel((_findRivalObj(u33,oppId33)||{}).heat||0);
      if(rLabel33.label){var oppTm=nt.find(function(t){return t.id===oppId33;});addN("ðŸ”¥ "+rLabel33.label+": "+((oppTm?oppTm.icon:"")+(oppTm?oppTm.abbr:"")),"orange");}
    }
    var weekBoxes=[];
    wg.forEach(function(g){
      var gi2=ns.findIndex(function(x){return x.home===g.home&&x.away===g.away&&x.week===g.week;});
      if(gi2>=0&&ns[gi2].result){
        var r2=ns[gi2].result;var hName=nt.find(function(t){return t.id===g.home;});var aName=nt.find(function(t){return t.id===g.away;});
        weekBoxes.push({
          id:U(),year:season.year,week:season.week,
          homeId:g.home,awayId:g.away,
          homeName:hName?(hName.icon||"")+hName.abbr:"HOME",awayName:aName?(aName.icon||"")+aName.abbr:"AWAY",
          homeScore:r2.home,awayScore:r2.away,
          qtrs:r2.qtrs||{h:[0,0,0,0],a:[0,0,0,0]},
          box:r2.box||{},leaders:r2.leaders||{},
          log:r2.log||[]
        });
      }
    });
    if(weekBoxes.length>0){
      setBoxHistory(function(prev){var nb=prev.concat(weekBoxes);saveBoxScores(nb);return nb;});
    }
    nt.forEach(function(t){var medBonus=getFacilFx("med",t.facilities?t.facilities.med||0:0);
      t.roster.forEach(function(p){if(p.injury&&p.injury.games>0){var heal=RNG.injury()*10<medBonus?2:1;decrementPlayerInjury92(p,heal);
        if(p.injury.games<=0){
          if(!p.injury._rehab78)p.injury._rehab78="conservative";
          var reinjFired=REHAB_SYSTEM.checkReinjury(p);
          if(reinjFired){
            var reinjGames=p.injury._rehab78==="aggressive"?rngI(2,5):rngI(1,3);
            setPlayerInjury92(p,"Re-injury",reinjGames);
            p.injury._reinjuryCount=(p.injury._reinjuryCount||0)+1;
            if(t.id===myId){logTx("REINJURY",{name:p.name,pos:p.pos,games:reinjGames,rehab:p.injury._rehab78});addN("ðŸ©¹ "+p.name+" RE-INJURED during "+p.injury._rehab78+" rehab! "+reinjGames+" more weeks.","red");}
          }else{setPlayerInjury92(p,null,0);}
        }
      }});});
    nt.forEach(function(t){
      var sal=t.capUsed/14;t.cash=(t.cash||50)-sal;t.expenses=(t.expenses||0)+sal;
    });
    wg.forEach(function(g){
      var hTeam=nt.find(function(t){return t.id===g.home;});if(!hTeam) return;
      var aTeam2=nt.find(function(t){return t.id===g.away;});
      var stadLvl=hTeam.facilities?hTeam.facilities.stad||0:0;
      var cap2=getFacilFx("stad",stadLvl)*1000;
      var dem=(hTeam.fanbase||55)+(hTeam.wins*5)-(hTeam.losses*2);
      if(aTeam2){
        var h2hCount=sched.filter(function(sg){return sg.played&&((sg.home===hTeam.id&&sg.away===aTeam2.id)||(sg.away===hTeam.id&&sg.home===aTeam2.id));}).length;
        if(h2hCount>=3)dem+=10;// Established rivalry
        if(aTeam2.wins>=8)dem+=5;// Top team visiting = more butts in seats
      }
      var tp=hTeam.ticketPrice||75;var pf2=1.5-(tp/100);
      var att=cl(Math.round(cap2*(dem/100)*pf2),5000,cap2);
      var gate=(att*tp)/1e6;
      hTeam.cash=(hTeam.cash||50)+gate;hTeam.revenue=(hTeam.revenue||0)+gate;hTeam.attendance=att;
      if(hTeam.stadiumDeal976&&(hTeam.stadiumDeal976.yearsLeft||0)>0){var nrRev=(hTeam.stadiumDeal976.revenue||0)/17;hTeam.cash=(hTeam.cash||50)+nrRev;hTeam.revenue=(hTeam.revenue||0)+nrRev;}
    });
    nt.forEach(function(t){
      var captains=t.roster.filter(function(p){return hasTrait95(p,"captain")&&p.isStarter&&!(p.injury&&p.injury.games>0);});// v95.6: hasTrait95
      var cancers=t.roster.filter(function(p){return hasTrait95(p,"cancer")&&!(p.injury&&p.injury.games>0);});// v95.6: hasTrait95
      var moraleShift=captains.length*2-cancers.length*3;// Captains +2 each, cancers -3 each
      if(moraleShift!==0){
        t.roster.forEach(function(p){p.morale=cl((p.morale||70)+moraleShift,30,99);});
      }
      var lastGame=wg.find(function(g){return g.home===t.id||g.away===t.id;});
      if(lastGame){
        var gIdx=ns.findIndex(function(x){return x.home===lastGame.home&&x.away===lastGame.away&&x.week===lastGame.week;});
        if(gIdx>=0&&ns[gIdx].result){
          var isH=lastGame.home===t.id;
          var won=isH?ns[gIdx].result.home>ns[gIdx].result.away:ns[gIdx].result.away>ns[gIdx].result.home;
          t.roster.forEach(function(p){p.morale=cl((p.morale||70)+(won?rng(1,3):rng(-3,-1)),30,99);});
        }
      }
    });
    nt.forEach(function(t){t.prestige=cl(50+t.wins*4-t.losses*2+(t.pf-t.pa)*0.05,10,99);});
    var u=nt.find(function(t){return t.id===myId;});
    if(u){
      // v97.1: Progressive scouting â€” 1000+ per week, 10% decay on unused
      var prevSP=u.scoutPts||0;
      var uLastGame=wg.find(function(g){return g.home===u.id||g.away===u.id;});
      var uWon=false;
      if(uLastGame){var gi2=ns.findIndex(function(x){return x.home===uLastGame.home&&x.away===uLastGame.away&&x.week===uLastGame.week;});
        if(gi2>=0&&ns[gi2].result){var isH2=uLastGame.home===u.id;uWon=isH2?ns[gi2].result.home>ns[gi2].result.away:ns[gi2].result.away>ns[gi2].result.home;}}
      var decayed97=Math.floor(prevSP*0.9);
      var weeklyGrant971=1000+(season.week||1)*50+(((u.facilities&&u.facilities.gym)||0)*100);
      var winBonus=uWon?200:0;
      u.scoutPts=Math.round(decayed97+weeklyGrant971+winBonus);
      // v97.1: College Pipeline â€” 4 trips/week, 50% carryover on unused
      var prevTrips971=u._pipelineTripsWeekly!=null?u._pipelineTripsWeekly:0;
      var carryover971=Math.floor(prevTrips971*0.5);
      u._pipelineTripsWeekly=4+carryover971;
      // v97.1: Reset chemistry actions each week
      setChemActions(0);
      // v95.7: SHOWTIME trait â€” star players generate extra fanbase buzz on wins
      var hasShowtime97=(u.roster||[]).some(function(p){return hasTrait95(p,"showtime")&&p.isStarter&&!(p.injury&&p.injury.games>0);});
      if(uWon&&season&&season.phase==="regular"&&hasShowtime97){u.fanbase=cl((u.fanbase||55)+1,0,100);}// +1 fanbase on regular-season showtime-team wins
    }
    if(u&&trainAssign){
      var gymBonus=u.facilities?((u.facilities.gym||0)*0.4):0;// Better gym = bigger training gains
      TRAIN_GROUPS.forEach(function(grp){
        var focus=trainAssign[grp.id];if(!focus) return;// No assignment = no boost
        var opt=grp.opts.find(function(o){return o.id===focus;});if(!opt) return;
        var attr=opt.attr;
        var multiAttr=opt.multiAttr||null;
        var isGameplanGroup=grp.isGameplan||false;
        u.roster.forEach(function(p){
          if(grp.pos.indexOf(p.pos)<0) return;// Wrong position group
          if(p.injury&&p.injury.games>0) return;// Injured players can't train
          var gain=rng(0,2)+gymBonus;// 0-2 base + gym
          if(p.devTrait==="superstar")gain+=1;
          if(p.devTrait==="star")gain+=0.5;
          if(p.age>30)gain*=0.5;// Older players gain less
          gain=Math.max(0,gain);// v97.1: training gains are never negative
          if(isGameplanGroup){
            if(multiAttr){
              var splitGain=Math.max(1,Math.round(gain*0.6));
              multiAttr.forEach(function(ma){
                p.ratings[ma]=cl((p.ratings[ma]||50)+splitGain,35,99);
              });
            } else {
              p.ratings[attr]=cl((p.ratings[attr]||50)+Math.round(gain),35,99);
            }
            if(attr!=="awareness"){p.ratings.awareness=cl((p.ratings.awareness||50)+1,35,99);}
          } else {
            p.ratings[attr]=cl((p.ratings[attr]||50)+Math.round(gain),35,99);
            // v93.8: no negative side-effects on other ratings from focused training
          }
          p.ovr=calcOvr(p);
        });
      });
    }
    var dOM=(DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro).ownerMod;
    nt.forEach(function(t){
      var expected=t.ownerGoal==="title"?0.65:t.ownerGoal==="playoff"?0.5:0.3;
      var actual=(t.wins||0)/Math.max(1,(t.wins||0)+(t.losses||0));
      var delta=(actual>=expected?rng(1,3):Math.round(rng(-4,-1)*(t.isUser?dOM:1)));
      if((t.cash||0)<0)delta-=2;
      t.ownerMood=cl((t.ownerMood||70)+delta,5,99);
    });
    nt.forEach(function(t){
      updateCliques(t);
      updateSystemFit(t);
      assignDefaultRoles(t.roster);// v46: Auto-assign roles
      applyFatigueCarryover(t.roster);// v50: Week-to-week fatigue accumulation
    });
    var riv=season.rivalries||{};
    wg.forEach(function(g){
      var gResult=ns.find(function(x){return x.home===g.home&&x.away===g.away&&x.week===g.week;});
      if(!gResult||!gResult.result)return;
      updateRivalries(nt,g.home,g.away,gResult.result,season.phase==="playoffs",season.year);
      var hPR=nt.findIndex(function(t){return t.id===g.home;})+1;
      var aPR=nt.findIndex(function(t){return t.id===g.away;})+1;
      var rivRes=updateRivalryHeat(riv,g.home,g.away,gResult.result,season.phase==="playoffs",hPR,aPR,season.year,season.week);
      riv=rivRes.rivalries;
      var hScore=gResult.result.home||0;var aScore=gResult.result.away||0;
      var hT2=nt.find(function(t){return t.id===g.home;});var aT2=nt.find(function(t){return t.id===g.away;});
      if(hT2)hT2.lastMargin=hScore-aScore;if(aT2)aT2.lastMargin=aScore-hScore;
      if(rivRes.newHeat>=6){
        var scoreDiff2=Math.abs(hScore-aScore);var isPlayoff2=season.phase==="playoffs";
        if(scoreDiff2<=3)addRivalryMoment(riv,rivRes.key,{year:season.year,week:season.week,type:"thriller",text:hScore+"-"+aScore+" thriller"});
        if(isPlayoff2)addRivalryMoment(riv,rivRes.key,{year:season.year,week:season.week,type:"playoff",text:"Playoff showdown ("+hScore+"-"+aScore+")"});
        if(rivRes.reasons.some(function(r){return r.indexOf("upset")>=0;}))addRivalryMoment(riv,rivRes.key,{year:season.year,week:season.week,type:"upset",text:"Upset! ("+hScore+"-"+aScore+")"});
      }
      if((g.home===myId||g.away===myId)&&rivRes.delta>=2){
        var rivOpp=nt.find(function(t){return t.id===(g.home===myId?g.away:g.home);});
        addN("ðŸ”¥ Rivalry heat +"+ rivRes.delta+" vs "+(rivOpp?rivOpp.abbr:"???")+" ("+rivRes.reasons.join(", ")+") â€” Total: "+rivRes.newHeat,rivRes.newHeat>=6?"orange":"gold");
        ledgerLog("RIVALRY_HEAT",myId,"Rivalry heat +"+rivRes.delta+" vs "+(rivOpp?rivOpp.abbr:"???")+" ("+rivRes.reasons.join(", ")+")",
          {key:rivRes.key,delta:rivRes.delta,heat:rivRes.newHeat,reasons:rivRes.reasons});
      }
    });
    Object.keys(riv).forEach(function(rk){
      var rv=riv[rk];if(!rv||rv.heat<7)return;
      if(RNG.play()>0.25)return;// 25% chance per heated rivalry per week
      var tA=nt.find(function(t){return t.id===rv.a;});
      var tB=nt.find(function(t){return t.id===rv.b;});
      if(!tA||!tB)return;
      var fuel=generateFuelEvent(tA,tB,RNG.play());
      fuel.week=season.week;fuel.year=season.year;
      if(!rv.fuelLog)rv.fuelLog=[];
      rv.fuelLog.push(fuel);if(rv.fuelLog.length>5)rv.fuelLog.shift();
      rv.heat=Math.min(20,rv.heat+fuel.heat);
      if(rv.a===myId||rv.b===myId)addN(fuel.emoji+" RIVALRY FUEL: "+fuel.text,"orange");
    });
    setSeason(function(s){return assign({},s,{rivalries:riv});});
    var userNextGame=sched.find(function(g){return g.week===season.week+1&&(g.home===myId||g.away===myId);});
    if(userNextGame){
      var hwOppId=userNextGame.home===myId?userNextGame.away:userNextGame.home;
      var hateWeek=checkHateWeek(season.rivalries||{},myId,hwOppId);
      if(hateWeek){
        var hwOpp=nt.find(function(t){return t.id===hwOppId;});
        var hwEmoji=hateWeek.tier==="BLOOD_FEUD"?"ðŸ”¥ðŸ”¥ðŸ”¥":hateWeek.tier==="BITTER"?"ðŸ”¥ðŸ”¥":"ðŸ”¥";
        addN(hwEmoji+" HATE WEEK: Next up vs "+(hwOpp?hwOpp.icon+hwOpp.abbr:"???")+" (Heat: "+hateWeek.heat+", Series: "+hateWeek.seriesRecord+")","orange");
        var u_hw=nt.find(function(t){return t.id===myId;});
        if(u_hw){u_hw.roster.forEach(function(p){p.morale=cl((p.morale||70)+1,30,99);});}
        ledgerLog("HATE_WEEK",myId,"Hate Week vs "+(hwOpp?hwOpp.abbr:"???")+" â€” Heat "+hateWeek.heat+", Series "+hateWeek.seriesRecord,
          {oppId:hwOppId,heat:hateWeek.heat,tier:hateWeek.tier});
        var myTeam_hw=nt.find(function(t){return t.id===myId;});
        var rb=buildRivalryBroadcast(myTeam_hw,hwOpp,season.rivalries[rivalryKey(myId,hwOppId)],season);
        if(rb)setRivBroadcast(rb);
      }else{setRivBroadcast(null);}
    }else{setRivBroadcast(null);}
    var u_lr=nt.find(function(t){return t.id===myId;});
    if(u_lr){
      var lrEvent=checkLockerEvents(u_lr,true);
      if(lrEvent){
        if(lrEvent.choice&&lrEvent.options){
          if(lrEvent.crisis){
            // CRISIS_ROOM v15: dramatic full-screen popup for high-stakes decisions
            setCrisisRoom({eventId:lrEvent.id,icon:lrEvent.icon,label:lrEvent.label,
              msg:lrEvent.msg,color:lrEvent.color,tier:lrEvent.crisisTier||"CRITICAL",
              headline:lrEvent.headline||lrEvent.label,subtext:lrEvent.subtext||"",
              options:lrEvent.options,week:season.week,year:season.year||0,
              teamAbbr:(u_lr&&u_lr.abbr)||"TEAM"});
          }else{
            addN(lrEvent.icon+" "+lrEvent.msg+" (check inbox)",lrEvent.color);
            setInbox(function(prev){return prev.concat([{id:U(),type:"lockerChoice",icon:lrEvent.icon,
              text:lrEvent.msg,color:lrEvent.color,urgent:true,actionType:"lockerChoice",
              eventId:lrEvent.id,options:lrEvent.options}]);});
          }
        }else{
          addN(lrEvent.icon+" "+lrEvent.msg,lrEvent.color);
        }
        ledgerLog("LOCKER_ROOM_EVENT",myId,lrEvent.label+": "+lrEvent.msg,{eventId:lrEvent.id,week:season.week,isChoice:!!lrEvent.choice,isCrisis:!!lrEvent.crisis});
      }
    }
    nt.forEach(function(t){if(t.id!==myId)checkLockerEvents(t,false);});
    var uG=wg.find(function(g){return g.home===myId||g.away===myId;});
    if(uG){var r2=ns.find(function(x){return x.home===uG.home&&x.away===uG.away&&x.week===uG.week;});
      if(r2&&r2.result){var isH=uG.home===myId;var w2=isH?r2.result.home>r2.result.away:r2.result.away>r2.result.home;
        var opp=nt.find(function(t){return t.id===(isH?uG.away:uG.home);});
        addN("Wk"+season.week+": "+(w2?"âœ… W":"âŒ L")+" vs "+(opp?opp.icon:"")+(opp?opp.abbr:"")+" "+(isH?r2.result.home:r2.result.away)+"-"+(isH?r2.result.away:r2.result.home),w2?"green":"red",{type:"boxScore",game:r2.result});
        setSelGame(r2.result);
        var filmHome=nt.find(function(t){return t.id===uG.home;});
        var filmAway=nt.find(function(t){return t.id===uG.away;});
        var filmAnalysis=FILM.analyze(r2.result,filmHome,filmAway,myId);
        if(filmAnalysis)setFilmRoom(filmAnalysis);
        var isUH77=uG.home===myId;
        var fb77=FILM_BREAKDOWN.generate(r2.result,isUH77?filmHome:filmAway,isUH77?filmAway:filmHome,isUH77);
        if(fb77)setFilmBreakdown77(fb77);
        if(challenges78&&challenges78.length>0){
          var uRecap78=r2.result.recap?(isH?r2.result.recap.home:r2.result.recap.away):null;
          var oRecap78=r2.result.recap?(isH?r2.result.recap.away:r2.result.recap.home):null;
          var challengeResult78={
            userScore:isH?r2.result.home:r2.result.away,
            oppScore:isH?r2.result.away:r2.result.home,
            won:w2,
            rushYds:uRecap78?(uRecap78.rushYds||0):0,
            passYds:uRecap78?(uRecap78.passYds||0):0,
            turnovers:uRecap78?((uRecap78.ints||0)+(uRecap78.fumbles||0)):0,
            totalTD:uRecap78?((uRecap78.passTD||0)+(uRecap78.rushTD||0)):0,
            sacks:oRecap78?(oRecap78.sacks||0):0,
            trailedAtHalf:r2.result.halftime?((isH?r2.result.halftime.homeHalf:r2.result.halftime.awayHalf)||0)<((isH?r2.result.halftime.awayHalf:r2.result.halftime.homeHalf)||0):false
          };
          var cr78=WEEKLY_CHALLENGES.checkResults(challenges78,challengeResult78);
          if(cr78.completed.length>0){
            cr78.completed.forEach(function(cc78){
              addN("ðŸ† CHALLENGE COMPLETE: "+cc78.label+" (+"+cc78.xp+" XP)","gold");
              // v96.1: If focused challenge completed â†’ 3x practice star boost next week
              if(cc78.focused96){
                setChallenge3xNext96(true);
                addN("ðŸ”¥ðŸ”¥ðŸ”¥ FOCUS CHALLENGE COMPLETE! Next week's Practice Star gets 3x attribute boost!","gold");
              }
            });
            setChallenges78(challenges78.slice());// Trigger re-render
          }
        }
        if(uG._primetime78){
          addN(uG._primetime78.icon+" "+uG._primetime78.name+" â€” Primetime spotlight! (XP +"+Math.round((uG._primetime78.xpBonus-1)*100)+"%)","cyan");
        }
        if(r2.result.halftime&&r2.result.halftime.label){
          addN("âš¡ Halftime: "+r2.result.halftime.label+" â†’ "+(w2?"Adjustment worked!":"Wasn't enough."),"cyan");
        }
        setHalftimePlans({});// v93.18: Reset plans map for next week
        (function(){
          var cm68a=CLINIC_MATH.getMods(coachClinic);
          var appliedPerks=[];
          if(cm68a.scoringBoost>0)appliedPerks.push("off1");
          if(cm68a.halftimeBoost>0&&Object.keys(halftimePlans).length>0)appliedPerks.push("off2");
          if(cm68a.sackBoost>0)appliedPerks.push("def1");
          if(cm68a.clutchDefBoost>0)appliedPerks.push("def2");
          if(appliedPerks.length>0){
            setCoachClinic(function(prev){var c=assign({},prev);
              if(!c.perkStats)c.perkStats={};
              appliedPerks.forEach(function(pid){c.perkStats[pid]=(c.perkStats[pid]||0)+1;});
              return c;});
          }
        })();
        if(pracMod.id!=="scout"){
          addN("ðŸ‹ï¸ Practice: "+pracMod.label+(pracMod.fx.dev>0?" â†’ +dev growth":pracMod.fx.injuryRisk<0?" â†’ safer week":""),"cyan");
        }else{
          addN("ðŸ” Practice: Opponent Scout â†’ +system readiness","cyan");
        }
        if(pracMod.fx.dev>0&&userT64){
          var devBump=pracMod.fx.dev;// 0.12 for dev camp, 0.04 for pads
          var clinicDevBoost=CLINIC.hasPerk(coachClinic,"dev1")?CLINIC_MATH.getMods(coachClinic).devBoost:0;
          devBump+=clinicDevBoost;
          if(clinicDevBoost>0)setCoachClinic(function(prev){var c=assign({},prev);CLINIC_MATH.logApply(c,"dev1");return c;});
          userT64.roster.filter(function(p){return p.age<=26&&!(p.injury&&p.injury.games>0);}).forEach(function(p){
            var def64=POS_DEF[p.pos];if(!def64)return;
            var devM64=p.devTrait==="superstar"?1.5:p.devTrait==="star"?1.2:1.0;
            if(RNG.ai()<devBump*devM64*2){// Higher dev focus = more chances
              var rIdx=Math.floor(RNG.ai()*def64.r.length);
              var rating64=def64.r[rIdx];
              p.ratings[rating64]=cl((p.ratings[rating64]||50)+1,35,99);
              p.ovr=calcOvr(p);
            }
          });
        }
        if(r2.result.captainMoments&&r2.result.captainMoments.length>0){
          setCaptMoments(function(prev){
            return{season:prev.season||season.year,used:(prev.used||0)+r2.result.captainMoments.length,
              log:(prev.log||[]).concat(r2.result.captainMoments)};
          });
          r2.result.captainMoments.forEach(function(cm64){
            addN("â­ CAPTAIN MOMENT: "+cm64.text,"gold");
          });
          setCoachClinic(function(prev){return CLINIC.earnXP(assign({},prev),"captain_moment",8);});
          if(CLINIC.hasPerk(coachClinic,"ldr2")&&userT64){
            var ldr2Bonus=r2.result.captainMoments.length;// +1 per moment
            userT64.roster.forEach(function(p){p.morale=cl((p.morale||70)+ldr2Bonus,30,99);});
            setCoachClinic(function(prev){var c=assign({},prev);CLINIC_MATH.logApply(c,"ldr2");return c;});
          }
        }
        var myScore65=isH?r2.result.home:r2.result.away;
        var oppScore65=isH?r2.result.away:r2.result.home;
        var margin65=Math.abs(myScore65-oppScore65);
        var won65=myScore65>oppScore65;
        var oppId65pc=isH?uG.away:uG.home;
        var rKey65=rivalryKey?rivalryKey(myId,oppId65pc):null;
        var isRiv65=rKey65&&season.rivalries&&season.rivalries[rKey65]&&season.rivalries[rKey65].heat>=5;
        var pcCtx={won:won65,lost:!won65,margin:margin65,isRivalry:isRiv65};
        var eligible65=PRESS_QUESTIONS.filter(function(pq){return pq.trigger(pcCtx);});
        if(eligible65.length>0){
          var picked65=eligible65[Math.floor(RNG.play()*eligible65.length)];
          var qText65=picked65.q.replace("{margin}",String(margin65));
          var pcUserTeam65=userT64||nt.find(function(t){return t.id===myId;});
          var pcLead65=null;
          var pcAnalyst65=null;
          if(pcUserTeam65&&opp){
            var pcRecap65=r2.result.recap?(isH?r2.result.recap.home:r2.result.recap.away):null;
            pcLead65=MFSN_BROADCAST.postgameOpener(myScore65,oppScore65,pcUserTeam65,opp,season.week);
            pcAnalyst65=MFSN_BROADCAST.analystTake(won65,pcRecap65);
          }
          setPressConf({q:qText65,opts:picked65.opts,week:season.week,oppName:(opp?opp.icon+opp.abbr:"???"),won:won65,margin:won65?margin65:-margin65,broadcastLead:pcLead65,broadcastAnalyst:pcAnalyst65});
        }
        var oppIdV66=isH?uG.away:uG.home;
        var verifyResult=DOSSIER.verify(scoutDB,oppIdV66,season.year,r2.result,isH);
        if(verifyResult){
          var vrEmoji=verifyResult.status==="confirmed"?"âœ…":"âŒ";
          addN(vrEmoji+" Scout dossier: "+verifyResult.status.replace("_"," ")+" (conf "+verifyResult.delta+")",verifyResult.status==="confirmed"?"green":"orange");
          setScoutDB(assign({},scoutDB));
        }
        if(r2.result.recap){
          var newRecap=isH?r2.result.recap.home:r2.result.recap.away;
          setPrevRecap(gameRecap);// v49: Save previous for "What Changed?" deltas
          setGameRecap(newRecap);
          if(lastFix&&lastFix.weekApplied&&season.week>lastFix.weekApplied&&newRecap){
            var bm=lastFix.beforeMetrics||{};var results=[];var succeeded=false;var fixMag=0;
            var fixType=lastFix.type;
            if(fixType==="quick_pass"||fixType==="run_more"||fixType==="power_run"){
              var pDelta=(newRecap.pressureRate||50)-(bm.pressureRate||50);fixMag=Math.abs(pDelta);
              succeeded=pDelta>0;
              results.push(pDelta>0?"âœ… Pocket protection +"+ pDelta+"%":"âŒ Pocket protection "+pDelta+"%");
            }
            if(fixType==="conservative"){
              var tDelta=(newRecap.turnovers||0)-(bm.turnovers||0);fixMag=Math.abs(tDelta)*15;
              succeeded=tDelta<=0;
              results.push(tDelta<=0?"âœ… Turnovers reduced ("+bm.turnovers+"â†’"+newRecap.turnovers+")":"âŒ Turnovers unchanged ("+newRecap.turnovers+")");
            }
            if(fixType==="zone_def"){
              var cDelta=(newRecap.coverageWin||50)-(bm.coverageWin||50);fixMag=Math.abs(cDelta);
              succeeded=cDelta>0;
              results.push(cDelta>0?"âœ… Coverage improved +"+cDelta+"%":"âŒ Coverage "+cDelta+"%");
            }
            var confidence=fixMag>=15?"HIGH":fixMag>=5?"MED":"LOW";
            var confColor=confidence==="HIGH"?T.green:confidence==="MED"?T.gold:T.faint;
            if(results.length>0){
              addN("ðŸ“Š Fix Result ("+fixType+"): "+results.join(", ")+" [Confidence: "+confidence+"]",succeeded?"green":"orange");
              if(!succeeded){
                var nextSugg=fixType==="quick_pass"?"Consider upgrading OL in trade/FA, or try Ground & Pound":
                  fixType==="conservative"?"Try zone_def to reduce opponent scoring, or upgrade secondary":
                  fixType==="zone_def"?"Consider roster upgrades at CB/S, or blitz_heavy to generate pressure":
                  fixType==="run_more"?"OL may need upgrades, or try play_action to keep defense guessing":
                  "Consider roster moves or different scheme approach";
                addN("ðŸ’¡ Next fix suggestion: "+nextSugg,"info");
              }
              ledgerLog("FIX_RESULT",myId,"Fix result for "+fixType+": "+results.join(", ")+" ["+confidence+"]",
                {fixType:fixType,weekApplied:lastFix.weekApplied,confidence:confidence,succeeded:succeeded,
                  before:bm,after:{pressureRate:newRecap.pressureRate,turnovers:newRecap.turnovers,coverageWin:newRecap.coverageWin,rzEff:newRecap.rzEff}});
            }
            setLastFix(null);// Clear after tracking
          }
        }
      }}
    if(userBye){
      var userAlreadyPlayedThisWk=ns.some(function(g){return g.week===season.week&&(g.home===myId||g.away===myId)&&g.played;});
      if(!userAlreadyPlayedThisWk){
        addN("ðŸ“… Wk"+season.week+": BYE WEEK â€” Your team rests while the league plays on","cyan");
        var newPatience80bye=Math.max(0,Math.min(100,ownerPatience80+2));
        var myT80bye=nt.find(function(t){return t.id===myId;});
        var byeMood80=myT80bye&&typeof myT80bye.ownerMood==="number"?myT80bye.ownerMood:70;
        var prevArc80bye=OWNER_CONFIDENCE_ARC.get(ownerPatience80,byeMood80);
        var nextArc80bye=OWNER_CONFIDENCE_ARC.get(newPatience80bye,byeMood80);
        setOwnerPatience80(newPatience80bye);
        var arcShift80bye=OWNER_CONFIDENCE_ARC.transition(prevArc80bye,nextArc80bye);
        if(arcShift80bye)addN(arcShift80bye.text,arcShift80bye.color);
      }
    }
    nt.forEach(function(t){applyWeeklyRosterScouting(t,season.week);});// v85: in-season scouting reveal progression
    nt.forEach(function(t){if(t.id===myId)t.roster.filter(function(p){return p.injury&&p.injury.games>0;}).forEach(function(p){
      var injN92=getInjuryMask92(p,t);
      addN("ðŸ¤• "+p.name+"("+p.pos+") "+injN92.status,"red",{type:"roster"});
    });});
    genWeeklyWrap(nt,season.week,ns).forEach(function(w3){addN(w3,"info");});
    if(breakouts80&&breakouts80.length>0&&season.phase==="regular"){
      var myT81bk=nt.find(function(t){return t.id===myId;});
      if(myT81bk){
        var updatedBk81=breakouts80.slice();var bkChanged=false;
        updatedBk81.forEach(function(bc){
          var p81=myT81bk.roster.find(function(r){return r.id===bc.playerId;});
          if(p81){var ms=BREAKOUT_SYSTEM.milestoneCheck(bc,p81,season.week);if(ms){addN("ðŸ”¥ BREAKOUT: "+ms.msg,"gold");bkChanged=true;}}
        });
        if(bkChanged)setBreakouts80(updatedBk81);
      }
    }
    if(season.phase==="regular"&&season.week>=2){
      try{
        var ws80=generateWeekShow(nt,ns,season);
        if(ws80&&ws80.rankings){
          var userRank81=0;
          ws80.rankings.forEach(function(r,i){if(r.isUser)userRank81=i+1;});
          if(userRank81>0){setPrHistory81(function(prev){var h=prev.slice();h.push(userRank81);if(h.length>18)h=h.slice(-18);return h;});}
        }
        if(ws80)setWeekShow(ws80);
      }catch(e){console.warn("WeekShow failed wk"+season.week,e);/* graceful fallback */}
    }
    if(u&&u.ownerMood<35)addN("ðŸ”¥ Owner furious! Hot Seat activated.","red");
    else if(u&&u.ownerMood>85)addN("ðŸ˜Š Owner thrilled with performance.","green");
    var uGame=uG?ns.find(function(x){return x.home===uG.home&&x.away===uG.away&&x.week===uG.week;}):null;
    var oppT=uG?nt.find(function(t){return t.id===(uG.home===myId?uG.away:uG.home);}):null;
    var inboxData=genInbox(nt,season.week,(uGame&&uGame.result&&!userBye)?{result:uGame.result,isHome:uG&&uG.home===myId,oppAbbr:oppT?oppT.abbr:""}:null);
    if(u&&u.franchiseTag973&&u.franchiseTag973.reaction==="holdout"){
      var tagP973=u.roster.find(function(p){return p.id===u.franchiseTag973.playerId;});
      if(tagP973&&tagP973.holdout75){
        var holdoutWeeks973=tagP973.holdout75.week||0;
        if(holdoutWeeks973>=2){
          tagP973.ratings.speed=cl((tagP973.ratings.speed||70)-1,40,99);
          tagP973.ratings.awareness=cl((tagP973.ratings.awareness||70)-1,40,99);
          tagP973.ovr=calcOvr(tagP973);tagP973.trueOvr=tagP973.ovr;
        }
        if(holdoutWeeks973>=6&&RNG.play()<0.35){
          tagP973.holdout75=null;
          u.franchiseTag973.reaction="unhappy";
          addN("ðŸ“‹ "+tagP973.name+" ends holdout and reports â€” but he's not happy about it.","orange");
        }
        if(holdoutWeeks973>=1&&holdoutWeeks973<=8){
          var holdoutLines973=[
            tagP973.name+" spotted training privately. Still no contract. Clock ticking.",
            "Agent for "+tagP973.name+": 'My client wants to be paid like the elite player he is.'",
            tagP973.name+" holdout entering week "+holdoutWeeks973+". Teammates starting to talk.",
            "Owner concerned about "+tagP973.name+" holdout â€” your seat is getting warm."
          ];
          inboxData.push({type:"holdout",icon:"ðŸ·ï¸",text:holdoutLines973[holdoutWeeks973%holdoutLines973.length],color:"orange",id:U()});
        }
      }
    }
    var fitReport87=u?buildWeeklyFitReport(u,season.week):null;
    if(fitReport87){
      var fitHeader87=fitReport87.prevAvg===null?"Baseline captured":"Avg "+(fitReport87.avgDelta>=0?"+":"")+fitReport87.avgDelta;
      inboxData.unshift({type:"fit_report",icon:"ðŸ§­",text:"Identity Fit Report: "+fitHeader87+" ("+fitReport87.avgFit+"/100)",
        color:fitReport87.prevAvg===null?"cyan":(fitReport87.avgDelta>=0?"green":"orange"),id:U(),actionType:"fitReport",report:fitReport87});
      if(fitReport87.prevAvg!==null){
        addN("ðŸ§­ Identity Fit: "+(fitReport87.avgDelta>=0?"+":"")+fitReport87.avgDelta+" avg ("+(fitReport87.riseCount||0)+" up / "+(fitReport87.fallCount||0)+" down)","cyan");
      }
      if(fitReport87.groupAlerts&&fitReport87.groupAlerts.length>0){
        var topAlert87=fitReport87.groupAlerts[0];
        var critical87=fitReport87.groupAlerts.some(function(a){return a.severity==="high";});
        var txt87="GM ALERT: "+topAlert87.label+" fit "+topAlert87.current+" for "+topAlert87.streak+" straight weeks below threshold.";
        inboxData.unshift({type:"fit_alert",icon:"ðŸš¨",text:txt87,color:critical87?"red":"orange",id:U(),
          actionType:"fitGroupAlert",alerts:fitReport87.groupAlerts,report:fitReport87});
        addN("ðŸš¨ "+txt87+" "+(topAlert87.note||""),critical87?"red":"orange");
      }
    }
    if(u){
      u._storyFitReport87=fitReport87;
      if(!userBye&&uGame&&uGame.result){
        var isStoryHome87=uG&&uG.home===myId;
        var userPts87=isStoryHome87?uGame.result.home:uGame.result.away;
        var oppPts87=isStoryHome87?uGame.result.away:uGame.result.home;
        u._storyGameCtx87={won:userPts87>oppPts87,margin:userPts87-oppPts87,userScore:userPts87,oppScore:oppPts87};
      }else{u._storyGameCtx87=null;}
      var storyEvents87=checkStoryBeats86(u,season.week);
      if(storyEvents87&&storyEvents87.length){
        storyEvents87.forEach(function(ev){
          if(ev.toast)addN(ev.toast,ev.color||"gold");
        });
        storyBeatQueue87=storyBeatQueue87.concat(storyEvents87);
      }
    }
    if(storyBeatQueue87.length>0)inboxData=storyBeatQueue87.concat(inboxData);
    if(!userBye&&uGame&&uGame.result){
      var isUH=uG&&uG.home===myId;var uScore=isUH?uGame.result.home:uGame.result.away;var oScore=isUH?uGame.result.away:uGame.result.home;
      var tape=uGame.result.tape;var uTape=tape?(isUH?tape.home:tape.away):null;
      setLastGameCtx({
        opp:oppT?oppT.abbr:"OPP",won:uScore>oScore,scoreFor:uScore,scoreAgainst:oScore,margin:uScore-oScore,
        passTD:uTape?uTape.passTD||0:0,rushYds:uTape?uTape.rushYds||0:0,ints:uTape?uTape.turnovers||0:0,
        sacks:uTape?uTape.sacks||0:0,streak:u?(u.streak||0):0
      });
    }
    var tbOffers=genTradeBlockOffers(nt);
    inboxData=inboxData.concat(tbOffers);
    if(season.week<=13&&RNG.ai()<0.20*(DNA_ACTIVE.tradeFreq||1.0)&&u){// v53: DNA slider
      var aiCands=nt.filter(function(t){return !t.isUser;});
      var proposer=aiCands[Math.floor(RNG.ai()*aiCands.length)];
      if(proposer){
        var proposerArchId=getTeamGMArchetypeId90(proposer);
        var needs=getTeamNeeds(proposer);var needPos=Object.keys(needs)[0];
        if(proposerArchId==="old_school"){
          if(needs.OL>0)needPos="OL";
          else if(needs.DL>0)needPos="DL";
        }
        if(needPos){
          var surplus=null;
          if(proposerArchId==="contender"){
            surplus=u.roster.filter(function(p){return p.ovr>=80;}).sort(function(a,b){return b.ovr-a.ovr;})[0]||null;
          }
          if(!surplus){
            surplus=u.roster.filter(function(p){return p.pos===needPos&&!p.isStarter&&p.ovr>=65;}).sort(function(a,b){return b.ovr-a.ovr;})[0]||null;
          }
          if(proposerArchId==="old_school"&&(!surplus||["OL","DL"].indexOf(surplus.pos)<0)){
            surplus=u.roster.filter(function(p){return (p.pos==="OL"||p.pos==="DL")&&p.ovr>=65;}).sort(function(a,b){return b.ovr-a.ovr;})[0]||surplus;
          }
          if(proposerArchId==="rebuilder"&&surplus&&(surplus.age||0)>28)surplus=null;
          if(proposerArchId==="moneyball"&&surplus&&v36_capHit(surplus.contract)>=10&&(surplus.ovr||50)<=76)surplus=null;
          if(surplus){
            var offerItem=null;var getName="";var getType="pick";var getId="";
            var proposerMode=deriveAITeamMode(proposer,season.year);
            if(proposerMode==="contend"){
              var pk=proposer.draftPicks?proposer.draftPicks.find(function(x){return x.round<=(proposerArchId==="contender"?2:3);}):null;
              if(pk){offerItem=pk;getName="Rd"+pk.round+" pick";getType="pick";getId=pk.pid;}
            }
            if(!offerItem){
              var surplusValPre=getTradeValue(surplus,getTeamNeeds(proposer),proposer);
              var vet=proposer.roster.filter(function(p){
                if(p.isStarter)return false;
                if(proposerArchId==="old_school"&&(p.pos==="OL"||p.pos==="DL"))return false;
                if(proposerArchId==="loyalist"&&(p.teamTenure||0)>=3)return false;
                if(proposerMode==="rebuild")return p.ovr>=62&&p.age<=26;
                if(proposerMode==="contend")return p.ovr>=68&&p.age<=31;
                return p.ovr>=65&&p.age<=30;
              }).sort(function(a,b){
                if(proposerArchId==="moneyball"){
                  var aCapRel=(v36_capHit(a.contract)||0)-(a.ovr||50);
                  var bCapRel=(v36_capHit(b.contract)||0)-(b.ovr||50);
                  if(aCapRel!==bCapRel)return bCapRel-aCapRel;
                }
                return Math.abs(getTradeValue(a,getTeamNeeds(u),u)-surplusValPre)-Math.abs(getTradeValue(b,getTeamNeeds(u),u)-surplusValPre);
              })[0];
              if(vet&&Math.abs(vet.ovr-surplus.ovr)>15){
                vet=proposer.roster.filter(function(p){
                  if(p.isStarter)return false;
                  var modePass=proposerMode==="rebuild"?(p.ovr>=62&&p.age<=26):(proposerMode==="contend"?(p.ovr>=68&&p.age<=31):(p.ovr>=65&&p.age<=30));
                  return modePass&&Math.abs(p.ovr-surplus.ovr)<=15;
                }).sort(function(a,b){
                  return Math.abs(getTradeValue(a,getTeamNeeds(u),u)-surplusValPre)-Math.abs(getTradeValue(b,getTeamNeeds(u),u)-surplusValPre);
                })[0];
              }
              if(vet){offerItem=vet;getName=vet.name+"("+vet.pos+" "+vet.ovr+")";getType="player";getId=vet.id;}
            }
            if(offerItem){
              var surplusVal=getTradeValue(surplus,getTeamNeeds(proposer),proposer);
              var offerPackage972=[];var pkgKeys972={};
              function pushPkg972(obj){
                if(!obj)return false;
                var key972=(obj.type||"?")+":"+(obj.id||"");
                if(pkgKeys972[key972])return false;
                pkgKeys972[key972]=1;
                offerPackage972.push(obj);
                return true;
              }
              if(getType==="pick"){
                pushPkg972({type:"pick",id:getId,name:"Rd"+offerItem.round+" pick",pickRound:offerItem.round});
              }else{
                pushPkg972({type:"player",id:getId,name:getName});
              }
              var offerVal=getType==="pick"?pickValue(offerItem.round):getTradeValue(offerItem,getTeamNeeds(u),u);
              var ratio=offerVal/(surplusVal||1);
              var ovrGap=getType==="player"?Math.abs((offerItem.ovr||0)-surplus.ovr):0;
              if(ovrGap>18){ratio=0;}// Force skip if star-for-scrub
              if(offerVal<surplusVal*0.75&&offerPackage972.length>0){
                var sweetPk=proposer.draftPicks?proposer.draftPicks.find(function(x){
                  return x.round<=5&&!pkgKeys972["pick:"+x.pid];
                }):null;
                if(sweetPk){
                  var cond972=maybeBuildPickCondition972(sweetPk);
                  if(pushPkg972({type:"pick",id:sweetPk.pid,name:"Rd"+sweetPk.round+" pick",pickRound:sweetPk.round,condition:cond972})){
                    offerVal+=pickValue(sweetPk.round);
                  }
                }
              }
              if(offerVal<surplusVal*0.70&&offerPackage972.length<=2){
                var sweetPlayer=proposer.roster.filter(function(p){
                  return !p.isStarter&&p.ovr>=60&&!pkgKeys972["player:"+p.id];
                }).sort(function(a,b){return b.ovr-a.ovr;})[0];
                if(sweetPlayer){
                  if(pushPkg972({type:"player",id:sweetPlayer.id,name:sweetPlayer.name+" ("+sweetPlayer.pos+" "+sweetPlayer.ovr+")"})){
                    offerVal+=getTradeValue(sweetPlayer,null,u);
                  }
                }
              }
              ratio=offerVal/(surplusVal||1);
              if(ratio<0.75||ratio>1.55){
              } else {
                var getName972=offerPackage972.map(function(o){return o.name;}).join(" + ");
                var firstOffer972=offerPackage972[0]||{type:getType,id:getId};
                var gradeRatio=offerVal/(surplusVal||1);
                var tradeGrade=gradeRatio>=1.15?"A":gradeRatio>=0.95?"B":gradeRatio>=0.80?"C":"D";
                logAIDecision(proposer.abbr,proposer.aiStrategy||"bubble","TRADE_OFFER",
                  (proposer.aiStrategy||"bubble")+" + Need: "+needPos+" â†’ offered "+getName972+" for "+surplus.name+" ratio:"+ratio.toFixed(2));
                var proposerArch93=getTeamGMArchetype90(proposer);
                var tradePitch93=getGMTradePitch(proposerArch93?proposerArch93.id:null,RNG.draft);
                inboxData.push({type:"trade_offer",icon:"ðŸ“ž",id:U(),actionType:"aiTrade",
                  text:proposer.icon+proposer.abbr+" offers package for your "+surplus.name+"("+surplus.pos+" "+surplus.ovr+")",
                  pitch:tradePitch93,
                  color:"gold",urgent:true,aiId:proposer.id,
                  giveId:surplus.id,giveName:surplus.name,giveOvr:surplus.ovr,givePos:surplus.pos,
                  offerPackage972:offerPackage972,
                  getId:firstOffer972.id,getName:getName972,getType:firstOffer972.type,pickRound:firstOffer972.pickRound||null,
                  offerVal:Math.round(offerVal),surplusVal:Math.round(surplusVal),tradeGrade:tradeGrade});
              }
            }
          }
        }
      }
    }
    var nSeason=assign({},season,{week:season.week+1,ledger:wkLedger});
    var bRecap=buildBroadcastRecap(nt,ns,nSeason,myId);
    if(bRecap){
      setBroadcast(bRecap);
      var weekGames2=(ns||sched).filter(function(g2){return g2.week===season.week;});
      var gotwResult=pickGameOfTheWeek(weekGames2,nt,bRecap.powerRankings,myId);
      if(gotwResult)setGotw(gotwResult);
      var potwResult=pickPlayersOfWeek(nt,weekGames2);
      if(potwResult)setPotw(potwResult);
    }
    if(owner&&u){
      var newOwner=updateOwnerApproval(owner,u,nSeason);
      setOwner(newOwner);
      var newMandates=checkMandates(mandates,u,nSeason);
      setMandates(newMandates);
    }
    if(u){
      var ms=checkMilestones(u,history);
      ms.forEach(function(m){
        inboxData.push({type:"milestone",icon:m.emoji,text:m.text,color:"gold",id:U()});
        addN(m.text,"gold");
      });
    }
    if(u){
      var milestones76=MILESTONE_CELEBRATION.checkWeekly(u,season.week);
      milestones76.forEach(function(mc){
        addN(mc.text,"gold");
        inboxData.push({type:"milestone_celebration",icon:mc.emoji,text:mc.text,color:"gold",id:U()});
      });
    }
    if(TRADE_DEADLINE_FRENZY.isDeadlineWindow(season.week)){
      var aiTrades76=TRADE_DEADLINE_FRENZY.generateAITrades(nt,season.week,myId);
      aiTrades76.forEach(function(tr76){
        addN("ðŸ“° TRADE: "+tr76.text,"orange");
        inboxData.push({type:"trade_deadline",icon:"ðŸ“°",text:tr76.text,color:"orange",id:U()});
      });
      if(season.week===8)addN("ðŸ”¥ TRADE DEADLINE WINDOW OPEN â€” Deals are flying across the league!","gold");
      if(season.week===10)addN("â° TRADE DEADLINE HAS PASSED â€” No more deals until the offseason.","red");
    }
    var aiMoves77=AI_ROSTER_MOVES.generateWeekly(nt,myId,season.week);
    aiMoves77.forEach(function(mv77){
      addN(mv77.emoji+" "+mv77.text,"cyan");
      inboxData.push({type:"roster_move",icon:mv77.emoji,text:mv77.text,color:"cyan",id:U()});
    });
    if(season.week>=2){
      var pr77=POWER_RANKINGS_SHOW.generate(nt,season.week,myId);
      if(pr77)setPowerRankShow77(pr77);
    }
    if(season.phase==="regular"&&season.week>=1){
      var gameResult975=(uGame&&uGame.result&&!userBye)?{result:uGame.result,isHome:!!(uG&&uG.home===myId),oppAbbr:oppT?oppT.abbr:""}:null;
      var arcSpots975=(ws80&&ws80.arcSpots&&ws80.arcSpots.length)?ws80.arcSpots:[];
      var weeklyShow975=MFSN_WEEKLY975.buildShow(nt,myId,season.week,gameResult975,arcSpots975,pr77||null,ws80||null,season);
      // v97.7: RIVALRY_WATCH segment for next week's rivalry game
      if(weeklyShow975&&weeklyShow975.segments){var u977mfsn=nt.find(function(t){return t.id===myId;});
        if(u977mfsn){var ngMfsn=sched.find(function(g){return g.week===season.week+1&&!g.played&&(g.home===myId||g.away===myId);});
          if(ngMfsn){var oId977m=ngMfsn.home===myId?ngMfsn.away:ngMfsn.home;var oTm977m=nt.find(function(t){return t.id===oId977m;});
            var rObj977m=_findRivalObj(u977mfsn,oId977m);
            if(rObj977m&&oTm977m){var atmo977m=RIVALRY_WEEK977.getAtmosphere(u977mfsn,oTm977m,rObj977m,season.week+1);
              if(atmo977m)weeklyShow975.segments.push({type:"RIVALRY_WATCH",title:atmo977m.emoji+" RIVALRY WATCH",data:atmo977m});}}}}
      if(weeklyShow975)setMfsnWeekly975(weeklyShow975);
    }
    if(u&&season.week>=4){
      var roles77=["HC","OC","DC"];
      roles77.forEach(function(role77){
        var temp77=HOT_SEAT.calcTemp(u,role77,nSeason);
        var label77=HOT_SEAT.getLabel(temp77);
        var coach77=role77==="HC"?u.staff.hc:role77==="OC"?u.staff.oc:u.staff.dc;
        if(coach77)coach77.seatTemp77=temp77;
        if(temp77>=65){
          addN(label77.emoji+" "+role77+" "+coach77.name+" seat: "+label77.label+" ("+temp77+"/100)","orange");
        }
        if(HOT_SEAT.shouldFire(temp77)&&!u.isUser){
          addN("ðŸ”¥ "+role77+" "+coach77.name+" has been FIRED! Owner demands a change.","red");
        }
      });
    }
    if(!challenges78||challenges78.length===0||challenges78[0].week!==season.week){
      var wc78=WEEKLY_CHALLENGES.generateWeekly(season.week);
      setChallenges78(wc78);
    }
    var newsItems78=NEWS_TICKER.generateWeekly(nt,myId,season.week,fas);
    if(newsItems78.length>0)setNewsTicker78(newsItems78);
    if(wg&&wg.length>0){
      PRIMETIME_SCHEDULING.assignPrimetime(wg,nt,myId);
    }
    if(history.length>0&&CACHED_LEADERS_YEAR!==nSeason.year){
      CACHED_LEADERS=buildAllTimeLeaders(history);
      CACHED_LEADERS_YEAR=nSeason.year;
    }
    if(owner){
      var ownerEvt=generateOwnerEvent(owner,nSeason,RNG.ai);
      if(ownerEvt){
        inboxData.push({type:"owner_event",icon:ownerEvt.emoji,text:ownerEvt.text,color:ownerEvt.type==="ultimatum"?"red":ownerEvt.type==="warning"?"orange":"gold",id:U()});
        addN(ownerEvt.text,ownerEvt.type==="ultimatum"?"red":ownerEvt.type==="warning"?"orange":"gold");
      }
    }
    if(owner&&my){
      var persEvt=checkOwnerPersonality(owner,my,nSeason,RNG.ai);
      if(persEvt){
        inboxData.push({type:"owner_personality",icon:persEvt.emoji,text:persEvt.msg,color:persEvt.tag==="PRESSURE"?"red":persEvt.tag==="WARNING"?"orange":"gold",id:broadcastEventId("owner")});
        addN(persEvt.emoji+" Owner: "+persEvt.msg,persEvt.tag==="PRESSURE"?"red":persEvt.tag==="WARNING"?"orange":"gold");
        if(owner.approval!==undefined)setOwner(function(o){return assign({},o,{approval:cl((o.approval||50)+persEvt.mood,0,100)});});
      }
    }
    setInbox(inboxData);setInboxRead(false);
    if(nSeason.week===10&&nSeason.phase==="regular"){
      var dlShow=buildTradeDeadlineShow(nt,nSeason,txLog);
      if(dlShow)setDeadlineShow(dlShow);
    }
    if(uG&&uGame&&uGame.result&&oppT){
      var isH2=uG.home===myId;
      var presserQs=genPresser(u,oppT,uGame.result,isH2);
      if(presserQs.length>0)setPresser({questions:presserQs,current:0,answers:[],done:false});
    }
    logTx("SIM_WEEK",{week:season.week,record:(u?u.wins:0)+"-"+(u?u.losses:0),mood:u?u.ownerMood:0,cash:u?Math.round(u.cash):0});
    wg.forEach(function(g){
      var gi3=ns.findIndex(function(x){return x.home===g.home&&x.away===g.away&&x.week===g.week;});
      if(gi3>=0&&ns[gi3].result){
        var r3=ns[gi3].result;var hN=nt.find(function(t){return t.id===g.home;});var aN=nt.find(function(t){return t.id===g.away;});
        var hAbbr=hN?hN.abbr:"?";var aAbbr=aN?aN.abbr:"?";
        wkLedger=LEDGER.log(wkLedger,"GAME",g.home,
          hAbbr+" "+r3.home+" - "+aAbbr+" "+r3.away,
          {homeId:g.home,awayId:g.away,homeScore:r3.home,awayScore:r3.away},
          season.year,season.week,"regular");
      }
    });
    nt.forEach(function(t){t.roster.forEach(function(p){
      if(p.injury&&p.injury.games>0&&p.injury.type){
        var alreadyLogged=wkLedger.some(function(e){return e.type==="INJURY"&&e.data&&e.data.pid===p.id&&e.week===season.week;});
        if(!alreadyLogged){
          wkLedger=LEDGER.log(wkLedger,"INJURY",t.id,
            p.name+"("+p.pos+") "+p.injury.type+" â€” out "+p.injury.games+" weeks",
            {pid:p.id,name:p.name,pos:p.pos,type:p.injury.type,games:p.injury.games},
            season.year,season.week,"regular");
        }
      }
    });});
    if(uGame&&uGame.result&&uGame.result.recap&&u){
      var isUH2=uG.home===myId;
      var uRecap2=isUH2?uGame.result.recap.home:uGame.result.recap.away;
      var uScore2=isUH2?uGame.result.home:uGame.result.away;
      var oScore2=isUH2?uGame.result.away:uGame.result.home;
      var expl=EXPLAIN.game(uRecap2,u.abbr,oppT?oppT.abbr:"OPP",uScore2>oScore2);
      uGame.result.explain=expl;
    }
    tickStories(nt,season.week+1);
    // STORY_ARC: tick narrative arcs for user roster each week
    (function(){
      var arcTeam=nt.find(function(t){return t.id===myId;});
      if(arcTeam&&arcTeam.roster){
        STORY_ARC_ENGINE.tickTeam(arcTeam.roster,arcTeam.wins||0,arcTeam.losses||0,season.week+1,addN);
      }
    })();
    var calEv=CALENDAR.find(function(c){return c.week===season.week+1;});
    if(calEv){setCalAlert(calEv);addN(calEv.icon+" "+calEv.event+": "+calEv.desc,"gold");}
    if(season.week+1===10){addN("ðŸ”” TRADE DEADLINE â€” Trading is now closed until the offseason.","orange");}
    if(season.week+1===8){addN("â° Trade deadline in 2 weeks â€” make your moves!","orange");}
    if(season.week+1===9&&TRADE_DEADLINE_994.deadlineFrenzy&&TRADE_DEADLINE_994.deadlineFrenzy.length){addN("ðŸ“± "+pick(TRADE_DEADLINE_994.deadlineFrenzy),"orange");}
    // v97.7: Generate postgame locker room
    (function(){
      var uGm977=wg.find(function(g){return g.home===myId||g.away===myId;});
      if(uGm977){var uRes977=ns.find(function(x){return x.home===uGm977.home&&x.away===uGm977.away&&x.week===uGm977.week;});
        if(uRes977&&uRes977.result){var isUH977=uGm977.home===myId;var uWon977=isUH977?uRes977.result.home>uRes977.result.away:uRes977.result.away>uRes977.result.home;
          var uScr977=isUH977?uRes977.result.home:uRes977.result.away;var oScr977=isUH977?uRes977.result.away:uRes977.result.home;
          var uTeam977=nt.find(function(t){return t.id===myId;});var oTeam977=nt.find(function(t){return t.id===(isUH977?uGm977.away:uGm977.home);});
          var isRiv977=!!(oTeam977&&_findRivalObj(uTeam977||{},oTeam977.id)&&(_findRivalObj(uTeam977||{},oTeam977.id).heat||0)>=40);
          var lockerScene977=POSTGAME_LOCKER977.generate(uWon977,uScr977,oScr977,uTeam977||{},isRiv977);
          setPostgameLocker977(lockerScene977);setGameDayPhase977("postgame");
          (function(){var _tm977=(uTeam977&&(uTeam977.city||uTeam977.name))||"The team";var _sc977=uScr977+"-"+oScr977;var _marg977=Math.abs(uScr977-oScr977);if(_marg977>=21&&MFSN_SITUATIONAL_994.situational){var _sArr977=uWon977?MFSN_SITUATIONAL_994.situational.blowoutOffense:MFSN_SITUATIONAL_994.situational.blowoutDefense;if(_sArr977&&_sArr977.length)addN("ðŸŽ¤ "+pick(_sArr977),"blue");}
          if(uWon977&&SOCIAL_FEED_994.fans.bigWin&&SOCIAL_FEED_994.fans.bigWin.length){var _s977=pick(SOCIAL_FEED_994.fans.bigWin).replace(/\[TEAM\]/g,_tm977).replace(/\[SCORE\]/g,_sc977);addN("ðŸ“± Social: "+_s977,"blue");}else if(!uWon977&&SOCIAL_FEED_994.fans.badLoss&&SOCIAL_FEED_994.fans.badLoss.length){var _s977b=pick(SOCIAL_FEED_994.fans.badLoss).replace(/\[TEAM\]/g,_tm977).replace(/\[SCORE\]/g,(oScr977+"-"+uScr977));addN("ðŸ“± Social: "+_s977b,"blue");}})();
        }
      }
    })();
    setTeams(nt);setSched(ns);setSeason(function(s){return assign({},s,{week:s.week+1,ledger:wkLedger});});
    setTab("inbox");
    // v98.6: Weekly hooks â€” Power Rankings, Press Conference, Timeline, GM Rep
    (function(){try{
      // #15: Power Rankings
      var prevR=powerRankings986.slice();setPrevRankings986(prevR);
      var newR=POWER_RANKINGS_986.generate(nt,season.week);
      // Calculate rank changes
      newR.forEach(function(r){
        var prev=prevR.find(function(p){return p.team&&r.team&&p.team.id===r.team.id;});
        r.change=prev?(prev.rank-r.rank):0;
      });
      setPowerRankings986(newR);
      // #9: Press Conference (after user game)
      var uTeam986=nt.find(function(t){return t.id===myId;});
      var uGame986=ns.find(function(g){return g.week===season.week&&g.played&&(g.home===myId||g.away===myId);});
      if(uTeam986&&uGame986&&uGame986.result){
        var uWon986=uGame986.home===myId?uGame986.result.home>uGame986.result.away:uGame986.result.away>uGame986.result.home;
        var uDiff986=uGame986.home===myId?(uGame986.result.home-uGame986.result.away):(uGame986.result.away-uGame986.result.home);
        var pc986=PRESS_CONF_986.generate(uTeam986,season.week,uWon986,uDiff986,RNG.ui||Math.random);
        var qs986=pc986.questions||pc986||[];// v99.2 compat (now returns obj with .questions)
        if(qs986.length>0)setPressConf986({week:season.week,won:uWon986,diff:uDiff986,questions:qs986,coachQuote:pc986.coachQuote||null,answered:false});
      }
      // #7: GM Reputation update
      setGmRep986(GM_REP_986.calculate(txLog,tradeState));
      // #13: Timeline events
      if(uTeam986){
        var wStr986=uTeam986.wins+"-"+uTeam986.losses;
        if(uTeam986.wins===1&&uTeam986.losses===0)setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year,season.week,"milestone","First win of the season!","ðŸŽ¯");});
        if(uTeam986.streak>=5)setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year,season.week,"milestone",uTeam986.streak+"-game win streak!","ðŸ”¥");});
      }
    }catch(e986){console.error("v98.6 weekly hooks error:",e986);}})();
    doSave(nt,ns,{year:season.year,week:season.week+1,phase:"regular",ledger:wkLedger});
    }catch(e){addN("âŒ Sim error: "+e.message,"red");console.error("simWeek error:",e);alert("Sim error â€” please try again.\n\n"+e.message);}
  }
  // v97.7: Game Day Handlers
  function handleGameDayStart977(){
    var my977=teams.find(function(t){return t.id===myId;});
    if(!my977||season.phase!=="regular")return simWeek();
    var nextG977=sched.find(function(g){return g.week===season.week&&!g.played&&(g.home===myId||g.away===myId);});
    if(!nextG977)return simWeek();
    var oppId977h=nextG977.home===myId?nextG977.away:nextG977.home;
    var oppT977h=teams.find(function(t){return t.id===oppId977h;});
    if(!oppT977h)return simWeek();
    var rivalObj977h=_findRivalObj(my977,oppId977h);
    var atmo977h=rivalObj977h?RIVALRY_WEEK977.getAtmosphere(my977,oppT977h,rivalObj977h,season.week):null;
    var gotw977h=GAME_OF_WEEK977.pick(sched,teams,season.week,myId);
    var isPlayoff977h=season.phase==="playoffs";
    var speeches977h=PREGAME_TALK977.generate(my977,oppT977h,season,atmo977h,isPlayoff977h);
    setOppTeam977(oppT977h);
    setRivalryAtmo977(atmo977h);
    setGotwData977(gotw977h||null);
    setPregameTalk977(speeches977h);
    setGameDayPhase977("pregame");
  }
  function handlePregameSpeech977(speechId){
    var speech=(pregameTalk977||[]).find(function(s){return s.id===speechId;});
    if(!speech){setPregameTalk977(null);setGameDayPhase977(null);simWeek();return;}
    var nt977=teams.slice();
    var u977=nt977.find(function(t){return t.id===myId;});
    if(u977){var fx977=speech.effect||{};
      if(fx977.moraleBoost)u977.roster.forEach(function(p){p.morale=cl((p.morale||70)+fx977.moraleBoost,15,100);});
      if(fx977.chemBoost)u977.roster.forEach(function(p){p.chemistry=cl((p.chemistry||60)+fx977.chemBoost,15,100);});
    }
    _speechFxRef977.current={turnoverMod:speech.effect.turnoverRisk||0,injuryMod:speech.effect.injuryRisk||0,clutchMod:speech.effect.clutchBoost||0,speechId:speechId};
    setPregameChoice977(speech);
    setPregameTalk977(null);
    setTeams(nt977);
    addN("ðŸŽ¤ \""+speech.text.substring(0,60)+"...\"","cyan");
    // Show halftime panel before sim
    var htPanel977=HALFTIME_PANEL977.generate(0);
    setHalftimePanel977({adjustments:htPanel977,speechLabel:speech.label});
    setGameDayPhase977("halftime");
  }
  function handleHalftimeChoice977(adjId){
    var adj=(halftimePanel977&&halftimePanel977.adjustments)?halftimePanel977.adjustments.find(function(a){return a.id===adjId;}):null;
    if(adj){_halftimeFxRef977.current={scoringMod:adj.effect.scoringMod||0,turnoverMod:adj.effect.turnoverMod||0,clockMod:adj.effect.clockMod||0,clutchMod:adj.effect.clutchMod||0};
      setHalftimeChoice977(adj);addN("ðŸŽ¬ Halftime plan: "+adj.label,"cyan");
    }
    setHalftimePanel977(null);
    setGameDayPhase977(null);
    simWeek();
  }
  function simSeason(){
    // simSeason called
    if(season.phase!=="regular"){addN("âš ï¸ Sim Season only works during regular season (current: "+season.phase+")","yellow");return;}
    // v98: Generate goals if not set yet (user pressed Sim Season before playing any weeks)
    if(ownerGoals.length===0&&my){
      var sg98ss=generateSeasonGoals(my);setOwnerGoals(sg98ss.ownerGoals);setCoachGoals(sg98ss.coachGoals);
      var pg98ss=generatePlayerGoals(my);setPlayerGoals(pg98ss);
      setSeasonTracking({blowoutLosses:0,shutoutLosses:0,bestWinStreak:0,currentStreak:0,madePlayoffs:false,isChamp:false});
    }
    try{
    var nt=teams.map(function(t){return assign({},t,{roster:t.roster.map(function(p){return assign({},p,{ratings:assign({},p.ratings),stats:assign({},p.stats||{})});})});});
    var ns=sched.map(function(g){return assign({},g);});
    var maxW=Math.max.apply(null,ns.map(function(g){return g.week;}));
    var curW=season.week;
    var userSummary={wins:0,losses:0,results:[]};
    var ssTrack98={blowoutLosses:0,shutoutLosses:0,bestWinStreak:0,currentStreak:0};// v98: track for goals
    var dS=DIFF_SETTINGS[DIFF_ACTIVE]||DIFF_SETTINGS.pro;
    for(var wk=curW;wk<=maxW;wk++){
      syncLeagueAIModes(nt,season.year);
      runAICapOps973(nt,season.year);// v97.3: AI cap ops during full season sim
      var wg=ns.filter(function(g){return g.week===wk&&!g.played;});
      if(!wg.length) continue;
      wg.forEach(function(g){
        var h=nt.find(function(t){return t.id===g.home;});var a=nt.find(function(t){return t.id===g.away;});
        if(!h||!a) return;
        var isUserGame73=(g.home===myId||g.away===myId);
        var r;try{r=isUserGame73?simGame(h,a):SIM_CULL.simAIGame(h,a,false);}catch(sg){console.error("[simSeason] simGame err wk"+wk,sg);return;}
        if(!r)return;
        var gi=ns.findIndex(function(x){return x.home===g.home&&x.away===g.away&&x.week===g.week;});
        if(gi>=0){ns[gi].played=true;ns[gi].result=r;}
        if(r.home>r.away){h.wins++;a.losses++;h.streak=Math.max(1,(h.streak||0)+1);a.streak=Math.min(-1,(a.streak||0)-1);}
        else{a.wins++;h.losses++;a.streak=Math.max(1,(a.streak||0)+1);h.streak=Math.min(-1,(h.streak||0)-1);}
        h.pf+=r.home;h.pa+=r.away;a.pf+=r.away;a.pa+=r.home;
        if(!h.weekLog)h.weekLog=[];h.weekLog.push(r.home-r.away);if(h.weekLog.length>8)h.weekLog=h.weekLog.slice(-8);
        if(!a.weekLog)a.weekLog=[];a.weekLog.push(r.away-r.home);if(a.weekLog.length>8)a.weekLog=a.weekLog.slice(-8);
        h.fanbase=cl((h.fanbase||60)+(r.home>r.away?2:-1),10,99);
        a.fanbase=cl((a.fanbase||60)+(r.away>r.home?2:-1),10,99);
        if(g.home===myId||g.away===myId){
          var isH=g.home===myId;var w2=isH?r.home>r.away:r.away>r.home;
          var opp=nt.find(function(t){return t.id===(isH?g.away:g.home);});
          if(w2)userSummary.wins++;else userSummary.losses++;
          userSummary.results.push({wk:wk,win:w2,score:(isH?r.home:r.away)+"-"+(isH?r.away:r.home),opp:opp?opp.icon+opp.abbr:"?"});
          // v98: Track season goals stats
          var uScore98=isH?r.home:r.away;var oScore98=isH?r.away:r.home;
          if(!w2&&(oScore98-uScore98)>=21)ssTrack98.blowoutLosses++;
          if(!w2&&uScore98===0)ssTrack98.shutoutLosses++;
          if(w2){ssTrack98.currentStreak++;ssTrack98.bestWinStreak=Math.max(ssTrack98.bestWinStreak,ssTrack98.currentStreak);}
          else{ssTrack98.currentStreak=0;}
        }
      });
      nt.forEach(function(t){
        var sal=t.capUsed/14;t.cash=(t.cash||50)-sal;t.expenses=(t.expenses||0)+sal;
      });
      wg.forEach(function(g){
        var hTeam=nt.find(function(t){return t.id===g.home;});if(!hTeam) return;
        var stadLvl=hTeam.facilities?hTeam.facilities.stad||0:0;
        var cap2=getFacilFx("stad",stadLvl)*1000;
        var dem=(hTeam.fanbase||55)+(hTeam.wins*5)-(hTeam.losses*2);
        var tp=hTeam.ticketPrice||75;var pf2=1.5-(tp/100);
        var att=cl(Math.round(cap2*(dem/100)*pf2),5000,cap2);
        var gate=(att*tp)/1e6;
        hTeam.cash=(hTeam.cash||50)+gate;hTeam.revenue=(hTeam.revenue||0)+gate;hTeam.attendance=att;
      });
      nt.forEach(function(t){var medBonus=getFacilFx("med",t.facilities?t.facilities.med||0:0);
        t.roster.forEach(function(p){if(p.injury&&p.injury.games>0){var heal=RNG.injury()*10<medBonus?2:1;decrementPlayerInjury92(p,heal);}});});
      nt.forEach(function(t){applyWeeklyRosterScouting(t,wk);});// v85: scouting confidence progresses during sim-season
      nt.forEach(function(t){
        var expected=t.ownerGoal==="title"?0.65:t.ownerGoal==="playoff"?0.5:0.3;
        var actual=(t.wins||0)/Math.max(1,(t.wins||0)+(t.losses||0));
        var delta=(actual>=expected?rng(1,3):Math.round(rng(-4,-1)*(t.isUser?dS.ownerMod:1)));
        if((t.cash||0)<0)delta-=2;
        t.ownerMood=cl((t.ownerMood||70)+delta,5,99);
      });
      nt.forEach(function(t){t.prestige=cl(50+t.wins*4-t.losses*2+(t.pf-t.pa)*0.05,10,99);});
      var u=nt.find(function(t){return t.id===myId;});
      if(u){
        if(u.franchiseTag973&&u.franchiseTag973.reaction==="holdout"){
          var tagPSS=u.roster.find(function(p){return p.id===u.franchiseTag973.playerId;});
          if(tagPSS&&tagPSS.holdout75){
            tagPSS.holdout75.week=(tagPSS.holdout75.week||0)+1;
            if((tagPSS.holdout75.week||0)>=2){
              tagPSS.ratings.speed=cl((tagPSS.ratings.speed||70)-1,40,99);
              tagPSS.ratings.awareness=cl((tagPSS.ratings.awareness||70)-1,40,99);
              tagPSS.ovr=calcOvr(tagPSS);tagPSS.trueOvr=tagPSS.ovr;
            }
            if((tagPSS.holdout75.week||0)>=6&&RNG.play()<0.35){
              tagPSS.holdout75=null;
              u.franchiseTag973.reaction="unhappy";
            }
          }
        }
        // v97.1: Progressive scouting for Sim Season path â€” mirrors weekly sim logic
        var prevSP2=u.scoutPts||0;
        var uWon2=userSummary.results.length>0&&userSummary.results[userSummary.results.length-1].win;
        var decayed972=Math.floor(prevSP2*0.9);
        var weeklyGrant972=1000+(wk||1)*50+(((u.facilities&&u.facilities.gym)||0)*100);
        var winBonus2=uWon2?200:0;
        u.scoutPts=Math.round(decayed972+weeklyGrant972+winBonus2);
        var prevTrips972=u._pipelineTripsWeekly!=null?u._pipelineTripsWeekly:0;
        var carryover972=Math.floor(prevTrips972*0.5);
        u._pipelineTripsWeekly=4+carryover972;
      }
    }
    checkRecords(nt,season.year);
    var u2=nt.find(function(t){return t.id===myId;});
    setNews([]);
    addN("âš¡ SEASON SIMULATED â€” "+((maxW-curW)+1)+" weeks in an instant!","gold");
    addN("ðŸ“Š Your record: "+userSummary.wins+"-"+userSummary.losses+(u2?" | Cash: $"+Math.round(u2.cash)+"M":""),"cyan");
    var last5=userSummary.results.slice(-5);
    last5.forEach(function(r){addN("Wk"+r.wk+": "+(r.win?"âœ… W":"âŒ L")+" vs "+r.opp+" "+r.score,r.win?"green":"red");});
    var sorted=nt.slice().sort(function(a,b){return b.wins-a.wins||(b.pf-b.pa)-(a.pf-a.pa);});
    addN("ðŸˆ #1 "+sorted[0].icon+sorted[0].abbr+" "+sorted[0].wins+"-"+sorted[0].losses+" | #2 "+sorted[1].icon+sorted[1].abbr+" "+sorted[1].wins+"-"+sorted[1].losses,"info");
    if(u2&&u2.ownerMood<35)addN("ðŸ”¥ Owner furious! Hot Seat activated.","red");
    else if(u2&&u2.ownerMood>85)addN("ðŸ˜Š Owner thrilled with performance.","green");
    setChemActions(0);
    setSeasonTracking(ssTrack98);// v98: Pass tracking to goal evaluation
    setTeams(nt);setSched(ns);
    setSeason(function(s){return assign({},s,{week:maxW+1,phase:"playoffs"});});
    setTab("home");
    doSave(nt,ns,assign({},season,{week:maxW+1,phase:"playoffs"}));
    }catch(e){addN("âŒ Sim Season error: "+e.message,"red");console.error("simSeason error:",e);alert("Sim Season error â€” please try again.\n\n"+e.message);}
  }
  function scoutPlayer(pid){
    var quickScoutCost=Math.round(SCOUT_COSTS86.full/3);
    if(!my||my.scoutPts<quickScoutCost) return;
    var dc2=dc.slice();var p=dc2.find(function(x){return x.id===pid;});if(!p) return;
    if(typeof p.scouted!=="object")p.scouted={measurables:false,interview:false,film:false,complete:false};
    if(p.scouted.complete) return;
    var nt=teams.slice();var u=nt.find(function(t){return t.id===myId;});
    u.scoutPts-=quickScoutCost;
    var foDraftBonus79=FRONT_OFFICE.getBonus(u.frontOffice||frontOffice78,"drafting");
    var extraConf79=Math.floor(foDraftBonus79*40);// Max +20 confidence at OVR 99
    if(extraConf79>0&&p.scoutConfidence!==undefined){p.scoutConfidence=Math.min(100,(p.scoutConfidence||0)+extraConf79);}
    if(!p.scouted.measurables){p.scouted.measurables=true;p.scoutNotes=(p.scoutNotes||[]).concat(["40yd: "+p.combine.forty+"s | Bench: "+p.combine.bench]);}
    else if(!p.scouted.interview){p.scouted.interview=true;p.scoutNotes=(p.scoutNotes||[]).concat(["Trait: "+(TRAITS[p.trait]?TRAITS[p.trait].name:"Normal")]);}
    else if(!p.scouted.film){p.scouted.film=true;p.scoutNotes=(p.scoutNotes||[]).concat(["True OVR: "+p.ovr]);
      p.scouted.complete=true;
      if(p.isGem)p.scoutNotes.push("ðŸ’Ž HIDDEN GEM");
      else if(p.isBust)p.scoutNotes.push("âš ï¸ BUST RISK");
      else p.scoutNotes.push("âœ… As Advertised");
    }
    setTeams(nt);setDC(dc2);
  }
  function restructure(pid){
    if(!my) return;
    if(!canDoAction(season.phase,"canRestructure")){addN("ðŸš« Cannot restructure during "+(PHASE_RULES[season.phase]||{}).label+".","red");return;}
    var nt=teams.slice();var u=nt.find(function(t){return t.id===myId;});
    var p=u.roster.find(function(x){return x.id===pid;});if(!p) return;
    var res=restructureContract(p);
    if(!res.ok){addN("ðŸš« "+res.msg,"red");return;}
    u.capUsed=capCalc(u.roster);
    addN("ðŸ’° "+res.msg,"gold");
    logTx("RESTRUCTURE",{name:p.name,pos:p.pos,savings:res.savings,addedPro:res.addedPro,years:res.years});
    ledgerLog("RESTRUCTURE",myId,"Restructured "+p.name+": saved $"+res.savings+"M, +$"+res.addedPro+"M/yr dead cap Ã—"+res.years+"yr",
      {name:p.name,savings:res.savings,addedPro:res.addedPro,newHit:res.newHit});
    setTeams(nt);doSave(nt);
  }
  function addVoidYearsToPlayer(pid){
    if(!my)return;
    if(!canDoAction(season.phase,"canRestructure")){addN("ðŸš« Cannot modify contracts during "+(PHASE_RULES[season.phase]||{}).label+".","red");return;}
    var nt=teams.slice();var u=nt.find(function(t){return t.id===myId;});
    var p=u.roster.find(function(x){return x.id===pid;});if(!p)return;
    var res=addVoidYears(p,1);
    if(!res.ok){addN("ðŸš« "+res.msg,"red");return;}
    u.capUsed=capCalc(u.roster);
    addN("ðŸ¦ "+res.msg,"gold");
    logTx("VOID_YEAR",{name:p.name,pos:p.pos,savings:res.savings,voidYears:res.voidYears});
    ledgerLog("VOID_YEAR",myId,"Added void year to "+p.name+": saved $"+res.savings+"M/yr. "+res.voidYears+" void years total.",
      {name:p.name,savings:res.savings,voidYears:res.voidYears,newHit:res.newHit});
    setTeams(nt);doSave(nt);
  }
  function doCascadeRestructure(){
    if(!my)return;
    if(!canDoAction(season.phase,"canRestructure")){addN("ðŸš« Cannot restructure during "+(PHASE_RULES[season.phase]||{}).label+".","red");return;}
    var nt=teams.slice();var u=nt.find(function(t){return t.id===myId;});
    var cap73=getSalaryCap(season.year);var used73=capCalc(u.roster);var dead73=u.deadCap||0;
    var overBy=used73+dead73-cap73;
    if(overBy<=0){addN("âœ… You're under the cap! No cascade needed.","green");return;}
    var res=restructureCascade(u,overBy+5);// Target overBy + 5M buffer
    if(res.count===0){addN("ðŸš« "+res.msg,"red");return;}
    u.capUsed=capCalc(u.roster);
    addN("ðŸ¦ "+res.msg,"gold");
    res.players.forEach(function(rp){
      logTx("RESTRUCTURE",{name:rp.name,pos:rp.pos,savings:rp.savings,addedPro:rp.addedPro});
    });
    ledgerLog("CASCADE_RESTRUCTURE",myId,"Cascade: restructured "+res.count+" contracts for $"+res.totalSaved+"M relief.",
      {count:res.count,totalSaved:res.totalSaved});
    setTeams(nt);doSave(nt);
  }
  function backloadPlayer973(pid){
    if(!my)return;
    if(!canDoAction(season.phase,"canRestructure")){addN("ðŸš« Cannot modify contracts during "+(PHASE_RULES[season.phase]||{}).label+".","red");return;}
    var nt=teams.slice();var u=nt.find(function(t){return t.id===myId;});
    var p=u&&u.roster?u.roster.find(function(x){return x.id===pid;}):null;
    if(!p)return;
    var res=backloadContract973(p,2);
    if(!res.ok){addN("ðŸš« "+res.msg,"red");return;}
    u.capUsed=capCalc(u.roster);
    addN("ðŸ¦ "+res.msg,"gold");
    logTx("BACKLOAD_973",{name:p.name,pos:p.pos,savings:res.savings,voidYears:res.voidYears});
    ledgerLog("BACKLOAD_973",myId,"Backloaded "+p.name+": saved $"+res.savings+"M, +"+res.voidYears+" void yrs",{name:p.name,savings:res.savings,voidYears:res.voidYears,newHit:res.newHit});
    setTeams(nt);doSave(nt);
  }
  function extendAndRestructurePlayer973(pid){
    if(!my)return;
    if(!canDoAction(season.phase,"canRestructure")){addN("ðŸš« Cannot modify contracts during "+(PHASE_RULES[season.phase]||{}).label+".","red");return;}
    var nt=teams.slice();var u=nt.find(function(t){return t.id===myId;});
    var p=u&&u.roster?u.roster.find(function(x){return x.id===pid;}):null;
    if(!p)return;
    var res=extendAndRestructure973(p,2);
    if(!res.ok){addN("ðŸš« "+res.msg,"red");return;}
    u.capUsed=capCalc(u.roster);
    addN("ðŸ§¾ "+res.msg,"gold");
    logTx("EXT_RESTRUCT_973",{name:p.name,pos:p.pos,savings:res.savings,addedYears:res.addedYears});
    ledgerLog("EXT_RESTRUCT_973",myId,"Extended+Restructured "+p.name+" ("+res.addedYears+"yr): saved $"+(res.savings||0)+"M",{name:p.name,savings:res.savings||0,addedYears:res.addedYears||0});
    setTeams(nt);doSave(nt);
  }
  function runAICapOps973(teamList,yr){
    (teamList||[]).forEach(function(t){
      if(!t||t.isUser)return;
      if(RNG.ai()>=0.28)return;// occasional, not every week
      var capSpace=getSalaryCap(yr)-(t.capUsed||0)-(t.deadCap||0);
      if(capSpace<10){
        var resAI=restructureCascade(t,15);
        if(resAI&&resAI.count>0){
          t.capUsed=capCalc(t.roster||[]);
          logAIDecision(t.abbr,t.aiStrategy||"bubble","CAP_OPS","Restructured "+resAI.count+" deal(s) for $"+resAI.totalSaved+"M relief");
        }
        capSpace=getSalaryCap(yr)-(t.capUsed||0)-(t.deadCap||0);
        if(capSpace<5){
          var bigDeal=(t.roster||[]).filter(function(p){
            return p&&p.contract&&p.contract.baseSalary!==undefined&&(p.contract.baseSalary||0)>=8&&!p.contract.backloaded&&p.contract.years>1;
          }).sort(function(a,b){return (b.contract.baseSalary||0)-(a.contract.baseSalary||0);})[0];
          if(bigDeal){
            var bRes=backloadContract973(bigDeal,2);
            if(bRes.ok){
              t.capUsed=capCalc(t.roster||[]);
              logAIDecision(t.abbr,t.aiStrategy||"bubble","CAP_OPS","Backloaded "+bigDeal.name+" for $"+bRes.savings+"M relief");
            }
          }
        }
      }
    });
  }
  function handleTaggedHoldoutAction973(action){
    if(!my||!my.franchiseTag973)return;
    var nt=teams.slice();var u=nt.find(function(t){return t.id===myId;});if(!u||!u.franchiseTag973)return;
    var tag=u.franchiseTag973;
    var p=u.roster.find(function(r){return r.id===tag.playerId;});
    if(!p){addN("ðŸš« Tagged player not found on roster.","red");return;}
    if(action==="wait"){
      addN("â³ Holding firm. "+p.name+" is still on the franchise tag holdout watch.","orange");
      return;
    }
    if(action==="trade"){
      setTab("trade");
      addN("ðŸ”„ Opened Trade tab â€” move "+p.name+" if you want to avoid tag drama.","cyan");
      return;
    }
    if(action==="pay"){
      var newSal=Math.round(Math.max((tag.salary||0)*1.15,(p.contract&&v36_capHit(p.contract)||0)*1.2)*10)/10;
      var yrs=3;
      p.contract=makeContract(newSal,yrs,0,newSal);
      delete p.contract.isTagged;
      if(p.holdout75)HOLDOUT_SYSTEM.resolve(p);
      p.morale=cl((p.morale||70)+8,15,100);
      p.chemistry=cl((p.chemistry||60)+6,15,100);
      u.franchiseTag973.reaction="happy";
      u.franchiseTag973.convertedToExtension973=true;
      u.capUsed=capCalc(u.roster);
      setTeams(nt);doSave(nt);
      addN("ðŸ’° Paid the man: "+p.name+" signed a long-term deal ($"+newSal+"M/"+yrs+"yr). Holdout over.","green");
      logTx("TAG_HOLDOUT_PAY_973",{name:p.name,salary:newSal,years:yrs});
      return;
    }
  }
  function autoSortDepth(){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    u2.roster.forEach(function(p){p.isStarter=false;});
    Object.keys(STARTER_COUNTS).forEach(function(pos){
      var group=u2.roster.filter(function(p){return p.pos===pos;}).sort(function(a,b){
        var aInj=a.injury&&a.injury.games>0?1:0;var bInj=b.injury&&b.injury.games>0?1:0;
        return aInj-bInj||b.ovr-a.ovr;// Healthy first, then by OVR
      });
      var need=STARTER_COUNTS[pos]||1;
      for(var i=0;i<Math.min(need,group.length);i++){group[i].isStarter=true;}
    });
    setTeams(nt);doSave(nt);addN("ðŸ“‹ Depth chart auto-optimized by OVR.","gold");
  }
  function toggleStarter(pid){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var p=u2.roster.find(function(x){return x.id===pid;});if(!p) return;
    p.isStarter=!p.isStarter;setTeams(nt);doSave(nt);
  }
  function promotePlayer(pid){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var p=u2.roster.find(function(x){return x.id===pid;});if(!p) return;
    var group=u2.roster.filter(function(x){return x.pos===p.pos;}).sort(function(a,b){var aS=a.isStarter?1:0;var bS2=b.isStarter?1:0;return bS2-aS||b.ovr-a.ovr;});
    var idx=group.findIndex(function(x){return x.id===pid;});
    if(idx<=0) return;// Already at top
    var above=group[idx-1];
    if(above.isStarter&&!p.isStarter){p.isStarter=true;above.isStarter=false;}
    else{// Both same status â€” swap OVR-based ordering by toggling starters
      p.isStarter=true;if(idx===1&&group.length>2)above.isStarter=false;
    }
    setTeams(nt);doSave(nt);
  }
  function demotePlayer(pid){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var p=u2.roster.find(function(x){return x.id===pid;});if(!p) return;
    var group=u2.roster.filter(function(x){return x.pos===p.pos;}).sort(function(a,b){var aS=a.isStarter?1:0;var bS2=b.isStarter?1:0;return bS2-aS||b.ovr-a.ovr;});
    var idx=group.findIndex(function(x){return x.id===pid;});
    if(idx>=group.length-1) return;// Already at bottom
    if(p.isStarter){p.isStarter=false;var below=group[idx+1];if(!below.isStarter)below.isStarter=true;}
    setTeams(nt);doSave(nt);
  }
  function checkRecords(allTeams,yr){
    var nr=assign({},records);var broken=[];var newCards=[];
    var myT=allTeams.find(function(t){return t.id===myId;});
    allTeams.forEach(function(t){t.roster.forEach(function(p){
      var cs=p.careerStats||{};
      var isMyPlayer=t.id===myId;
      var tColor=(t&&t.color)||"#0f172a";
      function makeCard(icon,headline,statLabel,statVal,extra){
        return{icon:icon,teamIcon:t.icon||"ðŸˆ",teamName:t.name||t.abbr,teamColor:tColor,
          headline:headline,season:yr,record:"",
          playerName:p.name,pos:p.pos,isMyPlayer:isMyPlayer,
          stats:[{label:statLabel,val:statVal}].concat(extra||[]),
          filename:"record-"+p.name.replace(/\s/g,"-").toLowerCase()+"-"+yr};
      }
      if((cs.passYds||0)>nr.passYds.v){nr.passYds={v:cs.passYds,h:p.name,yr:yr};broken.push("ðŸ“° "+p.name+" is the new All-Time Passing King! "+cs.passYds+"yds");
        newCards.push(makeCard("ðŸ†","ALL-TIME PASSING RECORD","CAREER PASS YDS",cs.passYds,[{label:"SEASON",val:yr},{label:"TEAM",val:t.abbr},{label:"POS",val:p.pos}]));}
      if((cs.rushYds||0)>nr.rushYds.v){nr.rushYds={v:cs.rushYds,h:p.name,yr:yr};broken.push("ðŸ“° "+p.name+" is the new All-Time Rushing King! "+cs.rushYds+"yds");
        newCards.push(makeCard("ðŸˆ","ALL-TIME RUSHING RECORD","CAREER RUSH YDS",cs.rushYds,[{label:"SEASON",val:yr},{label:"TEAM",val:t.abbr},{label:"POS",val:p.pos}]));}
      if((cs.sacks||0)>nr.sacks.v){nr.sacks={v:cs.sacks,h:p.name,yr:yr};broken.push("ðŸ“° "+p.name+" is the new Sack King! "+cs.sacks);
        newCards.push(makeCard("ðŸ’¥","ALL-TIME SACK RECORD","CAREER SACKS",cs.sacks,[{label:"SEASON",val:yr},{label:"TEAM",val:t.abbr},{label:"POS",val:p.pos}]));}
      if((cs.defINT||0)>nr.defINT.v){nr.defINT={v:cs.defINT,h:p.name,yr:yr};broken.push("ðŸ“° "+p.name+" is the INT King! "+cs.defINT);
        newCards.push(makeCard("ðŸŽ¯","ALL-TIME INT RECORD","CAREER INTs",cs.defINT,[{label:"SEASON",val:yr},{label:"TEAM",val:t.abbr},{label:"POS",val:p.pos}]));}
      if((cs.recYds||0)>nr.recYds.v){nr.recYds={v:cs.recYds,h:p.name,yr:yr};broken.push("ðŸ“° "+p.name+" is the Receiving King! "+cs.recYds+"yds");
        newCards.push(makeCard("ðŸ™Œ","ALL-TIME RECEIVING RECORD","CAREER REC YDS",cs.recYds,[{label:"SEASON",val:yr},{label:"TEAM",val:t.abbr},{label:"POS",val:p.pos}]));}
      if((cs.fgM||0)>(nr.fgM||{v:0}).v){nr.fgM={v:cs.fgM,h:p.name,yr:yr};broken.push("ðŸ“° "+p.name+" is the FG King! "+cs.fgM+" career makes");
        newCards.push(makeCard("ðŸ¦µ","ALL-TIME FG RECORD","CAREER FG MAKES",cs.fgM,[{label:"SEASON",val:yr},{label:"TEAM",val:t.abbr},{label:"POS",val:p.pos}]));}
      if((cs.puntYds||0)>(nr.puntYds||{v:0}).v){nr.puntYds={v:cs.puntYds,h:p.name,yr:yr};broken.push("ðŸ“° "+p.name+" is the Punt Yardage King! "+cs.puntYds+"yds");
        newCards.push(makeCard("ðŸ“","ALL-TIME PUNT RECORD","CAREER PUNT YDS",cs.puntYds,[{label:"SEASON",val:yr},{label:"TEAM",val:t.abbr},{label:"POS",val:p.pos}]));}
    });});
    if(broken.length>0){
      setRecords(nr);
      broken.forEach(function(b){addN(b,"purple");});
      if(newCards.length>0){setShareCardQueue(function(q){return q.concat(newCards);});}
    }
  }
  function genDraftOffers(boardIdx){
    if(!my||boardIdx>=draftBoard.length) return [];var offers=[];
    var currentPick=draftBoard[boardIdx];if(!currentPick||currentPick.ownerId!==myId) return [];
    var pickNum=currentPick.pickNum||boardIdx+1;
    var pickRd=currentPick.round||1;
    var userPickVal=pickValue(pickRd)*(pickNum<=5?1.5:pickNum<=12?1.2:1.0);// top-5 premium
    var topProspects=dc.slice(0,Math.min(dc.length,8));
    var aiTeams=teams.filter(function(t){return t.id!==myId;});
    var gmTrust=tradeState?tradeState.gmTrustByTeam||{}:{};
    aiTeams.forEach(function(t){
      var trust=(gmTrust[t.id]||50);
      if(trust<25) return;
      var trustMod=trust>=70?1.15:trust>=55?1.0:trust>=40?0.9:0.8;// high trust = willing to overpay slightly
      var needs=getTeamNeeds(t);var needKeys=Object.keys(needs).sort(function(a,b){return needs[b]-needs[a];});
      if(!needKeys.length) return;
      var theirNextPick=null;var theirPickIdx=-1;
      for(var bi=boardIdx+1;bi<draftBoard.length;bi++){
        if(draftBoard[bi].ownerId===t.id){theirNextPick=draftBoard[bi];theirPickIdx=bi;break;}
      }
      if(!theirNextPick) return;// No picks left, can't trade
      var theirPickVal=pickValue(theirNextPick.round||1);
      if(theirPickIdx-boardIdx<5) return;
      var targetProspect=null;
      for(var ti=0;ti<topProspects.length;ti++){
        if(needKeys.indexOf(topProspects[ti].pos)>=0){targetProspect=topProspects[ti];break;}
      }
      if(!targetProspect&&pickRd>2) return;// Only desperation trades in round 1-2 without a target
      var gap=userPickVal-theirPickVal;
      if(gap<=0) return;// They already have a better pick, no need to trade up
      var theirPicks=(t.draftPicks||[]).sort(function(a,b){return a.round-b.round;});
      var strategy=t.strategy||"neutral";
      var urgencyMult=strategy==="contend"?1.3:strategy==="rebuild"?0.7:1.0;
      var qbDesperate=false;
      if(targetProspect&&targetProspect.pos==="QB"){
        var bestQB=t.roster.filter(function(p){return p.pos==="QB";}).sort(function(a,b){return b.ovr-a.ovr;})[0];
        if(!bestQB||bestQB.ovr<72){qbDesperate=true;urgencyMult*=1.4;}
      }
      var totalOffer=theirPickVal;var offerPicks=[theirNextPick];var offerPlayer=null;
      var usedPids={};usedPids[theirNextPick.pid||"x"]=true;
      theirPicks.forEach(function(pk){
        if(totalOffer>=gap*urgencyMult*trustMod) return;
        if(usedPids[pk.pid||pk.round+"_"+pk.originalId]) return;
        if(pk.round===theirNextPick.round&&pk.originalId===theirNextPick.originalId) return;
        usedPids[pk.pid||pk.round+"_"+pk.originalId]=true;
        offerPicks.push(pk);totalOffer+=pickValue(pk.round||7);
      });
      if(totalOffer<gap*0.7){
        var sweetener=t.roster.filter(function(p){return p.ovr>=68&&p.ovr<=80&&p.age<=28&&!(p.injury&&p.injury.games>3);})
          .sort(function(a,b){return b.ovr-a.ovr;})[0];
        if(sweetener){offerPlayer=sweetener;totalOffer+=sweetener.ovr*5;}
        else return;// Can't afford it
      }
      if(totalOffer<gap*0.6) return;// Still not enough â€” skip
      var pickLabel=offerPicks.map(function(pk){return "Rd"+(pk.round||"?");}).join("+");
      var targetLabel=targetProspect?" (eyeing "+targetProspect.name+" "+targetProspect.pos+" "+targetProspect.ovr+")":"";
      var trustLabel2=trust>=70?"ðŸ¤":"";
      var despLabel=qbDesperate?"ðŸš¨ QB DESPERATE! ":"";
      offers.push({
        team:t,
        label:despLabel+t.icon+t.abbr+" offers "+pickLabel+(offerPlayer?" + "+offerPlayer.name+"("+offerPlayer.pos+" "+offerPlayer.ovr+")":"")+" to move up!"+targetLabel,
        give:offerPicks,player:offerPlayer,
        needs:needKeys.slice(0,2).join("/"),
        target:targetProspect?targetProspect.name:null,
        value:Math.round(totalOffer),
        trust:trust,trustEmoji:trustLabel2
      });
    });
    offers.sort(function(a,b){return b.value-a.value;});
    return offers.slice(0,4);
  }
  function acceptDraftOffer(offer){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var ai=nt.find(function(t){return t.id===offer.team.id;});if(!ai) return;
    offer.give.forEach(function(pk){
      ai.draftPicks=(ai.draftPicks||[]).filter(function(x){return (x.pid||x)!==(pk.pid||pk);});
      u2.draftPicks=(u2.draftPicks||[]).concat([pk]);
    });
    if(offer.player){ai.roster=ai.roster.filter(function(x){return x.id!==offer.player.id;});u2.roster.push(offer.player);u2.capUsed+=offer.player.contract.salary;ai.capUsed-=offer.player.contract.salary;}
    addN("ðŸ“ž Trade w/"+ai.icon+ai.abbr+"! Traded down for "+offer.give.map(function(pk){return "Rd"+pk.round;}).join("+")+(offer.player?" + "+offer.player.name+((offer.player.archetype&&offer.player.archetype.label)?" ("+offer.player.archetype.emoji+" "+offer.player.archetype.label+")":""):""),"gold");
    logTx("DRAFT_TRADE",{with:ai.abbr,received:offer.give.map(function(pk){return "Rd"+pk.round;}).join("+"),player:offer.player?offer.player.name:null});
    setTradeState(function(prev){
      var nt2=assign({},prev.gmTrustByTeam||{});
      nt2[ai.id]=cl((nt2[ai.id]||50)+2,0,100);// +2 trust for fair draft trade
      return assign({},prev,{gmTrustByTeam:nt2,recentTrades:(prev.recentTrades||[]).concat([{type:"draft_trade",with:ai.id,year:season.year}])});
    });
    var nb=draftBoard.slice();
    if(nb[dPk])nb[dPk].ownerId=ai.id;
    offer.give.forEach(function(pk){
      for(var bi=0;bi<nb.length;bi++){
        if(pk.pid&&nb[bi].pid===pk.pid){nb[bi].ownerId=myId;break;}
        else if(!pk.pid&&nb[bi].round===pk.round&&nb[bi].ownerId===ai.id){nb[bi].ownerId=myId;break;}
      }
    });
    setDraftBoard(nb);
    var dcc=dc.slice();var idx=dPk;
    while(idx<nb.length&&nb[idx].ownerId!==myId){
      dcc=aiDraftPick(nt,nb[idx],dcc);idx++;
    }
    setDC(dcc);setDPk(idx);
    if(idx<nb.length)setDraftOffers(genDraftOffers(idx));
    else{
      var udfa2=dcc.map(function(p){var up=assign({},p);up.contract={salary:MIN_SALARY,years:1,bonus:0};
        if((up.isGem&&RNG.draft()<0.5)||RNG.draft()<0.04){var def=POS_DEF[up.pos];if(def){def.r.forEach(function(r){up.ratings[r]=cl((up.ratings[r]||50)+rng(2,6),40,85);});}
        up.ovr=calcOvr(up);up.ovr=Math.min(up.ovr,72);up.pot=cl(up.pot+rng(2,5),up.ovr,82);up.devTrait=pick(["star","normal","normal","normal"]);up.udfaSleeper=true;}
        if(up.ovr>70&&!up.udfaSleeper){var def2=POS_DEF[up.pos];if(def2){def2.r.forEach(function(r){up.ratings[r]=cl(up.ratings[r]-rng(2,6),35,99);});}up.ovr=calcOvr(up);}
        return up;});
      var allFA82=fas.slice().concat(udfa2);
      setFAs(allFA82);
      setSeason(function(s){return assign({},s,{phase:"freeAgency"});});setDraftOffers([]);
      setFaMarket(buildFAMarket(allFA82,nt,myId));
      setFaDay(0);setFaHeadlines([]);
      var board82=buildFABidBoard(allFA82,nt,myId,RNG.trade,season.year);
      setFaBids82(board82);setFaPhase82("tampering");setFaRound82(0);
      setFaVisits82({used:0,max:calcVisitTokens(frontOffice78),log:[]});setFaAlerts82([]);setFaSignings82([]);
      showGuide("fa");
      addN("ðŸ“‹ Draft complete! "+udfa2.length+" undrafted â†’ FA.","gold");
      // v98.5: Archive draft picks
      (function(){
        var archive98b={year:season.year,picks:[],isInaugural:draftHistory98.length===0};
        nt.forEach(function(tm){
          tm.roster.filter(function(rp){return rp._draftYear===season.year;}).forEach(function(rp){
            archive98b.picks.push({pickNum:rp._draftPick||0,round:rp._draftRound||0,team:tm.abbr,icon:tm.icon,
              name:rp.name,pos:rp.pos,ovr:rp.ovr,pot:rp.pot||rp.ovr,devTrait:rp.devTrait||"normal",
              college:rp.college?rp.college.school||rp.college:"?",isUser:tm.id===myId,salary:rp.contract?rp.contract.salary||0:0});
          });
        });
        archive98b.picks.sort(function(a,b){return (a.round||9)*100+(a.pickNum||99)-(b.round||9)*100-(b.pickNum||99);});
        if(archive98b.picks.length>0)setDraftHistory98(function(prev){return prev.concat([archive98b]);});
      })();
    }
    setTeams(nt);doSave(nt);
  }
  function getH2HRecord97(a,b){
    var out={games:0,aWins:0,bWins:0};
    if(!a||!b||!sched||!sched.length)return out;
    sched.forEach(function(g){
      if(!g||!g.played||!g.result)return;
      var isMatch=(g.home===a.id&&g.away===b.id)||(g.home===b.id&&g.away===a.id);
      if(!isMatch)return;
      out.games++;
      if((g.home===a.id&&g.result.home>g.result.away)||(g.away===a.id&&g.result.away>g.result.home))out.aWins++;
      else if((g.home===b.id&&g.result.home>g.result.away)||(g.away===b.id&&g.result.away>g.result.home))out.bWins++;
    });
    return out;
  }
  function compareTeamsForPlayoffSeed97(a,b){
    if(!a&&!b)return 0;
    if(!a)return 1;
    if(!b)return -1;
    var aW=a.wins||0,bW=b.wins||0;
    if(aW!==bW)return bW-aW;
    var h2h=getH2HRecord97(a,b);
    if(h2h.games>0&&h2h.aWins!==h2h.bWins)return h2h.bWins-h2h.aWins;
    var aDiff=(a.pf||0)-(a.pa||0),bDiff=(b.pf||0)-(b.pa||0);
    if(aDiff!==bDiff)return bDiff-aDiff;
    var aPF=a.pf||0,bPF=b.pf||0;
    if(aPF!==bPF)return bPF-aPF;
    return String(a.id||"").localeCompare(String(b.id||""));
  }
  function getTiebreakReason97(a,b){
    if(!a||!b)return"";
    if((a.wins||0)!==(b.wins||0))return(a.wins||0)>(b.wins||0)?"Better record":"";
    var h2h=getH2HRecord97(a,b);
    if(h2h.games>0&&h2h.aWins!==h2h.bWins)return h2h.aWins>h2h.bWins?"H2H: "+h2h.aWins+"-"+h2h.bWins:"";
    var aDiff=(a.pf||0)-(a.pa||0),bDiff=(b.pf||0)-(b.pa||0);
    if(aDiff!==bDiff)return aDiff>bDiff?"Point diff: "+(aDiff>=0?"+":"")+Math.round(aDiff):"";
    return "Points for: "+Math.round(a.pf||0);
  }
  function getConfName97(confCode){
    if(confCode==="EC")return"East Conference";
    if(confCode==="WC")return"West Conference";
    return String(confCode||"League");
  }
  function makePlayoffSeedStub97(t,seed,confCode,isDivChamp){
    if(!t)return null;
    return {
      id:t.id,seed:seed,conf:confCode||t.conf||"LG",divId:t.divId||"",div:t.div||"",
      isDivChamp:!!isDivChamp,isWildCard:!isDivChamp,
      abbr:t.abbr,icon:t.icon,name:t.name,c1:t.c1,wins:t.wins||0,losses:t.losses||0,pf:t.pf||0,pa:t.pa||0
    };
  }
  function buildConferenceSeeds97(confCode,teamList){
    var pool=(teamList||teams||[]).filter(function(t){
      if(!t)return false;
      if(!t.conf&&typeof applyLeagueAlignment97==="function")applyLeagueAlignment97(t);
      return (t.conf||"")===confCode;
    });
    pool=pool.slice().sort(compareTeamsForPlayoffSeed97);
    var byDiv={};
    pool.forEach(function(t){
      var divKey=t.divId||((t.conf||confCode)+"-"+(t.div||"DIV"));
      if(!byDiv[divKey])byDiv[divKey]=[];
      byDiv[divKey].push(t);
    });
    var divChamps=[];
    Object.keys(byDiv).forEach(function(divKey){
      byDiv[divKey].sort(compareTeamsForPlayoffSeed97);
      if(byDiv[divKey][0])divChamps.push(byDiv[divKey][0]);
    });
    divChamps.sort(compareTeamsForPlayoffSeed97);
    var divChampIds={};
    divChamps.forEach(function(t){divChampIds[t.id]=1;});
    var remaining=pool.filter(function(t){return !divChampIds[t.id];}).sort(compareTeamsForPlayoffSeed97);
    var seedTeams=divChamps.slice(0,3);
    if(remaining[0])seedTeams.push(remaining[0]);
    var fillIdx=1;
    while(seedTeams.length<4&&remaining[fillIdx]){
      seedTeams.push(remaining[fillIdx]);fillIdx++;
    }
    if(seedTeams.length<4){
      pool.forEach(function(t){
        if(seedTeams.length>=4)return;
        if(seedTeams.some(function(x){return x.id===t.id;}))return;
        seedTeams.push(t);
      });
    }
    var seedIds={};seedTeams.forEach(function(t){seedIds[t.id]=1;});
    var rest=pool.filter(function(t){return !seedIds[t.id];}).sort(compareTeamsForPlayoffSeed97);
    var seeds=seedTeams.map(function(t,i){
      return makePlayoffSeedStub97(t,i+1,confCode,!!divChampIds[t.id]&&i<3);
    });
    return {
      conf:confCode,
      confName:getConfName97(confCode),
      pool:pool,
      divisionChamps:divChamps,
      wildCard:remaining[0]||null,
      seedTeams:seedTeams,
      seeds:seeds,
      rest:rest,
      raceOrder:seedTeams.concat(rest)
    };
  }
  function buildPlayoffField97(teamList){
    var ec=buildConferenceSeeds97("EC",teamList);
    var wc=buildConferenceSeeds97("WC",teamList);
    return {
      ec:ec,wc:wc,
      seedsEC:ec.seeds,
      seedsWC:wc.seeds,
      seeds:(ec.seeds||[]).concat(wc.seeds||[])
    };
  }
  function initPlayoffs(){
    if((teams&&teams.length||0)<30){
      var legacySeeds=teams.slice().sort(compareTeamsForPlayoffSeed97).slice(0,8);
      if(legacySeeds.length<8){
        addN("âŒ Could not seed playoffs (need 8 teams).","red");
        return;
      }
      var ntLegacy=teams.slice();
      var legacyIds={};
      legacySeeds.forEach(function(t){legacyIds[t.id]=1;});
      ntLegacy.forEach(function(t){t.madePlayoffs=!!legacyIds[t.id];});
      var legacySeedStubs=legacySeeds.map(function(t,i){return makePlayoffSeedStub97(t,i+1,t.conf||"LG",false);});
      var bracketLegacy={
        round:"QF",year:season.year,format:"LEGACY_8",
        seeds:legacySeedStubs,seedsEC:[],seedsWC:[],
        qf:[
          {home:legacySeeds[0],away:legacySeeds[7],result:null,winner:null,stars:null,label:"#1 vs #8"},
          {home:legacySeeds[3],away:legacySeeds[4],result:null,winner:null,stars:null,label:"#4 vs #5"},
          {home:legacySeeds[1],away:legacySeeds[6],result:null,winner:null,stars:null,label:"#2 vs #7"},
          {home:legacySeeds[2],away:legacySeeds[5],result:null,winner:null,stars:null,label:"#3 vs #6"}
        ],
        sf:[
          {home:null,away:null,result:null,winner:null,stars:null,label:"SEMIFINAL 1"},
          {home:null,away:null,result:null,winner:null,stars:null,label:"SEMIFINAL 2"}
        ],
        champ:{home:null,away:null,result:null,winner:null,stars:null,label:"CHAMPIONSHIP",conf:"LG"}
      };
      setTeams(ntLegacy);
      setPoBracket(bracketLegacy);
      setSeason(function(s){return assign({},s,{phase:"playoffs"});});
      if(legacyIds[myId])setSeasonTracking(function(prev){return assign({},prev,{madePlayoffs:true});});
      addN("ðŸ† THE PLAYOFFS â€” Legacy Top 8 seeding (compat mode for older save).","gold");
      setTab("home");
      return;
    }
    var field97=buildPlayoffField97(teams);
    var ec97=field97.ec||{seedTeams:[],seeds:[]};
    var wc97=field97.wc||{seedTeams:[],seeds:[]};
    if((ec97.seedTeams||[]).length<4||(wc97.seedTeams||[]).length<4){
      addN("âŒ Could not seed conference playoffs (need 4 EC + 4 WC qualifiers).","red");
      return;
    }
    var t8=(ec97.seedTeams||[]).concat(wc97.seedTeams||[]);
    var ntPlay=teams.slice();
    var poIds97={};
    t8.forEach(function(t){poIds97[t.id]=1;});
    ntPlay.forEach(function(t){t.madePlayoffs=!!poIds97[t.id];});
    var bracket={
      round:"QF",year:season.year,format:"CONF_4X2",
      seeds:field97.seeds||[],
      seedsEC:field97.seedsEC||[],
      seedsWC:field97.seedsWC||[],
      qf:[
        {home:ec97.seedTeams[0],away:ec97.seedTeams[3],result:null,winner:null,stars:null,label:"EC #1 vs #4",conf:"EC"},
        {home:ec97.seedTeams[1],away:ec97.seedTeams[2],result:null,winner:null,stars:null,label:"EC #2 vs #3",conf:"EC"},
        {home:wc97.seedTeams[0],away:wc97.seedTeams[3],result:null,winner:null,stars:null,label:"WC #1 vs #4",conf:"WC"},
        {home:wc97.seedTeams[1],away:wc97.seedTeams[2],result:null,winner:null,stars:null,label:"WC #2 vs #3",conf:"WC"}
      ],
      sf:[
        {home:null,away:null,result:null,winner:null,stars:null,label:"EC FINAL",conf:"EC"},
        {home:null,away:null,result:null,winner:null,stars:null,label:"WC FINAL",conf:"WC"}
      ],
      champ:{home:null,away:null,result:null,winner:null,stars:null,label:"CHAMPIONSHIP",conf:"LG"}
    };
    setTeams(ntPlay);
    setPoBracket(bracket);
    setSeason(function(s){return assign({},s,{phase:"playoffs"});});
    var userInPlayoffs=!!poIds97[myId];
    if(userInPlayoffs)setSeasonTracking(function(prev){return assign({},prev,{madePlayoffs:true});});
    addN("ðŸ† THE PLAYOFFS â€” 4 EC + 4 WC teams. Win your conference, then win it all.","gold");
    setTab("home");
  }
  function getGameStars(result,hT2,aT2){
    var stars=[];
    if(result.leaders){
      var lh=result.leaders.home;var la=result.leaders.away;
      if(lh&&lh.pass)stars.push({name:lh.pass.name,stat:lh.pass.yds+"yds "+lh.pass.td+"TD",type:"pass",team:(hT2||{}).abbr});
      if(la&&la.pass&&(!lh||!lh.pass||la.pass.yds>lh.pass.yds))stars.push({name:la.pass.name,stat:la.pass.yds+"yds "+la.pass.td+"TD",type:"pass",team:(aT2||{}).abbr});
      var bestRush=null;
      if(lh&&lh.rush&&lh.rush.yds>30)bestRush={name:lh.rush.name,stat:lh.rush.yds+"yds "+lh.rush.td+"TD",type:"rush",team:(hT2||{}).abbr};
      if(la&&la.rush&&la.rush.yds>(bestRush?parseInt(bestRush.stat):30))bestRush={name:la.rush.name,stat:la.rush.yds+"yds "+la.rush.td+"TD",type:"rush",team:(aT2||{}).abbr};
      if(bestRush)stars.push(bestRush);
      var allRecs=(lh&&lh.rec?lh.rec:[]).concat(la&&la.rec?la.rec:[]).sort(function(a,b){return b.yds-a.yds;});
      if(allRecs[0]&&allRecs[0].yds>25)stars.push({name:allRecs[0].name,stat:allRecs[0].rec+"rec "+allRecs[0].yds+"yds",type:"rec"});
    }
    return stars.slice(0,3);
  }
  function simPlayoffRound(){
    if(!poBracket) return;
    var br=JSON.parse(JSON.stringify(poBracket));
    var getTeam=function(id){return teams.find(function(t){return t.id===id;});};
    if(br.round==="QF"){
      br.qf.forEach(function(g){
        var h=getTeam(g.home.id);var a=getTeam(g.away.id);
        if(!h||!a) return;
        var r=simGame(h,a);
        g.result={home:r.home,away:r.away,qtrs:r.qtrs,leaders:r.leaders,log:r.log,box:r.box};
        g.winner=r.home>r.away?{id:h.id,abbr:h.abbr,icon:h.icon,name:h.name,c1:h.c1}:{id:a.id,abbr:a.abbr,icon:a.icon,name:a.name,c1:a.c1};
        g.stars=getGameStars(r,h,a);
        updateRivalries(teams,h.id,a.id,r,true,season.year);
      });
      br.sf[0].home=br.qf[0].winner;br.sf[0].away=br.qf[1].winner;
      br.sf[0].label="EC FINAL: "+br.qf[0].winner.abbr+" vs "+br.qf[1].winner.abbr;
      br.sf[1].home=br.qf[2].winner;br.sf[1].away=br.qf[3].winner;
      br.sf[1].label="WC FINAL: "+br.qf[2].winner.abbr+" vs "+br.qf[3].winner.abbr;
      br.round="SF";
      br.qf.forEach(function(g){
        if(g.result&&g.winner){
          ledgerLog("GAME",g.winner.id,
            "PLAYOFF "+(g.conf||"")+" R1: "+g.home.abbr+" "+g.result.home+" - "+g.away.abbr+" "+g.result.away+" ("+g.winner.abbr+" advances)",
            {round:(g.conf||"")+"QF",homeId:g.home.id,awayId:g.away.id,homeScore:g.result.home,awayScore:g.result.away,winnerId:g.winner.id,conf:g.conf||null});
        }
      });
      addN("ðŸˆ CONFERENCE ROUND 1 COMPLETE! EC Final: "+br.sf[0].home.icon+br.sf[0].home.abbr+" vs "+br.sf[0].away.icon+br.sf[0].away.abbr+" | WC Final: "+br.sf[1].home.icon+br.sf[1].home.abbr+" vs "+br.sf[1].away.icon+br.sf[1].away.abbr,"gold");
    }
    else if(br.round==="SF"){
      br.sf.forEach(function(g){
        var h=getTeam(g.home.id);var a=getTeam(g.away.id);
        if(!h||!a) return;
        var r=simGame(h,a);
        g.result={home:r.home,away:r.away,qtrs:r.qtrs,leaders:r.leaders,log:r.log,box:r.box};
        g.winner=r.home>r.away?{id:h.id,abbr:h.abbr,icon:h.icon,name:h.name,c1:h.c1}:{id:a.id,abbr:a.abbr,icon:a.icon,name:a.name,c1:a.c1};
        g.stars=getGameStars(r,h,a);
        updateRivalries(teams,h.id,a.id,r,true,season.year);
      });
      br.champ.home=br.sf[0].winner;br.champ.away=br.sf[1].winner;
      br.champ.label=br.sf[0].winner.abbr+" vs "+br.sf[1].winner.abbr;
      br.round="CHAMP";
      br.sf.forEach(function(g){
        if(g.result&&g.winner){
          ledgerLog("GAME",g.winner.id,
            "PLAYOFF "+(g.conf||"")+" FINAL: "+g.home.abbr+" "+g.result.home+" - "+g.away.abbr+" "+g.result.away+" ("+g.winner.abbr+" wins "+(g.conf||"")+" and advances)",
            {round:(g.conf||"")+"F",homeId:g.home.id,awayId:g.away.id,homeScore:g.result.home,awayScore:g.result.away,winnerId:g.winner.id,conf:g.conf||null});
        }
      });
      addN("ðŸ”¥ CONFERENCE CHAMPIONS CROWNED! EC: "+br.sf[0].winner.icon+br.sf[0].winner.abbr+" | WC: "+br.sf[1].winner.icon+br.sf[1].winner.abbr+" â€” CHAMPIONSHIP NEXT.","gold");
    }
    else if(br.round==="CHAMP"){
      var h2=getTeam(br.champ.home.id);var a2=getTeam(br.champ.away.id);
      if(!h2||!a2) return;
      var r2=simGame(h2,a2);
      br.champ.result={home:r2.home,away:r2.away,qtrs:r2.qtrs,leaders:r2.leaders,log:r2.log,box:r2.box};
      br.champ.winner=r2.home>r2.away?{id:h2.id,abbr:h2.abbr,icon:h2.icon,name:h2.name,c1:h2.c1}:{id:a2.id,abbr:a2.abbr,icon:a2.icon,name:a2.name,c1:a2.c1};
      br.champ.stars=getGameStars(r2,h2,a2);
      var champResult=assign({},r2,{isElim:true});
      updateRivalries(teams,h2.id,a2.id,champResult,true,season.year);
      br.round="DONE";
      var winnerId=br.champ.winner.id;
      var winnerTeam=getTeam(winnerId);
      ledgerLog("GAME",winnerId,
        "ðŸ† CHAMPIONSHIP: "+br.champ.home.abbr+" "+br.champ.result.home+" - "+br.champ.away.abbr+" "+br.champ.result.away+" â€” "+br.champ.winner.abbr+" ARE CHAMPIONS!",
        {round:"CHAMP",homeId:br.champ.home.id,awayId:br.champ.away.id,homeScore:br.champ.result.home,awayScore:br.champ.result.away,winnerId:winnerId});
      var entry=archiveSeason(teams,winnerId,season.year,sched);
      entry.bracket={
        format:br.format||"LEGACY_8",
        seeds:br.seeds,
        seedsEC:br.seedsEC||[],
        seedsWC:br.seedsWC||[],
        qf:br.qf.map(function(g){return {home:(g.home||{}).abbr,away:(g.away||{}).abbr,hIcon:(g.home||{}).icon,aIcon:(g.away||{}).icon,hC1:(g.home||{}).c1,aC1:(g.away||{}).c1,score:g.result?g.result.home+"-"+g.result.away:"?",winner:(g.winner||{}).abbr,winnerId:(g.winner||{}).id,stars:g.stars||[]};}),
        sf:br.sf.map(function(g){return {home:(g.home||{}).abbr,away:(g.away||{}).abbr,hIcon:(g.home||{}).icon,aIcon:(g.away||{}).icon,hC1:(g.home||{}).c1,aC1:(g.away||{}).c1,score:g.result?g.result.home+"-"+g.result.away:"?",winner:(g.winner||{}).abbr,winnerId:(g.winner||{}).id,stars:g.stars||[]};}),
        champ:{home:(br.champ.home||{}).abbr,away:(br.champ.away||{}).abbr,hIcon:(br.champ.home||{}).icon,aIcon:(br.champ.away||{}).icon,hC1:(br.champ.home||{}).c1,aC1:(br.champ.away||{}).c1,score:br.champ.result.home+"-"+br.champ.result.away,winner:br.champ.winner.abbr,winnerId:br.champ.winner.id,winnerIcon:br.champ.winner.icon,winnerName:br.champ.winner.name,stars:br.champ.stars||[]}
      };
      var completedGames=sched.filter(function(g){return g.result;}).map(function(g){
        var margin=Math.abs((g.result.home||0)-(g.result.away||0));
        var hT=teams.find(function(t){return t.id===g.home;});var aT=teams.find(function(t){return t.id===g.away;});
        var isPlayoff3=g.round!==undefined;
        var rivKey=season.rivalries?rivalryKey(g.home,g.away):null;
        var rivHeat=rivKey&&season.rivalries&&season.rivalries[rivKey]?season.rivalries[rivKey].heat:0;
        var gameScore=Math.max(0,50-margin*3)+(isPlayoff3?30:0)+(rivHeat>=6?rivHeat*2:0);
        return {hAbbr:hT?hT.abbr:"?",aAbbr:aT?aT.abbr:"?",hIcon:hT?hT.icon:"",aIcon:aT?aT.icon:"",
          hScore:g.result.home||0,aScore:g.result.away||0,week:g.week||0,playoff:isPlayoff3,margin:margin,gameScore:gameScore};
      });
      entry.topGames=completedGames.sort(function(a,b){return b.gameScore-a.gameScore;}).slice(0,5);
      var rankByAbbr={};teams.forEach(function(t,ti){rankByAbbr[t.abbr]=ti+1;});
      var upsets=completedGames.filter(function(g){
        var wAbbr=g.hScore>g.aScore?g.hAbbr:g.aAbbr;var lAbbr=g.hScore>g.aScore?g.aAbbr:g.hAbbr;
        return (rankByAbbr[wAbbr]||0)>(rankByAbbr[lAbbr]||0)+6;
      }).map(function(g){
        var wAbbr=g.hScore>g.aScore?g.hAbbr:g.aAbbr;var lAbbr=g.hScore>g.aScore?g.aAbbr:g.hAbbr;
        var wI=g.hScore>g.aScore?g.hIcon:g.aIcon;var lI=g.hScore>g.aScore?g.aIcon:g.hIcon;
        var wT=teams.find(function(t){return t.abbr===wAbbr;});var lT=teams.find(function(t){return t.abbr===lAbbr;});
        return {winner:wAbbr,loser:lAbbr,wIcon:wI,lIcon:lI,score:g.hScore+"-"+g.aScore,week:g.week,
          rankGap:(rankByAbbr[wAbbr]||0)-(rankByAbbr[lAbbr]||0),
          winnerRecord:wT?wT.wins+"-"+wT.losses:"",loserRecord:lT?lT.wins+"-"+lT.losses:""};
      });
      entry.biggestUpset=upsets.sort(function(a,b){return b.rankGap-a.rankGap;})[0]||null;
      if(entry.allPro1st){
        var mvpLadder=[];
        var allPlayers=teams.reduce(function(acc,t){return acc.concat(t.roster.map(function(p){return assign({},p,{tA:t.abbr,tI:t.icon});}));},[]);
        allPlayers.filter(function(p){return p.stats&&p.stats.gp>=6;}).forEach(function(p){
          var s2=p.stats;if(!s2)return;
          var base=0;
          if(p.pos==="QB")base=s2.passTD*25+s2.passYds*0.5-s2.int*30;
          else if(p.pos==="RB")base=s2.rushYds*0.5+s2.rushTD*30+(s2.rec||0)*5;
          else if(p.pos==="WR"||p.pos==="TE")base=(s2.recYds||0)*0.5+(s2.recTD||0)*40;
          else base=(s2.sacks||0)*60+(s2.tackles||0)*3+(s2.defINT||0)*50;
          mvpLadder.push({name:p.name,pos:p.pos,tm:p.tA,tIcon:p.tI,score:Math.round(base)});
        });
        entry.mvpLadder=mvpLadder.sort(function(a,b){return b.score-a.score;}).slice(0,5);
      }
      var nh=history.concat([entry]);setHistory(nh);
      recordGoldenSeed(season,teams,myId);
      if(DB.ready){
        var archiveEntry={seasonId:season.year,year:season.year,entry:entry,
          standings:teams.map(function(t){return {id:t.id,abbr:t.abbr,icon:t.icon,wins:t.wins,losses:t.losses,pf:t.pf,pa:t.pa};}),
          seed:SEED_GLOBAL,timestamp:Date.now()};
        DB.write("archive",archiveEntry).catch(function(e){
          try{console.warn("Archive write failed:",e);}catch(_e){}
        });
      }
      var pr={bracket:br.qf.map(function(g){return {round:(g.conf||"")+"R1",h:(g.home||{}).abbr,a:(g.away||{}).abbr,s:g.result?g.result.home+"-"+g.result.away:"?"};})
        .concat(br.sf.map(function(g){return {round:(g.conf||"")+"F",h:(g.home||{}).abbr,a:(g.away||{}).abbr,s:g.result?g.result.home+"-"+g.result.away:"?"};}))
        .concat([{round:"CHAMP",h:(br.champ.home||{}).abbr,a:(br.champ.away||{}).abbr,s:br.champ.result.home+"-"+br.champ.result.away,final:true}]),
        winnerId:winnerId};
      addN("ðŸ† "+br.champ.winner.icon+" "+br.champ.winner.name+" WINS THE CHAMPIONSHIP!"+(winnerId===myId?" YOU DID IT! ðŸŽ‰":""),"gold");
      // v100: championship broadcast call + coach voice
      if(DYNASTY_MOMENTS_995&&DYNASTY_MOMENTS_995.firstChampionship){
        var _champHistory995=history?history.filter(function(h){return h.winnerId===winnerId;}).length:0;
        var _dmArr995=_champHistory995>=3?DYNASTY_MOMENTS_995.dynastyWatch.broadcast:_champHistory995>=2?DYNASTY_MOMENTS_995.backToBack.broadcast:DYNASTY_MOMENTS_995.firstChampionship.broadcast;
        addN("ðŸ“º "+pick(_dmArr995),"gold");
        if(winnerId===myId){
          var _cvArch995=my&&my.coaches&&my.coaches.HC&&my.coaches.HC.arch?my.coaches.HC.arch:"grinder";
          var _cvArr995=CHAMPION_VOICE_995&&CHAMPION_VOICE_995[_cvArch995]&&CHAMPION_VOICE_995[_cvArch995].win?CHAMPION_VOICE_995[_cvArch995].win:CHAMPION_VOICE_995.grinder.win;
          addN("\uD83C\uDFA4 COACH: \""+pick(_cvArr995)+"\"","cyan");
        }
      }
      if(winnerId===myId)setShowConfetti(true);
      if(entry.mvp)addN("ðŸ… MVP: "+entry.mvp.name+"("+entry.mvp.pos+") â€” "+entry.mvp.hl,"gold");
      if(entry.allPro){addN("â­ All-Pro: "+Object.entries(entry.allPro).map(function(e){return e[0]+":"+e[1].name;}).join(", "),"info");}
      if(entry.opoy)addN("ðŸˆ OPOY: "+entry.opoy.name+"("+entry.opoy.pos+")","green");
      if(entry.dpoy)addN("ðŸ›¡ï¸ DPOY: "+entry.dpoy.name+"("+entry.dpoy.pos+")","green");
      if(entry.roy)addN("ðŸŒŸ ROY: "+entry.roy.name+"("+entry.roy.pos+")","cyan");
      var isUserChamp=winnerId===myId;
      setSeasonTracking(function(prev){return assign({},prev,{isChamp:isUserChamp,madePlayoffs:true});});
      var finalTracking=assign({},seasonTracking,{isChamp:isUserChamp,madePlayoffs:true});
      if(my){
        // v98: Update player goal progress from final stats before evaluating
        updateGoalProgress(my,playerGoals);
        var goalResults=evaluateGoals(my,teams,ownerGoals,coachGoals,playerGoals,finalTracking);
        if(goalResults.completed.length>0)addN("ðŸŽ¯ Goals Met: "+goalResults.completed.map(function(g){return g.label;}).join(", "),"gold");
        if(goalResults.failed.length>0)addN("âŒ Goals Missed: "+goalResults.failed.map(function(g){return g.label;}).join(", "),"red");
        if(goalResults.rewards.ownerMood)my.ownerMood=cl((my.ownerMood||70)+goalResults.rewards.ownerMood,5,99);
        if(goalResults.penalties.ownerMood)my.ownerMood=cl((my.ownerMood||70)+goalResults.penalties.ownerMood,5,99);
        if(goalResults.rewards.morale)my.roster.forEach(function(p){p.morale=cl((p.morale||70)+goalResults.rewards.morale,30,99);});
        if(goalResults.penalties.morale)my.roster.forEach(function(p){p.morale=cl((p.morale||70)+goalResults.penalties.morale,30,99);});
        if(goalResults.rewards.cash)my.cash=(my.cash||50)+goalResults.rewards.cash;
        entry.goalResults=goalResults;
      }
      if(my){
        entry.legacyStats91=LEGACY.buildSeasonStats(my,teams,season,history);
        entry.madePlayoffs=(entry.winnerId===myId||!!(br.seeds&&br.seeds.some&&br.seeds.some(function(s){return s.id===myId;})));
      }
      decayRivalries(teams);
      var awards=buildSeasonAwards(teams,season,history);
      if(awards){
        setSeasonAwards(awards);
        recordAwardHistory(awards,season.year);
        setAwardsCeremony(buildAwardsCeremony(awards));
      }
      updateCoachLegacy(teams,season);
      if(pr&&pr.champion){recordCoachRing(teams,pr.champion);}
      autoRingOfHonor(teams,history,season.year);
      var hofInductees=autoHallOfFame(teams,history,season.year);
      if(hofInductees.length>0){
        hofInductees.forEach(function(h){
          addN("ðŸ›ï¸ HALL OF FAME: "+h.name+" ("+h.pos+") inducted! Legacy Score: "+h.score,"gold");
          setInbox(function(prev){
            return (prev||[]).concat([{type:"hof",icon:"ðŸ›ï¸",text:h.name+" inducted into the Hall of Fame (Score: "+h.score+")",color:"gold",id:broadcastEventId("hof")}]);
          });
          setInboxRead(false);
          // v98.6 #20: HOF Ceremony
          (function(){try{
            var hofLines986=CEREMONY_986.generateHoFSpeech({name:h.name,pos:h.pos,college:h.college||""},{allPros:h.allPros||0,proBowls:h.proBowls||0,seasons:h.seasons||0});
            setHofCeremony986({type:"hof",player:h.name+" ("+h.pos+")",lines:hofLines986,score:h.score});
            setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year,0,"milestone",h.name+" inducted into Hall of Fame (Score: "+h.score+")","ðŸ›ï¸");});
          }catch(e986hof){console.error("v98.6 HOF ceremony error:",e986hof);}})();
        });
      }
      var dnaRpt=buildDNAImpactReport(leagueDNA,teams,season);
      if(dnaRpt)setDnaReport(dnaRpt);
      var ctResult=processCoachingTree(teams,season,RNG.ai);
      if(ctResult.moves.length>0){
        ctResult.moves.forEach(function(m){addN("ðŸŽ“ "+m.text,"cyan");});
        setCoachTreeLog(COACHING_TREE_LOG);
      }
      var expiring=my?my.roster.filter(function(p){return p.contract.years<=1&&p.ovr>=65;}):[];
      setReSignPool(expiring);
      setSeason(function(s){return assign({},s,{phase:"seasonRecap",pr:pr});});
      doSave(null,null,assign({},season,{phase:"seasonRecap",pr:pr}),null,nh);
    }
    setPoBracket(br);
  }
  function simPlayoffs(){initPlayoffs();}
  function answerPress(optId){
    if(!pressConf)return;
    var opt=pressConf.opts.find(function(o){return o.id===optId;});
    if(!opt)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    if(u2){
      if(opt.fx.morale){u2.roster.forEach(function(p){p.morale=cl((p.morale||70)+opt.fx.morale,30,99);});}
      if(opt.fx.ownerApproval&&owner){setOwner(function(prev){return assign({},prev,{approval:cl((prev.approval||50)+opt.fx.ownerApproval,0,100)});});}
      if(opt.fx.systemFit&&pressConf.schemeSide){
        var fitBoost=Math.round(opt.fx.systemFit);
        var fitPos=pressConf.schemeSide==="off"?["QB","RB","WR","TE","OL"]:["DL","LB","CB","S"];
        u2.roster.forEach(function(p){
          if(fitPos.indexOf(p.pos)>=0)p.systemFit=cl((p.systemFit||30)+fitBoost,0,100);
        });
        addN("ðŸ§  Locker room buy-in improved system familiarity (+"+fitBoost+").","cyan");
      }
      if(opt.fx.rivalHeat&&pressConf.oppName){
        var uG2=sched.find(function(g){return g.week===season.week&&(g.home===myId||g.away===myId);});
        if(uG2){
          var oppId65h=uG2.home===myId?uG2.away:uG2.home;
          var rk65=rivalryKey?rivalryKey(myId,oppId65h):null;
          if(rk65&&season.rivalries&&season.rivalries[rk65]){
            season.rivalries[rk65].heat=cl((season.rivalries[rk65].heat||0)+opt.fx.rivalHeat,0,25);
          }
        }
      }
      setTeams(nt);
    }
    var tag66=PRESS_TAG_MAP[opt.id]||"stoic";
    var pressMargin67=pressConf.margin||0;
    setMediaState(function(prev){
      var newTags=(prev.tags||[]).concat([tag66]);
      if(newTags.length>12)newTags=newTags.slice(-12);
      var credDelta=CREDIBILITY_MATH.calcDelta(tag66,pressMargin67);
      if(CLINIC.hasPerk(coachClinic,"ldr1")){credDelta+=1;}
      return{tags:newTags,credibility:cl((prev.credibility||50)+credDelta,10,95)};
    });
    if(CLINIC.hasPerk(coachClinic,"ldr1")){setCoachClinic(function(prev){var c=assign({},prev);CLINIC_MATH.logApply(c,"ldr1");return c;});}
    setCoachClinic(function(prev){return CLINIC.earnXP(assign({},prev),"press_answer",5);});
    var persona66=getMediaPersona((mediaState.tags||[]).concat([tag66]));
    if(persona66){addN("ðŸŽ™ï¸ Media persona: "+persona66.emoji+" "+persona66.label,"purple");}
    addN("ðŸŽ™ï¸ Press Conference: \""+opt.label.replace(/[ðŸ”¥ðŸ¤ðŸ˜¤ðŸ’ªâž¡ï¸ðŸ™ðŸ˜ŽðŸŽ¯ðŸ’ŽðŸ“‹â­]/g,"").trim()+"\"","cyan");
    setPressConf(null);
  }
  function moveToPS(pid){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var p=u2.roster.find(function(x){return x.id===pid;});if(!p) return;
    if(!u2.practiceSquad)u2.practiceSquad=[];
    if(u2.practiceSquad.length>=PS_CAP){addN("âŒ Practice Squad full ("+PS_CAP+")!","red");return;}
    u2.roster=u2.roster.filter(function(x){return x.id!==pid;});
    u2.capUsed-=p.contract.salary;// PS doesn't count against cap
    u2.practiceSquad.push(p);
    addN("ðŸ“‹ "+p.name+"("+p.pos+") â†’ Practice Squad. Cap freed: $"+p.contract.salary+"M","info");
    logTx("PS_MOVE",{name:p.name,pos:p.pos,ovr:p.ovr,direction:"down"});
    setTeams(nt);doSave(nt);
  }
  function promoteFromPS(pid){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    if(!u2.practiceSquad) return;
    var p=u2.practiceSquad.find(function(x){return x.id===pid;});if(!p) return;
    var limit=season.phase==="preseason"||season.phase==="cutDay"?CAMP_CAP:ROSTER_CAP;
    if(u2.roster.length>=limit){addN("âŒ Active roster full ("+limit+")!","red");return;}
    u2.practiceSquad=u2.practiceSquad.filter(function(x){return x.id!==pid;});
    u2.roster.push(p);u2.capUsed+=p.contract.salary;
    addN("â¬†ï¸ "+p.name+"("+p.pos+") promoted to Active Roster!","green");
    logTx("PS_MOVE",{name:p.name,pos:p.pos,ovr:p.ovr,direction:"up"});
    setTeams(nt);doSave(nt);
  }
  function aiPoachPS(nt){
    nt.forEach(function(t){
      if(t.isUser||!t.practiceSquad||!t.practiceSquad.length) return;
    });
    var u2=nt.find(function(t){return t.id===myId;});
    if(!u2||!u2.practiceSquad||!u2.practiceSquad.length) return;
    var exposed=u2.practiceSquad.filter(function(p){return p.pot>=75&&p.ovr<=68;});
    if(!exposed.length) return;
    var aiTeams=nt.filter(function(t){return !t.isUser&&t.roster.length<ROSTER_CAP;});
    exposed.forEach(function(p){
      if(RNG.ai()<0.25&&aiTeams.length>0){// 25% chance per exposed player
        var stealer=pick(aiTeams);
        u2.practiceSquad=u2.practiceSquad.filter(function(x){return x.id!==p.id;});
        stealer.roster.push(p);stealer.capUsed+=p.contract.salary;
        addN("âš ï¸ "+stealer.icon+stealer.abbr+" poached "+p.name+"("+p.pos+" "+p.ovr+") from your PS!","red");
        logTx("PS_POACH",{name:p.name,pos:p.pos,ovr:p.ovr,pot:p.pot,team:stealer.abbr});
      }
    });
  }
  function finishCutDay(){
    if(!my) return;
    if(my.roster.length>ROSTER_CAP){
      addN("âŒ Must cut to "+ROSTER_CAP+"! Currently: "+my.roster.length+". Cut "+(my.roster.length-ROSTER_CAP)+" more.","red");
      return;
    }
    var nt=teams.slice();
    nt.forEach(function(t){
      if(t.isUser) return;
      while(t.roster.length>ROSTER_CAP){
        var worst=t.roster.slice().sort(function(a,b){return a.ovr-b.ovr;})[0];
        t.roster=t.roster.filter(function(x){return x.id!==worst.id;});
        t.capUsed-=worst.contract.salary;
      }
    });
    aiPoachPS(nt);
    setTeams(nt);
    setSeason(function(s){return assign({},s,{phase:"regular",week:1});});
    addN("âœ… Final "+ROSTER_CAP+"-man rosters locked. Regular Season begins!","gold");
    logTx("CUT_DAY",{rosterSize:my.roster.length,psSize:(my.practiceSquad||[]).length});
    setTab("home");doSave(nt);
  }
  var RESIGN_AGENT_TYPES=[
    {id:"hardball",name:"Hardball",icon:"ðŸ’¼",desc:"Asks high, hates lowballs",demandMult:1.35,walkThresh:0.85},
    {id:"loyalty",name:"Loyalty-First",icon:"ðŸ¤",desc:"Discounts for winning teams",demandMult:0.90,walkThresh:0.6},
    {id:"market",name:"Market-Chaser",icon:"ðŸ“Š",desc:"Tests FA unless overpaid",demandMult:1.15,walkThresh:0.95}
  ];
  function getReSignAgentType(p){
    if(!p)return RESIGN_AGENT_TYPES[2];
    // v95.1: check full traits95 array (up to 3 traits) + legacy p.trait fallback
    var allTraits=Array.isArray(p.traits95)&&p.traits95.length>0?p.traits95:[p.trait||"none"];
    var hasHardball=allTraits.some(function(t){return t==="mercenary"||t==="diva"||t==="stat_padder"||t==="media_darling";});
    var hasLoyal=allTraits.some(function(t){return t==="loyal"||t==="captain"||t==="hometown_hero";});
    var hasChip=allTraits.some(function(t){return t==="chip";});// chip on shoulder â†’ market-chaser (prove it in open market)
    if(hasHardball&&!hasLoyal)return RESIGN_AGENT_TYPES[0];// Hardball
    if(hasLoyal&&!hasHardball)return RESIGN_AGENT_TYPES[1];// Loyalty (hometown_hero gets discount)
    if(hasChip)return RESIGN_AGENT_TYPES[2];// Market-Chaser â€” wants to prove value
    var hashSrc=(typeof p.id==="string"&&p.id)?p.id:"x";
    var hash=((hashSrc.charCodeAt(0)||120)%3);
    return RESIGN_AGENT_TYPES[hash]||RESIGN_AGENT_TYPES[2];
  }
  function getReSignDemandInfo(p){
    var agent=getReSignAgentType(p);
    var baseMult=agent.demandMult;
    var demandMult=baseMult;
    var myWins=my&&my.wins||0;
    var fitScore86=my?calcPlayerIdentityFit(p,my).score:70;
    var fitScalar86=(fitScore86-70)/30;
    var inflate=1+Math.max(0,(season.year-2026)*0.03);// +3% per year
    demandMult*=inflate;
    var winAdjMult=1,marketAdjMult=1;
    if(agent.id==="loyalty"&&myWins>=8){demandMult*=0.85;winAdjMult*=0.85;}
    if(agent.id==="hardball"&&myWins>=10){demandMult*=1.10;winAdjMult*=1.10;}
    if(agent.id==="market"&&p.ovr>=80){demandMult*=1.15;marketAdjMult*=1.15;}
    var prePersonalityMult=demandMult;
    var _reFx=getContractPersonalityEffects(p,{isContender:myWins>=10,roleConflict:p.isStarter===false});
    demandMult+=_reFx.demandMultAdj;
    var fitDemandAdj86=0;
    fitDemandAdj86-=Math.max(0,fitScalar86)*0.07;
    fitDemandAdj86+=Math.max(0,-fitScalar86)*0.06;
    demandMult+=fitDemandAdj86;
    var demandMultPreClamp=demandMult;
    demandMult=cl(demandMult,0.75,1.45);
    var baseSalary86=p.contract.salary||MIN_SALARY;
    var demand=Math.round(baseSalary86*demandMult*10)/10;
    var noFitMult86=cl(prePersonalityMult+_reFx.demandMultAdj,0.75,1.45);
    var noFitDemand86=Math.round(baseSalary86*noFitMult86*10)/10;
    var fitImpactDollar86=Math.round((demand-noFitDemand86)*10)/10;
    var walkThresh=agent.walkThresh;
    var fitWalkAdj86=0;
    walkThresh+=_reFx.walkThreshAdj;
    fitWalkAdj86-=Math.max(0,fitScalar86)*0.04;
    fitWalkAdj86+=Math.max(0,-fitScalar86)*0.03;
    walkThresh+=fitWalkAdj86;
    var walkPreClamp86=walkThresh;
    walkThresh=cl(walkThresh,0.5,0.98);
    return{agent:agent,demand:demand,demandMult:demandMult,walkThresh:walkThresh,pers:_reFx.pers,fitScore:fitScore86,
      multBreakdown:{base:baseMult,inflation:inflate,winAdjMult:winAdjMult,marketAdjMult:marketAdjMult,
        prePersonality:prePersonalityMult,persAdd:_reFx.demandMultAdj,fitAdd:fitDemandAdj86,preClamp:demandMultPreClamp,final:demandMult,
        noFitDemand:noFitDemand86,fitImpact:fitImpactDollar86},
      walkBreakdown:{base:agent.walkThresh,persAdd:_reFx.walkThreshAdj,fitAdd:fitWalkAdj86,preClamp:walkPreClamp86,final:walkThresh}};
  }
  var NEG_FLAVOR84={
    hardball:{
      workEthic:["He says his film grade earns a premium today.","His camp says production demands real guarantees.","He wants commitment equal to his workload."],
      loyalty:["He wants to stay, but only at fair value.","He asked for meaningful movement before the next call.","He says this is the last serious chance."],
      greed:["He is not budging. His camp wants top dollar.","Still fixed at his number with no movement.","Final warning from his agent: pay now or lose him."],
      pressure:["He says clutch players are paid in full.","His side keeps citing big-game tape as leverage.","He says pressure moments are what teams buy."],
      ambition:["He wants a deal that reflects star trajectory.","His reps say he is chasing top-tier status.","He wants terms built for where he is headed."]
    },
    loyalty:{
      workEthic:["He asks for recognition of daily consistency.","He says teammates trust his preparation weekly.","He can compromise if role and respect stay clear."],
      loyalty:["He wants to stay, but family comes first.","He told his agent this city still matters most.","One fair offer keeps him home."],
      greed:["He asked for more, but left room to talk.","He softened slightly if years are right.","He can bend if respect is shown."],
      pressure:["He says poise under pressure has value.","He wants clutch reliability reflected in the number.","He asks for final terms that match big games."],
      ambition:["He wants a path to lead and grow here.","He asked for structure that rewards future growth.","He is close, but wants upside in the finish."]
    },
    market:{
      workEthic:["His reps say workload should set the number.","They point to durability and weekly output.","He wants market value for consistency."],
      loyalty:["He likes this locker room, but tests value.","His agent says comfort helps, not enough.","He asked for a hometown edge before signing."],
      greed:["His camp is comparing every dollar available.","They say outside bids can move this quickly.","He wants top-range money before the window closes."],
      pressure:["He says crunch-time production travels anywhere.","His side expects contenders to pay for poise.","He is ready to leverage late-game tape."],
      ambition:["His agent is polling other teams right now.","Word is a division rival is interested.","He wants a launchpad contract before committing."]
    }
  };
  var NEG_FLAVOR84_TRAIT_OUTCOME={
    loyalty:{
      accepted:["He stayed. He said this city still feels like home.","Deal done, and he called it the right place.","He stayed for continuity and trust."],
      walked:["He did not want to leave. This one stings.","He left reluctantly after trust faded.","He thanked the room before walking out."],
      deadline:["Talks ended before trust and dollars aligned.","They ran out of time before common ground.","Deadline hit while both sides held their line."]
    },
    greed:{
      accepted:["Deal done after the money finally met his mark.","He signed once the number reached his range.","Agreement landed when dollars matched expectations."],
      walked:["He left for leverage and better market value.","He walked once the number stalled.","He chose free agency over a discount."],
      deadline:["Talks expired with a firm gap on money.","Deadline passed while the number stayed apart.","No deal as salary expectations held."]
    },
    ambition:{
      accepted:["He signed after the deal matched his trajectory.","Agreement reached with growth built into terms.","He stayed once upside aligned with his goals."],
      walked:["He left to chase a bigger platform.","He walked to pursue a larger role.","He moved on for a wider opportunity set."],
      deadline:["Talks ended with future role still unresolved.","Deadline hit before long-term vision aligned.","No deal with trajectory terms still apart."]
    },
    workEthic:{
      accepted:["He signed and said the grind never stops.","Deal done, he was back in the film room that evening.","He committed, then asked when offseason workouts start."],
      walked:["He left to find a program that matches his standard.","He walked after deciding the culture was not the right fit.","He moved on, citing a desire for a harder-working environment."],
      deadline:["Talks ended before work-ethic expectations were met.","Deadline passed while program fit remained in question.","No deal as both sides ran out of time to align on culture."]
    },
    pressure:{
      accepted:["He signed and said he lives for big moments.","Deal done, he mentioned the playoff run as the deciding factor.","He committed, calling the stage here exactly what he wants."],
      walked:["He left seeking a bigger platform for his game.","He walked, saying he needs a contender environment.","He moved on to find a team he believes can win it all."],
      deadline:["Talks ended before a winning case could seal the deal.","Deadline passed while contender credentials stayed in question.","No deal as championship ambitions and offer size never aligned."]
    }
  };
  var NEG_FLAVOR84_FALLBACK={
    hardball:{
      counter:["His camp is firm and wants movement.","He is holding his line for now.","Last call from his agent before he tests market."],
      accepted:["Deal done. He shook hands and called his family.","Agreement reached after a hard negotiation.","Contract signed after both sides moved enough."],
      walked:["He cleared out his locker. No hard feelings, just business.","He walked when the number stalled.","Talks ended and he moved on immediately."],
      deadline:["Talks expired. Both sides ran out of runway.","The window closed before a deal formed.","Deadline passed with no agreement."]
    },
    loyalty:{
      counter:["He wants to stay, but needs a fair step up.","He asked for one more move to stay here.","He is open, but waiting on respect in the number."],
      accepted:["Deal done, and he said this place feels right.","Agreement reached with both sides aligned.","Contract signed after steady progress."],
      walked:["He did not want to leave, but chose the market.","He walked after talks cooled off.","He thanked the staff and moved on."],
      deadline:["Talks ended before both sides met in the middle.","Deadline passed while details remained apart.","No deal before the clock ran out."]
    },
    market:{
      counter:["His agent is still checking outside leverage.","His side says market interest is active.","He is weighing options while talks continue."],
      accepted:["Deal signed after market checks settled.","Agreement reached once value matched.","He committed after comparing options."],
      walked:["He chose to test the market after talks stalled.","He moved on to open bidding.","He left negotiations to pursue better value."],
      deadline:["Deadline passed while his camp weighed options.","Talks expired with market leverage unresolved.","No deal before free-agency pressure peaked."]
    }
  };
  function getReSignNegFlavor84(agentId,dominantTrait,roundNum,outcome){
    var aid=agentId||"market";
    var trait=dominantTrait||"";
    var round=cl(parseInt(roundNum,10)||1,1,3);
    var idx=round-1;
    var agentMap=NEG_FLAVOR84[aid]||NEG_FLAVOR84.market;
    var fb=NEG_FLAVOR84_FALLBACK[aid]||NEG_FLAVOR84_FALLBACK.market;
    var out=outcome||"counter";
    if(out==="counter"){
      var ctr=(agentMap[trait]&&agentMap[trait].length)?agentMap[trait]:fb.counter;
      return ctr[idx%ctr.length];
    }
    var traitOut=(NEG_FLAVOR84_TRAIT_OUTCOME[trait]&&NEG_FLAVOR84_TRAIT_OUTCOME[trait][out])?NEG_FLAVOR84_TRAIT_OUTCOME[trait][out]:null;
    var baseOut=fb[out]||fb.counter;
    var pool=(traitOut&&traitOut.length)?traitOut:baseOut;
    return pool[idx%pool.length];
  }
  function calcAgentCounterAsk84(p,lastOffer,demand,demandInfo){
    var agent=(demandInfo&&demandInfo.agent)?demandInfo.agent:getReSignAgentType(p);
    var ask=demand;
    if(agent.id==="hardball")ask=demand;
    else if(agent.id==="loyalty")ask=Math.round(demand*0.9*10)/10;
    else ask=Math.round(((lastOffer+demand)/2)*10)/10;
    if(ask<=lastOffer)ask=Math.round((lastOffer+0.1)*10)/10;
    return ask;
  }
  function applyReSignAccepted84(pid,offer,years){
    if(!my)return false;
    var p=reSignPool.find(function(x){return x.id===pid;});if(!p)return false;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return false;
    var rp=u2.roster.find(function(x){return x.id===pid;});
    var yrs=Math.max(1,Math.min(5,parseInt(years,10)||3));
    var sal=Math.round((offer||0)*10)/10;
    var demandInfo=getReSignDemandInfo(p);
    var demand=Math.round((((demandInfo&&demandInfo.demand)||sal)*10))/10;
    var belowDemand=sal<(demand*0.92);
    var pers=getPersonality(p);
    var loyaltyDiscount=Math.max(0,Math.round((demand-sal)*10)/10);
    if(!rp||sal<=0)return false;
    rp.contract={salary:sal,years:yrs,bonus:0};
    u2.capUsed=capCalc(u2.roster);
    if(!u2.reSignNeg84)u2.reSignNeg84={};
    if(u2.reSignNeg84[pid])delete u2.reSignNeg84[pid];
    setReSignPool(function(prev){return prev.filter(function(x){return x.id!==pid;});});
    setTeams(nt);doSave(nt);
    addN("âœï¸ Re-signed "+p.name+"("+p.pos+") $"+sal+"M/"+yrs+"yr after negotiation.","green");
    logTx("RE_SIGN",{name:p.name,pos:p.pos,ovr:p.ovr,salary:sal,trait:p.trait,agent:"neg84",years:yrs});
    ledgerLog("SIGN",myId,"Re-signed "+p.name+"("+p.pos+" OVR"+p.ovr+") $"+sal+"M/"+yrs+"yr (negotiated)",
      {pid:pid,name:p.name,pos:p.pos,ovr:p.ovr,salary:sal,years:yrs,type:"resign"});
    if(belowDemand&&pers.loyalty>=7&&loyaltyDiscount>0){
      setInbox(function(prev){
        return [{type:"story",icon:STORY_BEATS86.hometown_hero.icon,
          text:p.name+" took less to stay. Loyalty discount: $"+loyaltyDiscount+"M.",
          color:STORY_BEATS86.hometown_hero.color,id:U(),storyBeat:STORY_BEATS86.hometown_hero.id,playerId:p.id,week:season.week
        }].concat(prev||[]);
      });
      addN(p.name+" chose home over money.","green");
    }
    return true;
  }
  function finalizeWalkedNeg84(pid,reason){
    if(!my)return;
    var p=reSignPool.find(function(x){return x.id===pid;});if(!p)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    if(u2){
      if(!u2.reSignNeg84)u2.reSignNeg84={};
      if(u2.reSignNeg84[pid])delete u2.reSignNeg84[pid];
    }
    p.formerTeam=myId;p.formerTeamName=my.abbr;
    setReSignPool(function(prev){return prev.filter(function(x){return x.id!==pid;});});
    setTeams(nt);doSave(nt);
    addN("ðŸšª "+p.name+" walked from negotiations"+(reason?" ("+reason+")":"")+".","orange");
  }
  function startReSignNeg84(pid,initialSalary,years){
    if(!my)return;
    var p=reSignPool.find(function(x){return x.id===pid;});if(!p)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return;
    if(!u2.reSignNeg84)u2.reSignNeg84={};
    var current=u2.reSignNeg84[pid];
    if(current&&current.status==="open"){addN("ðŸ¤ Negotiation already open for "+p.name+".","dim");return;}
    var demandInfo=getReSignDemandInfo(p);
    var demand=demandInfo.demand;
    var baseSalary=p.contract.salary||MIN_SALARY;
    var offer=Math.round((initialSalary||0)*10)/10;
    if(offer<=0){addN("â— Enter a valid negotiation offer.","red");return;}
    var yearsNum=Math.max(1,Math.min(5,parseInt(years,10)||3));
    if(offer>=demand){
      applyReSignAccepted84(pid,offer,yearsNum);
      return;
    }
    var walkFloor=Math.round((baseSalary*demandInfo.walkThresh)*10)/10;
    if(offer<walkFloor){
      u2.reSignNeg84[pid]={pid:pid,rounds:[{round:1,gmOffer:offer,agentAsk:demand,outcome:"walked"}],status:"walked",
        finalSalary:null,finalYears:yearsNum,deadline:(season.week||1)+2};
      finalizeWalkedNeg84(pid,"lowball");
      return;
    }
    var counterAsk=calcAgentCounterAsk84(p,offer,demand,demandInfo);
    u2.reSignNeg84[pid]={pid:pid,rounds:[{round:1,gmOffer:offer,agentAsk:counterAsk,outcome:"counter"}],status:"open",
      finalSalary:null,finalYears:yearsNum,deadline:(season.week||1)+2};
    setTeams(nt);doSave(nt);
    addN("ðŸ¤ Round 1: "+p.name+" counters at $"+counterAsk+"M.","cyan");
  }
  function advanceReSignNeg84(pid,newOffer,years){
    if(!my)return;
    var p=reSignPool.find(function(x){return x.id===pid;});if(!p)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return;
    if(!u2.reSignNeg84)u2.reSignNeg84={};
    var neg=u2.reSignNeg84[pid];
    if(!neg||neg.status!=="open"){startReSignNeg84(pid,newOffer,years);return;}
    var demandInfo=getReSignDemandInfo(p);
    var demand=demandInfo.demand;
    var baseSalary=p.contract.salary||MIN_SALARY;
    var offer=Math.round((newOffer||0)*10)/10;
    if(offer<=0){addN("â— Enter a valid negotiation offer.","red");return;}
    var rounds=neg.rounds||[];
    var roundNum=rounds.length+1;
    var targetAsk=rounds.length>0?(rounds[rounds.length-1].agentAsk||demand):demand;
    var yearsNum=Math.max(1,Math.min(5,parseInt(years,10)||neg.finalYears||3));
    if(offer>=targetAsk){
      rounds.push({round:roundNum,gmOffer:offer,agentAsk:targetAsk,outcome:"accepted"});
      neg.rounds=rounds;neg.status="accepted";neg.finalSalary=offer;neg.finalYears=yearsNum;
      u2.reSignNeg84[pid]=neg;
      applyReSignAccepted84(pid,offer,yearsNum);
      return;
    }
    var walkFloor=Math.round((baseSalary*demandInfo.walkThresh)*10)/10;
    if(offer<walkFloor){
      rounds.push({round:roundNum,gmOffer:offer,agentAsk:targetAsk,outcome:"walked"});
      neg.rounds=rounds;neg.status="walked";neg.finalSalary=null;
      u2.reSignNeg84[pid]=neg;
      finalizeWalkedNeg84(pid,"agent walked");
      return;
    }
    if(roundNum>=3){
      rounds.push({round:roundNum,gmOffer:offer,agentAsk:targetAsk,outcome:"deadline"});
      neg.rounds=rounds;neg.status="deadline";neg.finalSalary=null;
      u2.reSignNeg84[pid]=neg;
      finalizeWalkedNeg84(pid,"deadline");
      return;
    }
    var nextAsk=calcAgentCounterAsk84(p,offer,demand,demandInfo);
    rounds.push({round:roundNum,gmOffer:offer,agentAsk:nextAsk,outcome:"counter"});
    neg.rounds=rounds;neg.status="open";neg.finalYears=yearsNum;
    u2.reSignNeg84[pid]=neg;
    setTeams(nt);doSave(nt);
    addN("ðŸ¤ Round "+roundNum+": "+p.name+" counters at $"+nextAsk+"M.","cyan");
  }
  function submitReSignOffer84(pid,salary,years){
    var salNum=parseFloat(salary);
    if(isNaN(salNum)||salNum<=0){addN("â— Enter a valid salary amount.","red");return;}
    var neg=(my&&my.reSignNeg84)?my.reSignNeg84[pid]:null;
    if(neg&&neg.status==="open")advanceReSignNeg84(pid,salNum,years||3);
    else startReSignNeg84(pid,salNum,years||3);
    setCustomOfferPid(null);setCustomOfferVal("");
  }
  function reSignPlayer(pid,offerMult){
    if(!my) return;var p=reSignPool.find(function(x){return x.id===pid;});if(!p) return;
    var demandInfo=getReSignDemandInfo(p);
    var agent=demandInfo.agent;
    var base=p.contract.salary;
    var demand=demandInfo.demand;
    var offer=Math.round(base*offerMult*10)/10;
    if(offer>=demand){
      var yearsQuick87=rng(2,4);
      if(applyReSignAccepted84(pid,offer,yearsQuick87)){
        addN("ðŸ¤ Agent handled: "+agent.icon+agent.name,"cyan");
      }
    }else{
      addN("âŒ "+p.name+" ("+agent.icon+agent.name+") rejected $"+offer+"M. Wants $"+demand+"M.","red");
      if(offerMult<demandInfo.walkThresh){
        addN("ðŸšª "+p.name+"'s agent walked! "+agent.name+" won't negotiate further.","orange");
        p.formerTeam=myId;p.formerTeamName=my.abbr;// Revenge tag
        var ntWalk=teams.slice();var uWalk=ntWalk.find(function(t){return t.id===myId;});
        if(p.ovr>=80&&uWalk){
            uWalk.roster.forEach(function(r){
              if((r.cliqueId||0)===2)r.chemistry=cl((r.chemistry||60)-12,15,100);// Stars furious
              else if((r.cliqueId||0)===0)r.chemistry=cl((r.chemistry||60)-3,15,100);// Vets notice
            });
            addN("ðŸ‘¥ Stars clique FURIOUS after "+p.name+" walks â€” 'They don't value us here'","red");
        }
        if(uWalk&&uWalk.reSignNeg84&&uWalk.reSignNeg84[pid])delete uWalk.reSignNeg84[pid];
        setReSignPool(function(prev){return prev.filter(function(x){return x.id!==pid;});});
        setTeams(ntWalk);doSave(ntWalk);
      }
    }
  }
  function reSignPlayerDirect(pid,salary){
    var salNum=parseFloat(salary);
    if(isNaN(salNum)||salNum<=0){addN("â— Enter a valid salary amount.","red");return;}
    var p=reSignPool.find(function(x){return x.id===pid;});if(!p) return;
    reSignPlayer(pid,salNum/p.contract.salary);
    setCustomOfferPid(null);setCustomOfferVal("");
  }
  function franchiseTagReSign973(pid){
    if(!my)return;
    if(["reSign","combine","draft","freeAgency"].indexOf(season.phase)<0){addN("ðŸš« Franchise tag only available in the offseason.","red");return;}
    var p=reSignPool.find(function(x){return x.id===pid;});if(!p)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return;
    var tagYear973=(season.year||2026)+1;
    if(u2.franchiseTag973&&u2.franchiseTag973.year&&u2.franchiseTag973.year<tagYear973)u2.franchiseTag973=null;
    if(u2.franchiseTag973&&u2.franchiseTag973.year===tagYear973){addN("ðŸš« Already used franchise tag for "+tagYear973+".","red");return;}
    var tagSal=getFranchiseTagSalary973(p.pos,nt);
    if(!confirm("Tag "+p.name+" at $"+tagSal+"M for 1 year? This uses your franchise tag for "+tagYear973+"."))return;
    var tagged=assign({},p,{contract:migrateContract(p.contract),ratings:assign({},p.ratings||{})});
    var res=applyFranchiseTag973(u2,tagged,nt,tagYear973);
    if(!res.ok){addN("ðŸš« "+res.msg,"red");return;}
    // Re-sign phase happens before newSeason() rollover decrements contract years.
    // Bridge the tagged deal through rollover so it becomes a true 1-year deal in preseason.
    tagged.contract.years=Math.max(2,tagged.contract.years||1);
    u2.roster.push(tagged);
    u2.capUsed=capCalc(u2.roster);
    if(!u2.reSignNeg84)u2.reSignNeg84={};
    if(u2.reSignNeg84[pid])delete u2.reSignNeg84[pid];
    setReSignPool(function(prev){return (prev||[]).filter(function(x){return x.id!==pid;});});
    setTeams(nt);doSave(nt);
    addN("ðŸ·ï¸ "+res.msg,"gold");
    logTx("FRANCHISE_TAG_973",{name:tagged.name,pos:tagged.pos,salary:res.salary,reaction:res.reaction,year:tagYear973});
    ledgerLog("FRANCHISE_TAG_973",myId,"Tagged "+tagged.name+" ("+tagged.pos+") at $"+res.salary+"M ["+res.reaction+"]",{name:tagged.name,pos:tagged.pos,salary:res.salary,reaction:res.reaction,year:tagYear973});
    if(res.reaction==="holdout"){
      setInbox(function(prev){
        return [{type:"holdout",icon:"ðŸ·ï¸",text:tagged.name+" refuses the tag and begins a holdout. Use Pay / Wait / Trade in the franchise tag banner.",color:"red",id:U()}].concat(prev||[]);
      });
      setInboxRead(false);
    }
  }
  function skipToTrade(){
    if(my){
      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
      if(u2)u2.reSignNeg84={};
      setTeams(nt);doSave(nt);
    }
    setSeason(function(s){return assign({},s,{phase:"combine"});});setTab("scouting");
    addN("ðŸ“‹ Re-Sign complete. "+reSignPool.length+" players hit Free Agency.","info");
    addN("ðŸ‹ï¸ COMBINE: Evaluate prospects before the draft! Scout pts: "+(my?my.scoutPts:0),"cyan");
    setDraftPreview(buildDraftPreview(dc,teams,myId));
  }
  function finishCombine(){
    var scoutedCount=dc.filter(function(p){return typeof p.scouted==="object"&&p.scouted.complete;}).length;
    setSeason(function(s){return assign({},s,{phase:"draft"});});setTab("home");
    addN("ðŸ‹ï¸ COMBINE COMPLETE! "+scoutedCount+" prospects fully evaluated. Draft Day awaits!","gold");
    addN("ðŸ“º "+dc.length+" young men ready to hear their names called. This is what it's all about.","cyan");
  }
  function toggleTradeBlock(pid){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var p=u2.roster.find(function(x){return x.id===pid;});if(!p) return;
    p.onTradeBlock=!p.onTradeBlock;
    if(p.onTradeBlock)addN("ðŸ“¢ "+p.name+" placed on trading block.","orange");
    else addN("ðŸ“¢ "+p.name+" removed from trading block.","info");
    setTeams(nt);doSave(nt);
  }
  function genTradeBlockOffers(nt){
    var u=nt.find(function(t){return t.id===myId;});if(!u) return [];
    var blocked=u.roster.filter(function(p){return p.onTradeBlock;});if(!blocked.length) return [];
    var offers=[];
    nt.filter(function(t){return !t.isUser;}).forEach(function(ai){
      var needs=getTeamNeeds(ai);var mode=deriveAITeamMode(ai,season.year);
      var strat=modeToAiStrategy(mode);
      blocked.forEach(function(p){
        if(!needs[p.pos]&&mode!=="contend") return;
        if(mode==="rebuild"&&p.ovr<75) return;// Rebuilders only bite on true blue-chip assets
        var pVal=getTradeValue(p,needs,ai);
        var offerLabel="";
        if(mode==="contend"){
          var r1=ai.draftPicks?ai.draftPicks.find(function(pk){return pk.round<=2;}):null;
          if(r1)offerLabel="Rd"+r1.round+" pick";else offerLabel="Rd3+ pick";
        }else{
          var chip=ai.roster.filter(function(x){return x.age<=25&&x.ovr>=68&&x.ovr<=78;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
          if(chip)offerLabel=chip.name+"("+chip.pos+" "+chip.ovr+")";else offerLabel="Rd2 pick";
        }
        if(offerLabel)offers.push({type:"trade_offer",icon:"ðŸ“ž",text:ai.icon+ai.abbr+" ("+strat+") wants "+p.name+"! Offers: "+offerLabel,color:"gold",urgent:true,id:U(),aiId:ai.id,playerId:p.id,label:offerLabel});
      });
    });
    return offers.slice(0,3);
  }
  function startDraft(){
    try{
    var draftClass=dc;
    if(!draftClass||draftClass.length===0){
      addN("âš ï¸ Draft class not found â€” regenerating 300 prospects...","orange");
      draftClass=genDraftClass(getScaledDraftClassCount97());
      setDC(draftClass);
      var narr76=generateDraftClassNarrative(draftClass);
      if(narr76){narr76.year=season.year;setDraftNarrative76(narr76);}
    }
    if(draftClass&&draftClass.length>0&&!draftNarrative76){
      var narr76b=generateDraftClassNarrative(draftClass);
      if(narr76b){narr76b.year=season.year;setDraftNarrative76(narr76b);}
    }
    if(!draftClass||draftClass.length===0){addN("âŒ No draft class available! Cannot start draft.","red");return;}
    var standings=teams.slice().sort(function(a,b){return a.wins-b.wins||(a.pf-a.pa)-(b.pf-b.pa);});
    var standOrder={};standings.forEach(function(t,i){standOrder[t.id]=i;});
    var allPicks=[];
    teams.forEach(function(t){(t.draftPicks||[]).forEach(function(pk){
      if(!pk.year||pk.year===season.year){// Current year picks
        allPicks.push({round:pk.round,ownerId:t.id,originalId:pk.original||t.id,standingOrder:standOrder[pk.original||t.id]||6,pid:pk.pid||U()});
      }
    });});
    if(allPicks.length===0){
      addN("âš ï¸ No draft picks found â€” generating emergency picks...","orange");
      teams.forEach(function(t){
        for(var rd=1;rd<=3;rd++){
          allPicks.push({round:rd,ownerId:t.id,originalId:t.id,standingOrder:standOrder[t.id]||6,pid:U()});
        }
      });
    }
    allPicks.sort(function(a,b){return a.round-b.round||(a.standingOrder-b.standingOrder);});
    allPicks.forEach(function(pk,i){pk.pickNum=i+1;pk.id=U();});
    setDraftBoard(allPicks);setDPk(0);
    setMfsnPickCard(null);setMfsnPickLog([]);// MFSN SHOW v2: reset on new draft
    var dcc=draftClass.slice();var nt=teams.slice();
    ensureLeagueGMArchetypes90(nt);
    var idx=0;
    while(idx<allPicks.length&&allPicks[idx].ownerId!==myId){
      if(!dcc.length)break;// Safety: no more prospects
      dcc=aiDraftPick(nt,allPicks[idx],dcc);idx++;
    }
    setDC(dcc);setTeams(nt);setDPk(idx);
    if(idx<allPicks.length)setDraftOffers(genDraftOffers(idx));
    setSeason(function(s){return assign({},s,{phase:"drafting"});});
    setTab("draft");
    showGuide("draft");
    addN("ðŸ“‹ Draft started! You own "+allPicks.filter(function(pk){return pk.ownerId===myId;}).length+" picks.","gold");
    }catch(e){addN("âŒ Draft error: "+e.message,"red");console.error("startDraft error:",e);}
  }
  function calcRivalInterest(p,draftBoard,teams,currentPick){
    if(!p||!draftBoard||!teams)return[];
    var nextSlots=draftBoard.slice((currentPick||0)+1,(currentPick||0)+7);// next 6 picks
    var rivals=[];var seen={};
    var NEED_THRESH={QB:1,RB:2,WR:3,TE:1,OL:5,DL:4,LB:3,CB:3,S:2,K:1,P:1};
    nextSlots.forEach(function(slot){
      if(!slot||slot.ownerId===myId)return;
      var t=teams.find(function(x){return x.id===slot.ownerId;});
      if(!t||seen[t.id])return;
      var needs=getTeamNeeds?getTeamNeeds(t):{};
      var posCount=(t.roster||[]).filter(function(r){return r.pos===p.pos&&!(r.injury&&r.injury.games>0);}).length;
      var needThresh=NEED_THRESH[p.pos]||2;
      var needsPos=(needs&&needs[p.pos]&&needs[p.pos]>0)||posCount<needThresh;
      if(needsPos){
        seen[t.id]=true;
        rivals.push({abbr:t.abbr,picksAway:Math.max(1,(slot.pickNum||((currentPick||0)+2))-((currentPick||0)+1)),pos:p.pos});
      }
    });
    return rivals.slice(0,3);
  }
  function aiDraftPick(nt,boardPick,dcc){
    var ai=nt.find(function(t){return t.id===boardPick.ownerId;});if(!ai||!dcc.length) return dcc;
    ensureTeamGMArchetype90(ai);
    var aiMode=deriveAITeamMode(ai,season.year);
    var stratForDraft=aiMode==="balanced"?"neutral":aiMode;
    var roundPct=boardPick&&boardPick.round?Math.max(0,Math.min(1,(boardPick.round-1)/6)):0;
    var pk2=aiExpPick(ai.roster,dcc,roundPct,stratForDraft,ai)||dcc[0];
    var slotSal2=SLOT_SALARY[boardPick.pickNum]||MIN_SALARY;
    pk2.contract={salary:slotSal2,years:4,bonus:0};
    pk2._draftYear=season.year;pk2._draftRound=boardPick.round;pk2._draftPick=boardPick.pickNum;// v98.5
    ai.roster.push(assign({},pk2));ai.capUsed+=pk2.contract.salary;
    var gmArch90=getTeamGMArchetype90(ai);
    var aiComment=getDraftCommentary(boardPick.round||1,pk2.ovr||65);
    if(gmArch90&&gmArch90.flavor)aiComment=aiComment+" "+gmArch90.flavor;
    var aiDnEntry=buildDraftNightPick(boardPick,pk2,ai,boardPick.pickNum-1,draftBoard?draftBoard.length:32,nt);
    if(aiDnEntry){
      aiDnEntry.comment=aiComment;
      setDraftShowLog(function(old){return old.concat([aiDnEntry]).slice(-30);});
      // MFSN SHOW v2: generate live analyst pick card
      var showCard=MFSN_SHOW.buildPickCard(aiDnEntry,boardPick.pickNum||1);
      if(showCard){
        setMfsnPickCard(showCard);
        setMfsnPickLog(function(old){return [showCard].concat(old).slice(0,25);});
      }
    }
    logAIDecision(ai.abbr,ai.aiStrategy||"bubble","DRAFT_PICK",
      (gmArch90?gmArch90.icon+" "+gmArch90.label+": ":"")+pk2.name+" ("+pk2.pos+" "+pk2.ovr+")");
    return dcc.filter(function(x){return x.id!==pk2.id;});
  }
  function doDraftPick(p){
    if(!my||dPk>=draftBoard.length) return;
    var boardPick=draftBoard[dPk];
    if(boardPick.ownerId!==myId) return;// Safety: not our pick
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var revealMsg=p.devTrait==="superstar"?"ðŸŒŸ SUPERSTAR dev!":p.devTrait==="star"?"â­ Star dev!":"";
    var trObj=TRAITS[p.trait||"none"]||TRAITS.none;
    var traitMsg=trObj.icon?(" "+trObj.icon+" "+trObj.name):"";
    var slotSal=SLOT_SALARY[boardPick.pickNum]||MIN_SALARY;
    p.contract={salary:slotSal,years:4,bonus:0};
    p._draftYear=season.year;// v80: Track draft year for MFSN revisit
    p._draftRound=boardPick.round;// v80: Track round for grade scoring
    p._draftPick=boardPick.pickNum;// v98.5: Track pick number for draft archive
    u2.roster.push(assign({},p));u2.capUsed+=p.contract.salary;
    var origTeam=teams.find(function(t2){return t2.id===boardPick.originalId;});
    var origLabel=origTeam&&origTeam.id!==myId?" (via "+origTeam.abbr+")":"";
    addN("ðŸ“‹ Pick #"+boardPick.pickNum+origLabel+": "+p.name+"("+p.pos+") "+p.scoutGrade+" $"+p.contract.salary+"M"+traitMsg+(revealMsg?" "+revealMsg:""),"gold");
    (function(){
      var gymLvlRev=my&&my.facilities?my.facilities.gym||0:0;
      var foD79Rev=FRONT_OFFICE?FRONT_OFFICE.getBonus(frontOffice78,"drafting"):0;
      var confRev=Math.min(100,(p.scoutConfidence||0)+(foD79Rev>0?Math.round(foD79Rev*40):0));
      var errRev=SCOUT_MATH.getErrorBand(gymLvlRev,foD79Rev||0);
      var expectedOvr=p.hypeOvr||p.ovr;// what the GM expected based on scouting
      var trueDiff=p.ovr-expectedOvr;
      if(confRev<100&&Math.abs(trueDiff)>=3){
        var isSteal=trueDiff>=5;
        var isBust=trueDiff<=-5;
        var isSurprise=trueDiff>=3;
        var isDisappointment=trueDiff<=-3;
        var revealHeader=isSteal?"ðŸ’Ž DRAFT STEAL!":isBust?"ðŸš¨ BUST ALERT!":isSurprise?"ðŸ“ˆ Better Than Expected!":"ðŸ“‰ Lower Than Projected";
        var revealColor=isSteal||isSurprise?"green":"red";
        var revealBody=p.name+" true OVR: "+p.ovr+" (scouts projected ~"+(expectedOvr)+(isSteal?" â€” you robbed them!":isBust?" â€” major miss.":isSurprise?" â€” nice find!":".")+")";
        addN(revealHeader+" "+revealBody,revealColor);
      }
    })();
    logTx("DRAFT_PICK",{name:p.name,pos:p.pos,ovr:p.ovr,round:boardPick.round,pickNum:boardPick.pickNum,salary:p.contract.salary,devTrait:p.devTrait,trait:p.trait});
    ledgerLog("DRAFT",myId,"Drafted "+p.name+"("+p.pos+") Rd"+boardPick.round+" Pick #"+boardPick.pickNum+" $"+p.contract.salary+"M",{pid:p.id,name:p.name,pos:p.pos,ovr:p.ovr,round:boardPick.round,pick:boardPick.pickNum});
    var dnEntry=buildDraftNightPick(boardPick,p,u2,boardPick.pickNum-1,draftBoard.length,teams);
    if(dnEntry){
      dnEntry.comment=getDraftCommentary(boardPick.round||1,p.ovr||65);
      setDraftShowLog(function(old){return old.concat([dnEntry]).slice(-30);});
    }
    var dcc=dc.filter(function(x){return x.id!==p.id;});
    var idx=dPk+1;
    while(idx<draftBoard.length&&draftBoard[idx].ownerId!==myId){
      dcc=aiDraftPick(nt,draftBoard[idx],dcc);idx++;
    }
    setDC(dcc);setDPk(idx);
    // WAR_ROOM: Reset pick clock for next user pick
    setDraftClockKey(function(k){return k+1;});setDraftClockSec(30);
    // WAR_ROOM: Add AI pick to MFSN ticker
    (function(){
      var aiPicked=draftBoard.slice(dPk+1,idx).filter(function(pk){return pk.player;});
      if(aiPicked.length>0){
        var newTicks=aiPicked.map(function(pk){
          return "âš¡ Rd"+pk.round+" #"+pk.pickNum+" â€” "+(pk.teamIcon||"ðŸˆ")+" "+pk.teamAbbr+" select "+
            (pk.player?pk.player.name+" ("+pk.player.pos+" "+pk.player.ovr+" OVR)":"unknown player");
        });
        setMfsnTicker(function(prev){return prev.concat(newTicks).slice(-20);});
      }
    })();
    if(idx<draftBoard.length)setDraftOffers(genDraftOffers(idx));
    else{
      var udfa=dcc.map(function(p){
        var up=assign({},p);
        up.contract={salary:MIN_SALARY,years:1,bonus:0};
        var isSleeper=up.isGem?RNG.draft()<0.5:RNG.draft()<0.04;// Gems 50% chance, others 4%
        if(isSleeper){
          var def=POS_DEF[up.pos];if(def){def.r.forEach(function(r){up.ratings[r]=cl((up.ratings[r]||50)+rng(2,6),40,85);});}// +2 to +6, capped at 85
          up.ovr=calcOvr(up);up.ovr=Math.min(up.ovr,72);// Hard cap at 72 â€” solid backup, not star
          up.pot=cl(up.pot+rng(2,5),up.ovr,82);// Pot capped at 82
          up.devTrait=pick(["star","normal","normal","normal"]);// 25% star, never superstar
          up.udfaSleeper=true;
        }
        if(up.ovr>70&&!up.udfaSleeper){
          var def2=POS_DEF[up.pos];if(def2){def2.r.forEach(function(r){up.ratings[r]=cl(up.ratings[r]-rng(2,6),35,99);});}
          up.ovr=calcOvr(up);
        }
        return up;
      });
      var existingFA=fas.slice();var allFA82b=existingFA.concat(udfa);
      setFAs(allFA82b);
      setSeason(function(s){return assign({},s,{phase:"freeAgency"});});setDraftOffers([]);
      setFaMarket(buildFAMarket(allFA82b,nt,myId));
      setFaDay(0);setFaHeadlines([]);
      var board82b=buildFABidBoard(allFA82b,nt,myId,RNG.trade,season.year);
      setFaBids82(board82b);setFaPhase82("tampering");setFaRound82(0);
      setFaVisits82({used:0,max:calcVisitTokens(frontOffice78),log:[]});setFaAlerts82([]);setFaSignings82([]);
      showGuide("fa");
      var sleeperCount=udfa.filter(function(x){return x.udfaSleeper;}).length;
      addN("ðŸ“‹ Draft complete! "+udfa.length+" undrafted players entered Free Agency."+(sleeperCount>0?" ðŸ’Ž "+sleeperCount+" sleeper(s) developed in offseason training!":""),"gold");
      // v98.5: Archive ALL draft picks permanently
      (function(){
        var archive98={year:season.year,picks:[],isInaugural:draftHistory98.length===0};
        nt.forEach(function(tm){
          tm.roster.filter(function(rp){return rp._draftYear===season.year;}).forEach(function(rp){
            archive98.picks.push({pickNum:rp._draftPick||0,round:rp._draftRound||0,team:tm.abbr,icon:tm.icon,
              name:rp.name,pos:rp.pos,ovr:rp.ovr,pot:rp.pot||rp.ovr,devTrait:rp.devTrait||"normal",
              college:rp.college?rp.college.school||rp.college:"?",isUser:tm.id===myId,salary:rp.contract?rp.contract.salary||0:0});
          });
        });
        archive98.picks.sort(function(a,b){return (a.round||9)*100+(a.pickNum||99)-(b.round||9)*100-(b.pickNum||99);});
        // Fallback: if _draftPick wasn't set, use draftShowLog order
        if(archive98.picks.length===0&&draftShowLog.length>0){
          draftShowLog.forEach(function(dn,di){
            archive98.picks.push({pickNum:dn.pickNum||di+1,round:dn.round||1,team:dn.team||"?",icon:dn.icon||"ðŸˆ",
              name:dn.player||"?",pos:dn.pos||"?",ovr:dn.ovr||60,pot:dn.pot||60,devTrait:"?",college:"?",isUser:dn.isUser||false,salary:0});
          });
        }
        if(archive98.picks.length>0)setDraftHistory98(function(prev){return prev.concat([archive98]);});
      })();
      var myPicks80=(u2&&u2.roster||[]).filter(function(p){return p._draftYear===season.year;});
      if(myPicks80.length>0&&u2){
        var grade80=MFSN_DRAFT_GRADES.generate(myPicks80,u2,season.year,RNG.ui);
        setMfsnDraftGrade80(grade80);
        setMfsnGradeHistory80(function(prev){return prev.concat([grade80]);});
        addN("ðŸ“º MFSN: \""+grade80.analystIcon+" "+grade80.analyst+" gives "+u2.abbr+" a "+grade80.grade+" for the draft. '"+grade80.take+"'\"","cyan");
        if(grade80){
          var presserQs975=DRAFT_PRESSER975.generateQuestions(grade80,myPicks80,u2,season.year);
          if(presserQs975&&presserQs975.length>0){
            setDraftPresser975({year:season.year,grade:grade80,questions:presserQs975,answers:[],currentQ:0});
          }
        }
      }
      var udfaPool=UDFA_SYSTEM.generatePool(20);
      var aiSigned76=UDFA_SYSTEM.aiSignings(udfaPool,nt,myId);
      if(aiSigned76.length>0){
        aiSigned76.forEach(function(as){addN("ðŸ“° UDFA: "+as.icon+as.team+" signed "+as.player+" ("+as.pos+" "+as.ovr+")","cyan");});
      }
      var available76=udfaPool.filter(function(u76){return !u76._signed76;});
      setUdfaPool76(available76);
    }
    setTeams(nt);doSave(nt);
  }
  function signUdfa76(udfa){
    if(!my||!udfa)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    if(!u2)return;
    if(u2.roster.length>=ROSTER_CAP){addN("ðŸš« Roster full â€” cut a player first.","red");return;}
    var p76=assign({},udfa,{contract:makeContract(MIN_SALARY,1,0,0),isStarter:false});
    p76.flexPos76=FLEX_POSITIONS.assign(p76);
    u2.roster.push(p76);u2.capUsed=capCalc(u2.roster);
    addN("âœï¸ UDFA Signed: "+p76.name+" ("+p76.pos+" "+p76.ovr+" OVR)"+(p76.isGem?" ðŸ’Ž Hidden Gem!":"")+" â€” $"+MIN_SALARY+"M/1yr","green");
    logTx("UDFA_SIGN",{name:p76.name,pos:p76.pos,ovr:p76.ovr});
    var remaining=udfaPool76.filter(function(u76){return u76.id!==udfa.id;});
    setUdfaPool76(remaining);
    setTeams(nt);doSave(nt);
  }
  function placeFABid(playerId,salary,years,role){
    if(!my)return;
    if(faPhase82==="tampering"){addN("ðŸ‘€ Legal tampering â€” bidding opens next round!","orange");return;}
    if(my.roster.length>=ROSTER_CAP){addN("âŒ Roster full!","red");return;}
    var entry=null;(faBids82||[]).forEach(function(e){if(e.playerId===playerId)entry=e;});
    if(!entry){addN("âŒ Not on bid board.","red");return;}
    if(entry.status!=="open"){addN("âŒ "+entry.name+" already signed.","red");return;}
    var pending=pendingBidCap(faBids82,myId);var myCap=capCalc(my.roster)+(my.deadCap||0);
    if(myCap+pending+salary>getSalaryCap(season.year)){addN("ðŸ’° Over the cap!","orange");return;}
    var isLoyal=(entry.teamTenure||0)>=4&&entry.formerTeam===myId;
    if(isLoyal&&salary<entry.marketValue*0.7){addN("ðŸ˜¤ "+entry.name+" is INSULTED!","red");entry.resentment82=true;}
    var existBid=entry.bids.find(function(b){return b.isUser;});
    if(existBid){existBid.salary=Math.round(salary*10)/10;existBid.years=years;existBid.role=role||"STARTER";existBid.round=faRound82;addN("ðŸ“ Updated bid: "+entry.name+" $"+salary+"M/"+years+"yr","cyan");}
    else{entry.bids.push({teamId:myId,salary:Math.round(salary*10)/10,years:years,role:role||"STARTER",visitUsed:false,loyaltyYears:isLoyal?(entry.teamTenure||0):0,round:faRound82,isUser:true});addN("ðŸ“ Bid: "+entry.name+" $"+salary+"M/"+years+"yr"+(entry.roundsLeft<=1?" â€” decides now!":" â€” decides in "+entry.roundsLeft+" rds"),"cyan");}
    if(entry.tierId==="DEPTH"&&entry.roundsLeft<=0){
      var fa=fas.find(function(p){return p.id===playerId;});
      if(fa){var bestBid=entry.bids.slice().sort(function(a,b){
        return agentFAScoreV2({ovr:entry.ovr,pos:entry.pos,agentType:entry.agentType,formerTeam:entry.formerTeam,teamTenure:entry.teamTenure,personality:entry.personality||null},teams.find(function(t){return t.id===b.teamId;})||my,b,RNG.trade)-agentFAScoreV2({ovr:entry.ovr,pos:entry.pos,agentType:entry.agentType,formerTeam:entry.formerTeam,teamTenure:entry.teamTenure,personality:entry.personality||null},teams.find(function(t){return t.id===a.teamId;})||my,a,RNG.trade);})[0];
        if(bestBid&&bestBid.isUser){entry.status="signed";entry.signedTo=myId;entry.signedOffer=bestBid;
          var nt=teams.slice();var u=nt.find(function(t){return t.id===myId;});
          u.roster.push(assign({},fa,{contract:makeContract(bestBid.salary,bestBid.years,bestBid.salary>3?Math.round(bestBid.salary*0.25*bestBid.years*10)/10:0,0),isStarter:false,teamTenure:0}));
          u.capUsed=capCalc(u.roster);setTeams(nt);setFAs(function(prev){return prev.filter(function(x){return x.id!==playerId;});});
          addN("âœ… "+entry.name+" signs! $"+bestBid.salary+"M/"+bestBid.years+"yr","green");
          setFaSignings82(function(old){return old.concat([{playerId:entry.playerId,name:entry.name,pos:entry.pos,ovr:entry.ovr,teamId:myId,team:my.abbr,icon:my.icon,salary:bestBid.salary,years:bestBid.years,role:bestBid.role,isUser:true,reason:"Depth"}]);});doSave(nt);
        }else{addN("âŒ "+entry.name+" chose another offer.","red");}}
    }
    setFaBids82(faBids82.slice());
  }
  function useVisit82(playerId){
    if(!my)return;if(!faVisits82||faVisits82.used>=faVisits82.max){addN("âŒ No visits left!","red");return;}
    var entry=faBids82.find(function(e){return e.playerId===playerId;});if(!entry)return;
    var userBid=entry.bids.find(function(b){return b.isUser;});
    if(!userBid){addN("âŒ Bid first before visiting.","orange");return;}
    if(userBid.visitUsed){addN("âœ” Already visited.","dim");return;}
    userBid.visitUsed=true;
    var vn=["was impressed by your facilities","loved the team culture","connected with the coaching staff","felt the championship energy","enjoyed the city tour"];
    setFaVisits82(function(prev){return{used:prev.used+1,max:prev.max,log:prev.log.concat([{playerId:playerId,name:entry.name,pos:entry.pos}])};});
    addN("ðŸ  "+entry.name+" "+pick(vn)+". (+15% boost)","gold");setFaBids82(faBids82.slice());
  }
  function tenderRFA82(playerId,tenderKey){
    if(!my)return;
    var tender=RFA_TENDERS[tenderKey];if(!tender){addN("\u274c Invalid tender.","red");return;}
    var p=my.roster.find(function(x){return x.id===playerId;});if(!p){addN("\u274c Player not on roster.","red");return;}
    var cap=capCalc(my.roster)+(my.deadCap||0);
    if(cap+tender.salary>getSalaryCap(season.year)){addN("\ud83d\udcb0 Can't afford "+tender.label+" tender ($"+tender.salary+"M)!","red");return;}
    p.contract=makeContract(tender.salary,1,0,0);p.rfaTender82=tenderKey;p.isRFA82=true;
    var nt=teams.slice();setTeams(nt);
    setFaRFA82(function(old){return old.concat([{playerId:playerId,name:p.name,pos:p.pos,ovr:p.ovr,tender:tenderKey,tenderSalary:tender.salary,compRound:tender.compRound,status:"tendered",matchDeadline:null}]);});
    addN("\u2705 "+p.name+" tendered ("+tender.label+" \u2014 $"+tender.salary+"M). Rivals can bid, you get right to match.","purple");
    doSave(nt);
  }
  function matchRFA82(rfaEntry){
    if(!my)return;var entry=faRFA82.find(function(e){return e.playerId===rfaEntry.playerId;});if(!entry){return;}
    if(!entry.rivalOffer){addN("No rival offer to match.","dim");return;}
    var p=my.roster.find(function(x){return x.id===entry.playerId;});if(!p){return;}
    p.contract=makeContract(entry.rivalOffer.salary,entry.rivalOffer.years,entry.rivalOffer.salary>3?Math.round(entry.rivalOffer.salary*0.25*entry.rivalOffer.years*10)/10:0,0);
    p.rfaTender82=null;p.isRFA82=false;
    entry.status="matched";
    var nt=teams.slice();setTeams(nt);setFaRFA82(faRFA82.slice());
    addN("\u2705 MATCHED: "+p.name+" stays! $"+entry.rivalOffer.salary+"M/"+entry.rivalOffer.years+"yr","green");doSave(nt);
  }
  function declineRFA82(rfaEntry){
    if(!my)return;var entry=faRFA82.find(function(e){return e.playerId===rfaEntry.playerId;});if(!entry){return;}
    var p=my.roster.find(function(x){return x.id===entry.playerId;});
    if(p){
      my.roster=my.roster.filter(function(x){return x.id!==entry.playerId;});
      var fa=assign({},p,{contract:entry.rivalOffer?makeContract(entry.rivalOffer.salary,entry.rivalOffer.years,0,0):{salary:MIN_SALARY,years:1},formerTeam:myId,teamTenure:0,rfaTender82:null,isRFA82:false});
      setFAs(function(prev){return prev.concat([fa]);});
      var tender=RFA_TENDERS[entry.tender];
      if(tender){
        my.draftPicks=my.draftPicks||[];
        my.draftPicks.push({round:tender.compRound,year:season.year+1,from:my.abbr,type:"comp",reason:"RFA "+p.name+" departed"});
        addN("\ud83c\udfc8 Comp pick: Round "+tender.compRound+" ("+(season.year+1)+") for "+p.name+" leaving.","cyan");
      }
      entry.status="declined";
    }
    var nt=teams.slice();setTeams(nt);setFaRFA82(faRFA82.slice());
    addN("\ud83d\udc4b "+entry.name+" leaves. Comp pick awarded.","orange");doSave(nt);
  }
  function signFA(p,mult){
    if(!my) return;
    var faTier82=getFATier(p.ovr);
    if(faTier82!==FA_TIERS.CAMP&&(p.faYears||0)<1&&faPhase82==="open"){addN("ðŸª Use Bid system for "+p.name+".","orange");return;}
    if(!godMode&&!canDoAction(season.phase,"canSignFA")){addN("ðŸš« Cannot sign free agents during "+(PHASE_RULES[season.phase]||{}).label+".","red");return;}
    if(godMode){
      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
      var offer=mult===0?MIN_SALARY:Math.round(Math.max(p.contract.salary,p.contract.salary*(1.1))*Math.max(mult,0.01)*10)/10;
      var gYrs=mult===0?1:p.contract.years;var gBonus=offer>3?Math.round(offer*0.25*gYrs*10)/10:0;
      u2.roster.push(assign({},p,{contract:makeContract(Math.max(Math.round((offer-(gYrs>0?gBonus/gYrs:0))*10)/10,MIN_SALARY),gYrs,gBonus,0),isStarter:false}));
      u2.capUsed=capCalc(u2.roster);
      addN("âš¡ GOD: Signed "+p.name+"("+p.pos+" OVR"+p.ovr+") $"+offer+"M","purple");
      logTx("SIGN_FA",{name:p.name,pos:p.pos,ovr:p.ovr,salary:offer,godMode:true});
      setFAs(function(prev){return prev.filter(function(x){return x.id!==p.id;});});setTeams(nt);doSave(nt);
      return;
    }
    var limit=season.phase==="preseason"||season.phase==="cutDay"?CAMP_CAP:ROSTER_CAP;
    if(my.roster.length>=limit){addN("âŒ Roster full ("+my.roster.length+"/"+limit+")! Cut or PS a player first.","red");return;}
    var pm=(my.prestige-50)*0.1;
    var isMinSign=mult===0;
    var base=Math.max(p.contract.salary,p.contract.salary*(1.1-pm*0.02));
    if(my.ownerMood<40)base=base*1.2;
    var offer2=isMinSign?MIN_SALARY:Math.round(base*(mult||1.0)*10)/10;
    var isMinSalary=offer2<=MIN_SALARY;
    if(!isMinSign&&mult<1.0){
      var rejectChance=p.ovr>=80?0.6:p.ovr>=70?0.4:0.2;
      if(hasTrait95(p,"mercenary"))rejectChance+=0.2;// v95.6: hasTrait95
      if(hasTrait95(p,"loyal"))rejectChance-=0.15;
      var agObj=getAgentTypeObj(p.agentType||"loyal");
      if(agObj.moneyWeight>=0.8)rejectChance+=0.15;// Money-hungry agents reject discounts
      if(agObj.loyaltyWeight>=0.8)rejectChance-=0.10;// Loyal agents more flexible
      if(RNG.trade()<rejectChance){addN("âŒ "+p.name+(p.agentType?" ("+getAgentTypeObj(p.agentType).emoji+" "+getAgentTypeObj(p.agentType).name+")":"")+" rejected your lowball $"+offer2+"M offer!","red");return;}
    }
    if(isMinSign){
      var minReject=p.faYears>=1?0.05:(p.ovr>=80?0.85:p.ovr>=70?0.55:p.ovr>=60?0.25:0.05);
      if(hasTrait95(p,"mercenary"))minReject+=0.2;// v95.6: hasTrait95
      if(hasTrait95(p,"loyal"))minReject-=0.15;
      var agObj2=getAgentTypeObj(p.agentType||"loyal");
      if(agObj2.moneyWeight>=0.8)minReject+=0.15;
      if(agObj2.ringWeight>=0.8&&my.wins>=10)minReject-=0.20;// Ring chasers take min on contenders
      if(RNG.trade()<minReject){addN("âŒ "+p.name+(p.agentType?" ("+getAgentTypeObj(p.agentType).emoji+")":"")+" refuses minimum deal â€” wants real money!","red");return;}
    }
    if(!isMinSalary&&capCalc(my.roster)+(my.deadCap||0)+offer2>getSalaryCap(season.year)){
      addN("ðŸ’° Over the cap! Min salary signings ($"+MIN_SALARY+"M) are cap-exempt. Try 'Sign Min' button.","orange");return;
    }
    var nt2=teams.slice();var u3=nt2.find(function(t){return t.id===myId;});
    var yrs=isMinSign?1:(mult>=1.15?Math.min(p.contract.years+1,5):mult<1.0?Math.max(1,p.contract.years-1):p.contract.years);
    var faBonus2=offer2>3&&!isMinSign?Math.round(offer2*0.25*yrs*10)/10:0;
    var faBase2=isMinSign?MIN_SALARY:Math.max(Math.round((offer2-(yrs>0?faBonus2/yrs:0))*10)/10,MIN_SALARY);
    u3.roster.push(assign({},p,{contract:makeContract(faBase2,yrs,faBonus2,0),isStarter:false}));
    u3.capUsed=capCalc(u3.roster);
    var tag=isMinSign?" (MIN, cap exempt)":mult>=1.15?" ðŸ’° Premium!":mult<1.0?" ðŸ¤ Discount!":"";
    addN("âœï¸ Signed "+p.name+"("+p.pos+" OVR"+p.ovr+") $"+offer2+"M/"+yrs+"yr"+tag,"green");
    logTx("SIGN_FA",{name:p.name,pos:p.pos,ovr:p.ovr,salary:offer2,years:yrs,isMin:isMinSign});
    ledgerLog("SIGN",myId,"Signed FA "+p.name+"("+p.pos+" OVR"+p.ovr+") $"+offer2+"M/"+yrs+"yr",{pid:p.id,name:p.name,pos:p.pos,ovr:p.ovr,salary:offer2,years:yrs});
    setFaHeadlines(function(old){
      var entry={name:p.name,pos:p.pos,ovr:p.ovr,salary:offer2,years:yrs,teamId:myId,reason:isMinSign?"Depth signing":"Fills roster need"};
      return buildFAHeadlines([entry].concat(old.slice(0,10)),nt2);
    });
    setFAs(function(prev){return prev.filter(function(x){return x.id!==p.id;});});setTeams(nt2);doSave(nt2);
  }
  function cutPlayer(pid){
    if(!my) return;
    if(!canDoAction(season.phase,"canCut")){addN("ðŸš« Cannot cut players during "+(PHASE_RULES[season.phase]||{}).label+".","red");return;}
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var p=u2.roster.find(function(x){return x.id===pid;});if(!p) return;
    var oldCapHit=v36_capHit(p.contract);
    var dead=v36_deadIfCut(p.contract);
    var deadSplit=splitDeadCapCharge(dead,season.phase,season.week);
    var rosterWithout=u2.roster.filter(function(x){return x.id!==pid;});
    var projSpace=getSalaryCap(season.year)-capCalc(rosterWithout)-((u2.deadCap||0)+(deadSplit.now||0));
    if(projSpace<0&&deadSplit.now>0){
      var ex=pickEx("cap","deadCap");
      addN("ðŸš« "+p.name+" is UNCUTTABLE â€” $"+(deadSplit.now||0)+"M current-year dead cap would exceed cap! "+ex.sg[0],"red");return;
    }
    p.formerTeam=myId;p.formerTeamName=my.abbr;
    applyDeadCapCharge(u2,season.year,deadSplit);
    u2.roster=rosterWithout;u2.capUsed=capCalc(u2.roster);
    p.contract=makeContract(p.ovr>=70?rng(1,5):MIN_SALARY,rng(1,2),0,0);
    p.scouting=initScoutState(false,p.age<=23);// goes to FA pool â€” scouting resets
    setFAs(function(prev){return prev.concat([p]);});
    var deadLabel=deadSplit.next>0?(" â€” ðŸ’€ $"+deadSplit.now+"M now + $"+deadSplit.next+"M next year"):((deadSplit.now||0)>0?(" â€” ðŸ’€ $"+deadSplit.now+"M dead cap"):"");
    addN("âœ‚ï¸ Cut "+p.name+deadLabel+" | Cap savings now: $"+Math.round((oldCapHit-(deadSplit.now||0))*10)/10+"M","red");
    if(hasTrait95(p,"captain")||hasTrait95(p,"vocal_leader")){// v95.6: hasTrait95
      u2.roster.forEach(function(r){if((r.cliqueId||0)===0)r.chemistry=cl((r.chemistry||60)-8,15,100);// Vets clique hit hard
        else if((r.cliqueId||0)===2&&p.ovr>=80)r.chemistry=cl((r.chemistry||60)-3,15,100);});// Stars notice too
      addN("ðŸ‘¥ Locker Room: Veterans UNHAPPY after cutting "+p.name+" (Captain/Leader) â€” chemistry dropped","red");
    } else if(p.ovr>=80){
      u2.roster.forEach(function(r){if((r.cliqueId||0)===2)r.chemistry=cl((r.chemistry||60)-5,15,100);});
      addN("ðŸ‘¥ Locker Room: Stars clique uneasy after cutting "+p.name+" (OVR "+p.ovr+")","red");
    } else if(p.age>=30){
      u2.roster.forEach(function(r){if((r.cliqueId||0)===0)r.chemistry=cl((r.chemistry||60)-3,15,100);});
    }
    logTx("CUT_PLAYER",{name:p.name,pos:p.pos,ovr:p.ovr,dead:dead,deadNow:deadSplit.now||0,deadNext:deadSplit.next||0,oldCapHit:oldCapHit,savings:Math.round((oldCapHit-(deadSplit.now||0))*10)/10});
    ledgerLog("CUT",myId,"Cut "+p.name+"("+p.pos+" OVR"+p.ovr+")"+(dead>0?" â€” $"+(deadSplit.now||0)+"M dead now"+(deadSplit.next>0?" + $"+deadSplit.next+"M next year":"")+", $"+Math.round((oldCapHit-(deadSplit.now||0))*10)/10+"M cap savings now":""),
      {pid:p.id||pid,name:p.name,pos:p.pos,ovr:p.ovr,dead:dead,deadNow:deadSplit.now||0,deadNext:deadSplit.next||0,oldCapHit:oldCapHit});
    if(dead>0)ledgerLog("DEAD_MONEY_CHARGE",myId,"Dead money: $"+dead+"M from "+p.name+" cut",{name:p.name,amount:dead,amountNow:deadSplit.now||0,amountNext:deadSplit.next||0,year:season.year});
    setTeams(nt);doSave(nt);
  }
  function previewSchemeChange(side,newSchemeId){
    if(!my)return;
    var currentScheme=side==="off"?my.schemeOff:my.schemeDef;
    if(currentScheme===newSchemeId){setSchemeConfirm(null);return;}
    var plan=buildSchemeChangeProjection(my,side,newSchemeId);
    if(!plan){setSchemeConfirm(null);return;}
    setSchemeConfirm(plan);
  }
  function applyFix(fixAction){
    if(!my||!fixAction)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});if(!u2)return;
    var lastRecap=gameRecap||{};
    var beforeMetrics={pressureRate:lastRecap.pressureRate||50,rzEff:lastRecap.rzEff||50,
      turnovers:lastRecap.turnovers||0,coverageWin:lastRecap.coverageWin||50};
    if(fixAction==="quick_pass"){u2.gameplanOff="west_coast";addN("âš¡ Gameplan â†’ West Coast (quick pass)","green");}
    else if(fixAction==="ground_pound"){u2.gameplanOff="ground_pound";addN("âš¡ Gameplan â†’ Ground & Pound","green");}
    else if(fixAction==="power_run"){u2.gameplanOff="ground_pound";addN("âš¡ Gameplan â†’ Ground & Pound (power run)","green");}
    else if(fixAction==="zone_def"){u2.gameplanDef="zone_cov";addN("âš¡ Gameplan â†’ Zone Coverage","green");}
    else if(fixAction==="conservative"){u2.gameplanOff="balanced_o";addN("âš¡ Gameplan â†’ Balanced (conservative)","green");}
    else if(fixAction==="run_more"){u2.gameplanOff="ground_pound";addN("âš¡ Gameplan â†’ Ground & Pound (more run)","green");}
    else{addN("â„¹ï¸ This fix requires a roster move â€” check Trade or Free Agency tab","info");return;}
    setLastFix({type:fixAction,weekApplied:season.week,beforeMetrics:beforeMetrics});
    ledgerLog("FIX_APPLIED",myId,"Applied one-click fix: "+fixAction,{action:fixAction,week:season.week,before:beforeMetrics});
    setTeams(nt);doSave(nt);
  }
  function openSchemePresser87(item){
    if(!my||!item)return;
    var side=item.schemeSide||"off";
    var schemeId=item.schemeId||(side==="off"?my.schemeOff:my.schemeDef);
    var schemeName=item.schemeName||(side==="off"?
      (OFF_SCHEMES.find(function(s){return s.id===schemeId;})||{}).name:
      (DEF_SCHEMES.find(function(s){return s.id===schemeId;})||{}).name)||"this scheme";
    var flavor=getSchemeFlavorLine(schemeId,side==="off"?"offense":"defense");
    var flavorLine=flavor||"our core identity and execution details.";
    var qText=item.question||("Coach, you switched to "+schemeName+". What's the identity now?");
    setPressConf({title:"ðŸŽ™ï¸ SCHEME IDENTITY PRESS CONFERENCE",q:qText,week:season.week,margin:0,oppName:null,
      schemeId:schemeId,schemeSide:side,schemeName:schemeName,
      opts:[
        {id:"scheme_buyin",label:"\"We're building around "+flavorLine+"\"",
          fx:{morale:2,ownerApproval:1,systemFit:2}},
        {id:"scheme_temp",label:"\"This is just a temporary adjustment.\"",
          fx:{morale:0,ownerApproval:0,systemFit:5}},
        {id:"scheme_honest",label:"\"We need better players before this works.\"",
          fx:{morale:-2,ownerApproval:1,systemFit:0}}
      ]});
    setInbox(function(prev){return(prev||[]).filter(function(x){return x.id!==item.id;});});
    setTab("home");
    addN("ðŸŽ™ï¸ Scheme identity presser is live.","cyan");
  }
  function confirmSchemeChange(){
    if(!schemeConfirm||!my)return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var side=schemeConfirm.side;
    if(side==="off")u2.schemeOff=schemeConfirm.newScheme;else u2.schemeDef=schemeConfirm.newScheme;
    var posGroup=side==="off"?["QB","RB","WR","TE","OL"]:["DL","LB","CB","S"];
    u2.roster.forEach(function(p){
      if(posGroup.indexOf(p.pos)>=0)p.systemFit=Math.round((p.systemFit||30)*0.6);// Lose 40%
    });
    var schemeName=side==="off"?
      (OFF_SCHEMES.find(function(s){return s.id===schemeConfirm.newScheme;})||{}).name:
      (DEF_SCHEMES.find(function(s){return s.id===schemeConfirm.newScheme;})||{}).name;
    var flavor87=getSchemeFlavorLine(schemeConfirm.newScheme,"offense");
    var pressQuestion87="Coach, you switched to "+schemeName+". What's the identity now?";
    addN("âš™ï¸ Scheme changed to "+schemeName+"! System knowledge dropped "+schemeConfirm.fitLoss+"% â€” keep stable 3+ weeks to recover.","orange");
    ledgerLog("SCHEME_CHANGE",myId,"Changed "+(side==="off"?"offensive":"defensive")+" scheme to "+schemeName,
      {side:side,newScheme:schemeConfirm.newScheme,fitLoss:schemeConfirm.fitLoss});
    setInbox(function(prev){
      var base=(prev||[]).filter(function(it){return !(it&&it.actionType==="schemePresser"&&it.week===season.week);});
      return [{type:"press_conf",icon:"ðŸŽ™ï¸",
        text:"Press conference pending: "+schemeName+" identity reveal.",
        color:"gold",id:U(),actionType:"schemePresser",week:season.week,
        schemeId:schemeConfirm.newScheme,schemeSide:side,schemeName:schemeName,
        flavor:flavor87,question:pressQuestion87}].concat(base);
    });
    setSchemeConfirm(null);setTeams(nt);doSave(nt);
  }
  function upgradeFacil(type){
    if(!my) return;var fac=FACILS.find(function(f){return f.id===type;});if(!fac) return;
    var lvl=my.facilities?my.facilities[type]||0:0;
    var cost=Math.round(fac.cost*(lvl+1));if(lvl>=fac.maxLvl) return;if((my.cash||0)<cost){addN("ðŸ’° Not enough cash!","red");return;}
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.cash-=cost;u2.expenses=(u2.expenses||0)+cost;
    if(!u2.facilities)u2.facilities={};u2.facilities[type]=(lvl||0)+1;
    addN("ðŸ—ï¸ Built Lvl"+(lvl+1)+" "+fac.name+"!","green");
    logTx("UPGRADE_FACIL",{type:type,newLvl:lvl+1,cost:cost});
    setTeams(nt);doSave(nt);
  }
  function genHiringPool(){
    var pool=[genCoach("HC"),genCoach("HC"),genCoach("OC"),genCoach("OC"),genCoach("OC"),genCoach("DC"),genCoach("DC"),genCoach("DC")];
    pool.forEach(function(c){c.scouted=false;});// Traits hidden until interviewed
    return pool;
  }
  function interviewCoach(coachId,revealAll){
    if(!my) return;
    var cost=revealAll?3:1;// $3M for full reveal, $1M for single
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    if((u2.cash||0)<cost){addN("ðŸ’° Interview costs $"+cost+"M â€” not enough cash!","red");return;}
    u2.cash-=cost;
    setHiringPool(function(prev){
      if(!prev) return prev;
      return prev.map(function(c){
        if(revealAll||(c.id===coachId)) return assign({},c,{scouted:true});
        return c;
      });
    });
    if(revealAll){
      addN("ðŸ” Full market scouted! All candidate traits revealed. (-$"+cost+"M)","cyan");
      logTx("INTERVIEW_ALL",{cost:cost});
    }else{
      var target=hiringPool?hiringPool.find(function(c){return c.id===coachId;}):null;
      addN("ðŸ” Interviewed "+(target?target.name:"candidate")+" â€” traits revealed! (-$"+cost+"M)","cyan");
      logTx("INTERVIEW",{name:target?target.name:"?",cost:cost});
    }
    setTeams(nt);doSave(nt);
  }
  function fireCoach(role){
    if(!my) return;var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var old=role==="HC"?u2.staff.hc:role==="OC"?u2.staff.oc:u2.staff.dc;
    var buyout=coachBuyout(old);
    addN("ðŸ”¥ Fired "+old.name+" ("+old.arch+")"+(buyout>0?" â€” $"+buyout+"M buyout!":"")+" Hire a replacement!","red");
    logTx("FIRE_COACH",{name:old.name,role:role,arch:old.arch,buyout:buyout});
    // v98.6 #8: Add to coaching carousel
    try{COACH_CAROUSEL_986.fireCoach(old,u2,season.year);}catch(e986cc){console.error("v98.6 carousel:",e986cc);}
    u2.cash=(u2.cash||50)-Math.max(3,buyout);// Buyout or minimum $3M
    u2.deadCap=(u2.deadCap||0)+Math.round(buyout*0.5*10)/10;// Half buyout hits dead cap
    var interim={name:"Interim "+role,arch:"Balanced",role:role,salary:0,isInterim:true,
      ratings:{strategy:45,development:40,gameplan:45},id:U()};
    if(role==="HC")u2.staff.hc=interim;else if(role==="OC")u2.staff.oc=interim;else u2.staff.dc=interim;
    u2.ownerMood=cl((u2.ownerMood||70)-5,5,99);// Firing costs mood
    u2.roster.forEach(function(r){r.chemistry=cl((r.chemistry||60)-rng(2,5),15,100);});
    addN("ðŸ‘¥ Locker Room shaken by coaching change â€” all clique chemistry dropped","red");
    var pool=genHiringPool();
    var roleCount=pool.filter(function(c){return c.role===role;}).length;
    while(roleCount<3){pool.push(genCoach(role));roleCount++;}
    setHiringPool(pool);
    setTeams(nt);doSave(nt);
  }
  function getStaffBudgetUsed(team){
    var hcS=(team.staff&&team.staff.hc&&!team.staff.hc.isInterim)?team.staff.hc.salary:0;
    var ocS=(team.staff&&team.staff.oc&&!team.staff.oc.isInterim)?team.staff.oc.salary:0;
    var dcS=(team.staff&&team.staff.dc&&!team.staff.dc.isInterim)?team.staff.dc.salary:0;
    return Math.round((hcS+ocS+dcS)*10)/10;
  }
  function getStaffBudgetMax(){
    return (DIFF_SETTINGS[difficulty]||DIFF_SETTINGS.pro).staffBudget||18;
  }
  function hireCoach(coach){
    if(!my||!coach) return;
    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
    var dS80=DIFF_SETTINGS[difficulty]||DIFF_SETTINGS.pro;
    var budgetMax=dS80.staffBudget||18;
    var replaceRole=coach.role;
    var existingSalary=0;
    if(replaceRole==="HC"&&u2.staff.hc&&!u2.staff.hc.isInterim)existingSalary=u2.staff.hc.salary||0;
    else if(replaceRole==="OC"&&u2.staff.oc&&!u2.staff.oc.isInterim)existingSalary=u2.staff.oc.salary||0;
    else if(replaceRole==="DC"&&u2.staff.dc&&!u2.staff.dc.isInterim)existingSalary=u2.staff.dc.salary||0;
    var currentSpend=getStaffBudgetUsed(u2)-existingSalary;
    var newSpend=Math.round((currentSpend+coach.salary)*10)/10;
    if(!godMode&&newSpend>budgetMax){
      addN("ðŸš« Staff budget exceeded! $"+newSpend.toFixed(1)+"M/$"+budgetMax+"M â€” can't afford "+coach.name+" ($"+coach.salary+"M)","red");
      return;
    }
    var role=coach.role;
    if(role==="HC")u2.staff.hc=coach;else if(role==="OC"){u2.staff.oc=coach;assignCoordSpecialty(coach,"OC");}else{u2.staff.dc=coach;assignCoordSpecialty(coach,"DC");}// v75: assign specialty
    u2.cash-=coach.salary;
    var specLabel75=(role==="OC"||role==="DC")&&coach.specialty75?(" â€” Specialty: "+coach.specialty75.icon+" "+coach.specialty75.label):"";
    addN("âœ… Hired "+coach.name+" ("+coach.arch+") as "+role+specLabel75,"green");
    var coachTraits=coach.traits||[];
    var hasPlayerCoach=coachTraits.indexOf("PLAYER_COACH")>=0;
    var hasDevFactory=coachTraits.indexOf("DEV_FACTORY")>=0;
    if(hasPlayerCoach||hasDevFactory){
      u2.roster.forEach(function(r){r.chemistry=cl((r.chemistry||60)+rng(2,4),15,100);});
      addN("ðŸ‘¥ Locker Room buzzing â€” new coach's reputation is lifting chemistry","green");
    } else {
      u2.roster.forEach(function(r){r.chemistry=cl((r.chemistry||60)+rng(0,2),15,100);});// Small neutral bump â€” hope
    }
    logTx("HIRE_COACH",{name:coach.name,role:role,arch:coach.arch,salary:coach.salary});
    setHiringPool(function(prev){return prev?prev.filter(function(c){return c.id!==coach.id;}):[];});
    setTeams(nt);doSave(nt);
  }
  function executeTrade(){
    if(!godMode&&!canTrade(season.phase,season.week)){
      var reason=season.phase==="regular"&&(season.week||0)>10?"Trade deadline has passed (Week 10)":"No trades during "+(PHASE_RULES[season.phase]||{}).label;
      addN("ðŸ”’ "+reason+".","red");return;
    }
    if(!my||!tradeTeamId) return;var ai=teams.find(function(t){return t.id===tradeTeamId;});if(!ai) return;
    var myP=tMyP.map(function(id){return my.roster.find(function(p){return p.id===id;});}).filter(Boolean);
    var aiP=tAiP.map(function(id){return ai.roster.find(function(p){return p.id===id;});}).filter(Boolean);
    var myPks=(tMyPk||[]).map(function(i){
      var pk=my.draftPicks?my.draftPicks[i]:null;
      var cond=(tMyPkCond972||{})[String(i)];
      return previewTradePickWithCondition972(pk,cond);
    }).filter(Boolean);
    var aiPks=(tAiPk||[]).map(function(i){
      var pk=ai.draftPicks?ai.draftPicks[i]:null;
      var cond=(tAiPkCond972||{})[String(i)];
      return previewTradePickWithCondition972(pk,cond);
    }).filter(Boolean);
    if(!myP.length&&!myPks.length) return;if(!aiP.length&&!aiPks.length) return;
    var trust69=(tradeState.gmTrustByTeam||{})[tradeTeamId]||50;
    var trustBonus69=godMode?0:TRADE_MATH.acceptBonus(trust69);
    var result=godMode?{ok:true,msg:"âš¡ GOD MODE: Trade forced!",valueDelta:0}:proposeTrade(my,ai,myP,aiP,myPks,aiPks,getSalaryCap(season.year),gmStrategy,trustBonus69);
      if(result.ok){
      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});var a2=nt.find(function(t){return t.id===tradeTeamId;});
      var userDeadTotal=0,aiDeadTotal=0;
      myP.forEach(function(p){
        var impact=calcTradeImpact(p);
        userDeadTotal+=impact.deadMoney;// user eats remaining proration
        u2.roster=u2.roster.filter(function(x){return x.id!==p.id;});
        p.contract=impact.newContract||p.contract;// receiver gets base salary only
        p.scouting=initScoutState(false,p.age<=23);// AI must re-scout
        a2.roster.push(p);
      });
      aiP.forEach(function(p){
        var impact=calcTradeImpact(p);
        aiDeadTotal+=impact.deadMoney;// AI team eats their dead cap
        a2.roster=a2.roster.filter(function(x){return x.id!==p.id;});
        p.contract=impact.newContract||p.contract;
        p.scouting=initScoutState(true,p.age<=23);// user gets fresh scouting on acquired player
        u2.roster.push(p);
      });
      u2.deadCap=Math.round(((u2.deadCap||0)+userDeadTotal)*10)/10;
      a2.deadCap=Math.round(((a2.deadCap||0)+aiDeadTotal)*10)/10;
      u2.capUsed=capCalc(u2.roster);a2.capUsed=capCalc(a2.roster);
      myPks.forEach(function(pk){u2.draftPicks=u2.draftPicks.filter(function(x){return (x.pid||x)!==(pk.pid||pk);});pk.owner=a2.id;pk.currentOwner=a2.id;a2.draftPicks=(a2.draftPicks||[]).concat([pk]);});
      aiPks.forEach(function(pk){a2.draftPicks=a2.draftPicks.filter(function(x){return (x.pid||x)!==(pk.pid||pk);});pk.owner=u2.id;pk.currentOwner=u2.id;u2.draftPicks=(u2.draftPicks||[]).concat([pk]);});
      var sent=myP.map(function(p){return p.name;}).concat(myPks.map(function(pk){return "Rd"+pk.round+(pk.condition?(" ("+pickConditionText972(pk.condition)+")"):"");})).join(", ");
      var got=aiP.map(function(p){return p.name;}).concat(aiPks.map(function(pk){return "Rd"+pk.round+(pk.condition?(" ("+pickConditionText972(pk.condition)+")"):"");})).join(", ");
      var deadNote=(userDeadTotal>0?" ðŸ’€ $"+Math.round(userDeadTotal*10)/10+"M dead cap":"");
      addN("ðŸ”„ Trade w/"+ai.icon+ai.abbr+": Sent "+sent+" â†” Got "+got+deadNote+(godMode?" âš¡GOD":""),"gold");
      logTx("TRADE",{with:ai.abbr,sent:sent,got:got,godMode:godMode,deadCap:userDeadTotal});
      ledgerLog("TRADE",myId,"Traded "+sent+" to "+ai.abbr+" for "+got+(userDeadTotal>0?" | Dead cap: $"+Math.round(userDeadTotal*10)/10+"M":""),{sent:sent,got:got,partner:ai.abbr,deadCap:userDeadTotal});
      setPendingCounter971(null);
      setTMsg("âœ… Done!"+deadNote);setTMP([]);setTAP([]);setTMPk([]);setTAPk([]);setTMyPkCond972({});setTAiPkCond972({});setTeams(nt);doSave(nt);
      if(!godMode){
        var vDelta69=result.valueDelta||0;
        var isRival69=false;// Could check rivalry state here
        if(season.rivalries){
          var rk69=rivalryKey?rivalryKey(myId,tradeTeamId):null;
          if(rk69&&season.rivalries[rk69]&&season.rivalries[rk69].heat>=6)isRival69=true;
        }
        var pattern69=TRADE_MATH.getPattern((tradeState.recentTrades||[]));
        var trustDelta69=TRADE_MATH.calcDelta({
          credibility:mediaState.credibility||50,valueDelta:vDelta69,isRival:isRival69,
          recentTradePattern:pattern69,perks:(coachClinic.perks||[])
        });
        var classified69=TRADE_MATH.classify(vDelta69,isRival69);
        var auditEntry69={teamId:tradeTeamId,valueDelta:vDelta69,classification:classified69.classification,
          severity:classified69.severity,trustImpact:trustDelta69,season:season.year,week:season.week||0};
        setTradeState(function(prev){
          var newTrust=assign({},prev.gmTrustByTeam||{});
          newTrust[tradeTeamId]=cl((newTrust[tradeTeamId]||50)+trustDelta69,0,100);
          return assign({},prev,{gmTrustByTeam:newTrust,recentTrades:TRADE_MATH.pushRecentTrade(prev.recentTrades,auditEntry69)});
        });
        var tl69=TRADE_MATH.trustLabel((tradeState.gmTrustByTeam||{})[tradeTeamId]||50);
        if(trustDelta69>0)addN("ðŸ“ˆ "+ai.abbr+" trust "+tl69.emoji+" +"+ trustDelta69+" ("+classified69.classification+")","green");
        else if(trustDelta69<0)addN("ðŸ“‰ "+ai.abbr+" trust "+tl69.emoji+" "+trustDelta69+" ("+classified69.classification+")","red");
      }
    }else{setTMsg(result.msg);}
  }
  var PICK_VALUES={1:1000,2:500,3:270,4:150,5:80,6:45,7:25};
  function pickValue(round){return PICK_VALUES[round]||10;}
  function getTeamNeeds(team){
    var needs={};
    Object.keys(ROSTER_TARGETS).forEach(function(pos){
      needs[pos]=aiNeedScore(team.roster,pos)/10;// normalize to 0-1 scale
    });
    return needs;
  }
  function getTradeValue(player,needs,teamCtx){
    var base=player.ovr*10;// 70 OVR = 700 base points
    var posW=(POS_VALUE[player.pos]||10)*15;// QB=450, K=60
    var ageMod=player.age<=24?200:player.age<=26?120:player.age<=28?50:player.age<=30?0:player.age<=32?-80:-200;
    var devMod=player.devTrait==="superstar"?200:player.devTrait==="star"?100:0;
    var needMod=(needs&&needs[player.pos]||0)*300;// high need inflates value
    var contractPen=player.contract?Math.max(0,(v36_capHit(player.contract)-8))*-20:0;// v36: uses canonical capHit
    var deadPen=v36_deadIfTraded(player.contract)>10?Math.round(v36_deadIfTraded(player.contract)*-15):0;
    var fitBonus=0;
    if(teamCtx){
      var fitTrade86=calcPlayerIdentityFit(player,teamCtx);
      fitBonus=(fitTrade86.score-70)*3;
      if(fitTrade86.score<=55)fitBonus-=30;
    }
    return Math.max(50,base+posW+ageMod+devMod+needMod+contractPen+deadPen+fitBonus);
  }
  function shopPlayer(player){
    if(!my||!teams) return;
    if(season.phase==="regular"&&season.week>10&&!godMode){
      addN("ðŸ”’ Trade deadline has passed (Week 10).","red");return;
    }
    var offers=[];
    var suitors=teams.filter(function(t){
      if(t.id===myId)return false;
      var capOk=((getSalaryCap(season.year)-(t.capUsed||0))>=((player.contract||{}).salary||1));
      if(!capOk)return false;
      var archId=getTeamGMArchetypeId90(t);
      var need=aiNeedScore(t.roster,player.pos);
      if(archId==="contender"&&(player.ovr||0)>=80)return true;
      if(archId==="old_school"&&(player.pos==="OL"||player.pos==="DL"))return true;
      if(archId==="rebuilder"&&(player.age||0)>28)return false;
      if(archId==="moneyball"&&v36_capHit(player.contract)>=10&&(player.ovr||50)<=76)return false;
      return need>=2;
    });
    suitors.sort(function(a,b){return aiNeedScore(b.roster,player.pos)-aiNeedScore(a.roster,player.pos);});
    suitors.slice(0,3).forEach(function(ai){
      var archId=getTeamGMArchetypeId90(ai);
      var needs=getTeamNeeds(ai);
      var pVal=getTradeValue(player,needs,ai);
      if(archId==="contender"&&(player.ovr||0)>=80)pVal=Math.round(pVal*1.22);
      if(archId==="analytics")pVal=Math.round(pVal*0.95);
      if(archId==="rebuilder"&&(player.age||0)>28)pVal=Math.round(pVal*0.78);
      if(archId==="old_school"&&(player.pos==="OL"||player.pos==="DL"))pVal=Math.round(pVal*1.20);
      if(archId==="moneyball"&&v36_capHit(player.contract)>=10&&(player.ovr||50)<=76)pVal=Math.round(pVal*0.72);
      var packageVal=0;
      var offer={team:ai,picks:[],players:[]};
      var picks=(ai.draftPicks||[]).slice().sort(function(a,b){return a.round-b.round;});
      var targetMax92=archId==="contender"&&(player.ovr||0)>=80?1.35:(archId==="analytics"?1.00:1.15);
      var closeTarget92=archId==="analytics"?0.92:0.85;
      for(var i=0;i<picks.length;i++){
        var pkVal=pickValue(picks[i].round);
        if(packageVal+pkVal<=pVal*targetMax92){offer.picks.push(picks[i]);packageVal+=pkVal;}
        if(packageVal>=pVal*closeTarget92) break;
      }
      var sweetFloor92=archId==="analytics"?0.90:0.70;
      if(packageVal<pVal*sweetFloor92){
        var sweetPool=ai.roster.filter(function(p){
          if(p.isStarter)return false;
          if(p.ovr<60||p.ovr>=player.ovr-5)return false;
          if(archId==="old_school"&&(p.pos==="OL"||p.pos==="DL"))return false;
          if(archId==="loyalist"&&(p.teamTenure||0)>=3)return false;
          return true;
        });
        if(archId==="moneyball"){
          sweetPool=sweetPool.sort(function(a,b){
            var aRel=(v36_capHit(a.contract)||0)-(a.ovr||50);
            var bRel=(v36_capHit(b.contract)||0)-(b.ovr||50);
            return bRel-aRel;
          });
        }else{
          sweetPool=sweetPool.sort(function(a,b){return b.ovr-a.ovr;});
        }
        var sweetener=sweetPool[0];
        if(sweetener){offer.players.push(sweetener);packageVal+=getTradeValue(sweetener,getTeamNeeds(my),my)*0.6;}
      }
      var minAccept92=archId==="analytics"?0.90:(archId==="contender"&&(player.ovr||0)>=80?0.58:0.65);
      if(packageVal>=pVal*minAccept92) offers.push(offer);
    });
    setShopOffers(offers);
    if(offers.length===0) addN("ðŸ“­ No teams interested in "+player.name+" right now.","dim");
  }
  function newSeason(){
    logTx("SEED_SNAPSHOT",{seed:SEED_GLOBAL,event:"NEW_SEASON",year:season.year});
    var nt91=teams.slice();
    nt91.forEach(function(t){
      if(!t)return;
      if(t.franchiseTag973&&t.franchiseTag973.year<=season.year)t.franchiseTag973=null;// prior tag consumed
      (t.roster||[]).forEach(function(p){
        if(p&&p.contract&&p.contract.isTagged&&(!t.franchiseTag973||t.franchiseTag973.playerId!==p.id))delete p.contract.isTagged;
      });
      if(t.stadiumDeal976&&(t.stadiumDeal976.yearsLeft||0)>0){t.stadiumDeal976.yearsLeft--;if(t.stadiumDeal976.yearsLeft<=0){if(t.id===myId)addN("ðŸ“‹ Naming rights deal with "+t.stadiumDeal976.name+" has expired.","dim");t.stadiumDeal976=null;}}
    });
    var myT91=nt91.find(function(t){return t.id===myId;});
    if(myT91&&myT91.roster){myT91.roster.forEach(function(p){p._ovrAtSeasonStart=p.ovr||0;});}
    setSeason(function(s){return assign({},s,{rivalries:decayRivalryHeat(s.rivalries||{},teams,s)});});
    var expiring=[];
    var preds80=MFSN_PREDICTIONS.generate(teams,myId,season.year,RNG.ui);
    setSeasonPreds80(preds80);
    var myTA=teams.find(function(t){return t.id===myId;});
    if(myTA){addN("ðŸ“º MFSN SEASON PREVIEW: \""+preds80.headline+"\" | "+myTA.abbr+" SB odds: "+preds80.sbOdds+" | Projected: "+preds80.projWins+"-"+(17-preds80.projWins),"cyan");}
    var osNews80=OFFSEASON_NEWS.generate(teams,myId,RNG.ui);
    if(frontOffice78.length>0){
      var myT81os=teams.find(function(t){return t.id===myId;});
      var isChamp81=history.length>0&&(history[history.length-1].champId===myId||history[history.length-1].winnerId===myId);
      var foPoach81=STAFF_POACHING.checkPoach(frontOffice78,isChamp81,myT81os?myT81os.wins:0,RNG.ai);
      if(foPoach81.length>0){
        setStaffPoachTargets81(foPoach81);
        foPoach81.forEach(function(t81){addN("ðŸŽ¯ POACH ALERT: "+t81.name+" ("+t81.title+") targeted by rival team!","orange");});
      }
    }
    // v97.4: AI Coaching Carousel â€” fire underperforming HCs before offseason story generation
    var firedHCs974=[];
    teams.forEach(function(t){
      if(!t||t.isUser)return;
      var hc=t.staff&&t.staff.hc;
      if(!hc||hc.isInterim)return;
      var fireChance=0;
      if((t.wins||0)<=4)fireChance+=0.55;
      else if((t.wins||0)<=6)fireChance+=0.25;
      else if((t.wins||0)<=8&&(t.losses||0)>=9)fireChance+=0.10;
      var prevSeason=history.length>0?history[history.length-1]:null;
      if(prevSeason&&prevSeason.standings){
        var prevRecord=prevSeason.standings.find(function(s){return s.id===t.id;});
        if(prevRecord&&prevRecord.wins<=6&&(t.wins||0)<=7)fireChance+=0.25;
      }
      var hcSeasons=hc.history?hc.history.seasons||0:0;
      if(hcSeasons>=3&&(!hc.history||!hc.history.playoffWins))fireChance+=0.15;
      if((t.ownerMood||70)<40)fireChance+=0.20;
      if((hc.reputation||50)>=75)fireChance-=0.20;
      if(hc.history&&hc.history.rings>0)fireChance-=0.15;
      fireChance=Math.max(0,Math.min(0.85,fireChance));
      if(RNG.ai()<fireChance){
        firedHCs974.push({
          team:t,coach:hc,
          record:(t.wins||0)+"-"+(t.losses||0),
          reason:(t.wins||0)<=4?"disastrous record":(t.wins||0)<=6?"underperformance":"fan pressure"
        });
        var buyout974=coachBuyout(hc);
        t.cash=(t.cash||50)-Math.max(2,buyout974);
        t.staff=assign({},t.staff||{});
        t.staff.hc={name:"Interim HC",arch:"Balanced",role:"HC",salary:0,isInterim:true,
          ratings:{strategy:45,development:40,gameplan:45},id:U()};
      }
    });
    season.firedHCs974=firedHCs974.map(function(f){
      return {team:f.team.abbr,icon:f.team.icon,coach:f.coach.name,record:f.record,reason:f.reason};
    });
    var osCtx81={dc:dc,teams:teams,myId:myId,fas:fas,ownerPatience:ownerPatience80,season:season};
    var osEvts81=OFFSEASON_EVENTS.generate(osCtx81,RNG.ui);
    if(osEvts81.length>0){setOffseasonEvents81(osEvts81);setActiveOSEvent81(osEvts81[0]);}
    setOffseasonNews80(osNews80);
    osNews80.slice(0,2).forEach(function(story){addN("ðŸ“± "+story.headline,story.serious?"orange":"cyan");});
    var myTeamBefore={};
    var myT=teams.find(function(t){return t.id===myId;});
    if(myT){myT.roster.forEach(function(p){myTeamBefore[p.id]={name:p.name,pos:p.pos,ovr:p.ovr,pot:p.pot,age:p.age,trait:p.trait,devTrait:p.devTrait};});}
    if(breakouts80.length>0&&myT){
      var resolvedBOs=breakouts80.map(function(bc){
        var player=myT.roster.find(function(p){return p.id===bc.playerId;});
        if(!player||bc.resolved)return bc;
        return BREAKOUT_SYSTEM.resolve(bc,player,RNG.dev);
      });
      setBreakouts80(resolvedBOs);
      resolvedBOs.filter(function(bc){return bc.hit&&!breakouts80.find(function(ob){return ob.playerId===bc.playerId&&ob.resolved;});}).forEach(function(bc){
        addN("ðŸŒŸ BREAKOUT CONFIRMED: "+bc.name+" EXPLODED this season! "+bc.ovrAtStart+" OVR â†’ "+bc.targetOvr+" OVR. MFSN is losing their mind.","gold");
        logTx("BREAKOUT_HIT",{name:bc.name,pos:bc.pos,from:bc.ovrAtStart,to:bc.targetOvr,year:season.year});
      });
      resolvedBOs.filter(function(bc){return bc.bust&&!breakouts80.find(function(ob){return ob.playerId===bc.playerId&&ob.resolved;});}).forEach(function(bc){
        addN("ðŸ“‰ "+bc.name+" didn't break out this season. Breakout watch over â€” for now.","orange");
      });
    }
    if(myT&&Object.keys(mentorships80).length>0){
      Object.keys(mentorships80).forEach(function(mentorId){
        var mentor=myT.roster.find(function(p){return p.id===mentorId;});
        var mentee=myT.roster.find(function(p){return p.id===mentorships80[mentorId];});
        if(mentor&&mentee){
          var curveM=AGING_CURVES&&AGING_CURVES[mentor.pos];
          var yearsOverCliff=curveM?Math.max(0,mentor.age-curveM.cliff):0;
          if(yearsOverCliff>=2&&RNG.dev()<0.4){
            MENTOR_SYSTEM.retirementBoost(mentor,mentee);
            addN("ðŸ’™ "+mentor.name+" is passing the torch to "+mentee.name+" â€” legacy boost! +8 morale, +3 ceiling.","gold");
            logTx("MENTOR_LEGACY",{mentor:mentor.name,mentee:mentee.name,year:season.year});
          }
        }
      });
      MENTOR_SYSTEM.applyWeekly(mentorships80,myT.roster);
      myT.roster.forEach(function(p){
        if(p._mentorBonus&&p._mentorBonus>=1){
          var ovrGain=Math.floor(p._mentorBonus);
          p.ovr=Math.min(p.pot,p.ovr+ovrGain);
          p._mentorBonus=p._mentorBonus-ovrGain;
          logTx("MENTOR_DEV",{mentee:p.name,gain:ovrGain,newOvr:p.ovr});
        }
      });
    }
    if(myT&&season.champion&&season.champion===myId){
      myT.roster.filter(function(p){return p.isStarter;}).forEach(function(p){
        setDefMoments80(function(prev){var upd=assign({},prev);var b=upd[p.id]||[];var exists=b.some(function(bd){return bd.type==="champion"&&bd.year===season.year;});if(!exists)b=b.concat([{type:"champion",icon:"ðŸ’",text:"Won Championship with "+myT.abbr+" ("+season.year+")",year:season.year}]);upd[p.id]=b.slice(-6);return upd;});
      });
    }
    if(offseasonNews80&&offseasonNews80.length>0&&myT){
      offseasonNews80.forEach(function(story){
        if(!story.consequence||story._applied)return;
        story._applied=true;
        var c=story.consequence;
        if(c.type==="morale_dip"||c.type==="player_morale"||c.type==="morale_boost"){var tp=myT.roster.find(function(p){return story.player&&p.name===story.player;});if(tp)tp.morale=Math.max(20,Math.min(99,(tp.morale||70)+c.amount));}
        if(c.type==="fanbase_boost"){myT.fanbase=Math.min(99,(myT.fanbase||55)+c.amount);}
        if(c.type==="chemistry_dip"){myT.roster.forEach(function(p){p.chemistry=Math.max(20,(p.chemistry||60)+c.amount);});}
      });
    }
    if(seasonPreds80&&myT){
      var predsResolve=MFSN_PREDICTIONS.resolve(seasonPreds80,myT,myT.wins||0);
      if(predsResolve){addN("ðŸ“º MFSN REVISIT: "+predsResolve.verdict,"cyan");}
    }
    // v97.2: Resolve conditional draft picks before season reset wipes out records
    teams.forEach(function(tCond){
      (tCond.draftPicks||[]).forEach(function(pkCond){
        if(!pkCond||!pkCond.condition)return;
        var cond=pkCond.condition;
        var origId=pkCond.original||pkCond.originalOwner;
        var origTeam=teams.find(function(x){return x.id===origId;});
        var met=false;
        if(cond.type==="playoff"&&origTeam)met=!!origTeam.madePlayoffs;
        else if(cond.type==="record"&&origTeam)met=(origTeam.wins||0)>=10;
        else if(cond.type==="top10pick"&&origTeam)met=(origTeam.wins||0)<=5;
        var oldRound=pkCond.round||null;
        if(met&&cond.upgradeRound)pkCond.round=cond.upgradeRound;
        else if(!met&&cond.downgradeRound)pkCond.round=cond.downgradeRound;
        pkCond.currentOwner=tCond.id;
        delete pkCond.condition;
        if(tCond.isUser){
          addN("ðŸ“‹ Conditional pick resolved: Rd "+oldRound+" â†’ Rd "+pkCond.round+" ("+(origTeam?origTeam.abbr:"?")+")","gold");
        }
      });
    });
    var newHofers=[];
    var poachedCoaches=[];// v17: Coaching Tree tracker
    var nt=teams.map(function(t){var coach=t.staff?t.staff.oc:null;var gym=t.facilities?t.facilities.gym||0:0;
      var teamTraitMods=getCoachTraitMods(t);var traitDevBonus=teamTraitMods.devRate||0;
      // v95.4: Scout Spend training_boost â€” apply only if flag matches current season week; clear stale values
      if(t.id===myId){
        var _curWeek95=(season&&typeof season.week==="number")?season.week:null;
        if(t.scoutTrainBoostWeek!==null&&t.scoutTrainBoostWeek!==undefined){
          if(_curWeek95!==null&&t.scoutTrainBoostWeek===_curWeek95)traitDevBonus+=0.15;
          t.scoutTrainBoostWeek=null;// consume current or stale flag at rollover
        }
      }
      var mentors={};// posGroup â†’ best mentor
      t.roster.forEach(function(p){
        if(p.age>=30&&p.ovr>=75&&!hasTrait95(p,"cancer")){
          var pg=p.pos==="LB"||p.pos==="DL"||p.pos==="CB"||p.pos==="S"?"DEF":
            p.pos==="QB"?"QB":p.pos==="RB"?"RB":p.pos==="WR"||p.pos==="TE"?"REC":
            p.pos==="OL"?"OL":"OTHER";
          if(!mentors[pg]||p.ovr>mentors[pg].ovr)mentors[pg]=p;
        }
      });
      var roster=t.roster.map(function(p){
        var mentorBonus=0;
        if(p.age<=23){
          var pg=p.pos==="LB"||p.pos==="DL"||p.pos==="CB"||p.pos==="S"?"DEF":
            p.pos==="QB"?"QB":p.pos==="RB"?"RB":p.pos==="WR"||p.pos==="TE"?"REC":
            p.pos==="OL"?"OL":"OTHER";
          if(mentors[pg])mentorBonus=0.06;// +6% dev rate from mentor
        }
        return progressPlayer(assign({},p),coach,gym,traitDevBonus+mentorBonus,t);
      });
      // v95.9: Fire trait milestone toasts for user's team, then clear temp milestone hits on all rosters
      roster.forEach(function(p){
        if(t.id===myId&&p._newMilestones95&&p._newMilestones95.length>0){
          p._newMilestones95.forEach(function(m){
            var stars=m.powerLevel>=2?"â­â­":"â­";
            addN(stars+" TRAIT MILESTONE: "+p.name+" ("+p.pos+") â€” "+m.label+"! "+m.reward,"gold");
          });
        }
        p._newMilestones95=null;// transient rollover-only field
      });
      if(t.id===myId&&Object.keys(mentors).length>0){
        var mentorNames=[];for(var mk in mentors)mentorNames.push(mentors[mk].name+"("+mentors[mk].pos+")");
        if(mentorNames.length>0)addN("ðŸŽ“ Veteran mentors: "+mentorNames.join(", ")+" boosting young players","cyan");
      }
      var ps=(t.practiceSquad||[]).map(function(p){return progressPlayer(assign({},p),coach,gym,traitDevBonus,t);});
      ps.forEach(function(p){if(p)p._newMilestones95=null;});// transient rollover-only field
      var activeRoster=[];var retiredPlayers=[];
      roster.forEach(function(p){
        var curve=AGE_CURVES[p.pos]||AGE_CURVES.WR;
        var yearsOverCliff=Math.max(0,p.age-curve.cliff);
        var retireChance=yearsOverCliff>4?0.7:yearsOverCliff>2?0.45:yearsOverCliff>0?0.20:p.age>curve.prime[1]?0.05:0;
        if(p.ovr<55&&p.age>28)retireChance+=0.3;// Bad + old = likely done
        if(p.ovr<50)retireChance+=0.2;// Really washed
        if(p.ovr>=80&&retireChance>0)retireChance*=0.5;
        if(RNG.ai()<retireChance){
          retiredPlayers.push(p);
          var cs=p.careerStats||{};
          var isHoF=(cs.passYds||0)>=25000||(cs.rushYds||0)>=8000||(cs.sacks||0)>=60||(cs.defINT||0)>=40||(cs.recYds||0)>=8000||(cs.fgM||0)>=150||(cs.punts||0)>=500||((cs.proBowls||0)>=4)||((cs.seasons||0)>=8&&p.ovr>=85);
          if(isHoF){
            newHofers.push(assign({},p,{team:t.abbr,teamIcon:t.icon,yearInducted:season.year+1,
              peakOvr:Math.max(p.ovr,p.pot),careerStats:assign({},cs)}));
            addN("ðŸ† "+p.name+"("+t.abbr+") inducted into the Hall of Fame!","gold");
          }else{
            addN("ðŸ‘‹ "+p.name+"("+t.abbr+", "+p.pos+") retired after "+((cs.seasons||0))+" seasons.","dim");
          }
        }else{activeRoster.push(p);}
      });
      roster=activeRoster;
      var active=[];roster.forEach(function(p){if(p.contract.years>0)active.push(p);else{p._fromTeamId=t.id;expiring.push(p);}});// v73: tag for comp picks
      while(active.length>CAMP_CAP){var w3=active.slice().sort(function(a,b){return a.ovr-b.ovr;})[0];active.splice(active.indexOf(w3),1);w3._fromTeamId=t.id;expiring.push(w3);}// v73: tag for comp picks
      while(active.length<CAMP_CAP){active.push(genPlayer(pick(Object.keys(POS_DEF)),"bad",rng(21,24)));}
      var staff=assign({},t.staff,{hc:assign({},t.staff.hc||{name:"HC",ratings:{strategy:50,gameplan:50,development:50}}),oc:assign({},t.staff.oc||{name:"OC",ratings:{gameplan:50,development:50}}),dc:assign({},t.staff.dc||{name:"DC",ratings:{gameplan:50,development:50}})});
      var isChamp=history.length>0&&history[history.length-1]&&history[history.length-1].champId===t.id;
      var poachThresh=isChamp?0.65:0.3;// Champions lose coordinators at 2x+ rate
      var poachMinWins=isChamp?0:9;// Champions get poached regardless of win count
      if(t.wins>=poachMinWins){
        if(staff.oc&&staff.oc.ratings&&staff.oc.ratings.gameplan>=70&&RNG.ai()<poachThresh){
          var poachedOC=assign({},staff.oc,{formerTeam:t.id,formerRole:"OC",formerTeamAbbr:t.abbr});
          poachedOC.role="HC";poachedOC.ratings=assign({},poachedOC.ratings,{development:cl(poachedOC.ratings.development+rng(3,8),40,95)});
          poachedCoaches.push(poachedOC);
          var brainMsg=isChamp?"ðŸ§  BRAIN DRAIN: ":"ðŸŽ“ ";
          addN(brainMsg+t.icon+t.abbr+" OC "+staff.oc.name+" hired as HC!"+(isChamp?" (Championship tax)":""),"orange");
          logTx("COACH_POACH",{team:t.abbr,role:"OC",name:staff.oc.name,arch:staff.oc.arch,promoted:"HC",brainDrain:isChamp});
          staff.oc=genCoach("OC");
          assignCoordSpecialty(staff.oc,"OC");// v75: New OC gets a specialty
        }
        if(staff.dc&&staff.dc.ratings&&staff.dc.ratings.gameplan>=70&&RNG.ai()<poachThresh){
          var poachedDC=assign({},staff.dc,{formerTeam:t.id,formerRole:"DC",formerTeamAbbr:t.abbr});
          poachedDC.role="HC";poachedDC.ratings=assign({},poachedDC.ratings,{development:cl(poachedDC.ratings.development+rng(3,8),40,95)});
          poachedCoaches.push(poachedDC);
          var brainMsg2=isChamp?"ðŸ§  BRAIN DRAIN: ":"ðŸŽ“ ";
          addN(brainMsg2+t.icon+t.abbr+" DC "+staff.dc.name+" hired as HC!"+(isChamp?" (Championship tax)":""),"orange");
          logTx("COACH_POACH",{team:t.abbr,role:"DC",name:staff.dc.name,arch:staff.dc.arch,promoted:"HC",brainDrain:isChamp});
          staff.dc=genCoach("DC");
          assignCoordSpecialty(staff.dc,"DC");// v75: New DC gets a specialty
        }
      }
      if(staff.oc&&!staff.oc.specialty75)assignCoordSpecialty(staff.oc,"OC");
      if(staff.dc&&!staff.dc.specialty75)assignCoordSpecialty(staff.dc,"DC");
      var madePlay2=false;// detect if team made playoffs this year
      if(history.length>0){var lastH=history[history.length-1];if(lastH&&lastH.bracket){
        var allBracketTeams=[];
        if(lastH.bracket.qf)lastH.bracket.qf.forEach(function(g){allBracketTeams.push(g.home,g.away);});
        madePlay2=allBracketTeams.indexOf(t.id)>=0;
      }}
      staff.hc=progressCoach(staff.hc,t.wins,t.losses,madePlay2,isChamp);
      staff.oc=progressCoach(staff.oc,t.wins,t.losses,madePlay2,isChamp);
      staff.dc=progressCoach(staff.dc,t.wins,t.losses,madePlay2,isChamp);
      if(t.id===myId){
        [staff.hc,staff.oc,staff.dc].forEach(function(c2){
          if(c2._newTrait){
            var trDef=COACH_TRAITS[c2._newTrait];
            addN("ðŸŽ“ "+c2.name+" learned "+(trDef?trDef.icon+" "+trDef.label:c2._newTrait)+"!","gold");
            delete c2._newTrait;
          }
          if(c2._lostTrait){
            var trDef2=COACH_TRAITS[c2._lostTrait];
            addN("ðŸ“‰ "+c2.name+" lost "+(trDef2?trDef2.icon+" "+trDef2.label:c2._lostTrait)+" (bad season)","red");
            delete c2._lostTrait;
          }
        });
      }else{
        [staff.hc,staff.oc,staff.dc].forEach(function(c2){delete c2._newTrait;delete c2._lostTrait;});
      }
      var ovrAvg2=avg(active,function(p){return p.ovr;});
      var foSalaryCost79=0;
      var tFO79=t.id===myId?frontOffice78:(t.frontOffice||[]);
      tFO79.forEach(function(s79){foSalaryCost79+=(s79.salary||0);});
      if(foSalaryCost79>0){
        t.cash=(t.cash||50)-foSalaryCost79;
        if(t.id===myId){logTx("FO_SALARY",{total:foSalaryCost79,year:season.year});addN("ðŸ‘” Front Office salaries paid: $"+foSalaryCost79.toFixed(1)+"M","purple");}
      }
      active.forEach(function(p){p.everReached90=(p.ovr||0)>=90;});
      var psKept87=ps.filter(function(p){return p.contract.years>0;});
      psKept87.forEach(function(p){p.everReached90=(p.ovr||0)>=90;});
      return assign({},t,{roster:active,practiceSquad:psKept87,
        wins:0,losses:0,pf:0,pa:0,streak:0,capUsed:capCalc(active),deadCap:0,
        gameplan:GAMEPLANS[0].id,gameplanOff:"balanced_o",gameplanDef:"balanced_d",revenue:0,expenses:0,scoutPts:1000,_pipelineTripsWeekly:4,ownerGoal:ovrAvg2>74?"title":ovrAvg2>68?"playoff":"rebuild",
        franchiseTag973:(t.franchiseTag973&&t.franchiseTag973.year===season.year+1)?assign({},t.franchiseTag973):null,
        aiStrategy:ovrAvg2>76?"contend":ovrAvg2>70?"bubble":"rebuild",
        staff:staff,
        reSignNeg84:{},
        fitAlertProfile85:t.fitAlertProfile85||"strict",
        fitWeeklyBaseline86:null,fitTrend86:[],fitTrendWeek86:0,fitRiskStreak86:{},
        draftPicks:(t.draftPicks||[]).filter(function(pk){return pk.year&&pk.year>season.year;})
          .concat([1,2,3,4,5,6,7].map(function(r){return makePick(r,t.id,t.id,season.year+1);}))
        });});
    checkRecords(nt,season.year);
    // v97.4: AI Coaching Carousel â€” hire interim HCs from shared market (fresh + recycled + poached)
    var aiHCMarket974=[];
    for(var hm974=0;hm974<8;hm974++)aiHCMarket974.push(genCoach("HC"));
    firedHCs974.forEach(function(f){
      if(RNG.ai()<0.4){
        var recycled974=assign({},f.coach,{salary:Math.round((f.coach.salary||3)*0.8*10)/10,fromCarousel:true});
        recycled974.reputation=cl((recycled974.reputation||50)-rng(5,15),10,99);
        aiHCMarket974.push(recycled974);
      }
    });
    (poachedCoaches||[]).forEach(function(pc){aiHCMarket974.push(pc);});
    var usedCoachIds974={};
    nt.forEach(function(t){
      if(!t||t.isUser)return;
      if(!t.staff||!t.staff.hc||!t.staff.hc.isInterim)return;
      var mode974=deriveAITeamMode(t,season.year);
      var sorted974=aiHCMarket974.slice().sort(function(a,b){
        var aR=a&&a.ratings?a.ratings:{};
        var bR=b&&b.ratings?b.ratings:{};
        var aScore=mode974==="contend"?((aR.strategy||50)*1.5+(aR.gameplan||50)):
          mode974==="rebuild"?((aR.development||50)*1.5+(aR.strategy||50)):
          ((aR.strategy||50)+(aR.development||50));
        var bScore=mode974==="contend"?((bR.strategy||50)*1.5+(bR.gameplan||50)):
          mode974==="rebuild"?((bR.development||50)*1.5+(bR.strategy||50)):
          ((bR.strategy||50)+(bR.development||50));
        return bScore-aScore;
      });
      if(sorted974.length>0){
        var pick974=sorted974[0];
        t.staff.hc=assign({},pick974,{role:"HC",isInterim:false});
        aiHCMarket974=aiHCMarket974.filter(function(c){return c&&c.id!==pick974.id;});
        if(pick974&&pick974.id)usedCoachIds974[pick974.id]=1;
        addN("ðŸŽ  "+t.icon+t.abbr+" hires "+pick974.name+" ("+pick974.arch+") as new HC","cyan");
        logTx("AI_HC_HIRE_974",{team:t.abbr,name:pick974.name,arch:pick974.arch,salary:pick974.salary});
      }
    });
    if(poachedCoaches&&poachedCoaches.length>0){
      poachedCoaches=poachedCoaches.filter(function(pc){return !(pc&&usedCoachIds974[pc.id]);});
    }
    if(firedHCs974.length>0){
      var carouselSummary974=firedHCs974.map(function(f){
        return f.team.icon+f.team.abbr+" fired "+f.coach.name+" ("+f.record+", "+f.reason+")";
      }).join(" â€¢ ");
      addN("ðŸŽ  COACHING CAROUSEL: "+firedHCs974.length+" HC"+(firedHCs974.length>1?"s":"")+" fired! "+carouselSummary974,"orange");
    }
    var bonusCandidates974=firedHCs974.filter(function(f){return (f.coach.reputation||50)>=40;})
      .map(function(f){
        return assign({},f.coach,{
          role:"HC",
          salary:Math.round((f.coach.salary||3)*0.85*10)/10,
          fromCarousel:true,scouted:false,
          record974:f.record,formerTeamAbbr:f.team.abbr
        });
      });
    if(bonusCandidates974.length>0){
      setHiringPool(function(prev){
        var merged=(prev||[]).slice();
        bonusCandidates974.forEach(function(c){
          if(!merged.some(function(x){return x&&x.id===c.id;}))merged.push(c);
        });
        return merged;
      });
      if(my&&my.staff&&my.staff.hc&&my.staff.hc.isInterim){
        addN("ðŸ“‹ "+bonusCandidates974.length+" fired HC"+(bonusCandidates974.length>1?"s":"")+" added to your hiring candidates!","gold");
      }
    }
    var myTeamNow=nt.find(function(t){return t.id===myId;});
    if(myTeamNow){
      var verifiedCount67=0;
      myTeamNow.roster.filter(function(p){return p.age<=23;}).forEach(function(rk){
        var gp69=rk.stats?rk.stats.gp||0:0;
        var vResult=PROSPECT_DOSSIER.verify(prospectDB,rk.id,season.year,rk,gp69);
        if(vResult){
          verifiedCount67++;
          var vEmoji=vResult.status==="VERIFIED"?"âœ…":vResult.status==="MISREAD"?"âŒ":vResult.status==="INCOMPLETE"?"â³":"âž¡ï¸";
          var vLine=vResult.hits.length+" hit"+(vResult.hits.length!==1?"s":"")+" â€¢ "+vResult.misses.length+" miss"+(vResult.misses.length!==1?"es":"");
          if(vResult.deltaConf>0)vLine+=" â€¢ +"+vResult.deltaConf+" conf";
          else if(vResult.deltaConf<0)vLine+=" â€¢ "+vResult.deltaConf+" conf";
          addN(vEmoji+" "+rk.name+": "+vResult.status+" ("+vLine+")"+(vResult.notes?" â€” "+vResult.notes:""),
            vResult.status==="VERIFIED"?"green":vResult.status==="MISREAD"?"red":"orange");
        }
      });
      if(verifiedCount67>0)setProspectDB(assign({},prospectDB));
    }
    setTradeState(function(prev){
      var decayed=TRADE_MATH.decaySeason(prev.gmTrustByTeam||{});
      return assign({},prev,{gmTrustByTeam:decayed,recentTrades:[]});// Clear audit list each season
    });
    (function(){
      var yr69=season.year;
      var r69s=DB_CLEANER.prune(scoutDB,yr69,2);
      if(r69s.pruned>0){setScoutDB(r69s.db);addN("ðŸ§¹ Pruned "+r69s.pruned+" stale opponent dossiers","dim");}
      var r69p=DB_CLEANER.prune(prospectDB,yr69,3);
      if(r69p.pruned>0){setProspectDB(r69p.db);addN("ðŸ§¹ Pruned "+r69p.pruned+" stale prospect dossiers","dim");}
    })();
    if(newHofers.length>0){setHallOfFame(function(prev){return prev.concat(newHofers);});}
    if(poachedCoaches.length>0){
      var candidates=nt.filter(function(t){return !t.isUser&&t.losses>=8;});
      if(candidates.length===0)candidates=nt.filter(function(t){return !t.isUser;});
      poachedCoaches.forEach(function(pc){
        var dest=candidates[Math.floor(RNG.ai()*candidates.length)];
        if(dest){
          dest.staff.hc=pc;
          addN("ðŸ“‹ "+pc.name+" hired as HC of "+dest.icon+dest.abbr+" (from "+pc.formerTeamAbbr+" coaching tree)","purple");
        }
      });
    }
    // v97.3: AI franchise tags + offseason cap cleanup before FA pool is built
    ensureLeagueGMArchetypes90(nt);
    syncLeagueAIModes(nt,season.year);
    nt.forEach(function(t){
      if(!t||t.isUser)return;
      if(t.franchiseTag973&&t.franchiseTag973.year===season.year+1)return;
      var aiExp973=expiring.filter(function(p){
        return p&&p._fromTeamId===t.id&&(p.ovr||0)>=80&&(p.age||0)<=29;
      });
      if(aiExp973.length===0)return;
      var best973=aiExp973.slice().sort(function(a,b){return (b.ovr||0)-(a.ovr||0);})[0];
      var mode973=deriveAITeamMode(t,season.year);
      if(mode973==="contend"||(mode973==="bubble"&&(best973.ovr||0)>=85)){
        var tagRes973=applyFranchiseTag973(t,best973,nt,season.year+1);
        if(tagRes973.ok){
          expiring=expiring.filter(function(p){return p.id!==best973.id;});
          t.roster.push(best973);
          t.capUsed=capCalc(t.roster);
          logAIDecision(t.abbr,t.aiStrategy||"bubble","FRANCHISE_TAG_973","Tagged "+best973.name+" ("+best973.pos+") $"+tagRes973.salary+"M");
        }
      }
    });
    runAICapOps973(nt,season.year+1);
    var newFAs=genFreeAgents(getScaledOffseasonFreeAgentCount97()).concat(expiring.filter(function(p){return p.ovr>=55;}).map(function(p){
      var inflateFA=1+Math.max(0,(season.year-2026)*0.03);
      p.contract={salary:Math.round((p.ovr>=78?rng(5,16):rng(1,5))*inflateFA*10)/10,years:rng(1,3),bonus:0};p.faYears=0;return p;}));
    var returningFAs=(fas||[]).filter(function(p){return p.ovr>=50;}).map(function(p){
      p.faYears=(p.faYears||0)+1;
      if(p.faYears>=1){p.contract={salary:MIN_SALARY,years:1,bonus:0};}
      return p;
    });
    newFAs=newFAs.concat(returningFAs);
    var faLossByTeam={};// teamId â†’ [{name,pos,ovr,salary}]
    var faSignByTeam={};// teamId â†’ [{name,pos,ovr,salary}]
    expiring.filter(function(p){return p.ovr>=55;}).forEach(function(p){
      if(p._fromTeamId){
        if(!faLossByTeam[p._fromTeamId])faLossByTeam[p._fromTeamId]=[];
        faLossByTeam[p._fromTeamId].push({name:p.name,pos:p.pos,ovr:p.ovr,salary:p.contract?p.contract.salary||1:1});
      }
    });
    ensureLeagueGMArchetypes90(nt);
    syncLeagueAIModes(nt,season.year);
    nt.filter(function(t){return !t.isUser;}).forEach(function(t){
      var needs=getTeamNeeds(t);var neededPos=Object.keys(needs);
      var capRoom=getSalaryCap(season.year)-(t.capUsed||0)-(t.deadCap||0);
      var aiMode=deriveAITeamMode(t,season.year);
      var gmArch90=getTeamGMArchetype90(t);
      var stratKey=aiMode==="balanced"?"neutral":aiMode;
      var baseSigns=aiMode==="contend"?rng(3,6):aiMode==="balanced"?rng(2,4):rng(1,3);
      var maxSigns=cl(Math.round(baseSigns*((gmArch90.fa&&gmArch90.fa.aggressive)||1)),1,6);
      var signed=0;
      var candidates=newFAs.filter(function(fa){return neededPos.indexOf(fa.pos)>=0&&fa.contract.salary<=capRoom;})
        .sort(function(a,b){
          var aNeed=(needs[a.pos]||0);
          var bNeed=(needs[b.pos]||0);
          var aFit=(a.ovr||50)*getGMFABias(stratKey,a)*getGMFAArchetypeScore90(t,a,aNeed);
          var bFit=(b.ovr||50)*getGMFABias(stratKey,b)*getGMFAArchetypeScore90(t,b,bNeed);
          return bFit-aFit;
        });
      for(var ci=0;ci<candidates.length&&signed<maxSigns;ci++){
        var fa=candidates[ci];
        var idx3=newFAs.indexOf(fa);
        if(idx3>=0&&fa.contract.salary<=capRoom){
          logAIDecision(t.abbr,t.aiStrategy||"bubble","FA_SIGN",
            gmArch90.icon+" "+gmArch90.label+" needed "+fa.pos+" and signed "+fa.name+" ("+fa.ovr+" OVR, $"+fa.contract.salary+"M)");
          if(!faSignByTeam[t.id])faSignByTeam[t.id]=[];
          faSignByTeam[t.id].push({name:fa.name,pos:fa.pos,ovr:fa.ovr,salary:fa.contract.salary||1});
          t.roster.push(assign({},fa));t.capUsed+=fa.contract.salary;capRoom-=fa.contract.salary;
          newFAs.splice(idx3,1);signed++;
        }
      }
      if(aiMode==="contend"&&signed<maxSigns){
        var topFAs=newFAs.filter(function(fa){return fa.ovr>=72&&fa.contract.salary<=capRoom;}).sort(function(a,b){
          var aNeed2=needs[a.pos]||0;var bNeed2=needs[b.pos]||0;
          var aScore=(a.ovr||50)*getGMFAArchetypeScore90(t,a,aNeed2);
          var bScore=(b.ovr||50)*getGMFAArchetypeScore90(t,b,bNeed2);
          return bScore-aScore;
        });
        for(var ti=0;ti<topFAs.length&&signed<maxSigns;ti++){
          var tfa=topFAs[ti];var tidx=newFAs.indexOf(tfa);
          if(tidx>=0){
            if(!faSignByTeam[t.id])faSignByTeam[t.id]=[];
            faSignByTeam[t.id].push({name:tfa.name,pos:tfa.pos,ovr:tfa.ovr,salary:tfa.contract.salary||1});
            t.roster.push(assign({},tfa));t.capUsed+=tfa.contract.salary;capRoom-=tfa.contract.salary;
            newFAs.splice(tidx,1);signed++;}
        }
      }
    });
    var totalCompPicks73=0;
    nt.forEach(function(t){
      var losses=faLossByTeam[t.id]||[];
      var signs=faSignByTeam[t.id]||[];
      if(losses.length===0)return;
      var compPicks=COMP_PICK_RULES.calcCompPicks(t,losses,signs);
      if(compPicks.length>0){
        compPicks.forEach(function(cp){
          t.draftPicks.push(makePick(cp.round,t.id,t.id,season.year+1));
          totalCompPicks73++;
        });
        if(t.id===myId){
          compPicks.forEach(function(cp){
            addN("ðŸ“‹ Comp Pick Awarded: Round "+cp.round+" (lost "+cp.fromLoss+")","gold");
          });
        }
      }
    });
    if(totalCompPicks73>0)addN("ðŸ“‹ "+totalCompPicks73+" compensatory picks awarded league-wide.","cyan");
    var s=genSchedule97(nt,season.year+1);
    reseedSeason(season.year+1);
    var myTeamAfter=nt.find(function(t){return t.id===myId;});
    // v95.5: pass pipelineBoostYear qualityBoost to genDraftClass when flag matches new season year
    var pby95=myTeamAfter&&myTeamAfter.pipelineBoostYear;
    var pbyActive95=pby95&&pby95===(season.year+1);
    if(pbyActive95){myTeamAfter.pipelineBoostYear=null;}// consume flag
    var d=genDraftClass(getScaledDraftClassCount97(),{pipeline:myTeamAfter&&myTeamAfter._pipeline||null,qualityBoost:pbyActive95||false});
    // v98.6 #17: Generational Talent injection
    (function(){try{
      if(GENERATIONAL_986.shouldSpawn(season.year+1,RNG.draft||Math.random)){
        var gen986=GENERATIONAL_986.create(RNG.draft||Math.random);
        var gp=genPlayer(gen986.pos,"star",rng(21,22));
        gp.name=gen986.name;gp.pot=gen986.pot;gp.devTrait="superstar";
        gp.isGenerational=true;gp._generational986=true;
        var gdef=POS_DEF[gen986.pos];
        if(gdef)gdef.r.forEach(function(r){gp.ratings[r]=cl((gp.ratings[r]||70)+15,60,95);});
        gp.ovr=calcOvr(gp);gp.trueOvr=gp.ovr;gp.hypeOvr=gp.ovr+2;
        gp.scoutGrade="A+";gp.trueGrade="A+";
        gp.scoutRange={min:gp.ovr-2,max:gp.ovr+3,est:gp.ovr+1,tier:"elite"};
        gp.character75={leadership:90,workEthic:85,durability:80,personality:"Captain"};
        gp._hype986=gen986.hype;
        d.unshift(gp);// Put at #1 overall
        addN("ðŸŒŸ GENERATIONAL TALENT: "+gen986.name+" ("+gen986.pos+") â€” "+gen986.hype,"gold");
        setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year+1,0,"draft","Generational talent "+gen986.name+" enters draft","ðŸŒŸ");});
      }
    }catch(e986g){console.error("v98.6 generational error:",e986g);}})();
    if(pbyActive95)addN("ðŸ“¡ Pipeline Boost ACTIVE! Draft class quality enhanced this year.","cyan");
    if(myTeamAfter&&Object.keys(myTeamBefore).length>0){
      var reportPlayers=[];var retiredNames=[];
      myTeamAfter.roster.forEach(function(p){
        var before=myTeamBefore[p.id];
        if(before){reportPlayers.push({name:p.name,pos:p.pos,age:p.age,ovrBefore:before.ovr,ovrAfter:p.ovr,delta:p.ovr-before.ovr,potBefore:before.pot,potAfter:p.pot,devTrait:p.devTrait,trait:p.trait});}
      });
      Object.keys(myTeamBefore).forEach(function(pid){
        var still=myTeamAfter.roster.find(function(p){return p.id===pid;});
        if(!still){retiredNames.push(myTeamBefore[pid]);}
      });
      reportPlayers.sort(function(a,b){return b.delta-a.delta;});// Best improvers first
      var avgBefore=reportPlayers.length>0?Math.round(reportPlayers.reduce(function(s2,p){return s2+p.ovrBefore;},0)/reportPlayers.length):0;
      var avgAfter=reportPlayers.length>0?Math.round(reportPlayers.reduce(function(s2,p){return s2+p.ovrAfter;},0)/reportPlayers.length):0;
      setSeasonReport({year:season.year,players:reportPlayers,retired:retiredNames,avgBefore:avgBefore,avgAfter:avgAfter,
        wins:myTeamAfter.wins||0,losses:myTeamAfter.losses||0,teamName:myTeamAfter.city+" "+myTeamAfter.name,teamIcon:myTeamAfter.icon});
    }
    nt.forEach(function(t){
      var oldYr=String(season.year);
      if(t.deadCapByYear&&t.deadCapByYear[oldYr]){delete t.deadCapByYear[oldYr];}
      t.deadCap=0;// Reset per-season dead cap tracker; deadCapByYear[futureYear] persists
      if(t.deadCapByYear){Object.keys(t.deadCapByYear).forEach(function(yr){t.deadCap+=t.deadCapByYear[yr]||0;});}
      t.deadCap=Math.round(t.deadCap*10)/10;
      t.capUsed=capCalc(t.roster);
    });
    // PIPELINE v97.1: decay scores + reset weekly scout trips at start of each new season
    nt.forEach(function(t){
      if(t._pipeline)t._pipeline=PIPELINE.decay(t._pipeline);
      t._pipelineTripsWeekly=4;
      delete t._pipelineTrips;// legacy field cleanup
    });
    addN("ðŸŸï¸ Season "+(season.year+1)+" Training Camp opens! 75-man rosters. Cut to "+ROSTER_CAP+" after 3 preseason weeks.","gold");
    // v98.6: New Season Hooks â€” Training Camp, Comp Picks, Rivalry Trophies, Owner Mode Revenue, Incentive Checks
    (function(){try{
      var myT986=nt.find(function(t){return t.id===myId;});
      // #5: Compensatory Picks â€” check last year's FA losses vs gains
      if(myT986){
        var lostFA986=(txLog||[]).filter(function(tx){return tx.type==="CUT_FA"||tx.type==="FA_DEPARTURE";});
        var gainedFA986=(txLog||[]).filter(function(tx){return tx.type==="SIGN_FA";});
        var cPicks986=COMP_PICKS_986.calculate(
          lostFA986.map(function(tx){return{name:tx.player||"?",pos:tx.pos||"?",ovr:tx.ovr||65};}),
          gainedFA986.map(function(tx){return{name:tx.player||"?",pos:tx.pos||"?",ovr:tx.ovr||65};})
        );
        if(cPicks986.length>0){
          setCompPicks986(cPicks986);
          cPicks986.forEach(function(cp){addN("ðŸ“‹ COMP PICK: Round "+cp.round+" â€” "+cp.reason,"cyan");});
          setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year+1,0,"draft","Earned "+cPicks986.length+" compensatory pick(s)","ðŸ“‹");});
        }
      }
      // #10: Rivalry Trophies â€” auto-generate for division rivals if not yet created
      if(rivalTrophies986.length===0){
        var newTrophies=[];
        for(var ri986=0;ri986<nt.length&&newTrophies.length<8;ri986++){
          for(var rj986=ri986+1;rj986<nt.length&&newTrophies.length<8;rj986++){
            if(nt[ri986].div===nt[rj986].div){
              var already=newTrophies.find(function(t){return(t.team1===nt[ri986].abbr&&t.team2===nt[rj986].abbr)||(t.team1===nt[rj986].abbr&&t.team2===nt[ri986].abbr);});
              if(!already){
                var trophy=RIVALRY_TROPHIES_986.generate(nt[ri986],nt[rj986],RNG.ui||Math.random);
                newTrophies.push(trophy);
              }
            }
          }
        }
        if(newTrophies.length>0){setRivalTrophies986(newTrophies);addN("ðŸ† "+newTrophies.length+" Rivalry Trophies established across the league!","gold");}
      }
      // #18: Owner Mode Revenue â€” calculate and add to team cash
      if(myT986){
        var rev986=OWNER_MODE_986.calcRevenue(myT986,myT986.wins||0);
        myT986.cash=(myT986.cash||50)+rev986;
        if(rev986>0)addN("ðŸ’° Stadium revenue: $"+rev986+"M added (ticket pricing + wins + fanbase)","green");
      }
      // #6: Contract Incentive checks for all players
      nt.forEach(function(t986){
        var madePlayoffs986=t986.wins>=(t986.losses||0);// simplified playoff check
        (t986.roster||[]).forEach(function(p986){
          if(!p986.incentives986||p986.incentives986.length===0)return;
          var result=INCENTIVES_986.check(p986,{madePlayoffs:madePlayoffs986});
          result.hit.forEach(function(inc){
            t986.capUsed=(t986.capUsed||0)+inc.bonus;
            if(t986.id===myId)addN("ðŸ’° "+p986.name+" hit incentive: "+inc.label+" (+$"+inc.bonus+"M)","green");
          });
          result.miss.forEach(function(inc){
            if(t986.id===myId)addN("âŒ "+p986.name+" missed incentive: "+inc.label,"gray");
          });
        });
      });
      // #13: Timeline â€” new season event
      setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year+1,0,"milestone","Season "+(season.year+1)+" begins","ðŸŸï¸");});
    }catch(e986off){console.error("v98.6 offseason hooks error:",e986off);}})();
    // v98.6 #19: Expansion Draft check (Year 10+)
    (function(){try{
      var yearsPlayed986=(season.year+1)-2026;
      if(EXPANSION_DRAFT_986.shouldTrigger(yearsPlayed986,RNG.ui||Math.random)&&nt.length<32){
        var rng986=RNG.ui||Math.random;
        var ci=Math.floor(rng986()*EXPANSION_DRAFT_986.cities.length);
        var newTeamInfo={city:EXPANSION_DRAFT_986.cities[ci],name:EXPANSION_DRAFT_986.names[ci],
          icon:EXPANSION_DRAFT_986.icons[ci],abbr:EXPANSION_DRAFT_986.cities[ci].substring(0,3).toUpperCase()};
        addN("ðŸš¨ EXPANSION ALERT: The "+newTeamInfo.city+" "+newTeamInfo.name+" "+newTeamInfo.icon+" are joining the league! Protect "+EXPANSION_DRAFT_986.PROTECT_LIMIT+" players!","gold");
        setExpansionEvent986({team:newTeamInfo,phase:"protect",protectedIds:[]});
        setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year+1,0,"milestone",newTeamInfo.city+" "+newTeamInfo.name+" expansion announced","ðŸŸï¸");});
      }
    }catch(e986exp){console.error("v98.6 expansion error:",e986exp);}})();
    setCaptMoments({season:season.year+1,used:0,log:[]});
    var newLedger=LEDGER.log(season.ledger||[],"PHASE",null,"New League Year "+(season.year+1)+". Training Camp opens.",{from:season.year,to:season.year+1},season.year+1,0,"preseason");
    setPosBattles974([]);
    setTeams(nt);setSched(s);setDC(d);setSeason({year:season.year+1,week:1,phase:"preseason",ledger:newLedger});
    setFAs(newFAs);setSelGame(null);setPoBracket(null);setTab("home");doSave(nt,s,{year:season.year+1,week:1,phase:"preseason",ledger:newLedger},newFAs,history);
    var myNew=nt.find(function(t){return t.id===myId;});
    if(myNew){
      var sg33=generateSeasonGoals(myNew);setOwnerGoals(sg33.ownerGoals);setCoachGoals(sg33.coachGoals);
      var pg33=generatePlayerGoals(myNew);setPlayerGoals(pg33);
      setSeasonTracking({blowoutLosses:0,shutoutLosses:0,bestWinStreak:0,currentStreak:0,madePlayoffs:false,isChamp:false});
      addN("ðŸ“‹ Season Goals set! "+sg33.ownerGoals.length+" owner + "+sg33.coachGoals.length+" coach + "+pg33.length+" player goals","cyan",{type:"tab",tab:"home"});
    }
  }
  var bS=function(c,t2){return {background:c||T.gold,color:t2||"#000",border:"none",borderRadius:6,padding:"7px 14px",fontWeight:700,cursor:"pointer",fontSize:12};};
  var pS={background:"linear-gradient(135deg,"+T.green+",#059669)",color:"#fff",border:"none",borderRadius:8,padding:"12px 24px",fontWeight:800,cursor:"pointer",fontSize:16,width:"100%"};
  var megaBtn=function(bg,label){return {background:bg||"linear-gradient(135deg,#d4a74b,#b8860b)",color:"#fff",border:"3px solid rgba(255,255,255,0.3)",borderRadius:12,padding:"16px 24px",fontWeight:900,cursor:"pointer",fontSize:18,width:"100%",textAlign:"center",letterSpacing:1,boxShadow:"0 4px 20px rgba(212,167,75,0.3),inset 0 1px 0 rgba(255,255,255,0.2)",textTransform:"uppercase"};};
  var megaGold=megaBtn("linear-gradient(135deg,#d4a74b,#b8860b)");
  var megaGreen=megaBtn("linear-gradient(135deg,#10b981,#059669)");
  var megaPurple=megaBtn("linear-gradient(135deg,#8b5cf6,#6d28d9)");
  var megaBlue=megaBtn("linear-gradient(135deg,#3b82f6,#2563eb)");
  var cS={background:T.bg2,border:"1px solid "+T.border,borderRadius:8,padding:10,marginBottom:8};
  var thS={textAlign:"left",padding:"4px 6px",borderBottom:"1px solid "+T.border,color:T.dim,fontWeight:600,fontSize:10,textTransform:"uppercase"};
  var tdS={padding:"4px 6px",borderBottom:"1px solid "+T.border};
  var tS={width:"100%",borderCollapse:"collapse",fontSize:11};
  function tabSt(a){return {padding:"8px 10px",cursor:"pointer",fontWeight:a?700:400,color:a?T.gold:T.dim,borderBottom:a?"2px solid "+T.gold:"2px solid transparent",fontSize:11,whiteSpace:"nowrap"};}
  function oS(v){return {fontWeight:800,color:v>=85?T.gold:v>=75?T.green:v>=65?T.text:T.red};}
  function moodColor(v){return v>=70?T.green:v>=40?T.orange:T.red;}
  if(screen==="title"){
    return (
      <div style={{minHeight:"100vh",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",position:"relative"}}>
        
        {showScanlines && <div style={S.scanlines}/>}
        
        <div style={{position:"absolute",top:"-20%",left:"20%",width:300,height:300,background:"radial-gradient(circle,rgba(251,191,36,0.08) 0%,transparent 70%)",pointerEvents:"none"}}/>
        <div style={{position:"absolute",top:"-20%",right:"20%",width:300,height:300,background:"radial-gradient(circle,rgba(34,211,238,0.06) 0%,transparent 70%)",pointerEvents:"none"}}/>
        
        <div style={mS(S.header,{fontSize:11,color:T.dim,marginBottom:8,letterSpacing:6})}>{"DYNASTY / FRANCHISE SIMULATION"}</div>
        <div style={{fontSize:56,fontWeight:900,background:"linear-gradient(135deg,#fbbf24 0%,#fff 40%,#fbbf24 80%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",lineHeight:1,marginBottom:4,textShadow:"4px 4px 0px rgba(0,0,0,0.4)"}}>{"MR. FOOTBALL"}</div>
        <div style={{width:240,height:2,background:"linear-gradient(90deg,transparent,#fbbf24,transparent)",marginBottom:8}}/>
        
        <div style={{height:28,overflow:"hidden",marginBottom:12}}>
          <div style={mS(S.header,{fontSize:14,color:T.gold,textAlign:"center",transition:"opacity 0.5s",letterSpacing:3})}>{TITLE_CAROUSEL[titleCarIdx]}</div>
        </div>
        <div style={{fontSize:10,color:T.faint,maxWidth:340,textAlign:"center",lineHeight:1.6,marginBottom:24}}>{"Draft your 53-man roster. Survive ruthless owners. Outsmart 29 AI GMs in real-time trades. Navigate press conferences, coaching carousels, contract holdouts, and a championship run that changes everything."}</div>
        
        <div style={{display:"flex",flexDirection:"column",gap:10,width:280,marginBottom:20}}>
          <button style={mS(S.btn,S.btnPrimary,{width:"100%",padding:"16px 20px",fontSize:16,borderRadius:RAD.lg,boxShadow:"0 0 30px rgba(251,191,36,0.3),"+SH.glow,letterSpacing:1,animation:"pulse 2s ease-in-out infinite"})} onClick={function(){setScreen("pick");}}>{"ðŸŸï¸ PRESS START"}</button>
          {saveLoading && <div style={{textAlign:"center",color:T.dim,fontSize:11}}>{"Loading saves..."}</div>}
          {!saveLoading && _save && <button style={mS(S.btn,S.btnGhost,{width:"100%",padding:"12px 20px"})} onClick={loadSave2}>{"ðŸ“‚ Continue Dynasty"}</button>}
          <label style={mS(S.btn,S.btnGhost,{width:"100%",padding:"10px 20px",cursor:"pointer",boxSizing:"border-box"})}>
            {"ðŸ“ Import Save"}
            <input type="file" accept=".json" onChange={importSave} style={{display:"none"}} />
          </label>
        </div>
        <div style={{display:"flex",gap:8}}>
          <button onClick={function(){setScreen("music");}} style={mS(S.btn,{background:"rgba(168,85,247,0.25)",color:"#fff",border:"1px solid rgba(168,85,247,0.5)",padding:"8px 16px",fontSize:11})}>{"ðŸŽµ Jukebox"}</button>
          <button onClick={function(){setShowHelp(true);}} style={mS(S.btn,S.btnGhost,{padding:"8px 16px",fontSize:11})}>{"ðŸ“– Guide"}</button>
        </div>
        
        <div style={{position:"absolute",bottom:16,fontSize:7,color:T.faint,textAlign:"center",lineHeight:1.6,maxWidth:400,padding:"0 16px"}}>{"Mr. Football Dynasty â€” v1 Public Release"}</div>
        
        <style>{"@keyframes pulse{0%,100%{box-shadow:0 0 20px rgba(251,191,36,0.2)}50%{box-shadow:0 0 40px rgba(251,191,36,0.5)}}"}</style>
        
        {showHelp && (
          <div style={GS.overlay} onClick={function(){setShowHelp(false);}}>
            <div style={GS.modal} onClick={function(e){e.stopPropagation();}}>
              <div style={GS.hdr}>
                <div style={GS.hdrGold}/>
                <div style={GS.hdrBadge}>{"OPERATIONS MANUAL â€” STAFF ONLY"}</div>
                <div style={GS.hdrTitle}>{"MR. FOOTBALL DYNASTY"}</div>
                <div style={GS.hdrSub}>{"General Manager Operations Manual â€” Complete Reference Edition"}</div>
              </div>
              <div style={GS.body}>
  {/* â•â•â• TABLE OF CONTENTS â•â•â• */}
  <div style={GS.intel}>
    <div style={GS.intelLabel}>{"MANUAL CONTENTS"}</div>
    <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
      {["Franchise Overview","Season Calendar","Game Day Operations","Salary Cap & Contracts","Personnel Scouting","Draft Operations","Trade Desk","Roster Management","Coaching Staff","Player Development","Rivalries & Trophies","Relocation & Stadium","Owner Relations","Dynasty Legacy","Difficulty Settings","Executive Playbook"].map(function(s,i){
        return <span key={i} onClick={function(){var el=document.getElementById("gs98-sec-"+(i+1));if(el)el.scrollIntoView({behavior:"smooth",block:"start"});}} style={{fontSize:9,color:"#fbbf24",padding:"2px 6px",background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.15)",borderRadius:3,cursor:"pointer",transition:"all 0.12s"}}>{(i+1)+". "+s}</span>;
      })}
    </div>
  </div>

  {/* â•â•â• 1. FRANCHISE OVERVIEW â•â•â• */}
  <div id="gs98-sec-1" style={GS.sec}>{"1. FRANCHISE OVERVIEW"}</div>
  <div style={GS.p}>{"You are the General Manager of a professional football franchise in a 30-team league organized into 2 conferences and 6 divisions. Your mission: build a championship roster, manage a $255M salary cap, keep ownership satisfied, and establish a dynasty that endures across decades. Every decision â€” from draft picks to halftime adjustments to stadium naming rights â€” shapes your legacy."}</div>
  <div style={GS.grid3}>
    <div style={{textAlign:"center",padding:8,background:"rgba(251,191,36,0.08)",borderRadius:6,border:"1px solid rgba(251,191,36,0.25)"}}>
      <div style={GS.num}>{"30"}</div><div style={GS.numLabel}>{"Teams"}</div>
    </div>
    <div style={{textAlign:"center",padding:8,background:"rgba(251,191,36,0.08)",borderRadius:6,border:"1px solid rgba(251,191,36,0.25)"}}>
      <div style={GS.num}>{"$255M"}</div><div style={GS.numLabel}>{"Salary Cap"}</div>
    </div>
    <div style={{textAlign:"center",padding:8,background:"rgba(251,191,36,0.08)",borderRadius:6,border:"1px solid rgba(251,191,36,0.25)"}}>
      <div style={GS.num}>{"53"}</div><div style={GS.numLabel}>{"Roster Spots"}</div>
    </div>
  </div>
  <div style={GS.p}>{"League Structure: 2 conferences (East Conference, West Conference) Ã— 3 divisions each Ã— 5 teams per division. Division winners and wildcard qualifiers enter the playoff bracket. Conference champions meet in the Championship Game."}</div>

  {/* â•â•â• 2. SEASON CALENDAR â•â•â• */}
  <div id="gs98-sec-2" style={GS.sec}>{"2. SEASON CALENDAR"}</div>
  <div style={GS.p}>{"The annual calendar follows the real NFL cycle. Each phase has distinct priorities and available actions."}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Phase"}</th><th style={GS.th}>{"Duration"}</th><th style={GS.th}>{"Key Actions"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"â›º Training Camp"}</td><td style={GS.td}>{"3 weeks"}</td><td style={GS.td}>{"Evaluate 75-man roster, position battles, practice focus, preseason sims"}</td></tr>
      <tr><td style={GS.td}>{"âœ‚ï¸ Cut Day"}</td><td style={GS.td}>{"1 day"}</td><td style={GS.td}>{"Trim to 53 roster + 16 practice squad. Cut Advisor recommends drops."}</td></tr>
      <tr><td style={GS.td}>{"ðŸˆ Regular Season"}</td><td style={GS.td}>{"17 weeks"}</td><td style={GS.td}>{"Pre-game speeches, halftime adjustments, practice focus, trades (deadline Wk 10)"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ† Playoffs"}</td><td style={GS.td}>{"3 rounds"}</td><td style={GS.td}>{"Top 6 per conference. QF â†’ SF â†’ Championship. Single elimination."}</td></tr>
      <tr><td style={GS.td}>{"âœï¸ Re-Sign Phase"}</td><td style={GS.td}>{"Offseason"}</td><td style={GS.td}>{"Franchise Tag 1 player. Extend expiring contracts before FA opens."}</td></tr>
      <tr><td style={GS.td}>{"ðŸ”¬ Combine"}</td><td style={GS.td}>{"Offseason"}</td><td style={GS.td}>{"Spend scout points: Measurables, Interview, Film Study on 300 prospects."}</td></tr>
      <tr><td style={GS.td}>{"ðŸ“º Draft"}</td><td style={GS.td}>{"7 rounds"}</td><td style={GS.td}>{"Snake draft. Trade picks on the clock. Post-draft press conference."}</td></tr>
      <tr><td style={GS.td}>{"ðŸª Free Agency"}</td><td style={GS.td}>{"Offseason"}</td><td style={GS.td}>{"Sign FAs: Pay Up, Market, Lowball, or League Min. AI competes."}</td></tr>
      <tr><td style={GS.td}>{"ðŸ‘” Owner Meeting"}</td><td style={GS.td}>{"Offseason"}</td><td style={GS.td}>{"Annual review. Budget adjustments. Facility upgrades or cuts."}</td></tr>
    </tbody>
  </table>
  <div style={GS.tip}><div style={GS.tipLabel}>{"EFFICIENCY TIP"}</div>{"Use 'Sim Season' to fast-forward entire seasons, or sim week-by-week to engage with Game Day, Practice Focus, MFSN Weekly Show, and Coaching Clinic decisions."}</div>

  {/* â•â•â• 3. GAME DAY OPERATIONS â•â•â• */}
  <div id="gs98-sec-3" style={GS.sec}>{"3. GAME DAY OPERATIONS"}</div>
  <div style={GS.p}>{"Every regular season game features a multi-phase Game Day experience that directly impacts simulation results. Your tactical decisions stack and influence morale, chemistry, turnover probability, and scoring."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#fbbf24",marginBottom:6}}>{"PHASE 1: PRE-GAME SPEECH"}</div>
  <div style={GS.p}>{"Before kickoff, select from 3â€“4 speech options. Each has unique stat effects:"}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Speech"}</th><th style={GS.th}>{"Effect"}</th><th style={GS.th}>{"Risk"}</th><th style={GS.th}>{"When Available"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"ðŸ”¥ Fire Them Up"}</td><td style={GS.td}>{"+3 morale, +1 chem"}</td><td style={GS.td}>{"Slight turnover risk"}</td><td style={GS.td}>{"Always"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ§  Lock In"}</td><td style={GS.td}>{"+1 morale, +2 chem"}</td><td style={GS.td}>{"Fewer turnovers"}</td><td style={GS.td}>{"Always"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ’ª Make It Personal"}</td><td style={GS.td}>{"+4 morale, -1 chem"}</td><td style={GS.td}>{"Slight injury risk"}</td><td style={GS.td}>{"Always"}</td></tr>
      <tr><td style={GS.td}>{"âš”ï¸ Rivalry Speech"}</td><td style={GS.td}>{"+5 morale, +3 chem"}</td><td style={GS.td}>{"Minimal"}</td><td style={GS.td}>{"Heated rivalry games only"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ† Championship Mentality"}</td><td style={GS.td}>{"+5 morale, +2 chem"}</td><td style={GS.td}>{"None"}</td><td style={GS.td}>{"Playoff games only"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ˜¤ Back Against the Wall"}</td><td style={GS.td}>{"+4 morale, +2 chem, clutch boost"}</td><td style={GS.td}>{"None"}</td><td style={GS.td}>{"Losing record only"}</td></tr>
    </tbody>
  </table>
  <div style={{fontWeight:700,fontSize:11,color:"#fbbf24",marginBottom:6}}>{"PHASE 2: HALFTIME ADJUSTMENTS"}</div>
  <div style={GS.p}>{"After your speech, choose a second-half strategy. Effects stack with your pre-game speech:"}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Adjustment"}</th><th style={GS.th}>{"Effect"}</th><th style={GS.th}>{"When Available"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"ðŸ“‹ Stay the Course"}</td><td style={GS.td}>{"Steady play, fewer mistakes"}</td><td style={GS.td}>{"Always"}</td></tr>
      <tr><td style={GS.td}>{"âš¡ Open It Up"}</td><td style={GS.td}>{"+scoring chance, +turnover risk"}</td><td style={GS.td}>{"Always"}</td></tr>
      <tr><td style={GS.td}>{"ðŸƒ Control the Clock"}</td><td style={GS.td}>{"Ball control, fewer turnovers"}</td><td style={GS.td}>{"Always"}</td></tr>
      <tr><td style={GS.td}>{"ðŸš¨ Desperation Mode"}</td><td style={GS.td}>{"Max aggression â€” feast or famine"}</td><td style={GS.td}>{"Down 14+"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ›¡ï¸ Protect the Lead"}</td><td style={GS.td}>{"Conservative â€” lock it down"}</td><td style={GS.td}>{"Up 14+"}</td></tr>
      <tr><td style={GS.td}>{"â±ï¸ Two-Minute Specialist"}</td><td style={GS.td}>{"Efficient drive management, clutch boost"}</td><td style={GS.td}>{"Close games"}</td></tr>
    </tbody>
  </table>
  <div style={{fontWeight:700,fontSize:11,color:"#fbbf24",marginBottom:6}}>{"PHASE 3: POST-GAME LOCKER ROOM"}</div>
  <div style={GS.p}>{"After the simulation, your players react based on the result. Star players and young players give quotes reflecting win/loss margin, rivalry stakes, and team morale. Mood ranges from 'Euphoric' (blowout win) to 'Devastated' (blowout loss). This is flavor â€” no mechanical effects, but it brings your franchise to life."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#fbbf24",marginBottom:6}}>{"GAME OF THE WEEK"}</div>
  <div style={GS.p}>{"Each week, the league's best matchup is nationally televised. If your game is selected: +$3M bonus revenue, +2 morale boost, and a 'ðŸ“º NATIONALLY TELEVISED' banner on your Home tab. Selection is based on combined team records and rivalry heat."}</div>
  <div style={GS.tip}><div style={GS.tipLabel}>{"STRATEGY"}</div>{"Stack complementary effects: 'Lock In' (safe speech) + 'Control the Clock' (safe halftime) = maximum consistency. Or go aggressive: 'Fire Them Up' + 'Open It Up' = high ceiling but volatile. Match your approach to your roster's strengths."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 4. SALARY CAP & CONTRACTS â•â•â• */}
  <div id="gs98-sec-4" style={GS.sec}>{"4. SALARY CAP & CONTRACTS"}</div>
  <div style={GS.p}>{"The salary cap is the most consequential system in the game. Mismanagement here cripples your franchise for years. The cap starts at $255M and grows approximately 5% per season."}</div>
  <div style={GS.grid2}>
    <div style={GS.intel}><div style={GS.intelLabel}>{"CAP FORMULA"}</div>{"Total Cap Usage = Sum of All Player Salaries + Dead Money. You cannot sign, trade for, or draft players if you exceed the cap."}</div>
    <div style={GS.intel}><div style={GS.intelLabel}>{"DEAD MONEY"}</div>{"When you cut a player, any remaining signing bonus is accelerated onto your cap as 'dead money.' Big contracts = big dead money risk."}</div>
  </div>
  <div style={{fontWeight:700,fontSize:11,color:"#f97316",marginBottom:6}}>{"CONTRACT TOOLS"}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Tool"}</th><th style={GS.th}>{"How It Works"}</th><th style={GS.th}>{"Risk"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"Restructure"}</td><td style={GS.td}>{"Convert base salary to bonus â†’ immediate cap relief"}</td><td style={GS.td}>{"Adds dead money in future years"}</td></tr>
      <tr><td style={GS.td}>{"Backload"}</td><td style={GS.td}>{"Push cap hits into future seasons"}</td><td style={GS.td}>{"Bigger bills later, potential cap hell"}</td></tr>
      <tr><td style={GS.td}>{"Franchise Tag"}</td><td style={GS.td}>{"Retain 1 expiring player at premium salary per offseason"}</td><td style={GS.td}>{"Expensive â€” 120% of position avg salary"}</td></tr>
      <tr><td style={GS.td}>{"Extension"}</td><td style={GS.td}>{"Re-sign player before FA for a discount"}</td><td style={GS.td}>{"Long-term commitment"}</td></tr>
      <tr><td style={GS.td}>{"Cut"}</td><td style={GS.td}>{"Release player to free cap space"}</td><td style={GS.td}>{"Dead money accelerates"}</td></tr>
    </tbody>
  </table>
  <div style={GS.warn}><div style={GS.warnLabel}>{"CRITICAL WARNING"}</div>{"Never restructure more than 2 contracts in the same offseason. Stacking restructures creates a 'dead money cliff' that can trap you $30â€“50M over cap with no way out. This is the #1 cause of dynasty collapse."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 5. PERSONNEL SCOUTING â•â•â• */}
  <div id="gs98-sec-5" style={GS.sec}>{"5. PERSONNEL SCOUTING"}</div>
  <div style={GS.p}>{"Scouting is the intelligence engine of your front office. You start each season with 1,000 Scout Points and earn more through performance: +25 per regular season win, +50 per playoff win, +100 for gym facility upgrades. Points reset each season â€” use them or lose them."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#22d3ee",marginBottom:6}}>{"COMBINE SCOUTING (DRAFT PROSPECTS)"}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Method"}</th><th style={GS.th}>{"Cost"}</th><th style={GS.th}>{"Reveals"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"ðŸƒ Measurables"}</td><td style={GS.td}>{"20â€“40 pts"}</td><td style={GS.td}>{"Speed, Strength, Motor â€” physical profile"}</td></tr>
      <tr><td style={GS.td}>{"ðŸŽ¤ Interview"}</td><td style={GS.td}>{"30â€“50 pts"}</td><td style={GS.td}>{"Football IQ, Scheme Fit, Personality Traits"}</td></tr>
      <tr><td style={GS.td}>{"ðŸŽ¬ Film Study"}</td><td style={GS.td}>{"40â€“60 pts"}</td><td style={GS.td}>{"Hands, Technique, True OVR range"}</td></tr>
    </tbody>
  </table>
  <div style={{fontWeight:700,fontSize:11,color:"#22d3ee",marginBottom:6}}>{"SCOUT SPEND MENU (IN-SEASON)"}</div>
  <div style={GS.p}>{"Beyond the Combine, scout points can be spent on: Opponent Film (game prep bonus), FA Background Checks (reveal true traits before signing), UDFA Search (discover undrafted gems), Training Boosts (accelerate development), and Trade Block Intel (reveals what AI GMs will accept for their players)."}</div>
  <div style={GS.tip}><div style={GS.tipLabel}>{"SCOUTING PRIORITY"}</div>{"Focus 60% of your budget on QBs, pass rushers (EDGE), and CBs. These positions have the highest variance and the most impact. A bust QB in Round 1 sets your franchise back 3 years. Film Study is the most valuable test â€” it reveals true OVR."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 6. DRAFT OPERATIONS â•â•â• */}
  <div id="gs98-sec-6" style={GS.sec}>{"6. DRAFT OPERATIONS"}</div>
  <div style={GS.p}>{"The annual draft is 7 rounds across all 30 teams. Draft order is inverse of last season's standings (worst team picks first). You can trade picks on the clock â€” hit 'ðŸ”„ Trade Pick' when it's your selection. After the draft, a Post-Draft Press Conference lets you address the media about your picks."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#fbbf24",marginBottom:6}}>{"DRAFT STRATEGY BY ROUND"}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Round"}</th><th style={GS.th}>{"Target"}</th><th style={GS.th}>{"Expected OVR"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"1"}</td><td style={GS.td}>{"Franchise-altering talent. Start Day 1."}</td><td style={GS.td}>{"72â€“82"}</td></tr>
      <tr><td style={GS.td}>{"2â€“3"}</td><td style={GS.td}>{"Starters, immediate contributors"}</td><td style={GS.td}>{"67â€“76"}</td></tr>
      <tr><td style={GS.td}>{"4â€“5"}</td><td style={GS.td}>{"High-upside projects, rotational depth"}</td><td style={GS.td}>{"62â€“70"}</td></tr>
      <tr><td style={GS.td}>{"6â€“7"}</td><td style={GS.td}>{"ðŸ’Ž Hidden gems, special teams, camp bodies"}</td><td style={GS.td}>{"55â€“65"}</td></tr>
    </tbody>
  </table>
  <div style={GS.p}>{"Dev Traits dramatically affect long-term value: ðŸŒŸ Superstar prospects develop 1.5Ã— faster, â­ Star prospects at 1.2Ã—, and Normal at 1Ã—. A Round 3 Superstar often outperforms a Round 1 Normal within 2 seasons."}</div>
  <div style={GS.intel}><div style={GS.intelLabel}>{"POST-DRAFT PRESS CONFERENCE"}</div>{"After your draft, media asks grade-aware questions (high-grade picks get praise questions, low-grade picks get scrutiny). Your answers affect team morale, chemistry, and owner mood. Choose wisely â€” deflecting criticism is sometimes smarter than defending a questionable pick."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 7. TRADE DESK â•â•â• */}
  <div id="gs98-sec-7" style={GS.sec}>{"7. TRADE DESK"}</div>
  <div style={GS.p}>{"Trading is available from Week 1 through the Week 10 Trade Deadline. After the deadline, all trades are locked until the offseason. AI GMs have distinct personalities (Aggressive Trader, Draft Hoarder, Win-Now, etc.) that affect their willingness and valuation."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#f97316",marginBottom:6}}>{"TRADE MECHANICS"}</div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Player Shop â€” open any player's card and hit 'ðŸ›’ Shop' to get instant offers from AI teams who need that position."}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Counter-Offers â€” AI teams can reject your proposal but counter with a different package. Evaluate each counter carefully."}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Conditional Picks â€” trade future draft picks with conditions (e.g., '2nd that becomes 1st if player makes Pro Bowl')."}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Multi-Player Packages â€” complex deals involving multiple players and picks on both sides."}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Grudge Penalty â€” cutting a player then trying to re-acquire them costs extra. AI GMs remember."}</div></div>
  <div style={GS.tip}><div style={GS.tipLabel}>{"TRADE INTEL"}</div>{"Teams in 'Rebuild' mode are desperate to trade aging stars for draft picks â€” target them for bargains. Teams in 'Contend' mode overpay for veterans. Check the AI GM archetype in the trade screen to gauge their tendencies."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 8. ROSTER MANAGEMENT â•â•â• */}
  <div id="gs98-sec-8" style={GS.sec}>{"8. ROSTER MANAGEMENT"}</div>
  <div style={GS.p}>{"Your active roster holds 53 players with a 16-man Practice Squad for development stashing. Position Battles during Training Camp auto-detect when two similar-OVR players compete for a starting spot â€” the winner gets a development boost, the loser gets motivated or disgruntled."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#4ade80",marginBottom:6}}>{"CUT ADVISOR"}</div>
  <div style={GS.p}>{"The Cut Advisor analyzes every player on your roster and recommends cuts based on: OVR relative to position depth, age/decline trajectory, cap hit vs. production, dead money impact, trait analysis, and depth chart redundancy. Access it from the Roster tab during camp."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#4ade80",marginBottom:6}}>{"DEPTH CHART"}</div>
  <div style={GS.p}>{"Players only earn XP, stats, and development progress if they're getting snaps. Keep your best players as starters. Backup QBs are critical â€” one injury to your starter and you need a viable replacement or your season is over."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#4ade80",marginBottom:6}}>{"HOLDOUTS"}</div>
  <div style={GS.p}>{"Unhappy stars may hold out for better contracts. You can negotiate (offer a restructure/extension), stand firm (morale drops), or trade them. Holdouts that drag on tank team chemistry."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 9. COACHING STAFF â•â•â• */}
  <div id="gs98-sec-9" style={GS.sec}>{"9. COACHING STAFF"}</div>
  <div style={GS.p}>{"Your coaching staff directly impacts player development, scheme effectiveness, and game outcomes."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#a855f7",marginBottom:6}}>{"FRONT OFFICE STAFF"}</div>
  <div style={GS.p}>{"Hire up to 3 specialists: Assistant GM (improves trade evaluation), Scout Director (reduces scouting costs), Analytics Coordinator (better draft projections). Each has a salary and XP level."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#a855f7",marginBottom:6}}>{"COACHING CAROUSEL"}</div>
  <div style={GS.p}>{"Hire and fire OC (Offensive Coordinator) and DC (Defensive Coordinator) from the Office tab. Coordinators affect scheme effectiveness and player development rates. Stability matters â€” firing coordinators mid-season disrupts system knowledge."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#a855f7",marginBottom:6}}>{"COACHING CLINIC"}</div>
  <div style={GS.p}>{"An XP-based perk tree for your coaching staff. Earn XP through wins and player development milestones. Perk categories: Leadership (morale bonuses), Analytics (scouting efficiency), Development (faster player growth), and Conditioning (injury reduction). Each perk has multiple tiers."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#a855f7",marginBottom:6}}>{"WEEKLY PRACTICE FOCUS"}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Focus"}</th><th style={GS.th}>{"Primary Benefit"}</th><th style={GS.th}>{"Secondary"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"ðŸ” Opponent Scout"}</td><td style={GS.td}>{"Fastest system knowledge growth"}</td><td style={GS.td}>{"Matchup prep bonus"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ“ˆ Development Camp"}</td><td style={GS.td}>{"Biggest player growth"}</td><td style={GS.td}>{"Young core improvement"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ§Š Recovery Week"}</td><td style={GS.td}>{"Reduced injury risk"}</td><td style={GS.td}>{"Small morale boost"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ’ª Full Pads"}</td><td style={GS.td}>{"Moderate dev + system knowledge"}</td><td style={GS.td}>{"Higher injury risk"}</td></tr>
    </tbody>
  </table>

  <div style={GS.divider}/>

  {/* â•â•â• 10. PLAYER DEVELOPMENT â•â•â• */}
  <div id="gs98-sec-10" style={GS.sec}>{"10. PLAYER DEVELOPMENT"}</div>
  <div style={GS.p}>{"Player growth is the engine of your dynasty. Understanding development curves, traits, and system knowledge separates championship GMs from mediocre ones."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#4ade80",marginBottom:6}}>{"DEVELOPMENT CURVES"}</div>
  <div style={GS.p}>{"Young players (21â€“25) develop fastest. Players 26â€“28 are in their prime â€” stable but slow growth. After 29, decline begins. Position-specific curves matter: RBs and CBs decline earliest (steep drops after 27), while QBs and OL age gracefully into their mid-30s."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#4ade80",marginBottom:6}}>{"DEV TRAITS"}</div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"ðŸŒŸ Superstar â€” 1.5Ã— development speed. Franchise cornerstones. Never trade these."}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"â­ Star â€” 1.2Ã— development speed. Reliable building blocks."}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Normal â€” 1Ã— development speed. The majority of your roster."}</div></div>
  <div style={{fontWeight:700,fontSize:11,color:"#4ade80",marginBottom:6}}>{"PERSONALITY TRAITS (UP TO 3 PER PLAYER)"}</div>
  <div style={GS.p}>{"Every player has a primary personality trait, with a 45% chance of a 2nd and 15% chance of a 3rd. Traits stack â€” combos create unique players. Key traits:"}</div>
  <div style={GS.grid2}>
    <div style={GS.chip}>{"âš¡ Clutch â€” better in tight games"}</div>
    <div style={GS.chip}>{"Â©ï¸ Captain â€” boosts teammates"}</div>
    <div style={GS.chip}>{"ðŸ’ª Workhorse â€” develops faster"}</div>
    <div style={GS.chip}>{"ðŸ’€ Glass â€” injury-prone"}</div>
    <div style={GS.chip}>{"â˜ ï¸ Cancer â€” hurts team morale"}</div>
    <div style={GS.chip}>{"ðŸŽ­ Showboat â€” inconsistent, big plays"}</div>
    <div style={GS.chip}>{"ðŸ§Š Iceman â€” clutch + steady"}</div>
    <div style={GS.chip}>{"ðŸ›¡ï¸ Ironman â€” rarely injured"}</div>
    <div style={GS.chip}>{"ðŸ˜¤ Chip on Shoulder â€” plays angry"}</div>
    <div style={GS.chip}>{"ðŸ”„ Comeback Kid â€” bounces back"}</div>
    <div style={GS.chip}>{"ðŸ¡ Hometown Hero â€” takes discounts"}</div>
    <div style={GS.chip}>{"ðŸ’° Money Hungry â€” demands max deals"}</div>
  </div>
  <div style={{fontWeight:700,fontSize:11,color:"#4ade80",marginBottom:6}}>{"SYSTEM KNOWLEDGE"}</div>
  <div style={GS.p}>{"Players learn your scheme over time. High system knowledge = fewer turnovers, better execution, tighter coverages. Changing schemes resets ~40% of system knowledge. Stable schemes + Opponent Scout practice = elite performance."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 11. RIVALRIES & TROPHIES â•â•â• */}
  <div id="gs98-sec-11" style={GS.sec}>{"11. RIVALRIES & TROPHIES"}</div>
  <div style={GS.p}>{"Rivalries develop organically through repeated matchups, upsets, close games, and playoff meetings. Heat builds over time on a 0â€“100 scale."}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Heat Level"}</th><th style={GS.th}>{"Status"}</th><th style={GS.th}>{"Effects"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"0â€“19"}</td><td style={GS.td}>{"Budding"}</td><td style={GS.td}>{"No effects"}</td></tr>
      <tr><td style={GS.td}>{"20â€“39"}</td><td style={GS.td}>{"Growing"}</td><td style={GS.td}>{"Minor atmosphere"}</td></tr>
      <tr><td style={GS.td}>{"40â€“59"}</td><td style={GS.td}>{"Intense"}</td><td style={GS.td}>{"+3 morale, +3 crowd, slight injury risk"}</td></tr>
      <tr><td style={GS.td}>{"60+"}</td><td style={GS.td}>{"ðŸ† Trophy Generated"}</td><td style={GS.td}>{"+5 morale, +5 chem, trophy changes hands each game"}</td></tr>
      <tr><td style={GS.td}>{"80+"}</td><td style={GS.td}>{"Blood Feud"}</td><td style={GS.td}>{"Maximum atmosphere, MFSN Rivalry Watch segment"}</td></tr>
    </tbody>
  </table>
  <div style={GS.p}>{"When heat reaches 60+, a trophy is auto-generated from 8 templates (Cup, Bell, Boot, Founders Trophy, Axe, Shield, Flame, Hammer). The trophy changes hands after each head-to-head game. Your trophy case is displayed on the âš”ï¸ Rivalries tab under Standings."}</div>
  <div style={GS.p}>{"MFSN Weekly Show includes a 'Rivalry Watch' segment when you have a rivalry game coming up, previewing the matchup with hype lines and trophy stakes."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 12. RELOCATION & STADIUM â•â•â• */}
  <div id="gs98-sec-12" style={GS.sec}>{"12. RELOCATION & STADIUM"}</div>
  <div style={GS.p}>{"After 3+ seasons with $30M+ cash, you can relocate your franchise. Each destination has unique market modifiers. Relocation costs $30M base + market premium (up to $55M for London). There is a 5-year cooldown between moves."}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"City"}</th><th style={GS.th}>{"Market Mod"}</th><th style={GS.th}>{"Prestige"}</th><th style={GS.th}>{"Note"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"ðŸ‡¬ðŸ‡§ London"}</td><td style={GS.td}>{"High"}</td><td style={GS.td}>{"+High"}</td><td style={GS.td}>{"Most expensive, biggest prestige"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ‡²ðŸ‡½ Mexico City"}</td><td style={GS.td}>{"High"}</td><td style={GS.td}>{"+High"}</td><td style={GS.td}>{"Massive fanbase potential"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ‡¨ðŸ‡¦ Toronto"}</td><td style={GS.td}>{"Medium"}</td><td style={GS.td}>{"+Medium"}</td><td style={GS.td}>{"Untapped market"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ‡ºðŸ‡¸ Austin/Portland/St. Louis/Orlando"}</td><td style={GS.td}>{"Medium"}</td><td style={GS.td}>{"+Medium"}</td><td style={GS.td}>{"Domestic expansion"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ‡ºðŸ‡¸ Las Cruces/Honolulu"}</td><td style={GS.td}>{"Low-Med"}</td><td style={GS.td}>{"+Low"}</td><td style={GS.td}>{"Unique markets"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ‡©ðŸ‡ª Berlin"}</td><td style={GS.td}>{"High"}</td><td style={GS.td}>{"+High"}</td><td style={GS.td}>{"European expansion"}</td></tr>
    </tbody>
  </table>
  <div style={GS.p}>{"Stadium Naming Rights: Each season, 3 random corporate sponsor deals are offered. Naming deals pay weekly revenue during the regular season (spread over 17 weeks). Deals expire at season rollover with a notification."}</div>
  <div style={GS.warn}><div style={GS.warnLabel}>{"RELOCATION WARNING"}</div>{"Moving resets your stadium to level 1 and causes a temporary chemistry and morale hit to your roster. Your old identity is preserved in franchise history. Choose your destination carefully â€” you're stuck for 5 years."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 13. OWNER RELATIONS â•â•â• */}
  <div id="gs98-sec-13" style={GS.sec}>{"13. OWNER RELATIONS"}</div>
  <div style={GS.p}>{"Your owner sets expectations and evaluates your performance. Owner Mood runs 0â€“99 and is the single most important number for job security."}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Mood"}</th><th style={GS.th}>{"Status"}</th><th style={GS.th}>{"Consequence"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"70+"}</td><td style={GS.td}>{"Thrilled"}</td><td style={GS.td}>{"Budget increases, facility upgrades available"}</td></tr>
      <tr><td style={GS.td}>{"50â€“69"}</td><td style={GS.td}>{"Satisfied"}</td><td style={GS.td}>{"Status quo, mild patience"}</td></tr>
      <tr><td style={GS.td}>{"30â€“49"}</td><td style={GS.td}>{"Concerned"}</td><td style={GS.td}>{"Mandates get tougher, budget pressure"}</td></tr>
      <tr><td style={GS.td}>{"15â€“29"}</td><td style={GS.td}>{"Ultimatum"}</td><td style={GS.td}>{"Final warning â€” meet next mandate or fired"}</td></tr>
      <tr><td style={GS.td}>{"Below 15"}</td><td style={GS.td}>{"FIRED"}</td><td style={GS.td}>{"Game over â€” dynasty ends"}</td></tr>
    </tbody>
  </table>
  <div style={GS.p}>{"Owner Types: Patient (forgiving, gives you time to rebuild), Meddler (demanding, micromanages decisions), Win-Now (volatile, expects immediate results). Mandates are periodic side-objectives: win streaks, start youth players, avoid blowouts, trade underperformers. Completing them buys goodwill."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 14. DYNASTY LEGACY â•â•â• */}
  <div id="gs98-sec-14" style={GS.sec}>{"14. DYNASTY LEGACY"}</div>
  <div style={GS.p}>{"The Legacy tab is your franchise's permanent record. It tracks everything that matters across your entire career as GM."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#fbbf24",marginBottom:6}}>{"LEGACY SCORE"}</div>
  <div style={GS.p}>{"Composite score graded on 6 dimensions: Win%, Championships, Playoff Appearances, Draft Hits, Cap Management, and Player Development. Tiers range from Rookie to Legend. Coaching stability and championship eras add bonus multipliers."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#fbbf24",marginBottom:6}}>{"12 CAREER MILESTONES"}</div>
  <div style={GS.grid3}>
    <div style={GS.chip}>{"First Victory"}</div><div style={GS.chip}>{"Playoff Bound"}</div><div style={GS.chip}>{"Championship"}</div>
    <div style={GS.chip}>{"Dynasty (3+ rings)"}</div><div style={GS.chip}>{"50 Wins"}</div><div style={GS.chip}>{"100 Wins"}</div>
    <div style={GS.chip}>{"Cap Wizard"}</div><div style={GS.chip}>{"Talent Factory"}</div><div style={GS.chip}>{"Player Whisperer"}</div>
    <div style={GS.chip}>{"Integrity"}</div><div style={GS.chip}>{"Decade"}</div><div style={GS.chip}>{"HoF GM"}</div>
  </div>
  <div style={{fontWeight:700,fontSize:11,color:"#fbbf24",marginBottom:6}}>{"DYNASTY ERAS"}</div>
  <div style={GS.p}>{"Consecutive championships within 3 years are grouped into named eras: 'The Dynasty' (3+ rings), 'The Run' (2+ rings). Era cards display on your Legacy Dashboard with highlights and key players."}</div>
  <div style={{fontWeight:700,fontSize:11,color:"#fbbf24",marginBottom:6}}>{"HALL OF FAME"}</div>
  <div style={GS.p}>{"Retired legends with high legacy scores get inducted starting Season 6. Players need 10+ seasons and dominant stats. Their induction speeches reference real franchise moments."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 15. DIFFICULTY â•â•â• */}
  <div id="gs98-sec-15" style={GS.sec}>{"15. DIFFICULTY SETTINGS"}</div>
  <table style={GS.tbl}>
    <thead><tr><th style={GS.th}>{"Mode"}</th><th style={GS.th}>{"Cash"}</th><th style={GS.th}>{"Owner"}</th><th style={GS.th}>{"AI Quality"}</th></tr></thead>
    <tbody>
      <tr><td style={GS.td}>{"ðŸŸ¢ Rookie"}</td><td style={GS.td}>{"$100M"}</td><td style={GS.td}>{"Forgiving"}</td><td style={GS.td}>{"Standard"}</td></tr>
      <tr><td style={GS.td}>{"ðŸŸ¡ Pro"}</td><td style={GS.td}>{"$75M"}</td><td style={GS.td}>{"Balanced"}</td><td style={GS.td}>{"Moderate"}</td></tr>
      <tr><td style={GS.td}>{"ðŸŸ  All-Pro"}</td><td style={GS.td}>{"$50M"}</td><td style={GS.td}>{"Demanding"}</td><td style={GS.td}>{"Sharp"}</td></tr>
      <tr><td style={GS.td}>{"ðŸ”´ Legend"}</td><td style={GS.td}>{"$25M"}</td><td style={GS.td}>{"Maximum pressure"}</td><td style={GS.td}>{"Elite"}</td></tr>
    </tbody>
  </table>
  <div style={GS.p}>{"God Mode (âš¡ toggle on draft screen) gives full sandbox control: edit ANY team, player, or coach in the league. Force trades, sign anyone, steal/move/clone/retire players, create custom players, add draft picks, adjust salary cap, swap team control, boost or nuke rivals. Marked with purple âš¡ when active."}</div>
  <div style={GS.p}>{"League DNA sliders let you tune simulation personality: trade frequency, injury rate, draft bust rate, free agent aggression, and more. Presets available for Realistic, Chaos, and Dynasty Builder configurations."}</div>

  <div style={GS.divider}/>

  {/* â•â•â• 16. EXECUTIVE PLAYBOOK â•â•â• */}
  <div id="gs98-sec-16" style={GS.sec}>{"16. EXECUTIVE PLAYBOOK"}</div>
  <div style={GS.p}>{"These are the strategies that separate championship GMs from pretenders. Study them before your first season."}</div>
  <div style={GS.intel}><div style={GS.intelLabel}>{"THE PIPELINE"}</div>{"Build through the draft. Rookie contracts are 4 years of below-market production. Stack 3â€“4 good drafts and you'll have a championship window with cap space to add 1â€“2 veteran FA pieces."}</div>
  <div style={GS.intel}><div style={GS.intelLabel}>{"THE QB RULE"}</div>{"Always have a backup QB. Always. One injury to your starter without a viable backup tanks your entire season. Draft a developmental QB in rounds 3â€“5 every other year."}</div>
  <div style={GS.intel}><div style={GS.intelLabel}>{"THE CAP CLIFF"}</div>{"Never restructure more than 2 contracts per offseason. Never backload more than 3. Dead money compounds â€” one bad year of cap management takes 3 years to recover from."}</div>
  <div style={GS.intel}><div style={GS.intelLabel}>{"THE SCHEME ADVANTAGE"}</div>{"System knowledge compounds with stable schemes. Switching from Air Raid to Power Run resets 40% of knowledge. Pick a scheme early, stick with it, and draft players who fit it."}</div>
  <div style={GS.intel}><div style={GS.intelLabel}>{"THE RE-SIGN WINDOW"}</div>{"Your best players are cheapest to retain BEFORE they hit free agency. During the Re-Sign Phase, you get a discount. Once they're on the open market, expect to pay 120â€“150% market rate."}</div>
  <div style={GS.intel}><div style={GS.intelLabel}>{"THE GAME DAY EDGE"}</div>{"Pre-game speech + halftime adjustment stack. 'Lock In' + 'Control Clock' is the safest combo. 'Rivalry Speech' + 'Open It Up' is highest ceiling in rivalry games. Match your approach to your roster's personality."}</div>
  <div style={GS.intel}><div style={GS.intelLabel}>{"THE TROPHY CHASE"}</div>{"Rivalry trophies and dynasty milestones compound your Legacy Score. Defend your trophies, earn milestones, and your legacy tier rises faster. A 'Dynasty' era (3+ rings) adds +8 legacy points."}</div>
  <div style={GS.intel}><div style={GS.intelLabel}>{"THE KEYBOARD"}</div>{"Keyboard shortcuts speed up gameplay: D = Dashboard, R = Roster, G = Trade, O = Office. Ctrl+S saves. Use them."}</div>

</div><div style={GS.footer}>
                <button onClick={function(){setShowHelp(false);}} style={GS.goldBtn}>{"ENTER THE FRONT OFFICE ðŸˆ"}</button>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  }
  if(screen==="pick"){
    return (
      <div style={{minHeight:"100vh",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",padding:16}}>
        <div style={{textAlign:"center",marginBottom:20}}>
          <div style={{fontSize:11,fontWeight:700,letterSpacing:4,color:T.dim,textTransform:"uppercase",marginBottom:4}}>Choose Your</div>
          <div style={{fontSize:24,fontWeight:900,color:T.gold}}>Franchise</div>
          <div style={{color:T.faint,fontSize:11,marginTop:4}}>Build the empire. Survive the owner. Win the war.</div>
        </div>
        {(function(){
          var useGrouped97=TD.length>=30&&LEAGUE_STRUCTURE&&LEAGUE_STRUCTURE.conferences&&LEAGUE_STRUCTURE.divisions;
          if(!useGrouped97){
            return <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(130px,1fr))",gap:10}}>
              {TD.map(function(t,i){return (
                <div key={t.id} onClick={function(){setExpTeamIdx(i);setScreen("draftMode");}} style={mS(S.card,{cursor:"pointer",textAlign:"center",padding:14,transition:"all 0.15s ease",borderColor:T.glassBorder})}>
                  <div style={{display:"flex",justifyContent:"center",marginBottom:6}}>{React.createElement(TeamLogo,{team:t,size:42})}</div>
                  <div style={{fontWeight:800,fontSize:13}}>{t.city}</div>
                  <div style={{fontWeight:600,fontSize:11,color:T.dim}}>{t.name}</div>
                </div>
              );})}
            </div>;
          }
          var tdById97={};var tdIdx97={};
          TD.forEach(function(t,idx){tdById97[t.id]=t;tdIdx97[t.id]=idx;});
          var confGroups97=(LEAGUE_STRUCTURE.conferences||[]).map(function(conf){
            return {
              id:conf.id,name:conf.name,icon:conf.icon,
              divisions:(LEAGUE_STRUCTURE.divisions||[]).filter(function(div){return div.conf===conf.id;})
            };
          });
          return <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(280px,1fr))",gap:14,alignItems:"start"}}>
            {confGroups97.map(function(conf){
              return <div key={conf.id} style={mS(S.card,{padding:12,borderColor:conf.id==="EC"?"rgba(96,165,250,0.25)":"rgba(245,158,11,0.25)",background:"rgba(255,255,255,0.02)"})}>
                <div style={{fontWeight:900,fontSize:12,color:conf.id==="EC"?T.cyan:T.gold,letterSpacing:1,marginBottom:8}}>
                  {conf.icon+" "+conf.name.toUpperCase()}
                </div>
                <div style={{display:"flex",flexDirection:"column",gap:10}}>
                  {conf.divisions.map(function(div){
                    return <div key={div.id}>
                      <div style={{fontSize:10,fontWeight:800,color:T.dim,marginBottom:6,letterSpacing:1}}>
                        {div.icon+" "+div.name.toUpperCase()+" DIVISION"}
                      </div>
                      <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(118px,1fr))",gap:8}}>
                        {(div.teams||[]).map(function(teamId){
                          var t=tdById97[teamId];
                          if(!t)return null;
                          return <div key={t.id} onClick={function(){setExpTeamIdx(tdIdx97[t.id]);setScreen("draftMode");}}
                            style={mS(S.card,{cursor:"pointer",textAlign:"center",padding:10,borderColor:T.glassBorder,background:"rgba(255,255,255,0.015)"})}>
                            <div style={{display:"flex",justifyContent:"center",marginBottom:4}}>{React.createElement(TeamLogo,{team:t,size:34})}</div>
                            <div style={{fontWeight:800,fontSize:11,lineHeight:1.15}}>{t.city}</div>
                            <div style={{fontWeight:600,fontSize:9,color:T.dim,lineHeight:1.2,marginTop:2}}>{t.name}</div>
                          </div>;
                        })}
                      </div>
                    </div>;
                  })}
                </div>
              </div>;
            })}
          </div>;
        })()}
        <div style={{textAlign:"center",marginTop:16}}>
          <button style={mS(S.btn,S.btnGhost,{padding:"8px 20px"})} onClick={function(){setScreen("title");}}>{"â† Back"}</button>
        </div>
      </div>
    );
  }
  if(screen==="draftMode"){
    var selTeam=TD[expTeamIdx];
    // v95: Instant Start moved to FIRST â€” most accessible for new players (ChatGPT UX rec)
    var DRAFT_MODES=[
      {id:"quick",icon:"âš¡",label:"Instant Start",sub:"Pre-Built Rosters â€” Jump to Week 1",desc:"All "+getLeagueTeamCountLabel97()+" teams arrive with fully constructed, balanced rosters. Stars, depth, contracts â€” ready to go. Skip the draft and get straight to Week 1.",time:"â±ï¸ Instant",diff:"â€”",type:"quick",depth:0,border:T.gold,recommended:true},
      {id:"snake10",icon:"â­",label:"Franchise Cornerstones",sub:"Snake Draft â€” 10 Picks + Auto",desc:"Grab your franchise QB, star pass rusher, and cornerstones. AI builds around your vision.",time:"â±ï¸ ~3 min",diff:"ðŸˆ",type:"snake",depth:10,border:T.purple},
      {id:"snake25",icon:"ðŸ",label:"Build the Core",sub:"Snake Draft â€” 25 Picks + Auto",desc:"Hand-pick your starters and key backups. AI fills the remaining depth chart with smart picks.",time:"â±ï¸ ~8 min",diff:"ðŸˆðŸˆ",type:"snake",depth:25,border:T.blue},
      {id:"auction",icon:"ðŸ’°",label:"Auction Draft",sub:"$1,000 Budget â€” Bid on Every Player",desc:"Nominate players, bid against 29 ruthless AI GMs. Budget management is the game within the game.",time:"â±ï¸ ~15 min",diff:"ðŸ§ ðŸ§ ðŸ§ ",type:"auction",depth:53,border:T.gold},
      {id:"snake53",icon:"ðŸ",label:"Full Roster Draft",sub:"Snake Draft â€” 53 Picks",desc:"Draft every single player on your 53-man roster. Total control. You pick, AI picks, full snake rotation.",time:"â±ï¸ ~20 min",diff:"ðŸˆðŸˆðŸˆ",type:"snake",depth:53,border:T.green}
    ];
    return (
      <div style={{minHeight:"100vh",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",display:"flex",flexDirection:"column",alignItems:"center",padding:20}}>
        <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:8,marginTop:20}}>
          {React.createElement(TeamLogo,{team:selTeam,size:48})}
          <div><div style={{fontSize:24,fontWeight:900}}>{selTeam.city}</div><div style={{color:T.gold,fontWeight:700}}>{selTeam.name}</div></div>
        </div>
        <div style={{fontSize:18,fontWeight:800,color:T.gold,marginBottom:4}}>Choose Your Draft Mode</div>
        <div style={{color:T.dim,fontSize:11,textAlign:"center",maxWidth:400,marginBottom:10}}>{"How will "+getLeagueTeamCountLabel97()+" teams build their rosters? Pick your path."}</div>
        
        <div style={mS(S.card,{display:"flex",gap:4,marginBottom:8,padding:6})}>
          {Object.keys(DIFF_SETTINGS).map(function(k){
            var ds=DIFF_SETTINGS[k];var isCur=difficulty===k;
            return React.createElement("div",{key:k,onClick:function(){setDifficulty(k);},
              style:{flex:1,textAlign:"center",padding:"6px 4px",borderRadius:RAD.sm,cursor:"pointer",
                background:isCur?"rgba(251,191,36,0.15)":"transparent",
                border:isCur?"1px solid "+T.gold:"1px solid transparent",transition:"all 0.12s"}},
              React.createElement("div",{style:{fontSize:14}},ds.icon),
              React.createElement("div",{style:{fontSize:10,fontWeight:isCur?800:500,color:isCur?T.gold:T.dim}},ds.name)
            );
          })}
        </div>
        
        {(function(){
          var ds=DIFF_SETTINGS[difficulty]||DIFF_SETTINGS.pro;
          var cashColor=ds.startCash>=70?T.green:ds.startCash>=40?T.gold:ds.startCash>=25?T.orange:T.red;
          return React.createElement("div",{style:{fontSize:10,textAlign:"center",color:cashColor,marginBottom:6,fontWeight:700}},
            "ðŸ’µ Starting Cash: $"+(ds.startCash||50)+"M"+(ds.startCash>=70?" â€” Facilities ready to build":(ds.startCash>=40?" â€” Room to grow":(ds.startCash>=25?" â€” Tight budget":" â€” Barely scraping by")))
          );
        })()}
        
        <div style={mS(S.card,{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 14px",marginBottom:14,borderColor:godMode?"rgba(167,139,250,0.4)":T.glassBorder,background:godMode?"rgba(167,139,250,0.06)":"transparent"})}>
          <div>
            <div style={{fontWeight:800,fontSize:13,color:godMode?T.purple:T.dim}}>{"âš¡ God Mode"}</div>
            <div style={{fontSize:9,color:T.faint}}>{"Edit anything. Force trades. No limits. Full sandbox control."}</div>
          </div>
          <button onClick={function(){setGodMode(function(v){return !v;});}} style={mS(S.btn,{padding:"8px 16px",fontSize:11,fontWeight:800,background:godMode?"rgba(167,139,250,0.3)":"rgba(255,255,255,0.06)",color:godMode?"#fff":T.faint,border:"1px solid "+(godMode?"rgba(167,139,250,0.5)":T.glassBorder)})}>{godMode?"ON âš¡":"OFF"}</button>
        </div>
        
        <div style={mS(S.card,{padding:"10px 14px",marginBottom:14,borderColor:"rgba(96,165,250,0.3)"})}>
          <div style={{fontWeight:800,fontSize:12,color:T.cyan,marginBottom:6}}>{"ðŸ§¬ League DNA"}</div>
          <div style={{fontSize:9,color:T.faint,marginBottom:8}}>{"Tune the league personality. 1.0 = default. 0.5 = mild. 2.0 = wild."}</div>
          
          <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:8}}>
            {DNA_PRESETS.map(function(preset){
              var isActive=DNA_SLIDERS.every(function(sl){return Math.abs((leagueDNA[sl.key]||1.0)-(preset.dna[sl.key]||1.0))<0.05;});
              return <button key={preset.id} onClick={function(){setLeagueDNA(preset.dna);DNA_ACTIVE=preset.dna;}}
                style={mS(S.btn,{fontSize:8,padding:"4px 8px",
                  background:isActive?"rgba(96,165,250,0.2)":"rgba(255,255,255,0.05)",
                  color:isActive?T.cyan:T.dim,border:"1px solid "+(isActive?T.cyan:T.glassBorder),
                  borderRadius:6})}>{preset.label}</button>;
            })}
          </div>
          {DNA_SLIDERS.map(function(sl){
            var val=leagueDNA[sl.key]||1.0;
            return <div key={sl.key} style={{display:"flex",alignItems:"center",gap:8,marginBottom:4}}>
              <span style={{fontSize:11,width:20,textAlign:"center"}}>{sl.emoji}</span>
              <span style={{fontSize:10,fontWeight:700,width:90,color:T.dim}}>{sl.label}</span>
              <input type="range" min={sl.min*10} max={sl.max*10} step={sl.step*10} value={Math.round(val*10)}
                onChange={function(e){var nv=parseInt(e.target.value)/10;setLeagueDNA(function(old){var n2=assign({},old);n2[sl.key]=nv;DNA_ACTIVE=n2;return n2;});}}
                style={{flex:1,accentColor:T.cyan}} />
              <span style={{fontSize:10,fontWeight:800,color:val!==1.0?T.cyan:T.faint,width:28,textAlign:"right"}}>{val.toFixed(1)}</span>
            </div>;
          })}
        </div>
        <div style={{display:"flex",flexDirection:"column",gap:10,width:"100%",maxWidth:420}}>
          {DRAFT_MODES.map(function(m){
            return React.createElement("div",{key:m.id,
              onClick:function(){
                try{
                setFoSetupStaff([]);setFoSetupCandidates(null); // v80.2: reset FO setup state
                setPendingDraftMode({type:m.type,depth:m.depth}); // v80.2: stash the chosen mode
                setScreen("foExplain"); // v80.6: show FO explainer before hiring
                }catch(e2){console.error("Draft mode click error:",e2);alert("Draft mode error: "+e2.message);}
              },
              style:mS(S.card,{border:"2px solid "+(m.recommended?"rgba(251,191,36,0.8)":m.border),padding:m.recommended?18:16,cursor:"pointer",display:"flex",gap:14,alignItems:"center",transition:"all 0.15s ease",background:m.recommended?"rgba(251,191,36,0.06)":undefined,position:"relative",overflow:"hidden"})},
              // v95: RECOMMENDED ribbon for Instant Start (ChatGPT UX pattern)
              m.recommended&&React.createElement("div",{style:{position:"absolute",top:0,right:0,background:T.gold,color:"#0f172a",fontSize:8,fontWeight:900,padding:"3px 10px",borderBottomLeftRadius:8,letterSpacing:1}},"âœ“ RECOMMENDED"),
              React.createElement("div",{style:{fontSize:32,flexShrink:0,width:44,textAlign:"center"}},m.icon),
              React.createElement("div",{style:{flex:1,minWidth:0}},
                React.createElement("div",{style:{fontWeight:800,fontSize:m.recommended?16:15,color:m.recommended?T.gold:(m.border===T.faint?T.dim:m.border)}},m.label),
                React.createElement("div",{style:{fontSize:10,color:T.dim,fontWeight:600,marginTop:1}},m.sub),
                React.createElement("div",{style:{fontSize:10,color:T.faint,marginTop:4,lineHeight:1.4}},m.desc),
                React.createElement("div",{style:{display:"flex",gap:12,marginTop:6,fontSize:9,color:T.faint}},
                  React.createElement("span",null,m.time),
                  m.diff!=="â€”"&&React.createElement("span",null,"Depth: "+m.diff)
                )
              )
            );
          })}
        </div>
        <button onClick={function(){setScreen("pick");}} style={mS(S.btn,S.btnGhost,{marginTop:16,padding:"8px 20px"})}>{"â† Back to team select"}</button>
      </div>
    );
  }
  if(screen==="gameGuide"){
    var ggTeam=TD[expTeamIdx];
    var gg_pdm=pendingDraftMode||{type:"snake",depth:53};
    function goTab(id){setGgTab(id);setGgScrolled(false);} // v80.5: tab change always resets scroll hint
    function ggLaunch(){
      if(gg_pdm.type==="quick"){createLeague(expTeamIdx,true);}
      else if(gg_pdm.type==="auction"){initExpAuctionDraft(expTeamIdx,gg_pdm.depth);}
      else{initExpSnakeDraft(expTeamIdx,gg_pdm.depth);}
    }
    var ggSections=[
      {
        id:"basics",icon:"ðŸˆ",title:"Core Operations",color:"#fbbf24",
        items:[
          {icon:"ðŸ“…",label:"Sim Week",desc:"Your primary control. Each click advances one week â€” your game simulates (with Game Day flow: pre-game speech â†’ halftime adjustment â†’ postgame locker room), stats update, news drops, and the MFSN Weekly Show triggers. You control the pace of your dynasty."},
          {icon:"ðŸŽ¯",label:"OVR, POT & Dev Traits",desc:"OVR = current ability (0â€“99). POT = development ceiling. Dev Traits multiply growth speed: ðŸŒŸ Superstar (1.5Ã—), â­ Star (1.2Ã—), Normal (1Ã—). A 68 OVR / 90 POT Superstar rookie will be elite within 2 seasons. Always prioritize POT and Dev Trait over current OVR."},
          {icon:"ðŸ“‹",label:"Depth Chart & Starters",desc:"Players only earn XP, stats, and development progress if they're on the field as starters. Keep your best players at the top of the depth chart. Position Battles during Training Camp auto-detect competition and award dev boosts to winners."},
          {icon:"ðŸ§¬",label:"Personality Traits (Up to 3)",desc:"Every player has up to 3 Personality Traits that affect gameplay and chemistry. Key traits: âš¡ Clutch, Â©ï¸ Captain (boosts team), ðŸ’ª Workhorse (faster dev), ðŸ›¡ï¸ Ironman (durability), â˜ ï¸ Cancer (avoid â€” hurts morale), ðŸ’€ Glass (injury-prone). Trait combos create unique players."},
          {icon:"ðŸ’¾",label:"Saving & Keyboard",desc:"Auto-saves every 60 seconds. Ctrl+S for manual save. Keyboard shortcuts: D = Dashboard, R = Roster, G = Trade, O = Office. Import/Export saves from Settings to back up your dynasty."},
          {icon:"ðŸ’°",label:"Salary Cap ($255M)",desc:"The cap starts at $255M and grows ~5%/year. Cap = All Player Salaries + Dead Money. Tools: Restructure (immediate relief, future risk), Backload (push hits forward), Franchise Tag (retain 1 player/year at premium). Go over the cap and you can't sign anyone."}
        ]
      },
      {
        id:"gameday",icon:"ðŸˆ",title:"Game Day Operations",color:"#ef4444",
        items:[
          {icon:"ðŸŽ¤",label:"Pre-Game Speech",desc:"Before every regular season game, choose from 3-4 speeches. ðŸ”¥ Fire Them Up (+3 morale, +1 chem, turnover risk), ðŸ§  Lock In (+1 morale, +2 chem, fewer turnovers), ðŸ’ª Make It Personal (+4 morale, -1 chem, injury risk). Context variants: âš”ï¸ Rivalry Speech (heated rivalries), ðŸ† Championship Mentality (playoffs), ðŸ˜¤ Back Against the Wall (losing record)."},
          {icon:"ðŸŽ¬",label:"Halftime Adjustments",desc:"After your speech, pick a 2nd-half strategy. Effects STACK with your speech: ðŸ“‹ Stay Course (steady), âš¡ Open It Up (+scoring, +turnover risk), ðŸƒ Control Clock (ball control), ðŸš¨ Desperation (down 14+, max aggression), ðŸ›¡ï¸ Protect Lead (up 14+, conservative), â±ï¸ Two-Minute Specialist (close games, clutch boost)."},
          {icon:"ðŸšª",label:"Post-Game Locker Room",desc:"After simulation, your star players and young players react to the result. Mood ranges from 'Euphoric' (blowout win) to 'Devastated' (blowout loss). Rivalry wins trigger trophy celebration quotes. This brings your franchise to life."},
          {icon:"ðŸ“º",label:"Game of the Week",desc:"Each week's best matchup is nationally televised. If your game is selected: +$3M bonus revenue, +2 morale boost, and a 'ðŸ“º NATIONALLY TELEVISED' banner. Selection based on combined records and rivalry heat."},
          {icon:"ðŸ’¡",label:"Optimal Combos",desc:"Safe grind: Lock In + Control Clock. Max aggression: Fire Them Up + Open It Up. Rivalry special: Rivalry Speech + any. Skip speech defaults to Lock In effect. Match approach to roster personality â€” aggressive teams benefit more from aggressive speeches."}
        ]
      },
      {
        id:"hub",icon:"ðŸ ",title:"Hub â€” Command Center",color:"#22d3ee",
        items:[
          {icon:"ðŸ ",label:"Home Dashboard",desc:"Your weekly command center. Shows: live power rankings, this week's matchup preview with opponent scout report, practice focus selector, halftime plan preset, injury report, system knowledge meter, rivalry atmosphere banner, and Game of the Week status. Check every week before simming."},
          {icon:"ðŸ“¬",label:"Inbox & MFSN",desc:"Two critical feeds: (1) Inbox â€” owner mandates, player holdout demands, staff requests, trade deadline alerts, and league news. Some require decisions. (2) MFSN Weekly Show â€” 3 rotating anchors (Marcus Cole, Diana Chen, Big Trev) deliver Headlines, Power Rankings, Your Team analysis, Storylines, Hot Seat Watch, Rivalry Watch, and a Press Conference."},
          {icon:"ðŸ—“ï¸",label:"Schedule & Calendar",desc:"Full season view with opponent quality ratings, projected W-L, and the playoff picture. Key dates: Week 8 (trade deadline warning), Week 10 (deadline), Week 14-17 (playoff push). League Calendar events trigger automatically."},
          {icon:"ðŸ“°",label:"MFSN Broadcast",desc:"Post-game Broadcast Breakdown: 3 Keys to Victory (pocket protection, coverage, run game, turnovers, red zone), Turning Point quarter analysis, Player of the Game. Power rankings update weekly based on win%, point differential, strength of schedule, and momentum."},
          {icon:"ðŸŽ¤",label:"Press Conferences",desc:"After games and drafts, media asks context-aware questions. Your answers affect Morale (team chemistry), Owner Mood (job security), and Chemistry. Being a hothead has consequences â€” but so does being too safe. MFSN Weekly Show press conference is separate and weekly."}
        ]
      },
      {
        id:"team",icon:"ðŸ‘¥",title:"Team â€” Roster Operations",color:"#4ade80",
        items:[
          {icon:"ðŸ“Š",label:"Roster Management",desc:"Your 53-man roster + 16 Practice Squad. Sort by OVR, position, age, contract, or trait. Cut Advisor analyzes every player and recommends drops based on: OVR vs. depth, age/decline trajectory, cap hit vs. production, dead money impact, and trait analysis. Access during camp and offseason."},
          {icon:"ðŸ¤",label:"Free Agency",desc:"Sign FAs with 4 offer types: Pay Up (~95% success, premium price + bonus year), Market (~80%), Lowball (~60%, saves cap), League Min (~40%, 1yr cap-exempt). AI teams compete for top talent. Use Franchise Tag in Re-Sign Phase to lock up your best expiring player before FA opens."},
          {icon:"ðŸ”„",label:"Trade Center",desc:"Available Weeks 1-10 + offseason. Player Shop ('ðŸ›’ Shop' on any card) gets instant AI offers. AI counter-offers with multi-player packages and conditional picks. GM archetypes (Aggressive Trader, Draft Hoarder, Win-Now) affect tendencies. Grudge penalty for re-acquiring cut players."},
          {icon:"ðŸŽ®",label:"Offensive Schemes",desc:"Balanced, West Coast, Air Raid, Power Run, Play Action, Run & Shoot. Each scheme has strengths, weaknesses, and counter matchups. Scheme Fit multiplies/reduces player ratings. Build your roster to fit your scheme, or change schemes to fit your roster. System knowledge compounds with stability."},
          {icon:"ðŸ›¡ï¸",label:"Defensive Schemes",desc:"Balanced D, Cover 2, Blitz Heavy, Run Stuff, Zone Defense, Press Man. Each has counter relationships with offensive schemes. The Scout Report shows your scheme advantage each week. High system knowledge = tighter coverages and fewer blown assignments."},
          {icon:"ðŸ‹ï¸",label:"Training & Practice",desc:"4 weekly focus options: ðŸ” Opponent Scout (fastest system knowledge growth + matchup prep), ðŸ“ˆ Dev Camp (biggest player growth), ðŸ§Š Recovery Week (reduce injury risk, morale boost), ðŸ’ª Full Pads (balanced dev + system knowledge, higher injury risk). Rotate Scout and Pads during season."},
          {icon:"ðŸ˜¤",label:"Holdouts & Morale",desc:"Unhappy stars may hold out for better contracts. Options: negotiate (restructure/extension), stand firm (morale drops), or trade. Holdouts that drag on tank team chemistry. Keep morale high â€” unhappy players decline faster and cause locker room issues."}
        ]
      },
      {
        id:"scouting",icon:"ðŸ”",title:"Scouting & Draft",color:"#60a5fa",
        items:[
          {icon:"ðŸ“Š",label:"Scout Point Economy",desc:"Start each season with 1,000 Scout Points. Earn more: +25 per regular season win, +50 per playoff win, +100 for gym facility upgrade. Points reset each season â€” use them or lose them. Budget wisely across Combine tests and in-season spending."},
          {icon:"ðŸƒ",label:"Combine Tests",desc:"Three test types for draft prospects: Measurables (20-40 pts, reveals speed/strength/motor), Interview (30-50 pts, reveals IQ/scheme fit/traits), Film Study (40-60 pts, reveals true OVR/hands/technique). Film Study is the most valuable â€” it shows actual ability."},
          {icon:"ðŸ›’",label:"Scout Spend Menu",desc:"Beyond the Combine: Opponent Film (game prep bonus), FA Background Check (reveal traits before signing), UDFA Search (discover undrafted gems), Training Boost (accelerate dev), Trade Block Intel (reveals what AI GMs will accept for their players). Each has a point cost."},
          {icon:"ðŸ“º",label:"Draft Day",desc:"7 rounds, 30 teams. Snake order (worst record picks first). Trade picks on the clock with 'ðŸ”„ Trade Pick'. Scouted players show green checkmarks with true ratings. Unscouted players show fuzzy estimates â€” busts and steals hide here."},
          {icon:"ðŸŽ¤",label:"Post-Draft Press Conference",desc:"After your selections, media asks grade-aware questions. High-grade picks (good value) get praise questions. Low-grade picks get scrutiny. Your answers affect morale, chemistry, and owner mood. Deflecting criticism is sometimes smarter than defending a questionable pick."},
          {icon:"ðŸ’Ž",label:"Draft Strategy",desc:"BPA > reaching for need. Prioritize QBs, EDGE, CBs (highest impact + variance). Rounds 1-3: starters. Rounds 4-5: projects. Rounds 6-7: hidden gems. Dev Trait > draft position long-term. A Superstar in Round 3 often outperforms a Normal in Round 1 within 2 seasons."}
        ]
      },
      {
        id:"office",icon:"ðŸ¢",title:"Office â€” Franchise Ops",color:"#f97316",
        items:[
          {icon:"ðŸ’°",label:"Cap Lab",desc:"Unlocks Week 3. Full salary cap dashboard: current usage, dead money breakdown, contract years, restructure options, backload tools. Restructure converts salaryâ†’bonus for immediate relief (adds future dead money). Backload pushes hits to future years. Never restructure more than 2 per offseason."},
          {icon:"ðŸ“’",label:"Ledger & History",desc:"Unlocks Season 4. Complete financial history â€” every signing, cut, trade, dead cap hit, and restructure. Accountability for every dollar. Use it to identify patterns: are you overpaying at WR? Cutting too many high-bonus players?"},
          {icon:"ðŸ¤µ",label:"Owner Relations",desc:"Owner Mood (0-99): 70+ = thrilled (budget increases), 50-69 = satisfied, 30-49 = concerned (mandates get tougher), 15-29 = ultimatum (meet next mandate or fired), below 15 = FIRED. Owner types: Patient, Meddler, Win-Now. Mandates: periodic objectives for goodwill."},
          {icon:"ðŸŽ“",label:"Coaching Carousel",desc:"Hire/fire OC (Offensive Coordinator) and DC (Defensive Coordinator). Coordinators affect scheme effectiveness and player dev rates. Stability matters â€” mid-season coaching changes disrupt system knowledge. Coaching Clinic: XP-based perk tree (Leadership, Analytics, Development, Conditioning)."},
          {icon:"ðŸŸï¸",label:"Franchise Relocation",desc:"After 3+ seasons with $30M+ cash: relocate to 10 cities (London, Mexico City, Toronto, Austin, Portland, St. Louis, Orlando, Las Cruces, Honolulu, Berlin). Each has unique market/prestige mods. Cost: $30-55M. 5-year cooldown. Resets stadium to level 1, temporary morale/chem hit."},
          {icon:"ðŸ—ï¸",label:"Stadium & Naming Rights",desc:"Stadium Naming Rights: 3 random corporate sponsor deals each season. Deals pay weekly revenue during the regular season (17 weeks). Revenue varies Â±20% by deal. Deals expire at season rollover. Facilities: upgrade stadium, training complex, scouting infrastructure for dev/scouting bonuses."}
        ]
      },
      {
        id:"legacy",icon:"ðŸ†",title:"Legacy â€” Dynasty Building",color:"#fbbf24",
        items:[
          {icon:"ðŸ“Š",label:"Dynasty Dashboard",desc:"Your Legacy Score: composite grade on 6 dimensions â€” Win%, Championships, Playoff Appearances, Draft Hits, Cap Management, and Player Development. Tiers from Rookie to Legend. Coaching stability bonus (+3 at 5 years, +5 at 8). Era bonus (+5 for 2 rings in 5 years, +8 for 3 rings in 8)."},
          {icon:"ðŸŽ¯",label:"12 Career Milestones",desc:"First Victory, Playoff Bound, Championship, Dynasty (3+ rings), 50 Wins, 100 Wins, Cap Wizard, Talent Factory, Player Whisperer, Integrity, Decade, HoF GM. Each milestone earned adds to your legacy. Displayed as achieved/unachieved grid on Legacy tab."},
          {icon:"â³",label:"Dynasty Timeline & Eras",desc:"Auto-generated season-by-season history: record, awards, HoF inductions, key stats. Era Detection groups consecutive championships into named eras: 'The Dynasty' (3+ rings within 3 years), 'The Run' (2+ rings within 3 years). Era cards display with highlights."},
          {icon:"ðŸ…",label:"Hall of Fame",desc:"Unlocks Season 6 or after a title. Retired legends with high legacy scores get inducted. Players need 10+ seasons and dominant stats. Induction speeches reference real franchise moments. Building HoF careers requires long-term player development commitment."},
          {icon:"âš”ï¸",label:"Rivalries & Trophies",desc:"Rivalries build organically (0-100 heat). At 60+: trophy auto-generates (8 templates: Cup, Bell, Boot, Founders Trophy, Axe, Shield, Flame, Hammer). Trophy changes hands each game. Rivalry Week: morale/chem boosts, crowd bonus, MFSN Rivalry Watch. View on âš”ï¸ Rivalries tab under Standings."},
          {icon:"ðŸ“œ",label:"Records & Achievements",desc:"Franchise records: passing yards, rushing yards, TDs, sacks, interceptions, and more. Career achievements fire automatically for milestone stats. Records add dynasty prestige. Chase them intentionally with long-term player development."}
        ]
      },
      {
        id:"tips",icon:"ðŸ’¡",title:"Executive Playbook",color:"#22d3ee",
        items:[
          {icon:"ðŸ—ï¸",label:"Build Through the Draft",desc:"Rookie contracts are 4 years of below-market production. Stack 3-4 good drafts and you'll have a championship window with cap space for 1-2 veteran FA pieces. The draft pipeline is your most valuable asset â€” protect your picks."},
          {icon:"ðŸ§ ",label:"The QB Rule",desc:"Always have a backup QB. Always. One injury to your starter without a viable backup tanks your entire season. Draft a developmental QB in rounds 3-5 every other year. A 65 OVR backup is infinitely better than a 45 OVR emergency starter."},
          {icon:"ðŸ’°",label:"The Cap Cliff",desc:"Never restructure more than 2 contracts per offseason. Never backload more than 3. Dead money compounds â€” one bad year of cap management takes 3 years to recover from. This is the #1 cause of dynasty collapse."},
          {icon:"ðŸŽ®",label:"The Scheme Advantage",desc:"System knowledge compounds with stable schemes. Switching from Air Raid to Power Run resets ~40% of knowledge. Pick a scheme early based on your QB, stick with it, and draft players who fit. Opponent Scout practice accelerates knowledge growth."},
          {icon:"ðŸŽ¤",label:"Game Day Edge",desc:"Pre-game speech + halftime adjustment effects stack. Lock In + Control Clock = safe grind. Fire Them Up + Open It Up = max ceiling. Rivalry Speech is the best speech available â€” only appears in heated rivalry games. Match approach to roster personality."},
          {icon:"ðŸ·ï¸",label:"Franchise Tag Strategy",desc:"One tag per offseason on your best expiring player. Plan tags a season ahead â€” identify who's expiring next year and budget for the premium salary (~120% of position average). It's expensive but cheaper than losing a star to the open market."},
          {icon:"âš”ï¸",label:"Trophy Chase",desc:"Rivalry trophies and dynasty milestones compound your Legacy Score. Defend trophies, earn milestones, maintain coaching stability. A 'Dynasty' era (3+ consecutive rings) adds +8 legacy points â€” the difference between 'Great' and 'Legend' tier."},
          {icon:"ðŸ“ˆ",label:"Development Pipeline",desc:"High POT > High OVR for dynasty building. A 72/94 22-year-old beats an 85/72 31-year-old every time. Superstar dev trait is the most valuable thing in the game. Target it in every draft. Train young players with Dev Camp practice and keep them in the starting lineup."},
          {icon:"â±ï¸",label:"Position Decline Curves",desc:"RBs peak 23-27, steep decline after. CBs peak 23-28. QBs and OL age gracefully into mid-30s. Never give a 29-year-old RB a 4-year deal. Plan roster construction around these curves â€” draft young skill players, sign veteran OL/QB."}
        ]
      }
    ];
    return React.createElement("div",{style:{height:"100vh",overflow:"hidden",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",display:"flex",flexDirection:"column"}},
      React.createElement("div",{style:{background:T.bg2,borderBottom:"2px solid rgba(251,191,36,0.25)",padding:"12px 20px",position:"sticky",top:0,zIndex:20,display:"flex",justifyContent:"space-between",alignItems:"center"}},
        React.createElement("div",null,
          React.createElement("div",{style:{fontSize:8,fontWeight:800,letterSpacing:3,color:"rgba(251,191,36,0.5)",textTransform:"uppercase",marginBottom:2}},"Operations Manual"),
          React.createElement("div",{style:{fontSize:20,fontWeight:900,color:"#fbbf24"}},"GM Playbook")
        ),
        ggTeam&&React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
          React.createElement("div",{style:{textAlign:"right"}},
            React.createElement("div",{style:{fontSize:11,color:T.dim}},ggTeam.city),
            React.createElement("div",{style:{fontSize:13,fontWeight:800,color:T.gold}},ggTeam.icon+" "+ggTeam.name)
          )
        )
      ),
      React.createElement("div",{style:{display:"flex",overflowX:"auto",gap:2,padding:"10px 16px 0",background:T.bg2,borderBottom:"1px solid "+T.border,flexShrink:0}},
        ggSections.map(function(sec){
          var isActive=ggTab===sec.id;
          return React.createElement("div",{key:sec.id,
            onClick:function(){goTab(sec.id);},
            style:{display:"flex",alignItems:"center",gap:5,padding:"8px 12px",borderRadius:"8px 8px 0 0",cursor:"pointer",flexShrink:0,
              background:isActive?"rgba(251,191,36,0.08)":"transparent",
              borderBottom:isActive?"2px solid "+sec.color:"2px solid transparent",
              transition:"all 0.15s"}},
            React.createElement("span",{style:{fontSize:14}},sec.icon),
            React.createElement("span",{style:{fontSize:10,fontWeight:isActive?800:500,color:isActive?sec.color:T.dim,whiteSpace:"nowrap"}},sec.title)
          );
        })
      ),
      React.createElement("div",{
        style:{flex:1,overflowY:"auto",padding:"16px 16px 240px",position:"relative"},
        onScroll:function(e){if(e.target.scrollTop>20&&!ggScrolled)setGgScrolled(true);}, // v80.5: hide hint once scrolled
        onTouchStart:function(e){ggTouchX.current=e.touches[0].clientX;}, // v80.4: record swipe start
        onTouchEnd:function(e){ // v80.4: detect swipe direction and advance tab
          if(ggTouchX.current===null)return;
          var dx=e.changedTouches[0].clientX-ggTouchX.current;
          ggTouchX.current=null;
          if(Math.abs(dx)<40)return; // ignore micro-swipes
          var ids=ggSections.map(function(s){return s.id;});
          var cur=ids.indexOf(ggTab);
          if(dx<0&&cur<ids.length-1){goTab(ids[cur+1]);} // swipe left â†’ next
          else if(dx>0&&cur>0){goTab(ids[cur-1]);}       // swipe right â†’ prev
        }
      },
        ggSections.filter(function(s){return s.id===ggTab;}).map(function(sec){
          var hasMore=sec.items.length>3; // v80.5
          return React.createElement("div",{key:sec.id},
            React.createElement("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:16}},
              React.createElement("div",{style:{fontSize:28}},sec.icon),
              React.createElement("div",null,
                React.createElement("div",{style:{fontSize:18,fontWeight:900,color:sec.color}},sec.title),
                React.createElement("div",{style:{fontSize:10,color:T.dim}},sec.items.length+" things to know")
              )
            ),
            sec.items.map(function(item,idx){
              return React.createElement("div",{key:"gi"+idx,
                style:{display:"flex",gap:14,padding:"14px 16px",borderRadius:10,marginBottom:10,
                  background:"rgba(255,255,255,0.02)",border:"1px solid "+T.border}},
                React.createElement("div",{style:{fontSize:26,flexShrink:0,width:36,textAlign:"center",paddingTop:2}},item.icon),
                React.createElement("div",{style:{flex:1}},
                  React.createElement("div",{style:{fontSize:13,fontWeight:800,color:T.text,marginBottom:4}},item.label),
                  React.createElement("div",{style:{fontSize:11,color:T.dim,lineHeight:1.6}},item.desc)
                )
              );
            })
          );
        }),
        (function(){
          var sec=ggSections.filter(function(s){return s.id===ggTab;})[0];
          if(!sec||sec.items.length<=3||ggScrolled)return null;
          return React.createElement("div",{
            style:{position:"fixed",bottom:135,left:0,right:0,display:"flex",flexDirection:"column",alignItems:"center",gap:5,zIndex:19,pointerEvents:"none"}},
            React.createElement("div",{style:{
              background:T.bg2,
              borderRadius:20,padding:"5px 14px",
              border:"1px solid "+sec.color+"66",
              fontSize:10,fontWeight:700,color:sec.color,letterSpacing:1,textTransform:"uppercase",pointerEvents:"auto",
              cursor:"pointer"},
              onClick:function(){setGgScrolled(true);}
            },(sec.items.length-3)+" more below  â†“")
          );
        })()
      ),
      React.createElement("div",{style:{position:"fixed",bottom:0,left:0,right:0,padding:"10px 16px 12px",background:T.bg2,borderTop:"1px solid "+T.border,display:"flex",flexDirection:"column",gap:8,zIndex:20}},
        React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8}},
          (function(){
            var ids=ggSections.map(function(s){return s.id;});
            var cur=ids.indexOf(ggTab);
            var hasPrev=cur>0;
            var hasNext=cur<ids.length-1;
            var activeSec=ggSections[cur];
            return React.createElement(React.Fragment,null,
              React.createElement("button",{
                onClick:function(){if(hasPrev)goTab(ids[cur-1]);},
                disabled:!hasPrev,
                style:{background:hasPrev?"rgba(255,255,255,0.08)":"transparent",border:"1px solid "+(hasPrev?T.border:"transparent"),
                  color:hasPrev?T.text:T.border,borderRadius:8,padding:"6px 14px",fontSize:18,cursor:hasPrev?"pointer":"default",
                  transition:"all 0.15s",flexShrink:0}
              },"â€¹"),
              React.createElement("div",{style:{display:"flex",gap:5,alignItems:"center",flex:1,justifyContent:"center"}},
                ggSections.map(function(sec){
                  var isActive=ggTab===sec.id;
                  return React.createElement("div",{key:"dot"+sec.id,
                    onClick:function(){goTab(sec.id);},
                    style:{width:isActive?18:6,height:6,borderRadius:4,cursor:"pointer",transition:"all 0.2s",
                      background:isActive?activeSec.color:T.border}
                  });
                })
              ),
              hasNext
                ? React.createElement("button",{
                    onClick:function(){goTab(ids[cur+1]);},
                    style:{background:"rgba(255,255,255,0.08)",border:"1px solid "+T.border,
                      color:T.text,borderRadius:8,padding:"6px 14px",fontSize:18,cursor:"pointer",
                      transition:"all 0.15s",flexShrink:0}
                  },"â€º")
                : React.createElement("button",{
                    onClick:ggLaunch,
                    style:{background:"linear-gradient(135deg,#fbbf24,#f97316)",border:"none",
                      color:"#000",borderRadius:8,padding:"6px 12px",fontSize:11,fontWeight:800,cursor:"pointer",
                      flexShrink:0,whiteSpace:"nowrap"}
                  },"Draft â†’")
            );
          })()
        ),
        React.createElement("button",{
          onClick:ggLaunch,
          style:{width:"100%",background:"linear-gradient(135deg,#fbbf24,#f97316)",color:"#000",border:"none",borderRadius:10,padding:"14px",fontWeight:900,cursor:"pointer",fontSize:16,letterSpacing:1}
        },"ðŸˆ  LET'S BUILD A DYNASTY â†’"),
        React.createElement("button",{
          onClick:function(){setScreen("foExplain");}, // v80.6: back through explainer
          style:{width:"100%",background:"transparent",color:T.dim,border:"1px solid "+T.border,borderRadius:8,padding:"6px",fontWeight:600,cursor:"pointer",fontSize:11}
        },"â† Back to Front Office")
      )
    );
  }
  if(screen==="foExplain"){
    var foeTeam=TD[expTeamIdx];
    var foeRoles=[
      {id:"gm",icon:"ðŸ‘”",title:"Asst. General Manager",color:T.purple,tier:"core",
        tagline:"Your right hand â€” you're the GM, they execute.",
        what:"You're the GM â€” your Asst. GM handles the day-to-day grind. They negotiate contracts, drive trade strategy, and manage cap logistics. A high-OVR Asst. GM unlocks better trade offers and keeps your cap clean under pressure.",
        affects:["Trade value multiplier","Cap restructure success","Draft pick negotiation"],
        tip:"Conservative GMs avoid blowups. Aggressive ones swing blockbusters. Match their style to your vision."},
      {id:"scout_dir",icon:"ðŸ”",title:"Scouting Director",color:T.cyan,tier:"core",
        tagline:"Find stars before anyone else does.",
        what:"Your Scout Director sharpens the fog-of-war on draft prospects. Higher OVR = tighter estimate ranges on player OVR and POT. Fewer busts, more steals.",
        affects:["Draft prospect OVR accuracy","Combine evaluation range","Bust/steal visibility"],
        tip:"Film scouts see potential. Measurables scouts find raw athleticism. Hire for your draft philosophy."},
      {id:"analytics",icon:"ðŸ“Š",title:"Analytics Coordinator",color:T.green,tier:"core",
        tagline:"Turn data into wins.",
        what:"Your Analytics Coordinator improves game plan efficiency and in-season scouting. They spot opponent tendencies before you do and boost weekly challenge XP.",
        affects:["Game plan effectiveness","Opponent scouting clarity","Weekly XP boost"],
        tip:"Old-school coordinators trust film. Analytical ones squeeze edges. The gap shows in close games."},
      {id:"cap_analyst",icon:"ðŸ’°",title:"Cap Analyst",color:T.gold,tier:"specialist",
        tagline:"Find cap space nobody else can see.",
        what:"A great Cap Analyst restructures contracts to give you breathing room, models extension scenarios, and prevents dead-money disasters when you cut or trade a player.",
        affects:["Cap space discovery","Extension deal quality","Dead cap reduction"],
        tip:"If you're always cap-strapped, a Cap Analyst pays for itself in one offseason."},
      {id:"personnel",icon:"ðŸˆ",title:"Player Personnel Dir.",color:T.orange,tier:"specialist",
        tagline:"Win the waiver wire and UDFA game.",
        what:"Your Personnel Director runs undrafted free agent signings, waiver claims, and depth chart evaluation. Teams with great PDs find 5-star depth players others overlook.",
        affects:["UDFA success rate","Waiver wire priority","Depth evaluation accuracy"],
        tip:"Depth wins championships. A Personnel Dir. fills your practice squad with future starters."},
      {id:"player_relations",icon:"ðŸ¤",title:"Player Relations Mgr.",color:"#ec4899",tier:"specialist",
        tagline:"Keep the locker room together.",
        what:"A Player Relations Manager keeps veterans happy on discounted deals, prevents holdouts from escalating, and maintains chemistry when you make tough roster cuts.",
        affects:["Holdout prevention","Locker room chemistry","Contract loyalty bonus"],
        tip:"Stars with options leave. Stars who feel valued stay. Player Relations is your retention edge."},
      {id:"medstaff",icon:"ðŸ¥",title:"Medical Director",color:"#6ee7b7",tier:"specialist",
        tagline:"Keep your stars on the field.",
        what:"Your Medical Director reduces injury frequency, shortens IR stints, and can implement load management protocols to protect aging veterans through long seasons.",
        affects:["Injury rate reduction","IR recovery time","Load management unlock"],
        tip:"One fewer season-ending injury from your franchise QB pays for this hire every year."}
    ];
    var foeCur=["gm","scout_dir","analytics","cap_analyst","personnel","player_relations","medstaff"].indexOf(foExplainTab);
    if(foeCur<0)foeCur=0;
    var foeRole=foeRoles[foeCur];
    var foeIds=["gm","scout_dir","analytics","cap_analyst","personnel","player_relations","medstaff"];
    function foeGo(id){setFoExplainTab(id);}
    return React.createElement("div",{style:{height:"100vh",overflow:"hidden",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",display:"flex",flexDirection:"column"}}, // v80.8: height not minHeight so flex child scrolls
      React.createElement("div",{style:{background:T.bg2,borderBottom:"2px solid "+T.purple,padding:"12px 20px",display:"flex",justifyContent:"space-between",alignItems:"center"}},
        React.createElement("div",null,
          React.createElement("div",{style:{fontSize:9,fontWeight:700,letterSpacing:4,color:T.dim,textTransform:"uppercase"}},"Meet Your"),
          React.createElement("div",{style:{fontSize:20,fontWeight:900,color:T.purple}},"ðŸ‘” Front Office")
        ),
        foeTeam&&React.createElement("div",{style:{textAlign:"right"}},
          React.createElement("div",{style:{fontSize:11,color:T.dim}},foeTeam.city),
          React.createElement("div",{style:{fontSize:13,fontWeight:800,color:T.gold}},foeTeam.icon+" "+foeTeam.name)
        )
      ),
      React.createElement("div",{style:{display:"flex",background:T.bg2,borderBottom:"1px solid "+T.border}},
        foeRoles.map(function(r){
          var isActive=foExplainTab===r.id;
          return React.createElement("div",{key:r.id,onClick:function(){foeGo(r.id);},
            style:{flex:1,textAlign:"center",padding:"12px 4px",cursor:"pointer",borderBottom:"2px solid "+(isActive?r.color:"transparent"),
              background:isActive?"rgba(168,85,247,0.05)":"transparent",transition:"all 0.15s"}},
            React.createElement("div",{style:{fontSize:20,marginBottom:2}},r.icon),
            React.createElement("div",{style:{fontSize:8,fontWeight:isActive?800:500,color:isActive?r.color:T.dim,lineHeight:1.2}},
              r.tier==="specialist"?React.createElement("span",{style:{display:"block",fontSize:6,color:T.gold,fontWeight:700,marginBottom:1}},"SPEC"):null,
              r.title.replace("Director","Dir.").replace("Coordinator","Coord.").replace("General Manager","GM").replace("Relations","Rel.").replace("Personnel","Personnel").split(" ")[0]
            ) // compact label
          );
        })
      ),
      React.createElement("div",{style:{flex:1,overflowY:"auto",padding:"20px 20px 240px"},
        onTouchStart:function(e){ggTouchX.current=e.touches[0].clientX;},
        onTouchEnd:function(e){
          if(ggTouchX.current===null)return;
          var dx=e.changedTouches[0].clientX-ggTouchX.current;
          ggTouchX.current=null;
          if(Math.abs(dx)<40)return;
          if(dx<0&&foeCur<foeIds.length-1){foeGo(foeIds[foeCur+1]);}
          else if(dx>0&&foeCur>0){foeGo(foeIds[foeCur-1]);}
        }
      },
        React.createElement("div",{style:{textAlign:"center",marginBottom:24}},
          React.createElement("div",{style:{fontSize:52,marginBottom:8}},foeRole.icon),
          React.createElement("div",{style:{fontSize:22,fontWeight:900,color:foeRole.color,marginBottom:4}},foeRole.title),
          React.createElement("div",{style:{fontSize:13,color:T.dim,fontStyle:"italic"}},foeRole.tagline)
        ),
        React.createElement("div",{style:{padding:"16px",borderRadius:12,background:"rgba(255,255,255,0.02)",border:"1px solid "+T.border,marginBottom:16}},
          React.createElement("div",{style:{fontSize:10,fontWeight:700,color:foeRole.color,letterSpacing:2,textTransform:"uppercase",marginBottom:8}},"What They Do"),
          React.createElement("div",{style:{fontSize:12,color:T.text,lineHeight:1.7}},foeRole.what)
        ),
        React.createElement("div",{style:{padding:"16px",borderRadius:12,background:"rgba(255,255,255,0.02)",border:"1px solid "+T.border,marginBottom:16}},
          React.createElement("div",{style:{fontSize:10,fontWeight:700,color:foeRole.color,letterSpacing:2,textTransform:"uppercase",marginBottom:10}},"Boosts"),
          foeRole.affects.map(function(a,ai){
            return React.createElement("div",{key:"fa"+ai,style:{display:"flex",alignItems:"center",gap:10,marginBottom:8}},
              React.createElement("div",{style:{width:6,height:6,borderRadius:"50%",background:foeRole.color,flexShrink:0}}),
              React.createElement("div",{style:{fontSize:12,color:T.text}},a)
            );
          })
        ),
        React.createElement("div",{style:{padding:"14px 16px",borderRadius:12,background:"rgba(251,191,36,0.05)",border:"1px solid rgba(251,191,36,0.2)",display:"flex",gap:12,alignItems:"flex-start"}},
          React.createElement("div",{style:{fontSize:18,flexShrink:0}},"ðŸ’¡"),
          React.createElement("div",null,
            React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.gold,letterSpacing:2,textTransform:"uppercase",marginBottom:4}},"Pro Tip"),
            React.createElement("div",{style:{fontSize:12,color:T.dim,lineHeight:1.6}},foeRole.tip)
          )
        )
      ),
      React.createElement("div",{style:{position:"fixed",bottom:0,left:0,right:0,padding:"10px 16px 12px",background:T.bg2,borderTop:"1px solid "+T.border,display:"flex",flexDirection:"column",gap:8,zIndex:20}},
        React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8}},
          React.createElement("button",{
            onClick:function(){if(foeCur>0)foeGo(foeIds[foeCur-1]);},
            disabled:foeCur===0,
            style:{background:foeCur>0?"rgba(255,255,255,0.08)":"transparent",border:"1px solid "+(foeCur>0?T.border:"transparent"),color:foeCur>0?T.text:T.border,borderRadius:8,padding:"6px 14px",fontSize:18,cursor:foeCur>0?"pointer":"default"}
          },"â€¹"),
          React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",flex:1,justifyContent:"center"}},
            foeRoles.map(function(r){
              var isActive=foExplainTab===r.id;
              return React.createElement("div",{key:"foedot"+r.id,onClick:function(){foeGo(r.id);},
                style:{width:isActive?18:6,height:6,borderRadius:4,cursor:"pointer",transition:"all 0.2s",
                  background:isActive?r.color:T.border}
              });
            })
          ),
          foeCur<foeIds.length-1
            ? React.createElement("button",{
                onClick:function(){foeGo(foeIds[foeCur+1]);},
                style:{background:"rgba(255,255,255,0.08)",border:"1px solid "+T.border,color:T.text,borderRadius:8,padding:"6px 14px",fontSize:18,cursor:"pointer"}
              },"â€º")
            : React.createElement("button",{
                onClick:function(){setScreen("foSetup");},
                style:{background:"linear-gradient(135deg,"+T.purple+",#7c3aed)",border:"none",color:"#fff",borderRadius:8,padding:"6px 12px",fontSize:11,fontWeight:800,cursor:"pointer",whiteSpace:"nowrap"}
              },"Hire â†’")
        ),
        React.createElement("button",{
          onClick:function(){setScreen("foSetup");},
          style:{width:"100%",background:"linear-gradient(135deg,#a855f7,#7c3aed)",color:"#fff",border:"none",borderRadius:10,padding:"14px",fontWeight:900,cursor:"pointer",fontSize:15}
        },"ðŸ‘”  BUILD YOUR FRONT OFFICE â†’"),
        React.createElement("button",{
          onClick:function(){setScreen("draftMode");},
          style:{width:"100%",background:"transparent",color:T.dim,border:"1px solid "+T.border,borderRadius:8,padding:"6px",fontWeight:600,cursor:"pointer",fontSize:11}
        },"â† Back to Draft Mode")
      )
    );
  }
  if(screen==="music"){
    var TRACK_META=AUDIO.trackMeta();// v93.6: pulled from AUDIO scope
    var VIBES=["All","Anthem","Electronic","Groove","Chill","Downtempo","Indie","Indie Rock","Alt Rock","Reggae/Ska","Punk"];
    var VIBE_COLORS={All:T.text,Anthem:T.gold,Electronic:T.cyan,Groove:T.green,Chill:"#a78bfa",Downtempo:T.faint,Indie:T.orange,"Indie Rock":"#fb923c","Alt Rock":"#f87171","Reggae/Ska":"#34d399",Punk:T.red};
    var filteredKeys=musicVibeFilter==="All"?MFD_JUKEBOX_ALL:MFD_JUKEBOX_ALL.filter(function(k){return (TRACK_META[k]||{}).vibe===musicVibeFilter;});
    var activeKey=AUDIO.current&&AUDIO.current();
    return React.createElement("div",{style:{height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif"}},
      React.createElement("div",{style:{background:T.bg2,borderBottom:"2px solid rgba(168,85,247,0.4)",padding:"12px 16px",display:"flex",alignItems:"center",gap:10,flexShrink:0}},
        React.createElement("button",{style:{background:"rgba(255,255,255,0.06)",border:"1px solid "+T.border,borderRadius:8,color:T.dim,fontSize:13,padding:"5px 11px",cursor:"pointer",flexShrink:0},onClick:function(){setScreen("league");}},"<- Back"),
        React.createElement("div",{style:{flex:1}},
          React.createElement("div",{style:{fontSize:9,fontWeight:700,letterSpacing:3,color:T.faint,textTransform:"uppercase"}},"Mr. Football Dynasty"),
          React.createElement("div",{style:{fontSize:18,fontWeight:900,color:T.purple}},"Jukebox")
        ),
        React.createElement("div",{style:{display:"flex",gap:6}},
          React.createElement("button",{style:{padding:"6px 12px",borderRadius:8,fontSize:11,fontWeight:700,cursor:"pointer",background:audioMuted?"rgba(239,68,68,0.15)":"rgba(16,185,129,0.15)",color:audioMuted?T.red:T.green,border:"1px solid "+(audioMuted?"rgba(239,68,68,0.3)":"rgba(16,185,129,0.3)")},onClick:function(){var m=AUDIO.toggle();setAudioMuted(m);}},audioMuted?"Unmute":"Mute"),
          !audioMuted&&React.createElement("button",{style:{padding:"6px 12px",borderRadius:8,fontSize:11,fontWeight:700,cursor:"pointer",background:"rgba(255,255,255,0.06)",color:T.dim,border:"1px solid "+T.border},onClick:function(){AUDIO.next();}},"Skip")
        )
      ),
      React.createElement("div",{style:{flexShrink:0,padding:"14px 16px 10px",background:"rgba(168,85,247,0.06)",borderBottom:"1px solid rgba(168,85,247,0.15)"}},
        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:10}},
          React.createElement("div",{style:{width:8,height:8,borderRadius:"50%",flexShrink:0,background:audioMuted?"rgba(255,255,255,0.15)":T.purple,boxShadow:audioMuted?"none":"0 0 8px "+T.purple+",0 0 16px rgba(168,85,247,0.4)"}}),
          React.createElement("div",{style:{flex:1,minWidth:0}},
            React.createElement("div",{style:{fontSize:9,fontWeight:700,letterSpacing:2,color:T.faint,textTransform:"uppercase",marginBottom:2}},"Now Playing"),
            React.createElement("div",{style:{fontSize:15,fontWeight:800,color:audioMuted?T.dim:T.text,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},audioMuted?"-- Muted --":(nowPlaying||"Nothing playing")),
            (function(){var meta=activeKey?TRACK_META[activeKey]:null;if(!meta||audioMuted)return null;return React.createElement("div",{style:{fontSize:9,color:T.faint,marginTop:2}},meta.emoji+" "+meta.mood+" Â· "+meta.vibe+" Â· "+meta.bpmLabel+" BPM");})()
          ),
          React.createElement("div",{style:{textAlign:"center",flexShrink:0}},
            React.createElement("div",{style:{fontSize:16,fontWeight:900,color:T.purple}},userPlaylist.length),
            React.createElement("div",{style:{fontSize:7,color:T.faint,letterSpacing:1,textTransform:"uppercase"}},"in shuffle")
          )
        ),
        React.createElement("div",{style:{marginTop:10,padding:"8px 10px",borderRadius:8,background:gamedayTrack?"rgba(251,191,36,0.08)":"rgba(255,255,255,0.03)",border:"1px solid "+(gamedayTrack?"rgba(251,191,36,0.25)":"rgba(255,255,255,0.06)"),display:"flex",alignItems:"center",gap:8}},
          React.createElement("span",{style:{fontSize:12}},"[football]"),
          React.createElement("div",{style:{flex:1,fontSize:9}},
            React.createElement("span",{style:{fontWeight:700,color:T.gold,marginRight:4}},"GAMEDAY TRACK"),
            React.createElement("span",{style:{color:T.faint}},gamedayTrack?"\""+AUDIO.getName(gamedayTrack)+"\" plays every game week":"Auto -- uses context music")
          ),
          gamedayTrack&&React.createElement("button",{style:{fontSize:8,padding:"2px 7px",borderRadius:4,cursor:"pointer",background:"rgba(239,68,68,0.1)",color:T.red,border:"1px solid rgba(239,68,68,0.3)"},onClick:function(){setGamedayTrack(null);}},"X Clear")
        )
      ),
      React.createElement("div",{style:{flexShrink:0,display:"flex",gap:0,overflowX:"auto",WebkitOverflowScrolling:"touch",borderBottom:"1px solid "+T.border,background:"rgba(0,0,0,0.2)"}},
        VIBES.map(function(v){
          var isActive=musicVibeFilter===v;
          var vc=VIBE_COLORS[v]||T.text;
          var cnt=v==="All"?MFD_JUKEBOX_ALL.length:MFD_JUKEBOX_ALL.filter(function(k){return (TRACK_META[k]||{}).vibe===v;}).length;
          return React.createElement("div",{key:v,onClick:function(){setMusicVibeFilter(v);},style:{padding:"9px 14px",fontSize:10,fontWeight:isActive?800:500,color:isActive?vc:T.dim,cursor:"pointer",flexShrink:0,borderBottom:"2px solid "+(isActive?vc:"transparent"),background:isActive?"rgba(255,255,255,0.04)":"transparent",transition:"all 0.15s",whiteSpace:"nowrap"}},
            v+(cnt<MFD_JUKEBOX_ALL.length?" ("+cnt+")":"")
          );
        })
      ),
      React.createElement("div",{style:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",padding:"12px 12px 40px"}},
        React.createElement("div",{style:{display:"flex",gap:6,marginBottom:10,alignItems:"center"}},
          React.createElement("div",{style:{flex:1,fontSize:9,color:T.faint}},filteredKeys.filter(function(k){return userPlaylist.indexOf(k)>=0;}).length+"/"+filteredKeys.length+" selected"),
          React.createElement("button",{style:{fontSize:9,padding:"4px 10px",borderRadius:6,cursor:"pointer",background:"rgba(96,165,250,0.12)",color:T.cyan,border:"1px solid rgba(96,165,250,0.3)",fontWeight:700},onClick:function(){setUserPlaylist(function(prev){var m=prev.slice();filteredKeys.forEach(function(k){if(m.indexOf(k)<0)m.push(k);});return m;});}},"+All"),
          React.createElement("button",{style:{fontSize:9,padding:"4px 10px",borderRadius:6,cursor:"pointer",background:"rgba(239,68,68,0.08)",color:T.red,border:"1px solid rgba(239,68,68,0.2)",fontWeight:700},onClick:function(){setUserPlaylist(function(prev){return prev.filter(function(k){return filteredKeys.indexOf(k)<0;});});}},"- All")
        ),
        React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}},
          filteredKeys.map(function(key){
            var meta=TRACK_META[key]||{emoji:"[note]",vibe:"",mood:"",bpmLabel:""};
            var inList=userPlaylist.indexOf(key)>=0;
            var isPinned=gamedayTrack===key;
            var isPlaying=!audioMuted&&activeKey===key;
            var vc=VIBE_COLORS[meta.vibe]||T.text;
            return React.createElement("div",{key:key,
              style:{borderRadius:12,padding:"10px 10px 8px",border:"2px solid "+(isPlaying?vc:inList?"rgba(96,165,250,0.4)":"rgba(255,255,255,0.07)"),background:isPlaying?"rgba(168,85,247,0.12)":inList?"rgba(96,165,250,0.06)":"rgba(255,255,255,0.02)",opacity:inList?1:0.5,cursor:"pointer",position:"relative",transition:"all 0.15s",boxShadow:isPlaying?"0 0 12px rgba(168,85,247,0.25)":"none"},
              onClick:function(){setUserPlaylist(function(prev){if(prev.indexOf(key)>=0)return prev.filter(function(k){return k!==key;});return prev.concat([key]);});}},
              React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:4}},
                React.createElement("span",{style:{fontSize:22}},meta.emoji),
                React.createElement("div",{style:{display:"flex",gap:3,flexDirection:"column",alignItems:"flex-end"}},
                  isPlaying&&React.createElement("span",{style:{fontSize:7,padding:"1px 5px",borderRadius:3,fontWeight:800,background:"rgba(168,85,247,0.25)",color:T.purple,border:"1px solid rgba(168,85,247,0.4)"}},"NOW"),
                  isPinned&&React.createElement("span",{style:{fontSize:7,padding:"1px 5px",borderRadius:3,fontWeight:800,background:"rgba(251,191,36,0.2)",color:T.gold,border:"1px solid rgba(251,191,36,0.3)"}},"GAME DAY")
                )
              ),
              React.createElement("div",{style:{fontSize:10,fontWeight:800,color:isPlaying?T.purple:inList?T.text:T.dim,lineHeight:1.2,marginBottom:2}},AUDIO.getName(key)),
              React.createElement("div",{style:{fontSize:8,color:T.faint,marginBottom:6,lineHeight:1.3}},meta.mood),
              React.createElement("div",{style:{display:"flex",gap:4,alignItems:"center"}},
                React.createElement("span",{style:{fontSize:7,padding:"2px 5px",borderRadius:4,background:"rgba(255,255,255,0.05)",color:T.faint,border:"1px solid rgba(255,255,255,0.08)",flexShrink:0}},meta.bpmLabel),
                React.createElement("button",{style:{flex:1,fontSize:9,padding:"4px 0",borderRadius:6,cursor:"pointer",background:isPlaying?"rgba(168,85,247,0.2)":"rgba(96,165,250,0.12)",color:isPlaying?T.purple:T.cyan,border:"1px solid "+(isPlaying?"rgba(168,85,247,0.35)":"rgba(96,165,250,0.25)"),fontWeight:700},
                  onClick:function(e){e.stopPropagation();if(audioMuted){AUDIO.toggle();setAudioMuted(false);setTimeout(function(){AUDIO.play(key);},50);}else{AUDIO.play(key);}}
                },isPlaying?"| | Stop":"Play"),
                React.createElement("button",{style:{fontSize:9,padding:"4px 6px",borderRadius:6,cursor:"pointer",flexShrink:0,background:isPinned?"rgba(251,191,36,0.2)":"rgba(255,255,255,0.05)",color:isPinned?T.gold:T.faint,border:"1px solid "+(isPinned?"rgba(251,191,36,0.4)":"rgba(255,255,255,0.1)")},
                  onClick:function(e){e.stopPropagation();setGamedayTrack(isPinned?null:key);}
                },"[pin]")
              ),
              React.createElement("div",{style:{marginTop:5,fontSize:7,fontWeight:700,textAlign:"center",color:inList?T.cyan:T.faint}},inList?"IN SHUFFLE":"OFF")
            );
          })
        )
      )
    );
  }
  if(screen==="foSetup"){
    var foSelTeam=TD[expTeamIdx];
    var foAllRoles=FRONT_OFFICE.roles;
    var foOpenRoles=foAllRoles.filter(function(r){return!foSetupStaff.some(function(s){return s.roleId===r.id;});});
    var foBudgetMax=(DIFF_SETTINGS[difficulty]||DIFF_SETTINGS.pro).foBudget||9;
    var foSpent=foSetupStaff.reduce(function(sum,s){return sum+(s.salary||0);},0);
    var foRemaining=Math.round((foBudgetMax-foSpent)*10)/10;
    var foBudgetPct=Math.min(1,foSpent/foBudgetMax);
    var foBudgetColor=foBudgetPct>0.9?T.red:foBudgetPct>0.7?T.orange:T.green;
    function foSetupLaunch(){
      setFrontOffice78(foSetupStaff.slice()); // v80.2: commit hired staff into main state
      setFoSetupCandidates(null);
      setScreen("gameGuide"); // v80.3: show instructions before draft
    }
    return React.createElement("div",{style:{minHeight:"100vh",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",padding:20}},
      React.createElement("div",{style:{textAlign:"center",marginBottom:12}},
        React.createElement("div",{style:{fontSize:11,fontWeight:700,letterSpacing:4,color:T.dim,textTransform:"uppercase",marginBottom:4}},"Build Your"),
        React.createElement("div",{style:{fontSize:24,fontWeight:900,color:T.purple}},"Front Office"),
        React.createElement("div",{style:{color:T.faint,fontSize:11,marginTop:4}},"Hire your staff before the inaugural draft â€” or skip and hire later."),
        foSelTeam&&React.createElement("div",{style:{fontSize:12,color:T.gold,marginTop:6,fontWeight:700}},foSelTeam.icon+" "+foSelTeam.city+" "+foSelTeam.name)
      ),
      React.createElement("div",{style:{marginBottom:14,padding:"10px 12px",borderRadius:10,
        background:"rgba(0,0,0,0.3)",border:"1px solid "+(foBudgetColor+"44")}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
          React.createElement("div",{style:{fontSize:10,fontWeight:800,color:T.dim,letterSpacing:1,textTransform:"uppercase"}},
            "ðŸ’¼ FO Budget"),
          React.createElement("div",{style:{display:"flex",gap:8,alignItems:"baseline"}},
            React.createElement("span",{style:{fontSize:13,fontWeight:900,color:foBudgetColor}},"$"+foSpent.toFixed(1)+"M"),
            React.createElement("span",{style:{fontSize:9,color:T.faint}},"/ $"+foBudgetMax+"M"),
            React.createElement("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:4,fontWeight:700,
              background:foRemaining<=0?"rgba(239,68,68,0.15)":"rgba(16,185,129,0.1)",
              color:foRemaining<=0?T.red:T.green}}),
            foRemaining>0?React.createElement("span",{style:{fontSize:9,color:T.green,fontWeight:700}},"$"+foRemaining.toFixed(1)+"M left"):
              React.createElement("span",{style:{fontSize:9,color:T.red,fontWeight:700}},"â›” MAXED")
          )
        ),
        React.createElement("div",{style:{height:6,borderRadius:3,background:"rgba(255,255,255,0.08)",overflow:"hidden"}},
          React.createElement("div",{style:{height:"100%",borderRadius:3,
            background:foBudgetColor,
            width:Math.min(100,Math.round(foBudgetPct*100))+"%",
            transition:"width 0.3s"}})
        ),
        React.createElement("div",{style:{fontSize:8,color:T.faint,marginTop:5}},
          (DIFF_SETTINGS[difficulty]||DIFF_SETTINGS.pro).name+" difficulty â€” elite hires cost $5â€“10M. Budget forces real tradeoffs."
        )
      ),
      foSetupStaff.length>0&&React.createElement("div",{style:{marginBottom:12}},
        React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.green,marginBottom:6,letterSpacing:2,textTransform:"uppercase"}},"âœ… Hired"),
        foSetupStaff.map(function(s78,si78){
          return React.createElement("div",{key:"foss"+si78,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:8,marginBottom:6,background:"rgba(16,185,129,0.05)",border:"1px solid rgba(16,185,129,0.2)"}},
            React.createElement("div",{style:{flex:1}},
              React.createElement("div",{style:{fontSize:12,fontWeight:700}},s78.icon+" "+s78.name),
              React.createElement("div",{style:{fontSize:10,color:T.dim}},s78.title+" â€¢ "+s78.trait+" â€¢ $"+s78.salary+"M/yr")
            ),
            React.createElement("div",{style:{display:"flex",alignItems:"center",gap:10}},
              React.createElement("div",{style:{textAlign:"center"}},
                React.createElement("div",{style:{fontSize:20,fontWeight:900,color:s78.ovr>=80?T.green:s78.ovr>=65?T.gold:s78.ovr>=50?T.orange:T.red}},s78.ovr),
                React.createElement("div",{style:{fontSize:7,color:T.faint,marginTop:1}},"OVR")
              ),
              React.createElement("button",{
                onClick:function(e){e.stopPropagation();setFoSetupStaff(foSetupStaff.filter(function(_,idx78){return idx78!==si78;}));setFoSetupCandidates(null);},
                style:{background:"rgba(239,68,68,0.12)",border:"1px solid rgba(239,68,68,0.3)",color:T.red,borderRadius:6,padding:"4px 9px",fontSize:10,fontWeight:700,cursor:"pointer"}
              },"Ã— Release")
            )
          );
        })
      ),
      foSetupCandidates&&React.createElement("div",{style:{marginBottom:12,padding:12,borderRadius:10,background:"rgba(168,85,247,0.06)",border:"1px solid rgba(168,85,247,0.25)"}},
        React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.purple,marginBottom:8}},"ðŸ“‹ Hire "+foSetupCandidates.title),
        foSetupCandidates.candidates.map(function(c78,ci78){
          var td78=c78.traitData||{icon:"ðŸ“‹",label:c78.trait,desc:""};
          var roleColor=c78.color||T.purple;
          var projCost=foSetupStaff.reduce(function(s,x){return s+(x.salary||0);},0)+(c78.salary||0);
          var cAfford=projCost<=foBudgetMax;
          var overBy=Math.round((projCost-foBudgetMax)*10)/10;
          return React.createElement("div",{key:"fosc"+ci78,
            style:{padding:"10px 12px",borderRadius:8,marginBottom:6,
              border:"1px solid "+(cAfford?roleColor+"44":"rgba(239,68,68,0.35)"),
              cursor:cAfford?"pointer":"not-allowed",
              background:cAfford?"rgba(255,255,255,0.025)":"rgba(239,68,68,0.04)",
              opacity:cAfford?1:0.6,
              transition:"all 0.12s"},
            onClick:function(){
              var projSpend=foSetupStaff.reduce(function(s,x){return s+(x.salary||0);},0)+(c78.salary||0);
              if(projSpend>foBudgetMax){return;}// blocked â€” button shows disabled state
              var ns78=foSetupStaff.concat([c78]);
              setFoSetupStaff(ns78);
              setFoSetupCandidates(null);
            }},
            React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}},
              React.createElement("div",{style:{flex:1}},
                React.createElement("div",{style:{fontSize:12,fontWeight:800}},c78.name),
                React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:1}},c78.backstory||c78.title),
                React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",marginTop:4}},
                  React.createElement("span",{style:{fontSize:9,padding:"1px 6px",borderRadius:4,
                    background:"rgba(255,255,255,0.06)",color:roleColor,fontWeight:700,border:"1px solid "+(roleColor+"33")}},
                    td78.icon+" "+td78.label),
                  React.createElement("span",{style:{fontSize:9,color:T.faint}},"$"+c78.salary+"M/yr â€¢ "+c78.yearsLeft+"yr")
                ),
                React.createElement("div",{style:{fontSize:8,color:T.faint,marginTop:3,fontStyle:"italic"}},td78.desc)
              ),
              React.createElement("div",{style:{textAlign:"center",marginLeft:10,minWidth:44}},
                React.createElement("div",{style:{fontSize:24,fontWeight:900,
                  color:c78.ovr>=80?T.green:c78.ovr>=65?T.gold:c78.ovr>=50?T.orange:T.red}},c78.ovr),
                React.createElement("div",{style:{fontSize:8,fontWeight:700,marginTop:2,
                  color:cAfford?T.green:T.red}},
                  cAfford?"Hire â†’":"â›” +$"+overBy+"M")
              )
            )
          );
        }),
        React.createElement("button",{style:assign({},bS(T.bg3,T.dim),{width:"100%",padding:"8px",fontSize:10,marginTop:4,borderRadius:6}),onClick:function(){setFoSetupCandidates(null);}},"Cancel")
      ),
      !foSetupCandidates&&foOpenRoles.length>0&&React.createElement("div",{style:{marginBottom:16}},
        React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.dim,marginBottom:8,letterSpacing:2,textTransform:"uppercase"}},"Available Roles"),
        foOpenRoles.map(function(r){
          return React.createElement("div",{key:"for"+r.id,
            style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 14px",borderRadius:8,marginBottom:6,border:"1px solid rgba(168,85,247,0.3)",cursor:"pointer",background:"rgba(168,85,247,0.04)"},
            onClick:function(){
              var candidates=FRONT_OFFICE.getCandidates(r.id,4);
              setFoSetupCandidates({roleId:r.id,title:r.title,candidates:candidates});
            }},
            React.createElement("div",{style:{flex:1}},
              React.createElement("div",{style:{display:"flex",alignItems:"center",gap:6}},
                React.createElement("span",{style:{fontSize:13,fontWeight:700,color:r.color||T.purple}},r.icon+" "+r.title),
                r.tier==="specialist"&&React.createElement("span",{style:{fontSize:7,padding:"1px 5px",borderRadius:3,
                  background:"rgba(251,191,36,0.12)",color:T.gold,fontWeight:700,border:"1px solid rgba(251,191,36,0.25)"}},"SPECIALIST")
              ),
              React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:2}},r.desc||("Affects: "+r.affects.join(", "))),
              React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",marginTop:1}},
                React.createElement("span",{style:{fontSize:9,color:T.faint}},"$"+r.salaryRange[0]+"â€“"+r.salaryRange[1]+"M/yr"),
                foRemaining<r.salaryRange[0]&&React.createElement("span",{style:{fontSize:8,color:T.red,fontWeight:700,
                  padding:"1px 4px",borderRadius:3,background:"rgba(239,68,68,0.1)"}},"â›” No budget")
              )
            ),
            React.createElement("div",{style:{fontSize:11,color:r.color||T.purple,fontWeight:700,flexShrink:0}},"View â†’")
          );
        })
      ),
      !foSetupCandidates&&React.createElement("div",{style:{textAlign:"center",padding:"8px 10px",marginBottom:12,borderRadius:8,
              background:foSetupStaff.length>=7?"rgba(74,222,128,0.08)":foSetupStaff.length>=4?"rgba(251,191,36,0.06)":foSetupStaff.length>=2?"rgba(96,165,250,0.06)":"rgba(255,255,255,0.03)",
              border:"1px solid "+(foSetupStaff.length>=7?"rgba(74,222,128,0.3)":foSetupStaff.length>=4?"rgba(251,191,36,0.25)":"rgba(255,255,255,0.08)"),
              fontSize:10,fontWeight:700,color:foSetupStaff.length>=7?T.green:foSetupStaff.length>=4?T.gold:foSetupStaff.length>=2?T.blue:T.faint}},
              foSetupStaff.length===0?"ðŸ“‹ Hire GM, Scout Dir, and Analytics to unlock draft bonuses":foSetupStaff.length>=7?"ðŸ† Full Front Office! Max bonuses â€” every phase of the season covered.":foSetupStaff.length>=5?"âœ… Strong office ("+foSetupStaff.length+"/7) â€” add 2 more specialists for full coverage":foSetupStaff.filter(function(s){return["gm","scout_dir","analytics"].indexOf(s.roleId)>=0;}).length>=3?"â­ Core hired! Specialists (Cap, Personnel, Relations, Medical) add bonus edges.":"ðŸ“‹ "+foSetupStaff.length+" hired â€” aim for GM + Scout Dir + Analytics as your core three"),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10,marginTop:8}},
        React.createElement("button",{
          style:{background:T.purple,color:"#fff",border:"none",borderRadius:8,padding:"14px",fontWeight:800,cursor:"pointer",fontSize:14,opacity:foSetupCandidates?0.4:1},
          disabled:!!foSetupCandidates,
          onClick:foSetupLaunch
        },(foSetupStaff.length===0?(pendingDraftMode&&pendingDraftMode.type==="quick"?"â­ï¸ Skip â€” Start Game Now":"â­ï¸ Skip â€” Hire Staff Later"):(pendingDraftMode&&pendingDraftMode.type==="quick"?"ðŸˆ Confirm Staff & Start â†’":"ðŸˆ Confirm Staff & Start Draft â†’"))),
        React.createElement("button",{style:assign({},bS(T.bg3,T.dim),{padding:"10px",fontSize:11,borderRadius:8}),onClick:function(){setScreen("draftMode");}},"â† Back to Draft Mode")
      )
    );
  }
  // v96.1: DRAFT ORDER SETUP â€” set the snake draft pick order
  if(screen==="draftOrderSetup"){
    var doMyTeam=teams.find(function(t){return t.id===myId;});
    var doOrder=expDraftOrder96||[];
    var doTeamMap={};teams.forEach(function(t){doTeamMap[t.id]=t;});
    var mySlot=doOrder.indexOf(myId)+1;
    // Find gamechanger rookies in pool for teaser
    var gcRookies=(expPool||[]).filter(function(p){return p._gamechanger96;});
    return (
      <div style={{minHeight:"100vh",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",display:"flex",flexDirection:"column",alignItems:"center",padding:20}}>
        <div style={{fontSize:20,marginTop:16}}>ðŸ</div>
        <div style={{fontSize:22,fontWeight:900,color:T.gold,marginTop:4}}>{"SNAKE DRAFT ORDER"}</div>
        <div style={{fontSize:11,color:T.dim,textAlign:"center",maxWidth:420,marginTop:4,lineHeight:1.5}}>
          {"Set the pick order for all "+getLeagueTeamCountLabel97()+" teams. In a snake draft, even rounds reverse the order â€” so pick #1 overall also picks LAST in Round 2, then first again in Round 3, and so on."}
        </div>
        {doMyTeam&&<div style={{fontSize:12,color:T.gold,fontWeight:800,marginTop:6}}>{"Your team: "+doMyTeam.icon+" "+doMyTeam.city+" "+doMyTeam.name+" â€” Currently picking #"+mySlot}</div>}
        
        {gcRookies.length>0&&React.createElement("div",{style:{marginTop:10,background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.25)",borderRadius:8,padding:"8px 12px",maxWidth:420,width:"100%"}},
          React.createElement("div",{style:{fontSize:10,fontWeight:800,color:T.gold,marginBottom:4}},"ðŸŒŸ GAMECHANGER ROOKIES IN THIS DRAFT CLASS"),
          gcRookies.map(function(gc,gi){
            return React.createElement("div",{key:gi,style:{display:"flex",justifyContent:"space-between",fontSize:11,padding:"2px 0"}},
              React.createElement("span",{style:{fontWeight:700,color:"#fff"}},gc.name+" ("+gc.pos+")"),
              React.createElement("span",{style:{color:T.gold,fontWeight:800}},gc.ovr+" OVR / 99 POT â­ Superstar Dev")
            );
          })
        )}

        <div style={{display:"flex",gap:6,marginTop:10,marginBottom:6}}>
          <button onClick={function(){
            var shuffled=doOrder.slice();
            for(var i=shuffled.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var tmp=shuffled[i];shuffled[i]=shuffled[j];shuffled[j]=tmp;}
            setExpDraftOrder96(shuffled);
          }} style={{padding:"8px 16px",fontSize:11,fontWeight:700,borderRadius:6,border:"1px solid "+T.border,background:"rgba(255,255,255,0.06)",color:T.dim,cursor:"pointer"}}>{"ðŸŽ² Randomize"}</button>
          <button onClick={function(){
            var moved=doOrder.slice();var mi=moved.indexOf(myId);
            if(mi>0){var tmp=moved[0];moved[0]=moved[mi];moved[mi]=tmp;setExpDraftOrder96(moved);}
          }} style={{padding:"8px 16px",fontSize:11,fontWeight:700,borderRadius:6,border:"1px solid "+T.gold+"66",background:"rgba(251,191,36,0.08)",color:T.gold,cursor:"pointer"}}>{"â¬†ï¸ Move Me to #1"}</button>
          <button onClick={function(){
            var moved=doOrder.slice();var mi=moved.indexOf(myId);var lastIdx=moved.length-1;
            if(mi<lastIdx){var tmp=moved[lastIdx];moved[lastIdx]=moved[mi];moved[mi]=tmp;setExpDraftOrder96(moved);}
          }} style={{padding:"8px 16px",fontSize:11,fontWeight:700,borderRadius:6,border:"1px solid "+T.border,background:"rgba(255,255,255,0.06)",color:T.dim,cursor:"pointer"}}>{"â¬‡ï¸ Move Me to #"+doOrder.length}</button>
        </div>

        <div style={{maxWidth:420,width:"100%",maxHeight:380,overflowY:"auto",background:T.bg2,borderRadius:10,border:"1px solid "+T.border,marginTop:4}}>
          {doOrder.map(function(tid,idx){
            var tm=doTeamMap[tid];if(!tm)return null;
            var isMe=tid===myId;
            return React.createElement("div",{key:tid,style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",
              borderBottom:"1px solid "+T.border,background:isMe?"rgba(251,191,36,0.08)":"transparent"}},
              React.createElement("div",{style:{width:24,textAlign:"center",fontWeight:900,fontSize:13,color:isMe?T.gold:T.dim}},(idx+1)),
              React.createElement("div",{style:{fontSize:16}},tm.icon||"ðŸˆ"),
              React.createElement("div",{style:{flex:1,fontWeight:isMe?800:600,fontSize:12,color:isMe?T.gold:T.text}},tm.city+" "+tm.name),
              isMe&&React.createElement("span",{style:{fontSize:8,fontWeight:800,color:T.gold,background:"rgba(251,191,36,0.15)",padding:"2px 6px",borderRadius:4}},"YOU"),
              React.createElement("div",{style:{display:"flex",gap:2}},
                idx>0&&React.createElement("button",{onClick:function(){
                  var arr=doOrder.slice();var temp=arr[idx-1];arr[idx-1]=arr[idx];arr[idx]=temp;setExpDraftOrder96(arr);
                },style:{padding:"2px 6px",fontSize:10,borderRadius:4,border:"1px solid "+T.border,background:"transparent",color:T.dim,cursor:"pointer"}},"â–²"),
                idx<doOrder.length-1&&React.createElement("button",{onClick:function(){
                  var arr=doOrder.slice();var temp=arr[idx+1];arr[idx+1]=arr[idx];arr[idx]=temp;setExpDraftOrder96(arr);
                },style:{padding:"2px 6px",fontSize:10,borderRadius:4,border:"1px solid "+T.border,background:"transparent",color:T.dim,cursor:"pointer"}},"â–¼")
              )
            );
          })}
        </div>

        <div style={{fontSize:9,color:T.faint,marginTop:6,textAlign:"center",maxWidth:400}}>
          {"ðŸ’¡ Tip: Picking #1 gets you first choice of elite talent, but you pick LAST in Round 2. Picking later means back-to-back picks at the snake turn."}
        </div>

        <div style={{display:"flex",gap:10,marginTop:12}}>
          <button onClick={function(){setScreen("gameGuide");}} style={{padding:"10px 20px",fontSize:12,fontWeight:700,borderRadius:8,border:"1px solid "+T.border,background:"rgba(255,255,255,0.06)",color:T.dim,cursor:"pointer"}}>{"â† Back"}</button>
          <button onClick={function(){launchSnakeDraft96();}} style={{padding:"12px 28px",fontSize:14,fontWeight:900,borderRadius:8,border:"none",background:"linear-gradient(135deg,"+T.gold+",#f59e0b)",color:"#0f172a",cursor:"pointer",boxShadow:"0 0 20px rgba(251,191,36,0.3)",letterSpacing:1}}>{"ðŸˆ CONFIRM ORDER & START DRAFT"}</button>
        </div>
      </div>
    );
  }
  if(screen==="expansionSnake"){
    try{
    var snkMyTeam=teams.find(function(t){return t.id===myId;});
    var snkDone=expPick>=expOrder.length||expPool.length===0||(expUserPicks>=expDepth&&expDepth<53);
    var snkOnClock=!snkDone&&expOrder[expPick]&&expOrder[expPick].teamId===myId;
    var snkCurrentTeam=!snkDone&&expOrder[expPick]?teams.find(function(t){return t.id===expOrder[expPick].teamId;}):null;
    var snkRound=!snkDone&&expOrder[expPick]?expOrder[expPick].round:50;
    var snkFiltered=expPosF==="ALL"?expPool:expPool.filter(function(p){return p.pos===expPosF;});
    snkFiltered=snkFiltered.slice().sort(function(a,b){return b.ovr-a.ovr;});
    return (
      <div style={{minHeight:"100vh",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",fontSize:12}}>
        
        <div style={{background:T.bg2,padding:"10px 16px",borderBottom:"2px solid "+(snkOnClock?T.gold:T.border),display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:10}}>
          <div style={{display:"flex",alignItems:"center",gap:10}}>
            <div style={{fontSize:20}}>ðŸ</div>
            <div><div style={{fontWeight:800,color:T.gold}}>{"LEAGUE INAUGURAL DRAFT â€” SNAKE FORMAT"}</div>
              <div style={{fontSize:10,color:T.dim}}>{"Round "+snkRound+" â€¢ Pick #"+(expPick+1)+" of "+expOrder.length+" â€¢ Even rounds reverse order"}</div></div>
          </div>
          <div style={{textAlign:"right"}}>
            <div style={{fontWeight:700}}>{snkMyTeam?snkMyTeam.icon+" "+snkMyTeam.abbr:""}</div>
            <div style={{fontSize:10,color:T.dim}}>{snkMyTeam?snkMyTeam.roster.length+"/53 rostered":""}</div>
            <div style={{fontSize:9,color:expDepth<53?T.gold:T.faint}}>{"Your picks: "+expUserPicks+(expDepth<53?"/"+expDepth:"")}</div>
          </div>
        </div>
        
        {snkOnClock && <div style={{background:"rgba(212,167,75,0.15)",borderBottom:"1px solid "+T.gold,padding:"10px 16px",textAlign:"center"}}>
          <div style={{fontSize:16,fontWeight:900,color:T.gold}}>ðŸŽ¯ YOU'RE ON THE CLOCK!</div>
          <div style={{fontSize:10,color:T.dim,marginTop:2}}>{"Round "+snkRound+" â€” Pick a player from the board below"}</div>
        </div>}
        {!snkOnClock&&!snkDone&&snkCurrentTeam && <div style={{background:T.bg2,padding:"8px 16px",textAlign:"center",borderBottom:"1px solid "+T.border}}>
          <div style={{fontSize:12,color:T.dim}}>{snkCurrentTeam.icon+" "+snkCurrentTeam.abbr+" is on the clock..."}</div>
        </div>}
        <div style={{padding:"8px 16px"}}>
          
          <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:8}}>
            {["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"].map(function(pos){
              var ct=snkMyTeam?snkMyTeam.roster.filter(function(p){return p.pos===pos;}).length:0;
              return <div key={pos} style={{fontSize:9,padding:"2px 6px",borderRadius:4,background:ct>0?"rgba(52,211,153,0.1)":T.bg2,color:ct>0?T.green:T.faint,border:"1px solid "+(ct>0?T.green:T.border)}}>{pos+":"+ct}</div>;
            })}
          </div>
          
          {(function(){var alerts=genRunAlerts(expPool,expPoolSnap);
            return alerts.length>0?React.createElement("div",{style:{marginBottom:6}},
              alerts.map(function(a,ai2){return React.createElement("div",{key:ai2,style:{fontSize:9,color:T.orange,background:"rgba(245,158,11,0.08)",padding:"3px 8px",borderRadius:4,marginBottom:2,fontWeight:600}},a);})):null;
          })()}
          
          <div style={{display:"flex",gap:3,flexWrap:"wrap",marginBottom:8}}>
            {["ALL","QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"].map(function(f){
              return <div key={f} onClick={function(){setExpPosF(f);}} style={{fontSize:10,padding:"3px 8px",borderRadius:4,cursor:"pointer",fontWeight:expPosF===f?700:400,background:expPosF===f?T.gold:"transparent",color:expPosF===f?"#000":T.dim}}>{f}</div>;
            })}
            <div style={{marginLeft:"auto",fontSize:10,color:T.faint}}>{expPool.length+" available"}</div>
          </div>
          
          <div style={{maxHeight:320,overflowY:"auto",background:T.bg2,borderRadius:8,border:"1px solid "+T.border}}>
            {snkFiltered.slice(0,80).map(function(p){
              return <div key={p.id} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",borderBottom:"1px solid "+T.border,cursor:snkOnClock?"pointer":"default",background:p._gamechanger96?"rgba(251,191,36,0.06)":"transparent"}}
                onClick={function(){if(snkOnClock)expSnakeSelect(p.id);}}>
                {React.createElement(PlayerFace,{id:p.id,size:26,age:p.age})}
                <div style={{flex:1,minWidth:0}}>
                  <div style={{fontWeight:700,fontSize:11,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{p.name}{p._gamechanger96?<span style={{color:T.gold,marginLeft:4,fontSize:9,fontWeight:800}}>{"ðŸŒŸ GAMECHANGER"}</span>:null}</div>
                  <div style={{fontSize:9,color:T.dim}}>{p.pos+" â€¢ Age "+p.age+(p.college?" â€¢ "+p.college.school:"")}{p.isRookie?<span style={{color:T.green,fontWeight:700,marginLeft:4}}>{"ROOK"}</span>:null}</div>
                </div>
                <div style={{fontWeight:800,fontSize:13,color:p.ovr>=85?T.gold:p.ovr>=75?T.green:p.ovr>=65?T.text:T.red}}>{p.ovr}</div>
                <div style={{fontSize:9,color:p._gamechanger96?T.gold:T.faint,fontWeight:p._gamechanger96?800:400,width:30,textAlign:"right"}}>{p.pot+"â†‘"}</div>
                {snkOnClock && <div style={{fontSize:16,color:T.green}}>{"+"}</div>}
              </div>;
            })}
          </div>
          
          {expDepth<53 && <div style={{marginBottom:8}}>
            <div style={{display:"flex",justifyContent:"space-between",fontSize:9,color:T.dim,marginBottom:2}}>
              <span>{"Your picks: "+expUserPicks+"/"+expDepth}</span>
              <span>{expDepth-expUserPicks>0?(expDepth-expUserPicks)+" remaining":"âœ… Complete!"}</span>
            </div>
            <div style={{height:4,background:T.bg3,borderRadius:2,overflow:"hidden"}}>
              <div style={{height:"100%",width:Math.min(100,Math.round(expUserPicks/expDepth*100))+"%",background:T.gold,borderRadius:2,transition:"width 0.3s"}}></div>
            </div>
          </div>}
          
          <div style={{display:"flex",gap:8,marginTop:10}}>
            {!snkOnClock&&!snkDone && <button onClick={function(){expSnakeAutoSim(expPick,expPool.slice(),teams.slice(),expLog.slice(),expOrder);}} style={{flex:1,background:T.blue,color:"#fff",border:"none",borderRadius:6,padding:"10px",fontWeight:700,cursor:"pointer",fontSize:12}}>{"â© Sim to My Pick"}</button>}
            {!snkDone && <button onClick={function(){expSnakeAutoFinish();}} style={{flex:1,background:T.orange,color:"#000",border:"none",borderRadius:6,padding:"10px",fontWeight:700,cursor:"pointer",fontSize:12}}>{"ðŸ¤– Auto-Complete Draft"}</button>}
            {snkDone && <button onClick={finishExpansionDraft} style={{flex:1,background:T.gold,color:"#000",border:"none",borderRadius:6,padding:"12px",fontWeight:800,cursor:"pointer",fontSize:14}}>{"ðŸˆ Start Season!"}</button>}
          </div>
          
          <div style={{marginTop:10,background:T.bg2,borderRadius:8,border:"1px solid "+T.border,padding:8,maxHeight:200,overflowY:"auto"}}>
            <div style={{fontWeight:700,fontSize:10,color:T.gold,marginBottom:4}}>DRAFT LOG</div>
            {expLog.slice(0,30).map(function(l,i){return <div key={i} style={{fontSize:10,color:i===0?T.text:T.dim,padding:"2px 0",borderBottom:i<expLog.length-1?"1px solid "+T.border:"none"}}>{l}</div>;})}
            {expLog.length===0 && <div style={{fontSize:10,color:T.faint,textAlign:"center",padding:10}}>Draft begins when you make your first pick...</div>}
          </div>
        </div>
      </div>
    );
    }catch(renderErr){console.error("Snake draft render error:",renderErr);return <div style={{padding:40,color:"red",background:"#111",minHeight:"100vh"}}><h2>{"Draft Render Error"}</h2><pre>{String(renderErr)}</pre><button onClick={function(){setScreen("draftMode");}}>{"â† Back"}</button></div>;}
  }
  if(screen==="expansionAuction"){
    try{
    var aucMyTeam=teams.find(function(t){return t.id===myId;});
    var aucMyBudget=expBudgets[myId]||0;
    var aucMyRoster=aucMyTeam?aucMyTeam.roster.length:0;
    var aucSpotsLeft=50-aucMyRoster;
    var aucMyMax=aucMaxBid(myId,expBudgets,aucMyRoster);
    var aucDone=aucMyRoster>=50||aucMyBudget<=0||(expUserPicks>=expDepth&&expDepth<53);
    var aucAllDone=teams.every(function(t){return t.roster.length>=50;})||aucDone;
    var aucFiltered=expPosF==="ALL"?expPool:expPool.filter(function(p){return p.pos===expPosF;});
    aucFiltered=aucFiltered.slice().sort(function(a,b){return b.ovr-a.ovr;});
    var nomTeamObj=expNom&&expBidder?teams.find(function(t){return t.id===expBidder;}):null;
    return (
      <div style={{minHeight:"100vh",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",fontSize:12}}>
        
        <div style={{background:T.bg2,padding:"10px 16px",borderBottom:"2px solid "+T.gold,display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:10}}>
          <div style={{display:"flex",alignItems:"center",gap:10}}>
            <div style={{fontSize:20}}>ðŸ’°</div>
            <div><div style={{fontWeight:800,color:T.gold}}>EXPANSION AUCTION</div>
              <div style={{fontSize:10,color:T.dim}}>{"Round "+(expAucRound+1)+" â€¢ "+expPool.length+" players left"}</div></div>
          </div>
          <div style={{textAlign:"right"}}>
            <div style={{fontWeight:800,fontSize:18,color:aucMyBudget>200?T.green:aucMyBudget>50?T.gold:T.red}}>{"$"+aucMyBudget}</div>
            <div style={{fontSize:9,color:T.dim}}>{aucMyRoster+"/50 â€¢ Max bid: $"+aucMyMax}</div>
            <div style={{fontSize:9,color:expDepth<53?T.gold:T.faint}}>{"Nominations: "+expUserPicks+(expDepth<53?"/"+expDepth:"")}</div>
          </div>
        </div>
        <div style={{padding:"8px 16px"}}>
          
          <div style={{height:6,background:T.bg3,borderRadius:3,marginBottom:8,overflow:"hidden"}}>
            <div style={{height:"100%",width:Math.max(0,aucMyBudget/10)+"%",background:aucMyBudget>200?T.green:aucMyBudget>50?T.gold:T.red,borderRadius:3,transition:"width 0.3s"}}></div>
          </div>
          
          <div style={{display:"flex",gap:2,flexWrap:"wrap",marginBottom:8}}>
            {teams.slice().sort(function(a,b){return (expBudgets[b.id]||0)-(expBudgets[a.id]||0);}).slice(0,10).map(function(t){
              return <div key={t.id} style={{fontSize:8,padding:"2px 5px",borderRadius:3,background:t.isUser?"rgba(212,167,75,0.15)":T.bg2,border:"1px solid "+(t.isUser?T.gold:T.border),color:t.isUser?T.gold:T.dim}}>
                {t.icon+t.abbr+" $"+(expBudgets[t.id]||0)+" ("+t.roster.length+")"}</div>;
            })}
          </div>
          
          {expAucPhase==="bid"&&expNom && (
            <div style={{background:"rgba(212,167,75,0.08)",border:"2px solid "+T.gold,borderRadius:12,padding:16,marginBottom:10,textAlign:"center"}}>
              <div style={{fontSize:10,color:T.gold,fontWeight:700,marginBottom:8}}>ðŸ”¨ NOW BIDDING</div>
              <div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:12,marginBottom:10}}>
                {React.createElement(PlayerFace,{id:expNom.id,size:44,age:expNom.age})}
                <div style={{textAlign:"left"}}>
                  <div style={{fontWeight:800,fontSize:16}}>{expNom.name}</div>
                  <div style={{fontSize:11,color:T.dim}}>{expNom.pos+" â€¢ Age "+expNom.age+" â€¢ OVR "}</div>
                  <div style={{fontWeight:900,fontSize:20,color:expNom.ovr>=85?T.gold:expNom.ovr>=75?T.green:T.text}}>{expNom.ovr}</div>
                </div>
              </div>
              <div style={{fontSize:14,fontWeight:800,marginBottom:2}}>{"Current Bid: $"+expBid}</div>
              <div style={{fontSize:11,color:nomTeamObj?(nomTeamObj.isUser?T.gold:T.dim):T.dim}}>{nomTeamObj?(nomTeamObj.icon+" "+nomTeamObj.abbr+(nomTeamObj.isUser?" (YOU)":"")):"â€”"}</div>
              <div style={{display:"flex",gap:6,justifyContent:"center",marginTop:12,flexWrap:"wrap"}}>
                {[1,5,10,25,50].map(function(inc){
                  var newBid=expBid+inc;
                  return newBid<=aucMyMax?<button key={inc} onClick={function(){aucUserBid(expBid+inc);}} style={{background:T.green,color:"#000",border:"none",borderRadius:6,padding:"8px 14px",fontWeight:700,cursor:"pointer",fontSize:12}}>{"$"+(expBid+inc)+" (+"+inc+")"}</button>:null;
                })}
              </div>
              <div style={{display:"flex",gap:8,justifyContent:"center",marginTop:8}}>
                <button onClick={aucRunBids} style={{background:T.blue,color:"#fff",border:"none",borderRadius:6,padding:"8px 16px",fontWeight:700,cursor:"pointer",fontSize:11}}>{"ðŸ”„ Let AI Bid"}</button>
                <button onClick={aucSold} style={{background:T.gold,color:"#000",border:"none",borderRadius:6,padding:"8px 16px",fontWeight:800,cursor:"pointer",fontSize:11}}>{"ðŸ”¨ SOLD! ($"+expBid+")"}</button>
              </div>
            </div>
          )}

          {expAucPhase==="aiBid"&&expNom && (function(){
            var aiNomTeam=teams.find(function(x){return x.id===expBidder;});
            var queueLeft=expAiQueue.length;
            return <div style={{background:"rgba(96,165,250,0.08)",border:"2px solid "+T.blue,borderRadius:12,padding:16,marginBottom:10,textAlign:"center"}}>
              <div style={{fontSize:10,color:T.blue,fontWeight:700,marginBottom:4}}>{"ðŸ¤– AI NOMINATION"+(queueLeft>0?" ("+queueLeft+" more in queue)":"")}</div>
              <div style={{fontSize:9,color:T.dim,marginBottom:8}}>{"Bid to steal this player or pass and let the AI keep it"}</div>
              <div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:12,marginBottom:10}}>
                {React.createElement(PlayerFace,{id:expNom.id,size:44,age:expNom.age})}
                <div style={{textAlign:"left"}}>
                  <div style={{fontWeight:800,fontSize:16}}>{expNom.name}</div>
                  <div style={{fontSize:11,color:T.dim}}>{expNom.pos+" â€¢ Age "+expNom.age+" â€¢ OVR"}</div>
                  <div style={{fontWeight:900,fontSize:20,color:expNom.ovr>=85?T.gold:expNom.ovr>=75?T.green:T.text}}>{expNom.ovr}</div>
                </div>
              </div>
              <div style={{fontSize:12,fontWeight:700,marginBottom:2,color:T.blue}}>{"AI Bid: $"+expBid}</div>
              <div style={{fontSize:10,color:T.dim,marginBottom:10}}>{aiNomTeam?(aiNomTeam.icon+" "+aiNomTeam.abbr+" has the lead"):"AI leading"}</div>
              <div style={{display:"flex",gap:6,justifyContent:"center",marginBottom:8,flexWrap:"wrap"}}>
                {[1,5,10,25,50].map(function(inc){
                  var newBid=expBid+inc;
                  return newBid<=aucMyMax?<button key={inc} onClick={function(){aucUserBid(expBid+inc);}} style={{background:T.green,color:"#000",border:"none",borderRadius:6,padding:"8px 14px",fontWeight:700,cursor:"pointer",fontSize:12}}>{"$"+newBid+" (+"+inc+")"}</button>:null;
                })}
              </div>
              <div style={{display:"flex",gap:8,justifyContent:"center"}}>
                {expBidder===myId&&<button onClick={aucWinAiBid} style={{background:T.gold,color:"#000",border:"none",borderRadius:6,padding:"8px 16px",fontWeight:800,cursor:"pointer",fontSize:11}}>{"ðŸ”¨ WIN IT! ($"+expBid+")"}</button>}
                <button onClick={aucPassAiBid} style={{background:T.bg3,color:T.dim,border:"1px solid "+T.border,borderRadius:6,padding:"8px 16px",fontWeight:700,cursor:"pointer",fontSize:11}}>{"â­ï¸ Pass"}</button>
              </div>
            </div>;
          })()}
          
          {expAucPhase==="nom"&&!aucAllDone && (
            <div>
              <div style={{background:"rgba(52,211,153,0.08)",border:"1px solid "+T.green,borderRadius:8,padding:"8px 12px",marginBottom:8,textAlign:"center"}}>
                <div style={{fontWeight:700,color:T.green}}>{"ðŸŽ¤ YOUR TURN â€” Nominate a player for auction"}</div>
                <div style={{fontSize:10,color:T.dim}}>{"Tap any player below to put them on the block"}</div>
              </div>
              
              <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:8}}>
                {["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"].map(function(pos){
                  var ct=aucMyTeam?aucMyTeam.roster.filter(function(p){return p.pos===pos;}).length:0;
                  return <div key={pos} style={{fontSize:9,padding:"2px 6px",borderRadius:4,background:ct>0?"rgba(52,211,153,0.1)":T.bg2,color:ct>0?T.green:T.faint,border:"1px solid "+(ct>0?T.green:T.border)}}>{pos+":"+ct}</div>;
                })}
              </div>
              
              {(function(){var alerts2=genRunAlerts(expPool,expPoolSnap);
                return alerts2.length>0?React.createElement("div",{style:{marginBottom:6}},
                  alerts2.map(function(a,ai3){return React.createElement("div",{key:ai3,style:{fontSize:9,color:T.orange,background:"rgba(245,158,11,0.08)",padding:"3px 8px",borderRadius:4,marginBottom:2,fontWeight:600}},a);})):null;
              })()}
              
              <div style={{display:"flex",gap:3,flexWrap:"wrap",marginBottom:6}}>
                {["ALL","QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"].map(function(f){
                  return <div key={f} onClick={function(){setExpPosF(f);}} style={{fontSize:10,padding:"3px 8px",borderRadius:4,cursor:"pointer",fontWeight:expPosF===f?700:400,background:expPosF===f?T.gold:"transparent",color:expPosF===f?"#000":T.dim}}>{f}</div>;
                })}
              </div>
              
              <div style={{maxHeight:300,overflowY:"auto",background:T.bg2,borderRadius:8,border:"1px solid "+T.border}}>
                {aucFiltered.slice(0,60).map(function(p){
                  return <div key={p.id} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",borderBottom:"1px solid "+T.border,cursor:"pointer"}}
                    onClick={function(){aucNominate(p.id);}}>
                    {React.createElement(PlayerFace,{id:p.id,size:26,age:p.age})}
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontWeight:700,fontSize:11,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{p.name}</div>
                      <div style={{fontSize:9,color:T.dim}}>{p.pos+" â€¢ Age "+p.age}</div>
                    </div>
                    <div style={{fontWeight:800,fontSize:13,color:p.ovr>=85?T.gold:p.ovr>=75?T.green:p.ovr>=65?T.text:T.red}}>{p.ovr}</div>
                    <div style={{fontSize:9,color:T.faint,width:30,textAlign:"right"}}>{p.pot+"â†‘"}</div>
                    <div style={{fontSize:14,color:T.gold}}>{"ðŸ”¨"}</div>
                  </div>;
                })}
              </div>
            </div>
          )}
          
          <div style={{display:"flex",gap:8,marginTop:10}}>
            {!aucAllDone && <button onClick={aucAutoFinish} style={{flex:1,background:T.orange,color:"#000",border:"none",borderRadius:6,padding:"10px",fontWeight:700,cursor:"pointer",fontSize:12}}>{"ðŸ¤– Auto-Complete Draft"}</button>}
            {aucAllDone && <button onClick={finishExpansionDraft} style={{flex:1,background:T.gold,color:"#000",border:"none",borderRadius:6,padding:"12px",fontWeight:800,cursor:"pointer",fontSize:14}}>{"ðŸˆ Start Season!"}</button>}
          </div>
          
          <div style={{marginTop:10,background:T.bg2,borderRadius:8,border:"1px solid "+T.border,padding:8,maxHeight:180,overflowY:"auto"}}>
            <div style={{fontWeight:700,fontSize:10,color:T.gold,marginBottom:4}}>AUCTION LOG</div>
            {expLog.slice(0,25).map(function(l,i){return <div key={i} style={{fontSize:10,color:i===0?T.text:T.dim,padding:"2px 0",borderBottom:"1px solid "+T.border}}>{l}</div>;})}
            {expLog.length===0 && <div style={{fontSize:10,color:T.faint,textAlign:"center",padding:10}}>Nominate your first player to start bidding...</div>}
          </div>
        </div>
      </div>
    );
    }catch(renderErr2){console.error("Auction draft render error:",renderErr2);return <div style={{padding:40,color:"red",background:"#111",minHeight:"100vh"}}><h2>{"Auction Render Error"}</h2><pre>{String(renderErr2)}</pre><button onClick={function(){setScreen("draftMode");}}>{"â† Back"}</button></div>;}
  }
  if(screen==="league"&&my){
    try{
    if(season.phase==="seasonRecap"){
      return React.createElement("div",{style:{minHeight:"100vh",background:T.bg,color:T.text}},
        React.createElement("div",{style:{padding:10,borderBottom:"1px solid "+T.border,background:T.bg2,textAlign:"center"}},
          React.createElement("div",{style:mS(S.header,{fontSize:14,color:T.gold})},"YEAR IN REVIEW")
        ),
        React.createElement(SeasonRecap,{
          history:history,teams:teams,sched:sched,myId:myId,
          onConfetti:setShowConfetti,
          onNext:function(){
            setSeason(function(s){return assign({},s,{phase:"reSign"});});
            addN("ðŸ“‹ Re-Sign Phase: "+reSignPool.length+" expiring contracts.","purple",{type:"phase",phase:"reSign"});
            setTab("home");
            doSave(null,null,{year:season.year,week:season.week,phase:"reSign",pr:season.pr});
          }
        }),
        showConfetti?React.createElement("canvas",{ref:function(){}/*confetti uses effect*/}):null
      );
    }
    var standings=teams.slice().sort(function(a,b){return b.wins-a.wins||(b.pf-b.pa)-(a.pf-a.pa);});
    var confStandings97=DIV_STANDINGS.getConferences(teams);
    var maxW=Math.max.apply(null,sched.map(function(g){return g.week;}));var done=season.week>maxW;
    if(screen==="draftGrade"){
      var dg81=mfsnDraftGrade80;
      var dgHist81=mfsnGradeHistory80||[];
      if(!dg81)return React.createElement("div",{style:{padding:40,color:T.text,textAlign:"center"}},
        React.createElement("button",{style:assign({},bS(T.dim,"#fff"),{marginBottom:20}),onClick:function(){setScreen("league");}},"â† Back"),
        "No draft grade available yet. Complete a draft first!"
      );
      var gColor81=dg81.grade&&dg81.grade.indexOf("A")===0?"#4ade80":dg81.grade&&dg81.grade.indexOf("B")===0?"#60a5fa":dg81.grade&&dg81.grade.indexOf("C")===0?"#fbbf24":"#ef4444";
      return React.createElement("div",{style:{minHeight:"100vh",background:T.bg,color:T.text,padding:16}},
        React.createElement("button",{style:assign({},bS(T.dim,"#fff"),{marginBottom:12,fontSize:10}),onClick:function(){setScreen("league");}},"â† Back to League"),
        React.createElement("div",{style:{textAlign:"center",padding:"20px 0"}},
          React.createElement("div",{style:{fontSize:48}},dg81.analystIcon||"ðŸŽ™ï¸"),
          React.createElement("div",{style:{fontSize:64,fontWeight:900,color:gColor81,letterSpacing:2}},dg81.grade),
          React.createElement("div",{style:{fontSize:14,fontStyle:"italic",color:T.dim,marginTop:8}},'"'+(dg81.take||dg81.headline||"Solid class.")+'"'),
          React.createElement("div",{style:{fontSize:10,color:T.faint,marginTop:4}},dg81.analyst+" â€” "+dg81.year+" Draft")
        ),
        React.createElement("div",{style:mS(S.card,{padding:14,marginTop:16})},
          React.createElement("div",{style:{fontSize:12,fontWeight:800,color:T.cyan,marginBottom:8}},"ðŸ“‹ PICK-BY-PICK ANALYSIS"),
          (dg81.picks||[]).map(function(pk,i){
            var pkGrade=pk.ovr>=78?"A":pk.ovr>=72?"B+":pk.ovr>=65?"B":pk.ovr>=58?"C":"D";
            var verdict=pk.ovr>=(pk.projOvr||pk.ovr)+5?"STEAL":pk.ovr<=(pk.projOvr||pk.ovr)-5?"REACH":"VALUE";
            var vColor=verdict==="STEAL"?T.green:verdict==="REACH"?T.red:T.cyan;
            return React.createElement("div",{key:i,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 0",borderBottom:"1px solid "+T.border}},
              React.createElement("div",{style:{fontSize:10}},
                React.createElement("span",{style:{fontWeight:700}},pk.name),
                React.createElement("span",{style:{color:T.dim,marginLeft:6}},pk.pos+" "+pk.ovr+" OVR"+(pk.devTrait&&pk.devTrait!=="normal"?" ("+pk.devTrait+")":""))
              ),
              React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center"}},
                React.createElement("span",{style:{fontSize:8,padding:"1px 5px",borderRadius:4,background:vColor+"22",color:vColor,fontWeight:700}},verdict),
                React.createElement("span",{style:{fontSize:11,fontWeight:800}},pkGrade)
              )
            );
          })
        ),
        dgHist81.length>1&&React.createElement("div",{style:mS(S.card,{padding:14,marginTop:12})},
          React.createElement("div",{style:{fontSize:12,fontWeight:800,color:T.gold,marginBottom:8}},"ðŸ“Š DRAFT GRADE HISTORY"),
          dgHist81.slice().reverse().map(function(g,i){
            var hgColor=g.grade&&g.grade.indexOf("A")===0?T.green:g.grade&&g.grade.indexOf("B")===0?T.cyan:g.grade&&g.grade.indexOf("C")===0?T.gold:T.red;
            return React.createElement("div",{key:i,style:{display:"flex",justifyContent:"space-between",padding:"4px 0",borderBottom:"1px solid "+T.border}},
              React.createElement("span",{style:{fontSize:10}},g.year+" Draft"),
              React.createElement("span",{style:{fontSize:12,fontWeight:800,color:hgColor}},g.grade),
              React.createElement("span",{style:{fontSize:9,color:T.dim}},g.desc||"")
            );
          })
        )
      );
    }
    if(ownerMeeting81){
      return React.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:20}},
        React.createElement("div",{style:{maxWidth:420,width:"100%",background:T.bg2,border:"2px solid #ef4444",borderRadius:16,padding:24}},
          React.createElement("div",{style:{textAlign:"center",marginBottom:16}},
            React.createElement("div",{style:{fontSize:48}},"ðŸ’€"),
            React.createElement("div",{style:{fontSize:18,fontWeight:900,color:"#ef4444",marginTop:8}},"OWNER MEETING"),
            React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:4}},"Your job is on the line. Choose ONE ultimatum to fulfill within 3 weeks:")
          ),
          ownerMeeting81.ultimatums.map(function(u,i){
            return React.createElement("button",{key:i,style:assign({},bS("#ef4444","#fff"),{width:"100%",padding:"12px 16px",marginBottom:8,textAlign:"left",fontSize:10}),
              onClick:function(){
                var myT81m=teams.find(function(t){return t.id===myId;});
                setUltimatumDeadline81({type:u.id,week:season.week+3,startCap:myT81m?(myT81m.capUsed||0):0,startRoster:myT81m?myT81m.roster.map(function(p){return{id:p.id};}):[]});
                setOwnerMeeting81(null);
                addN("â° Ultimatum accepted: "+u.label+". You have 3 weeks.","red");
              }},
              React.createElement("div",{style:{fontWeight:700}},u.label),
              React.createElement("div",{style:{fontSize:8,color:T.dim,marginTop:2}},u.desc)
            );
          })
        )
      );
    }
    if(activeOSEvent81){
      return React.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:9998,display:"flex",alignItems:"center",justifyContent:"center",padding:20}},
        React.createElement("div",{style:{maxWidth:420,width:"100%",background:T.bg2,border:"2px solid "+T.cyan,borderRadius:16,padding:24}},
          React.createElement("div",{style:{textAlign:"center",marginBottom:16}},
            React.createElement("div",{style:{fontSize:48}},activeOSEvent81.icon),
            React.createElement("div",{style:{fontSize:14,fontWeight:800,color:T.cyan,marginTop:8}},"OFFSEASON EVENT"),
            React.createElement("div",{style:{fontSize:11,color:T.text,marginTop:8}},activeOSEvent81.headline)
          ),
          activeOSEvent81.choices.map(function(c,i){
            return React.createElement("button",{key:i,style:assign({},bS(i===0?T.cyan:T.dim,"#fff"),{width:"100%",padding:"12px 16px",marginBottom:8,textAlign:"left",fontSize:10}),
              onClick:function(){
                var eff=c.effect;
                if(eff.type==="ovr_boost"&&eff.playerId){
                  var dcU=dc.map(function(p){if(p.id===eff.playerId){p.ovr=Math.min(95,(p.ovr||50)+eff.amount);}return p;});
                  setDc(dcU);
                }
                if(eff.type==="patience_boost"){setOwnerPatience80(function(prev){return Math.min(100,prev+(eff.amount||5));});}
                if(eff.type==="suspend"&&eff.playerId){
                  var nt81s=teams.slice();var u81s=nt81s.find(function(t){return t.id===myId;});
                  if(u81s){var sp81=u81s.roster.find(function(p){return p.id===eff.playerId;});if(sp81){setPlayerInjury92(sp81,"Suspension",eff.games||4);}}
                  setTeams(nt81s);
                }
                addN(activeOSEvent81.icon+" "+c.label+" â€” "+c.desc,"cyan");
                var remaining=offseasonEvents81.filter(function(e){return e!==activeOSEvent81;});
                setOffseasonEvents81(remaining);
                setActiveOSEvent81(remaining.length>0?remaining[0]:null);
              }},
              React.createElement("div",{style:{fontWeight:700}},c.label),
              React.createElement("div",{style:{fontSize:8,color:T.dim,marginTop:2}},c.desc)
            );
          })
        )
      );
    }
    if(staffPoachTargets81&&staffPoachTargets81.length>0&&screen==="league"){
      return React.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:9997,display:"flex",alignItems:"center",justifyContent:"center",padding:20}},
        React.createElement("div",{style:{maxWidth:420,width:"100%",background:T.bg2,border:"2px solid "+T.orange,borderRadius:16,padding:24}},
          React.createElement("div",{style:{textAlign:"center",marginBottom:16}},
            React.createElement("div",{style:{fontSize:48}},"ðŸŽ¯"),
            React.createElement("div",{style:{fontSize:14,fontWeight:800,color:T.orange,marginTop:8}},"STAFF POACHING ALERT"),
            React.createElement("div",{style:{fontSize:10,color:T.dim,marginTop:4}},"Rival teams are targeting your front office staff!")
          ),
          staffPoachTargets81.map(function(target,i){
            var cost81=STAFF_POACHING.counterOfferCost(target);
            return React.createElement("div",{key:i,style:{padding:12,marginBottom:8,borderRadius:8,background:T.bg3,border:"1px solid "+T.border}},
              React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
                React.createElement("div",null,
                  React.createElement("div",{style:{fontSize:11,fontWeight:700}},target.icon+" "+target.name),
                  React.createElement("div",{style:{fontSize:9,color:T.dim}},target.title+" â€¢ "+target.ovr+" OVR â€¢ $"+target.salary+"M/yr")
                ),
                React.createElement("div",{style:{fontSize:8,color:T.red}},target.poachRate+"% poach chance")
              ),
              React.createElement("div",{style:{display:"flex",gap:6}},
                React.createElement("button",{style:assign({},bS(T.green,"#fff"),{flex:1,padding:"6px 8px",fontSize:9}),
                  onClick:function(){
                    var nt81p=teams.slice();var u81p=nt81p.find(function(t){return t.id===myId;});
                    if(u81p)u81p.cash=Math.max(0,(u81p.cash||50)-cost81);
                    setTeams(nt81p);
                    setStaffPoachTargets81(function(prev){return prev.filter(function(t){return t.id!==target.id;});});
                    addN("ðŸ’° Retained "+target.name+" with $"+cost81+"M counter-offer!","gold");
                  }},"Retain ($"+cost81+"M)"),
                React.createElement("button",{style:assign({},bS(T.red,"#fff"),{flex:1,padding:"6px 8px",fontSize:9}),
                  onClick:function(){
                    setFrontOffice78(STAFF_POACHING.applyPoach(frontOffice78,target));
                    setStaffPoachTargets81(function(prev){return prev.filter(function(t){return t.id!==target.id;});});
                    addN("ðŸ‘‹ Lost "+target.name+" to a rival team.","red");
                  }},"Let Go")
              )
            );
          }),
          React.createElement("button",{style:assign({},bS(T.dim,"#fff"),{width:"100%",padding:"8px 12px",fontSize:10,marginTop:8}),
            onClick:function(){
              staffPoachTargets81.forEach(function(t81){
                setFrontOffice78(function(prev){return prev.filter(function(s){return s.id!==t81.id;});});
              });
              setStaffPoachTargets81([]);
              addN("Remaining staff departed to rival teams.","orange");
            }},"Skip All (let remaining go)")
        )
      );
    }
    if(screen==="fired81"){
      return React.createElement("div",{style:{minHeight:"100vh",background:"#0f0000",color:T.text,display:"flex",alignItems:"center",justifyContent:"center",padding:40}},
        React.createElement("div",{style:{textAlign:"center",maxWidth:400}},
          React.createElement("div",{style:{fontSize:28,fontWeight:900,color:"#e03c3c",letterSpacing:"2px",fontFamily:"'JetBrains Mono',monospace"}},"//:FIRED"),
          React.createElement("div",{style:{fontSize:24,fontWeight:900,color:"#ef4444",marginTop:16}},"YOU'VE BEEN FIRED"),
          React.createElement("div",{style:{fontSize:12,color:T.dim,marginTop:12}},"The owner has lost all patience. Your dynasty is over."),
          React.createElement("div",{style:{fontSize:10,color:T.faint,marginTop:20}},"Seasons coached: "+(season.year-2026)),
          React.createElement("button",{style:assign({},bS(T.dim,"#fff"),{padding:"10px 20px",marginTop:20,fontSize:11}),onClick:function(){setScreen("title");}},"Return to Title Screen")
        )
      );
    }
    var NAV_PILLARS=[
      {id:"hub",label:"Hub",tabs:[
        {id:"home",label:"Home"},
        {id:"inbox",label:"Inbox"},
        {id:"schedule",label:"Schedule"},
        {id:"calendar",label:"Calendar"},
        {id:"stories",label:"Stories"},
        {id:"powerRank",label:"Power Rankings"},
        {id:"ticker",label:"News Feed"},
        {id:"awardsRace",label:"Awards Race"},
        {id:"globalBoard",label:"Leaderboard"}
      ]},
      {id:"team",label:"Team",tabs:[
        {id:"roster",label:"Roster"},
        {id:"depth",label:"Depth Chart"},
        {id:"staff",label:"Staff"},
        {id:"fa",label:"Free Agents"},
        {id:"trade",label:"Trade"},
        {id:"gameplan",label:"Gameplan"},
        {id:"scouting",label:"Scouting"},
        {id:"pipeline",label:"Pipeline"},
        {id:"training",label:"Training"},
        {id:"chemistry",label:"Chemistry"},
        {id:"injuries",label:"Injury Report"}
      ]},
      {id:"season",label:"Season",tabs:[
        {id:"teamSeasonStats",label:"My Team"},
        {id:"leagueTeamStats",label:"League Teams"},
        {id:"playerTeamStats",label:"My Players"},
        {id:"playerLeagueStats",label:"League Players"},
        {id:"seasonCompare",label:"Compare"},
        {id:"playoffPic",label:"Playoff Picture"},
        {id:"weekRecap",label:"Weekly Recap"},
        {id:"milestones",label:"Milestones"},
        {id:"analyticsHub",label:"Analytics"}
      ]},
      {id:"office",label:"Office",tabs:[
        {id:"franchise",label:"Franchise"},
        {id:"log",label:"Transactions"},
        {id:"ledger",label:"Ledger"},
        {id:"capLab",label:"Cap Lab"},
        {id:"ownerReport",label:"Owner Report"},
        {id:"facilities",label:"Facilities"},
        {id:"gmIntel",label:"GM Intel"},
        {id:"warRoom",label:"War Room"},
        {id:"settings",label:"Settings"}
      ]},
      {id:"legacy",label:"Legacy",tabs:[
        {id:"allTimeRecords",label:"All-Time"},
        {id:"hof",label:"Hall of Fame"},
        {id:"history",label:"Archives"},
        {id:"almanac",label:"Almanac"},
        {id:"records",label:"Records"},// v80: All-Time Records Wall
        {id:"mentors",label:"Mentors"},// v80: Mentor/ProtÃ©gÃ© setup
        {id:"rivalries",label:"Rivalries"},
        {id:"ringOfHonor",label:"Ring of Honor"},
        {id:"timeline",label:"Timeline"},
        {id:"dynastyMode",label:"Dynasty"},
        {id:"timeline986",label:"Timeline"},
        {id:"draftArchive",label:"Drafts"},
        {id:"boxScores",label:"Box Scores"}
      ]}
    ];
    if(season.phase==="reSign")NAV_PILLARS[1].tabs.push({id:"reSign",label:"Re-Sign"});
    if(season.phase==="combine")NAV_PILLARS[1].tabs.push({id:"combine",label:"Combine"});
    if(season.phase==="drafting")NAV_PILLARS[1].tabs.push({id:"draft",label:"Draft"});
    var activePillar="hub";
    NAV_PILLARS.forEach(function(p){p.tabs.forEach(function(t){if(t.id===tab)activePillar=p.id;});});
    var activePillarObj=NAV_PILLARS.find(function(p){return p.id===activePillar;});
    var PILLAR_DEFAULTS={hub:"home",team:"roster",season:"teamSeasonStats",office:"franchise",legacy:"records"};
    return (
      <div style={{minHeight:"100vh",background:T.bg,color:T.text,fontFamily:"'Inter',system-ui,sans-serif",fontSize:13,display:"flex",flexDirection:"column"}}>
        
        <div style={{background:T.bg2,borderBottom:"2px solid "+T.border,padding:"6px 10px",display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:30,gap:6,minHeight:40}}>
          <div style={{display:"flex",alignItems:"center",gap:6,flexShrink:0}}>
            {React.createElement(TeamLogo,{team:my,size:22})}
            <span style={{fontWeight:800,fontSize:12}}>{my.abbr}</span>
            <span style={{fontSize:9,color:moodColor(my.ownerMood||70),fontWeight:700,fontFamily:"'JetBrains Mono',monospace",letterSpacing:"0.3px"}}>{"APR "+(my.ownerMood||70)}</span>
            {godMode && <span style={mS(S.badge,S.badgePurple,{fontSize:8})}>GOD</span>}</div>
          <div style={{display:"flex",gap:5,alignItems:"center",overflowX:"auto",flexShrink:1,WebkitOverflowScrolling:"touch"}}>
            <button onClick={function(){AUDIO.toggle();if(!AUDIO.isMuted())AUDIO.shuffle();}} style={mS(S.btn,S.btnSmall,S.btnGhost,{padding:"3px 6px"})}>{audioMuted?"MUTE":"SND"}</button>
            {!audioMuted&&React.createElement("button",{onClick:function(){AUDIO.next();},style:mS(S.btn,S.btnSmall,S.btnGhost,{padding:"3px 6px",fontSize:10})},"NEXT")}
            {!audioMuted&&nowPlaying&&React.createElement("span",{onClick:function(){setScreen("music");},title:"Open Jukebox",style:{fontSize:9,color:T.faint,maxWidth:90,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",display:"inline-block",verticalAlign:"middle",cursor:"pointer",textDecoration:"underline dotted"}},nowPlaying)}
            <button onClick={function(){setGodMode(function(v){return !v;});}} style={mS(S.btn,S.btnSmall,{padding:"3px 6px",background:godMode?"rgba(167,139,250,0.3)":"rgba(255,255,255,0.06)",color:godMode?"#fff":T.faint,border:"1px solid "+(godMode?"rgba(167,139,250,0.4)":T.glassBorder)})}>{godMode?"GOD ON":"GOD"}</button>
            <span style={mS(S.badge,{background:difficulty==="legend"?"rgba(239,68,68,0.15)":difficulty==="allpro"?"rgba(245,158,11,0.15)":difficulty==="rookie"?"rgba(52,211,153,0.15)":"rgba(255,255,255,0.05)",color:difficulty==="legend"?T.red:difficulty==="allpro"?T.orange:difficulty==="rookie"?T.green:T.dim,cursor:"pointer",flexShrink:0,whiteSpace:"nowrap"})} onClick={function(){setTab("settings");}}>{(DIFF_SETTINGS[difficulty]||DIFF_SETTINGS.pro).icon+" "+(DIFF_SETTINGS[difficulty]||DIFF_SETTINGS.pro).name}</span>
            <span style={{color:season.phase==="cutDay"?T.red:T.dim,fontWeight:600,fontSize:9,flexShrink:0}}>{my.roster.length+"/"+(season.phase==="preseason"||season.phase==="cutDay"?CAMP_CAP:ROSTER_CAP)}</span>
            {my&&(function(){var _hCapUsed=capCalc(my.roster);var _hDead=my.deadCap||0;var _hCap=getSalaryCap(season.year);var _hSpace=Math.round((_hCap-_hCapUsed-_hDead)*10)/10;var _hCol=_hSpace>=20?T.green:_hSpace>=0?T.gold:T.red;return React.createElement("span",{title:"Cap Space",style:{color:_hCol,fontWeight:700,fontSize:10,flexShrink:0}},(_hSpace>=0?"$":"$-")+Math.abs(_hSpace).toFixed(0)+"M");})()}
            <span style={{color:T.cyan,fontSize:9,flexShrink:0}}>{"Scout:"+(my.scoutPts||0)}</span>
            <span style={{color:T.gold,fontWeight:700,fontSize:10,flexShrink:0}}>{season.year+" Wk"+season.week}</span>
            {/* DBG button hidden for public release */}
            <button onClick={function(){setShowKbHelp(true);}} style={{background:"none",border:"1px solid "+T.glassBorder,borderRadius:4,color:T.faint,fontSize:9,padding:"2px 5px",cursor:"pointer",flexShrink:0}} title="Keyboard Shortcuts">{"?"}</button>
          </div>
        </div>
        
        {debugMode && my && (function(){
          var capH=my.capUsed||0;var dead=my.deadCap||0;
          var inv=[];
          if(capH>248)inv.push("[!] CAP_OVER: $"+capH.toFixed(1)+"M > $248M");
          if(my.roster.length>53)inv.push("[!] ROSTER: "+my.roster.length+" > 53");
          var dupeIds=my.roster.map(function(p){return p.id;}).filter(function(v,i,a){return a.indexOf(v)!==i;});
          if(dupeIds.length>0)inv.push("[!] DUPE_IDS: "+dupeIds.length+" duplicates");
          if(my.roster.filter(function(p){return !p.id;}).length>0)inv.push("[!] NULL_PIDS detected");
          return React.createElement("div",{style:{background:"rgba(10,0,0,0.97)",border:"2px solid #ef4444",padding:"8px 12px",fontSize:9,fontFamily:"monospace",position:"sticky",top:40,zIndex:40}},
            React.createElement("div",{style:{color:"#ef4444",fontWeight:800,marginBottom:4,fontSize:10}},"[DBG] DEBUG â€” v80.12"),
            React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"3px 10px",marginBottom:6}},
              [
                ["PHASE",season.phase],["WEEK","Wk"+season.week+" "+season.year],
                ["ROSTER",my.roster.length+"/53"],["CAP","$"+capH.toFixed(1)+"M / $248M"],
                ["DEAD","$"+dead.toFixed(1)+"M"],["SPACE","$"+(248-capH-dead).toFixed(1)+"M"],
                ["SEED",String(SEED_GLOBAL||"â€”")],["RECORD",my.wins+"-"+my.losses],
                ["CASH","$"+(my.cash||0).toFixed(0)+"M"],["INBOX",inbox.length+" items"],
                ["TRACK",AUDIO.current()||"â€”"],["MOOD",my.ownerMood||70]
              ].map(function(pair,i){return React.createElement("div",{key:i},
                React.createElement("span",{style:{color:"#ef4444"}},pair[0]+": "),
                React.createElement("span",{style:{color:"#fbbf24"}},pair[1])
              );})
            ),
            React.createElement("div",{style:{borderTop:"1px solid rgba(239,68,68,0.25)",paddingTop:4}},
              inv.length>0
                ?inv.map(function(v,i){return React.createElement("div",{key:i,style:{color:"#ef4444",fontWeight:800}},v);})
                :React.createElement("div",{style:{color:"#22c55e",fontWeight:700}},"[OK] All invariants pass (cap, roster, IDs, picks)")
            ),
            React.createElement("div",{style:{marginTop:6,borderTop:"1px solid rgba(239,68,68,0.25)",paddingTop:6}},
              React.createElement("button",{onClick:runDeterminismSmokeTest,style:{background:"rgba(34,197,94,0.2)",color:"#22c55e",border:"1px solid rgba(34,197,94,0.55)",borderRadius:6,padding:"4px 8px",fontSize:9,fontWeight:800,cursor:"pointer"}},"[RUN] Determinism Smoke"),
              determinismSmoke?React.createElement("div",{style:{marginTop:5,fontSize:8,lineHeight:1.4}},
                React.createElement("div",{style:{color:determinismSmoke.ok?"#22c55e":"#ef4444",fontWeight:700}},
                  (determinismSmoke.ok?"PASS":"FAIL")+" â€¢ "+determinismSmoke.label+" â€¢ "+determinismSmoke.durationMs+"ms"),
                React.createElement("div",{style:{color:"#94a3b8"}},
                  "Seed "+determinismSmoke.seed+" / "+determinismSmoke.year+" W"+determinismSmoke.week),
                determinismSmoke.error?React.createElement("div",{style:{color:"#ef4444"}},determinismSmoke.error):null,
                !determinismSmoke.ok&&!determinismSmoke.error?React.createElement("div",{style:{color:"#f59e0b"}},
                  "A: "+String(determinismSmoke.sigA||"").slice(0,80)):null,
                !determinismSmoke.ok&&!determinismSmoke.error?React.createElement("div",{style:{color:"#f59e0b"}},
                  "B: "+String(determinismSmoke.sigB||"").slice(0,80)):null
              ):null
            ),
            React.createElement("div",{style:{marginTop:3,color:"#475569",fontSize:8}},"Tap DBG in header to close")
          );
        })()}
        
        <div style={{background:T.bg2,display:"flex",alignItems:"stretch",flexShrink:0,position:"sticky",top:40,zIndex:29,borderBottom:"1px solid "+T.border,overflowX:"auto",WebkitOverflowScrolling:"touch"}}>
          {NAV_PILLARS.map(function(p){
            var isActive=activePillar===p.id;
            var hasNotif=p.id==="hub"&&!inboxRead&&inbox.length>0;
            return <div key={p.id} style={{flex:"1 0 auto",minWidth:0,textAlign:"center",padding:"10px 6px",cursor:"pointer",
              fontWeight:isActive?800:500,fontSize:12,letterSpacing:0.3,
              color:isActive?"#fff":T.faint,
              background:isActive?"rgba(240,160,40,0.1)":"transparent",
              borderBottom:isActive?"2px solid "+T.gold:"2px solid transparent",
              transition:"all 0.05s",position:"relative"}}
              onClick={function(){
                if(isActive)return;
                setTab(PILLAR_DEFAULTS[p.id]||p.tabs[0].id);
              }}>
              {p.label}
              {hasNotif && React.createElement("span",{style:{position:"absolute",top:5,right:"calc(50% - 20px)",width:7,height:7,borderRadius:"50%",background:T.red}})}
            </div>;
          })}
        </div>
        
        <div style={{background:T.bg,display:"flex",alignItems:"center",gap:2,flexShrink:0,
          position:"sticky",top:76,zIndex:28,padding:"4px 8px",borderBottom:"1px solid "+T.border,
          overflowX:"auto",WebkitOverflowScrolling:"touch",scrollbarWidth:"none",msOverflowStyle:"none"}}>
          {activePillarObj.tabs.map(function(st){
            var isActive2=tab===st.id;
            var isContextual=st.id==="draft"||st.id==="reSign";
            var locked=!isTabUnlocked(st.id,unlocks,godMode);
            return <div key={st.id} style={{padding:"7px 12px",cursor:locked?"not-allowed":"pointer",
              fontWeight:isActive2?700:400,fontSize:11,
              color:locked?T.faint:isActive2?T.gold:isContextual?T.orange:T.faint,
              background:isActive2?"rgba(240,160,40,0.12)":"transparent",
              opacity:locked?0.5:1,
              borderRadius:RAD.sm,whiteSpace:"nowrap",flexShrink:0,
              border:isContextual&&!isActive2?"1px solid rgba(240,160,40,0.3)":"1px solid transparent",
              transition:"all 0.05s"}}
              onClick={function(){
                if(locked){
                  var def=UNLOCK_DEFS.find(function(u){return u.tabs.indexOf(st.id)>=0;});
                  addN("[L] Locked â€” "+(def?"Unlock by: "+def.trigger:"Keep playing to unlock!"),"info");
                  return;
                }
                setTab(st.id);if(st.id==="inbox")setInboxRead(true);
              }}>
              {locked?"[L] ":""}{st.label}
            </div>;
          })}
        </div>
        
        <div style={{flex:1,overflowY:"auto",padding:12}}>
          
          {tab==="home" && (
            <div style={{display:"flex",flexDirection:"column",gap:10}}>

              {/* â•â•â• v98.6: GAME DAY HERO CARD â€” Front and Center! â•â•â• */}
              {season.phase==="regular"&&my&&(function(){
                var nextGame986=sched.find(function(g){return!g.played&&g.week===season.week&&(g.home===myId||g.away===myId);});
                if(!nextGame986)return null;
                var isHome986=nextGame986.home===myId;
                var opp986=teams.find(function(t){return t.id===(isHome986?nextGame986.away:nextGame986.home);});
                if(!opp986)return null;
                var myOvr986=Math.round(avg(my.roster.filter(function(p){return p.isStarter;}),function(p){return p.ovr;}));
                var oppOvr986=Math.round(avg(opp986.roster.filter(function(p){return p.isStarter;}),function(p){return p.ovr;}));
                var edge986=myOvr986-oppOvr986;
                var edgeLabel986=edge986>=8?"BIG ADVANTAGE":edge986>=3?"SLIGHT EDGE":edge986>=-2?"TOSS-UP":edge986>=-7?"UPHILL BATTLE":"UNDERDOG";
                var edgeColor986=edge986>=3?T.green:edge986>=-2?T.gold:T.red;
                var myQB986=my.roster.find(function(p){return p.pos==="QB"&&p.isStarter;});
                var oppQB986=opp986.roster.find(function(p){return p.pos==="QB"&&p.isStarter;});
                var gt97_986=nextGame986.gameType97;
                var isRivalry986=_findRivalObj(my,opp986.id);
                var isPlayoff986=season.phase==="playoffs";
                var primetime986=nextGame986._primetime78;
                return <div style={{
                  padding:0,borderRadius:16,overflow:"hidden",
                  background:"linear-gradient(180deg, #0c1425 0%, #111b30 50%, #0a1020 100%)",
                  border:"1px solid rgba(212,167,75,0.25)",
                  boxShadow:"0 0 40px rgba(212,167,75,0.1), 0 8px 32px rgba(0,0,0,0.5)"
                }}>
                  {/* â•â•â• BROADCAST HEADER â•â•â• */}
                  <div style={{padding:"10px 16px",background:"linear-gradient(90deg, rgba(212,167,75,0.12), transparent, rgba(212,167,75,0.12))",
                    display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid rgba(212,167,75,0.15)"}}>
                    <div style={{display:"flex",alignItems:"center",gap:6}}>
                      <span style={{fontSize:10,fontWeight:900,color:T.gold,letterSpacing:2}}>{"MFSN"}</span>
                      <span style={{width:5,height:5,borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 6px #ef4444"}}/>
                      <span style={{fontSize:8,fontWeight:700,color:"#ef4444",letterSpacing:1}}>{"LIVE"}</span>
                    </div>
                    <div style={{display:"flex",alignItems:"center",gap:8}}>
                      {primetime986&&<span style={{fontSize:8,padding:"2px 8px",borderRadius:10,
                        background:primetime986.color+"15",border:"1px solid "+primetime986.color+"33",
                        color:primetime986.color,fontWeight:700}}>{primetime986.icon+" "+primetime986.abbr}</span>}
                      <span style={{fontSize:9,color:T.dim,fontWeight:600}}>{"Week "+season.week+" â€¢ "+season.year}</span>
                    </div>
                  </div>

                  {/* â•â•â• MATCHUP SHOWCASE â•â•â• */}
                  <div style={{padding:"24px 16px 16px",position:"relative"}}>
                    {/* Rivalry / Playoff banner */}
                    {(isRivalry986&&isRivalry986.heat>=40||isPlayoff986)&&<div style={{textAlign:"center",marginBottom:12}}>
                      {isPlayoff986&&<div style={{fontSize:10,fontWeight:900,letterSpacing:2,color:T.gold,
                        textShadow:"0 0 10px rgba(212,167,75,0.3)"}}>{"ðŸ† PLAYOFFS"}</div>}
                      {isRivalry986&&isRivalry986.heat>=40&&<div style={{fontSize:9,fontWeight:800,color:T.orange,letterSpacing:1}}>
                        {"âš”ï¸ "+(isRivalry986.name||"RIVALRY GAME")}</div>}
                    </div>}

                    <div style={{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:0}}>
                      {/* HOME/USER TEAM */}
                      <div style={{textAlign:"center",flex:1,display:"flex",flexDirection:"column",alignItems:"center"}}>
                        <div style={{width:72,height:72,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",
                          background:"radial-gradient(circle, rgba(212,167,75,0.08), transparent)",
                          border:"2px solid rgba(212,167,75,0.15)",marginBottom:10}}>
                          {React.createElement(TeamLogo,{team:my,size:52})}
                        </div>
                        <div style={{fontWeight:900,fontSize:15,color:T.text,lineHeight:1.2}}>{my.city}</div>
                        <div style={{fontWeight:800,fontSize:12,color:T.gold,lineHeight:1.3}}>{my.name}</div>
                        <div style={{fontSize:11,color:T.dim,marginTop:4,fontWeight:600}}>{my.wins+"-"+my.losses}</div>
                        {myQB986&&<div style={{fontSize:8,color:T.cyan,marginTop:6,padding:"3px 8px",borderRadius:10,
                          background:"rgba(34,211,238,0.06)",border:"1px solid rgba(34,211,238,0.12)"}}>
                          {"QB: "+myQB986.name+" ("+myQB986.ovr+")"}</div>}
                        <div style={{fontSize:22,fontWeight:900,color:T.gold,marginTop:6,fontFamily:"monospace"}}>{myOvr986}</div>
                        <div style={{fontSize:7,color:T.faint,letterSpacing:1,fontWeight:700}}>{"OVR"}</div>
                      </div>

                      {/* VS COLUMN */}
                      <div style={{textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",
                        minWidth:50,paddingTop:20}}>
                        <div style={{fontSize:9,color:T.faint,fontWeight:700,letterSpacing:1,marginBottom:2}}>{isHome986?"HOME":"AWAY"}</div>
                        <div style={{fontSize:11,fontWeight:900,color:"rgba(255,255,255,0.15)",letterSpacing:-1}}>{"VS"}</div>
                        <div style={{width:30,height:1,background:"rgba(212,167,75,0.2)",margin:"8px 0"}}/>
                        <div style={{fontSize:9,color:edgeColor986,fontWeight:800}}>{edgeLabel986}</div>
                        {gt97_986&&<div style={{fontSize:7,padding:"2px 6px",borderRadius:10,marginTop:6,
                          background:gt97_986==="div"?"rgba(251,191,36,0.08)":gt97_986==="conf"?"rgba(59,130,246,0.08)":"rgba(168,85,247,0.08)",
                          border:"1px solid "+(gt97_986==="div"?"rgba(251,191,36,0.15)":gt97_986==="conf"?"rgba(59,130,246,0.15)":"rgba(168,85,247,0.15)"),
                          color:gt97_986==="div"?T.gold:gt97_986==="conf"?"#60a5fa":"#a855f7",fontWeight:700,letterSpacing:0.5}}>
                          {gt97_986==="div"?"DIV":gt97_986==="conf"?"CONF":"X-CONF"}</div>}
                      </div>

                      {/* OPPONENT */}
                      <div style={{textAlign:"center",flex:1,display:"flex",flexDirection:"column",alignItems:"center"}}>
                        <div style={{width:72,height:72,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",
                          background:"radial-gradient(circle, rgba(255,255,255,0.03), transparent)",
                          border:"2px solid rgba(255,255,255,0.06)",marginBottom:10}}>
                          {React.createElement(TeamLogo,{team:opp986,size:52})}
                        </div>
                        <div style={{fontWeight:900,fontSize:15,color:T.text,lineHeight:1.2}}>{opp986.city}</div>
                        <div style={{fontWeight:800,fontSize:12,color:T.dim,lineHeight:1.3}}>{opp986.name}</div>
                        <div style={{fontSize:11,color:T.dim,marginTop:4,fontWeight:600}}>{opp986.wins+"-"+opp986.losses}</div>
                        {oppQB986&&<div style={{fontSize:8,color:T.cyan,marginTop:6,padding:"3px 8px",borderRadius:10,
                          background:"rgba(34,211,238,0.06)",border:"1px solid rgba(34,211,238,0.12)"}}>
                          {"QB: "+oppQB986.name+" ("+oppQB986.ovr+")"}</div>}
                        <div style={{fontSize:22,fontWeight:900,color:"rgba(255,255,255,0.4)",marginTop:6,fontFamily:"monospace"}}>{oppOvr986}</div>
                        <div style={{fontSize:7,color:T.faint,letterSpacing:1,fontWeight:700}}>{"OVR"}</div>
                      </div>
                    </div>
                  </div>

                  {/* â•â•â• MATCHUP EDGE BAR â•â•â• */}
                  <div style={{padding:"0 20px 16px"}}>
                    <div style={{height:6,borderRadius:3,background:"rgba(255,255,255,0.04)",overflow:"hidden",display:"flex",position:"relative"}}>
                      <div style={{width:Math.max(15,Math.min(85,50+edge986*2.5))+"%",height:"100%",
                        background:"linear-gradient(90deg,"+T.green+","+T.gold+")",borderRadius:3,
                        transition:"width 0.5s",boxShadow:"0 0 8px rgba(212,167,75,0.3)"}}/>
                    </div>
                  </div>

                  {/* â•â•â• ACTION BUTTONS â•â•â• */}
                  <div style={{padding:"0 16px 16px",display:"flex",gap:8}}>
                    <button onClick={function(){
                      var hT2=teams.find(function(t){return t.id===nextGame986.home;});
                      var aT2=teams.find(function(t){return t.id===nextGame986.away;});
                      if(!hT2||!aT2){addN("Error: teams not found","red");return;}
                      var lg=LIVE_GAME_986.create(hT2,aT2,myId);
                      lg.isUserPossession=LIVE_GAME_986.isUserPoss(lg);
                      lg._gameRef={home:nextGame986.home,away:nextGame986.away,week:nextGame986.week};
                      AUDIO.play(gamedayTrack||(season.phase==="playoffs"?AUDIO.pickTrack("playoffs",userPlaylist):AUDIO.pickTrack("pregame",userPlaylist)));
                      setLiveGame986(lg);setLiveResult986(null);
                    }} style={{
                      flex:2,padding:"14px 20px",borderRadius:12,cursor:"pointer",fontWeight:900,fontSize:15,
                      background:"linear-gradient(135deg, #d4a74b, #b8860b)",color:"#000",border:"none",
                      boxShadow:"0 4px 15px rgba(212,167,75,0.35), inset 0 1px 0 rgba(255,255,255,0.3)",
                      letterSpacing:1,textTransform:"uppercase"
                    }}>{"ðŸˆ CALL PLAYS"}</button>
                    <button onClick={function(){
                      var hT2=teams.find(function(t){return t.id===nextGame986.home;});
                      var aT2=teams.find(function(t){return t.id===nextGame986.away;});
                      if(!hT2||!aT2){addN("Error: teams not found","red");return;}
                      var res=simGame(hT2,aT2);
                      var decisions972=detectDecisionPoints972(res,hT2,aT2,myId);
                      AUDIO.play(gamedayTrack||(season.phase==="playoffs"?AUDIO.pickTrack("playoffs",userPlaylist):AUDIO.pickTrack("pregame",userPlaylist)));
                      setTheater({result:res,driveIdx:0,speed:"normal",paused:false,
                        homeTeam:hT2,awayTeam:aT2,gameRef:{home:nextGame986.home,away:nextGame986.away,week:nextGame986.week},
                        decisions:decisions972,decisionActive:null});
                    }} style={{
                      flex:1,padding:"14px 12px",borderRadius:12,cursor:"pointer",fontWeight:700,fontSize:11,
                      background:"rgba(255,255,255,0.04)",color:T.text,border:"1px solid rgba(255,255,255,0.08)",
                      transition:"background 0.2s"
                    }}>{"ðŸ“º Watch"}</button>
                    <button onClick={handleGameDayStart977} style={{
                      flex:1,padding:"14px 12px",borderRadius:12,cursor:"pointer",fontWeight:700,fontSize:11,
                      background:"rgba(255,255,255,0.04)",color:T.dim,border:"1px solid rgba(255,255,255,0.08)",
                      transition:"background 0.2s"
                    }}>{"âš¡ Sim"}</button>
                  </div>
                </div>;
              }())}
              {pressConf986&&!pressConf986.answered&&<div style={assign({},cS,{padding:14,border:"2px solid #fbbf24",background:"rgba(251,191,36,0.05)"})}>
                <div style={{fontWeight:900,fontSize:14,color:"#fbbf24",marginBottom:8}}>{"ðŸŽ¤ POST-GAME PRESS CONFERENCE â€” Week "+pressConf986.week}</div>
                <div style={{fontSize:11,color:T.dim,marginBottom:8}}>{pressConf986.won?"You won by "+pressConf986.diff+" points. The media wants to hear from you.":"You lost by "+Math.abs(pressConf986.diff)+". Tough questions incoming."}</div>
                {pressConf986.coachQuote&&<div style={{marginBottom:10,padding:"7px 10px",borderRadius:6,background:"rgba(255,255,255,0.04)",border:"1px solid rgba(251,191,36,0.2)"}}>
                  <div style={{fontSize:8,fontWeight:800,color:T.faint,letterSpacing:1,marginBottom:2}}>{(pressConf986.coachQuote.icon||"")+" COACH â€” OPENING STATEMENT"}</div>
                  <div style={{fontSize:10,fontStyle:"italic",color:T.gold}}>{"\u201c"+pressConf986.coachQuote.text+"\u201d"}</div>
                </div>}
                {(pressConf986.questions||[]).map(function(q,qi){
                  return <div key={qi} style={{marginBottom:10,padding:10,background:"rgba(255,255,255,0.03)",borderRadius:6}}>
                    <div style={{fontWeight:700,fontSize:11,color:T.text,marginBottom:6}}>{"Q"+(qi+1)+": "+q.q}</div>
                    <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                      {Object.entries(PRESS_CONF_986.responses).map(function(entry){
                        var key=entry[0],resp=entry[1];
                        return <button key={key} onClick={function(){
                          var nt986=teams.slice();var mt986=nt986.find(function(t){return t.id===myId;});
                          if(mt986){
                            mt986.roster.forEach(function(p){p.morale=Math.min(99,(p.morale||70)+resp.morale);});
                            if(mt986.owner)mt986.owner.mood=Math.min(100,(mt986.owner.mood||50)+resp.ownerMood);
                          }
                          setTeams(nt986);
                          setPressConf986(assign({},pressConf986,{answered:true}));
                          addN("ðŸŽ¤ You went "+resp.label+" â€” Morale "+(resp.morale>=0?"+":"")+resp.morale+", Owner "+(resp.ownerMood>=0?"+":"")+resp.ownerMood,resp.morale>=0?"green":"yellow");
                        }} style={{padding:"5px 10px",borderRadius:4,border:"1px solid "+T.border,background:"rgba(255,255,255,0.05)",
                          color:T.text,cursor:"pointer",fontSize:10,fontWeight:600}}>
                          {resp.label}
                        </button>;
                      })}
                    </div>
                  </div>;
                })}
              </div>}

              {/* v98.6 #2: TRAINING CAMP â€” Preseason only */}
              {season.phase==="preseason"&&!trainingResult986&&<div style={assign({},cS,{padding:14,border:"2px solid "+T.green})}>
                <div style={{fontWeight:900,fontSize:14,color:T.green,marginBottom:8}}>{"â›º TRAINING CAMP â€” Choose Your Focus"}</div>
                <div style={{fontSize:10,color:T.dim,marginBottom:8}}>{"Allocate camp focus to develop players. Work ethic + coaching staff quality determine gains."}</div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6}}>
                  {TRAINING_CAMP_986.focuses.map(function(focus){
                    var icons={offense:"ðŸˆ",defense:"ðŸ›¡ï¸",conditioning:"ðŸƒ",development:"ðŸ“ˆ",chemistry:"ðŸ¤"};
                    return <button key={focus} onClick={function(){
                      var nt986tc=teams.slice();var mt986tc=nt986tc.find(function(t){return t.id===myId;});
                      if(mt986tc){
                        var results=TRAINING_CAMP_986.run(mt986tc,focus,RNG.ui||Math.random);
                        setTeams(nt986tc);
                        setTrainingResult986({focus:focus,results:results});
                        var stars=results.filter(function(r){return r.type==="star";});
                        var declines=results.filter(function(r){return r.type==="decline";});
                        addN("â›º Training camp ("+focus+"): "+stars.length+" improved, "+declines.length+" declined","cyan");
                        setTimeline986(function(prev){return TIMELINE_986.addEvent(prev,season.year,0,"milestone","Training camp focus: "+focus,"â›º");});
                      }
                    }} style={{padding:"10px 6px",borderRadius:6,border:"1px solid "+T.border,background:"rgba(255,255,255,0.03)",
                      color:T.text,cursor:"pointer",textAlign:"center",fontSize:10}}>
                      <div style={{fontSize:18}}>{icons[focus]||"ðŸ“‹"}</div>
                      <div style={{fontWeight:700,marginTop:4,textTransform:"capitalize"}}>{focus}</div>
                    </button>;
                  })}
                </div>
              </div>}

              {/* v98.6 #2: Training Camp Results */}
              {trainingResult986&&<div style={assign({},cS,{padding:14})}>
                <div style={{fontWeight:900,fontSize:13,color:T.green,marginBottom:6}}>{"â›º CAMP RESULTS â€” "+trainingResult986.focus.toUpperCase()}</div>
                {trainingResult986.results.length===0&&<div style={{color:T.dim,fontSize:11}}>{"No notable changes this camp."}</div>}
                {trainingResult986.results.map(function(r,i){
                  return <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"4px 0",borderBottom:"1px solid "+T.border,fontSize:11}}>
                    <span>{r.name+" ("+r.pos+")"}</span>
                    <span style={{fontWeight:700,color:r.change>0?T.green:"#ef4444"}}>{(r.change>0?"+":"")+r.change+" OVR"}</span>
                  </div>;
                })}
              </div>}

              {/* v98.6 #10: RIVALRY TROPHIES â€” Show current holders */}
              {rivalTrophies986.length>0&&<div style={assign({},cS,{padding:14})}>
                <div style={{fontWeight:900,fontSize:13,color:"#f59e0b",marginBottom:8}}>{"ðŸ† RIVALRY TROPHIES"}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                  {rivalTrophies986.slice(0,6).map(function(tr,i){
                    var isOurs=tr.holder===my.abbr;
                    return <div key={i} style={{padding:8,borderRadius:6,background:isOurs?"rgba(212,167,75,0.1)":"rgba(255,255,255,0.03)",
                      border:isOurs?"1px solid "+T.gold:"1px solid "+T.border}}>
                      <div style={{fontWeight:700,fontSize:10,color:isOurs?T.gold:T.text}}>{tr.name}</div>
                      <div style={{fontSize:9,color:T.dim}}>{tr.icon1+" "+tr.team1+" vs "+tr.icon2+" "+tr.team2}</div>
                      <div style={{fontSize:9,color:tr.holder?T.green:T.faint,marginTop:2}}>{tr.holder?"Held by: "+tr.holder:"Unclaimed"}</div>
                    </div>;
                  })}
                </div>
              </div>}
              
              <div style={mS(S.card,{padding:14})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
                  <div style={{display:"flex",gap:10,alignItems:"center"}}>
                    {React.createElement(TeamLogo,{team:my,size:40})}
                    <div>
                      <div style={{fontWeight:900,fontSize:17}}>{my.city+" "+my.name}</div>
                      <div style={{color:T.dim,fontSize:11}}>{my.wins+"W-"+my.losses+"L"}</div>
                      <div style={{color:T.faint,fontSize:10}}>{"HC: "+my.staff.hc.name+" ("+my.staff.hc.arch+")"}</div>
                    </div>
                  </div>
                  <div style={{textAlign:"right"}}>
                    <div style={{color:T.gold,fontWeight:800,fontSize:16}}>{season.year}</div>
                    <div style={{color:T.dim,fontSize:11}}>{season.phase==="regular"?"Week "+season.week:season.phase==="preseason"?"Preseason Wk "+season.week+"/3":season.phase==="cutDay"?"âœ‚ï¸ CUT DAY":season.phase==="seasonRecap"?"ðŸ† YEAR IN REVIEW":season.phase.toUpperCase()}</div>
                  </div>
                </div>
                
                <div style={{display:"flex",gap:6}}>
                  <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:moodColor(my.ownerMood||70)})}>{my.ownerMood||70}</div><div style={S.kpiLabel}>{"Owner"}</div></div>
                  <div style={S.kpiBox}>{(my&&my.roster)?(function(){var _capUsed=capCalc(my.roster);var _dead=my.deadCap||0;var _theCap=getSalaryCap(season.year);var _space=Math.round((_theCap-_capUsed-_dead)*10)/10;var _capCol=_space>=20?T.green:_space>=5?T.gold:T.red;return React.createElement(React.Fragment,null,React.createElement("div",{style:mS(S.kpiValue,{color:_capCol})},(_space>=0?"$":"$-")+Math.abs(_space).toFixed(0)),React.createElement("div",{style:S.kpiLabel},"Cap $M"));})():React.createElement(React.Fragment,null,React.createElement("div",{style:S.kpiValue},"â€”"),React.createElement("div",{style:S.kpiLabel},"Cap $M"))}</div>
                  <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:T.cyan})}>{my.scoutPts||0}</div><div style={S.kpiLabel}>{"Scout"}</div></div>
                  <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:T.text})}>{my.roster.filter(function(p){return p.injury&&p.injury.games>0;}).length}</div><div style={S.kpiLabel}>{"Injured"}</div></div>
                  <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:T.gold,fontSize:my.ownerGoal&&my.ownerGoal.length>5?11:14})}>{my.ownerGoal||"â€”"}</div><div style={S.kpiLabel}>{"Goal"}</div></div>
                </div>
              </div>

              {(function(){
                var ph=season.phase;var stepIcon="";var stepLabel="";var stepDesc="";var stepBtn=null;var stepNav=null;
                if(ph==="preseason"){
                  stepIcon="â›º";stepLabel="TRAINING CAMP";stepDesc="Preseason Week "+season.week+"/3 â€” Evaluate your roster and set starters.";
                  stepBtn=React.createElement("button",{style:mS(S.btn,S.btnPrimary,{padding:"10px 20px",fontSize:13,flex:2}),onClick:simWeek},"ðŸˆ Sim Preseason Wk "+season.week);
                  stepNav=React.createElement("div",{style:{display:"flex",gap:6}},
                    React.createElement("button",{style:mS(S.btn,{background:"linear-gradient(135deg,"+T.orange+",#d97706)",color:"#000",padding:"10px 10px",fontSize:10,fontWeight:800}),onClick:simEntirePreseason},"â­ Sim All"),
                    React.createElement("button",{style:mS(S.btn,S.btnGhost,{padding:"10px 12px",fontSize:11}),onClick:function(){setTab("roster");}},"ðŸ“‹ Roster"));
                } else if(ph==="cutDay"){
                  stepIcon="âœ‚ï¸";stepLabel="CUT DAY";stepDesc="Trim roster from "+my.roster.length+" to "+ROSTER_CAP+". Cut "+(my.roster.length-ROSTER_CAP)+" players.";
                  stepBtn=React.createElement("button",{style:mS(S.btn,{background:T.orange,color:"#000",padding:"10px 20px",fontSize:13,fontWeight:800,flex:2}),onClick:function(){setTab("roster");}},"ðŸ“‹ Manage Roster");
                  if(my.roster.length<=ROSTER_CAP) stepNav=React.createElement("button",{style:mS(S.btn,{background:T.green,color:"#000",padding:"10px 12px",fontSize:11,fontWeight:800}),onClick:finishCutDay},"âœ… Lock Roster");
                } else if(ph==="regular"&&!done){
                  stepIcon="ðŸˆ";stepLabel="WEEK "+season.week;stepDesc="Regular season â€” sim your next matchup.";
                  stepBtn=React.createElement("button",{style:mS(S.btn,S.btnPrimary,{padding:"10px 20px",fontSize:13,flex:2}),onClick:handleGameDayStart977},"â–¶ Sim Week "+season.week);// v97.7: intercept for pregame flow
                  stepNav=React.createElement("button",{style:mS(S.btn,{background:"linear-gradient(135deg,#8b5cf6,#6d28d9)",color:"#fff",padding:"10px 12px",fontSize:11}),onClick:simSeason},"âš¡ Sim Season");
                } else if(ph==="regular"&&done){
                  stepIcon="ðŸ†";stepLabel="SEASON COMPLETE";stepDesc="All 17 weeks played. Time for the postseason!";
                  stepBtn=React.createElement("button",{style:mS(S.btn,S.btnPrimary,{padding:"10px 20px",fontSize:14,flex:1,boxShadow:SH.glow}),onClick:function(){setSeason(function(s){return assign({},s,{phase:"playoffs"});});}},"ðŸ† Enter the Playoffs");
                } else if(ph==="playoffs"){
                  stepIcon="ðŸ†";stepLabel="PLAYOFFS";stepDesc=poBracket?(poBracket.round==="QF"?"Conference Round 1":poBracket.round==="SF"?"Conference Finals":poBracket.round==="CHAMP"?"Championship":"Championship complete"):"Seed the bracket to begin.";
                } else if(ph==="reSign"){
                  stepIcon="âœï¸";stepLabel="RE-SIGN PHASE";stepDesc=reSignPool.length+" expiring contracts. Keep your core or let them walk to FA.";
                  stepBtn=React.createElement("button",{style:mS(S.btn,{background:"linear-gradient(135deg,#a855f7,#7c3aed)",color:"#fff",padding:"10px 20px",fontSize:13,fontWeight:800,flex:2}),onClick:function(){setTab("reSign");}},"âœï¸ Go to Re-Sign ("+reSignPool.length+")");
                  stepNav=React.createElement("button",{style:mS(S.btn,S.btnGhost,{padding:"10px 12px",fontSize:11}),onClick:function(){skipToTrade();}},"â­ Skip to Draft");
                } else if(ph==="combine"){
                  stepIcon="ðŸ‹ï¸";stepLabel="DRAFT COMBINE";stepDesc="Scout the draft class. Points: "+(my.scoutPts||0)+" remaining.";
                  stepBtn=React.createElement("button",{style:mS(S.btn,{background:"linear-gradient(135deg,"+T.cyan+",#0891b2)",color:"#000",padding:"10px 20px",fontSize:13,fontWeight:800,flex:2}),onClick:function(){setTab("combine");}},"ðŸ” Scout Prospects");
                  stepNav=React.createElement("button",{style:mS(S.btn,S.btnGhost,{padding:"10px 12px",fontSize:11}),onClick:finishCombine},"ðŸ“‹ Start Draft â†’");
                } else if(ph==="draft"){
                  stepIcon="ðŸ“º";stepLabel="DRAFT DAY";stepDesc="Build the future. Review the board and start picking.";
                  stepBtn=React.createElement("button",{style:mS(S.btn,{background:"linear-gradient(135deg,"+T.blue+",#2563eb)",color:"#fff",padding:"10px 20px",fontSize:13,fontWeight:800,flex:1}),onClick:function(){startDraft();}},"ðŸ“º Start the Draft");
                } else if(ph==="drafting"){
                  stepIcon="ðŸ“‹";stepLabel="DRAFT IN PROGRESS";stepDesc="Make your picks! The clock is ticking.";
                  stepBtn=React.createElement("button",{style:mS(S.btn,{background:"linear-gradient(135deg,"+T.blue+",#2563eb)",color:"#fff",padding:"10px 20px",fontSize:14,fontWeight:800,flex:1,boxShadow:SH.glow}),onClick:function(){setTab("draft");}},"ðŸ“‹ Go to Draft Board â†’");
                } else if(ph==="freeAgency"){
                  stepIcon="ðŸª";stepLabel="FREE AGENCY";stepDesc="Sign free agents to fill roster gaps, then start the next season.";
                  stepBtn=React.createElement("button",{style:mS(S.btn,{background:"linear-gradient(135deg,"+T.blue+",#2563eb)",color:"#fff",padding:"10px 20px",fontSize:13,fontWeight:800,flex:2}),onClick:function(){setTab("fa");}},"ðŸª Browse Free Agents");
                  stepNav=React.createElement("button",{style:mS(S.btn,S.btnPrimary,{padding:"10px 12px",fontSize:11}),onClick:newSeason},"â­ Next Season");
                }
                if(!stepIcon)return null;
                return React.createElement("div",{style:mS(S.card,{borderColor:"rgba(251,191,36,0.25)",background:"linear-gradient(135deg,rgba(251,191,36,0.06),rgba(251,191,36,0.02))",padding:12})},
                  React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:(stepBtn||stepNav)?8:0}},
                    React.createElement("span",{style:{fontSize:22}},stepIcon),
                    React.createElement("div",{style:{flex:1}},
                      React.createElement("div",{style:mS(S.header,{fontSize:11,color:T.gold})},stepLabel),
                      React.createElement("div",{style:{fontSize:10,color:T.dim,marginTop:1}},stepDesc)
                    )
                  ),
                  (stepBtn||stepNav)&&React.createElement("div",{style:{display:"flex",gap:8}},stepBtn,stepNav)
                );
              })()}

              {season.phase==="regular"&&!done&&(function(){
                var nextGame=sched.find(function(g){return g.week===season.week&&!g.played&&(g.home===myId||g.away===myId);});
                if(!nextGame) return null;
                var oppId=nextGame.home===myId?nextGame.away:nextGame.home;
                var opp=teams.find(function(t2){return t2.id===oppId;});
                if(!opp) return null;
                var myOvr=Math.round(avg(my.roster.filter(function(p){return p.isStarter&&!(p.injury&&p.injury.games>0);}),function(p){return p.ovr;}));
                var oppOvr=Math.round(avg(opp.roster.filter(function(p){return p.isStarter&&!(p.injury&&p.injury.games>0);}),function(p){return p.ovr;}));
                var myOff=Math.round(avg(my.roster.filter(function(p){return p.isStarter&&POS_DEF[p.pos]&&POS_DEF[p.pos].side==="O";}),function(p){return p.ovr;}));
                var oppOff=Math.round(avg(opp.roster.filter(function(p){return p.isStarter&&POS_DEF[p.pos]&&POS_DEF[p.pos].side==="O";}),function(p){return p.ovr;}));
                var myDef=Math.round(avg(my.roster.filter(function(p){return p.isStarter&&POS_DEF[p.pos]&&POS_DEF[p.pos].side==="D";}),function(p){return p.ovr;}));
                var oppDef=Math.round(avg(opp.roster.filter(function(p){return p.isStarter&&POS_DEF[p.pos]&&POS_DEF[p.pos].side==="D";}),function(p){return p.ovr;}));
                var isHome=nextGame.home===myId;
                return React.createElement("div",{style:mS(S.card,{borderColor:T.gold,background:"rgba(251,191,36,0.04)",padding:12})},
                  React.createElement("div",{style:{fontWeight:800,fontSize:12,color:T.gold,marginBottom:8,textAlign:"center"}},"ðŸ¥Š WEEK "+season.week+" MATCHUP"),
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}},
                    React.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1}},
                      React.createElement(TeamLogo,{team:my,size:36}),
                      React.createElement("div",{style:{fontWeight:800,fontSize:12,marginTop:3}},my.abbr),
                      React.createElement("div",{style:{fontSize:9,color:T.dim}},my.wins+"W-"+my.losses+"L"),
                      React.createElement("div",{style:{fontSize:9,color:T.faint}},isHome?"ðŸ  HOME":"âœˆï¸ AWAY")
                    ),
                    React.createElement("div",{style:{textAlign:"center",padding:"0 8px"}},
                      React.createElement("div",{style:{fontSize:22,fontWeight:900,color:T.gold}},"VS")
                    ),
                    React.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1}},
                      React.createElement(TeamLogo,{team:opp,size:36}),
                      React.createElement("div",{style:{fontWeight:800,fontSize:12,marginTop:3}},opp.abbr),
                      React.createElement("div",{style:{fontSize:9,color:T.dim}},opp.wins+"W-"+opp.losses+"L"),
                      React.createElement("div",{style:{fontSize:9,color:T.faint}},isHome?"âœˆï¸ AWAY":"ðŸ  HOME")
                    )
                  ),
                  React.createElement("div",{style:{display:"flex",gap:4,marginTop:4}},
                    ["OVR","OFF","DEF"].map(function(lbl,li){
                      var myV=li===0?myOvr:li===1?myOff:myDef;
                      var oppV=li===0?oppOvr:li===1?oppOff:oppDef;
                      var adv=myV>oppV?T.green:myV<oppV?T.red:T.dim;
                      return React.createElement("div",{key:lbl,style:{flex:1,textAlign:"center",background:T.bg3,borderRadius:4,padding:4}},
                        React.createElement("div",{style:{fontSize:8,color:T.faint}},lbl),
                        React.createElement("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center"}},
                          React.createElement("span",{style:{fontWeight:800,fontSize:13,color:myV>=oppV?T.green:T.dim}},myV||"?"),
                          React.createElement("span",{style:{fontSize:8,color:T.faint}},"-"),
                          React.createElement("span",{style:{fontWeight:800,fontSize:13,color:oppV>=myV?T.green:T.dim}},oppV||"?")
                        )
                      );
                    })
                  ),
                  (function(){
                    var myOffP=OFF_PLANS.find(function(x){return x.id===(my.gameplanOff||"balanced_o");})||OFF_PLANS[0];
                    var myDefP=DEF_PLANS.find(function(x){return x.id===(my.gameplanDef||"balanced_d");})||DEF_PLANS[0];
                    var oppOffP=OFF_PLANS.find(function(x){return x.id===aiPickOffGPPreview(opp);})||OFF_PLANS[0];
                    var oppDefP=DEF_PLANS.find(function(x){return x.id===aiPickDefGPPreview(opp);})||DEF_PLANS[0];
                    var myOffBonus=(SCHEME_COUNTERS[myOffP.id]||{})[oppDefP.id]||0;
                    var oppOffBonus=(SCHEME_COUNTERS[oppOffP.id]||{})[myDefP.id]||0;
                    return React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginTop:8}},
                      React.createElement("div",{style:{background:T.bg3,borderRadius:6,padding:6,textAlign:"center"}},
                        React.createElement("div",{style:{fontSize:8,color:T.faint}},"YOUR OFFENSE"),
                        React.createElement("div",{style:{fontSize:11,fontWeight:700}},myOffP.icon+" "+myOffP.name),
                        React.createElement("div",{style:{fontSize:9,color:myOffBonus>0?T.green:myOffBonus<0?T.red:T.faint}},
                          "vs "+oppDefP.icon+" â†’ "+(myOffBonus>0?"+":"")+myOffBonus+" matchup")
                      ),
                      React.createElement("div",{style:{background:T.bg3,borderRadius:6,padding:6,textAlign:"center"}},
                        React.createElement("div",{style:{fontSize:8,color:T.faint}},"YOUR DEFENSE"),
                        React.createElement("div",{style:{fontSize:11,fontWeight:700}},myDefP.icon+" "+myDefP.name),
                        React.createElement("div",{style:{fontSize:9,color:oppOffBonus<0?T.green:oppOffBonus>0?T.red:T.faint}},
                          "vs "+oppOffP.icon+" â†’ "+(oppOffBonus>0?"+":"")+oppOffBonus+" for them")
                      )
                    );
                  })(),
                  (function(){
                    var storylines=[];
                    var revengePlayers=opp.roster.filter(function(p){return p.formerTeam===myId&&p.ovr>=65;});
                    revengePlayers.forEach(function(rp){storylines.push({icon:"ðŸ”¥",text:rp.name+" ("+rp.pos+" "+rp.ovr+") â€” REVENGE GAME",color:T.red});});
                    if(opp.staff&&opp.staff.hc&&opp.staff.hc.formerTeam===myId){
                      storylines.push({icon:"ðŸŽ“",text:"Master vs Apprentice: "+opp.staff.hc.name+" (your former "+opp.staff.hc.formerRole+")",color:T.purple});
                    }
                    var myRevenge=my.roster.filter(function(p){return p.formerTeam===oppId&&p.ovr>=65;});
                    myRevenge.forEach(function(rp){storylines.push({icon:"ðŸ’ª",text:rp.name+" faces old team!",color:T.cyan});});
                    var revInfo75=REVENGE_GAME.check(my,opp,season.rivalries?Object.keys(season.rivalries).map(function(k){return season.rivalries[k];}):[])
                    if(revInfo75){
                      if(revInfo75.revengeTeam===myId)storylines.push({icon:"ðŸ”¥",text:"REVENGE GAME â€” You've lost "+revInfo75.streak+" straight! (+"+revInfo75.bonus+" morale boost)",color:"#ef4444"});
                      else if(revInfo75.revengeTeam===oppId)storylines.push({icon:"âš ï¸",text:"BEWARE â€” "+opp.abbr+" is out for revenge ("+revInfo75.streak+" game losing streak to you)!",color:T.orange});
                      else if(revInfo75.isHeatRivalry)storylines.push({icon:"ðŸ”¥",text:revInfo75.label+" â€” Heat level "+revInfo75.heat+"!",color:T.red});
                    }
                    if(storylines.length===0) return null;
                    return React.createElement("div",{style:{marginTop:8,borderTop:"1px solid "+T.border,paddingTop:6}},
                      storylines.map(function(sl,si){
                        return React.createElement("div",{key:si,style:{fontSize:10,fontWeight:700,color:sl.color,padding:"2px 0"}},sl.icon+" "+sl.text);
                      })
                    );
                  })()
                );
              })()}

              {/* v96: PROMINENT GAME SCOREBOARD â€” first thing you see after team card */}
              {lastGameCtx&&season.phase==="regular"&&(function(){
                var lg=lastGameCtx;
                var winBg=lg.won?"linear-gradient(135deg,rgba(16,185,129,0.12),rgba(16,185,129,0.03))":"linear-gradient(135deg,rgba(239,68,68,0.12),rgba(239,68,68,0.03))";
                var winBorder=lg.won?"rgba(16,185,129,0.35)":"rgba(239,68,68,0.35)";
                var resultLabel=lg.won?"VICTORY":"DEFEAT";
                var resultColor=lg.won?T.green:T.red;
                var streakText=Math.abs(lg.streak||0)>=2?((lg.streak>0?"ðŸ”¥ "+lg.streak+"W Streak":"â„ï¸ "+Math.abs(lg.streak)+"L Streak")):"";
                return React.createElement("div",{style:{background:winBg,border:"2px solid "+winBorder,borderRadius:12,padding:"14px 16px",marginBottom:0}},
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}},
                    React.createElement("div",{style:{fontSize:9,fontWeight:800,color:resultColor,letterSpacing:2,textTransform:"uppercase"}},resultLabel),
                    streakText?React.createElement("div",{style:{fontSize:9,fontWeight:700,color:lg.won?T.gold:T.orange,background:"rgba(0,0,0,0.3)",padding:"2px 8px",borderRadius:10}},streakText):null
                  ),
                  React.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:20,marginBottom:10}},
                    React.createElement("div",{style:{textAlign:"center"}},
                      React.createElement("div",{style:{fontSize:11,fontWeight:700,color:T.text,marginBottom:2}},my.icon+" "+my.abbr),
                      React.createElement("div",{style:{fontSize:32,fontWeight:900,color:lg.won?T.green:T.text}},lg.scoreFor)
                    ),
                    React.createElement("div",{style:{fontSize:14,color:T.faint,fontWeight:300}},"â€”"),
                    React.createElement("div",{style:{textAlign:"center"}},
                      React.createElement("div",{style:{fontSize:11,fontWeight:700,color:T.dim,marginBottom:2}},lg.opp),
                      React.createElement("div",{style:{fontSize:32,fontWeight:900,color:lg.won?T.dim:T.red}},lg.scoreAgainst)
                    )
                  ),
                  React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:12,flexWrap:"wrap"}},
                    React.createElement("span",{style:{fontSize:9,color:T.dim,fontWeight:600}},"ðŸŽ¯ "+lg.passTD+" Pass TD"),
                    React.createElement("span",{style:{fontSize:9,color:T.dim,fontWeight:600}},"ðŸƒ "+lg.rushYds+" Rush Yds"),
                    React.createElement("span",{style:{fontSize:9,color:T.dim,fontWeight:600}},"ðŸ’¥ "+lg.sacks+" Sacks"),
                    React.createElement("span",{style:{fontSize:9,color:lg.ints>0?T.red:T.green,fontWeight:600}},(lg.ints>0?"âš ï¸ ":"âœ… ")+lg.ints+" INT")
                  ),
                  gameRecap?React.createElement("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid rgba(255,255,255,0.06)"}},
                    React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.blue,marginBottom:6}},"ðŸ“Š WHY YOU "+(gameRecap.score>gameRecap.oppScore?"WON":"LOST")),
                    React.createElement("div",{style:{display:"flex",gap:8,marginBottom:4}},
                      React.createElement("div",{style:{textAlign:"center",flex:1}},React.createElement("div",{style:{fontSize:8,color:T.faint}},"POCKET"),React.createElement("div",{style:{fontSize:13,fontWeight:800,color:gameRecap.pressureRate>=50?T.green:T.red}},gameRecap.pressureRate)),
                      React.createElement("div",{style:{textAlign:"center",flex:1}},React.createElement("div",{style:{fontSize:8,color:T.faint}},"COV"),React.createElement("div",{style:{fontSize:13,fontWeight:800,color:gameRecap.coverageWin>=50?T.green:T.red}},gameRecap.coverageWin)),
                      React.createElement("div",{style:{textAlign:"center",flex:1}},React.createElement("div",{style:{fontSize:8,color:T.faint}},"RUN"),React.createElement("div",{style:{fontSize:13,fontWeight:800,color:gameRecap.runLaneAdv>=50?T.green:T.red}},gameRecap.runLaneAdv)),
                      React.createElement("div",{style:{textAlign:"center",flex:1}},React.createElement("div",{style:{fontSize:8,color:T.faint}},"TO"),React.createElement("div",{style:{fontSize:13,fontWeight:800,color:gameRecap.turnovers>0?T.red:T.green}},gameRecap.turnovers)),
                      React.createElement("div",{style:{textAlign:"center",flex:1}},React.createElement("div",{style:{fontSize:8,color:T.faint}},"RZ%"),React.createElement("div",{style:{fontSize:13,fontWeight:800,color:gameRecap.rzEff>=50?T.green:T.red}},gameRecap.rzEff))
                    ),
                    React.createElement("div",{style:{fontSize:10,color:T.gold,fontWeight:600}},"ðŸ’¡ "+gameRecap.fix)
                  ):null
                );
              })()}
              
              {(ownerGoals.length>0||coachGoals.length>0||playerGoals.length>0) && (
                <div style={mS(S.card,{padding:12,borderColor:"rgba(251,191,36,0.15)"})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                    <div style={{fontSize:11,fontWeight:800,color:T.gold}}>{"ðŸŽ¯ SEASON GOALS"}</div>
                    <div style={{fontSize:10,color:T.dim}}>
                      {(function(){
                        var all=[].concat(ownerGoals,coachGoals,playerGoals.map(function(pg){return pg.goal;}));
                        var done=all.filter(function(g){return g&&g.status==="completed";}).length;
                        return done+"/"+all.length+" complete";
                      })()}
                    </div>
                  </div>
                  {ownerGoals.map(function(g,i){
                    return <div key={"og"+i} style={{fontSize:10,padding:"3px 0",display:"flex",justifyContent:"space-between",borderBottom:"1px solid "+T.border}}>
                      <span style={{color:g.status==="completed"?T.green:g.status==="failed"?T.red:T.text}}>{(g.status==="completed"?"âœ… ":g.status==="failed"?"âŒ ":"ðŸ›ï¸ ")+g.label}</span>
                      <span style={{color:T.dim,fontSize:9}}>{"Owner"}</span>
                    </div>;
                  })}
                  {coachGoals.map(function(g,i){
                    return <div key={"cg"+i} style={{fontSize:10,padding:"3px 0",display:"flex",justifyContent:"space-between",borderBottom:"1px solid "+T.border}}>
                      <span style={{color:g.status==="completed"?T.green:g.status==="failed"?T.red:T.text}}>{(g.status==="completed"?"âœ… ":g.status==="failed"?"âŒ ":"ðŸ“‹ ")+g.label}</span>
                      <span style={{color:T.dim,fontSize:9}}>{"Coach"}</span>
                    </div>;
                  })}
                  {playerGoals.slice(0,5).map(function(pg,i){
                    var g=pg.goal;if(!g)return null;
                    var pct=g.target>0&&g.compare!=="lte"?Math.min(100,Math.round((g.current||0)/g.target*100)):null;
                    return <div key={"pg"+i} style={{fontSize:10,padding:"3px 0",borderBottom:"1px solid "+T.border}}>
                      <div style={{display:"flex",justifyContent:"space-between"}}>
                        <span style={{color:g.status==="completed"?T.green:g.status==="failed"?T.red:T.text}}>{(g.status==="completed"?"âœ… ":"â­ ")+pg.playerName+": "+g.label}</span>
                        <span style={{color:T.dim,fontSize:9}}>{pct!==null?(g.current||0)+"/"+g.target:""}</span>
                      </div>
                      {pct!==null && g.status==="active" && <div style={{height:3,background:T.bg3,borderRadius:2,marginTop:2}}>
                        <div style={{height:3,borderRadius:2,background:pct>=75?T.green:pct>=40?T.gold:T.dim,width:pct+"%"}}/>
                      </div>}
                    </div>;
                  })}
                  {playerGoals.length>5 && <div style={{fontSize:9,color:T.faint,textAlign:"center",marginTop:4}}>{"+"+(playerGoals.length-5)+" more player goals"}</div>}
                </div>
              )}
              
              <div style={{display:"flex",gap:6}}>
                {(function(){var fit=calcTeamFit(my);return(
                  <div style={mS(S.kpiBox,{flex:1,cursor:"pointer"})} onClick={function(){setTab("roster");}}>
                    <div style={mS(S.kpiValue,{color:fit.total>=80?T.green:fit.total>=65?T.gold:T.red,fontSize:14})}>{fit.total}</div>
                    <div style={S.kpiLabel}>{"Identity Fit"}</div>
                  </div>
                );})()}
                <div style={mS(S.kpiBox,{flex:1})}>
                  <div style={mS(S.kpiValue,{color:T.orange,fontSize:14})}>{my.rivals?my.rivals.filter(function(r){return r.heat>=20;}).length:0}</div>
                  <div style={S.kpiLabel}>{"Rivals"}</div>
                </div>
                {(function(){
                  var legStats91=LEGACY.buildStats(history,myId,teams,season);
                  var legResult91=LEGACY.calcScore(legStats91);
                  var legColor91=legResult91.score>=90?T.gold:legResult91.score>=75?T.green:legResult91.score>=60?T.cyan:legResult91.score>=45?T.text:T.dim;
                  return React.createElement("div",{style:mS(S.kpiBox,{flex:1,cursor:"pointer",borderColor:legColor91+"44"}),onClick:function(){setShowLegacy(true);}},
                    React.createElement("div",{style:mS(S.kpiValue,{color:legColor91,fontSize:14})},history.length>0?legResult91.score:"â€”"),
                    React.createElement("div",{style:S.kpiLabel},history.length>0?legResult91.tier:"Legacy"),
                    history.length>0&&React.createElement("div",{style:{fontSize:7,color:T.faint,marginTop:1}},legStats91.rings>0?"ðŸ†Ã—"+legStats91.rings:"0 rings")
                  );
                })()}
              </div>
              
              {(function(){var activeS=stories.filter(function(s){return !s.resolved;});
                if(activeS.length===0)return null;
                return React.createElement("div",{style:mS(S.card,{borderColor:"rgba(245,158,11,0.2)",background:"rgba(245,158,11,0.04)",padding:10})},
                  React.createElement("div",{style:{fontSize:10,fontWeight:800,color:T.orange,marginBottom:4}},"ðŸ“° ACTIVE STORYLINES"),
                  activeS.map(function(s){var tmpl=STORY_TEMPLATES.find(function(t2){return t2.id===s.templateId;});
                    return React.createElement("div",{key:s.id,style:{fontSize:10,padding:"3px 0",borderBottom:"1px solid "+T.border,cursor:"pointer"},
                      onClick:function(){setTab("stories");}},
                      React.createElement("span",null,(tmpl?tmpl.icon:"")+" "),
                      React.createElement("span",{style:{fontWeight:700}},tmpl?tmpl.type:""),
                      React.createElement("span",{style:{color:T.dim}}," â€” "+(tmpl?tmpl.states[s.stateIdx]:"")),
                      React.createElement("span",{style:{fontSize:8,color:T.orange,marginLeft:6}},"Expires Wk "+s.weekExpires)
                    );})
                );})()}

              {my&&(function(){
                // v96.1: TRAIT SPOTLIGHT â€” redesigned with clear explanations of what each trait DOES
                var allMyP=(my.roster||[]).filter(function(p){return p&&p.isStarter;});
                var traitPlayers=allMyP.filter(function(p){return Array.isArray(p.traits95)&&p.traits95.filter(function(t){return t!=="none"&&TRAITS[t];}).length>=1;})
                  .sort(function(a,b){return ((b.traits95||[]).length-(a.traits95||[]).length)||((b.ovr||0)-(a.ovr||0));})
                  .slice(0,5);
                if(traitPlayers.length===0)return null;
                // Build trait effect labels
                var FX_LABELS={morale:"Morale",media:"Media",dev:"Development",clutch:"Clutch",injury:"Injury Risk"};
                var FX_COLORS={morale:"#a78bfa",media:"#22d3ee",dev:"#4ade80",clutch:"#fbbf24",injury:"#f87171"};
                return React.createElement("div",{style:{background:"rgba(167,139,250,0.04)",border:"1px solid rgba(167,139,250,0.2)",borderRadius:10,padding:"10px 12px",marginBottom:0}},
                  React.createElement("div",{style:{fontWeight:900,fontSize:10,color:"#a78bfa",letterSpacing:1,marginBottom:2}},"ðŸŽ­ TRAIT SPOTLIGHT"),
                  React.createElement("div",{style:{fontSize:9,color:T.dim,marginBottom:8,lineHeight:1.4}},"Traits are permanent personality tags that affect how players perform, develop, and behave. Multi-trait players have compounding effects. Tap a player for full detail."),
                  traitPlayers.map(function(p){
                    var tks=(p.traits95||[]).filter(function(tk){return tk!=="none"&&TRAITS[tk];});
                    // Build synergy list
                    var synergies=[];
                    if(tks.indexOf("gym_rat")>=0&&tks.indexOf("chip")>=0)synergies.push({label:"BREAKOUT MACHINE",desc:"Stacked dev bonuses push OVR fast",icon:"ðŸ’¥"});
                    if(tks.indexOf("captain")>=0&&tks.indexOf("mentor")>=0)synergies.push({label:"DYNASTY BUILDER",desc:"Morale + rookie dev on the same guy",icon:"ðŸ‘‘"});
                    if(tks.indexOf("clutch")>=0&&tks.indexOf("showtime")>=0)synergies.push({label:"PRIME TIME",desc:"Clutch + fanbase boosts in big games",icon:"â­"});
                    if(tks.indexOf("ironman")>=0&&tks.indexOf("workhorse")>=0)synergies.push({label:"IRON WORKHORSE",desc:"Near-zero injury risk, always available",icon:"ðŸ¦¾"});
                    if(tks.indexOf("comeback_kid")>=0&&tks.indexOf("clutch")>=0)synergies.push({label:"ICE IN A CRISIS",desc:"Massive clutch swing when trailing",icon:"ðŸ§Š"});
                    if(tks.indexOf("vocal_leader")>=0&&tks.indexOf("captain")>=0)synergies.push({label:"TEAM CORNERSTONE",desc:"Double morale anchor for the locker room",icon:"ðŸ†"});
                    // Active alerts
                    var alerts=[];
                    if(tks.indexOf("late_bloomer")>=0&&p.age>=27&&p.age<=32)alerts.push("ðŸŒ± Peak dev window NOW (age "+p.age+")");
                    if(tks.indexOf("chip")>=0&&p.devTrait==="normal"&&p.age<=26)alerts.push("ðŸ˜¤ Elevated breakout odds this season");
                    if(tks.indexOf("hothead")>=0&&(my.streak||0)<=-2)alerts.push("ðŸŒ¶ï¸ Losing streak â€” penalty & clutch risk!");
                    if(tks.indexOf("comeback_kid")>=0&&(my.wins||0)<=(my.losses||0))alerts.push("ðŸ”„ Losing record â€” comeback clutch active");
                    // Milestone badges
                    if(p.traitPowerLevel95){
                      Object.keys(p.traitPowerLevel95).forEach(function(tk){
                        var lvl=p.traitPowerLevel95[tk];var tName=TRAITS[tk]?TRAITS[tk].name:tk;
                        alerts.push("ðŸ… "+tName+" MILESTONE Lv"+lvl+(lvl>=2?" â­â­":" â­"));
                      });
                    }
                    return React.createElement("div",{key:p.id,style:{background:"rgba(167,139,250,0.07)",borderRadius:8,padding:"8px 10px",marginBottom:6,cursor:"pointer",border:"1px solid rgba(167,139,250,0.15)"},
                      onClick:function(){setPlayerDetail(p);}},
                      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}},
                        React.createElement("div",{style:{fontWeight:800,fontSize:12,color:"#e2e8f0"}},p.name),
                        React.createElement("div",{style:{fontSize:10,color:"#94a3b8"}},p.pos+" Â· "+p.ovr+" OVR Â· Age "+p.age)
                      ),
                      tks.map(function(tk,ti){
                        var tO=TRAITS[tk];var fx=TRAIT_FX[tk]||{};
                        var fxPills=Object.keys(fx).filter(function(k){return fx[k]!==0;}).map(function(k){
                          return{key:k,val:fx[k],label:FX_LABELS[k]||k,color:FX_COLORS[k]||T.dim};
                        });
                        return React.createElement("div",{key:ti,style:{marginBottom:ti<tks.length-1?5:0,paddingBottom:ti<tks.length-1?5:0,borderBottom:ti<tks.length-1?"1px solid rgba(167,139,250,0.1)":"none"}},
                          React.createElement("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:2}},
                            React.createElement("span",{style:{fontSize:14}},tO.icon||"?"),
                            React.createElement("span",{style:{fontWeight:700,fontSize:11,color:"#c4b5fd"}},tO.name),
                            React.createElement("span",{style:{fontSize:9,color:T.dim}}," â€” "+tO.desc)
                          ),
                          React.createElement("div",{style:{display:"flex",gap:3,flexWrap:"wrap",marginLeft:22}},
                            fxPills.map(function(fp,fi){
                              return React.createElement("span",{key:fi,style:{fontSize:8,padding:"1px 5px",borderRadius:3,fontWeight:700,
                                background:fp.val>0?"rgba(74,222,128,0.10)":"rgba(248,113,113,0.10)",
                                color:fp.val>0?"#4ade80":"#f87171",
                                border:"1px solid "+(fp.val>0?"rgba(74,222,128,0.2)":"rgba(248,113,113,0.2)")}},
                                fp.label+" "+(fp.val>0?"+":"")+fp.val);
                            })
                          )
                        );
                      }),
                      synergies.length>0&&React.createElement("div",{style:{marginTop:4}},synergies.map(function(sy,si){
                        return React.createElement("div",{key:si,style:{fontSize:9,color:"#fbbf24",background:"rgba(251,191,36,0.10)",padding:"2px 6px",borderRadius:4,marginTop:2,fontWeight:700}},
                          sy.icon+" "+sy.label+" â€” "+sy.desc);
                      })),
                      alerts.length>0&&React.createElement("div",{style:{marginTop:3}},alerts.map(function(al,ai){
                        return React.createElement("div",{key:ai,style:{fontSize:9,color:"#c4b5fd",marginTop:1}},al);
                      }))
                    );
                  })
                );
              })()}

              {season.phase==="regular"&&my&&(function(){
                var pr76=PRACTICE_REPORT.generate(my,season.week);
                if(!pr76)return null;
                // v93.19: Use pracStarBoost as authoritative star data when available (avoids random re-render mismatch)
                var starDisplay=pracStarBoost&&pracStarBoost.week===season.week
                  ?{id:pracStarBoost.playerId,name:pracStarBoost.name,pos:pracStarBoost.pos,ovr:pracStarBoost.ovr,reason:pr76.practiceStar?pr76.practiceStar.reason:"dominated practice all week"}
                  :pr76.practiceStar;
                var hasBoost=pracStarBoost&&pracStarBoost.week===season.week;
                return React.createElement("div",{style:mS(S.card,{padding:12,borderColor:"rgba(16,185,129,0.15)",background:"rgba(16,185,129,0.03)"})},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.green,marginBottom:8}},"ðŸ“‹ WEEKLY PRACTICE REPORT â€” Week "+season.week),
                  starDisplay?React.createElement("div",{style:{fontSize:11,padding:"6px 10px",borderRadius:6,background:"rgba(251,191,36,0.12)",border:"1px solid rgba(251,191,36,0.3)",marginBottom:6}},
                    React.createElement("div",{style:{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}},
                      React.createElement("span",{style:{fontSize:14}},"â­"),
                      React.createElement("span",{style:{fontWeight:800,color:T.gold}},starDisplay.name),
                      React.createElement("span",{style:{fontSize:10,color:T.dim}},"("+starDisplay.pos+")"),
                      hasBoost
                        ?React.createElement("span",{style:{fontWeight:800,color:"#4ade80",fontSize:12,background:"rgba(74,222,128,0.12)",padding:"1px 6px",borderRadius:4}},
                          "+"+pracStarBoost.boost+" OVR ("+pracStarBoost.ovr+" â†’ "+pracStarBoost.ovrAfter+")")
                        :React.createElement("span",{style:{fontSize:10,color:T.gold,fontWeight:700}},starDisplay.ovr+" OVR")
                    ),
                    React.createElement("div",{style:{fontSize:10,color:T.dim,marginTop:3}},"â€” "+starDisplay.reason),
                    hasBoost
                      ?React.createElement("div",{style:{fontSize:9,color:"#4ade80",marginTop:2,fontStyle:"italic"}},"ðŸ”¥ Hot week â€” boosted for Week "+season.week+" only")
                      :null,
                    hasBoost&&pracStarBoost.attrBreakdown&&pracStarBoost.attrBreakdown.length>0
                      ?React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginTop:5}},
                        pracStarBoost.was3x?React.createElement("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:4,background:"rgba(251,191,36,0.15)",border:"1px solid rgba(251,191,36,0.3)",color:T.gold,fontWeight:800}},"ðŸ”¥ 3x CHALLENGE BOOST"):null,
                        pracStarBoost.attrBreakdown.map(function(ab,abi){
                          return React.createElement("span",{key:"ab"+abi,style:{fontSize:10,padding:"2px 8px",borderRadius:4,
                            background:pracStarBoost.was3x?"rgba(251,191,36,0.15)":"rgba(74,222,128,0.12)",border:"1px solid "+(pracStarBoost.was3x?"rgba(251,191,36,0.3)":"rgba(74,222,128,0.25)"),color:pracStarBoost.was3x?T.gold:"#4ade80",fontWeight:800}},
                            (ab.label||ab.attr||"?")+" +"+ab.val);
                        })
                      ):null
                  ):null,
                  React.createElement("div",{style:{display:"flex",gap:8,marginBottom:6}},
                    React.createElement("div",{style:{flex:1,fontSize:10,color:T.dim}},
                      "ðŸ“Š Scheme Install: ",React.createElement("span",{style:{color:pr76.schemePct>=80?T.green:pr76.schemePct>=50?T.gold:T.dim,fontWeight:700}},pr76.schemePct+"%")
                    ),
                    React.createElement("div",{style:{flex:1,fontSize:10,color:T.dim}},
                      "ðŸ¤• Injury Report: ",React.createElement("span",{style:{fontWeight:700,color:pr76.injuryReport.length>3?T.red:pr76.injuryReport.length>0?T.orange:T.green}},pr76.injuryReport.length===0?"All Healthy":pr76.injuryReport.length+" players")
                    )
                  ),
                  pr76.injuryReport.length>0?React.createElement("div",{style:{borderTop:"1px solid "+T.border,paddingTop:4}},
                    pr76.injuryReport.slice(0,5).map(function(ir,i){
                      var sColor=ir.status==="DNP"?T.red:ir.status==="Limited"?T.orange:T.green;
                      return React.createElement("div",{key:"ir"+i,style:{fontSize:10,display:"flex",justifyContent:"space-between",padding:"2px 0"}},
                        React.createElement("span",null,(ir.isStarter?"âš¡ ":"")+ir.name+" ("+ir.pos+" "+ir.ovr+")"),
                        React.createElement("span",null,
                          React.createElement("span",{style:{color:sColor,fontWeight:700,marginRight:6}},ir.status),
                          React.createElement("span",{style:{color:T.faint,fontSize:9}},ir.injury+" ("+ir.games+"wk)")
                        )
                      );
                    }),
                    pr76.injuryReport.length>5?React.createElement("div",{style:{fontSize:9,color:T.faint,textAlign:"center",marginTop:2}},"+"+(pr76.injuryReport.length-5)+" more"):null
                  ):null
                );
              })()}

              {/* v95.8: TRAIT ACTIVITY LOG â€” derived from roster state, no new state needed */}
              {my&&season.phase==="regular"&&(function(){
                var myRoster=my.roster||[];
                var activities=[];
                // Ironman: any player who has hasTrait95 ironman and no injury
                var ironmen=myRoster.filter(function(p){return hasTrait95(p,"ironman")&&p.isStarter&&!(p.injury&&p.injury.games>0);});
                if(ironmen.length>0){var im0=ironmen[0];ironmen.forEach(function(ip){var ipPL=(ip&&ip.traitPowerLevel95&&ip.traitPowerLevel95["ironman"])||0;var im0PL=(im0&&im0.traitPowerLevel95&&im0.traitPowerLevel95["ironman"])||0;if(ipPL>im0PL)im0=ip;});var imPL=(im0.traitPowerLevel95&&im0.traitPowerLevel95["ironman"])||0;var imStar=imPL>=2?"â­â­ ":imPL>=1?"â­ ":"";activities.push({icon:"ðŸ¦¾",text:imStar+im0.name+(ironmen.length>1?" + "+(ironmen.length-1)+" more":"")+" with injury-skip chance active"+(imPL>0?" [POWERED Lv"+imPL+"]":""),color:"#4ade80"});}
                // Vocal Leader: if team has losing streak, morale floor active
                var vocalLeaders=myRoster.filter(function(p){return hasTrait95(p,"vocal_leader")&&p.isStarter&&!(p.injury&&p.injury.games>0);});
                if(vocalLeaders.length>0&&(my.streak||0)<0){var vl0=vocalLeaders[0];vocalLeaders.forEach(function(vp){var vpPL=(vp&&vp.traitPowerLevel95&&vp.traitPowerLevel95["vocal_leader"])||0;var vl0PL=(vl0&&vl0.traitPowerLevel95&&vl0.traitPowerLevel95["vocal_leader"])||0;if(vpPL>vl0PL)vl0=vp;});var vlPL=(vl0.traitPowerLevel95&&vl0.traitPowerLevel95["vocal_leader"])||0;var vlFloor=vlPL>=2?52:vlPL>=1?48:45;activities.push({icon:"ðŸ“¢",text:vl0.name+" holding morale floor at "+vlFloor,color:"#a78bfa"});}
                // Showtime: track fanbase (show if gaining)
                var showtimers=myRoster.filter(function(p){return hasTrait95(p,"showtime")&&p.isStarter&&!(p.injury&&p.injury.games>0);});
                if(showtimers.length>0&&(my.streak||0)>0)activities.push({icon:"ðŸŽ­",text:showtimers[0].name+" building fanbase (+"+(my.streak||1)+" win streak)",color:"#f59e0b"});
                // Gym Rat: developing without snaps
                var gymRats=myRoster.filter(function(p){return hasTrait95(p,"gym_rat")&&!(p.injury&&p.injury.games>0)&&p.stats&&(p.stats.snaps||0)<50;});
                if(gymRats.length>0)activities.push({icon:"ðŸ€",text:gymRats[0].name+" developing in the gym (low snaps, still growing)",color:"#22d3ee"});
                // Hothead + close losses = warning
                var hotheads=myRoster.filter(function(p){return hasTrait95(p,"hothead")&&p.isStarter&&!(p.injury&&p.injury.games>0);});
                if(hotheads.length>0&&(my.streak||0)<=-1)activities.push({icon:"ðŸŒ¶ï¸",text:hotheads[0].name+" HOTHEAD on a losing streak â€” 4Q clutch risk!",color:"#ef4444"});
                // Comeback Kid + losing = active
                var cbk=myRoster.filter(function(p){return hasTrait95(p,"comeback_kid")&&p.isStarter&&!(p.injury&&p.injury.games>0)&&my.wins<=my.losses;});
                if(cbk.length>0)activities.push({icon:"ðŸ”„",text:cbk[0].name+" COMEBACK_KID primed â€” extra clutch swing when trailing",color:"#f97316"});
                // Workhorse protecting himself
                var wh=myRoster.filter(function(p){return hasTrait95(p,"workhorse")&&p.isStarter&&!(p.injury&&p.injury.games>0);});
                if(wh.length>0)activities.push({icon:"ðŸ´",text:wh[0].name+" WORKHORSE â€” 30% injury skip active this week",color:"#10b981"});
                if(activities.length===0)return null;
                return React.createElement("div",{style:{background:"rgba(34,211,238,0.03)",border:"1px solid rgba(34,211,238,0.15)",borderRadius:10,padding:"10px 12px",marginBottom:0}},
                  React.createElement("div",{style:{fontWeight:900,fontSize:10,color:T.cyan,letterSpacing:1,marginBottom:6}},"âš¡ TRAIT ACTIVITY â€” This Week"),
                  activities.map(function(act,ai){
                    return React.createElement("div",{key:"ta"+ai,style:{fontSize:10,padding:"3px 6px",borderRadius:4,marginBottom:2,color:act.color,background:act.color+"12"}},
                      act.icon+" "+act.text
                    );
                  })
                );
              })()}

              {season.phase==="regular"&&teams.length>=6&&(function(){
                var divs76=DIV_STANDINGS.getDivisions(teams);
                var myDiv76=DIV_STANDINGS.getUserDiv(divs76,myId);
                if(!myDiv76)return null;
                return React.createElement("div",{style:mS(S.card,{padding:10,borderColor:"rgba(96,165,250,0.15)"})},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.blue,marginBottom:6}},myDiv76.icon+" "+(myDiv76.conf==="EC"?"East":"West")+" "+myDiv76.name),
                  myDiv76.teams.map(function(t76,i76){
                    var isMe=t76.id===myId;
                    var arch91=!isMe&&getTeamGMArchetype90?getTeamGMArchetype90(t76):null;
                    var archColor91=arch91&&arch91.color&&T[arch91.color]?T[arch91.color]:T.purple;
                    return React.createElement("div",{key:"ds"+i76,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"3px 6px",borderRadius:4,background:isMe?"rgba(251,191,36,0.08)":"transparent",fontSize:11}},
                      React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center"}},
                        React.createElement("span",{style:{fontWeight:700,color:i76===0?T.gold:T.dim,width:14,textAlign:"center"}},""+(i76+1)),
                        React.createElement("span",{style:{fontWeight:isMe?800:400,color:isMe?T.gold:T.text}},t76.icon+" "+t76.abbr),
                        arch91&&React.createElement("span",{title:arch91.flavor,style:{fontSize:7,padding:"1px 4px",borderRadius:4,background:archColor91+"18",color:archColor91,fontWeight:700,cursor:"default"}},arch91.icon+" "+arch91.label)
                      ),
                      React.createElement("div",{style:{display:"flex",gap:10,alignItems:"center"}},
                        React.createElement("span",{style:{fontWeight:600,fontSize:11}},(t76.wins||0)+"W-"+(t76.losses||0)+"L"),
                        React.createElement("span",{style:{color:t76._gamesBack76===0?T.green:T.faint,fontSize:10,width:30,textAlign:"right"}},t76._gamesBack76===0?"â€”":t76._gamesBack76+" GB")
                      )
                    );
                  })
                );
              })()}
              
              {season.phase==="regular"&&my&&!done&&(function(){
                return React.createElement("div",{style:mS(S.card,{padding:12,borderColor:"rgba(168,85,247,0.15)",background:"rgba(168,85,247,0.03)"})},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.purple,marginBottom:8}},"ðŸŽ¯ GAME PLAN â€” Week "+season.week),
                  React.createElement("div",{style:{display:"flex",gap:8}},
                    React.createElement("div",{style:{flex:1}},
                      React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.faint,marginBottom:4}},"OFFENSE"),
                      GAME_PLAN_OPTIONS.offense.map(function(gp){
                        var sel=gamePlan77.off===gp.id;
                        return React.createElement("div",{key:gp.id,onClick:function(){setGamePlan77(function(prev){return assign({},prev,{off:gp.id});});},
                          style:{padding:"4px 6px",borderRadius:4,cursor:"pointer",marginBottom:2,fontSize:10,
                            border:sel?"1px solid "+T.purple:"1px solid "+T.border,
                            background:sel?"rgba(168,85,247,0.1)":"transparent",fontWeight:sel?700:400}},
                          React.createElement("div",null,gp.label),
                          sel?React.createElement("div",{style:{fontSize:8,color:T.dim}},gp.desc):null
                        );
                      })
                    ),
                    React.createElement("div",{style:{flex:1}},
                      React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.faint,marginBottom:4}},"DEFENSE"),
                      GAME_PLAN_OPTIONS.defense.map(function(gp){
                        var sel=gamePlan77.def===gp.id;
                        return React.createElement("div",{key:gp.id,onClick:function(){setGamePlan77(function(prev){return assign({},prev,{def:gp.id});});},
                          style:{padding:"4px 6px",borderRadius:4,cursor:"pointer",marginBottom:2,fontSize:10,
                            border:sel?"1px solid "+T.purple:"1px solid "+T.border,
                            background:sel?"rgba(168,85,247,0.1)":"transparent",fontWeight:sel?700:400}},
                          React.createElement("div",null,gp.label),
                          sel?React.createElement("div",{style:{fontSize:8,color:T.dim}},gp.desc):null
                        );
                      })
                    )
                  )
                );
              })()}
              
              {filmBreakdown77&&season.phase==="regular"&&React.createElement("div",{style:mS(S.card,{padding:12,borderColor:"rgba(239,68,68,0.15)",background:"rgba(239,68,68,0.02)"})},
                React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.red}},"ðŸŽ¬ FILM BREAKDOWN â€” "+(filmBreakdown77.won?"W ":"L ")+filmBreakdown77.uScore+"-"+filmBreakdown77.oScore+" vs "+filmBreakdown77.oppIcon+filmBreakdown77.oppAbbr),
                  React.createElement("button",{style:mS(S.btn,{padding:"2px 8px",fontSize:9}),onClick:function(){setFilmBreakdown77(null);}},"âœ–")
                ),
                filmBreakdown77.mvp?React.createElement("div",{style:{fontSize:10,padding:"4px 8px",borderRadius:6,background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.15)",marginBottom:6}},
                  "ðŸ† Game MVP: ",React.createElement("span",{style:{fontWeight:700,color:T.gold}},filmBreakdown77.mvp.name+" ("+filmBreakdown77.mvp.pos+" "+filmBreakdown77.mvp.ovr+")")
                ):null,
                React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.faint,marginBottom:4}},"DRIVE CHART"),
                React.createElement("div",{style:{display:"flex",gap:1,height:24,marginBottom:6,borderRadius:4,overflow:"hidden"}},
                  filmBreakdown77.drives.map(function(dr,di){
                    var bg=dr.result==="TD"?(dr.team==="user"?T.green:T.red):dr.result==="FG"?(dr.team==="user"?"#22d3ee":"#f97316"):dr.result==="turnover"?"#ef4444":T.bg3;
                    return React.createElement("div",{key:di,style:{flex:1,background:bg,borderRight:"1px solid "+T.bg},title:"Drive "+(di+1)+": "+dr.result+(dr.pts?" (+"+dr.pts+")":"")});
                  })
                ),
                React.createElement("div",{style:{display:"flex",gap:8,fontSize:8,color:T.faint,marginBottom:6}},
                  React.createElement("span",null,"ðŸŸ¢ TD"),React.createElement("span",null,"ðŸ”µ FG"),
                  React.createElement("span",null,"ðŸ”´ Turnover"),React.createElement("span",null,"â¬œ Punt")
                ),
                filmBreakdown77.turningPoint?React.createElement("div",{style:{fontSize:10,padding:"4px 8px",borderRadius:4,background:"rgba(251,191,36,0.05)",border:"1px solid "+T.border}},
                  "âš¡ Turning Point (Drive "+filmBreakdown77.turningPoint.drive+"): ",
                  React.createElement("span",{style:{color:T.gold,fontWeight:600}},filmBreakdown77.turningPoint.desc)
                ):null
              )}
              
              {powerRankShow77&&season.phase==="regular"&&React.createElement("div",{style:mS(S.card,{padding:12,borderColor:"rgba(251,191,36,0.15)",background:"rgba(251,191,36,0.02)"})},
                React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.gold}},"ðŸ“Š POWER RANKINGS â€” Week "+(season.week-1)),
                  React.createElement("button",{style:mS(S.btn,{padding:"2px 8px",fontSize:9}),onClick:function(){setPowerRankShow77(null);}},"âœ–")
                ),
                powerRankShow77.slice(0,10).map(function(pr77,pi77){
                  return React.createElement("div",{key:"pr"+pi77,style:{display:"flex",gap:6,alignItems:"center",padding:"3px 4px",fontSize:10,
                    borderBottom:"1px solid "+T.border,background:pr77.isUser?"rgba(251,191,36,0.06)":"transparent"}},
                    React.createElement("span",{style:{width:18,fontWeight:800,color:pi77<3?T.gold:pi77<6?T.text:T.dim,textAlign:"center"}},""+pr77.rank),
                    React.createElement("span",{style:{fontSize:10}},pr77.trendIcon),
                    React.createElement("span",{style:{fontWeight:pr77.isUser?800:600,width:50}},pr77.icon+pr77.team),
                    React.createElement("span",{style:{fontWeight:700,width:40}},pr77.wins+"W-"+pr77.losses+"L"),
                    React.createElement("span",{style:{flex:1,fontSize:9,color:T.dim,fontStyle:"italic"}},pr77.blurb),
                    pr77.trendDelta>0?React.createElement("span",{style:{fontSize:8,color:pr77.trend==="up"?T.green:T.red,fontWeight:700}},
                      (pr77.trend==="up"?"â†‘":"â†“")+pr77.trendDelta):null
                  );
                }),
                powerRankShow77.filter(function(pr77){return pr77.hotTake;}).length>0?React.createElement("div",{style:{marginTop:6,padding:"4px 8px",borderRadius:4,background:"rgba(239,68,68,0.05)",border:"1px solid rgba(239,68,68,0.1)"}},
                  React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.red,marginBottom:2}},"ðŸ”¥ HOT TAKES"),
                  powerRankShow77.filter(function(pr77){return pr77.hotTake;}).slice(0,3).map(function(pr77,hi){
                    return React.createElement("div",{key:"ht"+hi,style:{fontSize:9,color:T.dim,fontStyle:"italic"}},pr77.hotTake);
                  })
                ):null
              )}
              
              {mfsnWeekly975&&season.phase==="regular"&&(function(){
                var segs975=mfsnWeekly975.segments||[];
                return React.createElement("div",{style:mS(S.card,{padding:12,borderColor:"rgba(251,191,36,0.25)",background:"rgba(251,191,36,0.05)"})},
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
                    React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:12,fontWeight:900,color:T.gold}},"ðŸ“º MFSN WEEKLY â€” WEEK "+mfsnWeekly975.week),
                      React.createElement("div",{style:{fontSize:9,color:T.faint}},(mfsnWeekly975.anchor&&mfsnWeekly975.anchor.icon?mfsnWeekly975.anchor.icon+" ":"")+""
                        +(mfsnWeekly975.anchor&&mfsnWeekly975.anchor.name?mfsnWeekly975.anchor.name:"Anchor")+" reporting")
                    ),
                    React.createElement("button",{style:mS(S.btn,{padding:"3px 8px",fontSize:9}),onClick:function(){setMfsnWeekly975(null);}},"ðŸ“º Off Air")
                  ),
                  mfsnWeekly975.opener?React.createElement("div",{style:{fontSize:9,color:T.dim,fontStyle:"italic",padding:"4px 2px 6px",marginBottom:4,borderBottom:"1px solid rgba(255,255,255,0.07)",lineHeight:1.4}},"\u201c"+mfsnWeekly975.opener+"\u201d"):null,
                  segs975.map(function(seg,si){
                    if(!seg)return null;
                    var sectionKey="mfsn975_"+si+"_"+(seg.type||"seg");
                    if(seg.type==="HEADLINE"){
                      return React.createElement("div",{key:sectionKey,style:{marginBottom:8,padding:"6px 8px",borderRadius:6,border:"1px solid "+T.border,background:"rgba(255,255,255,0.02)"}},
                        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,marginBottom:4}},seg.title||"ðŸ“° TOP STORIES"),
                        (seg.items||[]).slice(0,6).map(function(item,ii){
                          return React.createElement("div",{key:ii,style:{fontSize:9,color:T.dim,padding:"2px 0",lineHeight:1.35}},
                            React.createElement("span",{style:{color:T.gold,marginRight:6}},"â€¢"),
                            React.createElement("span",null,item)
                          );
                        })
                      );
                    }
                    if(seg.type==="YOUR_TEAM"){
                      return React.createElement("div",{key:sectionKey,style:{marginBottom:8,padding:"8px 10px",borderRadius:6,border:"1px solid "+(seg.won===false?"rgba(239,68,68,0.18)":seg.won===true?"rgba(34,197,94,0.18)":T.border),background:"rgba(255,255,255,0.02)"}},
                        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.cyan,marginBottom:4}},seg.title||"ðŸˆ TEAM RECAP"),
                        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,marginBottom:3}},
                          React.createElement("div",{style:{fontSize:12,fontWeight:900,color:seg.won===false?T.red:seg.won===true?T.green:T.text}},seg.result||""),
                          React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.faint}},seg.record||"")
                        ),
                        seg.streak?React.createElement("div",{style:{fontSize:8,color:T.gold,fontWeight:700,marginBottom:3}},seg.streak):null,
                        seg.anchorTake?React.createElement("div",{style:{fontSize:9,color:T.dim,fontStyle:"italic",lineHeight:1.35}},"â€œ"+seg.anchorTake+"â€"):null
                      );
                    }
                    if(seg.type==="POWER_RANKINGS"){
                      return React.createElement("div",{key:sectionKey,style:{marginBottom:8,padding:"8px 10px",borderRadius:6,border:"1px solid "+T.border,background:"rgba(255,255,255,0.02)"}},
                        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,marginBottom:4}},seg.title||"ðŸ“Š POWER RANKINGS"),
                        seg.myRank?React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4}},
                          React.createElement("span",{style:{fontSize:16,fontWeight:900,color:T.gold}},"#"+seg.myRank),
                          React.createElement("span",{style:{fontSize:10,color:seg.myTrend==="up"?T.green:seg.myTrend==="down"?T.red:T.dim,fontWeight:700}},
                            (seg.myTrendIcon||"")+" "+(seg.myTrend==="up"?"Rising":seg.myTrend==="down"?"Falling":"Holding"))
                        ):React.createElement("div",{style:{fontSize:9,color:T.dim,marginBottom:4}},"Outside the current Power Rankings snapshot."),
                        seg.myBlurb?React.createElement("div",{style:{fontSize:9,color:T.dim,fontStyle:"italic",marginBottom:(seg.topMovers&&seg.topMovers.length?4:0)}},"â€œ"+seg.myBlurb+"â€"):null,
                        seg.topMovers&&seg.topMovers.length?React.createElement("div",null,
                          React.createElement("div",{style:{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}},"TOP MOVERS"),
                          seg.topMovers.map(function(mv,mvi){
                            return React.createElement("div",{key:mvi,style:{fontSize:8,color:T.dim,padding:"1px 0"}},
                              (mv.trendIcon||"")+" "+(mv.icon||"")+mv.team+" "+(mv.trend==="up"?"â†‘":"â†“")+mv.trendDelta+" â†’ #"+mv.rank
                            );
                          })
                        ):null
                      );
                    }
                    if(seg.type==="STORYLINES"){
                      return React.createElement("div",{key:sectionKey,style:{marginBottom:8,padding:"8px 10px",borderRadius:6,border:"1px solid "+T.border,background:"rgba(255,255,255,0.02)"}},
                        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,marginBottom:4}},seg.title||"ðŸŒŸ PLAYER STORYLINES"),
                        (seg.items||[]).map(function(item,ii){
                          return React.createElement("div",{key:ii,style:{padding:"4px 0",borderBottom:ii<(seg.items||[]).length-1?"1px solid "+T.border+"44":"none"}},
                            React.createElement("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:2}},
                              React.createElement("span",{style:{fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:4,background:(item.badgeColor||"#fbbf24")+"22",color:item.badgeColor||"#fbbf24"}},item.badge||"ðŸŒŸ"),
                              React.createElement("span",{style:{fontSize:9,fontWeight:700}},(item.name||"Player")+(item.pos?" ("+item.pos+")":""))
                            ),
                            React.createElement("div",{style:{fontSize:8,color:T.dim,lineHeight:1.35}},item.text||"")
                          );
                        })
                      );
                    }
                    if(seg.type==="HOT_SEAT"){
                      return React.createElement("div",{key:sectionKey,style:{marginBottom:8,padding:"8px 10px",borderRadius:6,border:"1px solid rgba(239,68,68,0.25)",background:"rgba(239,68,68,0.06)"}},
                        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.red,marginBottom:2}},seg.title||"ðŸª‘ HOT SEAT WATCH"),
                        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2}},
                          React.createElement("span",{style:{fontSize:9,color:T.text}},seg.data&&seg.data.text?seg.data.text:"Ownership tension rising."),
                          React.createElement("span",{style:{fontSize:8,fontWeight:800,color:T.red}},(seg.data&&seg.data.mood!=null?seg.data.mood:"--")+"/100")
                        )
                      );
                    }
                    if(seg.type==="PRESS_CONFERENCE"){
                      var pData=seg.data||{};
                      var answered975=!!mfsnWeekly975.pressAnswered975;
                      var chosen975=answered975?(pData.opts||[])[mfsnWeekly975.pressChoice975]:null;
                      return React.createElement("div",{key:sectionKey,style:{marginBottom:6,padding:"8px 10px",borderRadius:6,border:"1px solid rgba(34,211,238,0.18)",background:"rgba(34,211,238,0.03)"}},
                        React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.cyan,marginBottom:4}},seg.title||"ðŸŽ¤ PRESS CONFERENCE"),
                        React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.text,lineHeight:1.4,marginBottom:6}},"\""+(pData.q||"Questions from the media?")+"\""),
                        answered975&&chosen975?React.createElement("div",{style:{fontSize:9,color:T.green,fontWeight:700,marginBottom:4}},"Answered: \""+chosen975.text+"\""):null,
                        (pData.opts||[]).map(function(opt,oi){
                          var fx=opt.effect||{};
                          var fxText=[];
                          if(fx.morale)fxText.push((fx.morale>0?"+":"")+fx.morale+" morale");
                          if(fx.chemistry)fxText.push((fx.chemistry>0?"+":"")+fx.chemistry+" chemistry");
                          if(fx.ownerMood)fxText.push((fx.ownerMood>0?"+":"")+fx.ownerMood+" owner");
                          return React.createElement("button",{key:oi,disabled:answered975,onClick:function(){handleWeeklyPressAnswer975(oi);},
                            style:{display:"block",width:"100%",textAlign:"left",padding:"8px 10px",marginBottom:4,borderRadius:6,cursor:answered975?"default":"pointer",
                              opacity:answered975&&mfsnWeekly975.pressChoice975!==oi?0.6:1,border:"1px solid "+(answered975&&mfsnWeekly975.pressChoice975===oi?T.gold:T.border),
                              background:answered975&&mfsnWeekly975.pressChoice975===oi?"rgba(251,191,36,0.08)":T.bg3,color:T.text,fontSize:9,lineHeight:1.35}},
                            React.createElement("div",{style:{fontWeight:600}},opt.text),
                            fxText.length?React.createElement("div",{style:{fontSize:8,color:T.faint,marginTop:2}},fxText.join(" â€¢ ")):null
                          );
                        }),
                        answered975?React.createElement("div",{style:{fontSize:8,color:T.faint,fontStyle:"italic"}},"Press conference complete for this week."):null
                      );
                    }
                    return null;
                  })
                );
              })()}
              
              {season.phase==="regular"&&my&&season.week>=4&&(function(){
                var seats77=[["HC",my.staff.hc],["OC",my.staff.oc],["DC",my.staff.dc]].map(function(entry){
                  var role=entry[0],c=entry[1];
                  var temp=c.seatTemp77||HOT_SEAT.calcTemp(my,role,season);
                  var label=HOT_SEAT.getLabel(temp);
                  return{role:role,name:c.name,temp:temp,label:label};
                });
                var anyHot=seats77.some(function(s){return s.temp>=45;});
                if(!anyHot)return null;
                return React.createElement("div",{style:mS(S.card,{padding:10,borderColor:"rgba(239,68,68,0.15)"})},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.orange,marginBottom:6}},"ðŸ”¥ HOT SEAT METER"),
                  seats77.filter(function(s){return s.temp>=25;}).map(function(s,si){
                    return React.createElement("div",{key:"hs"+si,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"3px 0",fontSize:10}},
                      React.createElement("span",null,s.role+": "+s.name),
                      React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center"}},
                        React.createElement("div",{style:{width:60,height:6,background:T.bg3,borderRadius:3,overflow:"hidden"}},
                          React.createElement("div",{style:{width:s.temp+"%",height:"100%",background:s.label.color,borderRadius:3}})
                        ),
                        React.createElement("span",{style:{fontWeight:700,color:s.label.color,fontSize:9}},s.label.emoji+" "+s.temp)
                      )
                    );
                  })
                );
              })()}
              
              {newsTicker78&&newsTicker78.length>0&&season.phase==="regular"&&React.createElement("div",{style:mS(S.card,{padding:8,borderColor:"rgba(34,211,238,0.15)",background:"rgba(34,211,238,0.02)",overflow:"hidden"})},
                React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.cyan,marginBottom:4,display:"flex",justifyContent:"space-between"}},
                  React.createElement("span",null,"ðŸ“° LEAGUE NEWS TICKER"),
                  React.createElement("button",{style:mS(S.btn,{padding:"1px 6px",fontSize:8}),onClick:function(){setNewsTicker78([]);}},"âœ–")
                ),
                newsTicker78.map(function(nt78,ni78){
                  return React.createElement("div",{key:"nt"+ni78,style:{display:"flex",gap:6,alignItems:"center",padding:"3px 0",fontSize:10,borderBottom:ni78<newsTicker78.length-1?"1px solid "+T.border+"44":"none"}},
                    React.createElement("span",{style:{fontSize:12}},nt78.icon),
                    React.createElement("span",{style:{flex:1,color:nt78.color||T.text}},nt78.text)
                  );
                })
              )}
              
              {challenges78&&challenges78.length>0&&season.phase==="regular"&&React.createElement("div",{style:mS(S.card,{padding:10,borderColor:"rgba(251,191,36,0.15)",background:"rgba(251,191,36,0.02)"})},
                React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.gold}},"ðŸŽ¯ WEEKLY CHALLENGES â€” Week "+season.week),
                  React.createElement("div",{style:{fontSize:8,color:T.faint,maxWidth:180,textAlign:"right"}},"Focus one challenge for 3x Practice Star attribute boost next week!")
                ),
                challenges78.map(function(ch78,ci78){
                  var diffColor=ch78.diff==="easy"?T.green:ch78.diff==="medium"?T.orange:ch78.diff==="hard"?T.red:ch78.diff==="elite"?"#a855f7":"#ef4444";
                  var isFocused=!!ch78.focused96;
                  var anyFocused=challenges78.some(function(c){return c.focused96;});
                  return React.createElement("div",{key:"ch"+ci78,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 8px",borderRadius:6,marginBottom:3,
                    background:ch78.completed?"rgba(34,197,94,0.08)":isFocused?"rgba(251,191,36,0.10)":"rgba(255,255,255,0.02)",
                    border:"1px solid "+(ch78.completed?T.green+"44":isFocused?T.gold+"66":T.border)}},
                    React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",flex:1,minWidth:0}},
                      React.createElement("span",{style:{fontSize:14}},ch78.completed?"âœ…":isFocused?"ðŸ”¥":ch78.icon),
                      React.createElement("div",{style:{flex:1,minWidth:0}},
                        React.createElement("span",{style:{fontSize:10,fontWeight:ch78.completed?700:500,color:ch78.completed?T.green:isFocused?T.gold:"#fff",textDecoration:ch78.completed?"line-through":"none"}},ch78.label),
                        isFocused&&!ch78.completed?React.createElement("div",{style:{fontSize:8,color:T.gold,fontWeight:700}},"âš¡ FOCUSED â€” 3x attribute boost if completed"):null
                      )
                    ),
                    React.createElement("div",{style:{display:"flex",gap:4,alignItems:"center",flexShrink:0}},
                      React.createElement("span",{style:{fontSize:8,fontWeight:700,color:diffColor,padding:"1px 4px",borderRadius:3,border:"1px solid "+diffColor+"44"}},ch78.diff.toUpperCase()),
                      React.createElement("span",{style:{fontSize:9,fontWeight:700,color:T.gold}},"+"+ch78.xp+" XP"),
                      !ch78.completed&&React.createElement("button",{onClick:function(){
                        var updated=challenges78.map(function(c,j){var c2=assign({},c);c2.focused96=(j===ci78&&!c.focused96);return c2;});
                        setChallenges78(updated);
                      },style:{fontSize:8,padding:"2px 6px",borderRadius:4,cursor:"pointer",fontWeight:800,border:"1px solid "+(isFocused?T.gold:T.border),background:isFocused?"rgba(251,191,36,0.2)":"transparent",color:isFocused?T.gold:T.dim}},isFocused?"â˜… FOCUSED":"Focus")
                    )
                  );
                })
              )}
              
              {season.phase==="regular"&&my&&season.week>=2&&(function(){
                var dvoa78=ADVANCED_ANALYTICS.calcDVOA(my);
                var topPlayers78=(my.roster||[]).filter(function(p){return p.stats&&p.stats.gp>0;}).map(function(p){
                  return{name:p.name,pos:p.pos,ovr:p.ovr,epa:ADVANCED_ANALYTICS.calcEPA(p,my.wins,(my.wins||0)+(my.losses||0)),
                    tgtShare:(p.pos==="WR"||p.pos==="TE"||p.pos==="RB")?ADVANCED_ANALYTICS.calcTargetShare(p,my.roster):null};
                }).sort(function(a,b){return b.epa-a.epa;}).slice(0,5);
                var gems78=ADVANCED_ANALYTICS.findInefficiencies(fas);
                return React.createElement("div",{style:mS(S.card,{padding:10,borderColor:"rgba(59,130,246,0.15)",background:"rgba(59,130,246,0.02)"})},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:"#3b82f6",marginBottom:6}},"ðŸ“Š ANALYTICS DASHBOARD"),
                  React.createElement("div",{style:{display:"flex",gap:10,marginBottom:8}},
                    React.createElement("div",{style:{flex:1,textAlign:"center",padding:6,borderRadius:6,background:"rgba(59,130,246,0.06)",border:"1px solid rgba(59,130,246,0.15)"}},
                      React.createElement("div",{style:{fontSize:8,color:T.faint,fontWeight:700}},"OFFENSE"),
                      React.createElement("div",{style:{fontSize:18,fontWeight:900,color:dvoa78.off>0?T.green:dvoa78.off<-10?T.red:T.orange}},(dvoa78.off>0?"+":"")+dvoa78.off+"%")
                    ),
                    React.createElement("div",{style:{flex:1,textAlign:"center",padding:6,borderRadius:6,background:"rgba(59,130,246,0.06)",border:"1px solid rgba(59,130,246,0.15)"}},
                      React.createElement("div",{style:{fontSize:8,color:T.faint,fontWeight:700}},"DEFENSE"),
                      React.createElement("div",{style:{fontSize:18,fontWeight:900,color:dvoa78.def>0?T.green:dvoa78.def<-10?T.red:T.orange}},(dvoa78.def>0?"+":"")+dvoa78.def+"%")
                    ),
                    React.createElement("div",{style:{flex:1,textAlign:"center",padding:6,borderRadius:6,background:"rgba(59,130,246,0.06)",border:"1px solid rgba(59,130,246,0.15)"}},
                      React.createElement("div",{style:{fontSize:8,color:T.faint,fontWeight:700}},"TOTAL DVOA"),
                      React.createElement("div",{style:{fontSize:18,fontWeight:900,color:dvoa78.total>0?T.green:dvoa78.total<-10?T.red:T.orange}},(dvoa78.total>0?"+":"")+dvoa78.total+"%")
                    )
                  ),
                  React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.faint,marginBottom:3}},"TOP EPA CONTRIBUTORS"),
                  topPlayers78.map(function(tp78,ti78){
                    return React.createElement("div",{key:"tp"+ti78,style:{display:"flex",justifyContent:"space-between",fontSize:10,padding:"2px 4px",borderBottom:"1px solid "+T.border+"33"}},
                      React.createElement("span",{style:{fontWeight:600}},tp78.name+" ("+tp78.pos+")"),
                      React.createElement("div",{style:{display:"flex",gap:8}},
                        React.createElement("span",{style:{color:tp78.epa>0?T.green:T.red,fontWeight:700}},"EPA: "+(tp78.epa>0?"+":"")+tp78.epa),
                        tp78.tgtShare?React.createElement("span",{style:{color:T.cyan,fontSize:9}},"TGT: "+tp78.tgtShare+"%"):null
                      )
                    );
                  }),
                  gems78.length>0?React.createElement("div",{style:{marginTop:8}},
                    React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.gold,marginBottom:3}},"ðŸ’Ž MARKET INEFFICIENCIES"),
                    gems78.slice(0,3).map(function(g78,gi78){
                      return React.createElement("div",{key:"g"+gi78,style:{fontSize:9,color:T.dim,padding:"2px 0"}},g78.label);
                    })
                  ):null
                );
              })()}
              
              {my&&owner&&(function(){
                var ps80=OWNER_PATIENCE.status(ownerPatience80);
                var arc80=OWNER_CONFIDENCE_ARC.get(ownerPatience80,my.ownerMood||70);
                var archObj80=OWNER_ARCHETYPES.find(function(a){return a.id===(owner.archetypeId||"win_now");})||OWNER_ARCHETYPES[0];
                return React.createElement("div",{style:mS(S.card,{padding:10,borderColor:ps80.color+"33",background:ps80.color+"08",marginBottom:6})},
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
                    React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:11,fontWeight:800,color:ps80.color}},ps80.emoji+" OWNER PATIENCE"),
                      React.createElement("div",{style:{fontSize:8,color:T.dim}},archObj80.label)
                    ),
                    React.createElement("div",{style:{textAlign:"right"}},
                      React.createElement("div",{style:{fontSize:20,fontWeight:900,color:ps80.color}},Math.round(ownerPatience80)),
                      React.createElement("div",{style:{fontSize:8,color:ps80.color,fontWeight:700,letterSpacing:1}},ps80.label)
                    )
                  ),
                  React.createElement("div",{style:{position:"relative",height:14,borderRadius:7,background:"rgba(255,255,255,0.06)",overflow:"hidden",marginBottom:4}},
                    React.createElement("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:ownerPatience80+"%",background:"linear-gradient(90deg,"+ps80.barColor+","+ps80.barColor+"cc)",borderRadius:7}}),
                    React.createElement("div",{style:{position:"absolute",left:"25%",top:0,width:1,height:"100%",background:"rgba(255,255,255,0.2)"}}),
                    React.createElement("div",{style:{position:"absolute",left:"85%",top:0,width:1,height:"100%",background:"rgba(255,255,255,0.2)"}})
                  ),
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:7,color:T.dim,marginBottom:3}},
                    React.createElement("span",{style:{color:"#ef4444"}},"â˜ ï¸ CRISIS"),
                    React.createElement("span",null,"NEUTRAL"),
                    React.createElement("span",{style:{color:"#4ade80"}},"ðŸ¤© BONUS")
                  ),
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:8,marginBottom:3}},
                    React.createElement("span",{style:{color:arc80.color,fontWeight:700}},arc80.emoji+" ARC: "+arc80.id),
                    React.createElement("span",{style:{color:arc80.heatColor,fontWeight:700}},"Heat "+arc80.heat+"%")
                  ),
                  React.createElement("div",{style:{fontSize:8,color:ps80.color,fontStyle:"italic"}},ps80.desc)
                );
              })()}
              
              {mfsnDraftGrade80&&(function(){/* v81: click to open full draft grade screen */var _dgClick81=function(){setScreen("draftGrade");};
                var gColor80=mfsnDraftGrade80.grade&&mfsnDraftGrade80.grade.indexOf("A")===0?T.green:mfsnDraftGrade80.grade&&mfsnDraftGrade80.grade.indexOf("B")===0?T.cyan:mfsnDraftGrade80.grade&&mfsnDraftGrade80.grade.indexOf("C")===0?T.gold:T.red;
                return React.createElement("div",{style:mS(S.card,{padding:10,borderColor:gColor80+"33",background:gColor80+"06",cursor:"pointer"}),onClick:_dgClick81},
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}},
                    React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.cyan}},"ðŸ“º MFSN DRAFT REPORT"),
                    React.createElement("div",{style:{fontSize:22,fontWeight:900,color:gColor80}},mfsnDraftGrade80.grade)
                  ),
                  React.createElement("div",{style:{fontSize:9,color:T.dim,marginBottom:4}},
                    mfsnDraftGrade80.analystIcon+" "+mfsnDraftGrade80.analyst+": \""+mfsnDraftGrade80.headline+"\""
                  ),
                  mfsnDraftGrade80.picks&&mfsnDraftGrade80.picks.length>0&&React.createElement("div",{style:{fontSize:8,color:T.faint}},
                    "Picks: "+mfsnDraftGrade80.picks.map(function(pk){return pk.name+" ("+pk.pos+")";}).join(", ")
                  ),
                  mfsnGradeHistory80&&mfsnGradeHistory80.length>1&&React.createElement("div",{style:{fontSize:8,color:T.dim,marginTop:4}},
                    "Draft history: "+mfsnGradeHistory80.slice(-4).map(function(g){return g.year+"â†’"+g.grade;}).join(", ")
                  )
                );
              })()}
              
              {seasonPreds80&&my&&(function(){
                var myPred80=seasonPreds80.teams&&seasonPreds80.teams.find(function(t){return t.id===myId;});
                if(!myPred80)return null;
                var oddsColor80=myPred80.odds>0?T.red:T.green;
                return React.createElement("div",{style:mS(S.card,{padding:10,borderColor:"rgba(6,182,212,0.15)",background:"rgba(6,182,212,0.03)"})},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.cyan,marginBottom:4}},"ðŸ”® MFSN SEASON PREVIEW"),
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                    React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:10,color:T.text}},myPred80.prediction||"Tough road ahead."),
                      React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:2}},"Win projection: "+myPred80.projWins+" wins")
                    ),
                    React.createElement("div",{style:{textAlign:"right"}},
                      React.createElement("div",{style:{fontSize:16,fontWeight:900,color:oddsColor80}},myPred80.odds>0?"+"+myPred80.odds:myPred80.odds),
                      React.createElement("div",{style:{fontSize:8,color:T.dim}},"MFSN odds")
                    )
                  ),
                  seasonPreds80.champion&&React.createElement("div",{style:{fontSize:8,color:T.gold,marginTop:4,fontStyle:"italic"}},"MFSN SB pick: "+seasonPreds80.champion.name)
                );
              })()}
              
              {breakouts80&&breakouts80.length>0&&my&&season.phase==="regular"&&(function(){
                var active81=breakouts80.filter(function(bc){return !bc.resolved;});
                if(active81.length===0)return null;
                return React.createElement("div",{style:mS(S.card,{padding:10,borderColor:"rgba(251,191,36,0.2)",background:"rgba(251,191,36,0.03)"})},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.gold,marginBottom:6}},"ðŸ”¥ BREAKOUT WATCH"),
                  active81.map(function(bc){
                    var p81=my.roster.find(function(r){return r.id===bc.playerId;});
                    if(!p81)return null;
                    var pct81=Math.min(100,Math.round((season.week/17)*100));
                    var gained81=(p81.ovr||0)-(bc.ovrAtStart||0);
                    return React.createElement("div",{key:bc.playerId,style:{display:"flex",alignItems:"center",gap:8,padding:"4px 0"}},
                      React.createElement("div",{style:{fontSize:10,fontWeight:700,flex:1}},p81.name+" ("+p81.pos+" "+p81.ovr+")"),
                      gained81>0&&React.createElement("span",{style:{fontSize:8,color:T.green,fontWeight:700}},"+"+gained81),
                      React.createElement("div",{style:{width:60,height:5,background:T.bg3,borderRadius:3}},
                        React.createElement("div",{style:{width:pct81+"%",height:5,background:T.gold,borderRadius:3}})
                      )
                    );
                  })
                );
              })()}
                            
              {season.phase==="regular"&&my&&(function(){
                return React.createElement("div",{style:mS(S.card,{padding:10,borderColor:"rgba(168,85,247,0.12)",background:"rgba(168,85,247,0.02)"})},
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
                    React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.purple}},"ðŸ‘” FRONT OFFICE"),
                    frontOffice78.length<3?React.createElement("button",{style:assign({},bS(T.purple,"#fff"),{padding:"2px 8px",fontSize:9}),onClick:function(){
                      var openRoles=FRONT_OFFICE.roles.filter(function(r){return!frontOffice78.some(function(s){return s.roleId===r.id;});});
                      if(openRoles.length===0)return;

                       setFoCandidates78({roleId:null,title:"Select Position",openRoles:openRoles,candidates:[]});

                    }},"\u2795 Hire Staff"):null
                  ),
                  frontOffice78.length===0?React.createElement("div",{style:{fontSize:10,color:T.dim,textAlign:"center",padding:8}},"No staff hired yet. Hire an Asst. GM, Scout Director, or Analytics Coordinator to boost your team."):null,
                  frontOffice78.map(function(s78,si78){
                    var foRole78=FRONT_OFFICE.roles.find(function(r){return r.id===s78.roleId;});
                    var foAffects78=foRole78?foRole78.affects:[];
                    var foBonus78=Math.round(((s78.ovr||50)-50)*0.1*10)/10;
                    var foBonusColor78=foBonus78>3?T.green:foBonus78>1?T.gold:foBonus78>0?T.cyan:T.red;
                    var foTraitData78=s78.traitData||FO_TRAITS[s78.trait]||{};
                    return React.createElement("div",{key:"fo"+si78,style:{padding:"6px 8px",borderRadius:6,marginBottom:4,
                      background:"rgba(168,85,247,0.04)",border:"1px solid "+T.border}},
                      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3}},
                        React.createElement("div",null,
                          React.createElement("div",{style:{fontSize:11,fontWeight:700}},s78.icon+" "+s78.name),
                          React.createElement("div",{style:{fontSize:8,color:T.dim}},s78.title+" â€¢ "+s78.trait+" â€¢ "+s78.yearsLeft+"yr left")
                        ),
                        React.createElement("div",{style:{textAlign:"right"}},
                          React.createElement("div",{style:{fontSize:14,fontWeight:900,color:s78.ovr>=80?T.green:s78.ovr>=60?T.orange:T.red}},s78.ovr),
                          React.createElement("div",{style:{fontSize:8,color:T.dim}},"$"+s78.salary+"M")
                        )
                      ),
                      React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:3}},
                        foAffects78.map(function(af,afi){
                          return React.createElement("span",{key:"af"+afi,style:{fontSize:8,padding:"1px 5px",borderRadius:4,
                            background:foBonusColor78+"18",color:foBonusColor78,fontWeight:700,textTransform:"uppercase",letterSpacing:0.5}},
                            af+(foBonus78>0?" +"+foBonus78:""));
                        })
                      ),
                      foTraitData78.desc?React.createElement("div",{style:{fontSize:8,color:T.faint,fontStyle:"italic"}},
                        (foTraitData78.icon||"")+" "+foTraitData78.desc):null
                    );
                  }),
                  foCandidates78?React.createElement("div",{style:{marginTop:6,padding:8,background:"rgba(168,85,247,0.06)",border:"1px solid rgba(168,85,247,0.2)",borderRadius:8}},
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
                      React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.purple}},(foCandidates78.roleId?"ðŸ“‹ Hire "+foCandidates78.title:"ðŸ¢ Hire â€” Select Position")),
                      React.createElement("button",{style:assign({},bS(T.bg3,T.dim),{padding:"2px 6px",fontSize:8}),onClick:function(){setFoCandidates78(null);}},"âœ•")
                    ),
                    foCandidates78.roleId===null?(foCandidates78.openRoles||[]).map(function(r78,ri){
                      var role=FRONT_OFFICE.roles.find(function(x){return x.id===r78.id;})||r78;
                      return React.createElement("div",{key:"r"+ri,
                        style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 8px",marginBottom:3,borderRadius:6,cursor:"pointer",background:"rgba(255,255,255,0.02)",border:"1px solid "+T.border},
                        onClick:function(){
                          var cands=FRONT_OFFICE.getCandidates(r78.id,3);
                          setFoCandidates78({roleId:r78.id,title:r78.title,candidates:cands,openRoles:foCandidates78.openRoles});
                        }},
                        React.createElement("div",null,
                          React.createElement("div",{style:{fontSize:10,fontWeight:700}},role.icon+" "+r78.title),
                          React.createElement("div",{style:{fontSize:8,color:T.dim}},role.desc||"")
                        ),
                        React.createElement("div",{style:{fontSize:9,color:T.purple,fontWeight:700}},"â†’")
                      );
                    })
                    :foCandidates78.candidates.map(function(c78,ci78){
                      return React.createElement("div",{key:"fc"+ci78,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 8px",marginBottom:3,borderRadius:6,
                        border:"1px solid "+T.border,cursor:"pointer",background:"rgba(255,255,255,0.02)"},
                        onClick:function(){
                          var newStaff=frontOffice78.slice();newStaff.push(c78);
                          setFrontOffice78(newStaff);setFoCandidates78(null);
                          addN("ðŸ‘” Hired "+c78.name+" as "+c78.title+" ("+c78.ovr+" OVR, $"+c78.salary+"M/yr)","purple");
                        }},
                        React.createElement("div",null,
                          React.createElement("div",{style:{fontSize:10,fontWeight:600}},c78.name),
                          React.createElement("div",{style:{fontSize:8,color:T.dim}},c78.trait+" â€¢ $"+c78.salary+"M/yr")
                        ),
                        React.createElement("div",{style:{fontSize:16,fontWeight:900,color:c78.ovr>=80?T.green:c78.ovr>=65?T.gold:T.red}},c78.ovr)
                      );
                    })
                  ):null
                );
              })()}
              
              {season.phase==="preseason"&&Array.isArray(posBattles974)&&posBattles974.some(function(b){return b&&!b.resolved;}) && (
                <div style={{background:"rgba(251,146,60,0.08)",border:"1px solid rgba(251,146,60,0.3)",borderRadius:8,padding:"10px 12px",marginBottom:8}}>
                  <div style={{fontSize:12,fontWeight:900,color:T.orange,marginBottom:8}}>{"âš”ï¸ POSITION BATTLES"}</div>
                  {posBattles974.map(function(battle,bi){
                    if(!battle||battle.resolved)return null;
                    var incLast=((battle.incumbent&&battle.incumbent.name)||"Incumbent").split(" ").slice(-1)[0]||"Inc";
                    var chLast=((battle.challenger&&battle.challenger.name)||"Challenger").split(" ").slice(-1)[0]||"Chal";
                    return <div key={bi} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 0",borderBottom:"1px solid "+T.border}}>
                      <span style={{fontWeight:700,color:T.gold,width:24}}>{battle.pos}</span>
                      <div style={{flex:1}}>
                        <div style={{fontSize:10}}>
                          <span style={{fontWeight:700}}>{battle.incumbent&&battle.incumbent.name}</span>
                          <span style={{color:T.dim}}>{" "+(battle.incumbent&&battle.incumbent.ovr)+" OVR, "+(battle.incumbent&&battle.incumbent.age)+"yr, $"+(battle.incumbent&&battle.incumbent.salary||0)+"M"}</span>
                        </div>
                        <div style={{fontSize:9,color:T.faint}}>{"vs"}</div>
                        <div style={{fontSize:10}}>
                          <span style={{fontWeight:700,color:T.cyan}}>{battle.challenger&&battle.challenger.name}</span>
                          <span style={{color:T.dim}}>{" "+(battle.challenger&&battle.challenger.ovr)+" OVR, "+(battle.challenger&&battle.challenger.age)+"yr"}</span>
                          {battle.challenger&&battle.incumbent&&battle.challenger.pot>=battle.incumbent.ovr&&<span style={{color:T.green,fontSize:8}}>{" ðŸŒŸ HIGH POT"}</span>}
                        </div>
                      </div>
                      <div style={{display:"flex",gap:4}}>
                        <button onClick={function(){resolvePositionBattle974(bi,"incumbent");}}
                          style={{fontSize:9,padding:"4px 8px",borderRadius:4,cursor:"pointer",background:T.bg3,color:T.dim,border:"1px solid "+T.border}}>
                          {"ðŸ‘‘ "+incLast}
                        </button>
                        <button onClick={function(){resolvePositionBattle974(bi,"challenger");}}
                          style={{fontSize:9,padding:"4px 8px",borderRadius:4,cursor:"pointer",background:"rgba(96,165,250,0.1)",color:T.cyan,border:"1px solid rgba(96,165,250,0.3)"}}>
                          {"âš¡ "+chLast}
                        </button>
                      </div>
                    </div>;
                  })}
                  <div style={{fontSize:8,color:T.faint,marginTop:6}}>{"Pick your starters. Winners get a +2 confidence boost. Unresolved battles auto-decide at cut day."}</div>
                </div>
              )}
              
              {season.phase==="regular" && <div style={assign({},cS,{borderColor:gmStrategy==="rebuild"?T.cyan:gmStrategy==="contend"?T.gold:T.border,padding:"8px 10px"})}>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4}}>
                  <span style={{fontSize:10,fontWeight:700,color:T.dim}}>{"ðŸŽ® GM STRATEGY"}</span>
                  <span style={{fontSize:8,padding:"1px 6px",borderRadius:3,fontWeight:700,
                    color:gmStrategy==="rebuild"?T.cyan:gmStrategy==="contend"?T.gold:T.faint,
                    background:"rgba(255,255,255,0.04)"}}>{GM_STRATEGIES[gmStrategy]?GM_STRATEGIES[gmStrategy].label:"âš–ï¸ Balanced"}</span>
                </div>
                <div style={{display:"flex",gap:4}}>
                  {["rebuild","neutral","contend"].map(function(sid){
                    var s2=GM_STRATEGIES[sid];if(!s2)return null;
                    var isActive=gmStrategy===sid;
                    return <button key={sid} onClick={function(){
                      var myT=teams.find(function(t){return t.id===myId;});
                      if(myT){applyGMStrategy(myT,sid);setTeams(teams.slice());setGmStrategy(sid);
                        addN(s2.label+" activated â€” "+s2.desc,sid==="rebuild"?"cyan":sid==="contend"?"gold":"white");}
                    }} style={mS(S.btn,isActive?S.btnPrimary:S.btnGhost,{flex:1,fontSize:9,padding:"5px 4px",
                      opacity:isActive?1:0.7})}>{s2.label}</button>;
                  })}
                </div>
                <div style={{fontSize:8,color:T.faint,marginTop:3}}>{GM_STRATEGIES[gmStrategy]?GM_STRATEGIES[gmStrategy].desc:""}</div>
              </div>}
              
              {/* v97.7: Game of the Week banner */}
              {season.phase==="regular"&&gotwData977&&gotwData977.isUser&&<div style={{background:"linear-gradient(135deg,rgba(251,191,36,0.08),rgba(59,130,246,0.08))",border:"1px solid rgba(251,191,36,0.3)",borderRadius:10,padding:10,marginBottom:8}}>
                <div style={{fontSize:11,fontWeight:900,color:T.gold,letterSpacing:1}}>{"ðŸ“º GAME OF THE WEEK"}</div>
                <div style={{fontSize:10,color:T.dim,marginTop:2}}>{gotwData977.label.replace("ðŸ“º GAME OF THE WEEK: ","")}</div>
                <div style={{fontSize:9,color:"#93c5fd",marginTop:2}}>{"Nationally televised â€” the whole league is watching you."}</div>
              </div>}
              {/* v97.7: Rivalry atmosphere banner (inline-computed) */}
              {(function(){
                if(!my||season.phase!=="regular")return null;
                var ngRiv=sched.find(function(g){return g.week===season.week&&!g.played&&(g.home===myId||g.away===myId);});
                if(!ngRiv)return null;
                var oppIdRiv=ngRiv.home===myId?ngRiv.away:ngRiv.home;
                var oppTRiv=teams.find(function(t){return t.id===oppIdRiv;});
                var rivalObjRiv=_findRivalObj(my,oppIdRiv);
                if(!rivalObjRiv||!oppTRiv)return null;
                var atmoRiv=RIVALRY_WEEK977.getAtmosphere(my,oppTRiv,rivalObjRiv,season.week);
                if(!atmoRiv)return null;
                return React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(239,68,68,0.08),rgba(251,191,36,0.08))",border:"1px solid rgba(239,68,68,0.3)",borderRadius:10,padding:12,marginBottom:8}},
                  React.createElement("div",{style:{fontSize:13,fontWeight:900,color:"#ef4444",letterSpacing:1}},atmoRiv.emoji+" RIVALRY WEEK"),
                  React.createElement("div",{style:{fontSize:11,fontWeight:700,color:T.text,marginTop:2}},atmoRiv.label),
                  atmoRiv.hypeLines.map(function(line,li){return React.createElement("div",{key:li,style:{fontSize:10,color:T.dim,marginTop:3,lineHeight:1.4}},line);}),
                  atmoRiv.trophy&&React.createElement("div",{style:{marginTop:6,padding:"4px 8px",background:"rgba(251,191,36,0.1)",borderRadius:6,fontSize:10,fontWeight:700,color:T.gold,display:"inline-block"}},
                    atmoRiv.trophy.icon+" "+atmoRiv.trophy.name+(atmoRiv.trophy.holderId===myId?" (YOU HOLD IT)":atmoRiv.trophy.holderId?" (THEY HOLD IT)":" (UNCLAIMED)"))
                );
              })()}
              {rivBroadcast && season.phase==="regular" && <div style={assign({},cS,{borderColor:T.red,
                background:"linear-gradient(135deg,rgba(239,68,68,0.06),rgba(124,58,237,0.06))"})}>
                <div style={{textAlign:"center",marginBottom:6}}>
                  <div style={{fontSize:14,fontWeight:900,color:T.red,letterSpacing:2}}>{rivBroadcast.emoji+" RIVALRY WEEK "+rivBroadcast.emoji}</div>
                  <div style={{fontSize:10,color:T.dim,marginTop:2}}>{"Heat: "+rivBroadcast.heat+" | Series: "+rivBroadcast.seriesRecord+" | "+rivBroadcast.tier.replace("_"," ")}</div>
                </div>
                {rivBroadcast.biggestMoment && <div style={{fontSize:10,color:T.orange,textAlign:"center",marginBottom:4}}>
                  {"ðŸ† Biggest Moment: "+rivBroadcast.biggestMoment.text}
                </div>}
                <div style={{fontSize:9,color:T.faint,fontWeight:700,marginBottom:4}}>{"ðŸŽ¯ KEYS TO VICTORY"}</div>
                {rivBroadcast.keys.map(function(k,ki){
                  return <div key={ki} style={{padding:"4px 0",borderBottom:ki<rivBroadcast.keys.length-1?"1px solid "+T.border:"none"}}>
                    <div style={{display:"flex",gap:6,fontSize:10,alignItems:"center"}}>
                      <span>{k.icon}</span>
                      <span style={{fontWeight:700,color:T.text}}>{k.text}</span>
                      <span style={{fontSize:8,color:T.cyan}}>{k.stat}</span>
                    </div>
                    <div style={{fontSize:8,color:T.dim,paddingLeft:20,marginTop:1}}>
                      {"ðŸ’¡ "+k.plan+" â†’ Target: "+k.target}
                    </div>
                  </div>;
                })}
              </div>}
              
              {weekShow && season.phase==="regular" && React.createElement(WeeklyShowCard,{weekShow:weekShow,myId:myId,expanded:wkShowExpand,onToggle:function(){setWkShowExpand(function(v){return !v;})}})}
              {season.phase==="regular"&&done && <button style={mS(S.btn,S.btnPrimary,{width:"100%",padding:"14px 20px",fontSize:16,boxShadow:SH.glow})} onClick={function(){setSeason(function(s){return assign({},s,{phase:"playoffs"});});}}>{"ðŸ† Enter the Playoffs"}</button>}
              
              {season.phase==="preseason" && <div style={{display:"flex",gap:8,width:"100%"}}>
                <button style={mS(S.btn,{flex:2,background:"linear-gradient(135deg,"+T.orange+",#d97706)",color:"#000",padding:"12px 16px",fontSize:13,fontWeight:800})} onClick={simWeek}>{"ðŸˆ Sim Preseason Wk "+season.week+"/3"}</button>
                <button style={mS(S.btn,{flex:1,background:T.bg3,color:T.text,padding:"12px 16px",fontSize:11,fontWeight:700,border:"1px solid "+T.border})} onClick={simEntirePreseason}>{"â­ Sim All"}</button>
              </div>}
              {season.phase==="cutDay" && <div>
                <div style={assign({},cS,{borderColor:T.red})}>
                  <div style={{fontWeight:700,color:T.red}}>{"âœ‚ï¸ CUT DAY â€” Roster: "+my.roster.length+"/"+ROSTER_CAP}</div>
                  <div style={{fontSize:10,color:T.dim,marginTop:2}}>{"Must cut "+(my.roster.length-ROSTER_CAP)+" players. PS: "+(my.practiceSquad?my.practiceSquad.length:0)+"/"+PS_CAP}</div>
                </div>
                <div style={{display:"flex",gap:8}}>
                  <button style={bS(T.orange,"#000")} onClick={function(){setTab("roster");}}>{"ðŸ“‹ Manage Roster"}</button>
                  {my.roster.length<=ROSTER_CAP && <button style={megaGreen} onClick={finishCutDay}>{"âœ… Lock "+ROSTER_CAP+"-Man Roster"}</button>}
                </div></div>}
              {season.phase==="playoffs" && (function(){
                if(!poBracket){
                  return React.createElement("div",{style:assign({},cS,{textAlign:"center",borderColor:T.gold,background:"rgba(212,167,75,0.04)"})},
                    React.createElement("div",{style:{fontSize:32,marginBottom:6}},"ðŸ†"),
                    React.createElement("div",{style:{fontWeight:900,fontSize:18,color:T.gold,marginBottom:4}},"THE PLAYOFFS"),
                    React.createElement("div",{style:{color:T.dim,fontSize:11,marginBottom:12}},"4 EC + 4 WC teams. Win your conference, then win the championship."),
                    React.createElement("button",{style:megaGold,onClick:initPlayoffs},"ðŸŸï¸ Seed the Bracket")
                  );
                }
                var br=poBracket;
                var roundLabel=br.round==="QF"?"CONFERENCE ROUND 1":br.round==="SF"?"CONFERENCE FINALS":br.round==="CHAMP"?"CHAMPIONSHIP GAME":"ðŸ† CHAMPION CROWNED";
                var roundColor=br.round==="QF"?T.cyan:br.round==="SF"?T.orange:br.round==="CHAMP"?T.gold:T.gold;
                function gameCard(g,roundName,idx){
                  if(!g||!g.home) return React.createElement("div",{key:idx,style:{background:T.bg3,borderRadius:8,padding:12,border:"1px solid "+T.border,opacity:0.4,textAlign:"center"}},
                    React.createElement("div",{style:{color:T.faint,fontSize:10}},"TBD")
                  );
                  var played=!!g.result;var hW=played&&g.result.home>g.result.away;var aW=played&&g.result.away>g.result.home;
                  var margin=played?Math.abs(g.result.home-g.result.away):0;
                  var isUserGame=(g.home.id===myId||g.away.id===myId);
                  var borderCol=played?(g.winner&&g.winner.id===myId?T.gold:T.green):isUserGame?T.gold:T.border;
                  return React.createElement("div",{key:idx,style:{background:played?"rgba(212,167,75,0.03)":T.bg2,borderRadius:8,padding:10,border:"2px solid "+borderCol,marginBottom:6}},
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6}},
                      React.createElement("span",{style:{fontSize:9,color:T.faint,fontWeight:700}},roundName+(idx!==undefined?" "+(idx+1):"")),
                      played?React.createElement("span",{style:{fontSize:8,padding:"1px 6px",borderRadius:3,fontWeight:700,
                        background:margin>=21?T.green:margin<=3?T.gold:T.bg3,
                        color:margin>=21?"#000":margin<=3?"#000":T.dim}},
                        margin>=21?"BLOWOUT":margin<=7?"INSTANT CLASSIC":margin<=3?"NAIL-BITER":""):null
                    ),
                    React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6}},
                      React.createElement("div",{style:{flex:1,display:"flex",alignItems:"center",gap:6}},
                        React.createElement(TeamLogo,{team:g.home,size:28}),
                        React.createElement("div",null,
                          React.createElement("div",{style:{fontWeight:hW?900:600,fontSize:12,color:hW?T.gold:T.text}},g.home.abbr),
                          React.createElement("div",{style:{fontSize:9,color:T.faint}},g.home.wins!==undefined?g.home.wins+"W-"+g.home.losses+"L":"")
                        )
                      ),
                      played?React.createElement("div",{style:{textAlign:"center",minWidth:60}},
                        React.createElement("div",{style:{fontWeight:900,fontSize:20,color:T.gold}},g.result.home+" - "+g.result.away),
                        g.result.qtrs?React.createElement("div",{style:{fontSize:8,color:T.faint}},
                          (g.result.qtrs.h||[]).join(" | ")+" â€” "+(g.result.qtrs.a||[]).join(" | ")):null
                      ):React.createElement("div",{style:{fontSize:16,color:T.dim,fontWeight:800}},"VS"),
                      React.createElement("div",{style:{flex:1,display:"flex",alignItems:"center",gap:6,justifyContent:"flex-end"}},
                        React.createElement("div",{style:{textAlign:"right"}},
                          React.createElement("div",{style:{fontWeight:aW?900:600,fontSize:12,color:aW?T.gold:T.text}},g.away.abbr),
                          React.createElement("div",{style:{fontSize:9,color:T.faint}},g.away.wins!==undefined?g.away.wins+"W-"+g.away.losses+"L":"")
                        ),
                        React.createElement(TeamLogo,{team:g.away,size:28})
                      )
                    ),
                    played&&g.stars&&g.stars.length>0?React.createElement("div",{style:{marginTop:6,borderTop:"1px solid "+T.border,paddingTop:4,display:"flex",gap:8,flexWrap:"wrap"}},
                      g.stars.map(function(st,si){return React.createElement("span",{key:si,style:{fontSize:9,color:T.cyan,background:"rgba(34,211,238,0.06)",padding:"1px 6px",borderRadius:3}},
                        "â­ "+st.name+" "+st.stat);})
                    ):null,
                    played&&g.winner?React.createElement("div",{style:{marginTop:4,fontSize:9,color:T.green,fontWeight:700}},
                      "âœ… "+g.winner.icon+" "+g.winner.abbr+" advances"+(g.winner.id===myId?" ðŸŽ‰":"")):null
                  );
                }
                return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8}},
                  React.createElement("div",{style:assign({},cS,{textAlign:"center",borderColor:roundColor,background:"rgba(212,167,75,0.04)",padding:14})},
                    React.createElement("div",{style:{fontSize:22,marginBottom:2}},"ðŸ†"),
                    React.createElement("div",{style:{fontWeight:900,fontSize:15,color:roundColor,letterSpacing:1}},season.year+" PLAYOFFS"),
                    React.createElement("div",{style:{fontSize:12,color:T.dim,fontWeight:700,marginTop:2}},roundLabel)
                  ),
                  br.round==="DONE"?React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(212,167,75,0.15),rgba(212,167,75,0.04))",border:"2px solid "+T.gold,borderRadius:12,padding:20,textAlign:"center",marginBottom:4}},
                    React.createElement("div",{style:{fontSize:36,marginBottom:4}},"ðŸ†"),
                    React.createElement(Trophy,{type:"champ",size:56,year:String(season.year)}),
                    React.createElement("div",{style:{fontWeight:900,fontSize:18,color:T.gold,marginTop:8}},br.champ.winner.icon+" "+br.champ.winner.name),
                    React.createElement("div",{style:{fontSize:13,color:T.dim,marginTop:2}},season.year+" CHAMPIONS"),
                    React.createElement("div",{style:{fontSize:11,color:T.text,marginTop:6}},br.champ.result.home+" â€” "+br.champ.result.away)
                  ):null,
                  React.createElement("div",{style:assign({},cS,{padding:10})},
                    React.createElement("div",{style:{fontWeight:800,fontSize:10,color:T.gold,marginBottom:8,letterSpacing:1}},"BRACKET"),
                    React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:4,alignItems:"center"}},
                      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:2}},
                        br.qf.slice(0,2).map(function(g,i){
                          var w=g.winner;var col=w?T.green:T.faint;
                          return React.createElement("div",{key:i,style:{fontSize:9,padding:"3px 6px",background:T.bg3,borderRadius:3,border:"1px solid "+(w&&w.id===myId?T.gold:T.border)}},
                            React.createElement("span",{style:{color:g.result?col:T.dim}},(g.home||{}).abbr||"?"),(g.result?" "+g.result.home+"-"+g.result.away+" ":"  vs  "),
                            React.createElement("span",{style:{color:g.result?col:T.dim}},(g.away||{}).abbr||"?")
                          );
                        }),
                        br.sf[0]?React.createElement("div",{style:{fontSize:9,padding:"3px 6px",background:br.sf[0].result?"rgba(245,158,11,0.08)":T.bg3,borderRadius:3,border:"1px solid "+(br.sf[0].winner&&br.sf[0].winner.id===myId?T.gold:T.orange),marginTop:2}},
                          (br.sf[0].home||{}).abbr||"TBD",(br.sf[0].result?" "+br.sf[0].result.home+"-"+br.sf[0].result.away+" ":"  vs  "),(br.sf[0].away||{}).abbr||"TBD"
                        ):null
                      ),
                      React.createElement("div",{style:{textAlign:"center",padding:"0 6px"}},
                        React.createElement("div",{style:{fontSize:16}},"ðŸ†"),
                        br.champ.result?React.createElement("div",{style:{fontSize:10,fontWeight:900,color:T.gold}},
                          (br.champ.home||{}).abbr+" "+br.champ.result.home+"-"+br.champ.result.away+" "+(br.champ.away||{}).abbr
                        ):React.createElement("div",{style:{fontSize:9,color:T.faint}},br.champ.home?(br.champ.home.abbr+" vs "+br.champ.away.abbr):"TBD"),
                        br.champ.winner?React.createElement("div",{style:{fontSize:8,color:T.gold,fontWeight:800,marginTop:2}},br.champ.winner.icon+" CHAMP"):null
                      ),
                      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:2}},
                        br.qf.slice(2,4).map(function(g,i){
                          var w=g.winner;var col=w?T.green:T.faint;
                          return React.createElement("div",{key:i,style:{fontSize:9,padding:"3px 6px",background:T.bg3,borderRadius:3,border:"1px solid "+(w&&w.id===myId?T.gold:T.border)}},
                            React.createElement("span",{style:{color:g.result?col:T.dim}},(g.home||{}).abbr||"?"),(g.result?" "+g.result.home+"-"+g.result.away+" ":"  vs  "),
                            React.createElement("span",{style:{color:g.result?col:T.dim}},(g.away||{}).abbr||"?")
                          );
                        }),
                        br.sf[1]?React.createElement("div",{style:{fontSize:9,padding:"3px 6px",background:br.sf[1].result?"rgba(245,158,11,0.08)":T.bg3,borderRadius:3,border:"1px solid "+(br.sf[1].winner&&br.sf[1].winner.id===myId?T.gold:T.orange),marginTop:2}},
                          (br.sf[1].home||{}).abbr||"TBD",(br.sf[1].result?" "+br.sf[1].result.home+"-"+br.sf[1].result.away+" ":"  vs  "),(br.sf[1].away||{}).abbr||"TBD"
                        ):null
                      )
                    )
                  ),
                  br.round==="QF"?React.createElement("div",null,
                    React.createElement("div",{style:{fontWeight:800,fontSize:11,color:T.cyan,marginBottom:6,letterSpacing:1}},"CONFERENCE ROUND 1"),
                    br.qf.map(function(g,i){return gameCard(g,(g.conf||"")+" R1",i);})
                  ):null,
                  br.round==="SF"?(function(){return React.createElement("div",null,
                    React.createElement("div",{style:{fontWeight:800,fontSize:11,color:T.faint,marginBottom:4}},"CONFERENCE ROUND 1 RESULTS"),
                    br.qf.map(function(g,i){return gameCard(g,(g.conf||"")+" R1",i);}),
                    React.createElement("div",{style:{fontWeight:800,fontSize:11,color:T.orange,marginTop:8,marginBottom:6,letterSpacing:1}},"CONFERENCE FINALS"),
                    br.sf.map(function(g,i){return gameCard(g,(g.conf||"")+" FINAL",i);})
                  );})():null,
                  br.round==="CHAMP"||br.round==="DONE"?(function(){return React.createElement("div",null,
                    React.createElement("div",{style:{fontWeight:800,fontSize:11,color:T.faint,marginBottom:4}},"CONFERENCE FINAL RESULTS"),
                    br.sf.map(function(g,i){return gameCard(g,(g.conf||"")+" FINAL",i);}),
                    React.createElement("div",{style:{fontWeight:800,fontSize:11,color:T.gold,marginTop:8,marginBottom:6,letterSpacing:1}},br.round==="DONE"?"ðŸ† CHAMPIONSHIP RESULT":"ðŸ† CHAMPIONSHIP GAME"),
                    gameCard(br.champ,"CHAMP")
                  );})():null,
                  br.round==="QF"?React.createElement("button",{style:mS(S.btn,{width:"100%",padding:"12px 16px",fontSize:13,fontWeight:800,background:"linear-gradient(135deg,"+T.cyan+",#0891b2)",color:"#000"}),onClick:simPlayoffRound},"âš”ï¸ Sim Conference Round 1"):null,
                  br.round==="SF"?React.createElement("button",{style:mS(S.btn,{width:"100%",padding:"12px 16px",fontSize:13,fontWeight:800,background:"linear-gradient(135deg,"+T.orange+",#d97706)",color:"#000"}),onClick:simPlayoffRound},"âš”ï¸ Sim Conference Finals"):null,
                  br.round==="CHAMP"?React.createElement("button",{style:mS(S.btn,S.btnPrimary,{width:"100%",padding:"14px 16px",fontSize:14,boxShadow:SH.glow}),onClick:simPlayoffRound},"ðŸ† Sim Championship"):null,
                  br.round==="DONE"?React.createElement("div",{style:mS(S.card,{borderColor:T.gold,background:"rgba(212,167,75,0.06)",padding:16,textAlign:"center"})},
                    React.createElement("div",{style:{fontSize:24,marginBottom:4}},"ðŸ“‹"),
                    React.createElement("div",{style:{fontWeight:900,fontSize:16,color:T.gold,marginBottom:8}},"THE OFFSEASON BEGINS"),
                    React.createElement("div",{style:{fontSize:11,color:T.dim,marginBottom:12,lineHeight:1.5}},"Your season is complete. Here's what happens next:"),
                    React.createElement("div",{style:{textAlign:"left",fontSize:11,lineHeight:2,color:T.text,marginBottom:12}},
                      React.createElement("div",null,"1ï¸âƒ£ ",React.createElement("strong",null,"Re-Sign")," â€” Lock up your expiring players before they hit the market"),
                      React.createElement("div",null,"2ï¸âƒ£ ",React.createElement("strong",null,"Free Agency")," â€” Sign the best available players"),
                      React.createElement("div",null,"3ï¸âƒ£ ",React.createElement("strong",null,"Combine")," â€” Scout the incoming draft class (budget your points!)"),
                      React.createElement("div",null,"4ï¸âƒ£ ",React.createElement("strong",null,"Draft")," â€” Build the future with 7 rounds of picks"),
                      React.createElement("div",null,"5ï¸âƒ£ ",React.createElement("strong",null,"Owner Meeting")," â€” Annual performance review (don't get fired!)"),
                      React.createElement("div",null,"6ï¸âƒ£ ",React.createElement("strong",null,"Training Camp")," â€” Preseason with 75-man roster â†’ cut to 53")
                    ),
                    React.createElement("button",{style:mS(S.btn,S.btnPrimary,{width:"100%",padding:"14px 20px",fontSize:16,boxShadow:SH.glow}),onClick:function(){setSeason(function(s2){return assign({},s2,{phase:"reSign"});});setTab("reSign");}},"ðŸ—ï¸ Begin Offseason â€” Step 1: Re-Sign Players")
                  ):null
                );
              })()}
              {season.phase==="combine" && <div style={{display:"flex",flexDirection:"column",gap:8}}>
                <div style={assign({},cS,{borderColor:T.cyan,textAlign:"center"})}>
                  <div style={{fontSize:28}}>ðŸ‹ï¸</div>
                  <div style={{fontWeight:800,color:T.cyan,fontSize:15}}>THE COMBINE</div>
                  <div style={{fontSize:11,color:T.dim}}>{"Evaluate prospects. Scout Pts: "+(my.scoutPts||0)}</div>
                  <div style={{fontSize:10,color:T.faint,marginTop:4}}>Measurables (2pts) | Interview (3pts) | Film Study (4pts)</div>
                </div>
                <div style={{display:"flex",gap:8}}>
                  <button style={bS(T.cyan,"#000")} onClick={function(){setTab("combine");}}>ðŸ” Scout Prospects</button>
                  <button style={megaBlue} onClick={finishCombine}>ðŸ“‹ Start Draft â†’</button>
                </div></div>}
              
              {season.phase==="draft" && (function(){
                if(!dc||dc.length===0){
                  var regen=genDraftClass(getScaledDraftClassCount97());setDC(regen);
                  return React.createElement("div",{style:mS(S.card,{textAlign:"center",padding:20})},
                    React.createElement("div",{style:{fontSize:13,color:T.gold}},"ðŸ”„ Generating draft class..."),
                    React.createElement("div",{style:{fontSize:10,color:T.dim,marginTop:4}},"Refresh in a moment.")
                  );
                }
                var standings2=teams.slice().sort(function(a,b){return a.wins-b.wins||(a.pf-a.pa)-(b.pf-b.pa);});
                var myPicks=(my.draftPicks||[]).filter(function(pk){return !pk.year||pk.year===season.year;}).sort(function(a,b){return a.round-b.round;});
                var myNeeds=getTeamNeeds(my);var needKeys=Object.keys(myNeeds).slice(0,5);
                var fullyScoutedList=dc.filter(function(p){return typeof p.scouted==="object"&&p.scouted.complete;}).sort(function(a,b){return b.ovr-a.ovr;}).slice(0,5);
                var topProspects=dc.slice().sort(function(a,b){return b.hypeOvr-a.hypeOvr;}).slice(0,5);
                return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10}},
                  React.createElement("div",{style:mS(S.studioCard,{textAlign:"center",padding:20,background:"linear-gradient(135deg,rgba(37,99,235,0.12),rgba(59,130,246,0.04))",borderColor:"rgba(37,99,235,0.3)"})},
                    React.createElement("div",{style:{fontSize:48,marginBottom:6}},"ðŸ“º"),
                    React.createElement("div",{style:mS(S.header,{fontSize:22,color:T.blue,letterSpacing:3})},"DRAFT DAY "+season.year),
                    React.createElement("div",{style:{fontSize:13,color:T.gold,fontWeight:800,marginTop:4}},"THE FUTURE STARTS NOW"),
                    React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:6}},"You hold "+myPicks.length+" pick"+(myPicks.length!==1?"s":"")+". "+dc.length+" prospects await. Make history.")
                  ),
                  season.pr&&season.pr.bracket?React.createElement("div",{style:mS(S.card,{borderColor:"rgba(212,167,75,0.2)"})},
                    React.createElement("div",{style:mS(S.header,{fontSize:11,color:T.gold,marginBottom:6})},"ðŸ† "+season.year+" PLAYOFF RESULTS"),
                    season.pr.bracket.map(function(b,i){
                      var isFinal=b.final;var scores=b.s.split("-");var hScore=parseInt(scores[0])||0;var aScore=parseInt(scores[1])||0;var hWon=hScore>aScore;
                      return React.createElement("div",{key:i,style:{display:"flex",alignItems:"center",gap:6,padding:"3px 0",borderBottom:isFinal?"none":"1px solid "+T.border}},
                        React.createElement("span",{style:{fontSize:9,color:isFinal?T.gold:T.faint,fontWeight:700,width:40}},b.round),
                        React.createElement("span",{style:{fontWeight:hWon?800:400,color:hWon?(isFinal?T.gold:T.green):T.dim,fontSize:12}},b.h),
                        React.createElement("span",{style:{fontSize:12,fontWeight:800,color:isFinal?T.gold:T.dim,margin:"0 4px"}},b.s),
                        React.createElement("span",{style:{fontWeight:!hWon?800:400,color:!hWon?(isFinal?T.gold:T.green):T.dim,fontSize:12}},b.a),
                        isFinal?React.createElement("span",{style:{marginLeft:6,fontSize:12}},"ðŸ†"):null
                      );
                    })
                  ):null,
                  React.createElement("div",{style:mS(S.card,{borderColor:"rgba(251,191,36,0.2)"})},
                    React.createElement("div",{style:mS(S.header,{fontSize:11,color:T.gold,marginBottom:6})},"ðŸŽ¯ YOUR DRAFT PICKS"),
                    React.createElement("div",{style:{display:"flex",gap:6,flexWrap:"wrap"}},
                      myPicks.map(function(pk,pi){
                        var origT=teams.find(function(t2){return t2.id===pk.original;});
                        return React.createElement("div",{key:pi,style:{background:"rgba(251,191,36,0.1)",border:"1px solid rgba(251,191,36,0.25)",borderRadius:8,padding:"8px 12px",textAlign:"center",minWidth:60}},
                          React.createElement("div",{style:{fontSize:16,fontWeight:900,color:T.gold}},"Rd "+pk.round),
                          origT&&origT.id!==myId?React.createElement("div",{style:{fontSize:8,color:T.dim}},"via "+origT.abbr):null
                        );
                      })
                    )
                  ),
                  needKeys.length>0&&React.createElement("div",{style:mS(S.card,{borderColor:"rgba(239,68,68,0.2)"})},
                    React.createElement("div",{style:mS(S.header,{fontSize:11,color:T.red,marginBottom:6})},"ðŸš¨ BIGGEST NEEDS"),
                    React.createElement("div",{style:{display:"flex",gap:6,flexWrap:"wrap"}},
                      needKeys.map(function(pos){
                        return React.createElement("div",{key:pos,style:{background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.2)",borderRadius:6,padding:"6px 12px",fontSize:12,fontWeight:800,color:T.red}},pos);
                      })
                    )
                  ),
                  React.createElement("div",{style:mS(S.card,{borderColor:"rgba(34,211,238,0.2)"})},
                    React.createElement("div",{style:mS(S.header,{fontSize:11,color:T.cyan,marginBottom:6})},"ðŸ“‹ DRAFT ORDER (TOP 10)"),
                    standings2.slice(0,10).map(function(t2,si){
                      var isMe3=t2.id===myId;var tNeeds=Object.keys(getTeamNeeds(t2)).slice(0,3);
                      return React.createElement("div",{key:t2.id,style:{display:"flex",alignItems:"center",gap:8,padding:"4px 0",borderBottom:si<9?"1px solid rgba(255,255,255,0.04)":"none"}},
                        React.createElement("span",{style:{fontWeight:900,fontSize:12,width:20,color:isMe3?T.gold:T.dim,textAlign:"center"}},si+1),
                        React.createElement("span",{style:{fontSize:13,fontWeight:isMe3?800:500,color:isMe3?T.gold:T.text}},t2.icon+" "+t2.abbr),
                        React.createElement("span",{style:{fontSize:10,color:T.dim}},t2.wins+"-"+t2.losses),
                        React.createElement("span",{style:{fontSize:9,color:T.faint,marginLeft:"auto"}},tNeeds.length>0?"Need: "+tNeeds.join(", "):"")
                      );
                    })
                  ),
                  React.createElement("div",{style:mS(S.card,{borderColor:"rgba(52,211,153,0.2)"})},
                    React.createElement("div",{style:mS(S.header,{fontSize:11,color:T.green,marginBottom:6})},"â­ TOP PROSPECTS"),
                    topProspects.map(function(p,pi){
                      var isScouted=typeof p.scouted==="object"&&p.scouted.complete;
                      return React.createElement("div",{key:p.id,style:{display:"flex",alignItems:"center",gap:8,padding:"4px 0",borderBottom:pi<4?"1px solid rgba(255,255,255,0.04)":"none"}},
                        React.createElement("span",{style:{fontWeight:900,fontSize:12,width:20,color:pi===0?T.gold:T.dim,textAlign:"center"}},pi+1),
                        React.createElement("span",{style:{color:T.gold,fontWeight:700,fontSize:11}},p.pos),
                        React.createElement("span",{style:{fontSize:12,fontWeight:600}},p.name),
                        React.createElement("span",{style:{fontSize:10,color:T.dim}},p.college?p.college.school:""),
                        React.createElement("span",{style:{fontSize:11,fontWeight:800,color:isScouted?T.green:T.faint,marginLeft:"auto"}},isScouted?"OVR "+p.ovr:"Proj "+p.hypeOvr),
                        isScouted&&React.createElement("span",{style:{fontSize:8,background:"rgba(52,211,153,0.15)",color:T.green,padding:"1px 5px",borderRadius:6}},"âœ… Scouted")
                      );
                    })
                  ),
                  fullyScoutedList.length>0&&React.createElement("div",{style:{fontSize:10,color:T.cyan,textAlign:"center",padding:8}},
                    "ðŸ” "+dc.filter(function(p){return typeof p.scouted==="object"&&p.scouted.complete;}).length+" prospects fully scouted. You know their true potential."
                  ),
                  React.createElement("button",{style:mS(S.btn,S.btnPrimary,{width:"100%",padding:"18px 24px",fontSize:18,fontWeight:900,boxShadow:"0 0 30px rgba(37,99,235,0.4)",letterSpacing:2}),onClick:function(){startDraft();}},"ðŸˆ START THE DRAFT")
                );
              })()}
              {season.phase==="drafting" && <button style={bS(T.blue,"#fff")} onClick={function(){setTab("draft");}}>ðŸ“‹ Draft â†’</button>}
              {season.phase==="freeAgency" && <div style={{display:"flex",gap:8}}>
                <button style={bS(T.blue,"#fff")} onClick={function(){setTab("fa");}}>ðŸª FA â†’</button>
                <button style={megaGold} onClick={newSeason}>â­ Next Season</button></div>}
              {selGame&&selGame.tape && <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:4}}>ðŸ“Š TAPE</div>
                <div style={{fontSize:16,fontWeight:800}}>{selGame.tape.home.t+" "+selGame.home+"â€”"+selGame.away+" "+selGame.tape.away.t}</div>
                <table style={tS}><thead><tr><th style={thS}>Battle</th><th style={thS}>{selGame.tape.home.t}</th><th style={thS}>{selGame.tape.away.t}</th></tr></thead>
                  <tbody>
                    <tr><td style={assign({},tdS,{color:T.dim})}>ðŸ—ï¸Trench</td><td style={tdS}>{selGame.tape.home.pocket}</td><td style={tdS}>{selGame.tape.away.pocket}</td></tr>
                    <tr><td style={assign({},tdS,{color:T.dim})}>ðŸŽ¯Cov</td><td style={tdS}>{selGame.tape.home.cov}</td><td style={tdS}>{selGame.tape.away.cov}</td></tr>
                    <tr><td style={assign({},tdS,{color:T.dim})}>ðŸƒRun</td><td style={tdS}>{selGame.tape.home.run}</td><td style={tdS}>{selGame.tape.away.run}</td></tr>
                  </tbody></table>
                
                {(function(){
                  var stories=[];
                  if(!selGame||!selGame.tape) return null;
                  var hT2=teams.find(function(t){return t.abbr===selGame.tape.home.t;});
                  var aT2=teams.find(function(t){return t.abbr===selGame.tape.away.t;});
                  if(!hT2||!aT2) return null;
                  [hT2,aT2].forEach(function(t){
                    var opp=t===hT2?aT2:hT2;
                    t.roster.forEach(function(p){
                      if(p.formerTeam&&p.formerTeam===opp.id){
                        stories.push({icon:"ðŸ”¥",text:p.name+" ("+p.pos+") faces former team â€” REVENGE GAME",color:T.red});
                      }
                    });
                  });
                  if(hT2.staff&&hT2.staff.hc&&hT2.staff.hc.formerTeam===aT2.id){
                    stories.push({icon:"ðŸŽ“",text:"Master vs Apprentice: "+hT2.staff.hc.name+" (ex-"+aT2.abbr+" "+hT2.staff.hc.formerRole+") â€” scheme familiarity!",color:T.purple});
                  }
                  if(aT2.staff&&aT2.staff.hc&&aT2.staff.hc.formerTeam===hT2.id){
                    stories.push({icon:"ðŸŽ“",text:"Master vs Apprentice: "+aT2.staff.hc.name+" (ex-"+hT2.abbr+" "+aT2.staff.hc.formerRole+") â€” scheme familiarity!",color:T.purple});
                  }
                  var h2hG=sched.filter(function(g){return g.played&&((g.home===hT2.id&&g.away===aT2.id)||(g.away===hT2.id&&g.home===aT2.id));});
                  if(h2hG.length>=3)stories.push({icon:"âš”ï¸",text:"Heated Rivalry: "+h2hG.length+" meetings this era",color:T.orange});
                  var closeG=h2hG.filter(function(g){return Math.abs(g.result.home-g.result.away)<=7;});
                  if(closeG.length>=2)stories.push({icon:"ðŸ¤",text:closeG.length+" games decided by 7 or less â€” expect a battle",color:T.gold});
                  if((hT2.streak||0)>=4)stories.push({icon:"ðŸ”¥",text:hT2.abbr+" riding "+hT2.streak+"-game win streak",color:T.green});
                  if((aT2.streak||0)>=4)stories.push({icon:"ðŸ”¥",text:aT2.abbr+" riding "+aT2.streak+"-game win streak",color:T.green});
                  return stories.length>0?<div style={{marginTop:6,padding:8,background:"rgba(212,167,75,0.05)",borderRadius:6,borderLeft:"3px solid "+T.gold}}>
                    <div style={{fontSize:9,color:T.gold,fontWeight:700,marginBottom:4,letterSpacing:1}}>{"STORYLINES"}</div>
                    {stories.slice(0,4).map(function(s,si){
                      return <div key={si} style={{fontSize:10,color:s.color,marginBottom:2}}>
                        <span>{s.icon+" "}</span><span style={{fontWeight:600}}>{s.text}</span>
                      </div>;
                    })}
                  </div>:null;
                })()}
                </div>}
              
              {gameRecap && <div style={assign({},cS,{borderColor:T.blue})}>
                <div style={{fontWeight:700,fontSize:11,color:T.blue,marginBottom:6}}>{"ðŸ“Š LAST GAME â€” WHY YOU "+(gameRecap.score>gameRecap.oppScore?"WON":"LOST")}</div>
                <div style={{display:"flex",gap:12,marginBottom:6}}>
                  <div style={{textAlign:"center",flex:1}}><div style={{fontSize:8,color:T.faint}}>POCKET</div><div style={{fontSize:14,fontWeight:800,color:gameRecap.pressureRate>=50?T.green:T.red}}>{gameRecap.pressureRate}</div></div>
                  <div style={{textAlign:"center",flex:1}}><div style={{fontSize:8,color:T.faint}}>COV</div><div style={{fontSize:14,fontWeight:800,color:gameRecap.coverageWin>=50?T.green:T.red}}>{gameRecap.coverageWin}</div></div>
                  <div style={{textAlign:"center",flex:1}}><div style={{fontSize:8,color:T.faint}}>RUN</div><div style={{fontSize:14,fontWeight:800,color:gameRecap.runLaneAdv>=50?T.green:T.red}}>{gameRecap.runLaneAdv}</div></div>
                  <div style={{textAlign:"center",flex:1}}><div style={{fontSize:8,color:T.faint}}>TO</div><div style={{fontSize:14,fontWeight:800,color:gameRecap.turnovers>0?T.red:T.green}}>{gameRecap.turnovers}</div></div>
                  <div style={{textAlign:"center",flex:1}}><div style={{fontSize:8,color:T.faint}}>RZ%</div><div style={{fontSize:14,fontWeight:800,color:gameRecap.rzEff>=50?T.green:T.red}}>{gameRecap.rzEff}</div></div>
                </div>
                <div style={{fontSize:10,color:T.gold,fontWeight:600}}>{"ðŸ’¡ "+gameRecap.fix}</div>
                
                <div style={{display:"flex",gap:8,marginTop:6,flexWrap:"wrap"}}>
                  {[["POCKET",gameRecap.pressureRate,55],["COV",gameRecap.coverageWin,52],["RUN",gameRecap.runLaneAdv,50]].map(function(m){
                    var delta=m[1]-m[2];var isGood=delta>=0;
                    return <span key={m[0]} style={{fontSize:8,padding:"1px 4px",borderRadius:3,
                      background:isGood?"rgba(52,211,153,0.08)":"rgba(239,68,68,0.08)",
                      color:isGood?T.green:T.red}}>{m[0]+": "+m[1]+" (avg "+m[2]+", "+(delta>=0?"+":"")+delta+")"}</span>;
                  })}
                </div>
              </div>}
              
              {gameRecap && gameRecap.score<gameRecap.oppScore && (function(){
                var cfs=generateCounterfactual(gameRecap,null);
                if(!cfs||cfs.length===0)return null;
                return <div style={assign({},cS,{borderColor:"#a78bfa",background:"rgba(167,139,250,0.04)"})}>
                  <div style={{fontWeight:700,fontSize:11,color:"#a78bfa",marginBottom:6}}>{"ðŸ”® WHAT IF..."}</div>
                  {cfs.map(function(cf,ci){
                    return <div key={ci} style={{padding:"4px 0",borderBottom:ci<cfs.length-1?"1px solid "+T.border:"none"}}>
                      <div style={{fontSize:10,color:T.text}}>
                        <span style={{fontWeight:700}}>{cf.metric+": "}</span>
                        <span style={{color:T.dim}}>{cf.change}</span>
                        <span>{" â†’ "+cf.impact}</span>
                      </div>
                      <div style={{fontSize:9,display:"flex",gap:6,marginTop:2}}>
                        <span style={{fontWeight:700}}>{cf.verdict}</span>
                        <span style={{fontSize:8,padding:"1px 3px",borderRadius:2,
                          color:cf.confidence==="HIGH"?T.green:T.orange,
                          background:"rgba(255,255,255,0.04)"}}>{cf.confidence}</span>
                      </div>
                    </div>;
                  })}
                </div>;
              })()}
              
              {gameRecap && prevRecap && (function(){
                var deltas=calcWeekDeltas(gameRecap,prevRecap);
                if(!deltas)return null;
                var recentLedger2=(season.ledger||[]).filter(function(e){return e.week>=season.week-1;}).slice(0,10);
                return <div style={assign({},cS,{borderColor:T.cyan})}>
                  <div style={{fontWeight:700,fontSize:11,color:T.cyan,marginBottom:6}}>{"ðŸ“Š WHAT CHANGED?"}</div>
                  {deltas.map(function(dd,di){
                    var att=attributeCause(dd,recentLedger2);
                    var confColor=att.confidence==="HIGH"?T.green:att.confidence==="MED"?T.orange:T.dim;
                    return <div key={di} style={{display:"flex",justifyContent:"space-between",padding:"3px 0",
                      borderBottom:di<deltas.length-1?"1px solid "+T.border:"none",fontSize:11}}>
                      <div style={{display:"flex",gap:6,alignItems:"center"}}>
                        <span>{dd.icon}</span>
                        <span style={{fontWeight:700}}>{dd.label}</span>
                        <span style={{color:T.faint}}>{dd.prev+" â†’ "+dd.cur}</span>
                      </div>
                      <div style={{display:"flex",gap:4,alignItems:"center"}}>
                        <span style={{fontWeight:800,color:dd.good?T.green:T.red}}>
                          {(dd.delta>0?"+":"")+dd.delta}
                        </span>
                        <span style={{fontSize:7,padding:"1px 3px",borderRadius:2,fontWeight:700,
                          color:confColor,background:"rgba(255,255,255,0.04)"}}>{att.confidence}</span>
                        <span style={{fontSize:8,color:T.dim}}>{att.cause}</span>
                        {att.proofs&&att.proofs.length>0 && <span style={{fontSize:7,color:T.faint}}
                          title={att.proofs.map(function(p){return p.type+": "+(p.text||"").slice(0,40);}).join("\n")}>
                          {"ðŸ“Ž"+att.proofs.length}</span>}
                      </div>
                    </div>;
                  })}
                </div>;
              })()}
              
              {selGame && (function(){
                var hl=generateHighlights(selGame);
                if(hl.length===0)return null;
                return <div style={assign({},cS,{borderColor:T.purple})}>
                  <div style={{fontWeight:700,fontSize:11,color:T.purple,marginBottom:6}}>{"ðŸŽ¬ 3 PLAYS THAT CHANGED THE GAME"}</div>
                  {hl.map(function(h,hi){
                    return <div key={hi} style={{display:"flex",gap:6,padding:"3px 0",fontSize:11,borderBottom:hi<hl.length-1?"1px solid "+T.border:"none"}}>
                      <span style={{fontSize:14}}>{h.icon}</span>
                      <span style={{color:T.text}}>{h.text}</span>
                    </div>;
                  })}
                </div>;
              })()}
              
              {my && (function(){
                var cliques=[0,1,2].map(function(cId){
                  var members=my.roster.filter(function(p){return (p.cliqueId||0)===cId;});
                  var avgChem=members.length>0?Math.round(members.reduce(function(s,p){return s+(p.chemistry||60);},0)/members.length):0;
                  return {type:CLIQUE_TYPES[cId],count:members.length,avgChem:avgChem};
                });
                var avgSys=my.roster.length>0?Math.round(my.roster.reduce(function(s,p){return s+(p.systemFit||30);},0)/my.roster.length):0;
                var teamChem=my.roster.length>0?Math.round(my.roster.reduce(function(s,p){return s+(p.chemistry||60);},0)/my.roster.length):0;
                var chemColor=teamChem>=75?T.green:teamChem>=55?T.gold:T.red;
                var sysColor=avgSys>=65?T.green:avgSys>=40?T.gold:T.red;
                return <div style={assign({},cS,{borderColor:"rgba(168,85,247,0.2)"})}>
                  <div style={{fontWeight:700,fontSize:11,color:T.purple,marginBottom:6}}>{"ðŸ‘¥ LOCKER ROOM"}</div>
                  <div style={{display:"flex",gap:8,marginBottom:6}}>
                    {cliques.map(function(cl2){
                      var cColor=cl2.avgChem>=75?T.green:cl2.avgChem>=55?T.gold:T.red;
                      return <div key={cl2.type.id} style={{flex:1,textAlign:"center",padding:4,borderRadius:6,background:"rgba(255,255,255,0.03)"}}>
                        <div style={{fontSize:12}}>{cl2.type.icon}</div>
                        <div style={{fontSize:9,fontWeight:700,color:T.text}}>{cl2.type.label}</div>
                        <div style={{fontSize:14,fontWeight:900,color:cColor}}>{cl2.avgChem}</div>
                        <div style={{fontSize:8,color:T.faint}}>{cl2.count+" players"}</div>
                      </div>;
                    })}
                  </div>
                  <div style={{display:"flex",gap:12,fontSize:9,alignItems:"center",flexWrap:"wrap"}}>
                    <span style={{color:chemColor,fontWeight:700}}>{"ðŸ¤ Team Chemistry: "+teamChem}</span>
                    <span style={{color:sysColor,fontWeight:700}}>{"ðŸ§  System Knowledge: "+avgSys}</span>
                  </div>
                  {(function(){
                    var sysGrade=avgSys>=75?"ELITE":avgSys>=55?"SOLID":avgSys>=35?"DEVELOPING":"WEAK";
                    var sysImpact=avgSys>=75?"ðŸ”’ Fewest turnovers, tightest coverages, max drive efficiency.":
                      avgSys>=55?"âœ… Stable offense. Manageable INT risk.":
                      avgSys>=35?"âš ï¸ Elevated stall rate. Occasional blown coverages.":
                      "ðŸš¨ HIGH turnover risk. Drives stall often. Blown coverages.";
                    var sysGradeColor=avgSys>=75?T.green:avgSys>=55?T.gold:avgSys>=35?T.orange:T.red;
                    return <div style={{marginTop:6,padding:"6px 8px",borderRadius:6,background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.06)"}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3}}>
                        <span style={{fontSize:8,fontWeight:800,color:sysGradeColor,letterSpacing:1}}>{sysGrade+" SYSTEM FIT"}</span>
                        <span style={{fontSize:7,color:T.faint}}>{"Affects INT rate, stall rate & coverages"}</span>
                      </div>
                      <div style={{fontSize:8,color:T.dim,marginBottom:4}}>{sysImpact}</div>
                      <div style={{fontSize:7,color:T.faint,borderTop:"1px solid rgba(255,255,255,0.05)",paddingTop:3}}>
                        {"ðŸ“ˆ Improve: ðŸ” Opponent Scout (+fastest) Â· ðŸ’ª Full Pads (+moderate) Â· Stability = no scheme changes"}
                      </div>
                    </div>;
                  })()}
                </div>;
              })()}
              
              {season.phase==="regular"&&my && (function(){
                var wx=WEATHER.getConditions(my.id,season.week,SEED_GLOBAL);
                var impact=WEATHER.getImpact(wx);
                var hasImpact=impact.passAccMod!==0||impact.fumbleMod!==0||impact.kickMod!==0;
                return <div style={assign({},cS,{borderColor:wx.precip==="SNOW"?"#93c5fd":wx.precip==="RAIN"?"#6366f1":"rgba(96,165,250,0.15)",
                  background:wx.precip==="SNOW"?"rgba(147,197,253,0.06)":wx.precip==="RAIN"?"rgba(99,102,241,0.04)":"transparent"})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <div>
                      <div style={{fontWeight:800,fontSize:11,color:T.cyan}}>{"â›ˆï¸ GAME DAY FORECAST â€” Week "+season.week}</div>
                      <div style={{fontSize:14,fontWeight:900,marginTop:2}}>{wx.emoji+" "+wx.label}</div>
                    </div>
                    {hasImpact && <div style={{textAlign:"right"}}>
                      {impact.passAccMod<0 && <div style={{fontSize:8,color:T.orange}}>{"ðŸ“‰ Pass: "+Math.round(impact.passAccMod*100)+"%"}</div>}
                      {impact.fumbleMod>0 && <div style={{fontSize:8,color:T.red}}>{"ðŸ§ˆ Fumble: +"+Math.round(impact.fumbleMod*100)+"%"}</div>}
                      {impact.kickMod<0 && <div style={{fontSize:8,color:T.orange}}>{"ðŸ¦¶ Kick: "+Math.round(impact.kickMod*100)+"%"}</div>}
                    </div>}
                  </div>
                </div>;
              })()}
              
              {rivalryGD && season.phase==="regular" && <div style={assign({},cS,{borderColor:"#ef4444",background:"rgba(239,68,68,0.04)"})}>
                <div style={{fontWeight:900,fontSize:12,color:"#ef4444",marginBottom:4}}>{"ðŸŸï¸ RIVALRY GAME DAY"}</div>
                <div style={{display:"flex",gap:8,alignItems:"center",marginBottom:6}}>
                  <span style={{fontSize:16}}>{rivalryGD.team.icon}</span>
                  <span style={{fontWeight:800,fontSize:14}}>{rivalryGD.team.abbr}</span>
                  <span style={{color:T.faint,fontWeight:700}}>{"vs"}</span>
                  <span style={{fontWeight:800,fontSize:14}}>{rivalryGD.opponent.abbr}</span>
                  <span style={{fontSize:16}}>{rivalryGD.opponent.icon}</span>
                  <span style={{fontSize:9,padding:"2px 6px",borderRadius:3,fontWeight:700,color:"#fff",
                    background:rivalryGD.tier==="BLOOD_FEUD"?"#ef4444":rivalryGD.tier==="BITTER"?"#f59e0b":"#64748b"}}>{rivalryGD.tier.replace("_"," ")}</span>
                  <span style={{fontSize:10,fontWeight:700,color:T.orange}}>{"ðŸ”¥ "+rivalryGD.heat}</span>
                </div>
                {rivalryGD.tName && <div style={{fontSize:10,color:T.gold,fontWeight:700,marginBottom:4}}>{"ðŸ·ï¸ "+rivalryGD.tName+" is on the line"}</div>}
                <div style={{fontSize:10,color:T.dim,marginBottom:4}}>{"Series: "+rivalryGD.seriesW+"-"+rivalryGD.seriesL}</div>
                {rivalryGD.keyMatchup && <div style={{fontSize:9,marginBottom:4,padding:"3px 6px",background:T.bg3,borderRadius:4}}>
                  {"âš”ï¸ Key Matchup: "+rivalryGD.keyMatchup.our+" vs "+rivalryGD.keyMatchup.their}
                </div>}
                <div style={{fontSize:9,color:T.faint}}>
                  {rivalryGD.stakes.map(function(s,si){return <div key={si}>{"â€¢ "+s}</div>;})}
                </div>
              </div>}
              
              {season.phase==="freeAgency" && faMarket.length>0 && <div style={assign({},cS,{borderColor:"#10b981",background:"rgba(16,185,129,0.03)"})}>
                <div style={{fontWeight:900,fontSize:12,color:T.green,marginBottom:4}}>{"ðŸª FREE AGENT FRENZY"}</div>
                {faHeadlines.length>0 && <div style={{marginBottom:6}}>
                  <div style={{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}}>{"BREAKING NEWS"}</div>
                  {faHeadlines.slice(0,4).map(function(hl,hi){
                    return <div key={hi} style={{fontSize:9,padding:"2px 0",borderBottom:hi<3?"1px solid "+T.border:"none"}}>
                      {hl.emoji+" "+hl.text}
                    </div>;
                  })}
                </div>}
                <div style={{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}}>{"TOP FREE AGENTS"}</div>
                <div style={{maxHeight:180,overflow:"auto"}}>
                  {faMarket.slice(0,8).map(function(fa,fi){
                    return <div key={fi} style={{display:"flex",gap:6,alignItems:"center",padding:"3px 0",
                      borderBottom:fi<7?"1px solid "+T.border:"none",fontSize:10}}>
                      <span style={{width:20,fontWeight:800,color:fi<3?T.gold:T.faint}}>{fi+1}</span>
                      <span style={{fontWeight:700,flex:1}}>{fa.name}</span>
                      <span style={{fontSize:8,color:T.cyan}}>{fa.pos}</span>
                      <span style={{fontWeight:700}}>{fa.ovr}</span>
                      <span style={{fontSize:8,color:T.faint}}>{"$"+fa.asking+"M"}</span>
                      <span style={{fontSize:8,fontWeight:700,
                        color:fa.heat.indexOf("HOT")>=0?T.red:fa.heat.indexOf("Active")>=0?T.orange:T.dim}}>{fa.heat}</span>
                      <span style={{fontSize:7,color:T.dim}}>{fa.interested.length+" teams"}</span>
                    </div>;
                  })}
                </div>
              </div>}
              
              {broadcast && <div style={assign({},cS,{borderColor:"#f59e0b",background:"rgba(245,158,11,0.03)"})}>
                <div style={{fontWeight:800,fontSize:12,color:"#f59e0b",marginBottom:4}}>{"ðŸ“º WEEKLY BROADCAST â€” Week "+broadcast.week}</div>
                <div style={{fontSize:10,color:T.dim,fontStyle:"italic",marginBottom:6}}>{broadcast.storyline}</div>
                
                {broadcast.headlines.map(function(hl,hi){
                  return <div key={hi} style={{fontSize:10,padding:"3px 0",borderBottom:hi<broadcast.headlines.length-1?"1px solid "+T.border:"none"}}>
                    <span>{hl.emoji+" "}</span><span style={{fontWeight:600}}>{hl.text}</span>
                  </div>;
                })}
                
                {gotw && <div style={{marginTop:6,padding:6,borderRadius:6,background:"rgba(245,158,11,0.06)",border:"1px solid rgba(245,158,11,0.2)"}}>
                  <div style={{fontSize:9,fontWeight:800,color:"#f59e0b",marginBottom:3}}>{"ðŸŒŸ GAME OF THE WEEK"}</div>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                    <span style={{fontWeight:800,fontSize:12}}>{gotw.hT.icon+" "+gotw.hT.abbr+" "+gotw.hS+" â€” "+gotw.aS+" "+gotw.aT.abbr+" "+gotw.aT.icon}</span>
                  </div>
                  <div style={{display:"flex",gap:4,marginBottom:4,flexWrap:"wrap"}}>
                    {gotw.whyTags.map(function(tag,ti){
                      return <span key={ti} style={{fontSize:7,padding:"1px 4px",borderRadius:3,fontWeight:700,
                        color:"#f59e0b",background:"rgba(245,158,11,0.1)"}}>{tag}</span>;
                    })}
                  </div>
                  {gotw.highlights.map(function(hl,hi){
                    return <div key={hi} style={{fontSize:9,padding:"2px 0",color:T.dim}}>
                      {hl.emoji+" "}<span style={{fontWeight:600,color:T.text}}>{hl.label+":"}</span>{" "+hl.text}
                    </div>;
                  })}
                </div>}
                
                {potw && (potw.opow||potw.dpow) && <div style={{marginTop:4,display:"flex",gap:6}}>
                  {potw.opow && <div style={{flex:1,padding:4,borderRadius:4,background:"rgba(52,211,153,0.05)",border:"1px solid rgba(52,211,153,0.15)"}}>
                    <div style={{fontSize:7,fontWeight:800,color:T.green,letterSpacing:1}}>{"â­ OPOW"}</div>
                    <div style={{fontSize:10,fontWeight:700}}>{potw.opow.icon+" "+potw.opow.name}</div>
                    <div style={{fontSize:8,color:T.dim}}>{potw.opow.pos+" "+potw.opow.team+" â€” "+potw.opow.line}</div>
                  </div>}
                  {potw.dpow && <div style={{flex:1,padding:4,borderRadius:4,background:"rgba(96,165,250,0.05)",border:"1px solid rgba(96,165,250,0.15)"}}>
                    <div style={{fontSize:7,fontWeight:800,color:T.cyan,letterSpacing:1}}>{"ðŸ›¡ï¸ DPOW"}</div>
                    <div style={{fontSize:10,fontWeight:700}}>{potw.dpow.icon+" "+potw.dpow.name}</div>
                    <div style={{fontSize:8,color:T.dim}}>{potw.dpow.pos+" "+potw.dpow.team+" â€” "+potw.dpow.line}</div>
                  </div>}
                </div>}
                
                <div style={{marginTop:6,borderTop:"1px solid "+T.border,paddingTop:4}}>
                  <div style={{fontSize:9,fontWeight:700,color:"#f59e0b",marginBottom:3}}>{"ðŸ“Š POWER RANKINGS"}</div>
                  {broadcast.powerRankings.slice(0,5).map(function(pr,pri){
                    var isUser=pr.team.isUser;
                    return <div key={pri} style={{display:"flex",gap:6,alignItems:"center",padding:"2px 0",fontSize:10,
                      background:isUser?"rgba(251,191,36,0.06)":"transparent",borderRadius:3}}>
                      <span style={{fontWeight:800,width:18,textAlign:"right",color:T.faint}}>{"#"+pr.rank}</span>
                      <span style={{color:pr.delta>0?T.green:pr.delta<0?T.red:T.faint,fontSize:9,width:16}}>{pr.emoji}</span>
                      <span>{pr.team.icon}</span>
                      <span style={{fontWeight:isUser?800:600,color:isUser?T.gold:T.text}}>{pr.team.abbr}</span>
                      <span style={{color:T.dim}}>{pr.wins+"-"+pr.losses}</span>
                      <span style={{fontSize:8,color:pr.streak>=3?T.green:pr.streak<=-3?T.red:T.faint}}>
                        {pr.streak>=2?"ðŸ”¥"+pr.streak+"W":pr.streak<=-2?"â„ï¸"+Math.abs(pr.streak)+"L":""}
                      </span>
                    </div>;
                  })}
                </div>
              </div>}
              
              {filmRoom && season.phase==="regular" && <div style={assign({},cS,{borderColor:"rgba(168,85,247,0.3)",background:"rgba(168,85,247,0.03)"})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                  <div style={{fontWeight:800,fontSize:11,color:T.purple,letterSpacing:1}}>{"ðŸŽ¥ FILM ROOM â€” Week "+(season.week-1)}</div>
                  <span style={{fontSize:10,fontWeight:900,
                    color:filmRoom.won?T.green:T.red}}>{(filmRoom.won?"W ":"L ")+filmRoom.userScore+"-"+filmRoom.oppScore+" vs "+filmRoom.oppTeam}</span>
                </div>
                
                <div style={{display:"flex",gap:6,marginBottom:6}}>
                  {[{label:"OFF",val:filmRoom.grades.off},{label:"DEF",val:filmRoom.grades.def},{label:"ST",val:filmRoom.grades.st}].map(function(u,ui){
                    var col=u.val>=80?T.green:u.val>=65?T.gold:u.val>=50?T.orange:T.red;
                    return <div key={ui} style={{flex:1,textAlign:"center",padding:6,borderRadius:6,background:col+"12",border:"1px solid "+col+"30"}}>
                      <div style={{fontSize:8,fontWeight:700,color:T.faint}}>{u.label}</div>
                      <div style={{fontSize:18,fontWeight:900,color:col}}>{FILM.letterGrade(u.val)}</div>
                      <div style={{fontSize:8,color:T.dim}}>{u.val+"/99"}</div>
                    </div>;
                  })}
                  <div style={{flex:1,textAlign:"center",padding:6,borderRadius:6,background:"rgba(212,167,75,0.08)",border:"1px solid rgba(212,167,75,0.2)"}}>
                    <div style={{fontSize:8,fontWeight:700,color:T.faint}}>{"OVERALL"}</div>
                    <div style={{fontSize:18,fontWeight:900,color:T.gold}}>{FILM.letterGrade(filmRoom.overall)}</div>
                    <div style={{fontSize:8,color:T.dim}}>{filmRoom.overall+"/99"}</div>
                  </div>
                </div>
                
                <div style={{fontSize:10,fontStyle:"italic",color:T.dim,marginBottom:6,padding:"4px 6px",background:"rgba(168,85,247,0.04)",borderRadius:4}}>
                  {"ðŸ”‘ "+filmRoom.turning}
                </div>
                
                {filmRoom.weather && filmRoom.weather.precip!=="CLEAR" && filmRoom.weather.precip!=="DOME" && <div style={{fontSize:9,color:T.cyan,marginBottom:4}}>
                  {filmRoom.weather.emoji+" Weather impact: "+filmRoom.weather.label}
                </div>}
                
                {filmRoom.halftime && <div style={{fontSize:9,color:T.green,marginBottom:4,padding:"3px 6px",background:"rgba(34,197,94,0.06)",borderRadius:4}}>
                  {"âš¡ Halftime: "+filmRoom.halftime.label+(filmRoom.won?" â†’ âœ… Worked!":" â†’ âŒ Wasn't enough")}
                </div>}
                
                {filmRoom.gameplan&&filmRoom.gameplan.off && (function(){
                  var offP=OFF_PLANS.find(function(p){return p.id===filmRoom.gameplan.off;})||OFF_PLANS[0];
                  var defP=DEF_PLANS.find(function(p){return p.id===filmRoom.gameplan.def;})||DEF_PLANS[0];
                  return <div style={{fontSize:9,color:T.blue,marginBottom:4,padding:"3px 6px",background:"rgba(59,130,246,0.06)",borderRadius:4}}>
                    {"ðŸ“‹ Plan: "+offP.icon+" "+offP.name+" / "+defP.icon+" "+defP.name}
                  </div>;
                })()}
                
                {filmRoom.practiceFocus && <div style={{fontSize:9,color:T.purple,marginBottom:4,padding:"3px 6px",background:"rgba(168,85,247,0.06)",borderRadius:4}}>
                  {"ðŸ‹ï¸ Practice: "+filmRoom.practiceFocus.label}
                </div>}
                
                {filmRoom.captainMoments&&filmRoom.captainMoments.length>0 && <div style={{marginBottom:4}}>
                  {filmRoom.captainMoments.map(function(cm2,ci2){
                    return <div key={ci2} style={{fontSize:9,color:T.gold,padding:"3px 6px",background:"rgba(234,179,8,0.06)",borderRadius:4,marginBottom:2}}>
                      {cm2.emoji+" Captain: "+cm2.text}
                    </div>;
                  })}
                </div>}
                
                {filmRoom.insights.map(function(ins,ii){
                  var insCol=ins.grade==="A"||ins.grade==="A+"?T.green:ins.grade==="B"||ins.grade==="B+"?T.cyan:
                    ins.grade==="C"||ins.grade==="C+"?T.gold:T.red;
                  return <div key={ii} style={{padding:"4px 6px",marginBottom:3,borderRadius:4,borderLeft:"3px solid "+insCol,background:insCol+"08"}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <span style={{fontSize:10}}>{ins.emoji+" "+ins.text}</span>
                      <span style={{fontSize:9,fontWeight:800,color:insCol}}>{ins.grade}</span>
                    </div>
                  </div>;
                })}
              </div>}
              
              {season.phase==="regular" && (function(){
                var htSetCount=Object.keys(halftimePlans).filter(function(k){return halftimePlans[k];}).length;
                var headerColor=htSetCount===5?T.green:htSetCount>0?T.gold:T.gold;
                return <div style={assign({},cS,{borderColor:htSetCount===5?"rgba(34,197,94,0.4)":"rgba(251,191,36,0.3)",
                  background:htSetCount===5?"rgba(34,197,94,0.04)":"rgba(251,191,36,0.03)"})}> 
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                    <div style={{fontWeight:800,fontSize:11,color:headerColor,letterSpacing:1}}>{"âš¡ HALFTIME PLANS â€” Week "+season.week}</div>
                    <span style={{fontSize:9,background:headerColor+"20",color:headerColor,padding:"2px 8px",borderRadius:10,fontWeight:700}}>
                      {htSetCount+"/5 set"}
                    </span>
                  </div>
                  <div style={{fontSize:9,color:T.dim,marginBottom:8}}>{"For each score situation, pick your 2nd-half strategy. The matching one fires automatically at halftime."}</div>
                  <div style={{display:"flex",flexDirection:"column",gap:6}}>
                    {HT_CONDITIONS.map(function(cond){
                      var selectedId=halftimePlans[cond.id]||null;
                      var selectedStrat=selectedId?HT_STRATEGIES.find(function(s){return s.id===selectedId;}):null;
                      return <div key={cond.id} style={{borderRadius:8,border:"1px solid "+T.border,overflow:"hidden"}}>
                        <div style={{display:"flex",alignItems:"center",padding:"5px 8px",
                          background:selectedStrat?"rgba(59,130,246,0.06)":"rgba(255,255,255,0.02)"}}>
                          <div style={{fontSize:10,fontWeight:700,color:selectedStrat?T.blue:T.faint,minWidth:110}}>{cond.condLabel}</div>
                          <div style={{fontSize:9,color:selectedStrat?T.text:T.dim,flex:1,fontStyle:selectedStrat?"normal":"italic"}}>
                            {selectedStrat?selectedStrat.label+" â€” "+selectedStrat.desc:"No plan set"}
                          </div>
                          {selectedStrat&&<span style={{fontSize:8,color:T.green,fontWeight:700,marginLeft:4}}>{"âœ“"}</span>}
                        </div>
                        <div style={{display:"flex",flexWrap:"wrap",gap:3,padding:"5px 8px",borderTop:"1px solid "+T.border,
                          background:"rgba(0,0,0,0.15)"}}>
                          {HT_STRATEGIES.map(function(strat){
                            var isSel=selectedId===strat.id;
                            return <div key={strat.id} onClick={function(){
                              var next=assign({},halftimePlans);
                              if(isSel){delete next[cond.id];}else{next[cond.id]=strat.id;}
                              setHalftimePlans(next);
                              if(!isSel)setCoachClinic(function(prev){return CLINIC.earnXP(assign({},prev),"halftime_pick",2);});
                            }} style={{padding:"3px 7px",borderRadius:6,cursor:"pointer",fontSize:9,fontWeight:isSel?700:400,
                              border:isSel?"1px solid "+T.blue:"1px solid "+T.border,
                              background:isSel?"rgba(59,130,246,0.15)":"rgba(255,255,255,0.03)",
                              color:isSel?T.blue:T.dim,transition:"all 0.12s"}}>
                              {strat.label}
                            </div>;
                          })}
                        </div>
                      </div>;
                    })}
                  </div>
                </div>;
              })()}
              
              {season.phase==="regular" && (function(){
                var report=INJURY_REPORT.generate(teams,season.week,myId,sched);
                if(report.items.length===0)return null;
                return <div style={assign({},cS,{borderColor:"rgba(239,68,68,0.2)",background:"rgba(239,68,68,0.02)"})}>
                  <div style={{fontWeight:800,fontSize:11,color:T.red,letterSpacing:1,marginBottom:6}}>{"ðŸ¥ INJURY REPORT â€” Week "+season.week}</div>
                  <div style={{display:"flex",gap:8}}>
                    <div style={{flex:3}}>
                      {report.items.map(function(inj,ii){
                        var sevCol=inj.status==="IR"?T.red:inj.status==="Out"?T.orange:T.gold;
                        return <div key={ii} style={{display:"flex",justifyContent:"space-between",alignItems:"center",
                          padding:"3px 0",borderBottom:ii<report.items.length-1?"1px solid "+T.border:"none"}}>
                          <div style={{display:"flex",gap:4,alignItems:"center"}}>
                            <span style={{fontSize:10}}>{inj.teamIcon}</span>
                            <span style={{fontSize:10,fontWeight:600}}>{inj.name}</span>
                            <span style={{fontSize:8,color:T.dim}}>{inj.pos+" "+inj.ovr}</span>
                          </div>
                          <div style={{display:"flex",gap:6,alignItems:"center"}}>
                            <span style={{fontSize:8,color:T.dim}}>{inj.type}</span>
                            <span style={{fontSize:8,fontWeight:700,color:sevCol,padding:"1px 5px",
                              borderRadius:4,background:sevCol+"15"}}>{inj.status+" ("+inj.weeksLeft+"wk)"}</span>
                          </div>
                        </div>;
                      })}
                    </div>
                    {report.matchupNotes.length>0 && <div style={{flex:2,borderLeft:"1px solid "+T.border,paddingLeft:8}}>
                      <div style={{fontSize:9,fontWeight:700,color:T.cyan,marginBottom:4}}>{"MATCHUP IMPACT"}</div>
                      {report.matchupNotes.map(function(mn,mi){
                        var nCol=mn.delta.toString().indexOf("+")===0?T.green:T.red;
                        return <div key={mi} style={{fontSize:8,marginBottom:4,lineHeight:"1.4"}}>
                          <span style={{fontWeight:700,color:nCol}}>{mn.emoji+" "+mn.delta}</span>
                          <span style={{color:T.dim}}>{" "+mn.note}</span>
                        </div>;
                      })}
                    </div>}
                  </div>
                </div>;
              })()}
              
              {season.phase==="regular" && <div style={assign({},cS,{borderColor:"rgba(168,85,247,0.2)",background:"rgba(168,85,247,0.02)"})}>
                <div style={{fontWeight:800,fontSize:11,color:T.purple,letterSpacing:1,marginBottom:4}}>{"ðŸ‹ï¸ PRACTICE FOCUS â€” Week "+season.week}</div>
                <div style={{fontSize:8,color:T.dim,marginBottom:6}}>{"Choose how your team prepares. ðŸ§  System Knowledge grows fastest with ðŸ” Scout or ðŸ’ª Pads â€” high knowledge = fewer turnovers, fewer stalls, better coverage."}</div>
                <div style={{display:"flex",gap:4}}>
                  {PRACTICE_FOCUS.map(function(pf){
                    var sel=pracFocus===pf.id;
                    return <div key={pf.id} onClick={function(){applyPracticeFocusChoice(pf.id,"manual",true);}}
                      style={{flex:1,padding:"6px 4px",borderRadius:6,cursor:"pointer",textAlign:"center",
                        border:sel?"2px solid "+T.purple:"1px solid "+T.border,
                        background:sel?"rgba(168,85,247,0.08)":"transparent",transition:"all 0.15s"}}>
                      <div style={{fontSize:12,marginBottom:1}}>{pf.label.split(" ")[0]}</div>
                      <div style={{fontSize:8,fontWeight:sel?700:400,color:sel?T.purple:T.text}}>{pf.label.split(" ").slice(1).join(" ")}</div>
                      <div style={{fontSize:7,color:T.dim,lineHeight:"1.2",marginTop:1}}>{pf.desc}</div>
                    </div>;
                  })}
                </div>
              </div>}
              
              {season.phase==="regular" && my && (function(){
                var capPlayer=captainId?my.roster.find(function(p){return p.id===captainId;}):null;
                var momentsLeft=CAPTAIN_RULES.triggersPerSeason-(captMoments.used||0);
                var capCandidates=my.roster.filter(function(p){return !(p.injury&&p.injury.games>0);}).slice().sort(function(a,b){return b.ovr-a.ovr;}).slice(0,8);
                return <div style={assign({},cS,{borderColor:capPlayer?"rgba(234,179,8,0.3)":"rgba(251,191,36,0.4)",background:capPlayer?"rgba(234,179,8,0.03)":"rgba(251,191,36,0.04)",padding:10})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:capPickerOpen?6:0}}>
                    <div style={{display:"flex",alignItems:"center",gap:6}}>
                      <span style={{fontWeight:800,fontSize:11,color:capPlayer?T.gold:"#f59e0b"}}>{"â­ TEAM CAPTAIN"}</span>
                      {capPlayer
                        ?<span style={{fontSize:10,fontWeight:700,color:T.text}}>{capPlayer.name+" ("+capPlayer.pos+" â€¢ "+capPlayer.ovr+" OVR)"}</span>
                        :<span style={{fontSize:9,color:"#f59e0b",fontWeight:600}}>{"â† Tap to assign!"}</span>
                      }
                    </div>
                    <div style={{display:"flex",gap:4,alignItems:"center"}}>
                      {capPlayer && <span style={{fontSize:9,fontWeight:700,padding:"2px 8px",borderRadius:10,
                        background:momentsLeft>0?"rgba(234,179,8,0.15)":"rgba(239,68,68,0.15)",
                        color:momentsLeft>0?T.gold:T.red}}>
                        {momentsLeft>0?momentsLeft+"/"+CAPTAIN_RULES.triggersPerSeason+" moments":"All used"}
                      </span>}
                      <button onClick={function(){setCapPickerOpen(!capPickerOpen);}}
                        style={assign({},bS(capPlayer?T.gold:"#f59e0b",capPlayer?"#000":"#000"),{padding:"2px 8px",fontSize:9,fontWeight:700})}>
                        {capPickerOpen?"â–² Close":(capPlayer?"âœï¸ Change":"â­ Assign")}
                      </button>
                    </div>
                  </div>
                  {!capPickerOpen && captMoments.log&&captMoments.log.length>0 && <div style={{marginTop:4}}>
                    {captMoments.log.slice(-2).map(function(cm,ci){
                      return <div key={ci} style={{fontSize:8,color:T.gold,padding:"1px 0"}}>{cm.emoji+" Wk"+cm.week+": "+cm.label+" â€” "+cm.text}</div>;
                    })}
                  </div>}
                  {capPickerOpen && <div style={{marginTop:4}}>
                    <div style={{fontSize:9,color:T.dim,marginBottom:5}}>{"Select your captain â€” triggers clutch moments during games:"}</div>
                    {capCandidates.map(function(p){
                      var isCap=captainId===p.id;
                      return <div key={p.id} onClick={function(){
                        if(isCap){setCaptainId(null);addN("â­ "+p.name+" removed as captain","orange");}
                        else{setCaptainId(p.id);setCaptMoments(function(prev){return prev.season===season.year?prev:{season:season.year,used:0,log:[]};});addN("â­ "+p.name+" named TEAM CAPTAIN!","gold");}
                        setCapPickerOpen(false);
                      }} style={{display:"flex",justifyContent:"space-between",alignItems:"center",
                        padding:"5px 8px",marginBottom:3,borderRadius:6,cursor:"pointer",
                        background:isCap?"rgba(234,179,8,0.12)":"rgba(255,255,255,0.02)",
                        border:"1px solid "+(isCap?"rgba(234,179,8,0.5)":T.border),
                        transition:"all 0.1s"}}>
                        <div>
                          <span style={{fontSize:10,fontWeight:isCap?800:600,color:isCap?T.gold:T.text}}>{p.name}</span>
                          <span style={{fontSize:8,color:T.dim,marginLeft:6}}>{p.pos+" â€¢ "+p.trait}</span>
                        </div>
                        <div style={{display:"flex",gap:8,alignItems:"center"}}>
                          <span style={{fontSize:13,fontWeight:900,color:p.ovr>=80?T.green:p.ovr>=65?T.gold:T.text}}>{p.ovr}</span>
                          {isCap && <span style={{fontSize:9,color:T.gold}}>{"â­ CAP"}</span>}
                        </div>
                      </div>;
                    })}
                  </div>}
                </div>;
              })()}
              
              {season.phase==="regular"&&scoutRpt && <div style={assign({},cS,{borderColor:"rgba(34,211,238,0.3)",background:"rgba(34,211,238,0.03)"})}>
                <div style={{fontWeight:800,fontSize:11,color:T.cyan,letterSpacing:1,marginBottom:6}}>{"ðŸ” SCOUT REPORT â€” "+scoutRpt.opp}</div>
                <div style={{display:"flex",gap:8}}>
                  <div style={{flex:1}}>
                    <div style={{fontSize:9,fontWeight:700,color:T.faint,marginBottom:3}}>{"TENDENCIES"}</div>
                    <div style={{fontSize:9,marginBottom:2}}>{"OFF: "+scoutRpt.offPlan.icon+" "+scoutRpt.offPlan.name}</div>
                    <div style={{fontSize:9,marginBottom:2}}>{"DEF: "+scoutRpt.defPlan.icon+" "+scoutRpt.defPlan.name}</div>
                    <div style={{fontSize:8,color:scoutRpt.counterBonus>=1?T.green:scoutRpt.counterBonus<=-1?T.red:T.dim,fontWeight:600,marginTop:3}}>
                      {scoutRpt.schemeNote}
                    </div>
                    <div style={{fontSize:8,color:T.dim,marginTop:3}}>{scoutRpt.momentum}</div>
                  </div>
                  <div style={{flex:1}}>
                    <div style={{fontSize:9,fontWeight:700,color:T.faint,marginBottom:3}}>{"â­ KEY PLAYERS"}</div>
                    {scoutRpt.stars.map(function(s,si){
                      var tCol=s.threat==="ELITE"?T.gold:s.threat==="DANGEROUS"?T.orange:T.text;
                      return <div key={si} style={{fontSize:8,marginBottom:2,display:"flex",justifyContent:"space-between"}}>
                        <span>{s.name+" ("+s.pos+" "+s.ovr+")"}</span>
                        <span style={{color:tCol,fontWeight:700,fontSize:7}}>{s.threat}</span>
                      </div>;
                    })}
                  </div>
                  <div style={{flex:1}}>
                    <div style={{fontSize:9,fontWeight:700,color:T.faint,marginBottom:3}}>{"ðŸŽ¯ WEAKNESSES"}</div>
                    {scoutRpt.weaknesses.map(function(w,wi){
                      return <div key={wi} style={{fontSize:8,marginBottom:2}}>
                        <span style={{fontWeight:600}}>{w.pos+" ("+w.avg+")"}</span>
                        <span style={{color:T.red,fontSize:7,marginLeft:4}}>{w.note}</span>
                      </div>;
                    })}
                    {scoutRpt.injuredStarters.length>0 && <div style={{marginTop:3,fontSize:8,color:T.red}}>
                      {"ðŸ¥ "+scoutRpt.injuredStarters.length+" starter"+(scoutRpt.injuredStarters.length>1?"s":"")+" injured"}
                    </div>}
                  </div>
                </div>
                {scoutRpt.rivHeat>=5 && <div style={{fontSize:8,color:T.orange,marginTop:4,fontWeight:700}}>
                  {"ðŸ”¥ Rivalry Game â€” Heat: "+scoutRpt.rivHeat}
                </div>}
                
                {(function(){
                  var myGame66=sched.find(function(g){return g.week===season.week&&(g.home===myId||g.away===myId);});
                  if(!myGame66)return null;
                  var oppId66=myGame66.home===myId?myGame66.away:myGame66.home;
                  var dEntry=DOSSIER.getEntry(scoutDB,oppId66,season.year);
                  if(!dEntry||dEntry.conf<=0)return null;
                  return <div style={{marginTop:6,borderTop:"1px solid "+T.border+"60",paddingTop:6}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3}}>
                      <span style={{fontSize:9,fontWeight:700,color:T.cyan}}>{"ðŸ“‚ DOSSIER"}</span>
                      <span style={{fontSize:8,fontWeight:700,padding:"1px 6px",borderRadius:8,
                        background:dEntry.conf>=60?"rgba(34,197,94,0.15)":dEntry.conf>=30?"rgba(251,191,36,0.15)":"rgba(239,68,68,0.15)",
                        color:dEntry.conf>=60?T.green:dEntry.conf>=30?T.gold:T.red}}>
                        {"Confidence: "+dEntry.conf+"%"+(dEntry.scoutCount>1?" (Ã—"+dEntry.scoutCount+" scouted)":"")}
                      </span>
                    </div>
                    {dEntry.tells.map(function(tell,ti){
                      return <div key={ti} style={{fontSize:8,color:T.text,padding:"1px 0",paddingLeft:8,
                        borderLeft:"2px solid "+T.cyan+"40"}}>
                        {"â†’ "+tell}
                      </div>;
                    })}
                    {dEntry.counterTip && <div style={{fontSize:8,color:T.green,marginTop:3,fontWeight:600}}>
                      {"ðŸ’¡ "+dEntry.counterTip}
                    </div>}
                    
                    {dEntry.scheme && CLINIC.hasPerk(coachClinic,"anl2") && (function(){
                      var oppSchemes=dEntry.scheme.split(" / ");
                      var counterTips=[];
                      if(oppSchemes[1]){// Defensive scheme â†’ suggest offensive counter
                        var defId=Object.keys(DEF_PLANS.reduce(function(m,p){m[p.name]=p.id;return m;},{}))
                          .reduce(function(found,name){return dEntry.scheme.indexOf(name)>=0?DEF_PLANS.find(function(p){return p.name===name;}):found;},null);
                        if(defId){
                          var bestOff=null;var bestVal=-99;
                          OFF_PLANS.forEach(function(op){var val=(SCHEME_COUNTERS[op.id]||{})[defId.id]||0;if(val>bestVal){bestVal=val;bestOff=op;}});
                          if(bestOff&&bestVal>0)counterTips.push("ðŸ“Š Attack with "+bestOff.name+" (+"+ bestVal+" edge vs their D)");
                        }
                      }
                      if(counterTips.length===0)return null;
                      return <div style={{marginTop:2}}>
                        {counterTips.map(function(ct,ci){return <div key={ci} style={{fontSize:8,color:"#22d3ee",fontWeight:600}}>{ct}</div>;})}
                      </div>;
                    })()}
                  </div>;
                })()}
              </div>}
              
              {pressConf && <div style={assign({},cS,{borderColor:"rgba(251,191,36,0.4)",background:"rgba(251,191,36,0.04)",padding:12})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                  <div style={{fontWeight:800,fontSize:11,color:T.gold,letterSpacing:1}}>{pressConf.title||"ðŸŽ™ï¸ POST-GAME PRESS CONFERENCE"}</div>
                  
                  {(function(){
                    var p66=getMediaPersona(mediaState.tags||[]);
                    if(!p66)return null;
                    return <span style={{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,
                      background:"rgba(168,85,247,0.15)",color:T.purple}}>
                      {p66.emoji+" "+p66.label+" | Cred: "+mediaState.credibility+"%"}
                    </span>;
                  })()}
                </div>
                {(pressConf.broadcastLead||pressConf.broadcastAnalyst)&&<div style={{marginBottom:8,padding:"6px 8px",borderRadius:6,border:"1px solid rgba(251,191,36,0.25)",background:"rgba(251,191,36,0.06)"}}>
                  {pressConf.broadcastLead&&<div style={{fontSize:9,color:T.gold,fontWeight:700,lineHeight:"1.35"}}>{"ðŸ“¢ "+pressConf.broadcastLead}</div>}
                  {pressConf.broadcastAnalyst&&<div style={{fontSize:8,color:T.dim,fontStyle:"italic",lineHeight:"1.35",marginTop:2}}>{"ðŸŽ™ï¸ "+pressConf.broadcastAnalyst}</div>}
                </div>}
                <div style={{fontSize:10,color:T.text,marginBottom:8,lineHeight:"1.4",fontStyle:"italic"}}>
                  {"\""+pressConf.q+"\""}
                </div>
                <div style={{display:"flex",flexDirection:"column",gap:4}}>
                  {pressConf.opts.map(function(opt){
                    return <div key={opt.id} onClick={function(){answerPress(opt.id);}}
                      style={{padding:"8px 10px",borderRadius:6,cursor:"pointer",
                        border:"1px solid "+T.border,background:"rgba(255,255,255,0.02)",
                        transition:"all 0.15s",fontSize:10}}>
                      <div style={{fontWeight:600,marginBottom:2}}>{opt.label}</div>
                      <div style={{fontSize:7,color:T.dim}}>
                        {(opt.fx.morale>0?"ðŸ‘¥+morale ":opt.fx.morale<0?"ðŸ‘¥-morale ":"")
                        +(opt.fx.ownerApproval>0?"ðŸ¢+approval ":opt.fx.ownerApproval<0?"ðŸ¢-approval ":"")
                        +(opt.fx.rivalHeat>0?"ðŸ”¥+heat ":opt.fx.rivalHeat<0?"ðŸ”¥-heat ":"")
                        +(opt.fx.systemFit>0?"ðŸ§­+fit ":"")}
                      </div>
                    </div>;
                  })}
                </div>
                <div style={{fontSize:7,color:T.dim,marginTop:4,textAlign:"right",cursor:"pointer"}}
                  onClick={function(){setPressConf(null);}}>{"Skip â†’"}</div>
              </div>}
              
              {season.phase==="regular"&&season.week>=2 && (function(){
                var hl=HEADLINES.generate(teams,myId,season,sched);
                if(hl.length===0)return null;
                return <div style={assign({},cS,{borderColor:"rgba(148,163,184,0.2)",background:"rgba(148,163,184,0.02)",padding:10})}>
                  <div style={{fontWeight:800,fontSize:11,color:T.faint,letterSpacing:1,marginBottom:6}}>{"ðŸ“° LEAGUE HEADLINES â€” Week "+season.week}</div>
                  {hl.map(function(h,hi){
                    return <div key={hi} style={{fontSize:9,padding:"3px 0",borderBottom:hi<hl.length-1?"1px solid "+T.border+"40":"none",
                      color:h.priority>=3?T.text:T.dim}}>
                      {h.emoji+" "+h.text}
                    </div>;
                  })}
                </div>;
              })()}
              
              {(function(){
                var anyXP=false;
                CLINIC_TRACKS.forEach(function(tr){if(CLINIC.getTrackXP(coachClinic,tr.id)>0)anyXP=true;});
                if(!anyXP)return null;
                return <div style={assign({},cS,{borderColor:"rgba(168,85,247,0.25)",background:"rgba(168,85,247,0.02)",padding:10})}>
                  <div style={{fontWeight:800,fontSize:11,color:T.purple,letterSpacing:1,marginBottom:6}}>{"ðŸ“š COACH CLINIC"}</div>
                  {CLINIC_TRACKS.map(function(track){
                    var xp=CLINIC.getTrackXP(coachClinic,track.id);
                    if(xp<=0)return null;
                    var maxXP=track.perks[track.perks.length-1].xpReq;
                    var pct=Math.min(100,Math.round(xp/maxXP*100));
                    return <div key={track.id} style={{marginBottom:4}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2}}>
                        <span style={{fontSize:9,fontWeight:600}}>{track.label}</span>
                        <span style={{fontSize:7,color:T.dim}}>{xp+"/"+maxXP+" XP"}</span>
                      </div>
                      <div style={{height:4,borderRadius:2,background:T.border+"40",overflow:"hidden",marginBottom:2}}>
                        <div style={{width:pct+"%",height:"100%",borderRadius:2,
                          background:pct>=100?"linear-gradient(90deg,#a855f7,#ec4899)":"#a855f7"}}></div>
                      </div>
                      <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                        {track.perks.map(function(perk){
                          var unlocked=CLINIC.hasPerk(coachClinic,perk.id);
                          var applyCount=CLINIC_MATH.getApplyCount(coachClinic,perk.id);
                          var helpTag=perk.id.indexOf("off")===0?"Sim":perk.id.indexOf("def")===0?"Sim":
                            perk.id.indexOf("anl")===0?"Scouting":perk.id.indexOf("ldr")===0?"Press":
                            perk.id.indexOf("dev")===0?"Dev":"";
                          return <div key={perk.id} style={{display:"flex",flexDirection:"column",gap:1}}>
                            <span style={{fontSize:7,padding:"1px 5px",borderRadius:6,
                              background:unlocked?"rgba(168,85,247,0.2)":"rgba(255,255,255,0.03)",
                              color:unlocked?T.purple:T.dim,fontWeight:unlocked?700:400,
                              border:"1px solid "+(unlocked?"rgba(168,85,247,0.4)":"transparent")}}>
                              {(unlocked?"âœ… ":"ðŸ”’ ")+perk.name}
                            </span>
                            {unlocked && <div style={{display:"flex",gap:3,alignItems:"center",paddingLeft:2}}>
                              <span style={{fontSize:6,color:T.dim}}>{perk.desc}</span>
                              {applyCount>0 && <span style={{fontSize:6,color:T.purple,fontWeight:700}}>{"Ã—"+applyCount}</span>}
                              {helpTag && <span style={{fontSize:5,padding:"0 3px",borderRadius:3,
                                background:"rgba(168,85,247,0.1)",color:T.purple,fontWeight:600}}>{helpTag}</span>}
                            </div>}
                          </div>;
                        })}
                      </div>
                    </div>;
                  })}
                </div>;
              })()}
              
              {owner && (function(){
                var arch=OWNER_ARCHETYPES.find(function(a){return a.id===owner.archetypeId;});
                if(!arch)return null;
                var status=getOwnerStatus(owner.approval);
                return <div style={assign({},cS,{borderColor:status.color+"40"})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                    <div style={{fontWeight:800,fontSize:11,color:status.color}}>{"ðŸ¢ FRONT OFFICE"}</div>
                    <span style={{fontSize:9,padding:"2px 6px",borderRadius:4,fontWeight:700,
                      background:status.color+"15",color:status.color}}>{status.emoji+" "+status.label+" ("+owner.approval+"%)"}</span>
                  </div>
                  <div style={{fontSize:10,color:T.dim,marginBottom:4}}>{arch.label+" â€” "+arch.desc}</div>
                  <div style={{fontSize:9,color:T.text,fontWeight:600}}>{"ðŸŽ¯ Goal: "+arch.goalText}</div>
                  
                  {mandates&&mandates.length>0 && <div style={{marginTop:4}}>
                    <div style={{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}}>{"ðŸ“‹ MANDATES"}</div>
                    {mandates.map(function(m,mi){
                      return <div key={mi} style={{fontSize:9,padding:"2px 0",display:"flex",gap:4,alignItems:"center"}}>
                        <span style={{color:m.met?T.green:T.red}}>{m.met?"âœ…":"âŒ"}</span>
                        <span style={{color:m.met?T.dim:T.text}}>{m.text}</span>
                      </div>;
                    })}
                  </div>}
                  
                  {(function(){
                    var cons=getApprovalConsequences(owner.approval);
                    if(cons.label==="Normal")return null;
                    return <div style={{marginTop:4,padding:"3px 6px",borderRadius:4,fontSize:8,fontWeight:700,
                      background:cons.label==="Crisis"?"rgba(239,68,68,0.1)":cons.label==="Hot Seat"?"rgba(249,115,22,0.1)":"rgba(251,191,36,0.1)",
                      color:cons.label==="Crisis"?T.red:cons.label==="Hot Seat"?"#f97316":"#fbbf24"}}>
                      {"âš ï¸ "+cons.desc}
                    </div>;
                  })()}
                  
                  <div style={{marginTop:4,height:6,background:"rgba(255,255,255,0.06)",borderRadius:3,overflow:"hidden"}}>
                    <div style={{height:"100%",width:owner.approval+"%",background:status.color,borderRadius:3,transition:"width 0.3s"}}></div>
                  </div>
                </div>;
              })()}
              
              {deadlineShow && <div style={assign({},cS,{borderColor:"#ef4444",background:"rgba(239,68,68,0.03)"})}>
                <div style={{fontWeight:800,fontSize:12,color:"#ef4444",marginBottom:4}}>{"ðŸ”” TRADE DEADLINE SPECIAL"}</div>
                {deadlineShow.headlines.map(function(hl,hi){
                  return <div key={hi} style={{fontSize:10,padding:"3px 0",borderBottom:hi<deadlineShow.headlines.length-1?"1px solid "+T.border:"none"}}>
                    <span>{hl.emoji+" "}</span><span style={{fontWeight:600}}>{hl.text}</span>
                  </div>;
                })}
                {deadlineShow.contenders.length>0 && <div style={{marginTop:4}}>
                  <div style={{fontSize:8,fontWeight:700,color:T.green}}>{"ðŸ† CONTENDERS"}</div>
                  {deadlineShow.contenders.map(function(ct,ci){
                    return <span key={ci} style={{fontSize:9,marginRight:6}}>{ct.icon+ct.abbr+" ("+ct.wins+"-"+ct.losses+")"}</span>;
                  })}
                </div>}
                {deadlineShow.sellers.length>0 && <div style={{marginTop:2}}>
                  <div style={{fontSize:8,fontWeight:700,color:T.red}}>{"ðŸ“‰ SELLERS"}</div>
                  {deadlineShow.sellers.map(function(st,si){
                    return <span key={si} style={{fontSize:9,marginRight:6}}>{st.icon+st.abbr+" ("+st.wins+"-"+st.losses+")"}</span>;
                  })}
                </div>}
              </div>}
              
              {seasonAwards && <div style={assign({},cS,{borderColor:T.gold,background:"rgba(251,191,36,0.03)"})}>
                <div style={{fontWeight:900,fontSize:14,color:T.gold,marginBottom:8,textAlign:"center",letterSpacing:2}}>{"ðŸ… SEASON AWARDS CEREMONY â€” "+seasonAwards.year}</div>
                {awardsCeremony && awardsCeremony.reveal.map(function(rev,ri){
                  var colors={"ðŸŒ±":"rgba(52,211,153,0.06)","ðŸŽ“":"rgba(167,139,250,0.06)","ðŸ›¡ï¸":"rgba(96,165,250,0.06)","ðŸ†":"rgba(251,191,36,0.06)","âš¡":"rgba(251,146,60,0.06)"};
                  var borders={"ðŸŒ±":"rgba(52,211,153,0.15)","ðŸŽ“":"rgba(167,139,250,0.15)","ðŸ›¡ï¸":"rgba(96,165,250,0.15)","ðŸ†":"rgba(251,191,36,0.2)","âš¡":"rgba(251,146,60,0.15)"};
                  var textColors={"ðŸŒ±":T.green,"ðŸŽ“":"#a78bfa","ðŸ›¡ï¸":T.cyan,"ðŸ†":T.gold,"âš¡":T.orange};
                  return <div key={ri} style={{padding:10,marginBottom:6,borderRadius:8,
                    background:colors[rev.emoji]||T.bg3,border:"1px solid "+(borders[rev.emoji]||T.border)}}>
                    <div style={{fontSize:8,fontWeight:800,color:textColors[rev.emoji]||T.faint,letterSpacing:2,marginBottom:4}}>{rev.category}</div>
                    <div style={{fontSize:14,fontWeight:900,color:T.fg}}>{rev.emoji+" "+rev.line}</div>
                    {rev.sub&&<div style={{fontSize:9,color:T.dim,marginTop:3,fontStyle:"italic"}}>{rev.sub}</div>}
                  </div>;
                })}
                
                {seasonAwards&&seasonAwards.proBowlGame74&&<div style={{padding:8,marginTop:4,borderRadius:8,background:"rgba(96,165,250,0.04)",border:"1px solid rgba(96,165,250,0.15)"}}>
                  <div style={{fontSize:8,fontWeight:800,color:T.cyan,letterSpacing:2,marginBottom:4}}>{"ðŸŸï¸ PRO BOWL EXHIBITION GAME"}</div>
                  <div style={{display:"flex",justifyContent:"space-around",alignItems:"center",marginBottom:4}}>
                    <div style={{textAlign:"center"}}><div style={{fontSize:18,fontWeight:900}}>{seasonAwards.proBowlGame74.scoreA}</div><div style={{fontSize:9,color:T.faint}}>{"Team Irvin"}</div></div>
                    <div style={{fontSize:10,color:T.faint}}>{"vs"}</div>
                    <div style={{textAlign:"center"}}><div style={{fontSize:18,fontWeight:900}}>{seasonAwards.proBowlGame74.scoreB}</div><div style={{fontSize:9,color:T.faint}}>{"Team Rice"}</div></div>
                  </div>
                  {seasonAwards.proBowlGame74.mvp&&<div style={{fontSize:10,textAlign:"center",color:T.gold,fontWeight:700}}>{"Pro Bowl MVP: "+seasonAwards.proBowlGame74.mvp.name+" ("+seasonAwards.proBowlGame74.mvp.pos+", "+seasonAwards.proBowlGame74.mvp.tm+")"}</div>}
                </div>}
                {!awardsCeremony && <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                  {seasonAwards.mvp && <div style={{flex:"1 1 45%",padding:6,borderRadius:6,background:"rgba(251,191,36,0.06)"}}>
                    <div style={{fontSize:7,fontWeight:800,color:T.gold}}>{"ðŸŒŸ MVP"}</div>
                    <div style={{fontSize:11,fontWeight:700}}>{seasonAwards.mvp.icon+" "+seasonAwards.mvp.name}</div>
                    <div style={{fontSize:8,color:T.dim}}>{seasonAwards.mvp.pos+" "+seasonAwards.mvp.team+" â€” "+seasonAwards.mvp.line}</div>
                  </div>}
                  {seasonAwards.dpoy && <div style={{flex:"1 1 45%",padding:6,borderRadius:6,background:"rgba(96,165,250,0.06)"}}>
                    <div style={{fontSize:7,fontWeight:800,color:T.cyan}}>{"ðŸ›¡ï¸ DPOY"}</div>
                    <div style={{fontSize:11,fontWeight:700}}>{seasonAwards.dpoy.icon+" "+seasonAwards.dpoy.name}</div>
                    <div style={{fontSize:8,color:T.dim}}>{seasonAwards.dpoy.pos+" "+seasonAwards.dpoy.team+" â€” "+seasonAwards.dpoy.line}</div>
                  </div>}
                  {seasonAwards.roy && <div style={{flex:"1 1 45%",padding:6,borderRadius:6,background:"rgba(52,211,153,0.06)"}}>
                    <div style={{fontSize:7,fontWeight:800,color:T.green}}>{"ðŸŒ± ROY"}</div>
                    <div style={{fontSize:11,fontWeight:700}}>{seasonAwards.roy.icon+" "+seasonAwards.roy.name}</div>
                    <div style={{fontSize:8,color:T.dim}}>{seasonAwards.roy.pos+" "+seasonAwards.roy.team+" (Age "+seasonAwards.roy.age+")"}</div>
                  </div>}
                  {seasonAwards.coty && <div style={{flex:"1 1 45%",padding:6,borderRadius:6,background:"rgba(167,139,250,0.06)"}}>
                    <div style={{fontSize:7,fontWeight:800,color:"#a78bfa"}}>{"ðŸŽ“ COTY"}</div>
                    <div style={{fontSize:11,fontWeight:700}}>{seasonAwards.coty.icon+" "+seasonAwards.coty.name}</div>
                    <div style={{fontSize:8,color:T.dim}}>{seasonAwards.coty.team+" ("+seasonAwards.coty.wins+"-"+seasonAwards.coty.losses+")"}</div>
                  </div>}
                </div>}
              </div>}
              
              {COACHING_TREE_LOG.length>0 && <div style={assign({},cS,{borderColor:"rgba(52,211,153,0.3)"})}>
                <div style={{fontWeight:800,fontSize:11,color:T.green,marginBottom:4}}>{"ðŸŽ“ COACHING TREE â€” Recent Moves"}</div>
                {COACHING_TREE_LOG.slice(-5).reverse().map(function(m,mi){
                  return <div key={mi} style={{fontSize:9,padding:"3px 0",borderBottom:mi<Math.min(COACHING_TREE_LOG.length,5)-1?"1px solid "+T.border:"none"}}>
                    <span style={{fontWeight:600}}>{m.fromIcon+m.fromTeam}</span>
                    <span style={{color:T.faint}}>{" â†’ "}</span>
                    <span style={{fontWeight:600}}>{m.toIcon+m.toTeam}</span>
                    <span style={{color:T.dim}}>{" â€” "+m.coachName+" ("+m.role+"â†’HC) Yr "+m.year}</span>
                  </div>;
                })}
              </div>}
              
              {my && (function(){
                var suggestions=generateTradeSuggestions(my,teams,gmStrategy);
                if(suggestions.length===0)return null;
                return <div style={assign({},cS,{borderColor:"rgba(96,165,250,0.3)"})}>
                  <div style={{fontWeight:800,fontSize:11,color:T.cyan,marginBottom:4}}>{"ðŸ¤– GM INTEL â€” Trade Suggestions"}</div>
                  <div style={{fontSize:9,color:T.faint,marginBottom:4}}>{"Strategy: "+(gmStrategy==="rebuild"?"ðŸ”¨ Rebuild":gmStrategy==="contend"?"ðŸ† Contend":"âš–ï¸ Balanced")}</div>
                  {suggestions.map(function(sg,si){
                    return <div key={si} style={{padding:"4px 0",borderBottom:si<suggestions.length-1?"1px solid "+T.border:"none"}}>
                      <div style={{fontSize:10}}>{sg.emoji+" "+sg.player}</div>
                      <div style={{fontSize:9,color:T.dim,marginTop:1}}>{sg.reason}</div>
                    </div>;
                  })}
                </div>;
              })()}
              
              {gameKeys && <div style={mS(S.studioCard,{marginBottom:8})}>
                <div style={mS(S.header,{fontSize:11,color:T.gold,marginBottom:8})}>{"ðŸŽ™ï¸ BROADCAST BREAKDOWN"}</div>
                <div style={{display:"flex",gap:6,marginBottom:8}}>
                  {gameKeys.keys.map(function(k,ki){
                    return React.createElement("div",{key:ki,style:{flex:1,textAlign:"center",background:k.winner==="home"?"rgba(52,211,153,0.06)":k.winner==="away"?"rgba(239,68,68,0.06)":"rgba(255,255,255,0.03)",borderRadius:RAD.sm,padding:8,border:"1px solid "+(k.winner==="home"?T.green:k.winner==="away"?T.red:T.border)}},
                      React.createElement("div",{style:{fontSize:8,color:T.faint,fontWeight:700,textTransform:"uppercase",marginBottom:3}},k.label),
                      React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:8}},
                        React.createElement("span",{style:{fontWeight:800,fontSize:13,color:k.winner==="home"?T.green:T.dim}},k.homeVal),
                        React.createElement("span",{style:{fontSize:9,color:T.faint}},"-"),
                        React.createElement("span",{style:{fontWeight:800,fontSize:13,color:k.winner==="away"?T.green:T.dim}},k.awayVal)
                      )
                    );
                  })}
                </div>
                <div style={{display:"flex",gap:8}}>
                  <div style={{flex:1,background:"rgba(255,255,255,0.03)",borderRadius:RAD.sm,padding:6}}>
                    <div style={{fontSize:8,color:T.cyan,fontWeight:700}}>{"â± TURNING POINT"}</div>
                    <div style={{fontSize:10,color:T.text,marginTop:2}}>{gameKeys.turningPoint.desc}</div>
                  </div>
                  {gameKeys.playerOfGame.name && <div style={{flex:1,background:"rgba(251,191,36,0.04)",borderRadius:RAD.sm,padding:6,borderLeft:"2px solid "+T.gold}}>
                    <div style={{fontSize:8,color:T.gold,fontWeight:700}}>{"â­ PLAYER OF THE GAME"}</div>
                    <div style={{fontSize:11,fontWeight:800,color:T.text,marginTop:2}}>{gameKeys.playerOfGame.name}</div>
                    <div style={{fontSize:9,color:T.dim}}>{gameKeys.playerOfGame.pos+" â€” "+gameKeys.playerOfGame.stat}</div>
                  </div>}
                </div>
              </div>}
              
              {weekShow && season.phase==="regular" && <div style={mS(S.studioCard,{marginBottom:8})}>
                <div style={mS(S.header,{fontSize:12,color:T.gold,marginBottom:10})}>{"ðŸ“º THE WEEKLY SHOW â€” WK "+weekShow.week}</div>
                <div style={{display:"flex",gap:6,marginBottom:10,flexWrap:"wrap"}}>
                  {weekShow.gotw && <div style={mS(S.kpiBox,{flex:1,minWidth:90,background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.15)",borderRadius:RAD.sm})}>
                    <div style={{fontSize:8,color:T.gold,fontWeight:700}}>{"ðŸˆ GAME OF WEEK"}</div>
                    <div style={{fontSize:11,fontWeight:800,marginTop:2}}>{weekShow.gotw.homeAbbr+" "+weekShow.gotw.score+" "+weekShow.gotw.awayAbbr}</div>
                  </div>}
                  {weekShow.upset && <div style={mS(S.kpiBox,{flex:1,minWidth:90,background:"rgba(239,68,68,0.06)",border:"1px solid rgba(239,68,68,0.15)",borderRadius:RAD.sm})}>
                    <div style={{fontSize:8,color:T.red,fontWeight:700}}>{"ðŸ˜± UPSET"}</div>
                    <div style={{fontSize:10,fontWeight:800,marginTop:2}}>{weekShow.upset.winnerAbbr+" def. "+weekShow.upset.loserAbbr}</div>
                    <div style={{fontSize:8,color:T.faint}}>{"Margin: "+weekShow.upset.margin+" | Rank gap: "+weekShow.upset.gap}</div>
                  </div>}
                  {weekShow.hotSeat.length>0 && <div style={mS(S.kpiBox,{flex:1,minWidth:90,background:"rgba(239,68,68,0.04)",border:"1px solid rgba(239,68,68,0.1)",borderRadius:RAD.sm})}>
                    <div style={{fontSize:8,color:T.orange,fontWeight:700}}>{"ðŸ”¥ HOT SEAT"}</div>
                    {weekShow.hotSeat.slice(0,2).map(function(hs,hi){
                      return React.createElement("div",{key:hi,style:{fontSize:9,fontWeight:700,color:hs.risk==="CRITICAL"?T.red:T.orange,marginTop:2}},hs.icon+hs.abbr+" ("+hs.mood+")");
                    })}
                  </div>}
                </div>
                
                <div style={{fontSize:9,fontWeight:800,color:T.cyan,marginBottom:4,letterSpacing:1}}>{"ðŸ“Š POWER RANKINGS"}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3}}>
                  {weekShow.powerRanks.slice(0,12).map(function(pr,pi){
                    var isUser=pr.id===myId;
                    return React.createElement("div",{key:pr.id,style:{display:"flex",alignItems:"center",gap:4,padding:"3px 6px",
                      background:isUser?"rgba(212,167,75,0.1)":"rgba(255,255,255,0.02)",borderRadius:3,
                      border:isUser?"1px solid rgba(212,167,75,0.3)":"1px solid transparent"}},
                      React.createElement("span",{style:{fontSize:10,fontWeight:900,color:pi<3?T.gold:pi<8?T.text:T.dim,width:18,textAlign:"center"}},pr.rank),
                      React.createElement("span",{style:{fontSize:11,fontWeight:isUser?800:600,flex:1}},pr.icon+pr.abbr),
                      React.createElement("span",{style:{fontSize:9,color:T.dim}},pr.wins+"-"+pr.losses),
                      React.createElement("span",{style:{fontSize:8,color:pr.pdpg>0?T.green:pr.pdpg<0?T.red:T.dim}},(pr.pdpg>0?"+":"")+pr.pdpg)
                    );
                  })}
                </div>
                
                {weekShow.awards && weekShow.awards.mvp.length>0 && <div style={{marginTop:8}}>
                  <div style={{fontSize:9,fontWeight:800,color:T.gold,marginBottom:4,letterSpacing:1}}>{"ðŸ… AWARD RACES"}</div>
                  <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                    {[{label:"MVP",data:weekShow.awards.mvp},{label:"OPOY",data:weekShow.awards.opoy},{label:"DPOY",data:weekShow.awards.dpoy},{label:"ROY",data:weekShow.awards.roy}].map(function(aw){
                      if(!aw.data||!aw.data[0])return null;
                      var top=aw.data[0];
                      return React.createElement("div",{key:aw.label,style:{flex:1,minWidth:70,background:"rgba(255,255,255,0.02)",borderRadius:RAD.sm,padding:5,textAlign:"center"}},
                        React.createElement("div",{style:{fontSize:7,color:T.gold,fontWeight:700}},aw.label),
                        React.createElement("div",{style:{fontSize:9,fontWeight:800,marginTop:1}},top.name),
                        React.createElement("div",{style:{fontSize:8,color:T.dim}},top.icon+top.team+" | "+top.pos)
                      );
                    })}
                  </div>
                </div>}

                {weekShow.arcSpots&&weekShow.arcSpots.length>0 && <div style={{marginTop:8,borderTop:"1px solid rgba(255,255,255,0.05)",paddingTop:8}}>
                  <div style={{fontSize:9,fontWeight:800,color:"#a855f7",marginBottom:6,letterSpacing:1}}>{"ðŸ“º MFSN ARC SPOTLIGHT"}</div>
                  {weekShow.arcSpots.map(function(sp,si){
                    return React.createElement("div",{key:si,style:{display:"flex",gap:6,alignItems:"flex-start",marginBottom:si<weekShow.arcSpots.length-1?6:0,
                        paddingBottom:si<weekShow.arcSpots.length-1?6:0,
                        borderBottom:si<weekShow.arcSpots.length-1?"1px solid rgba(255,255,255,0.03)":"none"}},
                      React.createElement("span",{style:{fontSize:8,fontWeight:800,color:sp.badgeColor,flexShrink:0,
                        padding:"1px 4px",borderRadius:3,background:"rgba(255,255,255,0.03)",border:"1px solid "+sp.badgeColor+"33",
                        marginTop:1}},sp.badge||sp.arcKey),
                      React.createElement("div",null,
                        React.createElement("span",{style:{fontSize:10,fontWeight:700,color:"#fff"}},(sp.playerName+" ")),
                        React.createElement("span",{style:{fontSize:9,fontStyle:"italic",color:T.dim}},"\u201C"+(sp.line.length>80?sp.line.substring(0,80)+"\u2026":sp.line)+"\u201D")
                      )
                    );
                  })}
                </div>}
              </div>}
              {news.length>0 && <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:4}}>ðŸ“° NEWS</div>
                {news.slice(0,12).map(function(h){return <div key={h.id} style={{fontSize:11,padding:"2px 0",borderBottom:"1px solid "+T.border,color:h.type==="gold"?T.gold:h.type==="green"?T.green:h.type==="red"?T.red:T.dim}}>{h.text}</div>;})}</div>}
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:4}}>STANDINGS</div>
                {teams.length>=30&&confStandings97&&confStandings97.length>0 ? (
                  <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))",gap:8}}>
                    {confStandings97.map(function(conf){
                      return <div key={conf.id} style={{border:"1px solid "+T.border,borderRadius:8,padding:8,background:"rgba(255,255,255,0.02)"}}>
                        <div style={{fontSize:10,fontWeight:900,color:conf.id==="EC"?T.cyan:T.gold,marginBottom:6,letterSpacing:1}}>
                          {(conf.icon||"ðŸˆ")+" "+String(conf.name||conf.id).toUpperCase()}
                        </div>
                        {(conf.divisions||[]).map(function(div){
                          return <div key={div.id} style={{marginBottom:6,paddingBottom:6,borderBottom:"1px solid rgba(255,255,255,0.04)"}}>
                            <div style={{fontSize:9,fontWeight:800,color:T.dim,marginBottom:4}}>
                              {(div.icon||"ðŸˆ")+" "+div.name}
                            </div>
                            {(div.teams||[]).map(function(t,i){
                              var pd=(t.pf||0)-(t.pa||0);
                              return <div key={t.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:10,padding:"2px 4px",borderRadius:4,
                                background:t.isUser?"rgba(212,167,75,0.08)":"transparent"}}>
                                <div style={{display:"flex",alignItems:"center",gap:5,minWidth:0}}>
                                  <span style={{width:14,textAlign:"center",fontWeight:800,color:i===0?T.gold:T.dim}}>{i+1}</span>
                                  <span style={{fontWeight:t.isUser?800:600,color:t.isUser?T.gold:T.text,whiteSpace:"nowrap"}}>{t.icon+t.abbr}</span>
                                </div>
                                <div style={{display:"flex",gap:8,alignItems:"center",flexShrink:0}}>
                                  <span style={{color:T.text,fontWeight:700}}>{(t.wins||0)+"-"+(t.losses||0)}</span>
                                  <span style={{fontSize:9,color:pd>0?T.green:pd<0?T.red:T.dim,width:30,textAlign:"right"}}>{(pd>0?"+":"")+pd}</span>
                                  <span style={{fontSize:9,color:t._gamesBack76===0?T.green:T.faint,width:28,textAlign:"right"}}>{t._gamesBack76===0?"â€”":t._gamesBack76+"GB"}</span>
                                </div>
                              </div>;
                            })}
                          </div>;
                        })}
                      </div>;
                    })}
                  </div>
                ) : (
                  <table style={tS}><thead><tr><th style={thS}>#</th><th style={thS}></th><th style={thS}>W</th><th style={thS}>L</th><th style={thS}>Â±</th><th style={thS}>Trend</th><th style={thS}>Mood</th></tr></thead>
                    <tbody>{standings.map(function(t,i){return (
                      <tr key={t.id} style={{background:t.isUser?"rgba(212,167,75,0.08)":"transparent"}}>
                        <td style={assign({},tdS,{fontWeight:700,color:i<8?T.green:T.faint})}>{i+1}</td>
                        <td style={assign({},tdS,{fontWeight:t.isUser?800:400})}>
                          <div style={{display:"flex",alignItems:"center",gap:4}}>
                            {React.createElement(TeamLogo,{team:t,size:18})}
                            <span>{t.abbr}</span>
                          </div>
                        </td>
                        <td style={assign({},tdS,{fontWeight:700})}>{t.wins}</td><td style={tdS}>{t.losses}</td>
                        <td style={assign({},tdS,{color:t.pf-t.pa>0?T.green:T.red})}>{(t.pf-t.pa>0?"+":"")+(t.pf-t.pa)}</td>
                        <td style={tdS}>{t.weekLog&&t.weekLog.length>=2?React.createElement(Sparkline,{data:t.weekLog.map(function(v){return Math.max(0,v+30);}),width:40,height:14}):React.createElement("span",{style:{fontSize:9,color:T.faint}},"â€”")}</td>
                        <td style={assign({},tdS,{color:moodColor(t.ownerMood||70),fontSize:10})}>{t.ownerMood||70}</td>
                      </tr>);})}</tbody></table>
                )}
              </div>
            </div>
          )}
          
          {tab==="inbox" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              {/* v96: PROMINENT INBOX SCOREBOARD */}
              {lastGameCtx&&(function(){
                var lg=lastGameCtx;
                var winBg=lg.won?"linear-gradient(135deg,rgba(16,185,129,0.15),rgba(16,185,129,0.04))":"linear-gradient(135deg,rgba(239,68,68,0.15),rgba(239,68,68,0.04))";
                var winBorder=lg.won?"rgba(16,185,129,0.4)":"rgba(239,68,68,0.4)";
                return React.createElement("div",{style:{background:winBg,border:"2px solid "+winBorder,borderRadius:12,padding:"16px 20px"}},
                  React.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:24,marginBottom:6}},
                    React.createElement("div",{style:{textAlign:"center"}},
                      React.createElement("div",{style:{fontSize:12,fontWeight:700,color:T.text,marginBottom:2}},my.icon+" "+my.abbr),
                      React.createElement("div",{style:{fontSize:38,fontWeight:900,color:lg.won?T.green:T.text}},lg.scoreFor)
                    ),
                    React.createElement("div",{style:{fontSize:16,color:T.faint,fontWeight:300}},"â€”"),
                    React.createElement("div",{style:{textAlign:"center"}},
                      React.createElement("div",{style:{fontSize:12,fontWeight:700,color:T.dim,marginBottom:2}},lg.opp),
                      React.createElement("div",{style:{fontSize:38,fontWeight:900,color:lg.won?T.dim:T.red}},lg.scoreAgainst)
                    )
                  ),
                  React.createElement("div",{style:{textAlign:"center",fontSize:10,fontWeight:800,letterSpacing:2,color:lg.won?T.green:T.red}},lg.won?"VICTORY":"DEFEAT"),
                  React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:14,marginTop:6,flexWrap:"wrap"}},
                    React.createElement("span",{style:{fontSize:9,color:T.dim,fontWeight:600}},"ðŸŽ¯ "+lg.passTD+" Pass TD"),
                    React.createElement("span",{style:{fontSize:9,color:T.dim,fontWeight:600}},"ðŸƒ "+lg.rushYds+" Rush Yds"),
                    React.createElement("span",{style:{fontSize:9,color:T.dim,fontWeight:600}},"ðŸ’¥ "+lg.sacks+" Sacks"),
                    React.createElement("span",{style:{fontSize:9,color:lg.ints>0?T.red:T.green,fontWeight:600}},(lg.ints>0?"âš ï¸ ":"âœ… ")+lg.ints+" INT")
                  )
                );
              })()}
              {/* v96: TO DO â€” WEEKLY CHECKLIST */}
              {season.phase==="regular"&&my&&(function(){
                var todos=[];
                var injStarters=(my.roster||[]).filter(function(p){return p&&p.isStarter&&p.injury&&p.injury.games>0;});
                if(injStarters.length>0)todos.push({icon:"ðŸ¥",text:injStarters.length+" injured starter"+(injStarters.length>1?"s":"")+" â€” check depth chart",color:T.red,tab:"roster"});
                var rosterSize=(my.roster||[]).length;
                if(rosterSize>53)todos.push({icon:"âœ‚ï¸",text:"Roster at "+rosterSize+"/53 â€” need to cut "+(rosterSize-53),color:T.red,tab:"roster"});
                if(rosterSize<45)todos.push({icon:"ðŸ“‹",text:"Roster thin at "+rosterSize+"/53 â€” consider FA signings",color:T.orange,tab:"freeAgents"});
                var expiringStars=(my.roster||[]).filter(function(p){return p&&p.contract&&p.contract.years<=1&&p.ovr>=75&&p.isStarter;});
                if(expiringStars.length>0)todos.push({icon:"ðŸ“",text:expiringStars.length+" star"+(expiringStars.length>1?"s":"")+" expiring â€” check re-sign tab",color:T.gold,tab:"resign"});
                if(season.week>=6&&season.week<=10)todos.push({icon:"ðŸ“ž",text:"Trade window open â€” explore deals",color:T.cyan,tab:"tradeBlock"});
                var lowMorale=(my.roster||[]).filter(function(p){return p&&p.isStarter&&(p.morale||70)<45;});
                if(lowMorale.length>0)todos.push({icon:"ðŸ˜¤",text:lowMorale.length+" starter"+(lowMorale.length>1?"s":"")+" with low morale",color:T.orange,tab:"chemistry"});
                if(!pracFocus||pracFocus==="balanced")todos.push({icon:"ðŸ“‹",text:"Set practice focus for next week",color:T.dim,tab:"training"});
                var holdouts=inbox.filter(function(it){return it.actionType==="holdout";});
                if(holdouts.length>0)todos.push({icon:"ðŸš¨",text:holdouts.length+" holdout"+(holdouts.length>1?"s":"")+" need resolution",color:T.red,tab:null});
                var pendingActions=inbox.filter(function(it){return it.actionType&&it.actionType!=="recap"&&it.actionType!=="fitReport";});
                if(pendingActions.length>0&&holdouts.length===0)todos.push({icon:"ðŸ“¬",text:pendingActions.length+" inbox item"+(pendingActions.length>1?"s":"")+" need action",color:T.gold,tab:null});
                if(gameRecap&&gameRecap.score<gameRecap.oppScore)todos.push({icon:"ðŸ”§",text:"Review FIX suggestion: "+((gameRecap.fix||"").split(".")[0]||"check gameplan"),color:T.blue,tab:"gameplan"});
                if(todos.length===0)todos.push({icon:"âœ…",text:"All set â€” ready to sim!",color:T.green,tab:null});
                return React.createElement("div",{style:{background:"rgba(251,191,36,0.04)",border:"1px solid rgba(251,191,36,0.2)",borderRadius:10,padding:"10px 12px"}},
                  React.createElement("div",{style:{fontSize:10,fontWeight:800,color:T.gold,letterSpacing:1,marginBottom:6}},"ðŸ“‹ TO DO â€” Week "+season.week),
                  todos.map(function(td,tdi){
                    return React.createElement("div",{key:"td"+tdi,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 0",
                      borderBottom:tdi<todos.length-1?"1px solid rgba(255,255,255,0.04)":"none"}},
                      React.createElement("div",{style:{fontSize:10,color:td.color,fontWeight:600}},td.icon+" "+td.text),
                      td.tab?React.createElement("button",{style:{fontSize:8,padding:"2px 8px",borderRadius:4,border:"1px solid "+td.color+"44",
                        background:td.color+"12",color:td.color,fontWeight:700,cursor:"pointer"},
                        onClick:function(){setTab(td.tab);}},
                        "Go â†’"):null
                    );
                  })
                );
              })()}
              <div style={cS}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <div style={{fontWeight:700,color:T.gold}}>{"ðŸ“¬ Inbox â€” Wk "+season.week+" "+season.year}</div>
                  <button style={bS(T.green,"#000")} onClick={function(){setTab("home");}}>{"âœ… Continue"}</button>
                </div>
                {inbox.length===0 && <div style={{color:T.faint,textAlign:"center",padding:20}}>{"Sim a week to receive your first briefing."}</div>}
                {inbox.filter(function(it){return it.urgent;}).length>0 && (
                  <div style={assign({},cS,{borderColor:T.red,marginBottom:8})}>
                    <div style={{fontWeight:700,color:T.red,fontSize:11,marginBottom:4}}>{"ðŸš¨ URGENT"}</div>
                    {inbox.filter(function(it){return it.urgent;}).map(function(it){return (
                      <div key={it.id} style={{padding:"6px 0",borderBottom:"1px solid "+T.border}}>
                        <div style={{fontSize:12,color:T[it.color]||T.text}}>{it.icon+" "+it.text}</div>
                        {it.actionType==="holdout" && (
                          <div style={{display:"flex",gap:6,marginTop:6}}>
                            <button style={bS(T.green,"#000")} onClick={function(){handleInboxAction(it,"pay");}}>{"ðŸ’° Pay $"+it.bumpAmount+"M"}</button>
                            <button style={bS(T.bg3,T.red)} onClick={function(){handleInboxAction(it,"refuse");}}>{"âœ‹ Refuse"}</button>
                          </div>
                        )}
                        
                        {it.actionType==="lockerChoice" && it.options && (
                          <div style={{display:"flex",gap:6,marginTop:6,flexWrap:"wrap"}}>
                            {it.options.map(function(opt,oi){return (
                              <button key={oi} style={mS(bS(oi===0?T.green:T.bg3,oi===0?"#000":T.text),{fontSize:10})}
                                title={opt.desc||""} onClick={function(){handleLockerChoice(it,opt.action);}}>
                                {opt.label}
                              </button>
                            );})}
                          </div>
                        )}
                        
                        {it.actionType==="aiTrade" && (function(){
                          var giveV=it.giveId?(function(){var p=my&&my.roster.find(function(x){return x.id===it.giveId;});return p?getTradeValue(p,null,my):0;})():0;
                          var ai2=teams.find(function(t){return t.id===it.aiId;});
                          var pkg972=it.offerPackage972&&it.offerPackage972.length?it.offerPackage972:null;
                          var getV=pkg972?pkg972.reduce(function(sum972,o972){
                            if(!o972)return sum972;
                            if(o972.type==="pick"){
                              var pk972=ai2&&ai2.draftPicks?ai2.draftPicks.find(function(x){return x.pid===o972.id;}):null;
                              return sum972+pickValue((pk972&&pk972.round)||o972.pickRound||3);
                            }
                            var p972=ai2&&ai2.roster?ai2.roster.find(function(x){return x.id===o972.id;}):null;
                            return sum972+(p972?getTradeValue(p972,null,my):0);
                          },0):(it.getType==="pick"?pickValue(it.pickRound||3):(function(){var p=ai2&&ai2.roster.find(function(x){return x.id===it.getId;});return p?getTradeValue(p,null,my):0;})());
                          var ratio=getV>0?Math.round(getV/Math.max(1,giveV)*100):0;
                          var fairLabel=ratio>=90?"âœ… Fair deal ("+ratio+"%)":ratio>=70?"âš ï¸ Slight underpay ("+ratio+"%)":"ðŸš¨ Lowball offer ("+ratio+"%)";
                          var fairColor=ratio>=90?T.green:ratio>=70?T.gold:T.red;
                          return React.createElement("div",{style:{marginTop:8,padding:8,background:"rgba(212,167,75,0.08)",borderRadius:6,border:"1px solid rgba(212,167,75,0.2)"}},
                            React.createElement("div",{style:{fontSize:10,color:T.gold,fontWeight:700,marginBottom:4}},"ðŸ“ž TRADE PROPOSAL"),
                            it.pitch&&React.createElement("div",{style:{fontSize:9,color:T.cyan,fontStyle:"italic",marginBottom:6,paddingBottom:4,borderBottom:"1px solid rgba(255,255,255,0.04)"}},"\u201C"+it.pitch+"\u201D"),
                            React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6,padding:"4px 0",borderBottom:"1px solid rgba(255,255,255,0.06)"}},
                              React.createElement("div",null,
                                React.createElement("div",{style:{fontSize:9,color:T.faint}},"YOU GIVE"),
                                React.createElement("div",{style:{fontSize:12,fontWeight:700,color:T.text}},it.giveName||"â€”"),
                                React.createElement("div",{style:{fontSize:9,color:T.dim}},"Trade value: "+giveV)
                              ),
                              React.createElement("div",{style:{fontSize:16,color:T.faint}},"â‡„"),
                              React.createElement("div",{style:{textAlign:"right"}},
                                React.createElement("div",{style:{fontSize:9,color:T.faint}},pkg972&&pkg972.length>1?"YOU GET (PACKAGE)":"YOU GET"),
                                pkg972&&pkg972.length>1
                                  ? React.createElement("div",null,
                                      pkg972.map(function(o972,oi972){
                                        return React.createElement("div",{key:oi972,style:{fontSize:11,fontWeight:600,color:T.text}},
                                          o972.name+(o972.condition?(" â€¢ "+pickConditionText972(o972.condition)):""));
                                      })
                                    )
                                  : React.createElement("div",{style:{fontSize:12,fontWeight:700,color:T.text}},it.getName||"â€”"),
                                React.createElement("div",{style:{fontSize:9,color:T.dim}},"Trade value: "+getV)
                              )
                            ),
                            React.createElement("div",{style:{fontSize:10,color:fairColor,fontWeight:700,marginBottom:6}},fairLabel),
                            React.createElement("div",{style:{display:"flex",gap:6}},
                              React.createElement("button",{style:bS(T.green,"#000"),onClick:function(){handleAiTrade(it,"accept");}},"âœ… Accept Trade"),
                              React.createElement("button",{style:bS(T.bg3,T.red),onClick:function(){handleAiTrade(it,"decline");}},"âŒ Decline"),
                              React.createElement("button",{style:bS("#1e293b","#a78bfa",{border:"1px solid #a78bfa"}),onClick:function(){handleAiTradeCounter(it);}},"ðŸ”„ Counter")
                            )
                          );
                        })()}
                      </div>
                    );})}
                  </div>
                )}
                {inbox.filter(function(it){return !it.urgent;}).map(function(it){
                  var bgColor=it.type==="game"?"rgba(52,211,153,0.06)":it.type==="recap"?"rgba(96,165,250,0.08)":it.type==="explain"?"rgba(96,165,250,0.06)":it.type==="injury"?"rgba(239,68,68,0.06)":it.type==="owner"?"rgba(239,68,68,0.06)":it.type==="extension"?"rgba(245,158,11,0.08)":it.type==="medical"?"rgba(96,165,250,0.08)":it.type==="fit_report"?"rgba(34,211,238,0.08)":it.type==="fit_alert"?"rgba(248,113,113,0.08)":it.type==="press_conf"?"rgba(251,191,36,0.08)":"transparent";
                  return (
                    <div key={it.id} style={{background:bgColor,borderRadius:6,padding:"8px 10px",marginBottom:4,borderLeft:"3px solid "+(T[it.color]||T.border)}}>
                      <div style={{fontSize:12,color:T[it.color]||T.text,fontWeight:it.actionType?"700":"400"}}>{it.icon+" "+it.text}</div>
                      
                      {it.actionType==="recap"&&it.recap && (
                        <div style={{marginTop:8,padding:8,background:T.bg3,borderRadius:6}}>
                          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6,marginBottom:8}}>
                            <div style={{textAlign:"center"}}><div style={{fontSize:9,color:T.faint}}>POCKET</div><div style={{fontSize:16,fontWeight:800,color:it.recap.pressureRate>=50?T.green:T.red}}>{it.recap.pressureRate}</div></div>
                            <div style={{textAlign:"center"}}><div style={{fontSize:9,color:T.faint}}>COVERAGE</div><div style={{fontSize:16,fontWeight:800,color:it.recap.coverageWin>=50?T.green:T.red}}>{it.recap.coverageWin}</div></div>
                            <div style={{textAlign:"center"}}><div style={{fontSize:9,color:T.faint}}>RUN LANES</div><div style={{fontSize:16,fontWeight:800,color:it.recap.runLaneAdv>=50?T.green:T.red}}>{it.recap.runLaneAdv}</div></div>
                          </div>
                          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6,marginBottom:8}}>
                            <div style={{textAlign:"center"}}><div style={{fontSize:9,color:T.faint}}>TURNOVERS</div><div style={{fontSize:14,fontWeight:700,color:it.recap.turnovers>0?T.red:T.green}}>{it.recap.turnovers}</div></div>
                            <div style={{textAlign:"center"}}><div style={{fontSize:9,color:T.faint}}>TAKEAWAYS</div><div style={{fontSize:14,fontWeight:700,color:it.recap.oppTurnovers>0?T.green:T.dim}}>{it.recap.oppTurnovers}</div></div>
                            <div style={{textAlign:"center"}}><div style={{fontSize:9,color:T.faint}}>RZ EFF</div><div style={{fontSize:14,fontWeight:700,color:it.recap.rzEff>=50?T.green:T.red}}>{it.recap.rzEff+"%"}</div></div>
                          </div>
                          <div style={{background:T.bg2,borderRadius:4,padding:"6px 8px",fontSize:11,color:T.gold,fontWeight:600}}>
                            {"ðŸ’¡ FIX: "+it.recap.fix}
                          </div>
                        </div>
                      )}
                      
                      {it.actionType==="fitReport"&&it.report && (function(){
                        var rpt=it.report;
                        var hasBaseline=rpt.prevAvg!==null&&rpt.prevAvg!==undefined;
                        var tone=hasBaseline?(rpt.avgDelta>=0?T.green:T.red):T.cyan;
                        var topGroup=rpt.groupDeltas&&rpt.groupDeltas.length>0?rpt.groupDeltas[0]:null;
                        function chipTone(v){return v>0?T.green:v<0?T.red:T.dim;}
                        function splitChip(label,val,color){
                          if(!val)return null;
                          return <span key={label} style={{fontSize:8,padding:"1px 4px",borderRadius:4,background:color+"20",color:color,fontWeight:700}}>
                            {label+" "+(val>0?"+":"")+val}
                          </span>;
                        }
                        function fitMoverRow(row,isUp){
                          var rowColor=isUp?T.green:T.red;
                          return <div key={row.id} style={{padding:"4px 0",borderBottom:"1px solid "+T.border}}>
                            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                              <span style={{fontSize:9,fontWeight:700,color:T.text}}>{row.name+" ("+row.pos+")"}</span>
                              <span style={{fontSize:9,fontWeight:800,color:rowColor}}>{(row.delta>0?"+":"")+row.delta}</span>
                            </div>
                            <div style={{fontSize:8,color:T.faint}}>{row.from+" â†’ "+row.to}</div>
                            <div style={{display:"flex",gap:3,flexWrap:"wrap",marginTop:2}}>
                              {splitChip("Spec",row.specDelta,T.gold)}
                              {splitChip("Pers",row.persDelta,T.purple)}
                              {splitChip("Sys",row.sysDelta,T.cyan)}
                            </div>
                          </div>;
                        }
                        return <div style={{marginTop:8,padding:8,borderRadius:6,background:"rgba(8,145,178,0.12)",border:"1px solid rgba(34,211,238,0.3)"}}>
                          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                            <div style={{fontSize:10,fontWeight:800,color:T.cyan}}>{"AVG FIT "+rpt.avgFit+"/100"}</div>
                            <div style={{fontSize:10,fontWeight:800,color:tone}}>
                              {hasBaseline?((rpt.avgDelta>=0?"+":"")+rpt.avgDelta+" vs last week"):"Baseline established"}
                            </div>
                          </div>
                          {hasBaseline&&topGroup&&<div style={{fontSize:9,color:chipTone(topGroup.delta),marginBottom:6,fontWeight:700}}>
                            {"Top group swing: "+topGroup.label+" "+(topGroup.delta>0?"+":"")+topGroup.delta}
                          </div>}
                          {hasBaseline&&rpt.groupDeltas&&rpt.groupDeltas.length>0 && <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}}>
                            {rpt.groupDeltas.slice(0,7).map(function(gd){
                              var gTone=chipTone(gd.delta);
                              return <span key={gd.id} style={{fontSize:8,padding:"1px 5px",borderRadius:9,background:gTone+"20",color:gTone,fontWeight:700}}>
                                {gd.label+" "+(gd.delta>0?"+":"")+gd.delta}
                              </span>;
                            })}
                          </div>}
                          {hasBaseline && <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:6,flexWrap:"wrap"}}>
                            <button style={bS(T.bg3,T.cyan,{border:"1px solid "+T.cyan})} onClick={function(){setFitDrilldown(rpt);setFitDrillFilter("all");}}>
                              {"ðŸ”Ž What Changed"}
                            </button>
                            <span style={{fontSize:8,color:T.faint,fontWeight:700}}>
                              {(rpt.changedPlayers||0)+" players changed"}
                            </span>
                          </div>}
                          {season.phase==="regular"&&rpt.recommendation && <div style={{marginBottom:6,padding:"6px 8px",borderRadius:6,background:"rgba(255,255,255,0.04)",border:"1px solid "+T.border}}>
                            <div style={{fontSize:8,fontWeight:700,color:T.gold,marginBottom:2}}>
                              {"Recommended Prep: "+rpt.recommendation.label}
                            </div>
                            <div style={{fontSize:8,color:T.dim,marginBottom:5}}>{rpt.recommendation.why}</div>
                            <div style={{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}}>
                              {pracFocus!==rpt.recommendation.id
                                ?<button style={bS(T.cyan,"#000")} onClick={function(){applyPracticeFocusChoice(rpt.recommendation.id,"fit report",false);}}>
                                  {"ðŸŽ¯ Apply Recommendation"}
                                </button>
                                :<span style={{fontSize:9,padding:"3px 8px",borderRadius:10,background:"rgba(52,211,153,0.15)",color:T.green,fontWeight:700}}>{"âœ… ACTIVE â€” already set"}</span>
                              }
                            </div>
                          </div>}
                          {!hasBaseline && <div style={{fontSize:9,color:T.faint}}>
                            {"Need one completed week before risers/fallers populate."}
                          </div>}
                          {hasBaseline && <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                            <div>
                              <div style={{fontSize:9,fontWeight:700,color:T.green,marginBottom:2}}>{"ðŸ“ˆ Risers"}</div>
                              {rpt.risers&&rpt.risers.length>0?rpt.risers.map(function(r){return fitMoverRow(r,true);}):<div style={{fontSize:8,color:T.dim}}>{"No risers this week."}</div>}
                            </div>
                            <div>
                              <div style={{fontSize:9,fontWeight:700,color:T.red,marginBottom:2}}>{"ðŸ“‰ Fallers"}</div>
                              {rpt.fallers&&rpt.fallers.length>0?rpt.fallers.map(function(r){return fitMoverRow(r,false);}):<div style={{fontSize:8,color:T.dim}}>{"No fallers this week."}</div>}
                            </div>
                          </div>}
                        </div>;
                      })()}
                      {it.actionType==="fitGroupAlert"&&it.alerts&&it.alerts.length>0 && (
                        <div style={{marginTop:8,padding:8,borderRadius:6,background:"rgba(127,29,29,0.15)",border:"1px solid rgba(248,113,113,0.35)"}}>
                          <div style={{fontSize:10,fontWeight:800,color:T.red,marginBottom:4}}>{"GM RISK BOARD"}</div>
                          {it.alerts.map(function(al){
                            var sevCol=al.severity==="high"?T.red:T.orange;
                            return <div key={al.id} style={{padding:"4px 0",borderBottom:"1px solid "+T.border}}>
                              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                                <span style={{fontSize:9,fontWeight:700,color:T.text}}>{al.label+" ("+al.current+")"}</span>
                                <span style={{fontSize:8,fontWeight:800,color:sevCol}}>{al.streak+"wk low"}</span>
                              </div>
                              <div style={{fontSize:8,color:T.faint}}>{al.note}</div>
                              <div style={{fontSize:8,color:T.dim}}>
                                {"Needs: "+(al.needs&&al.needs.length?al.needs.join(", "):al.label)}
                              </div>
                            </div>;
                          })}
                          <div style={{display:"flex",gap:6,marginTop:6,flexWrap:"wrap"}}>
                            <button style={bS(T.bg3,T.cyan,{border:"1px solid "+T.cyan})} onClick={function(){setTab("roster");}}>
                              {"Open Scheme Planner"}
                            </button>
                            <button style={bS(T.bg3,T.gold,{border:"1px solid "+T.gold})} onClick={function(){if(it.alerts[0])activateGMShortlist84(it.alerts[0]);}}>
                              {"Find Upgrades"}
                            </button>
                            {it.alerts[0] && <button style={bS(T.bg3,T.dim,{border:"1px solid "+T.border})} onClick={function(){setFitAlertPref84(it.alerts[0].id,"snoozeUntil",(season.week||1)+3,true);addN("ðŸ˜´ Snoozed "+it.alerts[0].label+" fit alerts for 3 weeks.","dim");}}>
                              {"ðŸ˜´ Snooze 3wk"}
                            </button>}
                            {it.alerts[0]&&it.alerts[0].focus && <button style={bS(T.bg3,T.green,{border:"1px solid "+T.green})} onClick={function(){applyPracticeFocusChoice(it.alerts[0].focus,"GM alert",false);}}>
                              {"Apply "+it.alerts[0].focus.toUpperCase()+" Focus"}
                            </button>}
                            {it.report && <button style={bS(T.bg3,T.purple,{border:"1px solid "+T.purple})} onClick={function(){setFitDrilldown(it.report);setFitDrillFilter("all");}}>
                              {"Open Drilldown"}
                            </button>}
                          </div>
                          {it.alerts[0]&&my&&(function(){
                            var sug=buildFitAlertTargets84(my,it.alerts[0],fas,3);
                            if((sug.internal||[]).length===0&&(sug.fa||[]).length===0)return null;
                            return <div style={{marginTop:8,padding:"6px 8px",borderRadius:6,background:"rgba(255,255,255,0.03)",border:"1px solid "+T.border}}>
                              <div style={{fontSize:8,fontWeight:800,color:T.gold,letterSpacing:0.4,marginBottom:4}}>
                                {"SUGGESTED TARGETS FOR "+it.alerts[0].label.toUpperCase()}
                              </div>
                              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                                <div>
                                  <div style={{fontSize:8,fontWeight:700,color:T.cyan,marginBottom:2}}>{"Internal Options"}</div>
                                  {(sug.internal||[]).length>0?sug.internal.map(function(tp){
                                    return <div key={tp.id} style={{fontSize:8,padding:"2px 0",borderBottom:"1px solid "+T.border}}>
                                      <span style={{color:T.text,fontWeight:700}}>{tp.name+" ("+tp.pos+")"}</span>
                                      <span style={{float:"right",color:tp.fit>=75?T.green:tp.fit>=63?T.gold:T.red,fontWeight:800}}>
                                        {"Fit "+tp.fit}
                                      </span>
                                    </div>;
                                  }):<div style={{fontSize:8,color:T.faint}}>{"No internal fits found."}</div>}
                                </div>
                                <div>
                                  <div style={{fontSize:8,fontWeight:700,color:T.green,marginBottom:2}}>{"FA Market Fits"}</div>
                                  {(sug.fa||[]).length>0?sug.fa.map(function(tp){
                                    return <div key={tp.id} style={{fontSize:8,padding:"2px 0",borderBottom:"1px solid "+T.border}}>
                                      <span style={{color:T.text,fontWeight:700}}>{tp.name+" ("+tp.pos+")"}</span>
                                      <span style={{float:"right",color:T.green,fontWeight:800}}>
                                        {"Fit "+tp.fit+" | $"+tp.ask+"M"}
                                      </span>
                                    </div>;
                                  }):<div style={{fontSize:8,color:T.faint}}>{"No FA fits in market right now."}</div>}
                                </div>
                              </div>
                            </div>;
                          })()}
                        </div>
                      )}
                      
                      {it.actionType==="extension" && (
                        <div style={{display:"flex",gap:6,marginTop:6,flexWrap:"wrap"}}>
                          <button style={bS(T.green,"#000")} onClick={function(){handleInboxAction(it,"accept");}}>{"âœ… Accept $"+it.askSalary+"M/"+it.askYears+"yr"}</button>
                          <button style={bS(T.gold,"#000")} onClick={function(){handleInboxAction(it,"counter");}}>{"ðŸ¤ Counter $"+Math.round(it.askSalary*0.85*10)/10+"M"}</button>
                          <button style={bS(T.bg3,T.red)} onClick={function(){handleInboxAction(it,"decline");}}>{"âŒ Decline"}</button>
                        </div>
                      )}
                      
                      {it.actionType==="medical" && (
                        <div style={{display:"flex",gap:6,marginTop:6}}>
                          <button style={bS(T.orange,"#000")} onClick={function(){handleInboxAction(it,"rush");}}>{"âš¡ Rush Back (35% re-injury)"}</button>
                          <button style={bS(T.blue,"#fff")} onClick={function(){handleInboxAction(it,"conservative");}}>{"ðŸ¥ Conservative"}</button>
                        </div>
                      )}
                      
                      {it.actionType==="schemePresser" && (
                        <div style={{marginTop:8,padding:8,borderRadius:6,background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.35)"}}>
                          <div style={{fontSize:10,fontWeight:800,color:T.gold,marginBottom:4}}>{"ðŸŽ™ï¸ SCHEME IDENTITY PRESSER"}</div>
                          {it.question && <div style={{fontSize:9,color:T.text,marginBottom:4,fontStyle:"italic"}}>{"\""+it.question+"\""}</div>}
                          {it.flavor && <div style={{fontSize:8,color:T.dim,marginBottom:6}}>{"Identity note: "+it.flavor}</div>}
                          <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                            <button style={bS(T.gold,"#000")} onClick={function(){handleInboxAction(it,"open");}}>{"ðŸŽ™ï¸ Take Podium"}</button>
                            <button style={bS(T.bg3,T.dim)} onClick={function(){setInbox(function(prev){return(prev||[]).filter(function(x){return x.id!==it.id;});});}}>
                              {"Skip This Week"}
                            </button>
                          </div>
                        </div>
                      )}
                      
                      {it.actionType==="aiTrade" && (
                        <div style={{marginTop:6,padding:8,background:"rgba(212,167,75,0.08)",borderRadius:6}}>
                          <div style={{fontSize:11,color:T.gold,fontWeight:700,marginBottom:4}}>{"ðŸ“ž TRADE PROPOSAL"}</div>
                          <div style={{display:"flex",gap:6}}>
                            <button style={bS(T.green,"#000")} onClick={function(){handleAiTrade(it,"accept");}}>{"âœ… Accept Trade"}</button>
                            <button style={bS(T.bg3,T.red)} onClick={function(){handleAiTrade(it,"decline");}}>{"âŒ Decline"}</button>
                          </div>
                        </div>
                      )}
                      
                      {it.type==="fixMenu"&&it.fixOptions && (
                        <div style={{display:"flex",gap:4,marginTop:6,flexWrap:"wrap"}}>
                          {it.fixOptions.map(function(opt,oi){
                            var txt=typeof opt==="string"?opt:opt.text;
                            var action=typeof opt==="object"?opt.action:null;
                            return <button key={oi} onClick={action?function(){applyFix(action);}:null}
                              style={{padding:"4px 8px",borderRadius:4,border:"1px solid "+(action?T.cyan:T.border),
                                background:action?"rgba(96,165,250,0.1)":"transparent",color:action?T.cyan:T.faint,
                                fontSize:9,cursor:action?"pointer":"default",fontWeight:action?700:400}}>
                              {(action?"âš¡ ":"")+txt}
                            </button>;
                          })}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
              
              {(function(){
                var topRiv=getTopRivalries(season.rivalries||{},myId,3);
                if(topRiv.length===0)return null;
                return <div style={cS}>
                  <div style={{fontWeight:700,color:T.orange,marginBottom:6}}>{"ðŸ”¥ Top Rivalries"}</div>
                  {topRiv.map(function(r,ri){
                    var oppId=r.a===myId?r.b:r.a;var oppT=teams.find(function(t){return t.id===oppId;});
                    var heatBars=Math.min(r.heat,15);
                    var hColor=r.heat>=13?T.red:r.heat>=9?T.orange:T.gold;
                    var tierLabel=r.tag==="BLOOD_FEUD"?"ðŸ”¥ðŸ”¥ðŸ”¥ Blood Feud":r.tag==="BITTER"?"ðŸ”¥ðŸ”¥ Bitter Rivals":r.tag==="RIVALRY"?"ðŸ”¥ Rivalry":"Budding";
                    var myWins=r.a===myId?(r.seriesA||0):(r.seriesB||0);
                    var oppWins=r.a===myId?(r.seriesB||0):(r.seriesA||0);
                    return <div key={ri} style={{padding:"6px 0",borderBottom:ri<topRiv.length-1?"1px solid "+T.border:"none"}}>
                      <div style={{display:"flex",alignItems:"center",gap:8}}>
                        <span style={{fontSize:14}}>{oppT?oppT.icon:"?"}</span>
                        <div style={{flex:1}}>
                          <div style={{fontSize:11,fontWeight:700,color:T.text}}>{oppT?oppT.abbr:"???"}</div>
                          <div style={{fontSize:9,color:hColor}}>{tierLabel}</div>
                        </div>
                        <div style={{textAlign:"right"}}>
                          <div style={{display:"flex",gap:1}}>
                            {Array.from({length:15},function(_,i){return <div key={i} style={{width:4,height:12,borderRadius:1,
                              background:i<heatBars?hColor:T.bg3}}/>;})}</div>
                          <div style={{fontSize:9,color:T.faint,marginTop:2}}>{"Series: "+myWins+"-"+oppWins}</div>
                        </div>
                      </div>
                      {r.meetings&&r.meetings.length>0 && <div style={{display:"flex",gap:4,marginTop:4,flexWrap:"wrap"}}>
                        {r.meetings.slice(-3).map(function(m,mi){
                          var myScore=m.homeId===myId?m.scoreH:m.scoreA;var oppScore=m.homeId===myId?m.scoreA:m.scoreH;
                          var won=myScore>oppScore;
                          return <span key={mi} style={{fontSize:8,padding:"1px 4px",borderRadius:3,
                            background:won?"rgba(52,211,153,0.1)":"rgba(239,68,68,0.1)",
                            color:won?T.green:T.red}}>{(m.playoff?"ðŸ†":"")+"Wk"+m.week+": "+myScore+"-"+oppScore}</span>;
                        })}
                      </div>}
                      
                      {r.moments&&r.moments.length>0 && (function(){
                        var biggest=getBiggestMoment(r.moments);var recent=getMostRecentMoment(r.moments);
                        var gravColor=function(g){return g>=4?T.red:g>=3?T.purple:g>=2?T.orange:T.gold;};
                        return <div style={{display:"flex",gap:4,marginTop:3,flexWrap:"wrap"}}>
                          {biggest && <span style={{fontSize:7,padding:"1px 3px",borderRadius:2,
                            background:"rgba(255,255,255,0.04)",color:gravColor(biggest.gravity||0)}}>{"ðŸ† "+biggest.text}</span>}
                          {recent && recent!==biggest && <span style={{fontSize:7,padding:"1px 3px",borderRadius:2,
                            background:"rgba(255,255,255,0.04)",color:gravColor(recent.gravity||0)}}>{"âš¡ "+recent.text}</span>}
                        </div>;
                      })()}
                    </div>;
                  })}
                </div>;
              })()}
              
              <div style={cS}>
                <div style={{fontWeight:700,color:T.cyan,marginBottom:6}}>{"ðŸ“… Season Calendar"}</div>
                <div style={{display:"flex",gap:3,flexWrap:"wrap"}}>
                  {Array.from({length:18},function(_,i){
                    var w2=i+1;var isCurrent=w2===season.week;var isPast=w2<season.week;
                    var isBye=!sched.some(function(g){return g.week===w2&&(g.home===myId||g.away===myId);});
                    return <div key={i} style={{width:20,height:20,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center",fontSize:8,fontWeight:isCurrent?800:400,
                      background:isCurrent?T.gold:isPast?T.bg3:isBye?"rgba(167,139,250,0.15)":"transparent",color:isCurrent?"#000":isPast?T.faint:isBye?T.purple:T.dim,border:"1px solid "+(isCurrent?T.gold:T.border)}}>{isBye&&!isPast?"B":w2}</div>;
                  })}
                  <div style={{width:20,height:20,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center",fontSize:7,background:season.phase==="playoffs"?T.purple:"transparent",color:season.phase==="playoffs"?"#fff":T.faint,border:"1px solid "+T.border}}>{"PO"}</div>
                </div>
                <div style={{fontSize:9,color:T.faint,marginTop:4}}>
                  {season.week<=8?"Trade deadline: Wk 10 ("+(10-season.week)+" weeks)":season.week<=10?"âš ï¸ Trade deadline THIS WEEK!":season.week<=18?"ðŸ”’ Trade window closed":"Playoffs approaching"}
                </div>
              </div>
            </div>
          )}
          
          {tab==="franchise" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>

              {/* FRANCHISE_PULSE v28: MFSN franchise health broadcast panel */}
              {(function(){
                var FP_FIN_GRADES=["F","D","C","B","A","A+"];
                var fp_cash=my.cash||0;var fp_rev=my.revenue||0;var fp_exp=my.expenses||0;
                var fp_cap=Math.round(getSalaryCap(season.year)-capCalc(my.roster||[])-(my.deadCap||0));
                var fp_finScore=0;
                if(fp_cash>30)fp_finScore+=2;else if(fp_cash>10)fp_finScore++;
                if(fp_rev>fp_exp)fp_finScore+=2;else if(fp_rev>0)fp_finScore++;
                if(fp_cap>20)fp_finScore+=2;else if(fp_cap>5)fp_finScore++;
                if((my.deadCap||0)<15)fp_finScore++;
                var fp_finGrade=FP_FIN_GRADES[Math.min(5,fp_finScore)];
                var fp_finColor=fp_finScore>=5?T.green:fp_finScore>=3?T.gold:T.red;
                var fp_avgMorale=my.roster&&my.roster.length>0?Math.round(my.roster.reduce(function(a,p){return a+(p&&p.morale?p.morale:70);},0)/my.roster.length):70;
                var fp_moraleColor=fp_avgMorale>=80?T.green:fp_avgMorale>=65?T.gold:T.red;
                var fp_moraleLabel=fp_avgMorale>=85?"ðŸ”¥ LOCKED IN":fp_avgMorale>=75?"âš¡ ENERGIZED":fp_avgMorale>=65?"ðŸ˜ NEUTRAL":fp_avgMorale>=50?"ðŸ˜¤ UNSETTLED":"ðŸ’” FRACTURED";
                var fp_facils=my.facilities||{};
                var fp_facilTotal=FACILS.reduce(function(sum,fac){
                  return sum+Math.max(0,Number(fp_facils[fac.id]||0));
                },0);
                var fp_facilMax=Math.max(1,FACILS.reduce(function(sum,fac){
                  return sum+Math.max(0,Number(fac.maxLvl||0));
                },0));
                var fp_facilPct=Math.round(Math.min(1,fp_facilTotal/fp_facilMax)*100);
                var fp_facilColor=fp_facilPct>=75?T.green:fp_facilPct>=50?T.gold:fp_facilPct>=25?T.orange:T.red;
                var fp_facilLabel=fp_facilPct>=75?"ELITE FACILITY":fp_facilPct>=50?"SOLID FACILITY":fp_facilPct>=25?"AVERAGE FACILITY":"BARE BONES";
                var fp_staffRating=0;
                if(my.staff&&my.staff.hc){var hc=my.staff.hc;fp_staffRating=Math.round(((hc.ratings&&hc.ratings.strategy)||5)+((hc.ratings&&hc.ratings.development)||5)+((hc.ratings&&hc.ratings.gameplan)||5));}
                var fp_staffColor=fp_staffRating>=25?T.green:fp_staffRating>=18?T.gold:T.red;
                var fp_staffLabel=fp_staffRating>=25?"ELITE STAFF":fp_staffRating>=18?"QUALITY STAFF":"COACHING UP";
                var fp_prestige=my.prestige||50;var fp_fanbase=my.fanbase||50;
                var fp_overallScore=Math.round((fp_finScore/8*25)+(fp_avgMorale/100*25)+(fp_facilPct/100*25)+(fp_staffRating/30*25));
                var fp_overallColor=fp_overallScore>=75?T.green:fp_overallScore>=55?T.gold:fp_overallScore>=35?T.orange:T.red;
                var fp_overallLabel=fp_overallScore>=80?"FRANCHISE ELITE":fp_overallScore>=65?"CONTENDER CLASS":fp_overallScore>=50?"BUILDING MODE":fp_overallScore>=35?"NEEDS WORK":"CRITICAL STATE";
                var FP_TAKES=[
                  "The front office is the foundation everything else is built on. Neglect it at your peril.",
                  "Winning cures a lot of problems. But a healthy franchise wins more consistently.",
                  "Elite organizations look like this from the inside â€” finances stable, locker room locked in.",
                  "Franchise health is the sum of a hundred small decisions. Every upgrade matters.",
                  "The best teams in football are built in the office. On the field is just the result.",
                  "Morale, facilities, staff â€” none of it shows on the scoreboard until it suddenly does."
                ];
                var fp_take=FP_TAKES[Math.floor(RNG.ui()*FP_TAKES.length)];
                return <div style={{background:"linear-gradient(135deg,rgba(212,167,75,0.10),rgba(0,0,0,0.9))",border:"2px solid rgba(212,167,75,0.3)",borderRadius:12,padding:"12px 14px",marginBottom:2}}>
                  <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:10}}>
                    <div style={{fontSize:22}}>ðŸŸï¸</div>
                    <div style={{flex:1}}>
                      <div style={{fontSize:9,fontWeight:800,color:T.gold,letterSpacing:2}}>{"MFSN FRANCHISE HEALTH REPORT"}</div>
                      <div style={{fontSize:14,fontWeight:900,color:"#fff"}}>{my.city+" "+my.name}</div>
                      <div style={{fontSize:9,color:T.dim}}>{"Prestige "+(fp_prestige)+" | Fanbase "+(fp_fanbase)+"%"}</div>
                    </div>
                    <div style={{textAlign:"right"}}>
                      <div style={{fontSize:22,fontWeight:900,color:fp_overallColor}}>{fp_overallScore}</div>
                      <div style={{fontSize:8,fontWeight:800,color:fp_overallColor}}>{fp_overallLabel}</div>
                    </div>
                  </div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6,marginBottom:10}}>
                    <div style={{textAlign:"center",background:"rgba(255,255,255,0.04)",borderRadius:6,padding:"6px 4px"}}>
                      <div style={{fontSize:16,fontWeight:900,color:fp_finColor}}>{fp_finGrade}</div>
                      <div style={{fontSize:8,color:T.faint}}>{"Finances"}</div>
                      <div style={{fontSize:8,color:fp_finColor,fontWeight:700}}>{"$"+Math.max(0,fp_cap).toFixed(0)+"M cap"}</div>
                    </div>
                    <div style={{textAlign:"center",background:"rgba(255,255,255,0.04)",borderRadius:6,padding:"6px 4px"}}>
                      <div style={{fontSize:16,fontWeight:900,color:fp_moraleColor}}>{fp_avgMorale}</div>
                      <div style={{fontSize:8,color:T.faint}}>{"Morale"}</div>
                      <div style={{fontSize:7,color:fp_moraleColor,fontWeight:700}}>{fp_moraleLabel}</div>
                    </div>
                    <div style={{textAlign:"center",background:"rgba(255,255,255,0.04)",borderRadius:6,padding:"6px 4px"}}>
                      <div style={{fontSize:16,fontWeight:900,color:fp_facilColor}}>{fp_facilPct+"%"}</div>
                      <div style={{fontSize:8,color:T.faint}}>{"Facility"}</div>
                      <div style={{fontSize:7,color:fp_facilColor,fontWeight:700}}>{fp_facilLabel}</div>
                    </div>
                    <div style={{textAlign:"center",background:"rgba(255,255,255,0.04)",borderRadius:6,padding:"6px 4px"}}>
                      <div style={{fontSize:16,fontWeight:900,color:fp_staffColor}}>{fp_staffRating}</div>
                      <div style={{fontSize:8,color:T.faint}}>{"Staff"}</div>
                      <div style={{fontSize:7,color:fp_staffColor,fontWeight:700}}>{fp_staffLabel}</div>
                    </div>
                  </div>
                  <div style={{height:6,background:"rgba(255,255,255,0.06)",borderRadius:3,marginBottom:8,overflow:"hidden"}}>
                    <div style={{height:"100%",width:fp_overallScore+"%",background:"linear-gradient(90deg,rgba(212,167,75,0.6),"+fp_overallColor+")",borderRadius:3}}></div>
                  </div>
                  <div style={{fontSize:10,color:"#e2e8f0",fontStyle:"italic",borderLeft:"2px solid rgba(212,167,75,0.3)",paddingLeft:8,lineHeight:1.5}}>{fp_take}</div>
                </div>;
              })()}

              <div style={cS}>
                <div style={{fontWeight:700,color:T.gold,marginBottom:8}}>ðŸ’° Financial Statement</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,fontSize:12}}>
                  <div>{"Cash: $"+(my.cash||0).toFixed(1)+"M"}</div>
                  <div>{"Fan Loyalty: "+(my.fanbase||0)+"%"}</div>
                  <div style={{color:T.green}}>{"+$"+(my.revenue||0).toFixed(1)+"M rev"}</div>
                  <div style={{color:T.red}}>{"-$"+(my.expenses||0).toFixed(1)+"M exp"}</div>
                  <div>{"Morale: "+Math.round(avg(my.roster,function(p){return p.morale||70;}))}</div>
                  <div style={{color:moodColor(my.ownerMood||70)}}>{"Owner: "+(my.ownerMood||70)+" ("+my.ownerGoal+")"}</div>
                </div>
                <div style={{marginTop:10,paddingTop:8,borderTop:"1px solid "+T.border}}>
                  <div style={{fontSize:12,color:T.dim,marginBottom:4}}>{"ðŸŽŸï¸ TICKET PRICE: $"+(my.ticketPrice||75)}</div>
                  <input type="range" min="30" max="200" value={my.ticketPrice||75} onChange={function(e){var nt=teams.slice();nt.find(function(t){return t.id===myId;}).ticketPrice=parseInt(e.target.value);setTeams(nt);}} style={{width:"100%",accentColor:T.gold}} />
                </div>
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,color:T.blue,marginBottom:8}}>ðŸ—ï¸ Facilities</div>
                {FACILS.map(function(fac){
                  var lvl=my.facilities&&my.facilities[fac.id]?my.facilities[fac.id]:0;var next=Math.round(fac.cost*(lvl+1));
                  return (
                    <div key={fac.id} style={{marginBottom:10,paddingBottom:10,borderBottom:"1px solid "+T.border}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                        <div>
                          <div style={{fontWeight:700,fontSize:13}}>{fac.icon+" "+fac.name+" Lvl "+lvl}</div>
                          <div style={{fontSize:10,color:T.dim}}>{fac.desc}</div>
                        </div>
                        {lvl<fac.maxLvl?<button style={bS((my.cash||0)>=next?T.gold:T.bg3)} onClick={function(){
                          if((my.cash||0)<next){addN("ðŸ’° Need $"+next+"M!","red");return;}
                          var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
                          if(!u2.facilities)u2.facilities={};u2.facilities[fac.id]=(lvl||0)+1;u2.cash-=next;
                          addN("ðŸ—ï¸ "+fac.name+" â†’ Lvl "+(lvl+1)+"!","green");logTx("UPGRADE_FACIL",{type:fac.name,newLvl:lvl+1,cost:next});
                          setTeams(nt);doSave(nt);
                        }}>{"Build $"+next+"M"}</button>
                          :<span style={{fontSize:11,color:T.green,fontWeight:700}}>MAX</span>}
                      </div>
                      <div style={{height:4,background:T.bg3,marginTop:6,borderRadius:2}}>
                        <div style={{width:(lvl/fac.maxLvl*100)+"%",height:"100%",background:T.blue,borderRadius:2}} /></div>
                    </div>);})}</div>
              <div style={cS}>
                <div style={{fontWeight:700,color:T.purple,marginBottom:8}}>ðŸŽ© Coaching Staff</div>
                {[my.staff.hc,my.staff.oc,my.staff.dc].map(function(c){return (
                  <div key={c.id} style={{marginBottom:6,fontSize:12}}>
                    <span style={{color:T.gold,fontWeight:700}}>{c.role}</span>{" "+c.name+" â€” "}<span style={{color:T.cyan}}>{c.arch}</span>
                    <span style={{color:T.faint,marginLeft:8}}>{"Str:"+c.ratings.strategy+" Dev:"+c.ratings.development+" GP:"+c.ratings.gameplan}</span>
                  </div>);})}</div>
              
              {godMode && <div style={assign({},cS,{borderColor:T.purple})}>
                <div style={{fontWeight:700,color:T.purple,marginBottom:8}}>{"âš¡ Team Editor (God Mode)"}</div>
                <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:10}}>
                  {React.createElement(TeamLogo,{team:my,size:40})}
                  <div>
                    <div style={{fontWeight:800,fontSize:16}}>{my.city+" "+my.name}</div>
                    <div style={{fontSize:11,color:T.dim}}>{my.abbr+" | "+my.icon}</div>
                  </div>
                </div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                  <div>
                    <div style={{fontSize:9,color:T.faint,marginBottom:2}}>{"CITY"}</div>
                    <div style={{background:T.bg3,borderRadius:4,padding:"6px 8px",fontSize:12,cursor:"pointer",border:"1px solid "+T.border}}
                      onClick={function(){var v=prompt("Team City:",my.city);if(v)godModeTeamEdit("city",v);}}>{my.city}</div>
                  </div>
                  <div>
                    <div style={{fontSize:9,color:T.faint,marginBottom:2}}>{"NAME"}</div>
                    <div style={{background:T.bg3,borderRadius:4,padding:"6px 8px",fontSize:12,cursor:"pointer",border:"1px solid "+T.border}}
                      onClick={function(){var v=prompt("Team Name:",my.name);if(v)godModeTeamEdit("name",v);}}>{my.name}</div>
                  </div>
                  <div>
                    <div style={{fontSize:9,color:T.faint,marginBottom:2}}>{"ABBR"}</div>
                    <div style={{background:T.bg3,borderRadius:4,padding:"6px 8px",fontSize:12,cursor:"pointer",border:"1px solid "+T.border}}
                      onClick={function(){var v=prompt("Abbreviation (3-4 chars):",my.abbr);if(v)godModeTeamEdit("abbr",v);}}>{my.abbr}</div>
                  </div>
                  <div>
                    <div style={{fontSize:9,color:T.faint,marginBottom:2}}>{"ICON (emoji)"}</div>
                    <div style={{background:T.bg3,borderRadius:4,padding:"6px 8px",fontSize:12,cursor:"pointer",border:"1px solid "+T.border}}
                      onClick={function(){var v=prompt("Team Icon (emoji):",my.icon);if(v)godModeTeamEdit("icon",v);}}>{my.icon}</div>
                  </div>
                </div>
                <div style={{fontSize:9,color:T.faint,marginTop:6}}>{"Click any field to edit. Logo updates instantly."}</div>
                
                <div style={{borderTop:"1px solid "+T.purple,marginTop:10,paddingTop:10}}>
                  <div style={{fontWeight:700,color:T.purple,marginBottom:6}}>{"ðŸ’ª GOD POWERS"}</div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4,marginBottom:8}}>
                    <button style={bS(T.green,"#000")} onClick={function(){
                      var v=prompt("Set Cash ($M):",Math.round(my.cash||0));if(v){var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.cash=parseFloat(v)||0;setTeams(nt);doSave(nt);addN("âš¡ Cash â†’ $"+u2.cash+"M","purple");}
                    }}>{"ðŸ’µ Cash: $"+(my.cash||0).toFixed(0)+"M"}</button>
                    <button style={bS(T.cyan,"#000")} onClick={function(){
                      var v=prompt("Set Scout Points:",my.scoutPts||0);if(v){var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.scoutPts=parseInt(v)||0;setTeams(nt);doSave(nt);addN("âš¡ Scout â†’ "+u2.scoutPts,"purple");}
                    }}>{"ðŸ” Scout: "+(my.scoutPts||0)}</button>
                    <button style={bS(T.gold,"#000")} onClick={function(){
                      var v=prompt("Set Owner Mood (0-100):",my.ownerMood||70);if(v){var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.ownerMood=Math.min(100,Math.max(0,parseInt(v)||70));setTeams(nt);doSave(nt);addN("âš¡ Mood â†’ "+u2.ownerMood,"purple");}
                    }}>{"ðŸ˜Š Mood: "+(my.ownerMood||70)}</button>
                    <button style={bS(T.blue,"#fff")} onClick={function(){
                      var v=prompt("Set Prestige (0-100):",my.prestige||50);if(v){var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.prestige=Math.min(100,Math.max(0,parseInt(v)||50));setTeams(nt);doSave(nt);addN("âš¡ Prestige â†’ "+u2.prestige,"purple");}
                    }}>{"â­ Prestige: "+(my.prestige||50)}</button>
                    <button style={bS(T.green,"#000")} onClick={function(){
                      var v=prompt("Set Wins:",my.wins||0);if(v){var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.wins=parseInt(v)||0;setTeams(nt);doSave(nt);addN("âš¡ Wins â†’ "+u2.wins,"purple");}
                    }}>{"ðŸ† W: "+(my.wins||0)}</button>
                    <button style={bS(T.red,"#fff")} onClick={function(){
                      var v=prompt("Set Losses:",my.losses||0);if(v){var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.losses=parseInt(v)||0;setTeams(nt);doSave(nt);addN("âš¡ Losses â†’ "+u2.losses,"purple");}
                    }}>{"ðŸ’€ L: "+(my.losses||0)}</button>
                  </div>
                  <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.cash=(u2.cash||0)+100;u2.scoutPts=(u2.scoutPts||0)+500;setTeams(nt);doSave(nt);addN("âš¡ +$100M cash, +500 scout pts","purple");
                    }}>{"ðŸ’° +$100M & +500 Scout"}</button>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.roster.forEach(function(p){p.morale=99;});setTeams(nt);doSave(nt);addN("âš¡ All player morale â†’ 99","purple");
                    }}>{"ðŸ˜Š Max Morale"}</button>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.roster.forEach(function(p){if(p.injury)setPlayerInjury92(p,null,0);});setTeams(nt);doSave(nt);addN("âš¡ All injuries healed","purple");
                    }}>{"ðŸ¥ Heal All"}</button>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.deadCap=0;u2.capUsed=capCalc(u2.roster);setTeams(nt);doSave(nt);addN("âš¡ Dead cap cleared","purple");
                    }}>{"ðŸ§¹ Clear Dead Cap"}</button>
                  </div>
                  
                  <div style={{display:"flex",gap:4,flexWrap:"wrap",marginTop:6}}>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
                      u2.roster.forEach(function(p){
                        var def=POS_DEF[p.pos];if(def){def.r.forEach(function(r){p.ratings[r]=cl((p.ratings[r]||50)+5,35,99);});}
                        p.ovr=calcOvr(p);p.pot=cl(p.pot+3,p.ovr,99);
                      });setTeams(nt);doSave(nt);addN("âš¡ All players +5 OVR, +3 POT","purple");
                    }}>{"ðŸ“ˆ Boost All +5"}</button>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var v=prompt("Skip to phase:\npreseason, regular, cutDay, playoffs, seasonRecap, reSign, combine, draft, freeAgency",season.phase);
                      if(v)setSeason(function(s){return assign({},s,{phase:v});});addN("âš¡ Phase â†’ "+v,"purple");
                    }}>{"â­ Skip Phase"}</button>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var v=prompt("Set Scout Points:",my.scoutPts||0);if(v){
                        var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.scoutPts=parseInt(v)||0;setTeams(nt);doSave(nt);addN("âš¡ Scout pts â†’ "+u2.scoutPts,"purple");
                      }
                    }}>{"ðŸ” Set Scout Pts"}</button>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var v=prompt("Set Owner Mood (0-100):",my.ownerMood||50);if(v){
                        var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});u2.ownerMood=cl(parseInt(v)||50,0,100);setTeams(nt);doSave(nt);addN("âš¡ Owner mood â†’ "+u2.ownerMood,"purple");
                      }
                    }}>{"ðŸ¤µ Set Owner Mood"}</button>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var v=prompt("Set Week Number:",season.week);if(v){
                        setSeason(function(s){return assign({},s,{week:cl(parseInt(v)||1,1,28)});});addN("âš¡ Week â†’ "+v,"purple");
                      }
                    }}>{"ðŸ“… Set Week"}</button>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
                      u2.roster.forEach(function(p){p.devTrait="superstar";});setTeams(nt);doSave(nt);addN("âš¡ All players â†’ Superstar dev","purple");
                    }}>{"ðŸŒŸ All Superstar"}</button>
                    <button style={bS("#d946ef","#fff")} onClick={function(){
                      var v=prompt("Set Cap Space ($M):",getSalaryCap(season.year));if(v){
                        var target=parseFloat(v)||200;
                        var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
                        u2.capUsed=0;u2.deadCap=0;
                        u2.roster.forEach(function(p){p.contract.salary=Math.max(MIN_SALARY,Math.round(p.contract.salary*(target/getSalaryCap(season.year))*10)/10);});
                        u2.capUsed=capCalc(u2.roster);
                        setTeams(nt);doSave(nt);addN("âš¡ Salaries rescaled to $"+target+"M cap","purple");
                      }
                    }}>{"ðŸ’µ Rescale Salaries"}</button>
                  </div>
                  
                  {/* v98: ===== EXPANDED GOD MODE â€” LEAGUE-WIDE POWERS ===== */}
                  <div style={{borderTop:"1px solid "+T.purple,marginTop:12,paddingTop:10}}>
                    <div style={{fontWeight:700,color:T.purple,marginBottom:6}}>{"ðŸŒ LEAGUE-WIDE POWERS"}</div>
                    
                    {/* Target Team Selector */}
                    <div style={{marginBottom:8}}>
                      <div style={{fontSize:9,color:T.faint,marginBottom:3}}>{"TARGET TEAM (edit any team)"}</div>
                      <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                        <button style={bS(!godTarget||godTarget===myId?T.purple:T.bg3,!godTarget||godTarget===myId?"#fff":T.dim)}
                          onClick={function(){setGodTarget(null);}}>{my.icon+" "+my.abbr+" (You)"}</button>
                        {teams.filter(function(t){return t.id!==myId;}).sort(function(a,b){return a.abbr<b.abbr?-1:1;}).map(function(t){
                          return React.createElement("button",{key:t.id,
                            style:bS(godTarget===t.id?T.purple:T.bg3,godTarget===t.id?"#fff":T.dim),
                            onClick:function(){setGodTarget(t.id);}},t.icon+" "+t.abbr);
                        })}
                      </div>
                    </div>
                    
                    {/* Target Team Info + Actions */}
                    {(function(){
                      var gt=godTargetTeam();if(!gt)return null;
                      var isOther=gt.id!==myId;
                      return React.createElement("div",{style:{background:"rgba(167,139,250,0.06)",border:"1px solid rgba(167,139,250,0.3)",borderRadius:8,padding:10,marginBottom:8}},
                        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8}},
                          React.createElement(TeamLogo,{team:gt,size:32}),
                          React.createElement("div",null,
                            React.createElement("div",{style:{fontWeight:800,fontSize:14}},gt.city+" "+gt.name),
                            React.createElement("div",{style:{fontSize:10,color:T.dim}},gt.wins+"-"+gt.losses+" | $"+(gt.cash||0).toFixed(0)+"M | Mood:"+(gt.ownerMood||50)+" | Prestige:"+(gt.prestige||50)+" | Fan:"+(gt.fanbase||60)+" | Roster:"+gt.roster.length)
                          )
                        ),
                        
                        React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4,marginBottom:6}},
                          React.createElement("button",{style:bS(T.bg3,T.text),onClick:function(){var v=prompt("City:",gt.city);if(v)godModeAnyTeamEdit(gt.id,"city",v);}},"ðŸ™ "+gt.city),
                          React.createElement("button",{style:bS(T.bg3,T.text),onClick:function(){var v=prompt("Name:",gt.name);if(v)godModeAnyTeamEdit(gt.id,"name",v);}},"ðŸ“› "+gt.name),
                          React.createElement("button",{style:bS(T.bg3,T.text),onClick:function(){var v=prompt("Icon (emoji):",gt.icon);if(v)godModeAnyTeamEdit(gt.id,"icon",v);}},"ðŸŽ¨ "+gt.icon),
                          React.createElement("button",{style:bS(T.green,"#000"),onClick:function(){var v=prompt("Wins:",gt.wins);if(v)godModeAnyTeamEdit(gt.id,"wins",v);}},"W: "+gt.wins),
                          React.createElement("button",{style:bS(T.red,"#fff"),onClick:function(){var v=prompt("Losses:",gt.losses);if(v)godModeAnyTeamEdit(gt.id,"losses",v);}},"L: "+gt.losses),
                          React.createElement("button",{style:bS(T.gold,"#000"),onClick:function(){var v=prompt("Cash ($M):",Math.round(gt.cash||0));if(v)godModeAnyTeamEdit(gt.id,"cash",v);}},"$"+(gt.cash||0).toFixed(0)+"M"),
                          React.createElement("button",{style:bS(T.blue,"#fff"),onClick:function(){var v=prompt("Prestige (0-100):",gt.prestige||50);if(v)godModeAnyTeamEdit(gt.id,"prestige",v);}},"â­ "+(gt.prestige||50)),
                          React.createElement("button",{style:bS(T.cyan,"#000"),onClick:function(){var v=prompt("Owner Mood (0-100):",gt.ownerMood||50);if(v)godModeAnyTeamEdit(gt.id,"ownerMood",v);}},"ðŸ˜Š "+(gt.ownerMood||50)),
                          React.createElement("button",{style:bS(T.bg3,T.text),onClick:function(){var v=prompt("Fanbase (10-99):",gt.fanbase||60);if(v)godModeAnyTeamEdit(gt.id,"fanbase",v);}},"ðŸ“£ "+(gt.fanbase||60))
                        ),
                        
                        React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                          React.createElement("button",{style:bS("#22c55e","#000"),onClick:function(){godModeBoostTeam(gt.id,5);}},"ðŸ“ˆ Boost +5"),
                          React.createElement("button",{style:bS("#22c55e","#000"),onClick:function(){godModeBoostTeam(gt.id,10);}},"ðŸ“ˆ Boost +10"),
                          React.createElement("button",{style:bS("#ef4444","#fff"),onClick:function(){godModeBoostTeam(gt.id,-5);}},"ðŸ“‰ Nerf -5"),
                          React.createElement("button",{style:bS("#ef4444","#fff"),onClick:function(){if(confirm("ðŸ’¥ Nuke "+gt.abbr+"? All players -15 OVR!"))godModeNukeTeam(gt.id);}},"ðŸ’¥ Nuke"),
                          React.createElement("button",{style:bS("#d946ef","#fff"),onClick:function(){
                            var nt=teams.slice();var u2=nt.find(function(t){return t.id===gt.id;});
                            u2.roster.forEach(function(p){p.morale=99;});setTeams(nt);doSave(nt);addN("âš¡ "+gt.abbr+" morale maxed","purple");
                          }},"ðŸ˜Š Max Morale"),
                          React.createElement("button",{style:bS("#d946ef","#fff"),onClick:function(){
                            var nt=teams.slice();var u2=nt.find(function(t){return t.id===gt.id;});
                            u2.roster.forEach(function(p){if(p.injury)setPlayerInjury92(p,null,0);});setTeams(nt);doSave(nt);addN("âš¡ "+gt.abbr+" injuries healed","purple");
                          }},"ðŸ¥ Heal All"),
                          isOther && React.createElement("button",{style:bS("#f59e0b","#000"),onClick:function(){
                            if(confirm("Take control of "+gt.city+" "+gt.name+"?\nYou'll become their GM."))godModeSwapTeam(gt.id);
                          }},"ðŸ”„ Take Control"),
                          React.createElement("button",{style:bS("#f97316","#fff"),onClick:function(){
                            if(confirm("Reset "+gt.abbr+" roster to original presets?\nThis replaces all current players!"))godModeResetRoster(gt.id);
                          }},"ðŸ”„ Reset Roster")
                        ),
                        
                        gt.staff && React.createElement("div",{style:{borderTop:"1px solid rgba(167,139,250,0.2)",marginTop:6,paddingTop:6}},
                          React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.purple,marginBottom:4}},"ðŸŽ© COACHING STAFF"),
                          ["hc","oc","dc"].map(function(role){
                            var c=gt.staff[role];if(!c)return null;
                            return React.createElement("div",{key:role,style:{display:"flex",alignItems:"center",gap:4,marginBottom:3,fontSize:10}},
                              React.createElement("span",{style:{color:T.gold,fontWeight:700,width:22}},role.toUpperCase()),
                              React.createElement("button",{style:assign({},bS(T.bg3,T.text),{fontSize:9,padding:"2px 5px"}),
                                onClick:function(){var v=prompt(role.toUpperCase()+" Name:",c.name);if(v)godModeEditCoach(gt.id,role,"name",v);}},c.name),
                              React.createElement("button",{style:assign({},bS(T.bg3,T.cyan),{fontSize:9,padding:"2px 5px"}),
                                onClick:function(){var v=prompt("Strategy (1-99):",c.ratings.strategy);if(v)godModeEditCoach(gt.id,role,"strategy",v);}},"Str:"+c.ratings.strategy),
                              React.createElement("button",{style:assign({},bS(T.bg3,T.green),{fontSize:9,padding:"2px 5px"}),
                                onClick:function(){var v=prompt("Development (1-99):",c.ratings.development);if(v)godModeEditCoach(gt.id,role,"development",v);}},"Dev:"+c.ratings.development),
                              React.createElement("button",{style:assign({},bS(T.bg3,T.gold),{fontSize:9,padding:"2px 5px"}),
                                onClick:function(){var v=prompt("Gameplan (1-99):",c.ratings.gameplan);if(v)godModeEditCoach(gt.id,role,"gameplan",v);}},"GP:"+c.ratings.gameplan)
                            );
                          })
                        ),
                        
                        React.createElement("div",{style:{borderTop:"1px solid rgba(167,139,250,0.2)",marginTop:6,paddingTop:6}},
                          React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.purple,marginBottom:4}},"ðŸ‘¥ ROSTER ("+(gt.roster||[]).length+") â€” click name for detail, or use action buttons"),
                          React.createElement("div",{style:{maxHeight:200,overflowY:"auto",background:T.bg2,borderRadius:6,padding:4}},
                            (gt.roster||[]).slice().sort(function(a,b){return b.ovr-a.ovr;}).map(function(p){
                              return React.createElement("div",{key:p.id,style:{display:"flex",alignItems:"center",gap:4,padding:"3px 6px",borderBottom:"1px solid "+T.border,fontSize:10,cursor:"pointer"},
                                onClick:function(){setPlayerDetail(p);}},
                                React.createElement("span",{style:{color:T.gold,fontWeight:700,width:24}},p.pos),
                                React.createElement("span",{style:{flex:1,fontWeight:600}},p.name),
                                React.createElement("span",{style:{color:p.ovr>=85?T.green:p.ovr>=75?T.cyan:p.ovr>=65?T.dim:T.red,fontWeight:800,width:28}},p.ovr),
                                React.createElement("span",{style:{color:T.faint,width:32}},"$"+p.contract.salary+"M"),
                                React.createElement("span",{style:{color:T.faint,width:22}},p.age),
                                isOther && React.createElement("button",{style:assign({},bS("#d946ef","#fff"),{fontSize:8,padding:"1px 4px"}),
                                  onClick:function(e){e.stopPropagation();godModeStealPlayer(gt.id,p.id);}},"Steal"),
                                React.createElement("button",{style:assign({},bS(T.bg3,T.dim),{fontSize:8,padding:"1px 4px"}),
                                  onClick:function(e){e.stopPropagation();
                                    var dest=prompt("Move to team (abbr):",my.abbr);if(!dest)return;
                                    var destT=teams.find(function(t){return t.abbr.toLowerCase()===dest.toLowerCase();});
                                    if(destT)godModeMovePlayer(p.id,gt.id,destT.id);else addN("Team not found: "+dest,"red");
                                  }},"Move"),
                                React.createElement("button",{style:assign({},bS(T.bg3,T.dim),{fontSize:8,padding:"1px 4px"}),
                                  onClick:function(e){e.stopPropagation();godModeClonePlayer(gt.id,p.id);}},"Clone"),
                                React.createElement("button",{style:assign({},bS(T.red,"#fff"),{fontSize:8,padding:"1px 4px"}),
                                  onClick:function(e){e.stopPropagation();if(confirm("Force retire "+p.name+"?"))godModeForceRetire(gt.id,p.id);}},"Retire")
                              );
                            })
                          )
                        )
                      );
                    })()}
                    
                    {/* Create Player */}
                    <div style={{marginTop:8,borderTop:"1px solid rgba(167,139,250,0.2)",paddingTop:8}}>
                      <div style={{fontSize:9,fontWeight:700,color:T.purple,marginBottom:4}}>{"ðŸ§¬ CREATE PLAYER"}</div>
                      <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                        {["QB","RB","WR","TE","OL","DL","LB","CB","S","K"].map(function(pos){
                          return React.createElement("button",{key:pos,style:bS(T.bg3,T.text),onClick:function(){
                            var ovr=prompt(pos+" OVR (40-99):",82);if(!ovr)return;
                            var age=prompt("Age (19-40):",24);if(!age)return;
                            var nm=prompt("Name (or leave blank for random):","");
                            godModeCreatePlayer(pos,cl(parseInt(ovr)||75,40,99),cl(parseInt(age)||24,19,40),nm||null);
                          }},pos);
                        })}
                      </div>
                    </div>
                    
                    {/* Draft Pick Editor */}
                    <div style={{marginTop:8,borderTop:"1px solid rgba(167,139,250,0.2)",paddingTop:8}}>
                      <div style={{fontSize:9,fontWeight:700,color:T.purple,marginBottom:4}}>{"ðŸŽ¯ ADD DRAFT PICKS"}</div>
                      <div style={{display:"flex",gap:4}}>
                        {[1,2,3,4,5,6,7].map(function(rd){
                          return React.createElement("button",{key:rd,style:bS(T.bg3,T.text),onClick:function(){godModeAddPick(rd);}},"+Rd "+rd);
                        })}
                      </div>
                    </div>
                    
                    {/* Advanced League Controls */}
                    <div style={{marginTop:8,borderTop:"1px solid rgba(167,139,250,0.2)",paddingTop:8}}>
                      <div style={{fontSize:9,fontWeight:700,color:T.purple,marginBottom:4}}>{"âš™ï¸ ADVANCED"}</div>
                      <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                        <button style={bS("#d946ef","#fff")} onClick={function(){
                          var v=prompt("Set Salary Cap ($M, default "+getSalaryCap(season.year)+"):",getSalaryCap(season.year));
                          if(v){CAP_MATH.BASE=parseFloat(v)||200;addN("âš¡ Salary cap â†’ $"+CAP_MATH.BASE+"M","purple");}
                        }}>{"ðŸ’° Set Cap: $"+getSalaryCap(season.year)+"M"}</button>
                        <button style={bS("#d946ef","#fff")} onClick={function(){
                          setSeason(function(s){return assign({},s,{year:s.year+1});});addN("âš¡ Year â†’ "+(season.year+1),"purple");
                        }}>{"ðŸ“† Advance Year"}</button>
                        <button style={bS("#d946ef","#fff")} onClick={function(){
                          var v=prompt("Set Year:",season.year);if(v)setSeason(function(s){return assign({},s,{year:parseInt(v)||s.year});});
                        }}>{"ðŸ“… Set Year: "+season.year}</button>
                        <button style={bS("#d946ef","#fff")} onClick={function(){
                          var v=prompt("Set Difficulty (1=Easy, 5=Legend):",difficulty);if(v){setDifficulty(cl(parseInt(v)||3,1,5));addN("âš¡ Difficulty â†’ "+v,"purple");}
                        }}>{"ðŸŽ® Difficulty: "+difficulty}</button>
                        <button style={bS("#f97316","#fff")} onClick={function(){
                          if(confirm("âš ï¸ RESET ALL 30 ROSTERS to original presets?\n\nThis replaces every team's current players with the original starting rosters. Team records/cash/history are preserved.\n\nThis cannot be undone!"))godModeResetAllRosters();
                        }}>{"ðŸ”„ Reset ALL Rosters"}</button>
                      </div>
                    </div>
                  </div>
                  
                  <div style={{fontSize:9,color:T.faint,marginTop:8}}>{"âš¡ GOD MODE: Edit ANY team, player, coach. Force trades/signs. Steal, move, clone, retire, create players. No limits."}</div>
                </div>
              </div>}
              
              <div style={assign({},cS,{borderColor:T.cyan})}>
                <div style={{fontWeight:700,color:T.cyan,marginBottom:8}}>ðŸ’¾ Save Management</div>
                <div style={{fontSize:11,color:T.dim,marginBottom:8}}>Your game auto-saves every 60 seconds. Export for backup or transfer between devices.</div>
                <div style={{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8}}>
                  <button style={bS(T.green,"#000")} onClick={function(){doSave();setAutoSaveInd("ðŸ’¾ Saved");setTimeout(function(){setAutoSaveInd("");},1400);}}>{"ðŸ’¾ Save Now"}</button>
                  <button style={bS(T.cyan,"#000")} onClick={exportClipboard}>{"ðŸ“‹ Copy Save String"}</button>
                  <button style={bS(T.blue,"#fff")} onClick={function(){setImportModal(true);}}>{"ðŸ“¥ Paste Save String"}</button>
                </div>
                <div style={{display:"flex",gap:8,flexWrap:"wrap"}}>
                  <button style={bS(T.bg3,T.dim)} onClick={exportSave}>{"â¬‡ï¸ Download .json"}</button>
                  <label style={assign({},bS(T.bg3,T.dim),{cursor:"pointer"})}>
                    {"â¬†ï¸ Upload .json"}
                    <input type="file" accept=".json" onChange={importSave} style={{display:"none"}} />
                  </label>
                </div>
                <div style={{fontSize:10,color:T.faint,marginTop:6}}>{"Move your league between devices by exporting a save string. Paste it on another computer to restore your league exactly."}</div>
                <div style={{fontSize:10,color:T.faint,marginTop:3}}>{"Box Scores saved: "+boxHistory.length+" games | Season "+season.year+" Wk"+season.week+" | Ctrl+S to save, Ctrl+Shift+C to copy"}</div>
              </div>

              {/* v98.6 #7: GM REPUTATION */}
              <div style={assign({},cS,{padding:14})}>
                <div style={{fontWeight:900,fontSize:13,color:T.gold,marginBottom:8}}>{"ðŸ‘” GM REPUTATION"}</div>
                {(function(){
                  var rep=GM_REP_986.calculate(txLog,tradeState);
                  var label=GM_REP_986.getLabel(rep.overall);
                  return <div>
                    <div style={{display:"flex",gap:10,alignItems:"center",marginBottom:8}}>
                      <span style={{fontSize:22}}>{label.icon}</span>
                      <span style={{fontWeight:800,color:label.color,fontSize:15}}>{label.label}</span>
                      <span style={{color:T.dim,fontSize:11}}>{"("+rep.overall+"/100)"}</span>
                    </div>
                    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6}}>
                      {[{label:"Fair Dealer",val:rep.fairDealer},{label:"Aggressiveness",val:rep.aggressive},{label:"Loyalty",val:rep.loyalty}].map(function(s,i){
                        return <div key={i} style={{background:"rgba(255,255,255,0.03)",borderRadius:6,padding:8,textAlign:"center"}}>
                          <div style={{fontSize:9,color:T.dim}}>{s.label}</div>
                          <div style={{fontWeight:800,fontSize:14,color:s.val>=70?T.green:s.val>=40?T.gold:"#ef4444"}}>{s.val}</div>
                          <div style={{height:3,background:"rgba(255,255,255,0.1)",borderRadius:2,marginTop:4}}>
                            <div style={{height:3,borderRadius:2,width:s.val+"%",background:s.val>=70?T.green:s.val>=40?T.gold:"#ef4444"}}/>
                          </div>
                        </div>;
                      })}
                    </div>
                    <div style={{fontSize:9,color:T.faint,marginTop:6}}>{"Reputation affects trade negotiations and free agent interest. Build trust through fair deals."}</div>
                  </div>;
                })()}
              </div>

              {/* v98.6 #16: CAP PROJECTIONS DASHBOARD */}
              <div style={assign({},cS,{padding:14})}>
                <div style={{fontWeight:900,fontSize:13,color:T.cyan,marginBottom:8}}>{"ðŸ“Š 3-YEAR CAP PROJECTION"}</div>
                {(function(){
                  var proj=CAP_PROJ_986.project(my,season.year,getSalaryCap);
                  return <div style={{display:"flex",flexDirection:"column",gap:6}}>
                    {proj.map(function(p,i){
                      var pct=p.cap>0?Math.round(p.committed/p.cap*100):0;
                      var color=p.space>30?T.green:p.space>10?T.gold:"#ef4444";
                      return <div key={i} style={{background:"rgba(255,255,255,0.03)",borderRadius:6,padding:10}}>
                        <div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}>
                          <span style={{fontWeight:800,fontSize:12}}>{p.year+(i===0?" (Current)":"")}</span>
                          <span style={{fontWeight:700,fontSize:11,color:color}}>{"$"+p.space+"M space"}</span>
                        </div>
                        <div style={{height:8,background:"rgba(255,255,255,0.1)",borderRadius:4,overflow:"hidden",marginBottom:4}}>
                          <div style={{height:8,borderRadius:4,width:Math.min(100,pct)+"%",background:pct>90?"#ef4444":pct>75?T.gold:T.green}}/>
                        </div>
                        <div style={{display:"flex",justifyContent:"space-between",fontSize:9,color:T.dim}}>
                          <span>{"$"+p.committed+"M / $"+p.cap+"M cap ("+pct+"%)"}</span>
                          <span>{p.expiring+" expiring"+(p.deadCap>0?" | $"+p.deadCap+"M dead":"")}</span>
                        </div>
                        {i===0&&p.expiringNames.length>0&&<div style={{fontSize:8,color:T.faint,marginTop:3}}>{"Expiring: "+p.expiringNames.join(", ")}</div>}
                      </div>;
                    })}
                  </div>;
                })()}
              </div>

              {/* v98.6 #18: OWNER MODE LITE */}
              <div style={assign({},cS,{padding:14})}>
                <div style={{fontWeight:900,fontSize:13,color:"#a78bfa",marginBottom:8}}>{"ðŸŸï¸ OWNER MODE"}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                  <div>
                    <div style={{fontSize:10,fontWeight:700,color:T.dim,marginBottom:4}}>{"TICKET PRICING"}</div>
                    {OWNER_MODE_986.ticketTiers.map(function(tier,i){
                      var isActive=(my.ticketTier986||1)===i;
                      return <button key={i} onClick={function(){
                        var nt=teams.slice();var mt=nt.find(function(t){return t.id===myId;});
                        if(mt){mt.ticketTier986=i;setTeams(nt);addN("ðŸŽ« Ticket price set to "+tier.label+" ($"+tier.price+")","cyan");}
                      }} style={{display:"block",width:"100%",padding:"6px 8px",marginBottom:3,border:isActive?"2px solid "+T.gold:"1px solid "+T.border,
                        borderRadius:4,background:isActive?"rgba(212,167,75,0.15)":"rgba(255,255,255,0.03)",color:isActive?T.gold:T.text,
                        cursor:"pointer",fontSize:10,textAlign:"left",fontWeight:isActive?700:400}}>
                        <span>{tier.label+" â€” $"+tier.price}</span>
                        <span style={{float:"right",color:tier.fanImpact>0?T.green:tier.fanImpact<0?"#ef4444":T.dim}}>
                          {(tier.fanImpact>0?"+":"")+tier.fanImpact+" fans"}
                        </span>
                      </button>;
                    })}
                  </div>
                  <div>
                    <div style={{fontSize:10,fontWeight:700,color:T.dim,marginBottom:4}}>{"STADIUM LEVEL"}</div>
                    {OWNER_MODE_986.stadiumLevels.map(function(sl,i){
                      var isActive=(my.stadiumLevel986||1)===sl.level;
                      var canAfford=(my.cash||0)>=sl.cost;
                      return <button key={i} onClick={function(){
                        if(!canAfford&&!isActive){addN("âŒ Need $"+sl.cost+"M for "+sl.label+" stadium","red");return;}
                        var nt=teams.slice();var mt=nt.find(function(t){return t.id===myId;});
                        if(mt&&!isActive){mt.stadiumLevel986=sl.level;if(sl.cost>0)mt.cash=(mt.cash||0)-sl.cost;setTeams(nt);
                          addN("ðŸŸï¸ Stadium upgraded to "+sl.label+"! (+"+Math.round(sl.revBonus*100)+"% revenue, +"+sl.prestigeBonus+" prestige)","gold");}
                      }} style={{display:"block",width:"100%",padding:"6px 8px",marginBottom:3,border:isActive?"2px solid #a78bfa":"1px solid "+T.border,
                        borderRadius:4,background:isActive?"rgba(167,139,250,0.15)":"rgba(255,255,255,0.03)",color:isActive?"#a78bfa":T.text,
                        cursor:"pointer",fontSize:10,textAlign:"left",fontWeight:isActive?700:400}}>
                        {sl.label+(sl.cost>0?" ($"+sl.cost+"M)":"")+(isActive?" âœ“":"")}
                      </button>;
                    })}
                    <div style={{fontSize:9,color:T.faint,marginTop:6}}>{"Revenue: wins Ã— attendance Ã— pricing. Higher stadium = more revenue + prestige."}</div>
                  </div>
                </div>
              </div>

              {/* v98.6 #8: COACHING CAROUSEL â€” Available Coaches */}
              {COACH_CAROUSEL_986.firedPool.length>0&&<div style={assign({},cS,{padding:14})}>
                <div style={{fontWeight:900,fontSize:13,color:"#f59e0b",marginBottom:8}}>{"ðŸ”„ COACHING CAROUSEL â€” "+COACH_CAROUSEL_986.firedPool.length+" Available"}</div>
                {COACH_CAROUSEL_986.firedPool.filter(function(c){return c.available;}).slice(0,6).map(function(c,i){
                  return <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 8px",borderBottom:"1px solid "+T.border,fontSize:11}}>
                    <div>
                      <span style={{fontWeight:700}}>{c.name}</span>
                      <span style={{color:T.dim,marginLeft:6}}>{c.role+" ("+c.arch+")"}</span>
                    </div>
                    <div style={{display:"flex",gap:6,alignItems:"center"}}>
                      <span style={{color:T.faint,fontSize:9}}>{"Fired from "+c.firedFrom+" (Y"+c.firedYear+")"}</span>
                      <span style={{fontSize:10,color:T.cyan}}>{"Dev: "+(c.ratings?c.ratings.development:"?")+"/100"}</span>
                    </div>
                  </div>;
                })}
                <div style={{fontSize:9,color:T.faint,marginTop:4}}>{"Fired coaches join the carousel. Hire from Staff tab."}</div>
              </div>}
            </div>
          )}
          
          
          {tab==="scouting"&&my&&(function(){
            var foScoutB81=FRONT_OFFICE.getBonus(frontOffice78,"evaluation");
            var totalPts81=10+Math.floor(foScoutB81);
            var used81=Object.keys(scoutBudget81).reduce(function(s,k){return s+(scoutBudget81[k]||0);},0);
            var regions81=[
              {id:"sec",name:"SEC",icon:"ðŸˆ",strength:"RB, LB, DL"},
              {id:"big10",name:"Big Ten",icon:"ðŸŒ½",strength:"OL, LB, RB"},
              {id:"big12",name:"Big 12",icon:"ðŸ¤ ",strength:"QB, WR, CB"},
              {id:"acc",name:"ACC",icon:"ðŸŒ´",strength:"QB, WR, TE"},
              {id:"pac12",name:"Pac-12",icon:"ðŸŒŠ",strength:"WR, CB, S"},
              {id:"other",name:"Small School",icon:"ðŸŽ“",strength:"TE, DL, K"}
            ];
            return React.createElement("div",{style:mS(S.card,{padding:12,marginBottom:12})},
              React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
                React.createElement("div",{style:{fontSize:12,fontWeight:800,color:T.cyan}},"ðŸ—ºï¸ SCOUT BUDGET ALLOCATION"),
                React.createElement("div",{style:{fontSize:9,color:used81>=totalPts81?T.green:T.gold,fontWeight:700}},used81+"/"+totalPts81+" pts used")
              ),
              foScoutB81>0&&React.createElement("div",{style:{fontSize:8,color:T.green,marginBottom:6}},"ðŸ” Scouting Director bonus: +"+Math.floor(foScoutB81)+" extra budget points"),
              regions81.map(function(reg){
                var pts=scoutBudget81[reg.id]||0;
                return React.createElement("div",{key:reg.id,style:{display:"flex",alignItems:"center",gap:6,padding:"4px 0",borderBottom:"1px solid "+T.border}},
                  React.createElement("span",{style:{width:24,textAlign:"center"}},reg.icon),
                  React.createElement("span",{style:{width:70,fontSize:9,fontWeight:700}},reg.name),
                  React.createElement("button",{style:{width:22,height:22,borderRadius:4,background:T.bg3,border:"1px solid "+T.border,color:T.text,cursor:pts>0?"pointer":"not-allowed",fontSize:12,fontWeight:700},disabled:pts<=0,
                    onClick:function(){setScoutBudget81(function(prev){var u=assign({},prev);u[reg.id]=Math.max(0,(u[reg.id]||0)-1);return u;});}},"-"),
                  React.createElement("span",{style:{width:20,textAlign:"center",fontWeight:800,fontSize:11}},pts),
                  React.createElement("button",{style:{width:22,height:22,borderRadius:4,background:T.bg3,border:"1px solid "+T.border,color:T.text,cursor:used81<totalPts81?"pointer":"not-allowed",fontSize:12,fontWeight:700},disabled:used81>=totalPts81,
                    onClick:function(){setScoutBudget81(function(prev){var u=assign({},prev);u[reg.id]=(u[reg.id]||0)+1;return u;});}},"+"),
                  React.createElement("div",{style:{flex:1,height:5,background:T.bg3,borderRadius:3,marginLeft:4}},
                    React.createElement("div",{style:{width:Math.round((pts/Math.max(1,totalPts81))*100)+"%",height:5,background:T.cyan,borderRadius:3}})
                  ),
                  React.createElement("span",{style:{fontSize:7,color:T.faint,width:60,textAlign:"right"}},reg.strength)
                );
              })
            );
          })()}
          {(tab==="scouting"||tab==="combine") && (function(){
            var filtered=dc.filter(function(p){return scoutPosF==="ALL"||p.pos===scoutPosF;});
            var sorted=filtered.slice().sort(function(a,b){
              var aV,bV;
              if(scoutSort==="pos"){aV=a.pos;bV=b.pos;return scoutDir*(aV<bV?-1:aV>bV?1:0);}
              if(scoutSort==="name"){aV=a.name;bV=b.name;return scoutDir*(aV<bV?-1:aV>bV?1:0);}
              if(scoutSort==="hypeOvr"){aV=a.hypeOvr||0;bV=b.hypeOvr||0;}
              else if(scoutSort==="ovr"){aV=(typeof a.scouted==="object"&&a.scouted.film)?a.ovr:0;bV=(typeof b.scouted==="object"&&b.scouted.film)?b.ovr:0;}
              else if(scoutSort==="age"){aV=a.age||0;bV=b.age||0;}
              else if(scoutSort==="scouted"){aV=(typeof a.scouted==="object"&&a.scouted.complete)?3:(typeof a.scouted==="object"?((a.scouted.measurables?1:0)+(a.scouted.interview?1:0)+(a.scouted.film?1:0)):0);
                bV=(typeof b.scouted==="object"&&b.scouted.complete)?3:(typeof b.scouted==="object"?((b.scouted.measurables?1:0)+(b.scouted.interview?1:0)+(b.scouted.film?1:0)):0);}
              else{aV=a.hypeOvr||0;bV=b.hypeOvr||0;}
              return scoutDir*(bV-aV);
            });
            var toggleSort=function(key){if(scoutSort===key){setScoutDir(function(d){return d*-1;});}else{setScoutSort(key);setScoutDir(-1);}};
            var sortArrow=function(key){return scoutSort===key?(scoutDir===-1?"â–¼":"â–²"):"";};
            var unscouted={meas:0,int:0,film:0,full:0};
            filtered.forEach(function(p){var sc=typeof p.scouted==="object"?p.scouted:{};
              if(!sc.measurables)unscouted.meas++;if(!sc.interview)unscouted.int++;if(!sc.film)unscouted.film++;
              if(!sc.measurables||!sc.interview||!sc.film)unscouted.full++;});
            var mCost=unscouted.meas*SCOUT_COSTS86.measurables;
            var iCost=unscouted.int*SCOUT_COSTS86.interview;
            var fCost=unscouted.film*SCOUT_COSTS86.film;
            var sp95=my.scoutPts||0;
            var sp95Phase=season.phase||"regular";
            return <div>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                <div style={{fontWeight:700}}>{season.phase==="combine"?"ðŸ‹ï¸ COMBINE":"ðŸ” Draft Board"}</div>
                <div style={{display:"flex",alignItems:"center",gap:8}}>
                  <div style={{color:T.cyan,fontSize:12,fontWeight:700}}>{"ðŸ” "+(sp95)+" pts"}</div>
                  <button onClick={function(){setShowScoutSpend95(function(v){return !v;});}}
                    style={{fontSize:10,fontWeight:800,padding:"4px 10px",borderRadius:6,border:"1px solid rgba(34,211,238,0.5)",background:showScoutSpend95?"rgba(34,211,238,0.18)":"rgba(34,211,238,0.07)",color:T.cyan,cursor:"pointer",letterSpacing:0.5}}>
                    {showScoutSpend95?"â–² SPEND MENU":"ðŸ’¸ SPEND POINTS"}
                  </button>
                </div>
              </div>

              {/* â”€â”€ v95.1: SCOUT SPEND PANEL â”€â”€ */}
              {showScoutSpend95 && (function(){
                var now=["any",sp95Phase];
                var available=SCOUT_SPEND_MENU95.filter(function(item){
                  return item.phase.some(function(ph){return now.indexOf(ph)>=0;});
                });
                var unavailable=SCOUT_SPEND_MENU95.filter(function(item){
                  return !item.phase.some(function(ph){return now.indexOf(ph)>=0;});
                });
                function handleSpend(item){
                  if(sp95<item.cost){addN("Need "+item.cost+" scout pts â€” only have "+sp95+".","red");return;}
                  var nt=teams.slice();
                  var u2=nt.find(function(t){return t.id===myId;});
                  if(!u2)return;
                  u2.scoutPts=(u2.scoutPts||0)-item.cost;
                  setTeams(nt);doSave(nt);
                  // Apply effects
                  if(item.id==="medical_recheck"){
                    var injured=(my.roster||[]).filter(function(p){return p.injury&&p.injury.weeks>1;});
                    if(injured.length>0){
                      var nt2=teams.slice();var u3=nt2.find(function(t){return t.id===myId;});
                      var tgt=u3.roster.find(function(p){return p.id===injured[0].id;});
                      if(tgt&&tgt.injury){var cut=Math.floor(tgt.injury.weeks*0.4);tgt.injury.weeks=Math.max(1,tgt.injury.weeks-cut);}
                      setTeams(nt2);doSave(nt2);
                      addN("ðŸ¥ Re-Check: "+injured[0].name+"'s recovery shortened!","green");
                    } else {addN("ðŸ¥ Re-Check: No injured players to fast-track.","cyan");}
                  } else if(item.id==="pr_spin"){
                    var nt3=teams.slice();var u4=nt3.find(function(t){return t.id===myId;});
                    if(!u4){addN("Media Spin failed: team not found.","red");return;}
                    u4.ownerMood=Math.min(100,(u4.ownerMood||50)+5);
                    setTeams(nt3);doSave(nt3);
                    addN("ðŸ“º Media Spin: Owner Mood +5!","gold");
                  } else if(item.id==="training_boost"){
                    // v95.4: REAL EFFECT â€” sets scoutTrainBoostWeek flag; progressPlayer reads +0.15 devMult at rollover
                    var ntTB=teams.slice();var uTB=ntTB.find(function(t){return t.id===myId;});
                    if(uTB){uTB.scoutTrainBoostWeek=season.week;setTeams(ntTB);doSave(ntTB);}
                    addN("ðŸ‹ï¸ Position Group Boost locked in for Week "+season.week+" â€” +15% dev at rollover!","green");
                  } else if(item.id==="opponent_film"){
                    // v95.4: Sets opponentFilmWeek flag read by simGame clutchBoost for user team
                    var ntOF=teams.slice();var uOF=ntOF.find(function(t){return t.id===myId;});
                    if(uOF){uOF.opponentFilmWeek=season.week;setTeams(ntOF);doSave(ntOF);}
                    addN("ðŸ“¹ Film Study: +5 clutch bonus wired for this week's game sim!","cyan");
                  } else if(item.id==="injury_intel"){
                    // v95.4: Reveal opponent starter injuries for next scheduled game
                    var nextGame95=season.schedule?season.schedule.find(function(g){return g.week===season.week&&(g.home===myId||g.away===myId);}):null;
                    var oppId95=nextGame95?(nextGame95.home===myId?nextGame95.away:nextGame95.home):null;
                    var oppTeam95=oppId95?teams.find(function(t){return t.id===oppId95;}):null;
                    if(oppTeam95){
                      var oppInj95=(oppTeam95.roster||[]).filter(function(p){return p.injury&&p.injury.games>0&&p.isStarter;});
                      addN(oppInj95.length>0?"ðŸ©º "+oppTeam95.name+" STARTERS OUT: "+oppInj95.map(function(p){return p.name+" ("+p.pos+")";}).join(", "):"ðŸ©º "+oppTeam95.name+" reports FULLY HEALTHY this week!","cyan");
                    } else {addN("ðŸ©º Injury Intel: No opponent data found for current week.","orange");}
                  } else if(item.id==="locker_mole"){
                    var lowMoral=(my.roster||[]).slice().sort(function(a,b){return (a.morale||50)-(b.morale||50);})[0];
                    var lowTrait95=lowMoral?getPlayerTraits95(lowMoral).filter(function(tk){return TRAIT_FX[tk]&&(TRAIT_FX[tk].morale||0)<0;}).join("/"):"";
                    addN("ðŸ•µï¸ Locker Intel: "+((lowMoral&&lowMoral.name)||"Unknown")+" (morale "+(lowMoral&&lowMoral.morale||"?")+")"+(lowTrait95?" â€” "+lowTrait95+" trait drags locker room":"")+". Address it!","orange");
                  } else if(item.id==="udfa_search"){
                    addN("ðŸ’Ž UDFA Search: 3 hidden gems flagged â€” check FA pool after draft!","gold");
                  } else if(item.id==="pipeline"){
                    // v95.4: Set pipelineBoostYear flag read by genDraftClass
                    var ntPL=teams.slice();var uPL=ntPL.find(function(t){return t.id===myId;});
                    if(uPL){uPL.pipelineBoostYear=(season&&season.year||2026)+1;setTeams(ntPL);doSave(ntPL);}
                    addN("ðŸŽ“ Pipeline: "+((season&&season.year||2026)+1)+" draft class quality boosted â€” flag set!","gold");
                  } else if(item.id==="combine_extra"){
                    // v95.4: 50% chance to reveal glass trait on top unscouted prospect
                    var topProsp=(Array.isArray(dc)?dc:[]).slice().sort(function(a,b){return (b.ovr||0)-(a.ovr||0);}).slice(0,10);
                    var glassTargets=topProsp.filter(function(p){return hasTrait95(p,"glass")&&!(p.scoutData&&p.scoutData.traitRevealed);});
                    if(glassTargets.length>0&&RNG.ui()<0.5){
                      var glassP=glassTargets[0];if(!glassP.scoutData)glassP.scoutData={};glassP.scoutData.traitRevealed=true;
                      addN("ðŸ”¬ DEEP DIVE: "+glassP.name+" shows ðŸ«§ GLASS signals in combine medicals! Flagged.","purple");
                    } else {addN("ðŸ”¬ Combine Deep Dive: No glass red flags found in top 10 prospects.","cyan");}
                  } else if(item.id==="fa_background"){
                    // v95.4: Reveal hidden negative trait on a random FA
                    var negTraitIds=["glass","cancer","hothead","mercenary","party_animal","holdout","ego","stat_padder","streaky"];
                    var badFAs=(fas||[]).filter(function(p){return getPlayerTraits95(p).some(function(tk){return negTraitIds.indexOf(tk)>=0;});});
                    if(badFAs.length>0){
                      var badFA=badFAs[Math.floor(RNG.ui()*badFAs.length)];
                      var negT=getPlayerTraits95(badFA).filter(function(tk){return negTraitIds.indexOf(tk)>=0;});
                      var ntFAB=teams.slice();var uFAB=ntFAB.find(function(t){return t.id===myId;});
                      if(uFAB){if(!uFAB.faIntelRevealed)uFAB.faIntelRevealed={};uFAB.faIntelRevealed[badFA.id]=true;setTeams(ntFAB);doSave(ntFAB);}
                      addN("ðŸ” BACKGROUND: "+badFA.name+" hides "+negT.map(function(tk){return TRAITS[tk]?TRAITS[tk].icon+" "+TRAITS[tk].name:tk;}).join(", ")+". Proceed carefully.","orange");
                    } else {addN("ðŸ” Background Check: All available FAs check out clean.","cyan");}
                  } else if(item.id==="contract_intel"){
                    // v95.4: Reveal exact demand for top expiring player (same as re-sign Intel button)
                    var expiring=(my.roster||[]).filter(function(p){return p.contract&&p.contract.years<=1;}).sort(function(a,b){return (b.ovr||0)-(a.ovr||0);});
                    if(expiring.length>0){
                      var tgtCI=expiring[0];
                      var ntCI2=teams.slice();var uCI2=ntCI2.find(function(t){return t.id===myId;});
                      if(uCI2){if(!uCI2.contractIntelRevealed)uCI2.contractIntelRevealed={};uCI2.contractIntelRevealed[tgtCI.id]=true;setTeams(ntCI2);doSave(ntCI2);}
                      var demandCI=Math.round(((tgtCI.ovr||70)/100)*25*10)/10;
                      addN("âœï¸ Contract Intel: "+tgtCI.name+" ("+tgtCI.pos+", "+tgtCI.ovr+" OVR) wants ~$"+demandCI+"M/yr â€” revealed in re-sign screen!","cyan");
                    } else {addN("âœï¸ Contract Intel: No expiring contracts to reveal.","cyan");}
                  } else if(item.id==="trade_intel"){
                    addN("ðŸ’± Trade Block Intel: rival GM asking price flagged in war room!","cyan");
                  } else {
                    addN(item.icon+" "+item.label+" complete!","cyan");
                  }
                }
                return <div style={{background:"rgba(34,211,238,0.04)",border:"1px solid rgba(34,211,238,0.2)",borderRadius:10,padding:"10px 12px",marginBottom:10}}>
                  <div style={{fontWeight:900,fontSize:11,color:T.cyan,letterSpacing:1,marginBottom:8}}>{"ðŸ’¸ SCOUT SPEND MENU â€” "+sp95+" PTS AVAILABLE"}</div>
                  {available.length===0 && <div style={{color:T.faint,fontSize:10}}>{"No spends available in current phase ("+sp95Phase+")."}</div>}
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                    {available.map(function(item){
                      var canAfford=sp95>=item.cost;
                      return <div key={item.id} style={{background:canAfford?"rgba(15,23,42,0.8)":"rgba(15,23,42,0.4)",border:"1px solid "+(canAfford?"rgba(34,211,238,0.25)":"rgba(255,255,255,0.06)"),borderRadius:7,padding:"7px 9px",opacity:canAfford?1:0.5}}>
                        <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:3}}>
                          <div style={{fontSize:14}}>{item.icon}</div>
                          <div style={{fontSize:10,fontWeight:900,color:canAfford?T.cyan:T.faint}}>{item.cost+" pts"}</div>
                        </div>
                        <div style={{fontSize:10,fontWeight:800,color:T.text,marginBottom:2}}>{item.label}</div>
                        <div style={{fontSize:8,color:T.dim,marginBottom:5,lineHeight:1.4}}>{item.desc}</div>
                        <button onClick={function(){handleSpend(item);}} disabled={!canAfford}
                          style={{width:"100%",fontSize:9,fontWeight:800,padding:"4px 0",borderRadius:4,border:"none",background:canAfford?"rgba(34,211,238,0.2)":"rgba(255,255,255,0.04)",color:canAfford?T.cyan:T.faint,cursor:canAfford?"pointer":"not-allowed"}}>
                          {canAfford?"â–¶ SPEND "+item.cost+" PTS":"NEED MORE PTS"}
                        </button>
                      </div>;
                    })}
                  </div>
                  {unavailable.length>0 && <div style={{marginTop:8,borderTop:"1px solid "+T.border,paddingTop:6}}>
                    <div style={{fontSize:9,color:T.faint,fontWeight:700,marginBottom:4}}>{"ðŸ”’ AVAILABLE OTHER PHASES"}</div>
                    <div style={{display:"flex",flexWrap:"wrap",gap:4}}>
                      {unavailable.map(function(item){return <span key={item.id} style={{fontSize:8,padding:"2px 6px",borderRadius:4,background:"rgba(255,255,255,0.03)",color:T.faint,border:"1px solid rgba(255,255,255,0.06)"}}>{item.icon+" "+item.label+" ("+item.cost+")"}</span>;})}
                    </div>
                  </div>}
                </div>;
              })()}

              {draftNarrative76 && <div style={assign({},cS,{borderColor:T.gold,background:"rgba(212,167,75,0.04)",marginBottom:8})}>
                <div style={{display:"flex",gap:8,alignItems:"center",marginBottom:6}}>
                  <span style={{fontSize:18}}>{draftNarrative76.theme.icon}</span>
                  <div>
                    <div style={{fontWeight:900,fontSize:13,color:T.gold}}>{draftNarrative76.theme.label}</div>
                    <div style={{fontSize:10,color:T.dim}}>{draftNarrative76.theme.desc}</div>
                  </div>
                </div>
                {draftNarrative76.storylines&&draftNarrative76.storylines.length>0 && <div style={{borderTop:"1px solid "+T.border,paddingTop:6}}>
                  <div style={{fontSize:9,fontWeight:700,color:T.faint,marginBottom:4}}>{"ðŸ“– TOP PROSPECT STORYLINES"}</div>
                  {draftNarrative76.storylines.map(function(sl,si){
                    return <div key={si} style={{padding:"4px 0",borderBottom:si<draftNarrative76.storylines.length-1?"1px solid "+T.border:"none"}}>
                      <div style={{display:"flex",gap:4,alignItems:"center",marginBottom:2}}>
                        <span style={{fontSize:10}}>{sl.icon}</span>
                        <span style={{fontWeight:700,fontSize:10,color:T.gold}}>{sl.prospectName}</span>
                        <span style={{fontSize:8,color:T.cyan}}>{sl.pos}</span>
                        <span style={{fontSize:8,color:T.faint,padding:"0 4px",borderRadius:3,background:"rgba(255,255,255,0.04)"}}>{sl.label}</span>
                      </div>
                      <div style={{fontSize:9,color:T.dim,fontStyle:"italic",paddingLeft:14}}>{sl.text}</div>
                      {sl.resolved && sl.resolution && <div style={{fontSize:9,color:sl.resolution.charAt(0)==="âœ…"?T.green:sl.resolution.charAt(0)==="âŒ"?T.red:T.orange,fontWeight:600,paddingLeft:14,marginTop:2}}>{sl.resolution}</div>}
                    </div>;
                  })}
                </div>}
              </div>}
              
              {draftPreview && (season.phase==="combine"||season.phase==="draft") && <div style={assign({},cS,{borderColor:"#818cf8",background:"rgba(129,140,248,0.03)",marginBottom:8})}>
                <div style={{fontWeight:900,fontSize:12,color:"#818cf8",marginBottom:6}}>{"ðŸ”® DRAFT CLASS PREVIEW"}</div>
                {draftPreview.topNeeds.length>0 && <div style={{fontSize:9,color:T.faint,marginBottom:4}}>
                  {"Your top needs: "+draftPreview.topNeeds.join(", ")}
                </div>}
                <div style={{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}}>{"BIG BOARD â€” Top 15"}</div>
                <div style={{maxHeight:140,overflow:"auto",marginBottom:6}}>
                  {draftPreview.bigBoard.map(function(p,pi){
                    var isNeedMatch=draftPreview.topNeeds.indexOf(p.pos)>=0;
                    return <div key={pi} style={{display:"flex",gap:6,alignItems:"center",padding:"2px 0",
                      borderBottom:pi<14?"1px solid "+T.border:"none",fontSize:9,
                      background:isNeedMatch?"rgba(52,211,153,0.06)":"transparent"}}>
                      <span style={{width:16,fontWeight:800,color:pi<3?T.gold:T.faint}}>{p.rank}</span>
                      <span style={{fontWeight:700,flex:1}}>{p.name}</span>
                      <span style={{color:T.cyan,fontSize:8}}>{p.pos}</span>
                      <span style={{fontWeight:700}}>{p.scouted?p.ovr:"?"}</span>
                      <span style={{fontSize:8,color:T.dim}}>{p.grade}</span>
                      {isNeedMatch && <span style={{fontSize:7,color:T.green,fontWeight:700}}>{"âœ… NEED"}</span>}
                    </div>;
                  })}
                </div>
                {(draftPreview.risers.length>0||draftPreview.fallers.length>0) && <div style={{display:"flex",gap:12}}>
                  {draftPreview.risers.length>0 && <div style={{flex:1}}>
                    <div style={{fontSize:8,fontWeight:700,color:T.green,marginBottom:2}}>{"ðŸ“ˆ RISERS"}</div>
                    {draftPreview.risers.map(function(r,ri){
                      return <div key={ri} style={{fontSize:8,color:T.dim}}>{r.name+" ("+r.pos+") â€” "+r.text}</div>;
                    })}
                  </div>}
                  {draftPreview.fallers.length>0 && <div style={{flex:1}}>
                    <div style={{fontSize:8,fontWeight:700,color:T.red,marginBottom:2}}>{"ðŸ“‰ FALLERS"}</div>
                    {draftPreview.fallers.map(function(f,fi){
                      return <div key={fi} style={{fontSize:8,color:T.dim}}>{f.name+" ("+f.pos+") â€” "+f.text}</div>;
                    })}
                  </div>}
                </div>}
                {draftPreview.needMatches.length>0 && <div style={{marginTop:4,borderTop:"1px solid "+T.border,paddingTop:4}}>
                  <div style={{fontSize:8,fontWeight:700,color:T.gold,marginBottom:2}}>{"ðŸŽ¯ BEST FITS FOR YOU"}</div>
                  {draftPreview.needMatches.map(function(nm,ni){
                    return <div key={ni} style={{fontSize:8,color:T.dim}}>{"#"+nm.rank+" "+nm.name+" ("+nm.pos+") "+nm.grade+" â€” "+nm.text}</div>;
                  })}
                </div>}
              </div>}
              
              <div style={{display:"flex",gap:3,marginBottom:6,flexWrap:"wrap"}}>
                {["ALL","QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"].map(function(pos){
                  var cnt=pos==="ALL"?dc.length:dc.filter(function(p){return p.pos===pos;}).length;
                  return <button key={pos} onClick={function(){setScoutPosF(pos);}} style={{background:scoutPosF===pos?T.gold:T.bg3,color:scoutPosF===pos?"#000":T.dim,border:"none",borderRadius:4,padding:"3px 7px",fontSize:10,cursor:"pointer",fontWeight:scoutPosF===pos?700:400}}>{pos+" ("+cnt+")"}</button>;
                })}
              </div>
              
              {(season.phase==="combine"||dc.length>0) && <div style={{background:T.bg2,padding:8,marginBottom:8,border:"1px solid "+T.cyan,borderRadius:8}}>
                <div style={{fontSize:10,color:T.dim,marginBottom:6}}>{"Batch Scout"+(scoutPosF!=="ALL"?" ("+scoutPosF+" only)":"")+" â€” spend points to scout all at once"}</div>
                <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                  <button style={bS((my.scoutPts||0)>=mCost&&unscouted.meas>0?T.cyan:T.bg3,(my.scoutPts||0)>=mCost&&unscouted.meas>0?"#000":T.faint)} onClick={function(){batchScout("measurables");}}>{"ðŸ“ All Measure ("+unscouted.meas+"Ã—"+SCOUT_COSTS86.measurables+"="+mCost+"pts)"}</button>
                  <button style={bS((my.scoutPts||0)>=iCost&&unscouted.int>0?T.cyan:T.bg3,(my.scoutPts||0)>=iCost&&unscouted.int>0?"#000":T.faint)} onClick={function(){batchScout("interview");}}>{"ðŸŽ¤ All Interview ("+unscouted.int+"Ã—"+SCOUT_COSTS86.interview+"="+iCost+"pts)"}</button>
                  <button style={bS((my.scoutPts||0)>=fCost&&unscouted.film>0?T.cyan:T.bg3,(my.scoutPts||0)>=fCost&&unscouted.film>0?"#000":T.faint)} onClick={function(){batchScout("film");}}>{"ðŸŽ¬ All Film ("+unscouted.film+"Ã—"+SCOUT_COSTS86.film+"="+fCost+"pts)"}</button>
                </div>
                <div style={{marginTop:8}}><button style={megaBlue} onClick={finishCombine}>ðŸ“‹ Done Scouting â€” Start Draft â†’</button></div>
              </div>}
              
              <div style={{display:"grid",gridTemplateColumns:"40px 1fr 70px 50px 36px 60px",gap:4,padding:"4px 0",borderBottom:"2px solid "+T.gold,marginBottom:4,fontSize:10,color:T.dim,fontWeight:700}}>
                <div style={{cursor:"pointer"}} onClick={function(){toggleSort("pos");}}>{"POS "+sortArrow("pos")}</div>
                <div style={{cursor:"pointer"}} onClick={function(){toggleSort("name");}}>{"NAME "+sortArrow("name")}</div>
                <div style={{cursor:"pointer",textAlign:"right"}} onClick={function(){toggleSort("hypeOvr");}}>{"PROJ "+sortArrow("hypeOvr")}</div>
                <div style={{cursor:"pointer",textAlign:"right"}} onClick={function(){toggleSort("ovr");}}>{"TRUE "+sortArrow("ovr")}</div>
                <div style={{cursor:"pointer",textAlign:"right"}} onClick={function(){toggleSort("age");}}>{"AGE "+sortArrow("age")}</div>
                <div style={{cursor:"pointer",textAlign:"center"}} onClick={function(){toggleSort("scouted");}}>{"INTEL "+sortArrow("scouted")}</div>
              </div>
              
              {(function(){var rh=season.phase==="combine"?72:48;return React.createElement(VirtualList,{items:sorted,rowHeight:rh,height:Math.min(500,sorted.length*rh+20),overscan:5,renderRow:function(p){
                var sc=typeof p.scouted==="object"?p.scouted:{measurables:false,interview:false,film:false};
                var isDone=sc.measurables&&sc.interview&&sc.film;
                var intelDots=(sc.measurables?"ðŸŸ¢":"âš«")+(sc.interview?"ðŸŸ¢":"âš«")+(sc.film?"ðŸŸ¢":"âš«");
                var pSc=p.scouting||{confidence:0,isRookie:true};
                var cTier2=confTier(pSc.confidence);var cCol=confColor(pSc.confidence);
                var confPct=Math.round(pSc.confidence*100);
                var rangeStr=p.scoutRange?(p.scoutRange.min+"-"+p.scoutRange.max):(p.hypeOvr?"~"+p.hypeOvr:"??");
                var scoutLvl60=sc.complete?10:((sc.measurables?3:0)+(sc.interview?3:0)+(sc.film?4:0));
                var fogRange60=SCOUT.getRange(p.ovr||p.hypeOvr||50,scoutLvl60);
                if(scoutLvl60>0&&scoutLvl60<10)rangeStr=fogRange60.display;
                return <div style={{borderBottom:"1px solid "+T.border,padding:"6px 4px",background:isDone?"rgba(34,211,238,0.05)":"transparent"}}>
                  <div style={{display:"grid",gridTemplateColumns:"40px 1fr 70px 50px 36px 60px",gap:4,fontSize:12,alignItems:"center"}}>
                    <span style={{color:T.gold,fontWeight:700}}>{p.pos}{p.archetype||PLAYER_ARCHETYPES.classify(p) ? " "+((p.archetype||PLAYER_ARCHETYPES.classify(p)).emoji||"") : ""}</span>
                    <span>
                      <span style={{fontWeight:600,cursor:"pointer"}} onClick={function(){setPlayerDetail(p);}}>{p.name}</span>
                      <span style={{fontSize:9,color:T.faint,marginLeft:4}}>{p.college?p.college.school:""}</span>
                      {isDone && p.devTrait==="superstar" && <span style={{marginLeft:3}}>{"ðŸŒŸ"}</span>}
                      {isDone && p.devTrait==="star" && <span style={{marginLeft:3}}>{"â­"}</span>}
                      {/* v95.2: Show ALL traits95 when interview-scouted (not just primary) */}
                      {sc.interview && (Array.isArray(p.traits95)&&p.traits95.length>0?p.traits95:[p.trait||"none"]).filter(function(tk){return tk&&tk!=="none"&&TRAITS[tk]&&TRAITS[tk].icon;}).map(function(tk,ti){var tO=TRAITS[tk];return <span key={ti} style={{marginLeft:ti===0?3:1,fontSize:11}} title={tO.name+": "+tO.desc}>{tO.icon}</span>;})}
                    </span>
                    <span style={{textAlign:"right",fontWeight:700,fontSize:11}}>
                      <span style={{color:cCol}}>{p.hypeOvr||"??"}</span>
                      <span style={{fontSize:8,color:T.faint,marginLeft:2}}>{"("+rangeStr+")"}</span>
                    </span>
                    <span style={assign({textAlign:"right",fontSize:10},sc.film?oS(p.hypeOvr):{color:cCol})}>{sc.film?(godMode?p.trueOvr:p.hypeOvr):cTier2.toUpperCase().charAt(0)}</span>
                    <span style={{textAlign:"right",color:T.dim}}>{p.age}</span>
                    <span style={{textAlign:"center",fontSize:9}}>
                      <span>{intelDots}</span>
                      <div style={{width:"100%",height:3,background:T.bg3,borderRadius:2,marginTop:2,overflow:"hidden"}}>
                        <div style={{width:confPct+"%",height:"100%",background:cCol,borderRadius:2}}></div>
                      </div>
                    </span>
                  </div>
                  {season.phase==="combine" && !isDone && <div style={{display:"flex",gap:3,marginTop:4}}>
                    {!sc.measurables && <button style={bS((my.scoutPts||0)>=SCOUT_COSTS86.measurables?T.bg3:T.bg2,(my.scoutPts||0)>=SCOUT_COSTS86.measurables?T.text:T.faint)} onClick={function(){runCombineTest(p.id,"measurables");}}>{"ðŸ“"+SCOUT_COSTS86.measurables}</button>}
                    {!sc.interview && <button style={bS((my.scoutPts||0)>=SCOUT_COSTS86.interview?T.bg3:T.bg2,(my.scoutPts||0)>=SCOUT_COSTS86.interview?T.text:T.faint)} onClick={function(){runCombineTest(p.id,"interview");}}>{"ðŸŽ¤"+SCOUT_COSTS86.interview}</button>}
                    {!sc.film && <button style={bS((my.scoutPts||0)>=SCOUT_COSTS86.film?T.bg3:T.bg2,(my.scoutPts||0)>=SCOUT_COSTS86.film?T.text:T.faint)} onClick={function(){runCombineTest(p.id,"film");}}>{"ðŸŽ¬"+SCOUT_COSTS86.film}</button>}
                  </div>}
                  {(sc.measurables||sc.interview||sc.film)&&!isDone && <div style={{fontSize:10,color:T.dim,marginTop:2}}>
                    {sc.measurables?("40: "+p.combine.forty+"s "+p.combine.bench+"rep "):""}
                    {sc.interview?("Trait: "+(TRAITS[p.trait]?TRAITS[p.trait].name:"Normal")+" "):""}
                    {sc.film?("Est: "+p.hypeOvr+" ("+rangeStr+")"+(p.isGem?" ðŸ’Ž":p.isBust?" âš ï¸":"")):""}
                  </div>}
                  {isDone && <div style={{fontSize:10,color:T.gold,marginTop:2,fontWeight:700}}>{"âœ… "+p.combine.forty+"s "+p.combine.bench+"rep | "+(TRAITS[p.trait]?TRAITS[p.trait].icon+" "+TRAITS[p.trait].name:"Normal")+" | Est:"+p.hypeOvr+" ("+rangeStr+")"+(p.isGem?" ðŸ’ŽGEM":p.isBust?" âš ï¸BUST":"")+" | Dev:"+p.devTrait+" | "+cTier2.toUpperCase()+" "+confPct+"%"}</div>}
                  
                  {sc.interview && p.character75 && <div style={{display:"flex",gap:6,alignItems:"center",marginTop:2,fontSize:9}}>
                    <span style={{padding:"1px 5px",borderRadius:4,background:"rgba(167,139,250,0.12)",color:T.purple,fontWeight:700}}>{p.character75.icon+" "+p.character75.label}</span>
                    {(function(){
                      var bs75=BUST_STEAL_CALC.calc(p);
                      var riskCol=bs75.bustPct>=40?T.red:bs75.bustPct>=25?"#f59e0b":T.green;
                      return <span style={{display:"flex",gap:4,alignItems:"center"}}>
                        <span style={{color:riskCol,fontWeight:600}}>{"âš ï¸"+bs75.bustPct+"%"}</span>
                        <span style={{color:T.cyan,fontWeight:600}}>{"ðŸ’Ž"+bs75.stealPct+"%"}</span>
                        <span style={{padding:"0 4px",borderRadius:3,background:riskCol+"20",color:riskCol,fontSize:8,fontWeight:700}}>{bs75.riskLabel}</span>
                      </span>;
                    })()}
                    {my && (function(){
                      var fit75=schemeFitGrade(p,my.schemeOff||"balanced",my.schemeDef||"4-3",my);
                      var fitCol=fit75.letter==="A"?T.green:fit75.letter==="B"?T.cyan:fit75.letter==="C"?T.dim:T.red;
                      return <span title={"Fit "+fit75.score+" | Base "+fit75.base+" | Spec "+(fit75.specialtyAdj>=0?"+":"")+fit75.specialtyAdj+" | Pers "+(fit75.personalityAdj>=0?"+":"")+fit75.personalityAdj+" | Sys "+(fit75.systemAdj>=0?"+":"")+fit75.systemAdj}
                        style={{padding:"0 4px",borderRadius:3,background:fitCol+"20",color:fitCol,fontSize:8,fontWeight:700}}>{"FIT:"+fit75.letter}</span>;
                    })()}
                  </div>}
                  
                  {(function(){
                    var pDoss=PROSPECT_DOSSIER.getEntry(prospectDB,p.id,season.year);
                    if(!pDoss||pDoss.conf<=0)return null;
                    return <div style={{marginTop:3,padding:"3px 6px",borderLeft:"2px solid "+T.purple+"60",fontSize:8}}>
                      <span style={{color:T.purple,fontWeight:700}}>{"ðŸ“‚ "+pDoss.conf+"% "}</span>
                      {pDoss.tells.slice(0,2).map(function(t,ti){
                        return <span key={ti} style={{color:T.cyan,marginRight:6}}>{"â†’ "+t}</span>;
                      })}
                      {pDoss.redFlags.slice(0,1).map(function(f,fi){
                        return <span key={fi} style={{color:T.red}}>{"âš ï¸ "+f}</span>;
                      })}
                      
                      {pDoss.claims&&pDoss.claims.length>0 && <div style={{display:"flex",gap:3,marginTop:2,flexWrap:"wrap"}}>
                        <span style={{fontSize:7,color:T.faint}}>{"Claims:"}</span>
                        {pDoss.claims.map(function(c,ci){return <span key={ci} style={{fontSize:7,padding:"0 4px",borderRadius:3,
                          background:"rgba(168,85,247,0.1)",color:T.purple,fontWeight:600}}>
                          {c.type+" ("+c.strength+"â˜…)"}
                        </span>;})}
                      </div>}
                      
                      {pDoss.verifyResult && (function(){
                        var vr=pDoss.verifyResult;
                        var vc=vr.status==="VERIFIED"?"#22c55e":vr.status==="MISREAD"?"#ef4444":vr.status==="INCOMPLETE"?"#94a3b8":"#f59e0b";
                        return <div style={{marginTop:2,display:"flex",gap:4,alignItems:"center",flexWrap:"wrap"}}>
                          <span style={{fontSize:7,padding:"1px 5px",borderRadius:4,fontWeight:700,background:vc+"20",color:vc}}>
                            {(vr.status==="VERIFIED"?"âœ…":vr.status==="MISREAD"?"âŒ":vr.status==="INCOMPLETE"?"â³":"âž¡ï¸")+" "+vr.status}
                          </span>
                          <span style={{fontSize:7,color:T.dim}}>
                            {vr.hits.length+"h â€¢ "+vr.misses.length+"m"+(vr.deltaConf>0?" â€¢ +"+vr.deltaConf:vr.deltaConf<0?" â€¢ "+vr.deltaConf:"")}
                          </span>
                          {vr.hits.map(function(h,hi){return <span key={"h"+hi} style={{fontSize:6,padding:"0 3px",borderRadius:3,background:"rgba(34,197,94,0.15)",color:"#22c55e",fontWeight:600}}>{h}</span>;})}
                          {vr.misses.map(function(m,mi){return <span key={"m"+mi} style={{fontSize:6,padding:"0 3px",borderRadius:3,background:"rgba(239,68,68,0.15)",color:"#ef4444",fontWeight:600}}>{m}</span>;})}
                        </div>;
                      })()}
                    </div>;
                  })()}
                </div>;
              }})})()}
              {sorted.length===0 && <div style={{color:T.faint,textAlign:"center",padding:20}}>{"No prospects at "+scoutPosF}</div>}
            </div>;
          })()}
          
          {tab==="roster" && (
            <div>
              
              <div style={assign({},cS,{padding:0,overflow:"hidden",marginBottom:8})}>
                <div style={{padding:"12px 14px",background:"rgba(212,167,75,0.04)",borderBottom:"1px solid "+T.border}}>
                  <div style={{display:"flex",gap:12,alignItems:"center"}}>
                    {React.createElement(TeamLogo,{team:my,size:36})}
                    <div style={{flex:1}}>
                      <div style={{fontWeight:900,fontSize:16}}>{my.city+" "+my.name}</div>
                      <div style={{fontSize:11,color:T.dim}}>{my.wins+"-"+my.losses+(season.phase==="cutDay"?" â€” âœ‚ï¸ Cut "+(my.roster.length-ROSTER_CAP)+" more":"")}</div>
                    </div>
                    
                    {(function(){
                      var rLim=season.phase==="preseason"||season.phase==="cutDay"?CAMP_CAP:ROSTER_CAP;
                      var rCount=my.roster.length;
                      var rFull=rCount>=rLim;var rOver=rCount>rLim;
                      var rColor=rOver?T.red:rFull?"#f59e0b":rCount>=rLim-3?"#f59e0b":T.green;
                      return <div style={{textAlign:"center",minWidth:60}}>
                        <div style={{fontSize:24,fontWeight:900,color:rColor,lineHeight:1}}>{rCount}</div>
                        <div style={{fontSize:9,fontWeight:700,color:rColor,opacity:0.8}}>{"/ "+rLim}</div>
                        <div style={{fontSize:7,color:T.faint,marginTop:1}}>{rOver?"OVER":rFull?"FULL":rLim-rCount+" open"}</div>
                      </div>;
                    })()}
                  </div>
                </div>
                
                {(function(){
                  var capUsed2=capCalc(my.roster);var dead2=my.deadCap||0;var theCap2=getSalaryCap(season.year);
                  var room2=Math.max(0,theCap2-capUsed2-dead2);var pctUsed=Math.min(100,(capUsed2+dead2)/theCap2*100);
                  var health=pctUsed<75?"Healthy":pctUsed<90?"Tight":"Over!";
                  var hColor=pctUsed<75?T.green:pctUsed<90?T.gold:T.red;
                  return <div style={{padding:"8px 14px"}}>
                    <div style={{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:4}}>
                      <span style={{color:T.dim}}>{"ðŸ’° Cap: $"+capUsed2.toFixed(1)+"M used"+(dead2>0?" + $"+dead2.toFixed(1)+"M dead":"")}</span>
                      <span style={{fontWeight:700,color:hColor}}>{"$"+room2.toFixed(1)+"M room â€” "+health}</span>
                    </div>
                    <div style={{height:8,background:T.bg3,borderRadius:4,overflow:"hidden",display:"flex"}}>
                      <div style={{width:(capUsed2/theCap2*100)+"%",height:"100%",background:hColor,borderRadius:"4px 0 0 4px"}}></div>
                      {dead2>0 && <div style={{width:(dead2/theCap2*100)+"%",height:"100%",background:T.red,opacity:0.5}}></div>}
                    </div>
                    <div style={{fontSize:8,color:T.faint,marginTop:2,textAlign:"right"}}>{"Cap: $"+theCap2+"M (Year "+(season.year)+")"}</div>
                  </div>;
                })()}
              </div>
              
              {season.phase==="cutDay"&&my&&(function(){
                var advisor974=buildCutAdvisor974(my.roster,ROSTER_CAP);
                if(!advisor974)return null;
                return <div style={{background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.3)",
                  borderRadius:8,padding:"10px 12px",marginBottom:8}}>
                  <div style={{fontSize:12,fontWeight:900,color:T.red,marginBottom:6}}>
                    {"âœ‚ï¸ CUT ADVISOR â€” "+advisor974.overBy+" player"+(advisor974.overBy>1?"s":"")+" over the limit"}
                  </div>
                  {advisor974.suggestions.map(function(s,si){
                    return <div key={si} style={{display:"flex",alignItems:"center",gap:6,padding:"4px 0",
                      borderBottom:si<advisor974.suggestions.length-1?"1px solid "+T.border:"none"}}>
                      <span style={{width:14,fontSize:10,fontWeight:700,color:si<advisor974.overBy?T.red:T.dim}}>
                        {si<advisor974.overBy?"âœ‚ï¸":"ðŸ”„"}
                      </span>
                      <span style={{fontWeight:700,fontSize:10,flex:1}}>{s.name}</span>
                      <span style={{fontSize:9,color:T.faint}}>{s.pos}</span>
                      <span style={{fontSize:9}}>{s.ovr+" OVR"}</span>
                      <span style={{fontSize:9,color:T.dim}}>{"$"+s.salary+"M"}</span>
                      {s.deadMoney>0&&<span style={{fontSize:8,color:T.red}}>{"â˜ ï¸$"+s.deadMoney+"M"}</span>}
                      <span style={{fontSize:8,color:T.orange,fontStyle:"italic"}}>{s.reason}</span>
                    </div>;
                  })}
                  <div style={{fontSize:8,color:T.faint,marginTop:6}}>
                    {"ðŸ’¡ Cut "+advisor974.overBy+" to reach "+ROSTER_CAP+"-man limit. âœ‚ï¸ = recommended cuts, ðŸ”„ = alternatives"}
                  </div>
                </div>;
              })()}
              
              {(function(){
                var fit33=calcTeamFit(my);
                var warns=getSchemeMismatchWarnings(my);
                var offScheme=OFF_SCHEMES.find(function(s){return s.id===my.schemeOff;})||{name:my.schemeOff};
                var defScheme=DEF_SCHEMES.find(function(s){return s.id===my.schemeDef;})||{name:my.schemeDef};
                var fColor=fit33.total>=80?T.green:fit33.total>=65?T.gold:T.red;
                return <div style={mS(S.card,{padding:10,marginBottom:8,borderColor:"rgba(103,232,249,0.15)"})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                    <div style={{fontSize:10,fontWeight:800,color:T.cyan}}>{"âš™ï¸ IDENTITY FIT"}</div>
                    <div style={{fontSize:10,color:T.dim}}>{offScheme.name+" / "+defScheme.name}</div>
                  </div>
                  <div style={{display:"flex",gap:8}}>
                    <div style={{flex:1,textAlign:"center",padding:4,borderRadius:6,background:T.bg3}}>
                      <div style={{fontSize:16,fontWeight:900,color:fit33.off>=80?T.green:fit33.off>=65?T.gold:T.red}}>{fit33.off}</div>
                      <div style={{fontSize:8,color:T.dim}}>{"Offense"}</div>
                    </div>
                    <div style={{flex:1,textAlign:"center",padding:4,borderRadius:6,background:T.bg3}}>
                      <div style={{fontSize:16,fontWeight:900,color:fit33.def>=80?T.green:fit33.def>=65?T.gold:T.red}}>{fit33.def}</div>
                      <div style={{fontSize:8,color:T.dim}}>{"Defense"}</div>
                    </div>
                    <div style={{flex:1,textAlign:"center",padding:4,borderRadius:6,background:T.bg3,borderColor:fColor}}>
                      <div style={{fontSize:16,fontWeight:900,color:fColor}}>{fit33.total}</div>
                      <div style={{fontSize:8,color:T.dim}}>{"Overall"}</div>
                    </div>
                  </div>
                  <div style={{marginTop:4,fontSize:8,color:T.faint}}>{"Score = Scheme + Coordinator Specialty + Personality + System Knowledge"}</div>
                  {my.fitTrend86&&my.fitTrend86.length>1 && (function(){
                    var t8=my.fitTrend86.slice(-8);
                    var d=t8.length>=2?(t8[t8.length-1]-t8[0]):0;
                    var dCol=d>0?T.green:d<0?T.red:T.dim;
                    return <div style={{marginTop:6,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <div style={{fontSize:8,color:T.faint,fontWeight:700}}>{"FIT TREND (last "+t8.length+" wk)"}</div>
                      <div style={{display:"flex",alignItems:"center",gap:6}}>
                        {React.createElement(Sparkline,{data:t8,width:74,height:14})}
                        <span style={{fontSize:8,fontWeight:800,color:dCol}}>{(d>0?"+":"")+d}</span>
                      </div>
                    </div>;
                  })()}
                  {warns.length>0 && <div style={{marginTop:6,fontSize:9,color:T.orange}}>
                    {"âš ï¸ Mismatches: "+warns.slice(0,3).map(function(w){return w.player.name+" ("+w.grade+")";}).join(", ")+(warns.length>3?" +"+(warns.length-3)+" more":"")}
                  </div>}
                </div>;
              })()}
              
              <div style={mS(S.card,{padding:10,marginBottom:8,borderColor:"rgba(251,191,36,0.12)"})}>
                <div style={{fontSize:10,fontWeight:800,color:T.gold,marginBottom:6}}>{"ðŸ”® CHANGE STRATEGIC SCHEME"}</div>
                <div style={{display:"flex",gap:8,marginBottom:6}}>
                  <div style={{flex:1}}>
                    <div style={{fontSize:9,color:T.dim,marginBottom:4}}>{"Offense"}</div>
                    <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                      {OFF_SCHEMES.map(function(sc){var isSel=my.schemeOff===sc.id;return (
                        <div key={sc.id} onClick={function(){if(!isSel)previewSchemeChange("off",sc.id);}}
                          style={{padding:"4px 8px",borderRadius:4,cursor:isSel?"default":"pointer",fontSize:10,fontWeight:700,
                            background:isSel?"rgba(212,167,75,0.15)":T.bg3,
                            border:isSel?"1px solid "+T.gold:"1px solid "+T.border,
                            color:isSel?T.gold:T.text,opacity:isSel?1:0.8}}>
                          {sc.name}{isSel?" âœ“":""}
                        </div>);})}
                    </div>
                  </div>
                  <div style={{flex:1}}>
                    <div style={{fontSize:9,color:T.dim,marginBottom:4}}>{"Defense"}</div>
                    <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                      {DEF_SCHEMES.map(function(sc){var isSel=my.schemeDef===sc.id;return (
                        <div key={sc.id} onClick={function(){if(!isSel)previewSchemeChange("def",sc.id);}}
                          style={{padding:"4px 8px",borderRadius:4,cursor:isSel?"default":"pointer",fontSize:10,fontWeight:700,
                            background:isSel?"rgba(96,165,250,0.15)":T.bg3,
                            border:isSel?"1px solid "+T.cyan:"1px solid "+T.border,
                            color:isSel?T.cyan:T.text,opacity:isSel?1:0.8}}>
                          {sc.name}{isSel?" âœ“":""}
                        </div>);})}
                    </div>
                  </div>
                </div>
                <div style={{fontSize:9,color:T.faint}}>{"âš ï¸ Changing scheme costs ~40% systemFit on affected unit. Keep stable 3+ weeks to recover."}</div>
              </div>
              
              <div style={{display:"flex",gap:4,overflowX:"auto",marginBottom:8,paddingBottom:4}}>
                {["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"].map(function(pos){
                  var grp=my.roster.filter(function(p){return p.pos===pos;});
                  var strt=grp.filter(function(p){return p.isStarter;});
                  // v93.18: For K/P (1-starter spots), if no isStarter flagged use best player so it never shows "â€”"
                  if(strt.length===0&&grp.length>0)strt=[grp.slice().sort(function(a,b){return b.ovr-a.ovr;})[0]];
                  var avg2=strt.length>0?Math.round(avg(strt,function(p){return p.ovr;})):0;
                  var inj=grp.filter(function(p){return p.injury&&p.injury.games>0;}).length;
                  var gColor=avg2>=80?T.green:avg2>=70?T.gold:avg2>=60?T.orange:T.red;
                  return <div key={pos} onClick={function(){setPosF(posF===pos?"ALL":pos);}}
                    style={{minWidth:60,textAlign:"center",padding:"6px 4px",borderRadius:6,cursor:"pointer",
                      background:posF===pos?"rgba(212,167,75,0.12)":T.bg3,
                      border:"2px solid "+(posF===pos?T.gold:"transparent")}}>
                    <div style={{fontSize:18,fontWeight:900,color:gColor}}>{avg2||"â€”"}</div>
                    <div style={{fontSize:10,fontWeight:700,color:posF===pos?T.gold:T.text}}>{pos}</div>
                    <div style={{fontSize:8,color:T.faint}}>{grp.length+"p"+(inj>0?" "+inj+"ðŸ¤•":"")}</div>
                  </div>;
                })}
              </div>
              
              {(season.phase==="preseason"||season.phase==="cutDay")&&selPlayers.length>0 && (
                <div style={{background:"rgba(239,68,68,0.1)",border:"1px solid "+T.red,borderRadius:6,padding:8,marginBottom:8,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                  <span style={{color:T.red,fontWeight:700,fontSize:12}}>{selPlayers.length+" selected"}</span>
                  <div style={{display:"flex",gap:6}}>
                    <button style={bS(T.red,"#fff")} onClick={cutSelected}>{"âœ‚ï¸ Cut All Selected"}</button>
                    <button style={bS(T.bg3,T.dim)} onClick={function(){setSelPlayers([]);}}>Clear</button>
                  </div>
                </div>
              )}
              
              <div style={{display:"flex",gap:4,alignItems:"center",marginBottom:6,flexWrap:"wrap"}}>
                <span style={{fontSize:9,color:T.faint,marginRight:2}}>{"Sort:"}</span>
                {["ovr","age","salary","morale","trait","pot"].map(function(sk){
                  return React.createElement("button",{key:sk,style:mS(S.btn,S.btnSmall,{
                    background:rSort===sk?"rgba(251,191,36,0.15)":"rgba(255,255,255,0.04)",
                    color:rSort===sk?T.gold:T.faint,border:"1px solid "+(rSort===sk?"rgba(251,191,36,0.3)":T.border),
                    padding:"3px 8px",fontSize:9}),
                    onClick:function(){setRSort(sk);}},sk.toUpperCase());
                })}
                <span style={{marginLeft:"auto"}}/>
                <button style={mS(S.btn,S.btnSmall,{padding:"3px 8px",fontSize:9,background:"rgba(34,211,238,0.15)",color:T.cyan,border:"1px solid rgba(34,211,238,0.3)"})}>
                  {"â–¦ Full View"}
                </button>
              </div>
              
              {(function(){
                var sortedRoster=(posF==="ALL"?my.roster:my.roster.filter(function(p){return p.pos===posF;})).slice().sort(function(a,b){
                  var aS=a.isStarter?1000:0;var bS2=b.isStarter?1000:0;
                  if(rSort==="age")return(aS>bS2?-1:aS<bS2?1:0)||a.age-b.age;
                  if(rSort==="salary")return(bS2-aS)||(b.contract?b.contract.salary:0)-(a.contract?a.contract.salary:0);
                  if(rSort==="morale")return(bS2-aS)-(aS-bS2)||(b.morale||70)-(a.morale||70);
                  if(rSort==="pot")return(bS2-aS)||b.pot-a.pot;
                  if(rSort==="trait"){var ta=TRAITS[a.trait||"none"]?1:0;var tb=TRAITS[b.trait||"none"]?1:0;return(bS2-aS)||tb-ta||b.ovr-a.ovr;}
                  return(bS2-aS)||b.ovr-a.ovr;
                });
                return React.createElement(VirtualList,{items:sortedRoster,rowHeight:70,height:Math.min(560,sortedRoster.length*70+10),overscan:5,renderRow:function(p){
                var trObj=TRAITS[p.trait||"none"]||TRAITS.none;
                var isChecked=selPlayers.indexOf(p.id)>=0;
                var phase=getAgingPhase(p);
                var isInj=p.injury&&p.injury.games>0;
                var moraleColor=(p.morale||70)>=80?T.green:(p.morale||70)>=55?T.gold:(p.morale||70)>=35?T.orange:T.red;
                var statLine=p.pos==="QB"?(p.stats.passYds||0)+"yd "+(p.stats.passTD||0)+"TD"
                  :p.pos==="RB"?(p.stats.rushYds||0)+"yd "+(p.stats.rushTD||0)+"TD"
                  :(p.pos==="WR"||p.pos==="TE")?(p.stats.rec||0)+"rec "+(p.stats.recYds||0)+"yd"
                  :(["DL","LB"].indexOf(p.pos)>=0)?(p.stats.sacks||0)+"sk "+(p.stats.tackles||0)+"tkl"
                  :(["CB","S"].indexOf(p.pos)>=0)?(p.stats.defINT||0)+"INT "+(p.stats.tackles||0)+"tkl"
                  :p.pos==="K"?(p.stats.fgM||0)+"/"+(p.stats.fgA||0)+"FG"
                  :p.pos==="P"?(p.stats.punts||0)+"pnt "+(p.stats.punts>0?Math.round((p.stats.puntYds||0)/p.stats.punts):"0")+"avg"
                  :(p.stats.snaps||0)+"snp";
                return <div style={assign({},cS,{padding:0,overflow:"hidden",opacity:isInj?0.7:1,marginBottom:4,
                  borderColor:isChecked?T.red:p.isStarter?T.gold:p.onTradeBlock?T.red:T.border,
                  borderLeft:"3px solid "+(p.isStarter?T.gold:p.onTradeBlock?T.red:T.border)})}>
                  <div style={{display:"flex",alignItems:"center",gap:8,padding:"8px 10px"}}>
                    {(season.phase==="preseason"||season.phase==="cutDay") && (
                      <input type="checkbox" checked={isChecked} onChange={function(){setSelPlayers(function(prev){return isChecked?prev.filter(function(x){return x!==p.id;}):prev.concat([p.id]);});}} style={{cursor:"pointer"}}/>
                    )}
                    <div style={{position:"relative",cursor:"pointer"}} onClick={function(){toggleStarter(p.id);}}>
                      {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:36,age:p.age})}
                      <div style={{position:"absolute",top:-4,right:-4,fontSize:12}}>{p.isStarter?"â­":""}</div>
                    </div>
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{display:"flex",alignItems:"center",gap:4,flexWrap:"wrap"}}>
                        <span style={{color:T.gold,fontWeight:700,fontSize:11}}>{p.pos}</span>
                        <span style={{fontWeight:700,fontSize:12,cursor:"pointer",textDecoration:"underline",textDecorationColor:T.border}} onClick={function(){setPlayerDetail(p);}}>{p.name}</span>
                        {/* v95: Show up to 3 trait icons from traits95 array (ChatGPT UX pattern) */}
                        {(p.traits95||[p.trait]).filter(function(tk){return tk&&tk!=="none"&&TRAITS[tk]&&TRAITS[tk].icon;}).slice(0,3).map(function(tk,ti){var tObj95=TRAITS[tk];return <span key={ti} style={{fontSize:11}} title={tObj95.name+": "+(tObj95.desc||"")}>{tObj95.icon}</span>;})}
                        {p.devTrait==="superstar" && <span style={{fontSize:10}}>{"ðŸŒŸ"}</span>}
                        {p.devTrait==="star" && <span style={{fontSize:10}}>{"â­"}</span>}
                        <span style={{fontSize:8,padding:"1px 5px",borderRadius:8,background:"rgba(255,255,255,0.04)",color:moraleColor,fontWeight:700}}>{"M"+(p.morale||70)}</span>
                        {(function(){var sfNew=schemeFitGrade(p,my.schemeOff,my.schemeDef,my);
                          var sfC=sfNew.letter==="A"?T.green:sfNew.letter==="B"?T.cyan:sfNew.letter==="C"?T.dim:sfNew.letter==="D"?T.orange:T.red;
                          return <span title={"Identity Fit: "+sfNew.score+" ("+sfNew.letter+") | Base "+sfNew.base+" | Spec "+(sfNew.specialtyAdj>=0?"+":"")+sfNew.specialtyAdj+" | Pers "+(sfNew.personalityAdj>=0?"+":"")+sfNew.personalityAdj+" | Sys "+(sfNew.systemAdj>=0?"+":"")+sfNew.systemAdj}
                            style={{fontSize:8,padding:"1px 5px",borderRadius:6,
                            background:sfNew.letter==="A"?"rgba(52,211,153,0.12)":sfNew.letter==="F"?"rgba(239,68,68,0.12)":"rgba(255,255,255,0.04)",
                            color:sfC,fontWeight:800,letterSpacing:0.5}}>{sfNew.letter}</span>;
                        })()}
                        
                        {p.role && ROLE_DEFS[p.pos] && (function(){
                          var rd=ROLE_DEFS[p.pos].find(function(r){return r.id===p.role;});
                          return rd?<span title={rd.label+" ("+rd.snapPct+"% snaps)"} style={{fontSize:7,padding:"1px 4px",borderRadius:4,
                            background:"rgba(167,139,250,0.1)",color:T.purple,fontWeight:700}}>{rd.label.split(" ")[0]}</span>:null;
                        })()}
                        {isInj && <span style={mS(S.badge,S.badgeRed,{fontSize:8})}>{"ðŸ¤•"+p.injury.games+"wk"}</span>}
                        {p.onTradeBlock && <span style={mS(S.badge,S.badgeRed,{fontSize:8})}>{"ðŸ“¢ BLOCK"}</span>}
                        
                        {defMoments80&&defMoments80[p.id]&&defMoments80[p.id].slice(-3).map(function(badge80,bi80){return React.createElement("span",{key:"dm"+bi80,title:badge80.text,style:{fontSize:12,cursor:"default",filter:"drop-shadow(0 0 3px rgba(255,215,0,0.7))"}},badge80.icon);})}
                        
                        {breakouts80&&breakouts80.some(function(bc){return bc.playerId===p.id&&!bc.resolved;})&&React.createElement("span",{style:{fontSize:8,padding:"1px 4px",borderRadius:4,background:"rgba(251,191,36,0.2)",color:T.gold,fontWeight:700,border:"1px solid "+T.gold+"66"}},"ðŸ“ˆ WATCH")}
                        {p._arcState&&(function(){
                          var arcCfg={breakout:{emoji:"ðŸš€",c:T.green},elite:{emoji:"ðŸ‘‘",c:T.gold},slump:{emoji:"ðŸ“‰",c:T.red},comeback:{emoji:"ðŸ’ª",c:T.blue},decline:{emoji:"â³",c:T.dim},holdout:{emoji:"âœŠ",c:T.orange},redemption:{emoji:"ðŸ”¥",c:T.purple},mentor:{emoji:"ðŸŽ“",c:T.cyan},swan_song:{emoji:"ðŸ•Šï¸",c:T.gold}};
                          var cfg=arcCfg[p._arcState];if(!cfg)return null;
                          return React.createElement("span",{title:"Story Arc: "+p._arcState,style:{fontSize:8,padding:"1px 4px",borderRadius:4,background:cfg.c+"22",color:cfg.c,fontWeight:700,border:"1px solid "+cfg.c+"44"}},cfg.emoji+" "+p._arcState.replace("_"," ").toUpperCase());
                        })()}
                      </div>
                      <div style={{display:"flex",gap:8,fontSize:10,color:T.dim,marginTop:2}}>
                        <span style={{color:phase.color}}>{p.age+" "+phase.label}</span>
                        <span>{"$"+p.contract.salary+"M/"+p.contract.years+"yr"}</span>
                        <span style={{color:T.faint}}>{statLine}</span>
                      </div>
                    </div>
                    <div style={{display:"flex",alignItems:"center",gap:6}}>
                      {React.createElement(Sparkline,{data:p.gameLog||[],width:40,height:14})}
                      <div style={{textAlign:"center"}}>
                        <div style={assign({fontSize:18,fontWeight:900},oS(p.ovr))}>{p.ovr}</div>
                        <div style={{fontSize:7,color:T.faint}}>{"POT "+p.pot}</div>
                      </div>
                      {p.pff ? <div style={{textAlign:"center",minWidth:28}}>
                        <div style={{fontSize:12,fontWeight:800,color:p.pff>=90?"#10b981":p.pff>=80?"#22d3ee":p.pff>=70?"#fbbf24":p.pff>=60?"#9ca3af":"#ef4444"}}>{p.pff}</div>
                        <div style={{fontSize:6,color:p.pff>=70?"#fbbf24":"#9ca3af",fontWeight:700}}>{"MFDF"}</div>
                      </div>:null}
                    </div>
                    <div style={{display:"flex",flexDirection:"column",gap:3}}>
                      <button onClick={function(){cutPlayer(p.id);}} style={assign({},bS(T.bg3,T.red),{padding:"3px 6px",fontSize:9})}>{"âœ‚ï¸"}</button>
                      <button onClick={function(){moveToPS(p.id);}} style={assign({},bS(T.bg3,T.cyan),{padding:"3px 6px",fontSize:9})} title={"Practice Squad"}>{"â†“PS"}</button>
                      <button onClick={function(){toggleTradeBlock(p.id);}} style={assign({},bS(p.onTradeBlock?T.red:T.bg3,p.onTradeBlock?"#fff":T.faint),{padding:"3px 6px",fontSize:9})}>{"ðŸ“¢"}</button>
                      {p.ovr>=CAPTAIN_RULES.eligibleMinOvr && <button onClick={function(){
                        if(captainId===p.id){setCaptainId(null);addN("â­ "+p.name+" removed as captain","orange");}
                        else{setCaptainId(p.id);setCaptMoments(function(prev){return prev.season===season.year?prev:{season:season.year,used:0,log:[]};});addN("â­ "+p.name+" named TEAM CAPTAIN!","gold");}
                      }} style={assign({},bS(captainId===p.id?T.gold:T.bg3,captainId===p.id?"#000":T.faint),{padding:"3px 6px",fontSize:9})} title={captainId===p.id?"Remove Captain":"Make Captain"}>{captainId===p.id?"â­":"â˜†"}</button>}
                    </div>
                    {godMode && <div style={{display:"flex",flexDirection:"column",gap:2}}>
                      <button onClick={function(){setPlayerDetail(p);}} style={assign({},bS(T.purple,"#fff"),{padding:"2px 5px",fontSize:8})}>{"âš¡"}</button>
                    </div>}
                  </div>
                </div>;
              }});
              })()}
              
              <div style={assign({},cS,{marginTop:12,padding:0,overflow:"hidden",borderColor:T.cyan})}>
                <div style={{padding:"8px 12px",background:"rgba(103,232,249,0.04)",borderBottom:"1px solid "+T.border}}>
                  <div style={{display:"flex",justifyContent:"space-between"}}>
                    <div style={{fontWeight:700,color:T.cyan}}>{"ðŸ“‹ Practice Squad ("+(my.practiceSquad?my.practiceSquad.length:0)+"/"+PS_CAP+")"}</div>
                    <div style={{fontSize:9,color:T.faint}}>{"No cap hit â€¢ AI can poach high-pot players"}</div>
                  </div>
                </div>
                <div style={{padding:"6px 10px"}}>
                {(!my.practiceSquad||!my.practiceSquad.length)?<div style={{color:T.faint,fontSize:11,textAlign:"center",padding:8}}>{"Empty. Use â†“PS buttons to stash players."}</div>:
                (my.practiceSquad||[]).map(function(p){
                  var trObj=TRAITS[p.trait||"none"]||TRAITS.none;
                  return <div key={p.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:"1px solid "+T.border}}>
                    <div style={{display:"flex",gap:6,alignItems:"center"}}>
                      {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:24,age:p.age})}
                      <div>
                        <div style={{display:"flex",gap:4,alignItems:"center"}}>
                          <span style={{color:T.gold,fontWeight:700,fontSize:10}}>{p.pos}</span>
                          <span style={{fontWeight:600,fontSize:11}}>{p.name}</span>
                          {trObj.icon && <span style={{fontSize:10}}>{trObj.icon}</span>}
                          {p.devTrait==="superstar" && <span style={{fontSize:9}}>{"ðŸŒŸ"}</span>}
                          {p.devTrait==="star" && <span style={{fontSize:9}}>{"â­"}</span>}
                        </div>
                        <div style={{fontSize:9,color:T.dim}}>{p.ovr+" OVR | POT "+p.pot}</div>
                      </div>
                    </div>
                    <button onClick={function(){promoteFromPS(p.id);}} style={bS(T.green,"#000")}>{"â¬†ï¸ Promote"}</button>
                  </div>;})}
                </div>
              </div>
            </div>
          )}
          
          {tab==="depth" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={cS}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <div style={{fontWeight:700,color:T.gold}}>{"ðŸ“‹ Depth Chart"}</div>
                  <div style={{display:"flex",gap:4}}>
                    <button onClick={function(){setDpShowAttr(!dpShowAttr);}} style={mS(S.btn,S.btnSmall,dpShowAttr?S.btnPrimary:S.btnGhost,{padding:"3px 8px",fontSize:9})}>{dpShowAttr?"Hide Ratings":"Show Ratings"}</button>
                    {dpShowAttr && <div style={{display:"flex",gap:2,marginLeft:4}}>
                      {(function(){
                        var catSource=POS_DEF[dpView];
                        var cats=catSource?["CORE","ALL"].concat(Object.keys(catSource.cat||{})):["CORE","ALL","PHY","MENTAL"];
                        return cats.map(function(cat){
                          return <button key={cat} onClick={function(){setDpRatCat(cat);}}
                            style={{background:dpRatCat===cat?T.purple:"transparent",color:dpRatCat===cat?"#fff":T.dim,border:"1px solid "+(dpRatCat===cat?T.purple:T.border),
                              borderRadius:3,padding:"2px 5px",fontSize:7,cursor:"pointer",fontWeight:dpRatCat===cat?700:400}}>{cat}</button>;
                        });
                      })()}
                    </div>}
                    <button onClick={autoSortDepth} style={mS(S.btn,S.btnSmall,{padding:"3px 8px",fontSize:9,background:"rgba(34,197,94,0.15)",color:T.green,border:"1px solid rgba(34,197,94,0.3)"})}>{"âš¡ Auto-Optimize"}</button>
                  </div>
                </div>
                <div style={{display:"flex",gap:3,marginBottom:6,flexWrap:"wrap"}}>
                  {["ALL","OFF","DEF"].concat(["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"]).map(function(dg){
                    return <button key={dg} onClick={function(){setDpView(dg);}} style={bS(dpView===dg?T.gold:T.bg3,dpView===dg?"#000":T.dim)}>{dg}</button>;
                  })}
                </div>
                
                {dpShowAttr && (function(){
                  var getVisibleRatings=function(pos2){
                    var def2=POS_DEF[pos2];if(!def2)return[];
                    if(dpRatCat==="CORE")return def2.r.slice(0,5);// Original 5 core ratings
                    if(dpRatCat==="ALL")return def2.r;
                    if(def2.cat&&def2.cat[dpRatCat])return def2.cat[dpRatCat];
                    return def2.r.slice(0,8);// Fallback
                  };
                  var posOrder2=dpView==="OFF"?["QB","RB","WR","TE","OL"]:dpView==="DEF"?["DL","LB","CB","S"]:dpView==="ALL"?["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"]:[dpView];
                  var allAttrs=["ovr","pot","age","salary"];
                  posOrder2.forEach(function(pos2){getVisibleRatings(pos2).forEach(function(r){if(allAttrs.indexOf(r)<0)allAttrs.push(r);});});
                  return <div style={{display:"flex",gap:2,flexWrap:"wrap",marginBottom:6}}>
                    <span style={{fontSize:9,color:T.faint,lineHeight:"22px"}}>{"Sort by:"}</span>
                    {allAttrs.map(function(attr){
                      var label=attr==="ovr"?"OVR":attr==="pot"?"POT":attr==="age"?"Age":attr==="salary"?"$":(RATING_LABELS[attr]||attr.slice(0,4));
                      return <button key={attr} onClick={function(){setDpSortAttr(attr);}} style={{background:dpSortAttr===attr?T.gold:T.bg3,color:dpSortAttr===attr?"#000":T.dim,border:"none",borderRadius:3,padding:"2px 5px",fontSize:8,cursor:"pointer",fontWeight:dpSortAttr===attr?700:400}}>{label}</button>;
                    })}
                  </div>;
                })()}
              </div>
              {(function(){
                var posOrder=dpView==="OFF"?["QB","RB","WR","TE","OL"]:dpView==="DEF"?["DL","LB","CB","S"]:dpView==="ALL"?["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"]:[dpView];
                return posOrder.map(function(pos){
                  var def=POS_DEF[pos];
                  var visRat=def?(dpRatCat==="CORE"?def.r.slice(0,5):dpRatCat==="ALL"?def.r:def.cat&&def.cat[dpRatCat]?def.cat[dpRatCat]:def.r.slice(0,8)):[];
                  var group=my.roster.filter(function(p){return p.pos===pos;}).sort(function(a,b){
                    if(dpSortAttr==="ovr") return (b.isStarter?1000:0)+b.ovr-((a.isStarter?1000:0)+a.ovr);
                    if(dpSortAttr==="pot") return b.pot-a.pot;
                    if(dpSortAttr==="age") return a.age-b.age;
                    if(dpSortAttr==="salary") return (b.contract?b.contract.salary:0)-(a.contract?a.contract.salary:0);
                    return (b.ratings[dpSortAttr]||0)-(a.ratings[dpSortAttr]||0);
                  });
                  if(!group.length) return null;
                  var starterCount=pos==="OL"?5:pos==="WR"?3:pos==="DL"?4:pos==="LB"?3:pos==="CB"?3:pos==="S"?2:1;
                  var catNames=def&&def.cat?Object.keys(def.cat).join(" â€¢ "):"";
                  return <div key={pos} style={mS(S.card,{padding:10})}>
                    <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
                      <div style={{fontWeight:800,color:T.gold,fontSize:13}}>{pos+" ("+ group.length+")"}</div>
                      <div style={{fontSize:9,color:T.faint}}>{"Need "+starterCount+" | ðŸ“Š "+def.r.length+" ratings | "+catNames}</div>
                    </div>
                    
                    {dpShowAttr && def && <div style={{display:"flex",alignItems:"center",gap:4,padding:"2px 6px",marginBottom:4,borderBottom:"1px solid "+T.border}}>
                      <div style={{width:20}}></div>
                      <div style={{flex:1,minWidth:80,fontSize:8,color:T.faint,fontWeight:700}}>{"Player"}</div>
                      <div style={{width:32,textAlign:"center",fontSize:8,color:T.gold,fontWeight:700}}>{"OVR"}</div>
                      <div style={{width:32,textAlign:"center",fontSize:8,color:T.cyan,fontWeight:700}}>{"POT"}</div>
                      {visRat.map(function(r){return <div key={r} style={{width:30,textAlign:"center",fontSize:7,color:dpSortAttr===r?T.gold:T.faint,fontWeight:dpSortAttr===r?700:400,cursor:"pointer"}}
                        onClick={function(){setDpSortAttr(r);}}>{RATING_LABELS[r]||r.slice(0,4)}</div>;})}
                      <div style={{width:35,textAlign:"center",fontSize:8,color:T.faint}}>{"Age"}</div>
                      <div style={{width:40,textAlign:"center",fontSize:8,color:T.faint}}>{"Salary"}</div>
                      <div style={{width:52}}></div>
                    </div>}
                    {group.map(function(p,idx){
                      var trObj=TRAITS[p.trait||"none"]||TRAITS.none;
                      var isStr=p.isStarter;
                      var isInj=p.injury&&p.injury.games>0;
                      return <div key={p.id} style={{display:"flex",alignItems:"center",gap:4,padding:"4px 6px",marginBottom:2,
                        background:isStr?"rgba(212,167,75,0.08)":isInj?"rgba(239,68,68,0.04)":"transparent",borderRadius:4,borderLeft:"3px solid "+(isStr?T.gold:isInj?T.red:T.border),
                        cursor:"pointer"}} onClick={function(){setPlayerDetail(p);}}>
                        <div style={{width:20,fontSize:10,color:isStr?T.gold:T.faint,fontWeight:700,textAlign:"center"}}>{idx+1}</div>
                        <div style={{flex:1,minWidth:80}}>
                          <div style={{fontWeight:600,fontSize:11,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>
                            {p.name}{isInj?" ðŸ¤•"+p.injury.games:""}
                            {trObj.icon?" "+trObj.icon:""}
                            {p.devTrait==="superstar"?" ðŸŒŸ":p.devTrait==="star"?" â­":""}
                          </div>
                          {!dpShowAttr && <div style={{fontSize:9,color:T.dim}}>
                            {"OVR "+p.ovr+" | POT "+p.pot+" | $"+p.contract.salary+"M/"+p.contract.years+"yr | Age "+p.age}
                            {p.morale<50?" | ðŸ˜¤"+p.morale:""}
                          </div>}
                        </div>
                        
                        {dpShowAttr && def && React.createElement(React.Fragment,null,
                          React.createElement("div",{style:{width:32,textAlign:"center",fontWeight:800,fontSize:11,color:p.ovr>=80?T.green:p.ovr>=65?T.gold:T.red}},p.ovr),
                          React.createElement("div",{style:{width:32,textAlign:"center",fontWeight:700,fontSize:10,color:T.cyan}},p.pot),
                          visRat.map(function(r){var val=p.ratings[r]||50;
                            return React.createElement("div",{key:r,style:{width:30,textAlign:"center",fontSize:10,fontWeight:600,
                              color:val>=80?T.green:val>=65?T.gold:val>=50?T.orange:T.red}},val);
                          }),
                          React.createElement("div",{style:{width:35,textAlign:"center",fontSize:10,color:p.age<=24?T.green:p.age<=28?T.text:p.age<=31?T.orange:T.red}},p.age),
                          React.createElement("div",{style:{width:40,textAlign:"center",fontSize:9,color:T.dim}},("$"+p.contract.salary+"M"))
                        )}
                        <div style={{display:"flex",gap:2,flexShrink:0}}>
                          <button onClick={function(e){e.stopPropagation();promotePlayer(p.id);}} disabled={idx===0} style={mS(S.btn,S.btnSmall,S.btnGhost,{padding:"3px 6px",opacity:idx===0?0.3:1})}>{"â¬†"}</button>
                          <button onClick={function(e){e.stopPropagation();demotePlayer(p.id);}} disabled={idx>=group.length-1} style={mS(S.btn,S.btnSmall,S.btnGhost,{padding:"3px 6px",opacity:idx>=group.length-1?0.3:1})}>{"â¬‡"}</button>
                        </div>
                      </div>;
                    })}
                  </div>;
                });
              })()}
              
              {(function(){
                if(!my)return null;
                var alerts74=[];
                var roster74=my.roster;
                Object.keys(STARTER_COUNTS).forEach(function(pos){
                  var ct=roster74.filter(function(p){return p.pos===pos&&!(p.injury&&p.injury.games>4);}).length;
                  var need=STARTER_COUNTS[pos]||1;
                  if(ct<=need)alerts74.push({type:"backup",severity:"high",icon:"ðŸš¨",
                    msg:"No backup "+pos+"! Only "+ct+" healthy player"+(ct>1?"s":"")+". One injury = crisis.",color:T.red});
                });
                roster74.filter(function(p){return p.isStarter&&p.age>=32;}).forEach(function(p){
                  var curve74=AGE_CURVES[p.pos]||AGE_CURVES.WR;
                  if(p.age>curve74.cliff){alerts74.push({type:"aging",severity:"med",icon:"â³",
                    msg:p.name+" ("+p.pos+", "+p.ovr+" OVR) is "+p.age+" â€” past cliff age ("+curve74.cliff+"). Draft replacement soon.",color:T.orange});}
                });
                roster74.filter(function(p){return p.ovr<=65&&p.contract.salary>=3&&!p.isStarter;}).forEach(function(p){
                  var deadCut74=v36_deadIfCut(p.contract);var netSave74=Math.round((p.contract.salary-deadCut74)*10)/10;
                  if(netSave74>0)alerts74.push({type:"cut",severity:"low",icon:"âœ‚ï¸",
                    msg:p.name+" ("+p.pos+" "+p.ovr+" OVR, $"+p.contract.salary+"M) â€” cut saves $"+netSave74+"M"+(deadCut74>0?" (dead: $"+deadCut74+"M)":""),color:T.faint});
                });
                roster74.filter(function(p){return p.isStarter&&p.injury&&p.injury.games>0;}).forEach(function(p){
                  var backups=roster74.filter(function(b){return b.pos===p.pos&&b.id!==p.id&&!(b.injury&&b.injury.games>0);}).sort(function(a,b){return b.ovr-a.ovr;});
                  var bestBackup=backups[0];
                  if(!bestBackup||bestBackup.ovr<p.ovr-15){alerts74.push({type:"injury",severity:"high",icon:"ðŸ¥",
                    msg:p.name+" ("+p.pos+" "+p.ovr+") injured "+p.injury.games+" wks. "+(bestBackup?"Backup "+bestBackup.name+" is only "+bestBackup.ovr+" OVR.":"NO backup available!"),color:T.red});}
                });
                roster74.filter(function(p){return p.age<=23&&p.pot>=75&&!p.isStarter&&(p.stats.snaps||0)<50;}).forEach(function(p){
                  alerts74.push({type:"dev",severity:"med",icon:"ðŸŒ±",
                    msg:p.name+" ("+p.pos+", POT "+p.pot+") is rotting on bench with "+(p.stats.snaps||0)+" snaps. Consider starting for development.",color:T.green});
                });
                if(alerts74.length===0)return <div style={assign({},cS,{borderColor:"rgba(16,185,129,0.3)"})}>
                  <div style={{fontSize:10,color:T.green,fontWeight:700}}>{"âœ… ROSTER HEALTH: GOOD â€” No critical depth issues detected."}</div>
                </div>;
                var sevOrder={high:0,med:1,low:2};
                alerts74.sort(function(a,b){return(sevOrder[a.severity]||2)-(sevOrder[b.severity]||2);});
                return <div style={assign({},cS,{borderColor:"rgba(251,191,36,0.3)",background:"rgba(251,191,36,0.02)"})}>
                  <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:6}}>{"ðŸ§  ROSTER INTELLIGENCE â€” "+alerts74.length+" Alert"+(alerts74.length>1?"s":"")}</div>
                  {alerts74.slice(0,8).map(function(a,ai){
                    return <div key={ai} style={{padding:"4px 6px",marginBottom:3,borderRadius:4,borderLeft:"3px solid "+a.color,background:"rgba(0,0,0,0.15)",fontSize:10}}>
                      <span>{a.icon+" "+a.msg}</span>
                    </div>;
                  })}
                </div>;
              })()}
            </div>
          )}
          
          {tab==="standings" && (
            <div>
              {/* v97.7: Standings sub-tab toggle */}
              <div style={{display:"flex",gap:6,marginBottom:12}}>
                <button onClick={function(){setStandView977("standings");}} style={mS(S.btn,standView977==="standings"?S.btnPrimary:S.btnGhost,{fontSize:10,padding:"5px 10px"})}>{" ðŸ“Š Standings"}</button>
                <button onClick={function(){setStandView977("rivalries");}} style={mS(S.btn,standView977==="rivalries"?S.btnPrimary:S.btnGhost,{fontSize:10,padding:"5px 10px"})}>{"âš”ï¸ Rivalries"}</button>
              </div>
              {standView977==="rivalries"&&my&&(function(){
                var dash977=buildRivalryDashboard977(my,teams);
                return React.createElement("div",{},
                  dash977.trophies.length>0&&React.createElement("div",{style:{marginBottom:16}},
                    React.createElement("div",{style:{fontSize:12,fontWeight:900,color:T.gold,marginBottom:8}},"\uD83C\uDFC6 TROPHY CASE ("+dash977.trophies.length+")"),
                    React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:8}},
                      dash977.trophies.map(function(tr,ti){return React.createElement("div",{key:ti,style:{padding:"6px 10px",background:"rgba(251,191,36,0.08)",border:"1px solid "+T.gold+"44",borderRadius:8,fontSize:10}},
                        React.createElement("span",{style:{fontWeight:800,color:T.gold}},tr.trophy.icon+" "+tr.trophy.name),
                        tr.opp&&React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:2}},"vs "+(tr.opp.icon||"")+(tr.opp.abbr||""))
                      );})
                    )
                  ),
                  React.createElement("div",{style:{fontSize:12,fontWeight:900,color:T.text,marginBottom:8}},"\u2694\uFE0F ACTIVE RIVALRIES ("+(dash977.active.length)+")"),
                  dash977.active.length===0&&React.createElement("div",{style:{color:T.dim,fontSize:10}},"No rivalries yet â€” keep playing to build rivalries with division opponents."),
                  dash977.active.map(function(entry,ei){
                    var r=entry.rival,opp=entry.opp,tier=entry.tier,h2h=entry.h2h;
                    if(!opp)return null;
                    var tierColor=tier.tier==="war"?"#ef4444":tier.tier==="intense"?"#f97316":tier.tier==="heated"?"#eab308":T.cyan;
                    return React.createElement("div",{key:ei,style:{marginBottom:8,padding:10,background:T.bg2,borderRadius:8,border:"1px solid "+(r.trophy977?"rgba(251,191,36,0.3)":T.border)}},
                      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                        React.createElement("div",{},
                          React.createElement("span",{style:{fontWeight:800,fontSize:12,color:T.text}},opp.icon+" "+opp.city+" "+opp.name),
                          React.createElement("span",{style:{marginLeft:8,fontSize:9,padding:"1px 6px",borderRadius:4,fontWeight:700,background:tierColor+"22",color:tierColor}},tier.emoji+" "+tier.label)
                        ),
                        React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.dim}},"Heat: "+r.heat)
                      ),
                      React.createElement("div",{style:{display:"flex",gap:12,marginTop:6,fontSize:10,color:T.dim}},
                        React.createElement("span",{},"H2H: "+(h2h.wins||0)+"W-"+(h2h.losses||0)+"L"),
                        React.createElement("span",{style:{color:h2h.streak>0?T.green:h2h.streak<0?T.red:T.dim}},h2h.streak>0?"ðŸ”¥ "+h2h.streak+"-game win streak":h2h.streak<0?"ðŸ“‰ "+Math.abs(h2h.streak)+"-game skid":"â€”"),
                        r.name&&React.createElement("span",{style:{color:T.faint,fontStyle:"italic"}},r.name)
                      ),
                      r.trophy977&&React.createElement("div",{style:{marginTop:6,padding:"3px 8px",background:"rgba(251,191,36,0.06)",borderRadius:5,fontSize:9,color:T.gold,display:"inline-block"}},
                        r.trophy977.icon+" "+r.trophy977.name+" â€” "+(r.trophy977.holderId===myId?"YOU HOLD IT":r.trophy977.holderId?(opp.abbr+" holds it"):"Unclaimed")
                      )
                    );
                  })
                );
              })()}
              {standView977==="standings"&&(function(){
                var confs97=DIV_STANDINGS.getConferences(teams);
                if(!confs97||confs97.length===0)return <div style={{color:T.dim}}>{"No standings data"}</div>;
                var playoffIds97={};
                try{
                  var field97=buildPlayoffField97(teams);
                  (field97&&field97.seeds||[]).forEach(function(s){
                    if(!s||!s.id)return;
                    playoffIds97[s.id]={seed:s.seed,isDivChamp:!!s.isDivChamp,conf:s.conf};
                  });
                }catch(eStand97){}
                return confs97.map(function(conf){
                  return React.createElement("div",{key:conf.id,style:{marginBottom:20}},
                    React.createElement("div",{style:{fontSize:14,fontWeight:900,color:T.gold,marginBottom:8,
                      padding:"6px 12px",background:"rgba(251,191,36,0.06)",borderRadius:8,borderLeft:"3px solid "+T.gold}},
                      (conf.icon||"ðŸˆ")+" "+(conf.name||conf.id)),
                    (conf.divisions||[]).map(function(div){
                      return React.createElement("div",{key:div.id,style:{marginBottom:12,marginLeft:8}},
                        React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.cyan,marginBottom:4}},
                          (div.icon||"ðŸˆ")+" "+div.name+" Division"),
                        (div.teams||[]).map(function(t,i){
                          var isMe=t.id===myId;
                          var pInfo=playoffIds97[t.id];
                          var diff97=(t.pf||0)-(t.pa||0);
                          var arch97=!isMe&&typeof getTeamGMArchetype90==="function"?getTeamGMArchetype90(t):null;
                          var archColor97=arch97&&arch97.color&&T[arch97.color]?T[arch97.color]:T.purple;
                          return React.createElement("div",{key:t.id,style:{
                              display:"flex",justifyContent:"space-between",alignItems:"center",
                              padding:"5px 10px",borderRadius:6,marginBottom:2,
                              background:isMe?"rgba(251,191,36,0.08)":T.bg2,
                              border:"1px solid "+(isMe?T.gold+"44":pInfo?"rgba(52,211,153,0.2)":T.border)
                            }},
                            React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",minWidth:0}},
                              React.createElement("span",{style:{fontWeight:700,color:i===0?T.gold:T.dim,width:16,textAlign:"center",fontSize:11}},""+(i+1)),
                              React.createElement("span",{style:{fontWeight:isMe?800:500,fontSize:12,color:isMe?T.gold:T.text,whiteSpace:"nowrap"}},
                                t.icon+" "+t.abbr),
                              arch97?React.createElement("span",{style:{fontSize:7,padding:"1px 4px",borderRadius:4,
                                background:archColor97+"18",color:archColor97,fontWeight:700,flexShrink:0}},
                                arch97.icon+" "+arch97.label):null
                            ),
                            React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",flexShrink:0}},
                              React.createElement("span",{style:{fontWeight:600,fontSize:11}},(t.wins||0)+"-"+(t.losses||0)),
                              React.createElement("span",{style:{fontSize:9,color:diff97>0?T.green:diff97<0?T.red:T.dim,width:40,textAlign:"right"}},
                                (diff97>0?"+":"")+diff97),
                              (t._gamesBack76!==undefined&&t._gamesBack76>0)
                                ?React.createElement("span",{style:{fontSize:9,color:T.faint,width:34,textAlign:"right"}},t._gamesBack76+" GB")
                                :React.createElement("span",{style:{fontSize:9,color:T.green,width:34,textAlign:"right"}},"-"),
                              pInfo?React.createElement("span",{style:{fontSize:8,padding:"1px 5px",borderRadius:4,fontWeight:700,
                                  background:pInfo.isDivChamp?"rgba(52,211,153,0.15)":"rgba(59,130,246,0.15)",
                                  color:pInfo.isDivChamp?T.green:T.blue}},
                                pInfo.isDivChamp?"ðŸ† DIV":"ðŸŽ« WC"):null
                            )
                          );
                        })
                      );
                    })
                  );
                });
              })()}
            </div>
          )}
          
          {tab==="schedule" && (
            <div>
              <div style={{fontWeight:700,marginBottom:8}}>{"Schedule â€” "+season.year}</div>
              
              {(function(){
                var myGames=sched.filter(function(g){return g.home===myId||g.away===myId;}).sort(function(a,b){return a.week-b.week;});
                var myWeeks={};myGames.forEach(function(g){myWeeks[g.week]=g;});
                var rows=[];
                for(var wk=1;wk<=18;wk++){
                  if(myWeeks[wk]){rows.push({type:"game",game:myWeeks[wk],week:wk});}
                  else{rows.push({type:"bye",week:wk});}
                }
                return rows.map(function(row,i){
                  if(row.type==="bye"){
                    return React.createElement("div",{key:"bye"+row.week,style:{display:"flex",alignItems:"center",gap:10,padding:"8px 10px",background:"rgba(167,139,250,0.06)",borderRadius:6,marginBottom:4,borderLeft:"3px solid "+T.purple}},
                      React.createElement("div",{style:{width:24,fontSize:10,color:T.purple,fontWeight:700}},"W"+row.week),
                      React.createElement("div",{style:{flex:1,fontWeight:600,fontSize:12,color:T.purple}},"ðŸ“… BYE WEEK"),
                      React.createElement("div",{style:{fontSize:10,color:T.dim}},"Rest & Recovery"));
                  }
                  var g=row.game;
                  var isH=g.home===myId;var o=teams.find(function(t){return t.id===(isH?g.away:g.home);});var r=g.result;
                  var uS=r?(isH?r.home:r.away):null;var oS2=r?(isH?r.away:r.home):null;var w=uS!==null&&uS>oS2;
                  var isNext=!g.played&&g.week===season.week&&season.phase==="regular";
                  var gt97=g.gameType97;
                  return (
                    <div key={i} style={{display:"flex",alignItems:"center",gap:10,padding:"8px 10px",
                      background:isNext?"rgba(212,167,75,0.08)":T.bg2,borderRadius:6,marginBottom:4,
                      borderLeft:"3px solid "+(g.played?(w?T.green:T.red):isNext?T.gold:T.border)}}>
                      <div style={{width:24,fontSize:10,color:T.faint,fontWeight:700}}>{"W"+g.week}</div>
                      {o&&React.createElement(TeamLogo,{team:o,size:24})}
                      <div style={{flex:1}} onClick={function(){if(r)showBoxScore(r);}}>
                      <div style={{display:"flex",alignItems:"center",gap:4,flexWrap:"wrap"}}>
                        <div style={{fontWeight:600,fontSize:12,cursor:r?"pointer":"default"}}>{(isH?"vs ":"@ ")+(o?o.city+" "+o.name:"???")}</div>
                        {gt97&&React.createElement("span",{style:{fontSize:7,padding:"1px 4px",borderRadius:4,
                          fontWeight:700,
                          background:gt97==="div"?"rgba(251,191,36,0.12)":gt97==="conf"?"rgba(59,130,246,0.12)":"rgba(168,85,247,0.12)",
                          color:gt97==="div"?T.gold:gt97==="conf"?T.blue:T.purple}},
                          gt97==="div"?"DIV":gt97==="conf"?"CONF":"CROSS")}
                      </div>
                        {o&&<div style={{fontSize:9,color:T.dim,display:"flex",alignItems:"center",gap:4}}>
                          <span>{o.wins+"W-"+o.losses+"L"}</span>
                          
                          {(function(){var riv=_findRivalObj(my,o.id);var rl=getRivalryLabel(riv?riv.heat:0);
                            return rl.label?React.createElement("span",{style:{fontSize:8,padding:"1px 5px",borderRadius:8,background:"rgba(251,146,60,0.12)",color:T.orange,fontWeight:700}},
                              rl.emoji+" "+(riv&&riv.name?riv.name:rl.label)):null;
                          })()}
                          
                          {g._primetime78&&React.createElement("span",{style:{fontSize:8,padding:"1px 5px",borderRadius:8,background:"rgba(59,130,246,0.12)",color:g._primetime78.color,fontWeight:700}},
                            g._primetime78.icon+" "+g._primetime78.abbr)}
                        </div>}
                        {isNext&&o&&my&&(function(){
                          var myOffPlan87=OFF_PLANS.find(function(p){return p.id===(my.gameplanOff||"balanced_o");})||OFF_PLANS[0];
                          var oppDefPlan87=DEF_PLANS.find(function(p){return p.id===(o.gameplanDef||"balanced_d");})||DEF_PLANS[0];
                          var counter87=(SCHEME_COUNTERS[myOffPlan87.id]||{})[oppDefPlan87.id]||0;
                          var intelLabel87="âšª Neutral";
                          var intelTone87=T.dim;
                          if(counter87>=4){intelLabel87="ðŸŸ¢ Favorable matchup";intelTone87=T.green;}
                          else if(counter87>=1){intelLabel87="ðŸŸ¡ Slight edge";intelTone87=T.gold;}
                          else if(counter87<=-2){intelLabel87="ðŸ”´ Tough matchup";intelTone87=T.red;}
                          var flavorLine87=getSchemeFlavorLine(my.schemeOff,"offense");
                          var oppIntelKey91="oppIntel_"+g.week+"_"+(o.id||o.abbr);
                          var oppIntel91=my._oppIntel91&&my._oppIntel91[oppIntelKey91];
                          var scoutCostBasic91=25;// $25k basic advance scout (in thousands)
                          var scoutCostDeep91=75;// $75k deep film study
                          var myScoutPts91=my.scoutPts||0;
                          function doOppScout91(level){
                            var cost91=level==="deep"?scoutCostDeep91:scoutCostBasic91;
                            if(myScoutPts91<cost91){addN("âš ï¸ Not enough scout budget! Need "+cost91+" pts.","red");return;}
                            var nt91b=teams.slice();var myT91b=nt91b.find(function(t){return t.id===myId;});
                            if(!myT91b)return;
                            myT91b.scoutPts=(myT91b.scoutPts||0)-cost91;
                            if(!myT91b._oppIntel91)myT91b._oppIntel91={};
                            var top3=o.roster?o.roster.slice().sort(function(a,b){return (b.ovr||0)-(a.ovr||0);}).slice(0,3):[];
                            var intelData91={level:level,scheme:o.gameplanOff||"?",defScheme:o.gameplanDef||"?",
                              top3:top3.map(function(p){return {name:p.name,pos:p.pos,ovr:level==="deep"?p.ovr:"~"+(Math.round((p.ovr||60)/5)*5)};}),
                              prepBonus:level==="deep"?2:0,
                              injuryList:(o.roster||[]).filter(function(p){return p.injured;}).map(function(p){return p.name+"("+p.pos+") "+p.injuryType;}).join(", ")||"No reported injuries",
                              gamePlanHint:level==="deep"?(counter87<=-2?"They struggle vs "+myOffPlan87.name+". Exploit it.":"Balanced threat. Stay disciplined."):"Scout more for detailed hints"
                            };
                            myT91b._oppIntel91[oppIntelKey91]=intelData91;
                            setTeams(nt91b);
                            addN("ðŸ•µï¸â€â™‚ï¸ Advance scout filed on "+o.abbr+"! "+(level==="deep"?"Deep film study complete â€” +2 prep bonus active.":"Basic scout done. Spend more for deep film."),"cyan");
                          }
                          return <div style={{marginTop:6,padding:"6px 7px",borderRadius:6,border:"1px solid "+intelTone87+"44",background:"rgba(15,23,42,0.45)"}}>
                            <div style={{fontSize:8,fontWeight:800,color:T.cyan,letterSpacing:0.4,marginBottom:3}}>
                              {"MATCHUP INTELLIGENCE"}
                            </div>
                            <div style={{fontSize:8,color:T.text,marginBottom:2}}>
                              {"Your scheme: "+myOffPlan87.name+" vs Their defense: "+oppDefPlan87.name}
                            </div>
                            <div style={{fontSize:8,color:intelTone87,fontWeight:700,marginBottom:2}}>
                              {intelLabel87+" ("+(counter87>0?"+":"")+counter87+")"}
                            </div>
                            {flavorLine87&&<div style={{fontSize:8,color:T.faint,fontStyle:"italic",marginBottom:4}}>
                              {"\""+flavorLine87+"\""}
                            </div>}
                            
                            {oppIntel91?(
                              <div style={{marginTop:4,padding:"5px 6px",borderRadius:5,background:"rgba(6,182,212,0.07)",border:"1px solid rgba(6,182,212,0.2)"}}>
                                <div style={{fontSize:8,fontWeight:800,color:T.cyan,marginBottom:3}}>{"ðŸ•µï¸â€â™‚ï¸ ADVANCE SCOUT â€” "+o.abbr+(oppIntel91.level==="deep"?" (DEEP FILM)":"")}</div>
                                <div style={{fontSize:8,color:T.dim,marginBottom:2}}>{"Scheme: "+oppIntel91.scheme+" OFF / "+oppIntel91.defScheme+" DEF"}</div>
                                <div style={{fontSize:8,color:T.text,marginBottom:2}}>{"Top threats: "+(oppIntel91.top3.map(function(p){return p.name+"("+p.pos+" "+p.ovr+")";}).join(", ")||"Unknown")}</div>
                                <div style={{fontSize:8,color:T.faint,marginBottom:2}}>{"Injury report: "+oppIntel91.injuryList}</div>
                                {oppIntel91.level==="deep"&&<div style={{fontSize:8,color:T.gold,fontWeight:700,marginBottom:2}}>{"ðŸ’¡ "+oppIntel91.gamePlanHint}</div>}
                                {oppIntel91.prepBonus>0&&<div style={{fontSize:8,color:T.green,fontWeight:700}}>{"âœ… +"+oppIntel91.prepBonus+" Prep Bonus active this game"}</div>}
                              </div>
                            ):(
                              <div style={{display:"flex",gap:4,marginTop:4}}>
                                <button style={{fontSize:8,padding:"3px 7px",borderRadius:4,cursor:"pointer",background:"rgba(6,182,212,0.1)",border:"1px solid rgba(6,182,212,0.3)",color:T.cyan,fontWeight:700}}
                                  onClick={function(){doOppScout91("basic");}}>{"ðŸ•µï¸â€â™‚ï¸ Basic Scout ("+scoutCostBasic91+"pts)"}</button>
                                <button style={{fontSize:8,padding:"3px 7px",borderRadius:4,cursor:(myScoutPts91>=scoutCostDeep91?"pointer":"not-allowed"),background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.3)",color:myScoutPts91>=scoutCostDeep91?T.purple:T.faint,fontWeight:700}}
                                  onClick={function(){doOppScout91("deep");}}>{"ðŸŽ¬ Deep Film ("+scoutCostDeep91+"pts)"}</button>
                              </div>
                            )}
                          </div>;
                        })()}
                      </div>
                      <div style={{textAlign:"right",display:"flex",alignItems:"center",gap:6}}>
                        {g.played?<div onClick={function(){if(r)showBoxScore(r);}} style={{cursor:"pointer"}}><div style={{fontWeight:800,fontSize:14,color:w?T.green:T.red}}>{(w?"W":"L")+" "+uS+"-"+oS2}</div>
                          <div style={{fontSize:8,color:T.dim}}>{"Tap for GameCast"}</div></div>
                          :isNext?<button style={bS(T.gold,"#000")} onClick={function(){
                            /* v12: Live Game Theater â€” sim then reveal cinematically */
                            var hT2=teams.find(function(t){return t.id===g.home;});
                            var aT2=teams.find(function(t){return t.id===g.away;});
                            if(!hT2||!aT2) return;
                            var res=simGame(hT2,aT2);
                            var decisions972=detectDecisionPoints972(res,hT2,aT2,myId);
                            AUDIO.play(gamedayTrack||(season.phase==="playoffs"?AUDIO.pickTrack("playoffs",userPlaylist):AUDIO.pickTrack("pregame",userPlaylist)));// v93.18: fixed scope
                            setTheater({result:res,driveIdx:0,speed:"normal",paused:false,
                              homeTeam:hT2,awayTeam:aT2,gameRef:{home:g.home,away:g.away,week:g.week},
                              decisions:decisions972,decisionActive:null});
                          }}>{"ðŸ“º WATCH"}</button>
                          :<div style={{fontSize:11,color:T.faint}}>{"â€”"}</div>}
                      </div>
                    </div>);
                });
              })()}
              
              {(function(){
                var myGames74=sched.filter(function(g){return(g.home===myId||g.away===myId)&&!g.played;});
                if(myGames74.length===0)return null;
                var totalOppWins=0;var totalOppLosses=0;var oppList74=[];
                myGames74.forEach(function(g){
                  var oppId=g.home===myId?g.away:g.home;
                  var opp74=teams.find(function(t){return t.id===oppId;});
                  if(opp74){totalOppWins+=opp74.wins;totalOppLosses+=opp74.losses;
                    oppList74.push({name:opp74.abbr,icon:opp74.icon,w:opp74.wins,l:opp74.losses,ovr:Math.round(avg(opp74.roster,function(p){return p.ovr;}))});}
                });
                var totalG74=totalOppWins+totalOppLosses;
                var sosPct74=totalG74>0?Math.round(totalOppWins/totalG74*1000)/10:50;
                var sosLabel=sosPct74>=55?"BRUTAL":sosPct74>=50?"TOUGH":sosPct74>=45?"AVERAGE":"EASY";
                var sosColor=sosPct74>=55?T.red:sosPct74>=50?T.orange:sosPct74>=45?T.gold:T.green;
                return <div style={assign({},cS,{borderColor:sosColor+"44",marginTop:8})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                    <div style={{fontWeight:700,fontSize:11,color:T.gold}}>{"ðŸ“Š REMAINING STRENGTH OF SCHEDULE"}</div>
                    <div style={{fontSize:12,fontWeight:900,color:sosColor}}>{sosPct74+"% â€” "+sosLabel}</div>
                  </div>
                  <div style={{fontSize:9,color:T.dim,marginBottom:6}}>{"Based on current records of your "+myGames74.length+" remaining opponents. Higher % = harder schedule."}</div>
                  <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                    {oppList74.map(function(o,oi){
                      var oppColor=o.w>o.l?T.red:o.w===o.l?T.orange:T.green;
                      return <div key={oi} style={{padding:"3px 6px",borderRadius:4,background:"rgba(0,0,0,0.2)",border:"1px solid "+oppColor+"33",fontSize:9}}>
                        <span style={{fontWeight:700}}>{o.icon+o.name}</span>
                        <span style={{color:oppColor,marginLeft:3}}>{o.w+"-"+o.l}</span>
                      </div>;
                    })}
                  </div>
                </div>;
              })()}
            </div>
          )}
          
          {tab==="gameplan" && (
            <div>
              <div style={{fontWeight:700,marginBottom:8}}>{"ðŸŽ¯ Gameplan â€” Offense & Defense"}</div>
              <div style={{fontSize:10,color:T.dim,marginBottom:10}}>{"Choose your offensive and defensive schemes independently. Matchup bonuses apply based on the opponent's scheme!"}</div>
              {/* MATCHUP_INTEL v18: Opponent scout card injected at top of gameplan */}
              {(function(){
                // Find this week's unplayed game
                var nextG=(sched||[]).find(function(g){return g&&g.week===season.week&&!g.played&&(g.home===myId||g.away===myId);});
                if(!nextG)return null;
                var oppId=nextG.home===myId?nextG.away:nextG.home;
                var opp=teams.find(function(t){return t.id===oppId;});
                if(!opp)return null;
                var isHome=nextG.home===myId;
                // Scheme matchup verdict
                var myOffPlan=OFF_PLANS.find(function(p){return p.id===(my.gameplanOff||"balanced_o");})||OFF_PLANS[0];
                var myDefPlan=DEF_PLANS.find(function(p){return p.id===(my.gameplanDef||"balanced_d");})||DEF_PLANS[0];
                var oppOffPlan=OFF_PLANS.find(function(p){return p.id===(opp.gameplanOff||"balanced_o");})||OFF_PLANS[0];
                var oppDefPlan=DEF_PLANS.find(function(p){return p.id===(opp.gameplanDef||"balanced_d");})||DEF_PLANS[0];
                var offEdge=(SCHEME_COUNTERS[myOffPlan.id]||{})[oppDefPlan.id]||0;
                var defEdge=-((SCHEME_COUNTERS[oppOffPlan.id]||{})[myDefPlan.id]||0);
                var totalEdge=offEdge+defEdge;
                var verdict=totalEdge>=4?"MAJOR ADVANTAGE":totalEdge>=2?"SLIGHT EDGE":totalEdge<=-4?"MAJOR DISADVANTAGE":totalEdge<=-2?"DISADVANTAGE":"EVEN MATCHUP";
                var verdictColor=totalEdge>=4?T.green:totalEdge>=2?"rgba(52,211,153,0.8)":totalEdge<=-4?T.red:totalEdge<=-2?"rgba(239,68,68,0.8)":T.gold;
                var verdictBg=totalEdge>=2?"linear-gradient(90deg,rgba(16,185,129,0.15),rgba(15,23,42,0.9))":totalEdge<=-2?"linear-gradient(90deg,rgba(239,68,68,0.15),rgba(15,23,42,0.9))":"linear-gradient(90deg,rgba(251,191,36,0.12),rgba(15,23,42,0.9))";
                // Opponent arc threats
                var arcOrder18=["BREAKOUT","ELITE","COMEBACK","SWAN_SONG","HOLDOUT","SLUMP","MENTOR","DECLINE"];
                var arcWarningArcs=["BREAKOUT","ELITE","COMEBACK","SWAN_SONG"];
                var oppArcPlayers=[];
                arcOrder18.forEach(function(ak){
                  var found=(opp.roster||[]).find(function(p){return p&&(p._arcState||"")===ak&&(p.ovr||0)>=72;});
                  if(found)oppArcPlayers.push(assign({},found,{arcKey18:ak}));
                });
                var oppArcThreat=oppArcPlayers[0]||null;// top arc player
                // Scout notes by arc type
                var arcScoutNotes={
                  BREAKOUT:"ðŸš¨ SCOUT ALERT: This player is on a breakout arc â€” expect peak performance. Account for them on every snap.",
                  ELITE:"â­ ELITE THREAT: All-Pro caliber. Your best corner or safety needs to know where this player is at all times.",
                  COMEBACK:"ðŸ”„ MOMENTUM RISK: They're in comeback mode â€” motivated and dangerous. Don't let them get going early.",
                  SWAN_SONG:"ðŸ¦¢ LEGEND GAME: Veteran on their farewell tour. Expect maximum effort â€” legends don't go quietly.",
                  HOLDOUT:"ðŸ’° DISTRACTION: Playing through a contract dispute. Could be distracted OR playing for their next deal. Wild card.",
                  SLUMP:"ðŸ“‰ VULNERABILITY: Their key player is struggling. Target the mismatch and apply pressure.",
                  MENTOR:"ðŸ“š SYSTEM PLAYER: Veteran makes everyone around them better. Disrupting the scheme hurts more than the individual.",
                  DECLINE:"ðŸ•°ï¸ DECLINING STAR: Skills fading but experience compensates. Don't underestimate â€” but the mismatch is there."
                };
                // Opponent top threats by position groups
                var oppStarters=(opp.roster||[]).filter(function(p){return p&&p.isStarter&&!(p.injury&&p.injury.games>0);});
                var offThreats=oppStarters.filter(function(p){return["QB","WR","TE","RB"].indexOf(p.pos)>=0;}).sort(function(a,b){return (b.ovr||0)-(a.ovr||0);}).slice(0,3);
                var defThreats=oppStarters.filter(function(p){return["DL","LB","CB","S"].indexOf(p.pos)>=0;}).sort(function(a,b){return (b.ovr||0)-(a.ovr||0);}).slice(0,3);
                var gp2=opp.wins+opp.losses;var oppWinPct=gp2>0?Math.round(opp.wins/gp2*100):50;
                return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:10}},
                  // Header
                  React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(239,68,68,0.18),rgba(15,23,42,0.95))",borderRadius:12,padding:"14px 18px",border:"1px solid rgba(239,68,68,0.3)"}},
                    React.createElement("div",{style:{fontSize:8,fontWeight:800,letterSpacing:3,color:"#ef4444",marginBottom:3}},"ðŸ“‹ MFSN MATCHUP INTEL â€” WEEK "+season.week),
                    React.createElement("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:6}},
                      React.createElement(TeamLogo,{team:opp,size:36}),
                      React.createElement("div",null,
                        React.createElement("div",{style:{fontSize:16,fontWeight:900,color:"#fff"}},(isHome?"vs. ":"@ ")+opp.city+" "+opp.name),
                        React.createElement("div",{style:{fontSize:10,color:T.dim}},opp.wins+"-"+opp.losses+" ("+oppWinPct+"% win) Â· "+opp.abbr+" Â· "+(isHome?"HOME":"AWAY"))
                      )
                    ),
                    // Verdict banner
                    React.createElement("div",{style:{background:verdictBg,borderRadius:8,padding:"8px 12px",border:"1px solid "+verdictColor+"44",display:"flex",justifyContent:"space-between",alignItems:"center"}},
                      React.createElement("div",null,
                        React.createElement("div",{style:{fontSize:8,fontWeight:800,color:verdictColor,letterSpacing:2}},verdict),
                        React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:1}},myOffPlan.icon+" "+myOffPlan.name+" off vs. "+oppDefPlan.icon+" "+oppDefPlan.name+" def"),
                        React.createElement("div",{style:{fontSize:9,color:T.dim}},myDefPlan.icon+" "+myDefPlan.name+" def vs. "+oppOffPlan.icon+" "+oppOffPlan.name+" off")
                      ),
                      React.createElement("div",{style:{textAlign:"right"}},
                        React.createElement("div",{style:{fontSize:22,fontWeight:900,color:verdictColor}},(totalEdge>0?"+":"")+totalEdge),
                        React.createElement("div",{style:{fontSize:7,color:T.faint,letterSpacing:1}},"SCHEME EDGE")
                      )
                    )
                  ),
                  // Arc threat warning
                  oppArcThreat?React.createElement("div",{style:{background:arcWarningArcs.indexOf(oppArcThreat.arcKey18)>=0?"linear-gradient(90deg,rgba(239,68,68,0.14),rgba(15,23,42,0.9))":"linear-gradient(90deg,rgba(148,163,184,0.10),rgba(15,23,42,0.9))",borderRadius:10,padding:"10px 14px",border:"1px solid "+((ARC_SPOTLIGHT.lines[oppArcThreat.arcKey18]||{}).badgeColor||T.red)+"44"}},
                    React.createElement("div",{style:{display:"flex",gap:8,alignItems:"flex-start"}},
                      React.createElement("div",{style:{flex:1}},
                        React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:4,flexWrap:"wrap"}},
                          React.createElement("span",{style:{fontSize:8,fontWeight:800,letterSpacing:2,color:(ARC_SPOTLIGHT.lines[oppArcThreat.arcKey18]||{}).badgeColor||"#ef4444"}},"ðŸŽ¯ OPP ARC THREAT"),
                          React.createElement("span",{style:{fontSize:8,fontWeight:800,color:(ARC_SPOTLIGHT.lines[oppArcThreat.arcKey18]||{}).badgeColor||"#ef4444",background:"rgba(0,0,0,0.3)",border:"1px solid "+((ARC_SPOTLIGHT.lines[oppArcThreat.arcKey18]||{}).badgeColor||"#ef4444")+"55",borderRadius:10,padding:"1px 7px"}},(ARC_SPOTLIGHT.lines[oppArcThreat.arcKey18]||{}).badge||oppArcThreat.arcKey18),
                          React.createElement("span",{style:{fontSize:10,fontWeight:700,color:T.text}},oppArcThreat.name),
                          React.createElement("span",{style:{fontSize:9,color:T.dim}},oppArcThreat.pos+" Â· OVR "+oppArcThreat.ovr+" Â· Age "+oppArcThreat.age)
                        ),
                        React.createElement("div",{style:{fontSize:9,fontStyle:"italic",color:T.dim,lineHeight:1.35}},arcScoutNotes[oppArcThreat.arcKey18]||"Watch this player closely.")
                      )
                    )
                  ):null,
                  // Threat boards: their offense + their defense
                  React.createElement("div",{style:{display:"flex",gap:6}},
                    // Offensive threats
                    React.createElement("div",{style:assign({},cS,{flex:1,padding:10,borderColor:"rgba(239,68,68,0.3)"})},
                      React.createElement("div",{style:{fontSize:9,fontWeight:800,color:"#ef4444",marginBottom:6}},"\u2694\ufe0f OPP OFFENSIVE THREATS"),
                      offThreats.length===0?React.createElement("div",{style:{fontSize:9,color:T.faint}},"No starters data"):
                      offThreats.map(function(p,pi){
                        var arcBadge18=(p._arcState&&ARC_SPOTLIGHT.lines[p._arcState])?ARC_SPOTLIGHT.lines[p._arcState].badge:null;
                        var arcColor18=(p._arcState&&ARC_SPOTLIGHT.lines[p._arcState])?ARC_SPOTLIGHT.lines[p._arcState].badgeColor:null;
                        return React.createElement("div",{key:"ot"+pi,style:{display:"flex",alignItems:"center",gap:6,padding:"3px 0",borderBottom:pi<offThreats.length-1?"1px solid "+T.border:"none"}},
                          React.createElement("span",{style:{fontSize:10,color:T.dim,width:20,fontWeight:700}},(p.ovr||0)),
                          React.createElement("span",{style:{fontSize:9,fontWeight:700,color:T.red,width:22}},(p.pos)),
                          React.createElement("div",{style:{flex:1}},
                            React.createElement("span",{style:{fontSize:10,fontWeight:600}},(p.name)),
                            arcBadge18?React.createElement("span",{style:{fontSize:7,color:arcColor18,marginLeft:4,fontWeight:800}},(arcBadge18)):null
                          ),
                          p.injury&&p.injury.games>0?React.createElement("span",{style:{fontSize:8,color:T.red,fontWeight:700}},"\ud83c\udfe5 "+p.injury.games+"w"):null
                        );
                      })
                    ),
                    // Defensive threats
                    React.createElement("div",{style:assign({},cS,{flex:1,padding:10,borderColor:"rgba(96,165,250,0.3)"})},
                      React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.cyan,marginBottom:6}},"\ud83d\udee1\ufe0f OPP DEFENSIVE THREATS"),
                      defThreats.length===0?React.createElement("div",{style:{fontSize:9,color:T.faint}},"No starters data"):
                      defThreats.map(function(p,pi){
                        var arcBadge18=(p._arcState&&ARC_SPOTLIGHT.lines[p._arcState])?ARC_SPOTLIGHT.lines[p._arcState].badge:null;
                        var arcColor18=(p._arcState&&ARC_SPOTLIGHT.lines[p._arcState])?ARC_SPOTLIGHT.lines[p._arcState].badgeColor:null;
                        return React.createElement("div",{key:"dt"+pi,style:{display:"flex",alignItems:"center",gap:6,padding:"3px 0",borderBottom:pi<defThreats.length-1?"1px solid "+T.border:"none"}},
                          React.createElement("span",{style:{fontSize:10,color:T.dim,width:20,fontWeight:700}},(p.ovr||0)),
                          React.createElement("span",{style:{fontSize:9,fontWeight:700,color:T.cyan,width:22}},(p.pos)),
                          React.createElement("div",{style:{flex:1}},
                            React.createElement("span",{style:{fontSize:10,fontWeight:600}},(p.name)),
                            arcBadge18?React.createElement("span",{style:{fontSize:7,color:arcColor18,marginLeft:4,fontWeight:800}},(arcBadge18)):null
                          ),
                          p.injury&&p.injury.games>0?React.createElement("span",{style:{fontSize:8,color:T.red,fontWeight:700}},"\ud83c\udfe5 "+p.injury.games+"w"):null
                        );
                      })
                    )
                  )
                );
              })()}
              {(function(){
                var offSel=forecastOffSel84||my.schemeOff;
                var defSel=forecastDefSel84||my.schemeDef;
                var offLabel=(OFF_SCHEMES.find(function(s){return s.id===offSel;})||{}).name||offSel;
                var defLabel=(DEF_SCHEMES.find(function(s){return s.id===defSel;})||{}).name||defSel;
                return <div style={assign({},cS,{padding:10,borderColor:"rgba(34,211,238,0.28)",background:"rgba(8,145,178,0.08)"})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                    <div style={{fontSize:10,fontWeight:800,color:T.cyan}}>{"ðŸ”­ FIT FORECAST SANDBOX"}</div>
                    <div style={{fontSize:8,color:T.faint}}>{"What-if before committing to a strategic scheme change"}</div>
                  </div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                    <div>
                      <div style={{fontSize:9,color:T.dim,marginBottom:3}}>{"Offense Candidate"}</div>
                      <select value={offSel} onChange={function(e){setForecastOffSel84(e.target.value);}}
                        style={{width:"100%",background:T.bg3,color:T.text,border:"1px solid "+T.border,borderRadius:6,padding:"6px 8px",fontSize:10}}>
                        {OFF_SCHEMES.map(function(sc){return <option key={sc.id} value={sc.id}>{sc.name}</option>;})}
                      </select>
                      <div style={{display:"flex",gap:6,marginTop:6}}>
                        <button style={bS(T.bg3,T.cyan,{border:"1px solid "+T.cyan})} onClick={function(){previewSchemeChange("off",offSel);}}>
                          {"ðŸ”­ Preview Fit Impact"}
                        </button>
                        <span style={{fontSize:8,color:offSel===my.schemeOff?T.green:T.orange,fontWeight:700,alignSelf:"center"}}>
                          {offSel===my.schemeOff?"CURRENT":"CANDIDATE: "+offLabel}
                        </span>
                      </div>
                    </div>
                    <div>
                      <div style={{fontSize:9,color:T.dim,marginBottom:3}}>{"Defense Candidate"}</div>
                      <select value={defSel} onChange={function(e){setForecastDefSel84(e.target.value);}}
                        style={{width:"100%",background:T.bg3,color:T.text,border:"1px solid "+T.border,borderRadius:6,padding:"6px 8px",fontSize:10}}>
                        {DEF_SCHEMES.map(function(sc){return <option key={sc.id} value={sc.id}>{sc.name}</option>;})}
                      </select>
                      <div style={{display:"flex",gap:6,marginTop:6}}>
                        <button style={bS(T.bg3,T.cyan,{border:"1px solid "+T.cyan})} onClick={function(){previewSchemeChange("def",defSel);}}>
                          {"ðŸ”­ Preview Fit Impact"}
                        </button>
                        <span style={{fontSize:8,color:defSel===my.schemeDef?T.green:T.orange,fontWeight:700,alignSelf:"center"}}>
                          {defSel===my.schemeDef?"CURRENT":"CANDIDATE: "+defLabel}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>;
              })()}
              
              <div style={{marginBottom:16}}>
                <div style={{fontWeight:700,fontSize:13,color:T.gold,marginBottom:6}}>{"âš”ï¸ OFFENSIVE SCHEME"}</div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(150px,1fr))",gap:8}}>
                  {OFF_PLANS.map(function(op){var isSel=my.gameplanOff===op.id;return (
                    <div key={op.id} onClick={function(){var nt=teams.slice();nt.find(function(t){return t.id===myId;}).gameplanOff=op.id;setTeams(nt);doSave(nt);}}
                      style={{background:isSel?"rgba(212,167,75,0.12)":T.bg2,border:isSel?"2px solid "+T.gold:"1px solid "+T.border,borderRadius:8,cursor:"pointer",padding:10}}>
                      <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}>
                        <span style={{fontSize:20}}>{op.icon}</span>
                        <span style={{fontWeight:700,fontSize:13,color:isSel?T.gold:T.text}}>{op.name}</span>
                      </div>
                      <div style={{fontSize:9,color:T.dim,lineHeight:"1.3"}}>{op.desc}</div>
                      <div style={{display:"flex",gap:8,marginTop:6,fontSize:9}}>
                        <span style={{color:op.rb>0?T.green:op.rb<0?T.red:T.faint}}>{"Run:"+(op.rb>0?"+":"")+(op.rb*100).toFixed(0)+"%"}</span>
                        <span style={{color:op.pm>0?T.green:op.pm<0?T.red:T.faint}}>{"Pass:"+(op.pm>0?"+":"")+op.pm}</span>
                        {op.tempoMod!==0 && <span style={{color:T.cyan}}>{"Tempo:"+(op.tempoMod>0?"+":"")+op.tempoMod}</span>}
                        {op.bigPlayMod!==0 && <span style={{color:op.bigPlayMod>0?T.orange:T.faint}}>{"Big:"+(op.bigPlayMod>0?"+":"")+(op.bigPlayMod*100).toFixed(0)+"%"}</span>}
                      </div>
                    </div>);})}
                </div>
              </div>
              
              <div style={{marginBottom:16}}>
                <div style={{fontWeight:700,fontSize:13,color:T.cyan,marginBottom:6}}>{"ðŸ›¡ï¸ DEFENSIVE SCHEME"}</div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(150px,1fr))",gap:8}}>
                  {DEF_PLANS.map(function(dp){var isSel=my.gameplanDef===dp.id;return (
                    <div key={dp.id} onClick={function(){var nt=teams.slice();nt.find(function(t){return t.id===myId;}).gameplanDef=dp.id;setTeams(nt);doSave(nt);}}
                      style={{background:isSel?"rgba(96,165,250,0.12)":T.bg2,border:isSel?"2px solid "+T.cyan:"1px solid "+T.border,borderRadius:8,cursor:"pointer",padding:10}}>
                      <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}>
                        <span style={{fontSize:20}}>{dp.icon}</span>
                        <span style={{fontWeight:700,fontSize:13,color:isSel?T.cyan:T.text}}>{dp.name}</span>
                      </div>
                      <div style={{fontSize:9,color:T.dim,lineHeight:"1.3"}}>{dp.desc}</div>
                      <div style={{display:"flex",gap:8,marginTop:6,fontSize:9}}>
                        <span style={{color:dp.blitz>0?T.orange:dp.blitz<0?T.faint:T.dim}}>{"Blitz:"+(dp.blitz>0?"+":"")+(dp.blitz*100).toFixed(0)+"%"}</span>
                        <span style={{color:dp.covMod>0?T.green:dp.covMod<0?T.red:T.faint}}>{"Cov:"+(dp.covMod>0?"+":"")+dp.covMod}</span>
                        <span style={{color:dp.runStopMod>0?T.green:dp.runStopMod<0?T.red:T.faint}}>{"RunD:"+(dp.runStopMod>0?"+":"")+dp.runStopMod}</span>
                      </div>
                    </div>);})}
                </div>
              </div>
              
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.orange,marginBottom:8}}>{"ðŸ“Š MATCHUP CHEAT SHEET â€” Your Offense vs Their Defense"}</div>
                <div style={{fontSize:9,color:T.dim,marginBottom:6}}>{"Green = your offense has advantage. Red = their defense counters you."}</div>
                <table style={tS}><thead><tr>
                  <th style={thS}></th>
                  {DEF_PLANS.map(function(dp){return <th key={dp.id} style={assign({},thS,{fontSize:8})}>{dp.icon}</th>;})}
                </tr></thead><tbody>
                  {OFF_PLANS.map(function(op){var isMyOff=my.gameplanOff===op.id;
                    return <tr key={op.id} style={{background:isMyOff?"rgba(212,167,75,0.08)":"transparent"}}>
                      <td style={assign({},tdS,{fontWeight:isMyOff?800:400,fontSize:9})}>{op.icon+" "+op.name}</td>
                      {DEF_PLANS.map(function(dp){
                        var val=(SCHEME_COUNTERS[op.id]||{})[dp.id]||0;var isMyDef=my.gameplanDef===dp.id;
                        var fx73=(SCHEME_FX[op.id]||{})[dp.id];// v73: granular effects
                        var tipLines=fx73?[
                          fx73.passMod?"Pass: "+(fx73.passMod>0?"+":"")+fx73.passMod:"",
                          fx73.rushMod?"Rush: "+(fx73.rushMod>0?"+":"")+fx73.rushMod:"",
                          fx73.bigPlayAdj?"Big Play: "+(fx73.bigPlayAdj>0?"+":"")+(fx73.bigPlayAdj*100).toFixed(0)+"%":"",
                          fx73.turnoverAdj?"TO Risk: "+(fx73.turnoverAdj>0?"+":"")+(fx73.turnoverAdj*100).toFixed(1)+"%":""
                        ].filter(function(x){return x;}).join(" | "):"";
                        return <td key={dp.id} title={tipLines} style={assign({},tdS,{fontWeight:val!==0?700:400,fontSize:10,textAlign:"center",
                          color:val>3?T.green:val>0?"rgba(34,197,94,0.7)":val<-3?T.red:val<0?"rgba(239,68,68,0.7)":T.faint,
                          background:isMyDef?"rgba(96,165,250,0.06)":"transparent",cursor:fx73?"help":"default"})}>
                          {val>0?"+"+val:val===0?"â€”":val}
                        </td>;
                      })}
                    </tr>;})}
                </tbody></table>
              </div>
            </div>
          )}
          
          {tab==="trade" && (
            <div>
              {pendingCounter971 && (
                <div style={{background:"linear-gradient(135deg,rgba(251,191,36,0.12),rgba(251,191,36,0.04))",
                  border:"1px solid rgba(251,191,36,0.3)",borderRadius:8,padding:"10px 14px",marginBottom:12}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                    <div style={{fontSize:11,fontWeight:900,color:T.gold,letterSpacing:1}}>
                      {"ðŸ“ž COUNTER-OFFER TO "+pendingCounter971.aiIcon+" "+pendingCounter971.aiAbbr}
                    </div>
                    <button onClick={function(){setPendingCounter971(null);}} style={{fontSize:9,padding:"2px 8px",
                      background:"transparent",color:T.faint,border:"1px solid "+T.border,borderRadius:4,cursor:"pointer"}}>
                      {"âœ• Dismiss"}
                    </button>
                  </div>
                  <div style={{display:"flex",gap:12,alignItems:"center",fontSize:11}}>
                    <div>
                      <div style={{fontSize:9,color:T.faint}}>{"THEY OFFERED"}</div>
                      {pendingCounter971.offerPackage972&&pendingCounter971.offerPackage972.length>1 ? (
                        <div>
                          {pendingCounter971.offerPackage972.map(function(op,opi){
                            return <div key={opi} style={{fontWeight:700,color:T.green}}>
                              {op.name+(op.condition?(" â€¢ "+pickConditionText972(op.condition)):"")}
                            </div>;
                          })}
                        </div>
                      ) : (
                        <div style={{fontWeight:700,color:T.green}}>
                          {pendingCounter971.getName+(pendingCounter971.getType==="pick"?" (Draft Pick)":"")}
                        </div>
                      )}
                    </div>
                    <div style={{fontSize:14,color:T.faint}}>{"â‡„"}</div>
                    <div>
                      <div style={{fontSize:9,color:T.faint}}>{"FOR YOUR"}</div>
                      <div style={{fontWeight:700,color:T.red}}>
                        {pendingCounter971.giveName+" ("+pendingCounter971.givePos+" "+pendingCounter971.giveOvr+")"}
                      </div>
                    </div>
                  </div>
                  <div style={{fontSize:9,color:T.dim,marginTop:4}}>
                    {"Build your counter below. Select "+pendingCounter971.aiAbbr+" as trade partner to modify the deal."}
                  </div>
                </div>
              )}
              
              {season.phase==="regular" && (function(){
                var weeksLeft=10-(season.week||1);
                var closed=weeksLeft<0;
                return <div style={assign({},cS,{padding:10,marginBottom:8,
                  borderColor:closed?"rgba(239,68,68,0.3)":weeksLeft<=2?"rgba(251,146,60,0.3)":"rgba(96,165,250,0.15)",
                  background:closed?"rgba(239,68,68,0.06)":weeksLeft<=2?"rgba(251,146,60,0.06)":"transparent"})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <div style={{fontSize:11,fontWeight:700,color:closed?T.red:weeksLeft<=2?T.orange:T.cyan}}>
                      {closed?"ðŸ”’ TRADE WINDOW CLOSED":"â° Trade Deadline: Week 10"}
                    </div>
                    {!closed && <div style={{fontSize:20,fontWeight:900,color:weeksLeft<=2?T.orange:T.gold}}>{weeksLeft<=0?"NOW!":weeksLeft+" wk"+(weeksLeft>1?"s":"")}</div>}
                  </div>
                  {closed && !godMode && <div style={{fontSize:9,color:T.faint,marginTop:2}}>{"Trades resume in the offseason. Plan for the draft instead."}</div>}
                </div>;
              })()}
              <div style={{fontWeight:700,marginBottom:8}}>{"ðŸ¤ Trade Block"}</div>
              {gmShortlist84&&gmShortlist84.length>0 && <div style={assign({},cS,{marginBottom:8,padding:"8px 10px",borderColor:T.gold,background:"rgba(212,167,75,0.06)"})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8}}>
                  <div style={{fontSize:10,color:T.gold,fontWeight:700}}>
                    {"Showing GM shortlist for "+(gmShortlist84[0].groupLabel||"this")+" fit alert"}
                  </div>
                  <button style={bS(T.bg3,T.dim,{border:"1px solid "+T.border,padding:"3px 8px",fontSize:9})} onClick={function(){setGmShortlist84(null);}}>
                    {"Clear"}
                  </button>
                </div>
              </div>}
              
              {!tradeTeamId && (function(){
                var snap=TRUST.leagueSnapshot(tradeState,teams);
                if(!snap)return null;
                var repColor=snap.reputation==="Legendary"?"#10b981":snap.reputation==="Respected"?"#22d3ee":
                  snap.reputation==="Blacklisted"?"#ef4444":snap.reputation==="Untrustworthy"?"#f97316":
                  snap.reputation==="Shark"?"#a855f7":snap.reputation==="Pushover"?"#fbbf24":T.dim;
                var lastAvg=tradeState.lastSeasonTrustAvg||null;
                var trend=TRUST_TREND.getArrow(snap.avgTrust,lastAvg);
                var recentTrades=(tradeState.recentTrades||[]).slice(-4);
                return <div style={{display:"flex",gap:8,marginBottom:10,padding:"8px 12px",background:T.bg3,borderRadius:8,alignItems:"center",flexWrap:"wrap"}}>
                  <div style={{fontSize:10,color:T.faint}}>{"Your Rep:"}</div>
                  <div style={{fontSize:12,fontWeight:800,color:repColor}}>{snap.reputation+" "+trend}</div>
                  <div style={{fontSize:9,color:T.dim}}>{"(Avg Trust: "+snap.avgTrust+")"}</div>
                  {recentTrades.length>0 && <div style={{display:"flex",gap:2,alignItems:"center"}}>
                    {recentTrades.map(function(tr,ti){
                      var dotColor=tr.classification==="fleece"?"#ef4444":tr.classification==="fair"?"#10b981":tr.classification==="overpay"?"#3b82f6":"#9ca3af";
                      return <div key={ti} style={{width:6,height:6,borderRadius:"50%",background:dotColor}} title={tr.classification||"trade"}/>;
                    })}
                  </div>}
                  <div style={{fontSize:8,color:T.faint}}>{"ðŸŸ¢ "+snap.tiers.high+" friendly"}</div>
                  <div style={{fontSize:8,color:T.faint}}>{"ðŸŸ¡ "+snap.tiers.mid+" neutral"}</div>
                  <div style={{fontSize:8,color:T.faint}}>{"ðŸ”´ "+snap.tiers.low+" cold"}</div>
                  {snap.friendliest.label && <div style={{fontSize:8,color:T.green}}>{"Best: "+snap.friendliest.label+" ("+snap.friendliest.val+")"}</div>}
                  {snap.coldest.label && <div style={{fontSize:8,color:T.red}}>{"Worst: "+snap.coldest.label+" ("+snap.coldest.val+")"}</div>}
                </div>;
              })()}
              {!tradeTeamId ? (
                <div>
                  <div style={{fontSize:11,color:T.dim,marginBottom:8}}>{"Select a team to open negotiations. Look for teams with needs you can fill."}</div>
                  <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(100px,1fr))",gap:6}}>
                  {teams.filter(function(t){return !t.isUser;}).sort(function(a,b){return b.wins-a.wins;}).map(function(t){
                    var needs=getTeamNeeds(t);var needList=Object.keys(needs).slice(0,3).join(", ");
                    var strat=t.aiStrategy||"rebuild";
                    var trust69=(tradeState.gmTrustByTeam||{})[t.id]||50;
                    var tl69=TRADE_MATH.trustLabel(trust69);
                    return (
                    <div key={t.id} onClick={function(){setTTI(t.id);setTMP([]);setTAP([]);setTMPk([]);setTAPk([]);setTMyPkCond972({});setTAiPkCond972({});setTMsg("");}}
                      style={{background:T.bg2,border:"1px solid "+T.border,borderRadius:8,cursor:"pointer",padding:8,
                        borderLeft:"3px solid "+(strat==="contend"?T.green:strat==="bubble"?T.gold:T.red)}}>
                      <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}>
                        {React.createElement(TeamLogo,{team:t,size:28})}
                        <div>
                          <div style={{fontWeight:700,fontSize:11}}>{t.abbr}</div>
                          <div style={{fontSize:9,color:T.dim}}>{t.wins+"W-"+t.losses+"L"}</div>
                        </div>
                        <div style={{marginLeft:"auto",fontSize:8,padding:"1px 5px",borderRadius:4,fontWeight:600,
                          background:tl69.color+"15",color:tl69.color}}>{tl69.emoji+" "+trust69}</div>
                      </div>
                      <div style={{fontSize:8,color:strat==="contend"?T.green:strat==="bubble"?T.gold:T.red,fontWeight:600}}>
                        {strat==="contend"?"ðŸ† Contender":strat==="bubble"?"âš¡ Bubble":"ðŸ”¨ Rebuilding"}</div>
                      {needList && <div style={{fontSize:8,color:T.faint,marginTop:2}}>{"Need: "+needList}</div>}
                    </div>);})}
                  </div>
                </div>
              ) : (function(){
                var aiTeam=teams.find(function(t){return t.id===tradeTeamId;})||{roster:[],draftPicks:[]};
                var aiNeeds=getTeamNeeds(aiTeam);var aiNeedList=Object.keys(aiNeeds);
                var myP=tMyP.map(function(id){return my.roster.find(function(p2){return p2.id===id;});}).filter(Boolean);
                var aiP=tAiP.map(function(id){return aiTeam.roster.find(function(p2){return p2.id===id;});}).filter(Boolean);
                var myPks2=(tMyPk||[]).map(function(i){
                  var pk=my.draftPicks?my.draftPicks[i]:null;
                  var cond=(tMyPkCond972||{})[String(i)];
                  return previewTradePickWithCondition972(pk,cond);
                }).filter(Boolean);
                var aiPks2=(tAiPk||[]).map(function(i){
                  var pk=aiTeam.draftPicks?aiTeam.draftPicks[i]:null;
                  var cond=(tAiPkCond972||{})[String(i)];
                  return previewTradePickWithCondition972(pk,cond);
                }).filter(Boolean);
                var sendVal=myP.reduce(function(s,p2){return s+getTradeValue(p2,aiNeeds,aiTeam);},0)+myPks2.reduce(function(s,pk){return s+pickValue(pk.round);},0);
                var getVal=aiP.reduce(function(s,p2){return s+getTradeValue(p2,null,my);},0)+aiPks2.reduce(function(s,pk){return s+pickValue(pk.round);},0);
                var sendSal=myP.reduce(function(s,p2){return s+p2.contract.salary;},0);
                var getSal=aiP.reduce(function(s,p2){return s+p2.contract.salary;},0);
                var capImpact=getSal-sendSal;
                var myCap=capCalc(my.roster)+(my.deadCap||0);
                var theCap=getSalaryCap(season.year);
                var hasItems=tMyP.length>0||tAiP.length>0||tMyPk.length>0||tAiPk.length>0;
                var gmShortMap84=buildGMShortlistMap84(gmShortlist84);
                var myTradePool84=my.roster.slice().sort(function(a,b){
                  var aShort=gmShortMap84[a.id]?1:0;var bShort=gmShortMap84[b.id]?1:0;
                  if(aShort!==bShort)return aShort?-1:1;
                  return (b.ovr||0)-(a.ovr||0);
                });
                var aiTradePool84=aiTeam.roster.slice().sort(function(a,b){
                  var aShort=gmShortMap84[a.id]?1:0;var bShort=gmShortMap84[b.id]?1:0;
                  if(aShort!==bShort)return aShort?-1:1;
                  return (b.ovr||0)-(a.ovr||0);
                });
                return <div>
                  
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                    <div style={{display:"flex",gap:10,alignItems:"center"}}>
                      {React.createElement(TeamLogo,{team:my,size:28})}
                      <span style={{fontSize:16,fontWeight:900}}>{"â‡„"}</span>
                      {React.createElement(TeamLogo,{team:aiTeam,size:28})}
                      <div>
                        <div style={{fontWeight:800,fontSize:13}}>{my.abbr+" â†” "+aiTeam.abbr}</div>
                        <div style={{fontSize:9,color:T.dim}}>{aiTeam.city+" "+aiTeam.name+" ("+aiTeam.wins+"-"+aiTeam.losses+")"}</div>
                      </div>
                    </div>
                    <button style={assign({},bS(T.bg3,T.dim),{padding:"6px 12px"})} onClick={function(){setTTI(null);setTMyPkCond972({});setTAiPkCond972({});setTMsg("");}}>{"â† Back"}</button>
                  </div>
                  
                  <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:8}}>
                    <span style={{fontSize:9,color:T.faint,fontWeight:700}}>{"THEY NEED:"}</span>
                    {aiNeedList.slice(0,6).map(function(pos){return <span key={pos} style={{fontSize:9,padding:"2px 6px",borderRadius:4,
                      background:"rgba(96,165,250,0.1)",color:T.blue,fontWeight:600}}>{pos}</span>;})}
                    <span style={{fontSize:9,color:T.faint}}>{"Strategy: "+(aiTeam.aiStrategy||"rebuild")}</span>
                    
                    {(function(){var tr69=(tradeState.gmTrustByTeam||{})[tradeTeamId]||50;var tl=TRADE_MATH.trustLabel(tr69);
                      return <span style={{fontSize:9,padding:"2px 6px",borderRadius:4,fontWeight:700,
                        background:tl.color+"15",color:tl.color}} title={"Rises with fair deals + credible press. Falls when you fleece teams."}>{tl.emoji+" GM Trust: "+tr69+" ("+tl.label+")"}</span>;})()}
                  </div>
                  
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                    
                    <div style={assign({},cS,{padding:0,overflow:"hidden",borderColor:tMyP.length>0||tMyPk.length>0?T.red:T.border})}>
                      <div style={{padding:"6px 10px",background:"rgba(239,68,68,0.06)",borderBottom:"1px solid "+T.border}}>
                        <div style={{fontWeight:700,fontSize:11,color:T.red}}>{"ðŸ“¤ YOU SEND"}</div>
                        {sendVal>0 && <div style={{fontSize:9,color:T.dim}}>{"Value: "+sendVal+" | Sal: $"+sendSal.toFixed(1)+"M"}</div>}
                      </div>
                      <div style={{maxHeight:280,overflowY:"auto",padding:"4px 6px"}}>
                      {myTradePool84.map(function(p){
                        var sel=tMyP.indexOf(p.id)>=0;
                        var fillsNeed=aiNeedList.indexOf(p.pos)>=0;
                        var isShort84=!!gmShortMap84[p.id];
                        return (
                        <div key={p.id} onClick={function(){setTMP(function(v){return v.indexOf(p.id)>=0?v.filter(function(x){return x!==p.id;}):v.concat([p.id]);});}}
                          style={{padding:"4px 6px",fontSize:10,cursor:"pointer",borderBottom:"1px solid "+T.border,borderRadius:4,marginBottom:1,
                            background:sel?"rgba(239,68,68,0.15)":"transparent",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                          <div style={{display:"flex",gap:4,alignItems:"center"}}>
                            {sel && <span style={{color:T.red,fontWeight:900}}>{"âœ“"}</span>}
                            <span style={{color:T.gold,fontWeight:700}}>{p.pos}</span>
                            <span style={{fontWeight:sel?700:400}}>{p.name}</span>
                            {isShort84 && <span style={{fontSize:7,color:T.gold,background:"rgba(212,167,75,0.14)",padding:"1px 4px",borderRadius:3,fontWeight:800}}>{"ðŸŽ¯ SHORTLIST"}</span>}
                            {fillsNeed && <span style={{fontSize:7,color:T.green,background:"rgba(16,185,129,0.1)",padding:"1px 4px",borderRadius:3}}>{"NEED"}</span>}
                          </div>
                          <div style={{display:"flex",gap:6,alignItems:"center"}}>
                            <span style={{fontSize:8,color:T.faint}}>{"$"+p.contract.salary+"M"}</span>
                            <span style={oS(p.ovr)}>{p.ovr}</span>
                          </div>
                        </div>);})}
                      {(my.draftPicks||[]).map(function(pk,i){
                        var origT=teams.find(function(t2){return t2.id===pk.original;});var via=origT&&origT.id!==myId?" (via "+origT.abbr+")":"";
                        var sel=tMyPk.indexOf(i)>=0;
                        var condPreview972=pk.condition||((tMyPkCond972||{})[String(i)]||null);
                        return (
                        <div key={"pk"+i} onClick={function(){setTMPk(function(v){return v.indexOf(i)>=0?v.filter(function(x){return x!==i;}):v.concat([i]);});}}
                          style={{padding:"4px 6px",fontSize:10,cursor:"pointer",borderRadius:4,marginBottom:1,
                            background:sel?"rgba(239,68,68,0.15)":"transparent",display:"flex",alignItems:"center",gap:4}}>
                          {sel && <span style={{color:T.red,fontWeight:900}}>{"âœ“"}</span>}
                          <span style={{color:T.cyan}}>{"ðŸ“‹ Rd"+pk.round+via}</span>
                          <span style={{fontSize:8,color:T.faint}}>{"(Val: "+pickValue(pk.round)+")"}</span>
                          {condPreview972&&React.createElement("span",{style:{fontSize:7,color:T.gold,marginLeft:4}},
                            "ðŸ“‹ "+pickConditionText972(condPreview972))}
                          {sel&&!pk.condition&&React.createElement("span",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:4}},
                            React.createElement("button",{style:{fontSize:8,padding:"1px 6px",borderRadius:4,border:"1px solid "+T.gold,
                              background:"rgba(251,191,36,0.10)",color:T.gold,cursor:"pointer",fontWeight:700},
                              onClick:function(e){e.stopPropagation();toggleTradePickConditional972("my",i,pk);}},
                              ((tMyPkCond972||{})[String(i)])?"âœ• Conditional":"ðŸ“‹ Make Conditional"),
                            ((tMyPkCond972||{})[String(i)])&&React.createElement("select",{
                              value:(((tMyPkCond972||{})[String(i)])||{}).type||"playoff",
                              onClick:function(e){e.stopPropagation();},
                              onChange:function(e){e.stopPropagation();setTradePickConditionType972("my",i,pk,e.target.value);},
                              style:{fontSize:8,padding:"1px 4px",borderRadius:4,border:"1px solid "+T.border,background:T.bg3,color:T.text}
                            },
                              React.createElement("option",{value:"playoff"},"Playoffs"),
                              React.createElement("option",{value:"record"},"10+ Wins"),
                              React.createElement("option",{value:"top10pick"},"Top-10 Pick")
                            )
                          )}
                        </div>);})}</div>
                    </div>
                    
                    <div style={assign({},cS,{padding:0,overflow:"hidden",borderColor:tAiP.length>0||tAiPk.length>0?T.blue:T.border})}>
                      <div style={{padding:"6px 10px",background:"rgba(96,165,250,0.06)",borderBottom:"1px solid "+T.border}}>
                        <div style={{fontWeight:700,fontSize:11,color:T.blue}}>{"ðŸ“¥ YOU GET"}</div>
                        {getVal>0 && <div style={{fontSize:9,color:T.dim}}>{"Value: "+getVal+" | Sal: $"+getSal.toFixed(1)+"M"}</div>}
                      </div>
                      <div style={{maxHeight:280,overflowY:"auto",padding:"4px 6px"}}>
                      {aiTradePool84.map(function(p){
                        var sel=tAiP.indexOf(p.id)>=0;
                        var isShort84=!!gmShortMap84[p.id];
                        return (
                        <div key={p.id} onClick={function(){setTAP(function(v){return v.indexOf(p.id)>=0?v.filter(function(x){return x!==p.id;}):v.concat([p.id]);});}}
                          style={{padding:"4px 6px",fontSize:10,cursor:"pointer",borderBottom:"1px solid "+T.border,borderRadius:4,marginBottom:1,
                            background:sel?"rgba(96,165,250,0.15)":"transparent",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                          <div style={{display:"flex",gap:4,alignItems:"center"}}>
                            {sel && <span style={{color:T.blue,fontWeight:900}}>{"âœ“"}</span>}
                            <span style={{color:T.gold,fontWeight:700}}>{p.pos}</span>
                            <span style={{fontWeight:sel?700:400}}>{p.name}</span>
                            {isShort84 && <span style={{fontSize:7,color:T.gold,background:"rgba(212,167,75,0.14)",padding:"1px 4px",borderRadius:3,fontWeight:800}}>{"ðŸŽ¯ SHORTLIST"}</span>}
                          </div>
                          <div style={{display:"flex",gap:6,alignItems:"center"}}>
                            <span style={{fontSize:8,color:T.faint}}>{"$"+p.contract.salary+"M/"+p.contract.years+"yr"}</span>
                            <span style={oS(p.ovr)}>{p.ovr}</span>
                          </div>
                        </div>);})}
                      {(aiTeam.draftPicks||[]).map(function(pk,i){
                        var origT=teams.find(function(t2){return t2.id===pk.original;});var trId=tradeTeamId;
                        var via=origT&&origT.id!==trId?" (via "+origT.abbr+")":"";
                        var sel=tAiPk.indexOf(i)>=0;
                        var condPreview972=pk.condition||((tAiPkCond972||{})[String(i)]||null);
                        return (
                        <div key={"apk"+i} onClick={function(){setTAPk(function(v){return v.indexOf(i)>=0?v.filter(function(x){return x!==i;}):v.concat([i]);});}}
                          style={{padding:"4px 6px",fontSize:10,cursor:"pointer",borderRadius:4,marginBottom:1,
                            background:sel?"rgba(96,165,250,0.15)":"transparent",display:"flex",alignItems:"center",gap:4}}>
                          {sel && <span style={{color:T.blue,fontWeight:900}}>{"âœ“"}</span>}
                          <span style={{color:T.cyan}}>{"ðŸ“‹ Rd"+pk.round+via}</span>
                          <span style={{fontSize:8,color:T.faint}}>{"(Val: "+pickValue(pk.round)+")"}</span>
                          {condPreview972&&React.createElement("span",{style:{fontSize:7,color:T.gold,marginLeft:4}},
                            "ðŸ“‹ "+pickConditionText972(condPreview972))}
                          {sel&&!pk.condition&&React.createElement("span",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:4}},
                            React.createElement("button",{style:{fontSize:8,padding:"1px 6px",borderRadius:4,border:"1px solid "+T.gold,
                              background:"rgba(251,191,36,0.10)",color:T.gold,cursor:"pointer",fontWeight:700},
                              onClick:function(e){e.stopPropagation();toggleTradePickConditional972("ai",i,pk);}},
                              ((tAiPkCond972||{})[String(i)])?"âœ• Conditional":"ðŸ“‹ Make Conditional"),
                            ((tAiPkCond972||{})[String(i)])&&React.createElement("select",{
                              value:(((tAiPkCond972||{})[String(i)])||{}).type||"playoff",
                              onClick:function(e){e.stopPropagation();},
                              onChange:function(e){e.stopPropagation();setTradePickConditionType972("ai",i,pk,e.target.value);},
                              style:{fontSize:8,padding:"1px 4px",borderRadius:4,border:"1px solid "+T.border,background:T.bg3,color:T.text}
                            },
                              React.createElement("option",{value:"playoff"},"Playoffs"),
                              React.createElement("option",{value:"record"},"10+ Wins"),
                              React.createElement("option",{value:"top10pick"},"Top-10 Pick")
                            )
                          )}
                        </div>);})}</div>
                    </div>
                  </div>
                  
                  {hasItems && (
                    <div style={assign({},cS,{marginTop:8,padding:10})}>
                      
                      <div style={{marginBottom:8}}>
                        <div style={{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:4}}>
                          <span style={{color:T.red}}>{"You send: "+sendVal}</span>
                          <span style={{fontWeight:700,color:sendVal>=getVal?T.green:T.red}}>{sendVal>=getVal?"âœ… Fair+":"âš ï¸ Underbid"}</span>
                          <span style={{color:T.blue}}>{"You get: "+getVal}</span>
                        </div>
                        <div style={{height:8,background:T.bg3,borderRadius:4,overflow:"hidden",display:"flex"}}>
                          <div style={{width:Math.min(50,sendVal/(sendVal+getVal||1)*100)+"%",height:"100%",background:T.red,borderRadius:"4px 0 0 4px"}}></div>
                          <div style={{width:Math.min(50,getVal/(sendVal+getVal||1)*100)+"%",height:"100%",background:T.blue,borderRadius:"0 4px 4px 0"}}></div>
                        </div>
                      </div>
                      
                      <div style={{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:8,padding:"4px 8px",
                        background:capImpact>0&&myCap+capImpact>theCap?"rgba(239,68,68,0.1)":"rgba(255,255,255,0.03)",borderRadius:4}}>
                        <span style={{color:T.dim}}>{"Cap impact: "+(capImpact>=0?"+":"")+"$"+capImpact.toFixed(1)+"M"}</span>
                        <span style={{color:myCap+capImpact>theCap?T.red:T.green}}>{"After: $"+(myCap+capImpact).toFixed(1)+"M / $"+theCap+"M"}</span>
                      </div>
                      
                      {(tMyP.length>0||tMyPk.length>0||tAiP.length>0||tAiPk.length>0) && (function(){
                        var myAssets=tMyP.map(function(pid){var p=my.roster.find(function(x){return x.id===pid;});return p?{type:"player",player:p}:null;}).filter(Boolean)
                          .concat(myPks2.map(function(pk){return{type:"pick",round:pk.round||1,condition:pk.condition||null};}));
                        var theirAssets=tAiP.map(function(pid){var p=aiTeam.roster.find(function(x){return x.id===pid;});return p?{type:"player",player:p}:null;}).filter(Boolean)
                          .concat(aiPks2.map(function(pk){return{type:"pick",round:pk.round||1,condition:pk.condition||null};}));
                        if(myAssets.length===0&&theirAssets.length===0)return null;
                        var ev=evaluateTradePackage(myAssets,theirAssets);
                        var verdictColor=ev.verdict==="STEAL"||ev.verdict==="GOOD_DEAL"?T.green:ev.verdict==="FAIR"?T.gold:T.red;
                        var verdictEmoji=ev.verdict==="STEAL"?"ðŸ†":ev.verdict==="GOOD_DEAL"?"âœ…":ev.verdict==="FAIR"?"âš–ï¸":ev.verdict==="SLIGHT_OVERPAY"?"âš ï¸":"âŒ";
                        var myBreakdown73=myAssets.map(function(a){
                          if(a.type==="player"){var pv73=calcTradeValue(a.player);var agePen=a.player.age>29?-(a.player.age-29)*15:0;var posMod=a.player.pos==="QB"?"1.4x":["OL","DL","CB"].indexOf(a.player.pos)>=0?"1.1x":"";
                            return {label:a.player.name+" ("+a.player.pos+" "+a.player.ovr+")",val:pv73,detail:"OVR:"+Math.round(a.player.ovr*3)+" POT:"+Math.round(a.player.pot*2)+(agePen?" Age:"+agePen:"")+(posMod?" Pos:"+posMod:"")};}
                          return {label:"Rd "+a.round+" Pick"+(a.condition?(" ("+pickConditionText972(a.condition)+")"):""),val:calcPickValue(a.round),detail:"Pick value"};
                        });
                        var theirBreakdown73=theirAssets.map(function(a){
                          if(a.type==="player"){var pv73=calcTradeValue(a.player);return {label:a.player.name+" ("+a.player.pos+" "+a.player.ovr+")",val:pv73,detail:""};}
                          return {label:"Rd "+a.round+" Pick"+(a.condition?(" ("+pickConditionText972(a.condition)+")"):""),val:calcPickValue(a.round),detail:"Pick value"};
                        });
                        return <div style={{padding:6,marginBottom:6,borderRadius:6,border:"1px solid "+verdictColor,background:"rgba(0,0,0,0.2)"}}>
                          <div style={{display:"flex",justifyContent:"space-between",fontSize:9,marginBottom:4}}>
                            <span style={{color:T.faint}}>{"ðŸ“¦ Trade Value Breakdown"}</span>
                            <span style={{color:verdictColor,fontWeight:800}}>{verdictEmoji+" "+ev.verdict.replace(/_/g," ")}</span>
                          </div>
                          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:4}}>
                            <div>
                              <div style={{fontSize:8,color:T.red,fontWeight:700,marginBottom:2}}>{"YOU GIVE ("+ev.myVal+" pts)"}</div>
                              {myBreakdown73.map(function(b,bi){return <div key={bi} style={{fontSize:9,padding:"2px 0",borderBottom:"1px solid "+T.border}}>
                                <div style={{display:"flex",justifyContent:"space-between"}}><span>{b.label}</span><span style={{fontWeight:700,color:T.orange}}>{b.val}</span></div>
                                {b.detail&&<div style={{fontSize:7,color:T.faint}}>{b.detail}</div>}
                              </div>;})}
                            </div>
                            <div>
                              <div style={{fontSize:8,color:T.green,fontWeight:700,marginBottom:2}}>{"YOU GET ("+ev.theirVal+" pts)"}</div>
                              {theirBreakdown73.map(function(b,bi){return <div key={bi} style={{fontSize:9,padding:"2px 0",borderBottom:"1px solid "+T.border}}>
                                <div style={{display:"flex",justifyContent:"space-between"}}><span>{b.label}</span><span style={{fontWeight:700,color:T.green}}>{b.val}</span></div>
                              </div>;})}
                            </div>
                          </div>
                          <div style={{display:"flex",justifyContent:"space-between",fontSize:10,fontWeight:700}}>
                            <span style={{color:ev.diff>0?T.red:T.green}}>{ev.diff>0?"Overpaying by "+ev.diff:ev.diff<0?"Winning by "+Math.abs(ev.diff):"Even deal"}</span>
                            <span style={{color:T.faint,fontSize:8}}>{ev.willAccept?"ðŸ¤ AI likely accepts":"ðŸš« AI likely rejects"}</span>
                          </div>
                        </div>;
                      })()}
                      
                      <div style={{display:"flex",gap:8}}>
                        <button style={assign({},bS(godMode?"#d946ef":T.gold,godMode?"#fff":"#000"),{flex:1,padding:"10px 0",fontSize:13,fontWeight:800})}
                          onClick={executeTrade}>{godMode?"âš¡ FORCE TRADE":"ðŸ“ž Propose Trade"}</button>
                        <button style={assign({},bS(T.bg3,T.dim),{padding:"10px 12px"})}
                          onClick={function(){setTMP([]);setTAP([]);setTMPk([]);setTAPk([]);setTMyPkCond972({});setTAiPkCond972({});setTMsg("");}}>{"Clear"}</button>
                      </div>
                      {tMsg && <div style={{marginTop:6,fontSize:11,fontWeight:600,textAlign:"center",padding:"6px 0",borderRadius:4,
                        background:tMsg.indexOf("accepted")>=0||tMsg.indexOf("GOD")>=0?"rgba(16,185,129,0.1)":"rgba(239,68,68,0.1)",
                        color:tMsg.indexOf("accepted")>=0||tMsg.indexOf("GOD")>=0?T.green:T.red}}>{tMsg}</div>}
                    </div>)}
                </div>;
              })()}
            </div>
          )}
          
          
          {tab==="teamSeasonStats" && (function(){
            var myGames=sched.filter(function(g){return g.played&&(g.home===myId||g.away===myId);});
            var homeG=myGames.filter(function(g){return g.home===myId;});
            var awayG=myGames.filter(function(g){return g.away===myId;});
            var homeW=homeG.filter(function(g){return g.result.home>g.result.away;}).length;
            var awayW=awayG.filter(function(g){return g.result.away>g.result.home;}).length;
            var streak=0;var streakType="";
            for(var si=myGames.length-1;si>=0;si--){
              var g2=myGames[si];var won=(g2.home===myId&&g2.result.home>g2.result.away)||(g2.away===myId&&g2.result.away>g2.result.home);
              var curType=won?"W":"L";
              if(si===myGames.length-1){streakType=curType;streak=1;}
              else if(curType===streakType)streak++;
              else break;
            }
            var avgPF=myGames.length>0?Math.round(my.pf/myGames.length*10)/10:0;
            var avgPA=myGames.length>0?Math.round(my.pa/myGames.length*10)/10:0;
            var rank=standings.findIndex(function(t2){return t2.id===myId;})+1;
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={cS}>
                <div style={{display:"flex",gap:12,alignItems:"center",marginBottom:12}}>
                  {React.createElement(TeamLogo,{team:my,size:40})}
                  <div>
                    <div style={{fontWeight:900,fontSize:18}}>{my.city+" "+my.name}</div>
                    <div style={{fontSize:13,color:T.dim}}>{season.year+" Season â€” Week "+season.week}</div>
                  </div>
                </div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,textAlign:"center"}}>
                  {[{label:"Record",val:my.wins+"-"+my.losses,color:my.wins>my.losses?T.green:my.wins<my.losses?T.red:T.dim},
                    {label:"Rank",val:"#"+rank+"/"+teams.length,color:rank<=8?T.green:T.dim},
                    {label:"Streak",val:streak+streakType,color:streakType==="W"?T.green:T.red},
                    {label:"Diff",val:(my.pf-my.pa>=0?"+":"")+(my.pf-my.pa),color:my.pf>=my.pa?T.green:T.red}
                  ].map(function(s2){return <div key={s2.label} style={{background:T.bg3,borderRadius:6,padding:8}}>
                    <div style={{fontSize:20,fontWeight:900,color:s2.color}}>{s2.val}</div>
                    <div style={{fontSize:9,color:T.faint}}>{s2.label}</div>
                  </div>;})}
                </div>
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:8}}>{"SPLITS"}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                  <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                    <div style={{fontWeight:700,fontSize:12}}>{"Home: "+homeW+"-"+(homeG.length-homeW)}</div>
                    <div style={{fontSize:10,color:T.dim}}>{"Avg PF: "+Math.round(homeG.reduce(function(a,g3){return a+(g3.home===myId?g3.result.home:g3.result.away);},0)/(homeG.length||1))}</div>
                  </div>
                  <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                    <div style={{fontWeight:700,fontSize:12}}>{"Away: "+awayW+"-"+(awayG.length-awayW)}</div>
                    <div style={{fontSize:10,color:T.dim}}>{"Avg PF: "+Math.round(awayG.reduce(function(a,g3){return a+(g3.home===myId?g3.result.home:g3.result.away);},0)/(awayG.length||1))}</div>
                  </div>
                </div>
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:8}}>{"SCORING"}</div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,textAlign:"center"}}>
                  <div><div style={{fontSize:18,fontWeight:800,color:T.green}}>{my.pf}</div><div style={{fontSize:9,color:T.faint}}>{"Points For"}</div></div>
                  <div><div style={{fontSize:18,fontWeight:800,color:T.red}}>{my.pa}</div><div style={{fontSize:9,color:T.faint}}>{"Points Against"}</div></div>
                  <div><div style={{fontSize:14,fontWeight:700}}>{avgPF+" / "+avgPA}</div><div style={{fontSize:9,color:T.faint}}>{"Avg PF / PA"}</div></div>
                </div>
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:8}}>{"RESULTS"}</div>
                {myGames.map(function(g3){
                  var isHome=g3.home===myId;var opp=teams.find(function(t2){return t2.id===(isHome?g3.away:g3.home);});
                  var myPts=isHome?g3.result.home:g3.result.away;var oppPts=isHome?g3.result.away:g3.result.home;
                  var won=myPts>oppPts;
                  return <div key={g3.week} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:"1px solid "+T.border,fontSize:12}}>
                    <div style={{display:"flex",gap:6,alignItems:"center"}}>
                      <span style={{color:T.faint,fontSize:10,width:30}}>{"Wk"+g3.week}</span>
                      {opp&&React.createElement(TeamLogo,{team:opp,size:18})}
                      <span>{(isHome?"vs ":"@ ")+(opp?opp.abbr:"???")}</span>
                    </div>
                    <div><span style={{fontWeight:800,color:won?T.green:T.red}}>{won?"W ":"L "}</span><span style={{fontWeight:700}}>{myPts+"-"+oppPts}</span></div>
                  </div>;
                })}
                {myGames.length===0 && <div style={{color:T.faint,fontSize:11}}>{"No games played yet."}</div>}
              </div>
            </div>;
          })()}
          
          {tab==="leagueTeamStats" && (
            <div>
              <div style={{fontWeight:700,marginBottom:8}}>{"League Team Rankings â€” "+season.year}</div>
              <div style={{overflowX:"auto"}}>
              <table style={tS}><thead><tr>
                {["#","","Team","W","L","PF","PA","DIFF","PPG","PAPG"].map(function(h){return <th key={h} style={thS}>{h}</th>;})}
              </tr></thead>
              <tbody>{standings.map(function(t2,i){
                var gp2=t2.wins+t2.losses;var ppg=gp2>0?Math.round(t2.pf/gp2*10)/10:0;var papg=gp2>0?Math.round(t2.pa/gp2*10)/10:0;
                var diff=t2.pf-t2.pa;var isMe=t2.id===myId;
                return <tr key={t2.id} style={{background:isMe?"rgba(212,167,75,0.08)":"transparent"}}>
                  <td style={assign({},tdS,{fontWeight:700,color:i<8?T.green:T.faint})}>{i+1}</td>
                  <td style={assign({},tdS,{padding:"2px 4px"})}>{React.createElement(TeamLogo,{team:t2,size:18})}</td>
                  <td style={assign({},tdS,{fontWeight:isMe?800:600})}>{t2.abbr}</td>
                  <td style={assign({},tdS,{fontWeight:700})}>{t2.wins}</td>
                  <td style={tdS}>{t2.losses}</td>
                  <td style={assign({},tdS,{color:T.green})}>{t2.pf}</td>
                  <td style={assign({},tdS,{color:T.red})}>{t2.pa}</td>
                  <td style={assign({},tdS,{fontWeight:700,color:diff>=0?T.green:T.red})}>{(diff>=0?"+":"")+diff}</td>
                  <td style={tdS}>{ppg}</td>
                  <td style={tdS}>{papg}</td>
                </tr>;
              })}</tbody></table>
              </div>
              <div style={{fontSize:9,color:T.faint,marginTop:6}}>{"Green ranks = playoff position (top 8). Your team highlighted in gold."}</div>
            </div>
          )}
          
          {tab==="playerTeamStats" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:700,marginBottom:4}}>{my.city+" "+my.name+" â€” Individual Stats"}</div>
              {[{title:"PASSING",players:my.roster.filter(function(p){return p.stats.passYds>0;}).sort(function(a,b){return b.stats.passYds-a.stats.passYds;}),
                cols:[["GP","gp"],["YDS","passYds"],["TD","passTD"],["INT","int"]]},
                {title:"RUSHING",players:my.roster.filter(function(p){return p.stats.rushYds>0;}).sort(function(a,b){return b.stats.rushYds-a.stats.rushYds;}),
                cols:[["GP","gp"],["YDS","rushYds"],["TD","rushTD"]]},
                {title:"RECEIVING",players:my.roster.filter(function(p){return p.stats.rec>0;}).sort(function(a,b){return b.stats.recYds-a.stats.recYds;}),
                cols:[["GP","gp"],["REC","rec"],["YDS","recYds"],["TD","recTD"],["TGT","targets"],["DRP","drops"]]},
                {title:"DEFENSE",players:my.roster.filter(function(p){return(p.stats.sacks||0)>0||(p.stats.tackles||0)>0||(p.stats.defINT||0)>0;}).sort(function(a,b){return(b.stats.sacks||0)*3+(b.stats.defINT||0)*5+(b.stats.tackles||0)-(a.stats.sacks||0)*3-(a.stats.defINT||0)*5-(a.stats.tackles||0);}),
                cols:[["GP","gp"],["TKL","tackles"],["SK","sacks"],["INT","defINT"]]},
                {title:"KICKING",players:my.roster.filter(function(p){return(p.stats.fgA||0)>0;}).sort(function(a,b){return(b.stats.fgM||0)-(a.stats.fgM||0);}),
                cols:[["GP","gp"],["FGM","fgM"],["FGA","fgA"]]},
                {title:"PUNTING",players:my.roster.filter(function(p){return(p.stats.punts||0)>0;}).sort(function(a,b){return(b.stats.punts||0)-(a.stats.punts||0);}),
                cols:[["GP","gp"],["PNT","punts"],["YDS","puntYds"]]}
              ].map(function(sec){
                if(sec.players.length===0) return null;
                return <div key={sec.title} style={cS}>
                  <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:6}}>{sec.title}</div>
                  <table style={tS}><thead><tr><th style={thS}>Name</th><th style={thS}>Pos</th>
                    {sec.cols.map(function(c){return <th key={c[0]} style={thS}>{c[0]}</th>;})}</tr></thead>
                    <tbody>{sec.players.map(function(p){return <tr key={p.id}>
                      <td style={assign({},tdS,{fontWeight:600,cursor:"pointer",textDecoration:"underline",textDecorationColor:T.border})} onClick={function(){setPlayerDetail(p);}}>{p.name}</td>
                      <td style={assign({},tdS,{color:T.gold})}>{p.pos}</td>
                      {sec.cols.map(function(c){return <td key={c[0]} style={assign({},tdS,{fontWeight:700})}>{p.stats[c[1]]||0}</td>;})}</tr>;})}</tbody></table>
                </div>;
              })}
            </div>
          )}
          
          {tab==="playerLeagueStats" && (function(){
            var wk73=Math.max(season.week||1,1);var gamesPlayed73=Math.max(wk73-1,1);var totalWeeks73=17;
            var paceMulti73=gamesPlayed73>0?totalWeeks73/gamesPlayed73:1;
            var allPlayers73=teams.reduce(function(acc,t2){return acc.concat(t2.roster.map(function(p){return assign({},p,{tA:t2.abbr,tIcon:t2.icon,tId:t2.id});}));},[]);
            var qbRating73=function(p){
              var att=(p.stats.passYds||0)>0?Math.max(Math.round((p.stats.passYds||0)/((p.stats.passYds||0)/7.5+1)),1):1;// approximate attempts
              var comp=att>0?(p.stats.passYds||0)/att/7.5:0;// rough comp%
              var a=cl(((comp-0.3)*5),0,2.375);
              var b=cl(((((p.stats.passTD||0)/att)-0.095)*20/3),0,2.375);
              var c=cl((0.095-(p.stats.int||0)/att)*25,0,2.375);
              var d=cl(((p.stats.passYds||0)/att-3)*0.25,0,2.375);
              return Math.round((a+b+c+d)/6*100*10)/10;
            };
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:700,marginBottom:4}}>{"ðŸˆ League Individual Leaders â€” "+season.year+(gamesPlayed73<totalWeeks73?" (Week "+wk73+")":"")}</div>
              {gamesPlayed73>2&&gamesPlayed73<totalWeeks73&&<div style={assign({},cS,{background:"rgba(212,167,75,0.04)",borderColor:T.gold})}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:4}}>{"ðŸ“Š ON PACE FOR ("+totalWeeks73+"-game pace)"}</div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6,fontSize:10}}>
                  {(function(){
                    var topQB=allPlayers73.filter(function(p){return(p.stats.passYds||0)>200;}).sort(function(a,b){return(b.stats.passYds||0)-(a.stats.passYds||0);})[0];
                    var topRB=allPlayers73.filter(function(p){return(p.stats.rushYds||0)>50;}).sort(function(a,b){return(b.stats.rushYds||0)-(a.stats.rushYds||0);})[0];
                    var topWR=allPlayers73.filter(function(p){return(p.stats.recYds||0)>50;}).sort(function(a,b){return(b.stats.recYds||0)-(a.stats.recYds||0);})[0];
                    var topSK=allPlayers73.filter(function(p){return(p.stats.sacks||0)>0;}).sort(function(a,b){return(b.stats.sacks||0)-(a.stats.sacks||0);})[0];
                    var paces=[];
                    if(topQB)paces.push({label:topQB.name+" ("+topQB.tA+")",stat:Math.round((topQB.stats.passYds||0)*paceMulti73)+" pass yds"});
                    if(topRB)paces.push({label:topRB.name+" ("+topRB.tA+")",stat:Math.round((topRB.stats.rushYds||0)*paceMulti73)+" rush yds"});
                    if(topWR)paces.push({label:topWR.name+" ("+topWR.tA+")",stat:Math.round((topWR.stats.recYds||0)*paceMulti73)+" rec yds"});
                    if(topSK)paces.push({label:topSK.name+" ("+topSK.tA+")",stat:Math.round((topSK.stats.sacks||0)*paceMulti73)+" sacks"});
                    return paces.map(function(pc,pi){return <div key={pi} style={{padding:4,background:T.bg3,borderRadius:4}}>
                      <div style={{fontWeight:700,color:T.gold}}>{pc.stat}</div>
                      <div style={{fontSize:8,color:T.faint}}>{pc.label}</div>
                    </div>;});
                  })()}
                </div>
              </div>}
              {[{title:"PASSING YARDS",pool:allPlayers73,
                filter:function(p){return(p.stats.passYds||0)>0;},sort:function(a,b){return(b.stats.passYds||0)-(a.stats.passYds||0);},
                cols:[["YDS","passYds"],["TD","passTD"],["INT","int"],["RTG","_qbRtg"]]},
                {title:"PASSING TOUCHDOWNS",pool:allPlayers73,
                filter:function(p){return(p.stats.passTD||0)>0;},sort:function(a,b){return(b.stats.passTD||0)-(a.stats.passTD||0);},
                cols:[["TD","passTD"],["YDS","passYds"],["INT","int"]]},
                {title:"RUSHING YARDS",pool:allPlayers73,
                filter:function(p){return(p.stats.rushYds||0)>0;},sort:function(a,b){return(b.stats.rushYds||0)-(a.stats.rushYds||0);},
                cols:[["YDS","rushYds"],["TD","rushTD"],["GP","_gp"]]},
                {title:"RUSHING TOUCHDOWNS",pool:allPlayers73,
                filter:function(p){return(p.stats.rushTD||0)>0;},sort:function(a,b){return(b.stats.rushTD||0)-(a.stats.rushTD||0);},
                cols:[["TD","rushTD"],["YDS","rushYds"]]},
                {title:"RECEIVING YARDS",pool:allPlayers73,
                filter:function(p){return(p.stats.recYds||0)>0;},sort:function(a,b){return(b.stats.recYds||0)-(a.stats.recYds||0);},
                cols:[["REC","rec"],["YDS","recYds"],["TD","recTD"],["YAC","yac"]]},
                {title:"RECEPTIONS",pool:allPlayers73,
                filter:function(p){return(p.stats.rec||0)>0;},sort:function(a,b){return(b.stats.rec||0)-(a.stats.rec||0);},
                cols:[["REC","rec"],["YDS","recYds"],["TD","recTD"],["TGT","targets"]]},
                {title:"TOTAL TOUCHDOWNS",pool:allPlayers73,
                filter:function(p){return((p.stats.rushTD||0)+(p.stats.recTD||0))>0;},sort:function(a,b){return((b.stats.rushTD||0)+(b.stats.recTD||0))-((a.stats.rushTD||0)+(a.stats.recTD||0));},
                cols:[["TOT","_totTD"],["RUSH","rushTD"],["REC","recTD"]]},
                {title:"SACKS",pool:allPlayers73,
                filter:function(p){return(p.stats.sacks||0)>0;},sort:function(a,b){return(b.stats.sacks||0)-(a.stats.sacks||0);},
                cols:[["SK","sacks"],["TKL","tackles"]]},
                {title:"TACKLES",pool:allPlayers73,
                filter:function(p){return(p.stats.tackles||0)>0;},sort:function(a,b){return(b.stats.tackles||0)-(a.stats.tackles||0);},
                cols:[["TKL","tackles"],["SK","sacks"],["INT","defINT"]]},
                {title:"INTERCEPTIONS",pool:allPlayers73,
                filter:function(p){return(p.stats.defINT||0)>0;},sort:function(a,b){return(b.stats.defINT||0)-(a.stats.defINT||0);},
                cols:[["INT","defINT"],["TKL","tackles"]]},
                {title:"FIELD GOALS",pool:allPlayers73,
                filter:function(p){return(p.stats.fgA||0)>0;},sort:function(a,b){return(b.stats.fgM||0)-(a.stats.fgM||0);},
                cols:[["FGM","fgM"],["FGA","fgA"],["PCT","_fgPct"]]},
                {title:"PUNTING",pool:allPlayers73,
                filter:function(p){return(p.stats.punts||0)>0;},sort:function(a,b){var aAvg=a.stats.punts>0?a.stats.puntYds/a.stats.punts:0;var bAvg=b.stats.punts>0?b.stats.puntYds/b.stats.punts:0;return bAvg-aAvg;},
                cols:[["PNT","punts"],["YDS","puntYds"],["AVG","_puntAvg"]]}
              ].map(function(sec){
                var data2=sec.pool.filter(sec.filter).sort(sec.sort).slice(0,10);
                if(data2.length===0) return null;
                return <div key={sec.title} style={cS}>
                  <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:6}}>{sec.title}</div>
                  <table style={tS}><thead><tr><th style={thS}>#</th><th style={thS}>Name</th><th style={thS}>Pos</th><th style={thS}>Tm</th>
                    {sec.cols.map(function(c){return <th key={c[0]} style={thS}>{c[0]}</th>;})}</tr></thead>
                    <tbody>{data2.map(function(p,i){
                      var isMe2=p.tId===myId;
                      return <tr key={i} style={{background:isMe2?"rgba(212,167,75,0.06)":"transparent"}}>
                        <td style={assign({},tdS,{color:i===0?T.gold:T.dim,fontWeight:i<3?700:400})}>{i+1}</td>
                        <td style={assign({},tdS,{fontWeight:600,cursor:"pointer"})} onClick={function(){setPlayerDetail(p);}}>{p.name}</td>
                        <td style={assign({},tdS,{color:T.gold,fontSize:10})}>{p.pos}</td>
                        <td style={assign({},tdS,{fontSize:10})}>{p.tIcon+" "+p.tA}</td>
                        {sec.cols.map(function(c){
                          var val=c[1]==="_puntAvg"?(p.stats.punts>0?Math.round(p.stats.puntYds/p.stats.punts*10)/10:0)
                            :c[1]==="_qbRtg"?qbRating73(p)
                            :c[1]==="_gp"?(p.stats.gp||0)
                            :c[1]==="_totTD"?((p.stats.rushTD||0)+(p.stats.recTD||0))
                            :c[1]==="_fgPct"?((p.stats.fgA||0)>0?Math.round((p.stats.fgM||0)/(p.stats.fgA||0)*1000)/10:0)
                            :(p.stats[c[1]]||0);
                          return <td key={c[0]} style={assign({},tdS,{fontWeight:700})}>{val}</td>;
                        })}</tr>;
                    })}</tbody></table>
                </div>;
              })}
            </div>;
          })()}
          
          {tab==="seasonCompare" && (function(){
            var currentSeason={year:season.year,wins:my.wins,losses:my.losses,pf:my.pf,pa:my.pa,
              gp:my.wins+my.losses,ppg:((my.wins+my.losses)>0?Math.round(my.pf/(my.wins+my.losses)*10)/10:0),
              rank:standings.findIndex(function(t2){return t2.id===myId;})+1,coach:my.staff.hc.name};
            var pastSeasons=history.filter(function(h){return h.teamRecords;}).map(function(h){
              var myRec=h.teamRecords?h.teamRecords.find(function(r){return r.id===myId;}):null;
              return {year:h.year,wins:myRec?myRec.wins:0,losses:myRec?myRec.losses:0,
                pf:myRec?myRec.pf:0,pa:myRec?myRec.pa:0,
                gp:(myRec?myRec.wins:0)+(myRec?myRec.losses:0),
                ppg:(myRec&&(myRec.wins+myRec.losses)>0)?Math.round(myRec.pf/(myRec.wins+myRec.losses)*10)/10:0,
                champion:h.winnerId===myId,mvp:h.mvp?h.mvp.name:"",mvpTm:h.mvp?h.mvp.tm:"",
                opoy:h.opoy?h.opoy.name:"",dpoy:h.dpoy?h.dpoy.name:"",roy:h.roy?h.roy.name:"",
                coty:h.coty?h.coty.name:""};
            });
            var allSeasons=[currentSeason].concat(pastSeasons);
            var totalW=allSeasons.reduce(function(a,s2){return a+s2.wins;},0);
            var totalL=allSeasons.reduce(function(a,s2){return a+s2.losses;},0);
            var totalG=totalW+totalL;
            var winPct=totalG>0?Math.round(totalW/totalG*1000)/10:0;
            var chips=allSeasons.filter(function(s2){return s2.champion;}).length;
            var bestSzn=allSeasons.filter(function(s2){return s2.gp>0;}).sort(function(a,b){return b.wins-a.wins||(b.pf-b.pa)-(a.pf-a.pa);})[0];
            var worstSzn=allSeasons.filter(function(s2){return s2.gp>0;}).sort(function(a,b){return a.wins-b.wins||(a.pf-a.pa)-(b.pf-b.pa);})[0];
            var myAwards=history.filter(function(h){return h.mvp&&h.mvp.tm===my.abbr;});
            var myOPOY=history.filter(function(h){return h.opoy&&h.opoy.tm===my.abbr;});
            var myDPOY=history.filter(function(h){return h.dpoy&&h.dpoy.tm===my.abbr;});
            var myROY=history.filter(function(h){return h.roy&&h.roy.tm===my.abbr;});

            // DYNASTY_REPORT v27: MFSN franchise narrative broadcast header for seasonCompare
            var DR_TIERS=[
              {label:"DYNASTY",desc:"Multiple titles. All-time caliber. Your name is already in the history books.",color:"#fbbf24",bg:"rgba(251,191,36,0.12)",border:"rgba(251,191,36,0.4)",icon:"ðŸ‘‘",minChips:2,minWinPct:58},
              {label:"CONTENDER",desc:"Consistently winning, chasing the title. This window is real â€” don't waste it.",color:"#34d399",bg:"rgba(52,211,153,0.10)",border:"rgba(52,211,153,0.35)",icon:"ðŸ†",minChips:1,minWinPct:52},
              {label:"RISING",desc:"Win percentage trending up. The foundation is there. The ceiling is undefined.",color:"#22d3ee",bg:"rgba(34,211,238,0.10)",border:"rgba(34,211,238,0.3)",icon:"ðŸ“ˆ",minChips:0,minWinPct:50},
              {label:"FIGHTING",desc:"Below .500 but competing. Every game is a statement. Keep pushing.",color:"#f97316",bg:"rgba(249,115,22,0.10)",border:"rgba(249,115,22,0.3)",icon:"ðŸ”¥",minChips:0,minWinPct:40},
              {label:"REBUILDING",desc:"The reset is on. Patience is a strategy. Future assets are the priority now.",color:"#94a3b8",bg:"rgba(148,163,184,0.08)",border:"rgba(148,163,184,0.2)",icon:"ðŸ”¨",minChips:0,minWinPct:0}
            ];
            var DR_ARC_ID={BREAKOUT:"A BREAKOUT arc player is the engine of this franchise right now. Build everything around the window.",ELITE:"An ELITE arc player as the cornerstone of a franchise means sustained excellence. Protect this at all costs.",SLUMP:"A SLUMP arc on your marquee player is a warning sign. Address it in training, address it in culture.",COMEBACK:"A COMEBACK story defines a franchise's character. This team is fighting â€” and it shows.",DECLINE:"Aging great in decline. The tough conversation is coming. How you handle it defines the next era.",HOLDOUT:"A contract dispute clouds the franchise identity. Resolve this quickly â€” the team needs clarity.",SWAN_SONG:"One of the greats is writing their final chapter in your uniform. Make it count.",MENTOR:"A veteran in MENTOR mode is quietly shaping the next era of this franchise. That's leadership."};
            var DR_TRAJ={up:["The trend line is clear â€” this franchise is ascending. Sim those weeks, win those games.","Back-to-back improvement years mean something. This isn't an accident.","Winning breeds winning. The culture in that locker room is shifting."],down:["The numbers don't lie â€” this franchise is trending the wrong way. Time for a hard conversation.","Regression is data. What's the plan to reverse it?","Consecutive losing years means something needs to change. Scheme? Personnel? Culture? Find it."],flat:["Steady performance, unclear ceiling. Consistency is valuable but plateaus are dangerous.","Middle-of-the-pack is the most dangerous place in this league. Go up or go down â€” decide.","The franchise is treading water. That's better than sinking, but it's not winning."]};
            var dr_tier27=DR_TIERS[DR_TIERS.length-1];
            for(var dti27=0;dti27<DR_TIERS.length;dti27++){var dt27=DR_TIERS[dti27];if(chips>=dt27.minChips&&winPct>=dt27.minWinPct){dr_tier27=dt27;break;}}
            var dr_trend27="flat";
            if(allSeasons.length>=3){var s0_27=allSeasons[0];var s1_27=allSeasons[1];var s2_27=allSeasons[2];if(s0_27.wins>=s1_27.wins&&s1_27.wins>=s2_27.wins)dr_trend27="up";else if(s0_27.wins<=s1_27.wins&&s1_27.wins<=s2_27.wins)dr_trend27="down";}
            else if(allSeasons.length>=2){dr_trend27=allSeasons[0].wins>=allSeasons[1].wins?"up":"down";}
            var dr_trajLine27=(DR_TRAJ[dr_trend27]||DR_TRAJ.flat)[Math.floor(RNG.ui()*3)%3];
            var drArcOrder27=["BREAKOUT","ELITE","COMEBACK","SWAN_SONG","HOLDOUT","SLUMP","DECLINE","MENTOR"];
            var drArcStar27=null;var drArcKey27=null;
            for(var dap27=0;dap27<drArcOrder27.length;dap27++){var drFound=(my.roster||[]).find(function(p){return p&&p._arcState===drArcOrder27[dap27]&&(p.ovr||0)>=72&&p.isStarter;});if(drFound){drArcStar27=drFound;drArcKey27=drArcOrder27[dap27];break;}}
            var drArcInfo27=drArcStar27?(ARC_SPOTLIGHT.lines[drArcKey27]||{}):null;
            var drTrajC27=dr_trend27==="up"?T.green:dr_trend27==="down"?T.red:T.orange;
            var drTrajI27=dr_trend27==="up"?"ðŸ“ˆ":dr_trend27==="down"?"ðŸ“‰":"âž¡ï¸";

            return <div style={{display:"flex",flexDirection:"column",gap:8}}>

              {/* DYNASTY_REPORT: MFSN FRANCHISE REPORT HEADER */}
              <div style={{background:"linear-gradient(135deg,"+dr_tier27.bg+",rgba(0,0,0,0.9))",border:"2px solid "+dr_tier27.border,borderRadius:12,padding:"12px 14px"}}>
                <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}>
                  <div style={{fontSize:28,lineHeight:1}}>{dr_tier27.icon}</div>
                  <div style={{flex:1}}>
                    <div style={{fontSize:9,fontWeight:700,color:dr_tier27.color,letterSpacing:2,marginBottom:2}}>{"MFSN FRANCHISE REPORT â€” "+season.year}</div>
                    <div style={{fontSize:16,fontWeight:900,color:"#fff"}}>{my.city+" "+my.name}</div>
                    <div style={{fontSize:10,color:T.dim,marginTop:1}}>{"Coach: "+my.staff.hc.name+" | "+totalW+"-"+totalL+" all-time | "+chips+" title"+(chips===1?"":"s")}</div>
                  </div>
                  <div style={{textAlign:"right"}}>
                    <div style={{fontSize:11,fontWeight:900,color:dr_tier27.color,padding:"4px 10px",background:"rgba(255,255,255,0.06)",borderRadius:6,border:"1px solid "+dr_tier27.border}}>{dr_tier27.label}</div>
                    <div style={{fontSize:9,color:drTrajC27,marginTop:4,fontWeight:700}}>{drTrajI27+" "+dr_trend27.toUpperCase()}</div>
                  </div>
                </div>
                <div style={{fontSize:11,color:"#e2e8f0",fontStyle:"italic",borderLeft:"2px solid "+dr_tier27.border,paddingLeft:8,lineHeight:1.5,marginBottom:6}}>{dr_tier27.desc}</div>
                <div style={{fontSize:10,color:T.dim,fontStyle:"italic",borderLeft:"2px solid "+drTrajC27+"55",paddingLeft:8,lineHeight:1.5}}>{dr_trajLine27}</div>
              </div>

              {/* ARC IDENTITY PANEL â€” only when marquee arc player on roster */}
              {drArcStar27&&drArcInfo27&&DR_ARC_ID[drArcKey27]?<div style={{background:"linear-gradient(135deg,rgba(139,92,246,0.12),rgba(0,0,0,0.8))",border:"1px solid rgba(139,92,246,0.3)",borderRadius:10,padding:12}}>
                <div style={{fontWeight:800,fontSize:11,color:"#a78bfa",marginBottom:8,letterSpacing:1}}>{"ðŸŽ­ FRANCHISE ARC IDENTITY"}</div>
                <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}>
                  {React.createElement(PlayerFace,{id:drArcStar27.id,morale:drArcStar27.morale||70,size:36,age:drArcStar27.age})}
                  <div style={{flex:1}}>
                    <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:3}}>
                      <span style={{fontWeight:900,fontSize:13,cursor:"pointer"}} onClick={function(){setPlayerDetail(drArcStar27);}}>{drArcStar27.name}</span>
                      <span style={{fontSize:9,fontWeight:700,color:"#a78bfa"}}>{drArcStar27.pos}</span>
                      {drArcInfo27.badge&&<span style={{fontSize:9,fontWeight:800,color:drArcInfo27.badgeColor||"#a78bfa",padding:"2px 6px",background:"rgba(167,139,250,0.12)",borderRadius:3}}>{drArcInfo27.badge}</span>}
                    </div>
                    <div style={{fontSize:10,color:T.dim}}>{"OVR "+(drArcStar27.ovr||0)+" | "+drArcStar27.pos+" | Age "+drArcStar27.age}</div>
                  </div>
                </div>
                <div style={{fontSize:11,color:"#e2e8f0",fontStyle:"italic",borderLeft:"3px solid rgba(139,92,246,0.4)",paddingLeft:8,lineHeight:1.5}}>{DR_ARC_ID[drArcKey27]}</div>
              </div>:null}

              <div style={{fontWeight:800,fontSize:13,color:T.gold}}>{"ðŸ“Š FRANCHISE DASHBOARD â€” "+my.city+" "+my.name}</div>
              
              <div style={assign({},cS,{borderColor:T.gold,background:"rgba(212,167,75,0.04)"})}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:8}}>{"FRANCHISE OVERVIEW"}</div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,textAlign:"center"}}>
                  <div><div style={{fontSize:20,fontWeight:900}}>{totalW+"-"+totalL}</div><div style={{fontSize:8,color:T.faint}}>{"All-Time"}</div></div>
                  <div><div style={{fontSize:20,fontWeight:900,color:winPct>=55?T.green:winPct>=45?T.gold:T.red}}>{winPct+"%"}</div><div style={{fontSize:8,color:T.faint}}>{"Win %"}</div></div>
                  <div><div style={{fontSize:20,fontWeight:900,color:T.gold}}>{chips}</div><div style={{fontSize:8,color:T.faint}}>{"Titles"}</div></div>
                  <div><div style={{fontSize:20,fontWeight:900,color:T.purple}}>{allSeasons.length}</div><div style={{fontSize:8,color:T.faint}}>{"Seasons"}</div></div>
                </div>
                {bestSzn && <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:10}}>
                  <div style={{background:T.bg3,borderRadius:6,padding:8,borderLeft:"3px solid "+T.green}}>
                    <div style={{fontSize:8,color:T.faint,marginBottom:2}}>{"BEST SEASON"}</div>
                    <div style={{fontSize:14,fontWeight:800,color:T.green}}>{bestSzn.wins+"-"+bestSzn.losses}</div>
                    <div style={{fontSize:9,color:T.dim}}>{bestSzn.year+(bestSzn.champion?" ðŸ†":"")}</div>
                  </div>
                  <div style={{background:T.bg3,borderRadius:6,padding:8,borderLeft:"3px solid "+T.red}}>
                    <div style={{fontSize:8,color:T.faint,marginBottom:2}}>{"WORST SEASON"}</div>
                    <div style={{fontSize:14,fontWeight:800,color:T.red}}>{worstSzn?worstSzn.wins+"-"+worstSzn.losses:"â€”"}</div>
                    <div style={{fontSize:9,color:T.dim}}>{worstSzn?worstSzn.year:""}</div>
                  </div>
                </div>}
              </div>
              
              {allSeasons.length>0 && allSeasons[0].gp>0 ? <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.cyan,marginBottom:6}}>{"SEASON-BY-SEASON"}</div>
                <div style={{overflowX:"auto"}}>
                <table style={tS}><thead><tr>
                  {["Year","W","L","PF","PA","Â±","PPG","Rank",""].map(function(h){return <th key={h} style={thS}>{h}</th>;})}
                </tr></thead>
                <tbody>{allSeasons.map(function(s2,si){
                  var diff2=s2.pf-s2.pa;var isCurrent=si===0;
                  var isBest=bestSzn&&s2.year===bestSzn.year&&s2.gp>0;
                  return <tr key={s2.year+"-"+si} style={{background:isCurrent?"rgba(212,167,75,0.08)":isBest?"rgba(16,185,129,0.05)":"transparent"}}>
                    <td style={assign({},tdS,{fontWeight:800})}>{s2.year+(isCurrent?" â†":"")}</td>
                    <td style={assign({},tdS,{fontWeight:700,color:s2.wins>=10?T.green:s2.wins>=7?T.gold:T.red})}>{s2.wins}</td>
                    <td style={assign({},tdS,{color:T.red})}>{s2.losses}</td>
                    <td style={tdS}>{s2.pf}</td>
                    <td style={tdS}>{s2.pa}</td>
                    <td style={assign({},tdS,{fontWeight:700,color:diff2>=0?T.green:T.red})}>{(diff2>=0?"+":"")+diff2}</td>
                    <td style={tdS}>{s2.ppg}</td>
                    <td style={tdS}>{s2.rank?"#"+s2.rank:"â€”"}</td>
                    <td style={tdS}>{s2.champion?"ðŸ†":s2.mvpTm===my.abbr?"ðŸ…":""}</td>
                  </tr>;
                })}</tbody></table>
                </div>
              </div>:null}
              
              {(myAwards.length>0||myOPOY.length>0||myDPOY.length>0||myROY.length>0) && <div style={assign({},cS,{borderColor:"rgba(167,139,250,0.3)"})}>
                <div style={{fontWeight:700,fontSize:11,color:T.purple,marginBottom:8}}>{"ðŸ… AWARDS CABINET"}</div>
                {myAwards.length>0 && <div style={{marginBottom:6}}>
                  <div style={{fontSize:10,fontWeight:700,color:T.gold}}>{"MVPÃ—"+myAwards.length}</div>
                  {myAwards.map(function(h,i){return <div key={i} style={{fontSize:9,color:T.dim}}>{h.year+": "+h.mvp.name+" ("+h.mvp.pos+")"}</div>;})}
                </div>}
                {myOPOY.length>0 && <div style={{marginBottom:6}}>
                  <div style={{fontSize:10,fontWeight:700,color:T.cyan}}>{"OPOYÃ—"+myOPOY.length}</div>
                  {myOPOY.map(function(h,i){return <div key={i} style={{fontSize:9,color:T.dim}}>{h.year+": "+h.opoy.name}</div>;})}
                </div>}
                {myDPOY.length>0 && <div style={{marginBottom:6}}>
                  <div style={{fontSize:10,fontWeight:700,color:T.green}}>{"DPOYÃ—"+myDPOY.length}</div>
                  {myDPOY.map(function(h,i){return <div key={i} style={{fontSize:9,color:T.dim}}>{h.year+": "+h.dpoy.name}</div>;})}
                </div>}
                {myROY.length>0 && <div>
                  <div style={{fontSize:10,fontWeight:700,color:T.orange}}>{"ROYÃ—"+myROY.length}</div>
                  {myROY.map(function(h,i){return <div key={i} style={{fontSize:9,color:T.dim}}>{h.year+": "+h.roy.name}</div>;})}
                </div>}
              </div>}
              
              {pastSeasons.length>0 && <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.cyan,marginBottom:8}}>{"ðŸ“ˆ WIN TREND"}</div>
                <div style={{display:"flex",alignItems:"flex-end",gap:3,height:80}}>
                  {allSeasons.slice().reverse().map(function(s2,si){
                    var maxW=16;var h2=Math.max(4,(s2.wins/maxW)*70);
                    var col=s2.champion?"#fbbf24":s2.wins>=10?"#10b981":s2.wins>=7?"#fbbf24":"#ef4444";
                    return <div key={si} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center"}}>
                      <div style={{fontSize:8,color:T.dim,marginBottom:2}}>{s2.wins}</div>
                      <div style={{width:"100%",height:h2,background:col,borderRadius:2,minHeight:4}}></div>
                      <div style={{fontSize:7,color:T.faint,marginTop:2}}>{String(s2.year).slice(-2)}</div>
                    </div>;
                  })}
                </div>
              </div>}
              
              {pastSeasons.length>0 && <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.orange,marginBottom:8}}>{"ðŸ“Š POINT DIFFERENTIAL"}</div>
                <div style={{display:"flex",alignItems:"center",gap:3,height:60}}>
                  {allSeasons.slice().reverse().map(function(s2,si){
                    var diff3=s2.pf-s2.pa;var maxDiff=200;
                    var h3=Math.abs(diff3)/maxDiff*25;
                    var col2=diff3>=0?"#10b981":"#ef4444";
                    return <div key={si} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}}>
                      <div style={{fontSize:7,color:col2,marginBottom:1}}>{(diff3>=0?"+":"")+diff3}</div>
                      <div style={{width:"100%",height:Math.max(3,h3),background:col2,borderRadius:2}}></div>
                      <div style={{fontSize:7,color:T.faint,marginTop:1}}>{String(s2.year).slice(-2)}</div>
                    </div>;
                  })}
                </div>
              </div>}
            </div>;
          })()}
          
          {tab==="draft" && (
            <div>
              {/* â”€â”€ WAR_ROOM: MFSN Draft Ticker â”€â”€ */}
              {(function(){
                var tickerItems=mfsnTicker.length>0?mfsnTicker:WAR_ROOM_TICKERS;
                var currentTick=tickerItems[Math.floor(Date.now()/5000)%tickerItems.length];
                return React.createElement("div",{style:{background:"linear-gradient(90deg,rgba(239,68,68,0.15),rgba(251,191,36,0.1),rgba(239,68,68,0.15))",borderBottom:"1px solid rgba(239,68,68,0.3)",padding:"5px 12px",display:"flex",alignItems:"center",gap:8,marginBottom:8,borderRadius:6,overflow:"hidden"}},
                  React.createElement("span",{style:{fontSize:8,fontWeight:900,color:"#ef4444",letterSpacing:2,whiteSpace:"nowrap"}},"ðŸ“¡ MFSN LIVE"),
                  React.createElement("span",{style:{fontSize:9,color:T.gold,fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},currentTick)
                );
              })()}
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:8}}>
                <div style={{fontWeight:700}}>{"Draft â€” "+(dPk<draftBoard.length?"Pick #"+(draftBoard[dPk]?draftBoard[dPk].pickNum:"?")+" (Rd"+(draftBoard[dPk]?draftBoard[dPk].round:"?")+")":"Complete")}</div>
                <div style={{fontSize:10,color:T.dim}}>{"Your picks: "+draftBoard.filter(function(pk){return pk.ownerId===myId;}).length+" | Board: "+draftBoard.length+" total"}</div>
              </div>
              {/* â”€â”€ WAR_ROOM: Pick Clock (only when user is on the clock) â”€â”€ */}
              {dPk<draftBoard.length&&draftBoard[dPk]&&draftBoard[dPk].ownerId===myId&&dc.length>0&&(function(){
                function handleClockExpire(){
                  // Auto-pick BPA on clock expiry
                  var bpa=dc[0];if(!bpa)return;
                  addN("â±ï¸ CLOCK EXPIRED â€” Auto-picking BPA: "+bpa.name+" ("+bpa.pos+" "+bpa.ovr+")","orange");
                  doDraftPick(bpa);
                }
                return React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(251,191,36,0.08),rgba(15,23,42,0.95))",border:"2px solid rgba(251,191,36,0.4)",borderRadius:12,padding:"12px",marginBottom:8,textAlign:"center"}},
                  React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,letterSpacing:3,marginBottom:4}},"ðŸŽ¯ YOU'RE ON THE CLOCK"),
                  React.createElement(DraftClock,{key:draftClockKey,seconds:draftClockSec,onExpire:handleClockExpire}),
                  React.createElement("div",{style:{fontSize:10,color:T.dim,marginTop:4}},
                    "Pick #"+(draftBoard[dPk].pickNum)+" â€¢ Round "+(draftBoard[dPk].round)+" â€¢ "+
                    (dc.length>0?"BPA: "+dc[0].name+" ("+dc[0].pos+" "+dc[0].ovr+")":""))
                );
              })()}
              
              {season.phase==="draft"&&dc&&dc.length>0&&dPk<draftBoard.length&&(function(){
                var maxScouts78=SCOUT_NETWORK.maxScouts;
                var used78=scoutUsed78.length;
                return React.createElement("div",{style:mS(S.card,{padding:8,marginBottom:8,borderColor:"rgba(34,211,238,0.15)",background:"rgba(34,211,238,0.02)"})},
                  React.createElement("div",{style:{fontSize:10,fontWeight:800,color:T.cyan,marginBottom:4}},"ðŸ” SCOUT NETWORK ("+used78+"/"+maxScouts78+" regions scouted)"),
                  React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:4}},
                    SCOUT_NETWORK.regions.map(function(reg78){
                      var isScouted=scoutUsed78.indexOf(reg78.id)>=0;
                      var canScout=used78<maxScouts78&&!isScouted;
                      return React.createElement("button",{key:reg78.id,
                        style:assign({},bS(isScouted?T.green:canScout?T.cyan:T.bg3,isScouted?"#000":canScout?"#000":T.faint),
                          {padding:"3px 8px",fontSize:9,borderRadius:6,opacity:canScout||isScouted?1:0.5}),
                        disabled:!canScout,
                        onClick:canScout?function(){
                          SCOUT_NETWORK.scoutRegion(reg78.id,dc);
                          var newUsed=scoutUsed78.slice();newUsed.push(reg78.id);
                          setScoutUsed78(newUsed);
                          var count78=dc.filter(function(p){return p._scoutRegion78===reg78.id;}).length;
                          addN("ðŸ” Scouted "+reg78.name+" region â€” "+count78+" prospects evaluated!","cyan");
                        }:null},
                        reg78.icon+" "+reg78.name+(isScouted?" âœ“":"")
                      );
                    })
                  ),
                  scoutUsed78.length>0?React.createElement("div",{style:{marginTop:4,fontSize:8,color:T.dim}},
                    "Scouted prospects show ðŸ” grade + notes on draft board"
                  ):null
                );
              })()}
              
              {dPk>0&&dPk<draftBoard.length && (function(){
                var picked=draftBoard.slice(0,dPk).filter(function(pk){return pk.player;});
                var msgs=[];
                var recent6=picked.slice(-6);
                var recentCounts={};recent6.forEach(function(pk){if(pk.player)recentCounts[pk.player.pos]=(recentCounts[pk.player.pos]||0)+1;});
                Object.keys(recentCounts).forEach(function(p){
                  if(recentCounts[p]>=3)msgs.push("ðŸš¨ "+p.toUpperCase()+" RUN! "+recentCounts[p]+" taken in last 6 picks!");
                });
                var posCounts={};picked.forEach(function(pk){if(pk.player)posCounts[pk.player.pos]=(posCounts[pk.player.pos]||0)+1;});
                var hotPos=Object.keys(posCounts).filter(function(p){return posCounts[p]>=5;});
                hotPos.forEach(function(p){msgs.push("ðŸ“ˆ "+posCounts[p]+" "+p+"s taken total");});
                if(dc.length>0){
                  var bpa=dc[0];
                  var tierLabel=bpa.ovr>=80?"ðŸ”´ Tier 1":bpa.ovr>=72?"ðŸŸ¡ Tier 2":bpa.ovr>=64?"ðŸŸ¢ Tier 3":"âšª Tier 4";
                  msgs.push("ðŸ‘€ BPA: "+bpa.name+" ("+bpa.pos+" "+tierLabel+") still on the board");
                  if(bpa.ovr>=76&&dPk>=10)msgs.push("ðŸ’Ž STEAL ALERT: "+bpa.name+" falling! "+bpa.pos+" "+bpa.ovr+" OVR at pick #"+(dPk+1));
                }
                var qbsTaken=picked.filter(function(pk){return pk.player&&pk.player.pos==="QB";}).length;
                if(qbsTaken>=2)msgs.push("ðŸˆ "+qbsTaken+" QBs already off the board");
                var nextMine=draftBoard.slice(dPk).find(function(pk){return pk.ownerId===myId;});
                if(nextMine){var away=draftBoard.indexOf(nextMine)-dPk;
                  if(away===0)msgs.push("ðŸŽ¯ YOU'RE ON THE CLOCK!");
                  else if(away<=3)msgs.push("â° Your pick is "+away+" away â€” who's your target?");
                }
                return msgs.length>0?React.createElement("div",{style:{background:"rgba(212,167,75,0.08)",borderLeft:"3px solid "+T.gold,padding:"6px 10px",marginBottom:8,borderRadius:4}},
                  msgs.slice(0,4).map(function(m,mi){return React.createElement("div",{key:mi,style:{fontSize:10,color:mi===0&&m.indexOf("RUN!")>=0?T.red:T.gold,fontWeight:m.indexOf("STEAL")>=0||m.indexOf("RUN!")>=0?800:400,marginBottom:mi<msgs.length-1?2:0}},m);})):null;
              })()}
              
              {dPk<draftBoard.length && draftBoard[dPk] && draftBoard[dPk].ownerId===myId && dc.length>0 && (function(){
                var intel=DRAFT_WAR_ROOM.getIntel({pool:dc},my,dPk+1,{off:my.gameplanOff||"balanced_o",def:my.gameplanDef||"balanced_d"});
                if(!intel)return null;
                return <div style={{background:"rgba(167,139,250,0.06)",border:"1px solid rgba(167,139,250,0.2)",borderRadius:8,padding:"8px 10px",marginBottom:8}}>
                  <div style={{fontSize:10,fontWeight:800,color:T.purple,marginBottom:6}}>{"ðŸŽ–ï¸ WAR ROOM INTEL"}</div>
                  {intel.bpaAlert && <div style={{fontSize:9,color:T.green,fontWeight:700,marginBottom:4}}>{"âš¡ "+intel.bpaAlert.msg}</div>}
                  <div style={{fontSize:8,color:T.faint,marginBottom:4}}>{"TOP TARGETS:"}</div>
                  <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}}>
                    {(intel.targetBoard||[]).map(function(tgt,ti){
                      return <div key={ti} style={{background:T.bg3,borderRadius:4,padding:"3px 6px",fontSize:9,
                        border:"1px solid "+(ti===0?T.gold+"44":T.border)}}>
                        <span style={{fontWeight:700,color:ti===0?T.gold:T.text}}>{tgt.name}</span>
                        <span style={{color:T.dim}}>{" "+tgt.pos+" "+tgt.ovr}</span>
                        {tgt.need>=15 && <span style={{color:T.green,fontSize:8}}>{" ðŸ“‹NEED"}</span>}
                        {tgt.schemeFit>=10 && <span style={{color:T.cyan,fontSize:8}}>{" ðŸŽ¯FIT"}</span>}
                      </div>;
                    })}
                  </div>
                  {intel.autoPick && <div style={{fontSize:9,color:T.cyan}}>
                    {"ðŸ’¡ Suggestion: "+intel.autoPick.name+" ("+intel.autoPick.pos+" "+intel.autoPick.ovr+") â€” "+intel.autoPick.reason}
                  </div>}
                </div>;
              })()}
              
              {dPk<draftBoard.length && draftBoard[dPk] && draftBoard[dPk].ownerId===myId && dc.length>0 && (function(){
                var topProspect=dc[0];
                var offers75=[];
                teams.forEach(function(aiTeam){
                  if(aiTeam.id===myId)return;
                  var offer=DRAFT_DAY_TRADES.makeOffer(aiTeam,draftBoard[dPk],dPk+1);
                  if(offer&&offer.picks&&offer.picks.length>0){
                    var aiStarters=(aiTeam.roster||[]).filter(function(p){return p.pos===topProspect.pos;}).sort(function(a,b){return b.ovr-a.ovr;});
                    var bestOvr=aiStarters.length>0?aiStarters[0].ovr:40;
                    if(bestOvr<topProspect.ovr&&RNG.ai()<0.25)offers75.push(offer);
                  }
                });
                if(offers75.length===0)return null;
                var topOffer=offers75[0];
                return <div style={{background:"rgba(245,158,11,0.06)",border:"1px solid rgba(245,158,11,0.2)",borderRadius:8,padding:"8px 10px",marginBottom:8}}>
                  <div style={{fontSize:10,fontWeight:800,color:T.orange,marginBottom:4}}>{"ðŸ“ž TRADE OFFER â€” "+topOffer.fromIcon+" "+topOffer.from+" wants to trade up!"}</div>
                  <div style={{fontSize:9,color:T.dim,marginBottom:4}}>{"They want your #"+(dPk+1)+" pick"}</div>
                  <div style={{display:"flex",gap:8,fontSize:9}}>
                    <div><span style={{fontWeight:700,color:T.green}}>{"THEY OFFER: "}</span>
                      {topOffer.picks.map(function(pk,pi){return <span key={pi} style={{marginRight:4}}>{"Rd"+pk.round+" pick"}</span>;})}
                      {topOffer.player && <span style={{color:T.cyan}}>{" + "+topOffer.player.name+" ("+topOffer.player.pos+" "+topOffer.player.ovr+")"}</span>}
                    </div>
                  </div>
                  <div style={{fontSize:8,color:T.faint,marginTop:4}}>{"(Trade functionality coming soon â€” for now, use the Trade tab to make deals)"}</div>
                </div>;
              })()}
              
              {/* â”€â”€ MFSN DRAFT SHOW v2: Live analyst card + scrolling pick log â”€â”€ */}
              {(function(){
                if(!mfsnPickCard&&mfsnPickLog.length===0)return null;
                var card=mfsnPickCard;
                return React.createElement("div",{style:{marginBottom:8}},
                  // Live analyst card â€” flashes on each AI pick
                  card&&React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(15,23,42,0.98),rgba(30,20,60,0.95))",border:"2px solid "+(card.isSteal?"#22c55e":card.isReach?"#ef4444":"rgba(251,191,36,0.4)"),borderRadius:10,padding:"10px 12px",marginBottom:6}},
                    // Header bar
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
                      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:6}},
                        React.createElement("span",{style:{fontSize:9,fontWeight:900,color:"#ef4444",letterSpacing:2}},"ðŸ“¡ MFSN LIVE"),
                        React.createElement("span",{style:{fontSize:9,color:T.dim}},card.analystIcon+" "+card.analyst)
                      ),
                      React.createElement("div",{style:{fontSize:10,fontWeight:900,color:card.verdictColor,letterSpacing:1}},card.verdict)
                    ),
                    // Pick summary
                    React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6}},
                      React.createElement("span",{style:{fontSize:18}},(card.teamIcon||"ðŸˆ")),
                      React.createElement("div",null,
                        React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.text}},
                          card.team+" select "+card.player+" ("+card.pos+")"
                        ),
                        React.createElement("div",{style:{fontSize:9,color:T.dim}},
                          "Pick #"+card.pickNum+" â€¢ Rd"+card.round+" â€¢ "+card.ovr+" OVR"+(card.pot>card.ovr?" â€¢ Pot: "+card.pot:"")
                        )
                      ),
                      React.createElement("div",{style:{marginLeft:"auto",fontSize:20,fontWeight:900,color:card.verdictColor}},
                        card.grade
                      )
                    ),
                    // Need/steal/reaction tags
                    card.reactions&&card.reactions.length>0&&React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                      card.reactions.map(function(r,ri){
                        return React.createElement("span",{key:ri,style:{fontSize:8,background:"rgba(255,255,255,0.06)",borderRadius:4,padding:"2px 6px",color:r.emoji==="âœ…"?T.green:r.emoji==="ðŸ”¥"?T.gold:r.emoji==="ðŸ¤”"?T.orange:T.dim}},
                          r.emoji+" "+r.text);
                      })
                    ),
                    // Analyst quote
                    React.createElement("div",{style:{fontSize:9,color:T.gold,fontStyle:"italic",borderLeft:"2px solid "+T.gold+"44",paddingLeft:8}},
                      "\""+card.line+"\""
                    )
                  ),
                  // Scrolling pick log â€” last 8 AI picks
                  mfsnPickLog.length>0&&React.createElement("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:6,padding:"5px 8px",maxHeight:120,overflowY:"auto"}},
                    React.createElement("div",{style:{fontSize:8,fontWeight:800,color:"#ef4444",letterSpacing:2,marginBottom:4}},"ðŸ“‹ MFSN DRAFT TRACKER"),
                    mfsnPickLog.slice(0,8).map(function(pk,pi){
                      return React.createElement("div",{key:pi,style:{display:"flex",alignItems:"center",gap:4,paddingBottom:2,borderBottom:pi<Math.min(7,mfsnPickLog.length-1)?"1px solid rgba(255,255,255,0.05)":"none",marginBottom:2}},
                        React.createElement("span",{style:{fontSize:8,color:T.faint,minWidth:42,fontFamily:"monospace"}},"#"+pk.pickNum+" Rd"+pk.round),
                        React.createElement("span",{style:{fontSize:9}},(pk.teamIcon||"ðŸˆ")),
                        React.createElement("span",{style:{fontSize:9,color:T.text,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},pk.player+" ("+pk.pos+")"),
                        React.createElement("span",{style:{fontSize:9,fontWeight:800,color:pk.verdictColor||T.gold}},pk.grade)
                      );
                    })
                  )
                );
              })()}

              <div style={assign({},cS,{padding:6})}>
                <div style={{fontSize:9,color:T.faint,marginBottom:4}}>{"DRAFT BOARD"}</div>
                <div style={{display:"flex",gap:2,flexWrap:"wrap"}}>
                  {draftBoard.slice(0,Math.min(draftBoard.length,24)).map(function(pk,i){
                    var isMine=pk.ownerId===myId;var isCurrent=i===dPk;var isPast=i<dPk;
                    var origT=teams.find(function(t2){return t2.id===pk.originalId;});
                    return <div key={pk.id} title={"#"+pk.pickNum+" Rd"+pk.round+" "+(origT?origT.abbr:"")+(isMine?" (YOU)":"")} style={{width:20,height:20,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center",fontSize:7,fontWeight:isCurrent?800:400,
                      background:isCurrent?T.gold:isPast?T.bg3:isMine?"rgba(212,167,75,0.2)":"transparent",
                      color:isCurrent?"#000":isPast?T.faint:isMine?T.gold:T.dim,
                      border:"1px solid "+(isCurrent?T.gold:isMine?T.gold:T.border)}}>{pk.pickNum}</div>;
                  })}
                </div>
              </div>
              
              {draftShowLog.length>0 && <div style={assign({},cS,{borderColor:"#f59e0b",background:"rgba(245,158,11,0.03)"})}>
                <div style={{fontWeight:800,fontSize:11,color:"#f59e0b",marginBottom:4}}>{"ðŸŽ­ DRAFT NIGHT LIVE"}</div>
                {draftShowLog.slice(-5).reverse().map(function(dn,di){
                  return <div key={di} style={{padding:"4px 0",borderBottom:di<Math.min(draftShowLog.length,5)-1?"1px solid "+T.border:"none"}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <span style={{fontSize:10,fontWeight:700,color:dn.isUser?T.gold:T.text}}>
                        {dn.icon+" "+dn.team+" Rd"+dn.round+" #"+dn.pickNum+": "+dn.player+" ("+dn.pos+" "+dn.ovr+")"}
                      </span>
                      <span style={{fontSize:10,fontWeight:800,padding:"1px 4px",borderRadius:3,
                        color:dn.grade.charAt(0)==="A"?T.green:dn.grade.charAt(0)==="B"?T.cyan:T.faint,
                        background:dn.grade.charAt(0)==="A"?"rgba(52,211,153,0.1)":"rgba(255,255,255,0.04)"}}>{dn.grade}</span>
                    </div>
                    {dn.comment && <div style={{fontSize:8,color:T.dim,fontStyle:"italic",marginTop:2}}>{dn.comment}</div>}
                    <div style={{display:"flex",gap:4,marginTop:2,flexWrap:"wrap"}}>
                      {dn.reactions.map(function(r,ri){
                        return <span key={ri} style={{fontSize:8,color:T.dim}}>{r.emoji+" "+r.text}</span>;
                      })}
                    </div>
                  </div>;
                })}
              </div>}
              
              {draftOffers.length>0&&dPk<draftBoard.length && (
                <div style={assign({},cS,{borderColor:T.gold})}>
                  <div style={{fontWeight:700,color:T.gold,marginBottom:6}}>{"ðŸ“ž The Phone is Ringing! ("+draftOffers.length+" offer"+(draftOffers.length>1?"s":"")+")"}</div>
                  {draftOffers.map(function(off,oi){return (
                    <div key={oi} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px solid "+T.border}}>
                      <div style={{fontSize:11,flex:1}}>
                        <div style={{fontWeight:700}}>{(off.trustEmoji||"")+off.label}</div>
                        <div style={{display:"flex",gap:8,flexWrap:"wrap",marginTop:2}}>
                          <span style={{color:T.faint,fontSize:9}}>{"Need: "+off.needs}</span>
                          {off.value && <span style={{color:T.cyan,fontSize:9}}>{"Value: "+off.value+"pts"}</span>}
                          {off.trust && <span style={{color:off.trust>=70?T.green:off.trust>=40?T.dim:T.orange,fontSize:9}}>{"Trust: "+off.trust}</span>}
                        </div>
                      </div>
                      <button style={bS(T.orange,"#000")} onClick={function(){acceptDraftOffer(off);}}>{"Trade Down"}</button>
                    </div>
                  );})}
                </div>
              )}
              {dc.length>0&&dPk<draftBoard.length ? (
                <div>
                  
                  <div style={{display:"flex",gap:3,marginBottom:6,flexWrap:"wrap",alignItems:"center"}}>
                    <span style={{fontSize:9,color:T.faint}}>{"Sort:"}</span>
                    {[{k:"hypeOvr",l:"Proj"},{k:"tier",l:"Tier"},{k:"pos",l:"Pos"},{k:"grade",l:"Grade"},{k:"pot",l:"Pot"},{k:"school",l:"School"},{k:"combine",l:"Combine"},{k:"trait",l:"Trait"}].map(function(col){
                      return React.createElement("button",{key:col.k,style:mS(S.btn,S.btnSmall,{
                        background:draftSort===col.k?"rgba(37,99,235,0.15)":"rgba(255,255,255,0.04)",
                        color:draftSort===col.k?T.blue:T.faint,border:"1px solid "+(draftSort===col.k?"rgba(37,99,235,0.3)":T.border),
                        padding:"2px 7px",fontSize:9}),
                        onClick:function(){if(draftSort===col.k){setDraftSortDir(function(d){return d*-1;});}else{setDraftSort(col.k);setDraftSortDir(-1);}}},col.l+(draftSort===col.k?(draftSortDir===-1?" â–¼":" â–²"):""));
                    })}
                  </div>
                  <table style={tS}><thead><tr>{["#","Tier","Name","Pos","Grade","Pot","School","College","Combine","Trait",""].map(function(h){return <th key={h} style={thS}>{h}</th>;})}</tr></thead>
                    <tbody>{(function(){
                      var sorted2=dc.slice(0,Math.min(dc.length,20));
                      sorted2.sort(function(a,b){
                        var aV,bV;
                        if(draftSort==="tier"){aV=a.ovr||0;bV=b.ovr||0;}
                        else if(draftSort==="pos"){aV=a.pos;bV=b.pos;return draftSortDir*(aV<bV?-1:aV>bV?1:0);}
                        else if(draftSort==="grade"){aV=a.hypeOvr||0;bV=b.hypeOvr||0;}
                        else if(draftSort==="pot"){
                          var potMap={"Elite":5,"High":4,"Average":3,"Below Avg":2,"Project":1};
                          aV=potMap[a.potLabel]||0;bV=potMap[b.potLabel]||0;
                        }
                        else if(draftSort==="school"){aV=a.college?a.college.school:"";bV=b.college?b.college.school:"";return draftSortDir*(aV<bV?-1:aV>bV?1:0);}
                        else if(draftSort==="combine"){aV=a.combine?a.combine.forty:10;bV=b.combine?b.combine.forty:10;return draftSortDir*(aV-bV);}
                        else if(draftSort==="trait"){
                          var tA=TRAITS[a.trait||"none"]?1:0;var tB=TRAITS[b.trait||"none"]?1:0;aV=tA;bV=tB;
                        }
                        else{aV=a.hypeOvr||0;bV=b.hypeOvr||0;}
                        return draftSortDir*(aV-bV);
                      });
                      return sorted2.map(function(p,pi){
                      var trObj=TRAITS[p.trait||"none"]||TRAITS.none;
                      var tierColor=p.ovr>=80?T.red:p.ovr>=72?T.gold:p.ovr>=64?T.green:T.faint;
                      var tierText=p.ovr>=80?"T1":p.ovr>=72?"T2":p.ovr>=64?"T3":"T4";
                      var colText="";
                      if(p.college){
                        if(p.pos==="QB")colText=p.college.passYds+"yd "+(p.college.passTD||0)+"TD "+(p.college.int||0)+"INT "+p.college.comp+"%";
                        else if(p.pos==="RB")colText=p.college.rushYds+"yd "+(p.college.rushTD||0)+"TD "+(p.college.ypc||0)+"ypc";
                        else if(p.pos==="WR"||p.pos==="TE")colText=(p.college.rec||0)+"rec "+(p.college.recYds||0)+"yd "+(p.college.recTD||0)+"TD";
                        else colText=(p.college.starts||0)+"starts "+(p.college.awards||"");
                      }
                      var combText=p.combine?(p.combine.forty+"s "+(p.combine.bench||0)+"rp "+(p.combine.vertical||0)+"in"):"";
                      var gymLvlDraft=my&&my.facilities?my.facilities.gym||0:0;
                      var foD79=FRONT_OFFICE.getBonus(frontOffice78,"drafting");// v93.18: fix scope â€” was undefined
                      var confDraft=Math.min(100,(p.scoutConfidence||0)+(foD79>0?Math.round(foD79*40):0));
                      var errBandDraft=SCOUT_MATH.getErrorBand(gymLvlDraft,foD79||0);
                      var ovrDisplay88=SCOUT_MATH.getOvrDisplay(p.ovr,confDraft,errBandDraft);
                      var ovrIsRange88=ovrDisplay88.indexOf("-")>=0;
                      var ovrColor88=confDraft>=100?T.green:ovrIsRange88?T.gold:T.faint;
                      return (
                      <tr key={p.id} style={{background:pi===0?"rgba(212,167,75,0.04)":"transparent"}}>
                        <td style={assign({},tdS,{fontSize:9,color:T.faint})}>{pi+1}</td>
                        <td style={assign({},tdS,{fontSize:9,fontWeight:800,color:tierColor})}>{tierText}</td>
                        <td style={assign({},tdS,{fontWeight:600,whiteSpace:"nowrap"})}>{p.name}{(p.ovr>=76&&dPk>=10)?" ðŸ’Ž":""}</td>
                        <td style={assign({},tdS,{color:T.gold,fontWeight:700})}>{p.pos}</td>
                        <td style={assign({},tdS,{fontWeight:800,color:p.scoutGrade&&p.scoutGrade[0]==="A"?T.green:p.scoutGrade&&p.scoutGrade[0]==="B"?T.cyan:p.scoutGrade&&p.scoutGrade[0]==="C"?T.dim:T.red})}>{p.scoutGrade||ovrDisplay88}</td>
                        <td style={assign({},tdS,{fontSize:9,fontWeight:700,color:ovrColor88})} title={confDraft+"% conf â€” Â±"+errBandDraft+" OVR error"}>{ovrDisplay88}</td>
                        <td style={assign({},tdS,{fontSize:10,color:T.purple})}>{p.potLabel||(confDraft>=75?p.pot:"?")}</td>
                        <td style={assign({},tdS,{fontSize:9,color:p._scouted78?T.cyan:T.dim})}>
                          {(p.college?p.college.school:"")+(p._scouted78?" ðŸ”"+p._scoutGrade78:"")}
                          {p._pipelineSchoolId&&(function(){var pt=PIPELINE.getTier(p._pipelineBonus>=0.08?80:p._pipelineBonus>=0.05?60:p._pipelineBonus>=0.02?35:0);return React.createElement("span",{style:{marginLeft:4,fontSize:8,color:pt.color,fontWeight:800},title:"Pipeline school â€” "+pt.label+" tier"},"["+pt.emoji+pt.label+"]");})()}
                          {p._pipelineActivated&&React.createElement("span",{style:{marginLeft:4,fontSize:8,color:"#22d3ee",fontWeight:900},title:"Pipeline Boost was active this draft year â€” boosted gem/dev rates"},"ðŸ“¡PL+")}
                        </td>
                        <td style={assign({},tdS,{fontSize:8,color:T.faint})}>{colText}</td>
                        <td style={assign({},tdS,{fontSize:8,color:T.faint})}>{combText}</td>
                        <td style={assign({},tdS,{fontSize:10})} title={trObj.desc||""}>{trObj.icon||"â€”"}</td>
                        <td style={tdS}><button onClick={function(){doDraftPick(p);}} style={bS()}>Draft</button></td>
                      </tr>);});
                    })()}</tbody></table>
                  {(function(){
                    var sortedRival89=dc.slice(0,Math.min(dc.length,20));
                    sortedRival89.sort(function(a,b){
                      var aV,bV;
                      if(draftSort==="tier"){aV=a.ovr||0;bV=b.ovr||0;}
                      else if(draftSort==="pos"){aV=a.pos;bV=b.pos;return draftSortDir*(aV<bV?-1:aV>bV?1:0);}
                      else if(draftSort==="grade"){aV=a.hypeOvr||0;bV=b.hypeOvr||0;}
                      else if(draftSort==="pot"){
                        var potMap89={"Elite":5,"High":4,"Average":3,"Below Avg":2,"Project":1};
                        aV=potMap89[a.potLabel]||0;bV=potMap89[b.potLabel]||0;
                      }else if(draftSort==="school"){aV=a.college?a.college.school:"";bV=b.college?b.college.school:"";return draftSortDir*(aV<bV?-1:aV>bV?1:0);}
                      else if(draftSort==="combine"){aV=a.combine?a.combine.forty:10;bV=b.combine?b.combine.forty:10;return draftSortDir*(aV-bV);}
                      else if(draftSort==="trait"){var tA89=TRAITS[a.trait||"none"]?1:0;var tB89=TRAITS[b.trait||"none"]?1:0;aV=tA89;bV=tB89;}
                      else{aV=a.hypeOvr||0;bV=b.hypeOvr||0;}
                      return draftSortDir*(aV-bV);
                    });
                    if(!sortedRival89.length)return null;
                    var topP89=sortedRival89[0];
                    var rivals89=calcRivalInterest(topP89,draftBoard,teams,dPk);
                    if(!rivals89.length)return React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:4,padding:"4px 8px"}},"âœ… No obvious rivals targeting this position in the next 6 picks.");
                    var minAway89=99;rivals89.forEach(function(r){if((r.picksAway||99)<minAway89)minAway89=r.picksAway;});
                    var rivalLabels89=rivals89.map(function(r){return r.abbr;});
                    return React.createElement("div",{style:{fontSize:9,color:T.orange,marginTop:4,padding:"4px 8px",borderRadius:4,background:"rgba(251,146,60,0.08)",border:"1px solid rgba(251,146,60,0.2)"}},
                      "âš ï¸ "+rivalLabels89.join(", ")+" drafting in next "+minAway89+" picks â€” also need "+topP89.pos
                    );
                  })()}
                  {dc.slice(0,12).some(function(p){return (p.scoutNotes||[]).length>0;}) && (
                    <div style={{fontSize:9,color:T.faint,marginTop:4}}>{"â„¹ï¸ Scout notes: "+(dc[0]&&dc[0].scoutNotes?dc[0].scoutNotes.join(" | "):"None yet. Use Scouting tab.")}</div>
                  )}
                </div>
              ) : dPk>=draftBoard.length ? (
                <div style={mS(S.studioCard,{textAlign:"center",padding:24})}>
                  <div style={{fontSize:48,marginBottom:8}}>{"ðŸŽ‰"}</div>
                  <div style={mS(S.header,{fontSize:18,color:T.gold,marginBottom:6})}>{"DRAFT COMPLETE!"}</div>
                  <div style={{fontSize:13,color:T.text,marginBottom:4}}>{"You selected "+draftBoard.filter(function(pk){return pk.ownerId===myId&&pk.player;}).length+" players to build your future."}</div>
                  <div style={{fontSize:11,color:T.dim,marginBottom:12}}>{""+dc.length+" undrafted prospects have entered Free Agency."}</div>
                  
                  {udfaPool76&&udfaPool76.length>0 && <div style={{textAlign:"left",marginBottom:12,border:"1px solid rgba(16,185,129,0.2)",borderRadius:8,padding:12,background:"rgba(16,185,129,0.03)"}}>
                    <div style={{fontSize:13,fontWeight:800,color:T.green,marginBottom:6,textAlign:"center"}}>{"ðŸˆ UNDRAFTED FREE AGENT MINI-GAME"}</div>
                    <div style={{fontSize:10,color:T.dim,textAlign:"center",marginBottom:8}}>{"These prospects went undrafted â€” sign them before rival teams do!"}</div>
                    {udfaPool76.slice(0,10).map(function(udfa,ui){
                      return <div key={"udfa"+ui} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 8px",borderBottom:"1px solid "+T.border,fontSize:11}}>
                        <div style={{display:"flex",gap:8,alignItems:"center"}}>
                          <span style={{color:T.dim,width:18,textAlign:"center",fontSize:10}}>{""+(ui+1)}</span>
                          <span style={{fontWeight:700}}>{udfa.name}</span>
                          <span style={{color:T.cyan,fontSize:10}}>{udfa.pos}</span>
                          <span style={{fontWeight:700,color:udfa.ovr>=65?T.green:udfa.ovr>=58?T.gold:T.dim}}>{udfa.ovr}</span>
                          {udfa.isGem && <span style={{color:T.gold,fontSize:9}}>{"ðŸ’Ž Gem"}</span>}
                          <span style={{color:T.faint,fontSize:9}}>{"$"+(udfa.udfaBonus||0.1)+"M bonus"}</span>
                          <span style={{color:T.faint,fontSize:9}}>{(udfa.udfaInterest||1)+" team"+(udfa.udfaInterest>1?"s":"")+" interested"}</span>
                        </div>
                        <button style={mS(S.btn,{background:T.green,color:"#000",padding:"3px 10px",fontSize:10,fontWeight:700})} onClick={function(){signUdfa76(udfa);}}>{"Sign"}</button>
                      </div>;
                    })}
                    {udfaPool76.length>10 && <div style={{fontSize:9,color:T.faint,textAlign:"center",marginTop:4}}>{"+"+(udfaPool76.length-10)+" more available"}</div>}
                  </div>}
                  <div style={{display:"flex",gap:8,justifyContent:"center"}}>
                    <button style={mS(S.btn,{background:"linear-gradient(135deg,"+T.blue+",#2563eb)",color:"#fff",padding:"12px 24px",fontSize:14,fontWeight:800})} onClick={function(){setTab("fa");}}>{"ðŸª Browse Free Agents"}</button>
                    <button style={mS(S.btn,S.btnPrimary,{padding:"12px 24px",fontSize:14})} onClick={newSeason}>{"â­ Start Next Season"}</button>
                  </div>
                </div>
              ) : null}
            </div>
          )}
          
          {tab==="fa" && (function(){
            var theCap3=getSalaryCap(season.year);var capUsed3=capCalc(my?my.roster:[]);var dead3=my.deadCap||0;
            var room3=Math.max(0,theCap3-capUsed3-dead3);var pctUsed3=Math.min(100,(capUsed3+dead3)/theCap3*100);
            var hColor3=pctUsed3<75?T.green:pctUsed3<90?T.gold:T.red;
            var lim3=season.phase==="preseason"||season.phase==="cutDay"?CAMP_CAP:ROSTER_CAP;
            var rosterFull=my.roster.length>=lim3;
            var myNeeds=getTeamNeeds(my);var myNeedList=Object.keys(myNeeds);
            var isBidPhase=season.phase==="freeAgency"&&faBids82.length>0;
            var pendingCap82=isBidPhase?pendingBidCap(faBids82,myId):0;
            var effectiveRoom=Math.max(0,room3-pendingCap82);
            var tierFilter82=posF;
            var tierCounts={ELITE:0,SOLID:0,DEPTH:0,CAMP:0};
            if(isBidPhase){
              faBids82.forEach(function(e){if(e.status==="open")tierCounts[e.tierId]=(tierCounts[e.tierId]||0)+1;});
            }
            var campFAs=fas.filter(function(p){var t82=getFATier(p.ovr);return t82===FA_TIERS.CAMP||(p.faYears||0)>=1;});
            tierCounts.CAMP=campFAs.length;
            var phaseObj=faPhase82==="open"?FA_PHASES.OPEN:faPhase82==="settling"?FA_PHASES.SETTLING:FA_PHASES.TAMPERING;
            var myActiveBids=isBidPhase?faBids82.filter(function(e){return e.status==="open"&&e.bids.some(function(b){return b.isUser;});}):[];
            var gmShortMap84=buildGMShortlistMap84(gmShortlist84);
            var gmShortActive84=!!(gmShortlist84&&gmShortlist84.length);
            var gmShortLabel84=gmShortActive84?(gmShortlist84[0].groupLabel||"this"):"";
            var bidTierKey=tierFilter82;
            var filteredBids=isBidPhase?faBids82.filter(function(e){
              if(e.status!=="open")return false;
              if(bidTierKey!=="ALL"&&e.tierId!==bidTierKey)return false;
              return true;
            }).sort(function(a,b){
              var aShort=gmShortMap84[a.playerId]?1:0;var bShort=gmShortMap84[b.playerId]?1:0;
              if(aShort!==bShort)return aShort?-1:1;
              return (b.ovr||0)-(a.ovr||0);
            }):[];
            var filteredCamp=campFAs.filter(function(p){return posF==="ALL"||p.pos===posF;}).sort(function(a,b){
              var aShort=gmShortMap84[a.id]?1:0;var bShort=gmShortMap84[b.id]?1:0;
              if(aShort!==bShort)return aShort?-1:1;
              var aBias=getGMFABias(gmStrategy,a);var bBias=getGMFABias(gmStrategy,b);
              return (b.ovr*bBias)-(a.ovr*aBias);
            });
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              
              <div style={assign({},cS,{padding:0,overflow:"hidden"})}>
                <div style={{padding:"12px 14px",background:"rgba(96,165,250,0.04)",borderBottom:"1px solid "+T.border}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <div style={{flex:1}}>
                      <div style={{fontWeight:900,fontSize:16}}>{isBidPhase?phaseObj.icon+" "+phaseObj.label:"\ud83c\udfea Free Agent Market"}</div>
                      <div style={{fontSize:11,color:T.dim}}>{isBidPhase?phaseObj.desc:fas.length+" players available"}</div>
                    </div>
                    
                    {(function(){
                      var rCount3=my.roster.length;
                      var rFull3=rCount3>=lim3;var rOver3=rCount3>lim3;
                      var rColor3=rOver3?T.red:rFull3?"#f59e0b":rCount3>=lim3-3?"#f59e0b":T.green;
                      return <div style={{textAlign:"center",minWidth:52,marginRight:12}}>
                        <div style={{fontSize:20,fontWeight:900,color:rColor3,lineHeight:1}}>{rCount3}</div>
                        <div style={{fontSize:8,fontWeight:700,color:rColor3,opacity:0.8}}>{"/ "+lim3}</div>
                        <div style={{fontSize:7,color:T.faint,marginTop:1}}>{rOver3?"OVER":rFull3?"FULL":lim3-rCount3+" spots"}</div>
                      </div>;
                    })()}
                    <div style={{textAlign:"right"}}>
                      <div style={{fontSize:20,fontWeight:900,color:hColor3}}>{"$"+effectiveRoom.toFixed(1)+"M"}</div>
                      <div style={{fontSize:9,color:T.faint}}>{pendingCap82>0?"Room (pending $"+pendingCap82.toFixed(1)+"M)":"Cap Room"}</div>
                    </div>
                  </div>
                </div>
                
                <div style={{padding:"8px 14px"}}>
                  <div style={{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:4}}>
                    <span style={{color:T.dim}}>{"\ud83d\udcb0 $"+capUsed3.toFixed(1)+"M used"+(dead3>0?" + $"+dead3.toFixed(1)+"M dead":"")+(pendingCap82>0?" + $"+pendingCap82.toFixed(1)+"M pending":"")}</span>
                    <span style={{color:hColor3,fontWeight:600}}>{"$"+theCap3+"M cap ("+season.year+")"}</span>
                  </div>
                  <div style={{height:8,background:T.bg3,borderRadius:4,overflow:"hidden",display:"flex"}}>
                    <div style={{width:(capUsed3/theCap3*100)+"%",height:"100%",background:hColor3,borderRadius:"4px 0 0 4px"}}></div>
                    {dead3>0 && <div style={{width:(dead3/theCap3*100)+"%",height:"100%",background:T.red,opacity:0.5}}></div>}
                    {pendingCap82>0 && <div style={{width:(pendingCap82/theCap3*100)+"%",height:"100%",background:"#a78bfa",opacity:0.5}}></div>}
                  </div>
                </div>
              </div>
              {gmShortActive84 && <div style={assign({},cS,{padding:"8px 10px",borderColor:T.gold,background:"rgba(212,167,75,0.06)"})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8}}>
                  <div style={{fontSize:10,color:T.gold,fontWeight:700}}>
                    {"Showing GM shortlist for "+gmShortLabel84+" fit alert"}
                  </div>
                  <button style={bS(T.bg3,T.dim,{border:"1px solid "+T.border,padding:"3px 8px",fontSize:9})} onClick={function(){setGmShortlist84(null);}}>
                    {"Clear"}
                  </button>
                </div>
              </div>}
              
              {isBidPhase && <div style={assign({},cS,{borderColor:phaseObj===FA_PHASES.OPEN?"#10b981":"#f59e0b",background:phaseObj===FA_PHASES.OPEN?"rgba(16,185,129,0.03)":"rgba(245,158,11,0.03)"})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                  <div>
                    <div style={{fontWeight:800,fontSize:12,color:phaseObj===FA_PHASES.OPEN?T.green:T.gold}}>{phaseObj.icon+" Round "+(faRound82+1)}</div>
                    <div style={{fontSize:9,color:T.dim}}>{myActiveBids.length>0?myActiveBids.length+" active bid"+(myActiveBids.length>1?"s":""):"Place bids, then sim a round"}</div>
                  </div>
                  <div style={{display:"flex",gap:6,alignItems:"center"}}>
                    
                    <div style={{fontSize:9,padding:"4px 8px",borderRadius:6,background:"rgba(251,191,36,0.08)",border:"1px solid "+T.gold}}>
                      <span style={{color:T.gold,fontWeight:700}}>{"\ud83c\udfe0 Visits: "+(faVisits82?(faVisits82.max-faVisits82.used):0)+"/"+(faVisits82?faVisits82.max:3)}</span>
                    </div>
                    
                    <button style={bS(T.green,"#000")} onClick={function(){
                      if(faPhase82==="tampering"){
                        setFaPhase82("open");setFaRound82(0);
                        addN("\ud83c\udfea FA market is OPEN! Place your bids.","green");
                        doSave();return;
                      }
                      var result=simFABidRound(faBids82,fas,teams,myId,RNG.trade,faRound82,season.year);
                      if(result.signings&&result.signings.length>0){
                        result.signings.forEach(function(s){
                          var signTeam=teams.find(function(t){return t.id===s.teamId;});
                          addN((s.isUser?"\u2705 ":"")+(signTeam?signTeam.icon:"")+s.name+" ("+s.pos+" "+s.ovr+") signs $"+s.salary+"M/"+s.years+"yr",s.isUser?"green":"cyan");
                          if(!s.isUser)ledgerLog("AI_SIGN",s.teamId,"AI signed "+s.name+"("+s.pos+") $"+s.salary+"M/"+s.years+"yr",{name:s.name,pos:s.pos,ovr:s.ovr,salary:s.salary});
                        });
                        var nt=teams.slice();var u=nt.find(function(t){return t.id===myId;});
                        result.signings.forEach(function(s){
                          if(s.isUser){
                            var fa=fas.find(function(p){return p.id===s.playerId;});
                            if(fa){u.roster.push(assign({},fa,{contract:makeContract(s.salary,s.years,s.salary>3?Math.round(s.salary*0.25*s.years*10)/10:0,0),isStarter:false,teamTenure:0}));
                              u.capUsed=capCalc(u.roster);}
                          }
                        });
                        setTeams(nt);
                        setFAs(function(prev){var signedIds={};result.signings.forEach(function(s){signedIds[s.playerId]=true;});return prev.filter(function(x){return !signedIds[x.id];});});
                        setFaSignings82(function(old){return old.concat(result.signings);});
                        setFaHeadlines(function(old){return buildFAHeadlines(result.signings.concat(old.slice(0,8)),teams);});
                      }
                      if(result.alerts&&result.alerts.length>0){
                        setFaAlerts82(function(old){return old.concat(result.alerts);});
                      }
                      setFaBids82(result.board||faBids82);
                      setFaRound82(function(r){return r+1;});
                      var openCount=0;(result.board||faBids82).forEach(function(e){if(e.status==="open")openCount++;});
                      if(openCount===0){setFaPhase82("settling");addN("\ud83d\udcc9 Market has settled. All bids resolved.","gold");}
                      doSave(nt);
                    }}>{faPhase82==="tampering"?"\ud83c\udfea Open FA Market":"\u23e9 Sim Round "+(faRound82+1)}</button>
                  </div>
                </div>
                
                {faHeadlines.length>0 && faHeadlines.slice(0,3).map(function(hl,hi){
                  return <div key={hi} style={{fontSize:9,padding:"2px 0",color:T.dim}}>{hl.emoji+" "+hl.text}</div>;
                })}
              </div>}
              
              {faAlerts82.length>0 && <div style={{display:"flex",flexDirection:"column",gap:4}}>
                {faAlerts82.map(function(alert,ai){
                  var rivalTeam=teams.find(function(t){return t.id===alert.rivalId;});
                  return <div key={ai} style={assign({},cS,{borderColor:T.red,background:"rgba(239,68,68,0.05)",padding:"8px 12px"})}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <div>
                        <div style={{fontSize:11,fontWeight:800,color:T.red}}>{"\ud83d\udea8 OUTBID: "+alert.name+" ("+alert.pos+" "+alert.ovr+")"}</div>
                        <div style={{fontSize:9,color:T.dim}}>{(rivalTeam?rivalTeam.icon+" "+rivalTeam.abbr:"Rival")+" offers $"+alert.rivalSalary+"M/"+alert.rivalYears+"yr"+(alert.decidesThisRound?" \u2014 DECIDES NOW!":"")}</div>
                      </div>
                      <div style={{display:"flex",gap:4}}>
                        <button style={bS(T.orange,"#000")} onClick={function(){
                          var newSal=Math.round((alert.rivalSalary+0.5)*10)/10;
                          placeFABid(alert.playerId,newSal,alert.rivalYears,faBidRole82);
                          setFaAlerts82(function(old){return old.filter(function(a,idx){return idx!==ai;});});
                        }}>{"\ud83d\udcb0 Counter"}</button>
                        <button style={{background:"transparent",border:"1px solid "+T.border,borderRadius:6,padding:"4px 8px",fontSize:10,color:T.dim,cursor:"pointer"}}
                          onClick={function(){setFaAlerts82(function(old){return old.filter(function(a,idx){return idx!==ai;});});
                        }}>{"Dismiss"}</button>
                      </div>
                    </div>
                  </div>;
                })}
              </div>}
              
              {myNeedList.length>0 && <div style={{display:"flex",gap:4,flexWrap:"wrap",alignItems:"center"}}>
                <span style={{fontSize:10,color:T.orange,fontWeight:700}}>{"\u26a0\ufe0f NEEDS:"}</span>
                {myNeedList.map(function(pos){return <span key={pos} onClick={function(){setPosF(posF===pos?"ALL":pos);}}
                  style={{fontSize:10,padding:"3px 8px",borderRadius:4,cursor:"pointer",fontWeight:600,
                    background:posF===pos?"rgba(239,68,68,0.15)":"rgba(239,68,68,0.06)",
                    border:"1px solid "+(posF===pos?T.red:"rgba(239,68,68,0.2)"),
                    color:T.red}}>{pos+" ("+myNeeds[pos]+")"}</span>;})}
              </div>}
              
              {rosterFull && <div style={{background:"rgba(239,68,68,0.12)",border:"1px solid "+T.red,borderRadius:6,padding:"8px 12px",fontSize:12,color:T.red,fontWeight:700}}>
                {"\u26a0\ufe0f Roster Full ("+my.roster.length+"/"+lim3+") \u2014 Cut or move a player before signing."}
              </div>}
              
              {isBidPhase && <div style={{display:"flex",gap:4,overflowX:"auto",paddingBottom:4}}>
                {[{key:"ALL",label:"All",color:T.text},{key:"ELITE",label:"\ud83d\udc51 Elite",color:FA_TIERS.ELITE.color},{key:"SOLID",label:"\u2b50 Solid",color:FA_TIERS.SOLID.color},{key:"DEPTH",label:"\ud83d\udd27 Depth",color:FA_TIERS.DEPTH.color},{key:"CAMP",label:"\ud83d\udccb Camp",color:FA_TIERS.CAMP.color}].map(function(tab2){
                  var cnt2=tab2.key==="ALL"?(tierCounts.ELITE+tierCounts.SOLID+tierCounts.DEPTH+tierCounts.CAMP):(tierCounts[tab2.key]||0);
                  return <div key={tab2.key} onClick={function(){setPosF(tab2.key);}}
                    style={{minWidth:60,textAlign:"center",padding:"6px 8px",borderRadius:6,cursor:"pointer",
                      background:tierFilter82===tab2.key?"rgba(212,167,75,0.12)":T.bg3,
                      border:"2px solid "+(tierFilter82===tab2.key?T.gold:"transparent")}}>
                    <div style={{fontSize:12,fontWeight:800,color:tierFilter82===tab2.key?T.gold:tab2.color}}>{tab2.label}</div>
                    <div style={{fontSize:9,color:T.faint}}>{cnt2}</div>
                  </div>;
                })}
              </div>}
              
              {(!isBidPhase||tierFilter82==="CAMP") && <div style={{display:"flex",gap:4,overflowX:"auto",paddingBottom:4}}>
                {["ALL","QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"].map(function(pos){
                  var posCounts2={};(isBidPhase?campFAs:fas).forEach(function(p){posCounts2[p.pos]=(posCounts2[p.pos]||0)+1;});
                  var cnt=pos==="ALL"?(isBidPhase?campFAs:fas).length:(posCounts2[pos]||0);
                  var isNeed=myNeedList.indexOf(pos)>=0;
                  return <div key={pos} onClick={function(){setPosF(pos);}}
                    style={{minWidth:48,textAlign:"center",padding:"6px 4px",borderRadius:6,cursor:"pointer",
                      background:posF===pos?"rgba(212,167,75,0.12)":T.bg3,
                      border:"2px solid "+(posF===pos?T.gold:isNeed?"rgba(239,68,68,0.3)":"transparent")}}>
                    <div style={{fontSize:14,fontWeight:800,color:posF===pos?T.gold:T.text}}>{pos}</div>
                    <div style={{fontSize:9,color:isNeed?T.red:T.faint}}>{cnt+(isNeed?" \u26a0":"")}</div>
                  </div>;
                })}
              </div>}
              
              {isBidPhase&&myActiveBids.length>0&&tierFilter82!=="CAMP" && <div style={assign({},cS,{borderColor:"#a78bfa",background:"rgba(167,139,250,0.04)"})}>
                <div style={{fontWeight:800,fontSize:11,color:"#a78bfa",marginBottom:6}}>{"\ud83d\udcdd Your Active Bids ("+myActiveBids.length+")"}</div>
                {myActiveBids.slice(0,5).map(function(e){
                  var ub=e.bids.find(function(b){return b.isUser;});if(!ub)return null;
                  var mvColor=ub.salary>=e.marketValue*1.1?T.green:ub.salary>=e.marketValue*0.9?T.gold:T.red;
                  var isTop=true;e.bids.forEach(function(b){if(!b.isUser&&b.salary>ub.salary)isTop=false;});
                  return <div key={e.playerId} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 0",borderBottom:"1px solid "+T.border}}>
                    <div>
                      <span style={{fontWeight:700,fontSize:11}}>{e.name}</span>
                      <span style={{fontSize:10,color:T.dim}}>{" "+e.pos+" "+e.ovr}</span>
                      <span style={{fontSize:9,color:T.faint}}>{" \u2014 Rd "+e.roundsLeft+" left"}</span>
                    </div>
                    <div style={{display:"flex",gap:6,alignItems:"center"}}>
                      <span style={{fontSize:10,fontWeight:700,color:mvColor}}>{"$"+ub.salary+"M/"+ub.years+"yr"}</span>
                      <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                        background:isTop?"rgba(34,197,94,0.1)":"rgba(239,68,68,0.1)",
                        color:isTop?T.green:T.red}}>{isTop?"\u2705 Leading":"\u274c Outbid"}</span>
                    </div>
                  </div>;
                })}
              </div>}
              
              {isBidPhase&&tierFilter82!=="CAMP" && <div style={{display:"flex",flexDirection:"column",gap:6}}>
              {filteredBids.slice(0,30).map(function(entry){
                var tierObj=FA_TIERS[entry.tierId]||FA_TIERS.DEPTH;
                var fillsNeed=myNeedList.indexOf(entry.pos)>=0;
                var isLoyal=(entry.teamTenure||0)>=4&&entry.formerTeam===myId;
                var isShort84=!!gmShortMap84[entry.playerId];
                var intel92=getFAContractIntel92(entry.playerId,entry.marketValue);
                var visibleDemand92=intel92.revealed?intel92.demand:intel92.mid;
                var payUp92=Math.round(visibleDemand92*1.15*10)/10;
                var lowball92=Math.round(visibleDemand92*0.8*10)/10;
                var userBid=entry.bids.find(function(b){return b.isUser;});
                var topAI=null;entry.bids.forEach(function(b){if(!b.isUser&&(!topAI||b.salary>topAI.salary))topAI=b;});
                var mvColor=!userBid?"transparent":userBid.salary>=entry.marketValue*1.1?T.green:userBid.salary>=entry.marketValue*0.9?T.gold:T.red;
                var p=fas.find(function(x){return x.id===entry.playerId;})||{};
                var trObj2=TRAITS[(p.trait||entry.agentType||"none")]||TRAITS.none;
                var phase2=getAgingPhase(p.age?p:{age:entry.age,pos:entry.pos});
                return <div key={entry.playerId} style={assign({},cS,{padding:0,overflow:"hidden",
                  borderColor:isShort84?T.gold:(fillsNeed?T.green:isLoyal?"#a78bfa":T.border),
                  borderLeft:"3px solid "+(isShort84?T.gold:tierObj.color)})}>
                  
                  <div style={{display:"flex",alignItems:"center",gap:10,padding:"10px 12px"}}>
                    {p.id && React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:40,age:p.age||entry.age})}
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{display:"flex",alignItems:"center",gap:4,flexWrap:"wrap"}}>
                        <span style={{color:T.gold,fontWeight:700,fontSize:12}}>{entry.pos}</span>
                        <span style={{fontWeight:800,fontSize:13,cursor:"pointer",textDecoration:"underline",textDecorationColor:T.border}} onClick={function(){if(p.id)setPlayerDetail(p);}}>{entry.name}</span>
                        {trObj2.icon && <span style={{fontSize:12}} title={trObj2.name}>{trObj2.icon}</span>}
                        {p.devTrait==="superstar" && <span style={{fontSize:10}}>{"\ud83c\udf1f"}</span>}
                        {p.devTrait==="star" && <span style={{fontSize:10}}>{"\u2b50"}</span>}
                      </div>
                      <div style={{display:"flex",gap:6,fontSize:10,color:T.dim,marginTop:2,flexWrap:"wrap"}}>
                        <span style={{color:phase2.color}}>{entry.age+" "+phase2.label}</span>
                        <span style={{fontSize:9,padding:"1px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(255,255,255,0.04)",border:"1px solid "+tierObj.color,color:tierObj.color}}>{tierObj.emoji+" "+tierObj.label}</span>
                        {entry.roundsLeft<=1 && <span style={{fontSize:9,padding:"1px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(239,68,68,0.1)",border:"1px solid "+T.red,color:T.red}}>{"\u23f0 Decides Soon"}</span>}
                      </div>
                      
                      <div style={{display:"flex",gap:4,marginTop:4,flexWrap:"wrap"}}>
                        {isShort84 && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(212,167,75,0.15)",border:"1px solid "+T.gold,color:T.gold}}>{"ðŸŽ¯ SHORTLIST"}</span>}
                        {fillsNeed && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(16,185,129,0.1)",border:"1px solid "+T.green,color:T.green}}>{"\u2705 FILLS NEED"}</span>}
                        {isLoyal && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(167,139,250,0.1)",border:"1px solid #a78bfa",color:"#a78bfa"}}>{"\u2764\ufe0f Loyalty ("+entry.teamTenure+"yr)"}</span>}
                        {entry.resentment82 && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(239,68,68,0.1)",border:"1px solid "+T.red,color:T.red}}>{"\ud83d\ude24 Insulted"}</span>}
                        {entry.agentType && (function(){var at=getAgentTypeObj(entry.agentType);return at?<span style={{fontSize:8,padding:"2px 6px",borderRadius:10,
                          background:"rgba(168,85,247,0.1)",border:"1px solid "+T.purple,color:T.purple}}>{at.emoji+" "+at.name}</span>:null;})()}
                        {(function(){var dt=getDominantTrait(p);return dt?<span style={{fontSize:8,padding:"2px 6px",borderRadius:10,
                          background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.15)",color:T.dim}} title={PERS_LABELS[dt.key]+" "+dt.val+"/10"}>
                          {PERS_ICONS[dt.key]+" "+PERS_LABELS[dt.key]}</span>:null;})()}
                        {intel92.narrowed && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(34,211,238,0.1)",border:"1px solid "+T.cyan,color:T.cyan}}>{"ðŸ§  FO NEGOTIATOR"}</span>}
                      </div>
                    </div>
                    
                    <div style={{textAlign:"center",minWidth:55}}>
                      <div style={assign({fontSize:26,fontWeight:900,lineHeight:"1"},oS(entry.ovr))}>{entry.ovr}</div>
                      <div style={{fontSize:8,color:T.faint}}>{intel92.revealed?("ASK $"+intel92.demand+"M"):("EST $"+intel92.min+"-"+intel92.max+"M")}</div>
                      {entry.bids.length>1 && <div style={{fontSize:8,color:T.orange}}>{"\ud83d\udd25 "+entry.bids.length+" bids"}</div>}
                    </div>
                  </div>
                  
                  {/* â”€â”€ NEGOTIATION_SCENE: bid phase agent bubble â”€â”€ */}
                  {(function(){
                    var bidP=fas.find(function(x){return x.id===entry.playerId;})||{};
                    if(!bidP.personality)return null;
                    var offerGap=userBid?Math.abs(entry.marketValue-(userBid.salary||0)):0;
                    var agentLine=userBid
                      ?NEGOTIATION_SCENE.getCounterLine(bidP,entry.marketValue,offerGap)
                      :NEGOTIATION_SCENE.getOpeningLine(bidP,entry.marketValue,entry.contract&&entry.contract.years||2);
                    var pers=bidP.personality||{};
                    var agentStyle=pers.greed>=7?"ðŸ’¼ Cutthroat Agent":pers.loyalty>=7?"ðŸ¤ Loyal Rep":pers.ego>=7?"ðŸ‘‘ Power Broker":pers.ambition>=7?"ðŸš€ Shark Agent":"ðŸ“‹ Standard Agent";
                    var bubbleColor=userBid?(offerGap<2?"rgba(34,197,94,0.06)":offerGap<5?"rgba(251,191,36,0.05)":"rgba(239,68,68,0.05)"):"rgba(167,139,250,0.05)";
                    var borderColor=userBid?(offerGap<2?"rgba(34,197,94,0.2)":offerGap<5?"rgba(251,191,36,0.15)":"rgba(239,68,68,0.15)"):"rgba(167,139,250,0.15)";
                    return React.createElement("div",{style:{padding:"6px 12px",background:bubbleColor,borderBottom:"1px solid "+borderColor,display:"flex",gap:8,alignItems:"flex-start"}},
                      React.createElement("div",{style:{fontSize:16,flexShrink:0,marginTop:1}},"ðŸ—£ï¸"),
                      React.createElement("div",{style:{flex:1}},
                        React.createElement("div",{style:{fontSize:8,fontWeight:800,color:T.purple,letterSpacing:1,marginBottom:2}},agentStyle),
                        React.createElement("div",{style:{fontSize:9,color:T.text,fontStyle:"italic",lineHeight:"1.4"}},'"'+agentLine+'"')
                      )
                    );
                  })()}
                  <div style={{padding:"8px 12px",background:"rgba(255,255,255,0.02)",borderTop:"1px solid "+T.border}}>
                    {userBid ? <div>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                        <div style={{fontSize:11}}>
                          <span style={{color:T.dim}}>{"Your bid: "}</span>
                          <span style={{fontWeight:800,color:mvColor}}>{"$"+userBid.salary+"M/"+userBid.years+"yr"}</span>
                          <span style={{fontSize:9,color:T.faint}}>{" ("+FA_ROLE_PITCH[userBid.role].icon+" "+FA_ROLE_PITCH[userBid.role].label+")"}</span>
                        </div>
                        <div style={{display:"flex",gap:4}}>
                          {!userBid.visitUsed&&faVisits82&&faVisits82.used<faVisits82.max && <button style={{background:"rgba(251,191,36,0.1)",border:"1px solid "+T.gold,borderRadius:6,padding:"3px 8px",fontSize:9,color:T.gold,fontWeight:700,cursor:"pointer"}}
                            onClick={function(){useVisit82(entry.playerId);}}>{"\ud83c\udfe0 Visit"}</button>}
                          {userBid.visitUsed && <span style={{fontSize:8,color:T.green}}>{"\u2705 Visited"}</span>}
                        </div>
                      </div>
                      {topAI && <div style={{fontSize:9,color:T.dim}}>{"Top rival: "+(function(){var rt=teams.find(function(t){return t.id===topAI.teamId;});return rt?rt.icon+" "+rt.abbr:"AI";})()+" $"+topAI.salary+"M/"+topAI.years+"yr"}</div>}
                      <div style={{display:"flex",gap:4,marginTop:4}}>
                        <button style={{background:T.green,color:"#000",border:"none",borderRadius:4,padding:"4px 10px",fontSize:10,fontWeight:700,cursor:"pointer"}}
                          onClick={function(){placeFABid(entry.playerId,Math.round((userBid.salary+0.5)*10)/10,userBid.years,userBid.role);}}>{"\u2b06 +$0.5M"}</button>
                        <button style={{background:T.gold,color:"#000",border:"none",borderRadius:4,padding:"4px 10px",fontSize:10,fontWeight:700,cursor:"pointer"}}
                          onClick={function(){placeFABid(entry.playerId,Math.round((userBid.salary+1.0)*10)/10,userBid.years,userBid.role);}}>{"\u2b06 +$1M"}</button>
                        <button style={{background:T.red,color:"#fff",border:"none",borderRadius:4,padding:"4px 10px",fontSize:10,fontWeight:700,cursor:"pointer"}}
                          onClick={function(){
                            var newBids=faBids82.slice();var e2=newBids.find(function(x){return x.playerId===entry.playerId;});
                            if(e2){e2.bids=e2.bids.filter(function(b){return !b.isUser;});}
                            setFaBids82(newBids);addN("\u274c Withdrew bid on "+entry.name,"dim");
                          }}>{"\u274c Pull"}</button>
                      </div>
                    </div>
                    : <div>
                      
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                        <div style={{fontSize:11}}>
                          <span style={{color:T.dim}}>{intel92.revealed?"Asking: ":"Est: "}</span>
                          <span style={{fontWeight:800,color:T.gold}}>{intel92.revealed?("$"+intel92.demand+"M"):("$"+intel92.min+"M-$"+intel92.max+"M")}</span>
                        </div>
                        
                        <div style={{display:"flex",gap:3}}>
                          {["STARTER","ROTATION","BACKUP","DEPTH"].map(function(rk){
                            var rp=FA_ROLE_PITCH[rk];
                            return <span key={rk} onClick={function(){setFaBidRole82(rk);}}
                              style={{fontSize:8,padding:"2px 5px",borderRadius:4,cursor:"pointer",fontWeight:600,
                                background:faBidRole82===rk?"rgba(212,167,75,0.15)":"transparent",
                                border:"1px solid "+(faBidRole82===rk?T.gold:T.border),
                                color:faBidRole82===rk?T.gold:T.faint}}>{rp.icon}</span>;
                          })}
                        </div>
                      </div>
                      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4}}>
                        <button style={{background:T.green,color:"#000",border:"none",borderRadius:6,padding:"8px 4px",
                          fontSize:10,fontWeight:700,cursor:"pointer",lineHeight:"1.2"}}
                          onClick={function(){placeFABid(entry.playerId,payUp92,entry.contract?entry.contract.years:2,faBidRole82);}}>
                          <div>{"\ud83d\udcb0 Pay Up"}</div>
                          <div style={{fontWeight:900}}>{"$"+payUp92+"M"}</div>
                        </button>
                        <button style={{background:T.gold,color:"#000",border:"none",borderRadius:6,padding:"8px 4px",
                          fontSize:10,fontWeight:700,cursor:"pointer",lineHeight:"1.2"}}
                          onClick={function(){placeFABid(entry.playerId,visibleDemand92,entry.contract?entry.contract.years:2,faBidRole82);}}>
                          <div>{"\ud83d\udcca Market"}</div>
                          <div style={{fontWeight:900}}>{"$"+visibleDemand92+"M"}</div>
                        </button>
                        <button style={{background:T.orange,color:"#000",border:"none",borderRadius:6,padding:"8px 4px",
                          fontSize:10,fontWeight:700,cursor:"pointer",lineHeight:"1.2"}}
                          onClick={function(){placeFABid(entry.playerId,lowball92,entry.contract?entry.contract.years:2,faBidRole82);}}>
                          <div>{"\ud83c\udfb2 Lowball"}</div>
                          <div style={{fontWeight:900}}>{"$"+lowball92+"M"}</div>
                        </button>
                      </div>
                      {isLoyal && <div style={{fontSize:8,color:"#a78bfa",marginTop:3}}>{"\u2764\ufe0f Loyalty discount available \u2014 may accept below market"}</div>}
                    </div>}
                    {!intel92.revealed && <div style={{marginTop:6}}>
                      <button style={assign({},bS((my.scoutPts||0)>=30?T.cyan:T.bg3,(my.scoutPts||0)>=30?"#000":T.faint),{fontSize:9,padding:"4px 8px"})}
                        onClick={function(){callAgentContractIntel92(entry.playerId,entry.name);}}>
                        {"ðŸ“ž Call Agent (30 scout pts)"}
                      </button>
                    </div>}
                  </div>
                </div>;
              })}
              {filteredBids.length===0&&tierFilter82!=="CAMP" && <div style={{color:T.faint,textAlign:"center",padding:24,fontSize:13}}>
                {tierFilter82==="ALL"?"No open bids remaining.":"No "+tierFilter82+" tier FAs available."}
              </div>}
              </div>}
              
              {(!isBidPhase||tierFilter82==="CAMP") && <div style={{display:"flex",flexDirection:"column",gap:6}}>
              {(isBidPhase?filteredCamp:fas.filter(function(p){return posF==="ALL"||p.pos===posF;}).sort(function(a,b){
                var aShort=gmShortMap84[a.id]?1:0;var bShort=gmShortMap84[b.id]?1:0;
                if(aShort!==bShort)return aShort?-1:1;
                var aBias=getGMFABias(gmStrategy,a);var bBias=getGMFABias(gmStrategy,b);
                return (b.ovr*bBias)-(a.ovr*aBias);
              })).slice(0,40).map(function(p){
                var trObj2=TRAITS[p.trait||"none"]||TRAITS.none;
                var phase2=getAgingPhase(p);
                var pm3=(my.prestige-50)*0.1;
                var demand3=Math.max(p.contract.salary,p.contract.salary*(1.1-pm3*0.02));
                if(my.ownerMood<40)demand3=demand3*1.2;
                demand3=Math.round(demand3*10)/10;
                var intelCamp92=getFAContractIntel92(p.id,demand3);
                var shownDemand92=intelCamp92.revealed?intelCamp92.demand:intelCamp92.mid;
                var payUp2=Math.round(shownDemand92*1.15*10)/10;
                var lowball2=Math.round(shownDemand92*0.8*10)/10;
                var isMin=p.faYears>=1;
                var fillsNeed=myNeedList.indexOf(p.pos)>=0;
                var isRevenge=p.formerTeam===myId;
                var isShort84=!!gmShortMap84[p.id];
                var capAfter=capUsed3+dead3+shownDemand92;
                var canAfford=capAfter<=theCap3||isMin;
                var tier=p.ovr>=80?"Elite":p.ovr>=72?"Starter":p.ovr>=64?"Depth":"Camp Body";
                var tierColor=p.ovr>=80?T.green:p.ovr>=72?T.gold:p.ovr>=64?T.orange:T.faint;
                return <div key={p.id} style={assign({},cS,{padding:0,overflow:"hidden",
                  borderColor:isShort84?T.gold:(fillsNeed?T.green:isRevenge?T.red:T.border),
                  borderLeft:"3px solid "+(isShort84?T.gold:(fillsNeed?T.green:isRevenge?T.red:tierColor))})}>
                  
                  <div style={{display:"flex",alignItems:"center",gap:10,padding:"10px 12px"}}>
                    {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:40,age:p.age})}
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{display:"flex",alignItems:"center",gap:4,flexWrap:"wrap"}}>
                        <span style={{color:T.gold,fontWeight:700,fontSize:12}}>{p.pos}</span>
                        <span style={{fontWeight:800,fontSize:13,cursor:"pointer",textDecoration:"underline",textDecorationColor:T.border}} onClick={function(){setPlayerDetail(p);}}>{p.name}</span>
                        {trObj2.icon && <span style={{fontSize:12}} title={trObj2.name+": "+(trObj2.desc||"")}>{trObj2.icon}</span>}
                        {p.devTrait==="superstar" && <span style={{fontSize:10}}>{"\ud83c\udf1f"}</span>}
                        {p.devTrait==="star" && <span style={{fontSize:10}}>{"\u2b50"}</span>}
                      </div>
                      <div style={{display:"flex",gap:6,fontSize:10,color:T.dim,marginTop:2,flexWrap:"wrap"}}>
                        <span style={{color:phase2.color}}>{p.age+" "+phase2.label}</span>
                        {p.college && <span style={{color:T.cyan}}>{"\ud83c\udf93 "+p.college.school}</span>}
                        {p._pipelineSchoolId&&(function(){var pt=PIPELINE.getTier(p._pipelineBonus>=0.08?80:p._pipelineBonus>=0.05?60:p._pipelineBonus>=0.02?35:0);return <span style={{color:pt.color,fontWeight:800,fontSize:9}}>{pt.emoji+" Pipeline: "+pt.label}</span>;}())}
                        {(p.archetype||PLAYER_ARCHETYPES.classify(p)) && <span title={((p.archetype||PLAYER_ARCHETYPES.classify(p)).description||"")} style={{color:T.gold}}>{(p.archetype||PLAYER_ARCHETYPES.classify(p)).emoji+" "+(p.archetype||PLAYER_ARCHETYPES.classify(p)).label}</span>}
                      </div>
                      <div style={{display:"flex",gap:4,marginTop:4,flexWrap:"wrap"}}>
                        <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(255,255,255,0.05)",border:"1px solid "+tierColor,color:tierColor}}>{tier}</span>
                        {isShort84 && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(212,167,75,0.15)",border:"1px solid "+T.gold,color:T.gold}}>{"ðŸŽ¯ SHORTLIST"}</span>}
                        {fillsNeed && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(16,185,129,0.1)",border:"1px solid "+T.green,color:T.green}}>{"\u2705 FILLS NEED"}</span>}
                        {isMin && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(103,232,249,0.1)",border:"1px solid "+T.cyan,color:T.cyan}}>{"\ud83c\udff7\ufe0f MIN DEAL"}</span>}
                        {isRevenge && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(239,68,68,0.1)",border:"1px solid "+T.red,color:T.red}}>{"\ud83d\udd25 EX-PLAYER"}</span>}
                        {p.agentType && (function(){var at=getAgentTypeObj(p.agentType);return <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,
                          background:"rgba(168,85,247,0.1)",border:"1px solid "+T.purple,color:T.purple}}>{at.emoji+" "+at.name}</span>;})()}
                        {p.flexPos76 && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(251,191,36,0.1)",border:"1px solid "+T.gold,color:T.gold}}>{"\ud83d\udd04 Flex: "+p.flexPos76}</span>}
                        {intelCamp92.narrowed && <span style={{fontSize:8,padding:"2px 6px",borderRadius:10,fontWeight:700,
                          background:"rgba(34,211,238,0.1)",border:"1px solid "+T.cyan,color:T.cyan}}>{"ðŸ§  FO NEGOTIATOR"}</span>}
                      </div>
                    </div>
                    <div style={{textAlign:"center",minWidth:50}}>
                      <div style={assign({fontSize:26,fontWeight:900,lineHeight:"1"},oS(p.ovr))}>{p.ovr}</div>
                      <div style={{fontSize:9,color:T.faint}}>{"POT "+p.pot}</div>
                    </div>
                  </div>
                  
                  {/* â”€â”€ NEGOTIATION_SCENE: FA agent opening bubble â”€â”€ */}
                  {(function(){
                    var agentLine=NEGOTIATION_SCENE.getOpeningLine(p,shownDemand92,p.contract&&p.contract.years||2);
                    var pers=p.personality||{};
                    var agentStyle=pers.greed>=7?"ðŸ’¼ Cutthroat Agent":pers.loyalty>=7?"ðŸ¤ Loyal Rep":pers.ego>=7?"ðŸ‘‘ Power Broker":pers.ambition>=7?"ðŸš€ Shark Agent":"ðŸ“‹ Standard Agent";
                    return React.createElement("div",{style:{padding:"6px 12px",background:"rgba(167,139,250,0.05)",borderBottom:"1px solid rgba(167,139,250,0.15)",display:"flex",gap:8,alignItems:"flex-start"}},
                      React.createElement("div",{style:{fontSize:16,flexShrink:0,marginTop:1}},"ðŸ—£ï¸"),
                      React.createElement("div",{style:{flex:1}},
                        React.createElement("div",{style:{fontSize:8,fontWeight:800,color:T.purple,letterSpacing:1,marginBottom:2}},agentStyle),
                        React.createElement("div",{style:{fontSize:9,color:T.text,fontStyle:"italic",lineHeight:"1.4"}},'"'+agentLine+'"')
                      )
                    );
                  })()}
                  <div style={{padding:"8px 12px",background:"rgba(255,255,255,0.02)",borderTop:"1px solid "+T.border}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                      <div style={{fontSize:11}}>
                        <span style={{color:T.dim}}>{intelCamp92.revealed?"Asking: ":"Est: "}</span>
                        <span style={{fontWeight:800,color:T.gold}}>{intelCamp92.revealed?("$"+intelCamp92.demand+"M"):("$"+intelCamp92.min+"M-$"+intelCamp92.max+"M")}</span>
                        <span style={{color:T.faint}}>{"/" +p.contract.years+"yr"}</span>
                      </div>
                      <div style={{display:"flex",gap:8,alignItems:"center"}}>
                        <div style={{fontSize:9,padding:"1px 6px",borderRadius:4,fontWeight:700,
                          background:(rosterFull?"rgba(239,68,68,0.1)":"rgba(34,197,94,0.1)"),
                          color:rosterFull?T.red:T.green}}>
                          {"\ud83d\udc65 "+my.roster.length+"/"+lim3}
                        </div>
                        <div style={{fontSize:9,color:canAfford?T.dim:T.red,fontWeight:canAfford?400:700}}>
                          {canAfford?"Cap: $"+capAfter.toFixed(1)+"M":"\u26a0\ufe0f OVER CAP"}
                        </div>
                      </div>
                    </div>
                    <div style={{display:"grid",gridTemplateColumns:isMin?"1fr":"1fr 1fr 1fr 1fr",gap:4}}>
                      {isMin?
                        <button style={{background:T.cyan,color:"#000",border:"none",borderRadius:6,padding:"8px 0",
                          fontSize:12,fontWeight:800,cursor:"pointer"}}
                          onClick={function(){signFA(p,0);}}>{"\ud83c\udff7\ufe0f Sign Veteran Min \u2014 $"+MIN_SALARY+"M/1yr"}</button>
                      :<React.Fragment>
                        <button style={{background:T.green,color:"#000",border:"none",borderRadius:6,padding:"8px 4px",
                          fontSize:10,fontWeight:700,cursor:"pointer",lineHeight:"1.2"}}
                          onClick={function(){signFA(p,1.15);}}>
                          <div>{"\ud83d\udcb0 Pay Up"}</div>
                          <div style={{fontWeight:900}}>{"$"+payUp2+"M"}</div>
                        </button>
                        <button style={{background:T.gold,color:"#000",border:"none",borderRadius:6,padding:"8px 4px",
                          fontSize:10,fontWeight:700,cursor:"pointer",lineHeight:"1.2"}}
                          onClick={function(){signFA(p,1.0);}}>
                          <div>{"\ud83d\udcca Market"}</div>
                          <div style={{fontWeight:900}}>{"$"+shownDemand92+"M"}</div>
                        </button>
                        <button style={{background:T.orange,color:"#000",border:"none",borderRadius:6,padding:"8px 4px",
                          fontSize:10,fontWeight:700,cursor:"pointer",lineHeight:"1.2"}}
                          onClick={function(){signFA(p,0.8);}}>
                          <div>{"\ud83c\udfb2 Lowball"}</div>
                          <div style={{fontWeight:900}}>{"$"+lowball2+"M"}</div>
                        </button>
                        <button style={{background:T.cyan,color:"#000",border:"none",borderRadius:6,padding:"8px 4px",
                          fontSize:10,fontWeight:700,cursor:"pointer",lineHeight:"1.2"}}
                          onClick={function(){signFA(p,0);}}>
                          <div>{"\ud83c\udff7\ufe0f Min"}</div>
                          <div style={{fontWeight:900}}>{"$"+MIN_SALARY+"M"}</div>
                        </button>
                      </React.Fragment>}
                    </div>
                    {!intelCamp92.revealed && <div style={{marginTop:6}}>
                      <button style={assign({},bS((my.scoutPts||0)>=30?T.cyan:T.bg3,(my.scoutPts||0)>=30?"#000":T.faint),{fontSize:9,padding:"4px 8px"})}
                        onClick={function(){callAgentContractIntel92(p.id,p.name);}}>
                        {"ðŸ“ž Call Agent (30 scout pts)"}
                      </button>
                    </div>}
                    <div style={{fontSize:8,color:T.faint,marginTop:4,lineHeight:"1.3"}}>
                      {"\ud83d\udcb0 Pay Up = guaranteed sign + bonus yr  |  \ud83d\udcca Market = fair deal  |  \ud83c\udfb2 Lowball = risky  |  \ud83c\udff7\ufe0f Min = cap exempt, 1yr"+(isMin?" (veteran accepts!)":"")}
                    </div>
                  </div>
                </div>;
              })}
              </div>}
              {(!isBidPhase||tierFilter82==="CAMP") && (isBidPhase?filteredCamp:fas.filter(function(p){return posF==="ALL"||p.pos===posF;})).length===0 && <div style={{color:T.faint,textAlign:"center",padding:24,fontSize:13}}>
                {"No free agents available"+(posF!=="ALL"?" at "+posF:"")+"."}
              </div>}
              {(!isBidPhase||tierFilter82==="CAMP") && (isBidPhase?filteredCamp:fas.filter(function(p){return posF==="ALL"||p.pos===posF;})).length>40 && <div style={{textAlign:"center",fontSize:10,color:T.dim,padding:8}}>
                {"Showing top 40 of "+(isBidPhase?filteredCamp:fas.filter(function(p){return posF==="ALL"||p.pos===posF;})).length+" \u2014 filter by position to see more"}
              </div>}
              
              {faSignings82.length>0 && <div style={assign({},cS,{borderColor:T.cyan,background:"rgba(34,211,238,0.03)"})}>
                <div style={{fontWeight:800,fontSize:11,color:T.cyan,marginBottom:4}}>{"\ud83d\udcf0 Recent Signings"}</div>
                {faSignings82.slice(-5).reverse().map(function(s,si){
                  return <div key={si} style={{fontSize:9,padding:"2px 0",color:T.dim}}>{(s.isUser?"\u2705 ":"")+(s.icon||"")+s.team+" signs "+s.name+" ("+s.pos+" "+s.ovr+") $"+s.salary+"M/"+s.years+"yr"}</div>;
                })}
              </div>}
              {season.phase==="freeAgency" && faPhase82==="settling" && <button style={assign({},megaGold,{marginTop:10})} onClick={newSeason}>{"\u23ed Start Next Season"}</button>}
            </div>;
          })()}
          
          {tab==="staff" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={cS}>
                <div style={{fontWeight:700,color:T.purple,marginBottom:8}}>{"ðŸŽ© Coaching Staff"}</div>
                
                {history.length>0&&history[history.length-1]&&history[history.length-1].champId===myId &&
                  <div style={{background:"rgba(239,68,68,0.08)",border:"1px solid "+T.orange,borderRadius:6,padding:8,marginBottom:8,fontSize:11}}>
                    <span style={{color:T.orange,fontWeight:700}}>{"ðŸ§  BRAIN DRAIN WARNING: "}</span>
                    <span style={{color:T.dim}}>{"As champions, your coordinators are top poaching targets (65% chance). Other teams want your staff!"}</span>
                  </div>}
                
                {(my.staff.hc.isInterim||my.staff.oc.isInterim||my.staff.dc.isInterim) &&
                  <div style={{background:"rgba(239,68,68,0.1)",border:"1px solid "+T.red,borderRadius:6,padding:8,marginBottom:8,fontSize:11,color:T.red,fontWeight:600}}>
                    {"âš ï¸ You have an interim coach! Hire a replacement from the Candidates pool below."}
                  </div>}
                {[["HC",my.staff.hc],["OC",my.staff.oc],["DC",my.staff.dc]].map(function(entry){
                  var role=entry[0],c=entry[1];var isInterim=c.isInterim;
                  var cTraits=(c.traits||[]).map(function(tId){return COACH_TRAITS[tId];}).filter(Boolean);
                  return (
                    <div key={role} style={{padding:"10px 0",borderBottom:"1px solid "+T.border,
                      background:isInterim?"rgba(239,68,68,0.06)":"transparent"}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                        <div style={{flex:1}}>
                          <div style={{display:"flex",alignItems:"center",gap:6}}>
                            <span style={{color:isInterim?T.red:T.gold,fontWeight:700,fontSize:13}}>{role}</span>
                            <span style={{fontWeight:600,fontSize:12}}>{c.name}</span>
                            {isInterim && <span style={{fontSize:9,color:T.red,fontWeight:700}}>{"âš ï¸ INTERIM"}</span>}
                          </div>
                          <div style={{fontSize:10,color:isInterim?T.red:T.cyan,marginTop:2}}>{c.arch}</div>
                          <div style={{fontSize:9,color:T.faint,marginTop:1}}>{"Str:"+c.ratings.strategy+" Dev:"+c.ratings.development+" GP:"+c.ratings.gameplan}</div>
                          
                          <div style={{display:"flex",gap:8,alignItems:"center",marginTop:3}}>
                            <span style={{fontSize:9,padding:"1px 6px",borderRadius:6,background:"rgba(168,85,247,0.15)",color:T.purple,fontWeight:700}}>{"Lv."+(c.level||1)}</span>
                            <div style={{flex:1,maxWidth:80,height:4,background:T.bg3,borderRadius:2,overflow:"hidden"}} title={"XP: "+(c.xp||0)+"/"+((c.level||1)*50)}>
                              <div style={{width:Math.min(100,((c.xp||0)%50)/50*100)+"%",height:"100%",background:T.purple,borderRadius:2}}></div>
                            </div>
                            <span style={{fontSize:8,color:T.dim}}>{"$"+(c.salary||3)+"M"+(c.yearsLeft?" â€¢ "+(c.yearsLeft||0)+"yr":"")}</span>
                            {(c.yearsLeft||0)>0 && <span style={{fontSize:7,color:T.orange}} title={"Buyout: $"+coachBuyout(c)+"M"}>{"ðŸ”’$"+coachBuyout(c)+"M"}</span>}
                            <span style={{fontSize:8,color:T.faint}}>{"Rep:"+(c.reputation||50)}</span>
                          </div>
                          {c.history&&c.history.seasons>0 && <div style={{fontSize:8,color:T.dim,marginTop:2}}>
                            {"ðŸ“‹ "+(c.history.wins||0)+"W-"+(c.history.losses||0)+"L"
                            +(c.history.playoffWins?" â€¢ "+c.history.playoffWins+"ðŸŸï¸":"")
                            +(c.history.rings?" â€¢ "+c.history.rings+"ðŸ’":"")
                            +" â€¢ "+c.history.seasons+" seasons"}
                          </div>}
                          
                          {cTraits.length>0 && <div style={{display:"flex",gap:4,marginTop:4,flexWrap:"wrap"}}>
                            {cTraits.map(function(tr){
                              return <span key={tr.label} style={{fontSize:9,padding:"2px 6px",borderRadius:8,
                                background:"rgba(168,85,247,0.12)",border:"1px solid rgba(168,85,247,0.3)",
                                color:T.purple,fontWeight:600}} title={tr.desc}>
                                {tr.icon+" "+tr.label}
                              </span>;
                            })}
                          </div>}
                          
                          {cTraits.length>0 && <div style={{fontSize:8,color:T.dim,marginTop:3}}>
                            {cTraits.map(function(tr){return tr.desc;}).join(" â€¢ ")}
                          </div>}
                          
                          {(role==="OC"||role==="DC") && (function(){
                            var spec75=c.specialty75;
                            if(!spec75){spec75=assignCoordSpecialty(c,role);}
                            if(!spec75)return null;
                            return <div style={{marginTop:4,padding:"3px 6px",borderRadius:4,background:"rgba(34,211,238,0.08)",border:"1px solid rgba(34,211,238,0.15)",display:"inline-flex",gap:4,alignItems:"center"}}>
                              <span style={{fontSize:9,fontWeight:700,color:T.cyan}}>{spec75.icon+" "+spec75.label}</span>
                              <span style={{fontSize:8,color:T.dim}}>{spec75.desc}</span>
                            </div>;
                          })()}
                        </div>
                        <button style={bS(T.bg3,T.red)} onClick={function(){fireCoach(role);}}>Fire</button>
                      </div>
                    </div>
                  );
                })}
                
                {(function(){
                  var mods=getCoachTraitMods(my);
                  var activeEffects=[];
                  if(mods.stallReduction>0)activeEffects.push("ðŸ“‰ -"+Math.round(mods.stallReduction*100)+"% stalls");
                  if(mods.pressureBoost>0)activeEffects.push("âš¡ +"+Math.round(mods.pressureBoost*100)+"% pressure");
                  if(mods.intBoost>0)activeEffects.push("ðŸ¦… +"+Math.round(mods.intBoost*1000)/10+"% INTs");
                  if(mods.intReduction>0)activeEffects.push("ðŸ›¡ï¸ -"+Math.round(mods.intReduction*1000)/10+"% INTs");
                  if(mods.qbBoost>0)activeEffects.push("ðŸ§  +"+mods.qbBoost+" QB");
                  if(mods.rzTdBoost>0)activeEffects.push("ðŸŽ¯ +"+mods.rzTdBoost+" RZ");
                  if(mods.devRate>0)activeEffects.push("ðŸ”¬ +"+Math.round(mods.devRate*100)+"% dev");
                  if(mods.moraleBoost>0)activeEffects.push("ðŸ¤ +"+mods.moraleBoost+" morale");
                  if(mods.bigPlayBoost>0)activeEffects.push("ðŸ’¥ +"+Math.round(mods.bigPlayBoost*100)+"% explosive");
                  if(mods.pocketBoost>0)activeEffects.push("ðŸ›¡ï¸ +pocket");
                  return activeEffects.length>0?<div style={{marginTop:8,padding:8,background:"rgba(168,85,247,0.06)",borderRadius:6,border:"1px solid rgba(168,85,247,0.15)"}}>
                    <div style={{fontSize:9,fontWeight:700,color:T.purple,marginBottom:4}}>{"ðŸ“Š COMBINED COACHING EFFECTS"}</div>
                    <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                      {activeEffects.map(function(e,i){return <span key={i} style={{fontSize:9,color:T.text,background:"rgba(255,255,255,0.04)",padding:"2px 6px",borderRadius:4}}>{e}</span>;})}
                    </div>
                  </div>:null;
                })()}
              </div>
              
              {my.posCoaches && <div style={assign({},cS,{borderColor:"rgba(96,165,250,0.2)"})}>
                <div style={{fontWeight:700,color:T.cyan,marginBottom:6}}>{"ðŸ‹ï¸ Position Coaches"}</div>
                <div style={{fontSize:9,color:T.faint,marginBottom:6}}>{"Position coaches boost player development for their position group."}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                  {POS_COACH_SLOTS.map(function(slot){
                    var coach=my.posCoaches[slot];
                    if(!coach)return null;
                    var positions=(POS_COACH_MAP[slot]||[]).join("/");
                    var bonus=Math.floor((coach.rating||50)/20);
                    var ratingColor=coach.rating>=70?T.green:coach.rating>=55?T.gold:T.red;
                    return <div key={slot} style={{padding:8,borderRadius:6,background:"rgba(96,165,250,0.04)",border:"1px solid rgba(96,165,250,0.1)"}}>
                      <div style={{fontSize:8,fontWeight:800,color:T.cyan,letterSpacing:1,marginBottom:2}}>{POS_COACH_LABELS[slot]}</div>
                      <div style={{fontSize:11,fontWeight:700}}>{coach.name}</div>
                      <div style={{display:"flex",gap:8,alignItems:"center",marginTop:3}}>
                        <span style={{fontSize:10,fontWeight:800,color:ratingColor}}>{coach.rating+" OVR"}</span>
                        <span style={{fontSize:8,color:T.faint}}>{"Develops: "+positions}</span>
                      </div>
                      <div style={{fontSize:8,color:bonus>=2?T.green:bonus>=1?T.gold:T.faint,fontWeight:600,marginTop:2}}>
                        {"Dev bonus: +"+(bonus*0.3).toFixed(1)+" XP/tick"}
                      </div>
                    </div>;
                  })}
                </div>
              </div>}
              <div style={cS}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <div style={{fontWeight:700,color:T.blue}}>{"ðŸ“‹ Available Candidates"}</div>
                  <div style={{display:"flex",gap:4}}>
                    {hiringPool&&hiringPool.some(function(c){return !c.scouted;}) &&
                      <button style={bS("rgba(6,182,212,0.15)",T.cyan)} onClick={function(){interviewCoach(null,true);}}>{"ðŸ” Scout All ($3M)"}</button>}
                    <button style={bS(T.bg3,T.cyan)} onClick={function(){setHiringPool(genHiringPool());}}>Refresh</button>
                  </div>
                </div>
                
                {my&&(function(){
                  var budgetMax=getStaffBudgetMax();
                  var spent=getStaffBudgetUsed(my);
                  var pct=Math.min(100,Math.round(spent/budgetMax*100));
                  var barColor=pct>=95?T.red:pct>=75?T.orange:T.green;
                  return React.createElement("div",{style:{marginBottom:10,padding:"8px 10px",background:"rgba(255,255,255,0.03)",borderRadius:8,border:"1px solid rgba(255,255,255,0.07)"}},
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}},
                      React.createElement("span",{style:{fontSize:10,fontWeight:700,color:T.blue}},"ðŸ’¼ Staff Budget"),
                      React.createElement("span",{style:{fontSize:11,fontWeight:800,color:pct>=95?T.red:T.text}},"$"+spent.toFixed(1)+"M / $"+budgetMax+"M")
                    ),
                    React.createElement("div",{style:{height:6,background:"rgba(255,255,255,0.08)",borderRadius:3,overflow:"hidden"}},
                      React.createElement("div",{style:{height:"100%",width:pct+"%",background:barColor,borderRadius:3,transition:"width 0.3s"}})
                    ),
                    React.createElement("div",{style:{fontSize:9,color:T.faint,marginTop:3}},
                      pct>=100?"ðŸš« Budget full â€” fire a coach to free space":
                      pct>=80?"âš ï¸ Budget nearly full. Remaining: $"+(budgetMax-spent).toFixed(1)+"M":
                      "Remaining: $"+(budgetMax-spent).toFixed(1)+"M â€” "+((DIFF_SETTINGS[difficulty]||DIFF_SETTINGS.pro).name)+" mode"
                    )
                  );
                })()}
                {(function(){
                  var carouselPool974=(hiringPool||[]).filter(function(c){return c&&c.role==="HC"&&c.fromCarousel;});
                  if(carouselPool974.length===0)return null;
                  return <div style={{marginBottom:10,padding:"8px 10px",background:"rgba(251,191,36,0.04)",borderRadius:8,border:"1px solid rgba(251,191,36,0.18)"}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                      <div style={{fontSize:10,fontWeight:800,color:T.gold}}>{"ðŸŽ  Carousel Candidates"}</div>
                      <div style={{fontSize:8,color:T.faint}}>{carouselPool974.length+" fired HC"+(carouselPool974.length!==1?"s":"")+" available"}</div>
                    </div>
                    {carouselPool974.slice(0,4).map(function(c){
                      var isScouted=c.scouted||godMode;
                      var budMax=getStaffBudgetMax();
                      var existS=(my&&my.staff&&my.staff.hc&&!my.staff.hc.isInterim)?(my.staff.hc.salary||0):0;
                      var newTotal=Math.round((getStaffBudgetUsed(my)-existS+(c.salary||0))*10)/10;
                      var canAfford=godMode||newTotal<=budMax;
                      return <div key={c.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,padding:"5px 0",
                        borderBottom:"1px solid "+T.border}}>
                        <div style={{flex:1,minWidth:0}}>
                          <div style={{fontSize:10,fontWeight:700,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>
                            {c.name} <span style={{color:T.orange}}>{"(Fired HC)"}</span>
                          </div>
                          <div style={{fontSize:8,color:T.cyan}}>{c.arch+" â€¢ Str:"+(c.ratings&&c.ratings.strategy||50)+" Dev:"+(c.ratings&&c.ratings.development||50)+" GP:"+(c.ratings&&c.ratings.gameplan||50)}</div>
                          <div style={{fontSize:8,color:T.faint}}>{"Rep:"+(c.reputation||50)+" â€¢ $"+(c.salary||0)+"M"+(c.record974?" â€¢ "+c.record974:"")}</div>
                        </div>
                        <div style={{display:"flex",gap:4,alignItems:"center",flexShrink:0}}>
                          {!isScouted&&<button style={{fontSize:8,padding:"2px 6px",borderRadius:6,background:"rgba(6,182,212,0.12)",color:T.cyan,border:"1px solid rgba(6,182,212,0.3)",cursor:"pointer",fontWeight:600}}
                            onClick={function(){interviewCoach(c.id,false);}}>{"ðŸ”"}</button>}
                          <button style={canAfford?bS(T.green,"#000"):bS("rgba(100,116,139,0.3)",T.faint)}
                            onClick={function(){if(canAfford)hireCoach(c);}}
                            title={canAfford?"Hire for $"+c.salary+"M/yr":"Over budget! Would be $"+newTotal+"M/$"+budMax+"M"}>
                            {canAfford?"Hire":"ðŸš«"}
                          </button>
                        </div>
                      </div>;
                    })}
                    <div style={{fontSize:8,color:T.faint,marginTop:4}}>{"Fired HCs can be cheaper buy-low upgrades after the carousel."}</div>
                  </div>;
                })()}
                <div style={{display:"none"}}>
                </div>
                {hiringPool && hiringPool.length>0 ? hiringPool.map(function(c){
                  var isScouted=c.scouted||godMode;// God mode always reveals
                  var cTraits2=isScouted?(c.traits||[]).map(function(tId){return COACH_TRAITS[tId];}).filter(Boolean):[];
                  return (
                  <div key={c.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 0",borderBottom:"1px solid "+T.border}}>
                    <div style={{flex:1}}>
                      <span style={{color:T.gold,fontWeight:700}}>{c.role}</span>{" "+c.name}
                      <div style={{fontSize:10,color:T.cyan}}>{c.arch}</div>
                      <div style={{fontSize:9,color:T.faint}}>{"Str:"+c.ratings.strategy+" Dev:"+c.ratings.development+" GP:"+c.ratings.gameplan+" â€” $"+c.salary+"M"}</div>
                      
                      {isScouted && cTraits2.length>0 && <div style={{display:"flex",gap:3,marginTop:3}}>
                        {cTraits2.map(function(tr){return <span key={tr.label} style={{fontSize:8,padding:"1px 5px",borderRadius:6,
                          background:"rgba(168,85,247,0.10)",color:T.purple,fontWeight:600}}>{tr.icon+" "+tr.label}</span>;})}
                      </div>}
                      {!isScouted && <div style={{display:"flex",gap:3,marginTop:3,alignItems:"center"}}>
                        <span style={{fontSize:8,padding:"1px 5px",borderRadius:6,background:"rgba(255,255,255,0.05)",color:T.faint}}>{"â“ "+((c.traits||[]).length)+" trait"+(((c.traits||[]).length)!==1?"s":"")+" (hidden)"}</span>
                        <button style={{fontSize:8,padding:"1px 6px",borderRadius:6,background:"rgba(6,182,212,0.12)",color:T.cyan,border:"1px solid rgba(6,182,212,0.3)",cursor:"pointer",fontWeight:600}}
                          onClick={function(){interviewCoach(c.id,false);}}>{"ðŸ” Interview ($1M)"}</button>
                      </div>}
                    </div>
                    {(function(){
                      var budMax=getStaffBudgetMax();
                      var existS=0;
                      if(c.role==="HC"&&my.staff.hc&&!my.staff.hc.isInterim)existS=my.staff.hc.salary||0;
                      else if(c.role==="OC"&&my.staff.oc&&!my.staff.oc.isInterim)existS=my.staff.oc.salary||0;
                      else if(c.role==="DC"&&my.staff.dc&&!my.staff.dc.isInterim)existS=my.staff.dc.salary||0;
                      var newTotal=Math.round((getStaffBudgetUsed(my)-existS+c.salary)*10)/10;
                      var canAfford=godMode||newTotal<=budMax;
                      return React.createElement("div",{style:{textAlign:"center"}},
                        React.createElement("button",{
                          style:canAfford?bS(T.green,"#000"):bS("rgba(100,116,139,0.3)",T.faint,{cursor:"not-allowed",opacity:0.5}),
                          onClick:function(){if(canAfford)hireCoach(c);},
                          title:canAfford?"Hire for $"+c.salary+"M/yr":"Over budget! Would be $"+newTotal+"M/$"+budMax+"M"
                        },canAfford?"Hire":"ðŸš« Over"),
                        React.createElement("div",{style:{fontSize:8,color:canAfford?T.faint:T.red,marginTop:2}},
                          canAfford?"$"+c.salary+"M":"$"+newTotal+"M/"+budMax+"M")
                      );
                    })()}
                  </div>
                );}) : <div style={{color:T.dim,fontSize:12,textAlign:"center",padding:10}}>Hit Refresh to scout candidates</div>}
              </div>
            </div>
          )}
          
          {tab==="allTimeRecords" && (function(){
            var allP=teams.reduce(function(acc,t){return acc.concat(t.roster.map(function(p){return assign({},p,{tA:t.abbr,tIcon:t.icon});}));},[]);
            var CATS=[
              {id:"passYds",label:"Passing Yards",key:"passYds",icon:"ðŸˆ",pos:["QB"]},
              {id:"passTD",label:"Passing TDs",key:"passTD",icon:"ðŸŽ¯",pos:["QB"]},
              {id:"rushYds",label:"Rushing Yards",key:"rushYds",icon:"ðŸƒ",pos:["RB"]},
              {id:"rushTD",label:"Rush TDs",key:"rushTD",icon:"ðŸ’¨",pos:["RB"]},
              {id:"recYds",label:"Receiving Yards",key:"recYds",icon:"ðŸ«´",pos:["WR","TE"]},
              {id:"recTD",label:"Rec TDs",key:"recTD",icon:"âš¡",pos:["WR","TE"]},
              {id:"rec",label:"Receptions",key:"rec",icon:"ðŸ¤²",pos:["WR","TE","RB"]},
              {id:"sacks",label:"Sacks",key:"sacks",icon:"ðŸ’¥",pos:["DL","LB"]},
              {id:"defINT",label:"Interceptions",key:"defINT",icon:"ðŸ¦…",pos:["CB","S","LB"]},
              {id:"tackles",label:"Tackles",key:"tackles",icon:"ðŸ›¡ï¸",pos:["DL","LB","CB","S"]},
              {id:"fgM",label:"Field Goals",key:"fgM",icon:"ðŸŽ¯",pos:["K"]},
              {id:"punts",label:"Punts",key:"punts",icon:"ðŸ¦¶",pos:["P"]},
              {id:"puntYds",label:"Punt Yards",key:"puntYds",icon:"ðŸ“",pos:["P"]},
              {id:"gp",label:"Games Played",key:"gp",icon:"ðŸ“…",pos:[]},
              {id:"proBowls",label:"Pro Bowls",key:"proBowls",icon:"ðŸˆ",pos:[]},
              {id:"allPros",label:"All-Pro Selections",key:"allPros",icon:"â­",pos:[]}
            ];
            var activeCat=CATS.find(function(c){return c.id===recCat;})||CATS[0];
            var top20=allP.filter(function(p){return p.careerStats&&(p.careerStats[activeCat.key]||0)>0;})
              .sort(function(a,b){return(b.careerStats[activeCat.key]||0)-(a.careerStats[activeCat.key]||0);}).slice(0,20);
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:800,fontSize:14}}>{"ðŸ“œ All-Time Records & Leaderboards"}</div>
              
              <div style={assign({},cS,{borderColor:T.gold,background:"rgba(212,167,75,0.04)"})}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:8}}>{"ðŸ† SINGLE-SEASON RECORDS"}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                  {Object.entries(records).map(function(entry){var key=entry[0],rec=entry[1];
                    var label=key==="passYds"?"Pass Yards":key==="rushYds"?"Rush Yards":key==="sacks"?"Sacks":key==="defINT"?"INTs":key==="fgM"?"Field Goals":key==="puntYds"?"Punt Yards":"Rec Yards";
                    var icon2=key==="passYds"?"ðŸˆ":key==="rushYds"?"ðŸƒ":key==="sacks"?"ðŸ’¥":key==="defINT"?"ðŸ¦…":key==="fgM"?"ðŸŽ¯":key==="puntYds"?"ðŸ¦¶":"ðŸ«´";
                    return <div key={key} style={{background:T.bg3,borderRadius:6,padding:8,borderLeft:"3px solid "+T.gold}}>
                      <div style={{fontSize:8,color:T.faint}}>{icon2+" "+label}</div>
                      <div style={{fontSize:16,fontWeight:900,color:rec.v>0?T.gold:T.faint}}>{rec.v>0?rec.v.toLocaleString():"â€”"}</div>
                      <div style={{fontSize:9,color:T.dim}}>{rec.v>0?rec.h+" ("+rec.yr+")":"No record yet"}</div>
                    </div>;
                  })}
                </div>
              </div>
              
              <div style={{display:"flex",flexWrap:"wrap",gap:4}}>
                {CATS.map(function(cat){
                  var isActive=cat.id===recCat;
                  return <button key={cat.id} style={{
                    background:isActive?"rgba(34,211,238,0.15)":"rgba(255,255,255,0.03)",
                    color:isActive?T.cyan:T.faint,border:"1px solid "+(isActive?"rgba(34,211,238,0.3)":T.border),
                    borderRadius:12,padding:"4px 10px",fontSize:9,fontWeight:isActive?700:500,cursor:"pointer"
                  }} onClick={function(){setRecCat(cat.id);}}>{cat.icon+" "+cat.label}</button>;
                })}
              </div>
              
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:12,color:T.cyan,marginBottom:8}}>{activeCat.icon+" ALL-TIME "+activeCat.label.toUpperCase()+" LEADERS"}</div>
                {top20.length===0?<div style={{color:T.faint,textAlign:"center",padding:20}}>{"Complete a season to populate career leaders"}</div>:
                <table style={tS}><thead><tr>
                  <th style={thS}>{"#"}</th><th style={thS}>{"Name"}</th><th style={thS}>{"Pos"}</th><th style={thS}>{"Tm"}</th>
                  <th style={thS}>{"Age"}</th><th style={thS}>{"Szns"}</th><th style={thS}>{activeCat.label}</th><th style={thS}>{"MFDF"}</th>
                </tr></thead>
                <tbody>{top20.map(function(p,i){
                  var isMe2=teams.find(function(t){return t.id===myId;});
                  var isMine=isMe2&&isMe2.roster.some(function(x){return x.name===p.name;});
                  return <tr key={i} style={{background:isMine?"rgba(212,167,75,0.06)":"transparent"}}>
                    <td style={assign({},tdS,{color:i<3?T.gold:T.dim,fontWeight:i<3?900:400,fontSize:i===0?16:12})}>{i+1}</td>
                    <td style={assign({},tdS,{fontWeight:isMine?800:600})}>{p.name}</td>
                    <td style={assign({},tdS,{color:T.gold,fontSize:10})}>{p.pos}</td>
                    <td style={assign({},tdS,{fontSize:10})}>{p.tIcon+" "+p.tA}</td>
                    <td style={assign({},tdS,{fontSize:10})}>{p.age}</td>
                    <td style={assign({},tdS,{fontSize:10})}>{p.careerStats.seasons||0}</td>
                    <td style={assign({},tdS,{fontWeight:800,color:i===0?T.gold:T.cyan})}>{(p.careerStats[activeCat.key]||0).toLocaleString()}</td>
                    <td style={assign({},tdS,{fontWeight:700,color:p.pff>=80?"#22d3ee":p.pff>=70?"#fbbf24":"#9ca3af"})}>{p.pff||"â€”"}</td>
                  </tr>;
                })}</tbody></table>}
              </div>
              
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.purple,marginBottom:8}}>{"ðŸŽ–ï¸ FRANCHISE MILESTONES"}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                  <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                    <div style={{fontSize:8,color:T.faint}}>{"Seasons Played"}</div>
                    <div style={{fontSize:18,fontWeight:900}}>{history.length+1}</div>
                  </div>
                  <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                    <div style={{fontSize:8,color:T.faint}}>{"Championships"}</div>
                    <div style={{fontSize:18,fontWeight:900,color:T.gold}}>{history.filter(function(h){return h.winnerId===myId;}).length}</div>
                  </div>
                  <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                    <div style={{fontSize:8,color:T.faint}}>{"MVPs Won"}</div>
                    <div style={{fontSize:18,fontWeight:900,color:T.cyan}}>{history.filter(function(h){return h.mvp&&h.mvp.tm===my.abbr;}).length}</div>
                  </div>
                  <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                    <div style={{fontSize:8,color:T.faint}}>{"Hall of Famers"}</div>
                    <div style={{fontSize:18,fontWeight:900,color:T.purple}}>{hallOfFame.length}</div>
                  </div>
                </div>
              </div>
              
              {history.length>0 && <div style={assign({},cS,{borderColor:"rgba(167,139,250,0.3)"})}>
                <div style={{fontWeight:700,fontSize:11,color:T.purple,marginBottom:8}}>{"ðŸ“š LEAGUE ALMANAC"}</div>
                <table style={tS}><thead><tr>
                  <th style={thS}>{"Year"}</th><th style={thS}>{"Champion"}</th><th style={thS}>{"MVP"}</th><th style={thS}>{"OPOY"}</th><th style={thS}>{"DPOY"}</th>
                </tr></thead>
                <tbody>{history.slice().sort(function(a,b){return b.year-a.year;}).map(function(h){
                  var isMine2=h.winnerId===myId;
                  return <tr key={h.year} style={{background:isMine2?"rgba(212,167,75,0.08)":"transparent"}}>
                    <td style={assign({},tdS,{fontWeight:800})}>{h.year}</td>
                    <td style={assign({},tdS,{fontWeight:700,color:isMine2?T.gold:T.dim})}>{h.champ?(h.champ.icon||"")+" "+h.champ.abbr:"?"}{isMine2?" ðŸ†":""}</td>
                    <td style={assign({},tdS,{fontSize:10})}>{h.mvp?h.mvp.name+" ("+h.mvp.pos+")":"?"}</td>
                    <td style={assign({},tdS,{fontSize:10})}>{h.opoy?h.opoy.name:""}</td>
                    <td style={assign({},tdS,{fontSize:10})}>{h.dpoy?h.dpoy.name:""}</td>
                  </tr>;
                })}</tbody></table>
              </div>}
            </div>;
          })()}
          
          {tab==="allTimeRecords" && (function(){
            var atRecords75=ALL_TIME_RECORDS.buildRecords(history);
            return <div>
              <div style={{fontWeight:900,fontSize:14,marginBottom:8}}>{"ðŸ† ALL-TIME LEAGUE RECORDS"}</div>
              {history.length===0?<div style={{color:T.faint,textAlign:"center",padding:20}}>{"Play some seasons to build up league records!"}</div>:
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                {ALL_TIME_RECORDS.categories.map(function(cat){
                  var recs=atRecords75[cat.id]||[];
                  var catIcon=cat.id==="passYds"?"ðŸˆ":cat.id==="passTD"?"ðŸŽ¯":cat.id==="rushYds"?"ðŸƒ":cat.id==="rushTD"?"ðŸ’¨":cat.id==="recYds"?"ðŸ«´":cat.id==="rec"?"ðŸ¤²":cat.id==="sacks"?"ðŸ’¥":cat.id==="defINT"?"ðŸ¦…":cat.id==="tackles"?"ðŸ›¡ï¸":cat.id==="teamWins"?"ðŸ†":cat.id==="teamPF"?"ðŸ“Š":"ðŸ”’";
                  return <div key={cat.id} style={assign({},cS,{padding:8,borderColor:recs.length>0?T.gold+"40":T.border})}>
                    <div style={{fontSize:10,fontWeight:800,color:T.gold,marginBottom:4}}>{catIcon+" "+cat.label}</div>
                    {recs.length===0?<div style={{fontSize:9,color:T.faint}}>{"No records yet"}</div>:
                    <div>{recs.slice(0,5).map(function(r,ri){
                      var isMine75=r.team===my.abbr||r.name===my.abbr;
                      return <div key={ri} style={{display:"flex",gap:4,alignItems:"center",padding:"2px 0",borderBottom:ri<4?"1px solid "+T.border:"none"}}>
                        <span style={{width:14,fontSize:9,fontWeight:800,color:ri===0?T.gold:T.faint}}>{ri+1}</span>
                        <span style={{flex:1,fontSize:10,fontWeight:ri===0?700:400,color:isMine75?T.gold:T.text}}>{r.name||"?"}</span>
                        {r.pos && <span style={{fontSize:8,color:T.cyan}}>{r.pos}</span>}
                        {r.team && <span style={{fontSize:8,color:T.dim}}>{r.team}</span>}
                        <span style={{fontWeight:700,fontSize:11,color:ri===0?T.gold:T.text}}>{typeof r.val==="number"?r.val.toLocaleString():r.val}</span>
                        <span style={{fontSize:8,color:T.faint}}>{r.year||""}</span>
                      </div>;
                    })}</div>}
                  </div>;
                })}
              </div>}
            </div>;
          })()}
          
          {tab==="history" && (
            <div>
              
              <div style={assign({},cS,{background:"rgba(212,167,75,0.04)",borderColor:T.gold,textAlign:"center",marginBottom:12})}>
                <div style={{fontWeight:900,color:T.gold,fontSize:14,letterSpacing:2,marginBottom:8}}>ðŸ† TROPHY ROOM</div>
                {history.filter(function(h){return h.winnerId===myId;}).length===0?
                  React.createElement("div",{style:{color:T.faint,fontSize:11,padding:16}},
                    React.createElement("div",{style:{fontSize:32,marginBottom:6}},"ðŸ—„ï¸"),
                    React.createElement("div",null,"Cabinet empty. Win a ring.")
                  ):
                  React.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:14,padding:"8px 0"}},
                    history.filter(function(h){return h.winnerId===myId;}).map(function(h){
                      return React.createElement("div",{key:h.year,style:{textAlign:"center"}},
                        React.createElement(Trophy,{type:"champ",size:48,year:String(h.year)}),
                        React.createElement("div",{style:{fontSize:9,color:T.gold,marginTop:3,fontWeight:700}},h.year)
                      );
                    })
                  )
                }
                {history.filter(function(h){return h.winnerId===myId;}).length>0 &&
                  React.createElement("div",{style:{fontSize:10,color:T.dim,marginTop:6}},
                    history.filter(function(h){return h.winnerId===myId;}).length+"x Champion"
                  )
                }
              </div>
              
              {history.length>0 && <div style={assign({},cS,{padding:10,marginBottom:12})}>
                <div style={{fontWeight:700,fontSize:11,color:T.cyan,marginBottom:8,letterSpacing:1}}>{"ðŸ“– LEAGUE ALMANAC"}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                  
                  {(function(){
                    var titleCount={};history.forEach(function(h){
                      var key=h.champ?h.champ.abbr:"?";titleCount[key]=(titleCount[key]||0)+1;
                    });
                    var sorted3=Object.keys(titleCount).sort(function(a,b){return titleCount[b]-titleCount[a];});
                    return <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                      <div style={{fontSize:9,color:T.gold,fontWeight:700,marginBottom:4}}>{"ðŸ† MOST TITLES"}</div>
                      {sorted3.slice(0,3).map(function(abbr,i){
                        return <div key={abbr} style={{fontSize:10,color:i===0?T.gold:T.dim}}>{(i+1)+". "+abbr+" â€” "+titleCount[abbr]+"Ã—"}</div>;
                      })}
                    </div>;
                  })()}
                  
                  {(function(){
                    var mvpCount={};history.forEach(function(h){
                      if(h.mvp){var key=h.mvp.name+" ("+h.mvp.pos+")";mvpCount[key]=(mvpCount[key]||0)+1;}
                    });
                    var sorted3=Object.keys(mvpCount).sort(function(a,b){return mvpCount[b]-mvpCount[a];});
                    return <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                      <div style={{fontSize:9,color:T.gold,fontWeight:700,marginBottom:4}}>{"ðŸŒŸ MVP WINNERS"}</div>
                      {sorted3.length===0?<div style={{fontSize:10,color:T.faint}}>{"No MVPs recorded yet"}</div>:
                      sorted3.slice(0,3).map(function(name,i){
                        return <div key={name} style={{fontSize:10,color:i===0?T.gold:T.dim}}>{(i+1)+". "+name+(mvpCount[name]>1?" Ã—"+mvpCount[name]:"")}</div>;
                      })}
                    </div>;
                  })()}
                  
                  {(function(){
                    var myTitles=history.filter(function(h){return h.winnerId===myId;}).length;
                    var myPlayoffs=history.filter(function(h){
                      return h.bracket&&h.bracket.qf&&h.bracket.qf.some(function(g){return g.winnerId===myId||g.home===(my?my.abbr:"")||g.away===(my?my.abbr:"");});
                    }).length;
                    return <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                      <div style={{fontSize:9,color:T.green,fontWeight:700,marginBottom:4}}>{"ðŸ“Š YOUR DYNASTY"}</div>
                      <div style={{fontSize:10}}>{myTitles+"Ã— Champion"}</div>
                      <div style={{fontSize:10,color:T.dim}}>{history.length+" seasons played"}</div>
                    </div>;
                  })()}
                  
                  <div style={{background:T.bg3,borderRadius:6,padding:8}}>
                    <div style={{fontSize:9,color:T.purple,fontWeight:700,marginBottom:4}}>{"ðŸ“… LEAGUE ERAS"}</div>
                    <div style={{fontSize:10}}>{"Seasons: "+history.length}</div>
                    <div style={{fontSize:10,color:T.dim}}>{history.length>0?(history[0].year+" â€” "+(history[history.length-1].year)):""}</div>
                  </div>
                </div>
              </div>}
              <div style={{fontWeight:700,marginBottom:8}}>ðŸ“œ League Archives</div>
              {history.length===0?<div style={{color:T.dim,textAlign:"center",padding:20}}>Complete a season first!</div>
              :history.slice().reverse().map(function(h,hi){
                var isMyChamp=h.winnerId===myId;
                var bk=h.bracket;
                return React.createElement("div",{key:hi,style:assign({},cS,{borderColor:isMyChamp?T.gold:T.border,background:isMyChamp?"rgba(212,167,75,0.04)":T.bg2,padding:0,overflow:"hidden"})},
                  React.createElement("div",{style:{background:isMyChamp?"linear-gradient(135deg,rgba(212,167,75,0.12),rgba(212,167,75,0.04))":"rgba(255,255,255,0.02)",padding:"10px 12px",borderBottom:"1px solid "+T.border,display:"flex",justifyContent:"space-between",alignItems:"center"}},
                    React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
                      isMyChamp?React.createElement(Trophy,{type:"champ",size:28,year:String(h.year)}):React.createElement("span",{style:{fontSize:20}},h.champ?h.champ.icon:"ðŸˆ"),
                      React.createElement("div",null,
                        React.createElement("div",{style:{fontWeight:900,fontSize:14,color:isMyChamp?T.gold:T.text}},h.year+" "+(h.champ?h.champ.name:"")),
                        React.createElement("div",{style:{fontSize:10,color:T.dim}},(h.champ?h.champ.w:0)+"W-"+(h.champ?h.champ.l:0)+"L Champions")
                      )
                    ),
                    isMyChamp?React.createElement("span",{style:{fontSize:9,background:T.gold,color:"#000",padding:"2px 8px",borderRadius:4,fontWeight:800}},"YOUR TITLE"):null
                  ),
                  bk?React.createElement("div",{style:{padding:"8px 10px",borderBottom:"1px solid "+T.border}},
                    React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.faint,letterSpacing:1,marginBottom:6}},"PLAYOFF BRACKET"),
                    React.createElement("div",{style:{display:"grid",gridTemplateColumns:"2fr 2fr 3fr",gap:4,fontSize:9}},
                      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:3}},
                        React.createElement("div",{style:{fontSize:8,color:T.cyan,fontWeight:700,textAlign:"center",marginBottom:2}},"QUARTERS"),
                        bk.qf.map(function(g,gi){
                          var hW=g.winner===g.home;var aW=g.winner===g.away;
                          return React.createElement("div",{key:gi,style:{background:T.bg3,borderRadius:4,padding:"3px 5px",border:"1px solid "+(g.winnerId===myId?T.gold:T.border)}},
                            React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                              React.createElement("span",{style:{fontWeight:hW?800:400,color:hW?T.green:T.dim}},(g.hIcon||"")+" "+g.home),
                              React.createElement("span",{style:{color:T.faint,fontWeight:700}},g.score?g.score.split("-")[0]:"")
                            ),
                            React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                              React.createElement("span",{style:{fontWeight:aW?800:400,color:aW?T.green:T.dim}},(g.aIcon||"")+" "+g.away),
                              React.createElement("span",{style:{color:T.faint,fontWeight:700}},g.score?g.score.split("-")[1]:"")
                            )
                          );
                        })
                      ),
                      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:3,justifyContent:"center"}},
                        React.createElement("div",{style:{fontSize:8,color:T.orange,fontWeight:700,textAlign:"center",marginBottom:2}},"SEMIS"),
                        bk.sf.map(function(g,gi){
                          var hW=g.winner===g.home;var aW=g.winner===g.away;
                          return React.createElement("div",{key:gi,style:{background:T.bg3,borderRadius:4,padding:"3px 5px",border:"1px solid "+(g.winnerId===myId?T.gold:T.border)}},
                            React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                              React.createElement("span",{style:{fontWeight:hW?800:400,color:hW?T.green:T.dim}},(g.hIcon||"")+" "+g.home),
                              React.createElement("span",{style:{color:T.faint,fontWeight:700}},g.score?g.score.split("-")[0]:"")
                            ),
                            React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                              React.createElement("span",{style:{fontWeight:aW?800:400,color:aW?T.green:T.dim}},(g.aIcon||"")+" "+g.away),
                              React.createElement("span",{style:{color:T.faint,fontWeight:700}},g.score?g.score.split("-")[1]:"")
                            )
                          );
                        })
                      ),
                      React.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"}},
                        React.createElement("div",{style:{fontSize:8,color:T.gold,fontWeight:700,textAlign:"center",marginBottom:2}},"CHAMPIONSHIP"),
                        (function(){var g=bk.champ;var hW=g.winner===g.home;var aW=g.winner===g.away;
                          return React.createElement("div",{style:{background:"rgba(212,167,75,0.06)",borderRadius:4,padding:"5px 6px",border:"2px solid "+T.gold}},
                            React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                              React.createElement("span",{style:{fontWeight:hW?900:400,color:hW?T.gold:T.dim,fontSize:10}},(g.hIcon||"")+" "+g.home),
                              React.createElement("span",{style:{color:T.gold,fontWeight:800,fontSize:11}},g.score?g.score.split("-")[0]:"")
                            ),
                            React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                              React.createElement("span",{style:{fontWeight:aW?900:400,color:aW?T.gold:T.dim,fontSize:10}},(g.aIcon||"")+" "+g.away),
                              React.createElement("span",{style:{color:T.gold,fontWeight:800,fontSize:11}},g.score?g.score.split("-")[1]:"")
                            ),
                            React.createElement("div",{style:{textAlign:"center",marginTop:3,fontSize:8,color:T.gold,fontWeight:800}},"ðŸ† "+(g.winnerIcon||"")+" "+g.winner)
                          );
                        })()
                      )
                    )
                  ):null,
                  React.createElement("div",{style:{padding:"8px 12px"}},
                    React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:4}},
                      React.createElement("span",{style:{fontSize:10,color:T.cyan,background:"rgba(34,211,238,0.06)",padding:"2px 8px",borderRadius:3}},
                        "ðŸ… MVP: "+(h.mvp?h.mvp.name:"")+(" ("+(h.mvp?h.mvp.pos:"")+")")
                      ),
                      h.opoy?React.createElement("span",{style:{fontSize:10,color:T.green,background:"rgba(52,211,153,0.06)",padding:"2px 8px",borderRadius:3}},"ðŸˆ OPOY: "+h.opoy.name):null,
                      h.dpoy?React.createElement("span",{style:{fontSize:10,color:T.blue,background:"rgba(96,165,250,0.06)",padding:"2px 8px",borderRadius:3}},"ðŸ›¡ï¸ DPOY: "+h.dpoy.name):null,
                      h.roy?React.createElement("span",{style:{fontSize:10,color:T.purple,background:"rgba(167,139,250,0.06)",padding:"2px 8px",borderRadius:3}},"ðŸŒŸ ROY: "+h.roy.name):null
                    ),
                    h.allPro?React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:2}},"â­ All-Pro: "+Object.entries(h.allPro).map(function(e){return e[0]+":"+e[1].name;}).join(" | ")):null,
                    React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginTop:6}},
                      (h.standings||[]).slice(0,8).map(function(s,j){return React.createElement("span",{key:j,style:{fontSize:8,color:j===0?T.gold:j<4?T.green:T.faint,background:T.bg3,padding:"2px 4px",borderRadius:3,fontWeight:j===0?700:400}},s.i+s.a+" "+s.w+"-"+s.l);})
                    )
                  )
                );
              })}
            </div>
          )}
          
          {tab==="hof" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={cS}>
                <div style={{fontWeight:700,color:T.gold,marginBottom:8,fontSize:14}}>{"ðŸ… Hall of Fame"}</div>
                {hallOfFame.length===0 && <div style={{color:T.faint,textAlign:"center",padding:30}}>
                  <div style={{fontSize:28,marginBottom:8}}>{"ðŸ…"}</div>
                  <div style={{fontSize:13}}>{"No inductees yet."}</div>
                  <div style={{fontSize:10,color:T.dim,marginTop:4}}>{"Players retire based on age (30+ = 5%, 33+ = 15%, 35+ = 35%, 37+ = 60%)."}</div>
                  <div style={{fontSize:10,color:T.dim,marginTop:2}}>{"HoF requires: 25k pass yds, 8k rush/rec yds, 60 sacks, 40 INTs, or peak 85+ OVR with 8+ seasons."}</div>
                </div>}
                {hallOfFame.slice().sort(function(a,b){return (b.yearInducted||0)-(a.yearInducted||0);}).map(function(h){
                  var cs=h.careerStats||{};
                  var statLine=h.pos==="QB"?(cs.passYds||0)+"yds "+(cs.passTD||0)+"TD "+(cs.int||0)+"INT"
                    :h.pos==="RB"?(cs.rushYds||0)+"yd "+(cs.rushTD||0)+"TD"
                    :(h.pos==="WR"||h.pos==="TE")?(cs.recYds||0)+"yd "+(cs.recTD||0)+"TD "+(cs.rec||0)+"rec"
                    :(["DL","LB"].indexOf(h.pos)>=0)?(cs.sacks||0)+"sk "+(cs.tackles||0)+"tkl"
                    :(["CB","S"].indexOf(h.pos)>=0)?(cs.defINT||0)+"INT "+(cs.tackles||0)+"tkl"
                    :h.pos==="K"?(cs.fgM||0)+"/"+(cs.fgA||0)+"FG"
                    :h.pos==="P"?(cs.punts||0)+"pnt "+(cs.punts>0?Math.round((cs.puntYds||0)/cs.punts):"0")+"avg"
                    :(cs.seasons||0)+" seasons";
                  return (
                    <div key={h.id} style={assign({},cS,{borderLeft:"3px solid "+T.gold,background:"rgba(212,167,75,0.04)"})}>
                      <div style={{display:"flex",gap:10,alignItems:"center"}}>
                        {React.createElement(PlayerFace,{id:h.id,morale:99,size:36,age:h.age})}
                        <div style={{flex:1}}>
                          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                            <div>
                              <span style={{fontWeight:800,fontSize:14}}>{h.name}</span>
                              <span style={{color:T.gold,marginLeft:8,fontWeight:700}}>{h.pos}</span>
                              <span style={{marginLeft:6,fontSize:11}}>{(h.teamIcon||"")+(h.team||"")}</span>
                            </div>
                            <div style={{color:T.gold,fontSize:11,fontWeight:700}}>{"Class of "+(h.yearInducted||"?")}</div>
                          </div>
                      <div style={{fontSize:11,color:T.dim,marginTop:4}}>
                        {"Peak OVR: "+(h.peakOvr||h.ovr)+" | "+statLine+" | "+(cs.seasons||0)+" seasons | Age "+h.age}
                      </div>
                      {h.devTrait==="superstar" && <span style={{fontSize:10,color:T.gold}}>{"ðŸŒŸ Superstar"}</span>}
                      {h.devTrait==="star" && <span style={{fontSize:10,color:T.cyan}}>{"â­ Star"}</span>}
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          )}
          
          {tab==="reSign" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={cS}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <div style={{fontWeight:700,color:T.purple}}>{"âœï¸ Re-Sign Phase â€” "+reSignPool.length+" Expiring"}</div>
                  <button style={assign({},megaPurple,{width:"auto",padding:"8px 16px",fontSize:13})} onClick={function(){skipToTrade();}}>{"Skip to Draft â†’"}</button>
                </div>
                {my&&my.franchiseTag973 && <div style={{marginBottom:8,background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.3)",borderRadius:8,padding:"8px 12px"}}>
                  <div style={{fontSize:11,fontWeight:900,color:"#a855f7"}}>
                    {"ðŸ·ï¸ FRANCHISE TAG: "+my.franchiseTag973.playerName+" ("+my.franchiseTag973.pos+") â€” $"+my.franchiseTag973.salary+"M"+(my.franchiseTag973.year?(" â€¢ "+my.franchiseTag973.year):"")}
                  </div>
                  <div style={{fontSize:9,color:
                    my.franchiseTag973.reaction==="happy"?T.green:
                    my.franchiseTag973.reaction==="holdout"?T.red:
                    my.franchiseTag973.reaction==="unhappy"?T.orange:T.gold}}>
                    {my.franchiseTag973.reaction==="happy" ? "âœ… Player accepted the tag gracefully" :
                     my.franchiseTag973.reaction==="holdout" ? "ðŸš¨ HOLDOUT â€” Player refusing to report until long-term deal" :
                     my.franchiseTag973.reaction==="unhappy" ? "ðŸ˜¤ Playing under protest â€” chemistry dipped" :
                     "ðŸ“‹ Playing under the tag â€” monitoring situation"}
                  </div>
                  {my.franchiseTag973.reaction==="holdout" && <div style={{display:"flex",gap:6,marginTop:6,flexWrap:"wrap"}}>
                    <button style={bS(T.green,"#000")} onClick={function(){handleTaggedHoldoutAction973("pay");}}>{"ðŸ’° Pay the Man"}</button>
                    <button style={bS(T.orange,"#000")} onClick={function(){handleTaggedHoldoutAction973("wait");}}>{"â³ Wait It Out"}</button>
                    <button style={bS(T.red,"#fff")} onClick={function(){handleTaggedHoldoutAction973("trade");}}>{"ðŸ”„ Trade Him"}</button>
                  </div>}
                </div>}
                
                {(function(){
                  var rfaCandidates=identifyRFAs(my.roster).filter(function(p){return !p.rfaTender82;});
                  if(rfaCandidates.length===0)return null;
                  return <div style={{marginTop:8,padding:10,background:"rgba(167,139,250,0.05)",border:"1px solid rgba(167,139,250,0.2)",borderRadius:8}}>
                    <div style={{fontWeight:800,fontSize:12,color:"#a78bfa",marginBottom:6}}>{"ðŸ›¡ï¸ Restricted Free Agents ("+rfaCandidates.length+")"}</div>
                    <div style={{fontSize:9,color:T.dim,marginBottom:8}}>{"Young players (â‰¤4 seasons) with expiring deals. Tender to retain matching rights + comp pick if they leave."}</div>
                    {rfaCandidates.map(function(p){
                      return <div key={p.id} style={assign({},cS,{borderLeft:"3px solid #a78bfa",marginBottom:4})}>
                        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                          <div>
                            <span style={{fontWeight:700}}>{p.name}</span>
                            <span style={{color:T.gold,marginLeft:6}}>{p.pos}</span>
                            <span style={{color:T.dim,marginLeft:6,fontSize:11}}>{"OVR "+p.ovr}</span>
                          </div>
                          <div style={{fontSize:9,color:T.faint}}>{"Age "+p.age+" | $"+p.contract.salary+"M"}</div>
                        </div>
                        <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
                          <button style={bS("#a78bfa","#000")} onClick={function(){tenderRFA82(p.id,"FIRST");}}>{"1st Rd â€” $8M"}</button>
                          <button style={bS("#7c3aed","#fff")} onClick={function(){tenderRFA82(p.id,"SECOND");}}>{"2nd Rd â€” $5.5M"}</button>
                          <button style={bS(T.bg3,T.text)} onClick={function(){tenderRFA82(p.id,"ORIGINAL");}}>{"Orig Rd â€” $3M"}</button>
                          <button style={bS(T.bg3,T.red)} onClick={function(){
                            var pp=p;pp.formerTeam=myId;pp.formerTeamName=my.abbr;
                            setReSignPool(function(prev){return prev.filter(function(x){return x.id!==pp.id;});});
                            addN("ðŸ‘‹ Let "+pp.name+" walk to unrestricted FA.","info");
                          }}>{"Let Walk"}</button>
                        </div>
                      </div>;
                    })}
                  </div>;
                })()}
                
                {faRFA82.length>0 && <div style={{marginTop:8,padding:10,background:"rgba(167,139,250,0.03)",border:"1px solid rgba(167,139,250,0.15)",borderRadius:8}}>
                  <div style={{fontWeight:700,fontSize:11,color:"#a78bfa",marginBottom:4}}>{"âœ… Tendered RFAs"}</div>
                  {faRFA82.filter(function(e){return e.status==="tendered";}).map(function(e){
                    var tender=RFA_TENDERS[e.tender];
                    return <div key={e.playerId} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 0",borderBottom:"1px solid "+T.border}}>
                      <span style={{fontSize:11}}>{e.name+" ("+e.pos+" "+e.ovr+")"}</span>
                      <span style={{fontSize:9,color:"#a78bfa"}}>{tender?tender.label:""}{" $"+e.tenderSalary+"M"}</span>
                    </div>;
                  })}
                  {(faRFA82||[]).some(function(e){return e.rivalOffer;}) && <div style={{marginTop:6}}>
                    <div style={{fontWeight:700,fontSize:10,color:T.red,marginBottom:4}}>{"ðŸš¨ MATCH WINDOW"}</div>
                    {faRFA82.filter(function(e){return e.rivalOffer&&e.status==="tendered";}).map(function(e){
                      var rivalTm=teams.find(function(t){return t.id===e.rivalOffer.teamId;});
                      return <div key={e.playerId+"_match"} style={assign({},cS,{borderColor:T.red,padding:8})}>
                        <div style={{fontSize:11,fontWeight:700}}>{e.name+" â€” "+(rivalTm?rivalTm.icon+" "+rivalTm.abbr:"Rival")+" offers $"+e.rivalOffer.salary+"M/"+e.rivalOffer.years+"yr"}</div>
                        <div style={{display:"flex",gap:6,marginTop:4}}>
                          <button style={bS(T.green,"#000")} onClick={function(){matchRFA82(e);}}>{"Match Offer"}</button>
                          <button style={bS(T.red,"#fff")} onClick={function(){declineRFA82(e);}}>{"Decline (Get Comp Pick)"}</button>
                        </div>
                      </div>;
                    })}
                  </div>}
                </div>}
                <div style={{fontSize:11,color:T.dim,marginBottom:10}}>{"Negotiate before they hit the open market. Agent + player personality affect demand!"}</div>
                {reSignPool.length===0 && <div style={{color:T.faint,textAlign:"center",padding:20}}>{"All done! "}<button style={assign({},megaGreen,{width:"auto",padding:"10px 20px",fontSize:14})} onClick={function(){skipToTrade();}}>{"Proceed to Draft â†’"}</button></div>}
                {reSignPool.map(function(p){
                  var trObj=TRAITS[p.trait||"none"]||TRAITS.none;
                  var demandInfo=getReSignDemandInfo(p);
                  var agent=demandInfo.agent;
                  var demand=demandInfo.demand;
                  var dominantTrait84=getDominantTrait(p);
                  var dominantTraitKey84=dominantTrait84?dominantTrait84.key:"";
                  var neg84=(my&&my.reSignNeg84&&my.reSignNeg84[p.id])?my.reSignNeg84[p.id]:null;
                  var negRounds84=neg84&&neg84.rounds?neg84.rounds:[];
                  var isNegOpen84=!!(neg84&&neg84.status==="open");
                  var latestAsk84=isNegOpen84&&negRounds84.length>0?(negRounds84[negRounds84.length-1].agentAsk||demand):demand;
                  // v95.1: all traits + contract intel reveal state
                  var allTraits95rs=(Array.isArray(p.traits95)&&p.traits95.length>0?p.traits95:[p.trait||"none"]).filter(function(tk){return tk&&tk!=="none"&&TRAITS[tk];});
                  var ciRevealed=my&&my.contractIntelRevealed&&my.contractIntelRevealed[p.id];
                  var tagYear973=(season.year||2026)+1;
                  var tagUsed973=!!(my&&my.franchiseTag973&&my.franchiseTag973.year===tagYear973);
                  var tagSal973=getFranchiseTagSalary973(p.pos,teams);
                  function handleContractIntel(pid){
                    var ciCost=25;
                    if((my.scoutPts||0)<ciCost){addN("Need "+ciCost+" scout pts for Contract Intel â€” have "+(my.scoutPts||0)+".","red");return;}
                    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
                    if(!u2)return;
                    u2.scoutPts=(u2.scoutPts||0)-ciCost;
                    if(!u2.contractIntelRevealed)u2.contractIntelRevealed={};
                    u2.contractIntelRevealed[pid]=true;
                    setTeams(nt);doSave(nt);
                    addN("âœï¸ Contract Intel: exact demand revealed â€” $"+demand+"M/yr!","cyan");
                  }
                  return <div key={p.id} style={assign({},cS,{borderLeft:"3px solid "+T.purple})}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <div>
                        <span style={{fontWeight:700}}>{p.name}</span>
                        <span style={{color:T.gold,marginLeft:6}}>{p.pos}</span>
                        <span style={{color:T.dim,marginLeft:6,fontSize:11}}>{"OVR "+p.ovr}</span>
                        {/* v95.1: show all traits95 icons */}
                        {allTraits95rs.map(function(tk,ti){var tObj=TRAITS[tk];return tObj&&tObj.icon?<span key={ti} style={{marginLeft:ti===0?4:2}} title={tObj.name+": "+tObj.desc}>{tObj.icon}</span>:null;})}
                        {p.devTrait==="superstar" && <span style={{marginLeft:4}}>{"ðŸŒŸ"}</span>}
                      </div>
                      <div style={{display:"flex",alignItems:"center",gap:6}}>
                        {!ciRevealed&&<button onClick={function(){handleContractIntel(p.id);}} style={{fontSize:9,fontWeight:800,padding:"3px 7px",borderRadius:5,border:"1px solid rgba(34,211,238,0.4)",background:"rgba(34,211,238,0.07)",color:T.cyan,cursor:"pointer"}}>{"âœï¸ Intel (25pts)"}</button>}
                        {ciRevealed&&<span style={{fontSize:9,color:T.cyan,fontWeight:700}}>{"âœï¸ Wants $"+demand+"M"}</span>}
                        <div style={{fontSize:10,color:T.dim}}>{"Age "+p.age+" | Now: $"+p.contract.salary+"M"}</div>
                      </div>
                    </div>
                    <div style={{display:"flex",gap:8,marginTop:3,alignItems:"center"}}>
                      <span style={{fontSize:10,fontWeight:700,color:agent.id==="hardball"?T.red:agent.id==="loyalty"?T.green:T.cyan}}>{agent.icon+" "+agent.name}</span>
                      <span style={{fontSize:9,color:T.faint}}>{agent.desc}</span>
                      {dominantTrait84?<span style={{fontSize:9,padding:"1px 5px",borderRadius:8,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.12)",color:T.dim}} title={PERS_LABELS[dominantTrait84.key]+" ("+dominantTrait84.val+"/10)"}>{PERS_ICONS[dominantTrait84.key]+" "+PERS_LABELS[dominantTrait84.key]}</span>:null}
                    </div>
                    {/* â”€â”€ NEGOTIATION_SCENE: Agent opening speech bubble â”€â”€ */}
                    {!neg84&&(function(){
                      var agentLine=NEGOTIATION_SCENE.getOpeningLine(p,demand,3);
                      var bubbleColor=agent.id==="hardball"?T.red:agent.id==="loyalty"?T.green:T.cyan;
                      return React.createElement("div",{style:{marginTop:8,padding:"8px 12px",background:"rgba(255,255,255,0.04)",border:"1px solid "+bubbleColor+"33",borderRadius:8,borderLeft:"3px solid "+bubbleColor,position:"relative"}},
                        React.createElement("div",{style:{fontSize:8,color:bubbleColor,fontWeight:800,letterSpacing:0.6,marginBottom:3,opacity:0.8}},
                          "ðŸŽ™ï¸ AGENT SPEAKS"+(dominantTrait84?" â€¢ "+PERS_ICONS[dominantTrait84.key]+" "+PERS_LABELS[dominantTrait84.key].toUpperCase():"")),
                        React.createElement("div",{style:{fontSize:11,fontStyle:"italic",color:T.text,lineHeight:1.5}},'"'+agentLine+'"')
                      );
                    })()}
                    {neg84&&isNegOpen84&&(function(){
                      var lastRound=negRounds84[negRounds84.length-1];
                      var gap=lastRound?Math.abs(lastRound.agentAsk-(lastRound.gmOffer||0)):Math.abs(demand-p.contract.salary);
                      var counterLine=NEGOTIATION_SCENE.getCounterLine(p,latestAsk84,gap);
                      var bubbleColor=agent.id==="hardball"?T.red:agent.id==="loyalty"?T.green:T.cyan;
                      return React.createElement("div",{style:{marginTop:8,padding:"8px 12px",background:"rgba(255,255,255,0.04)",border:"1px solid "+bubbleColor+"33",borderRadius:8,borderLeft:"3px solid "+bubbleColor}},
                        React.createElement("div",{style:{fontSize:8,color:bubbleColor,fontWeight:800,letterSpacing:0.6,marginBottom:3,opacity:0.8}},"ðŸŽ™ï¸ COUNTER OFFER â€” Round "+((negRounds84.length||0)+1)+"/3"),
                        React.createElement("div",{style:{fontSize:11,fontStyle:"italic",color:T.text,lineHeight:1.5}},'"'+counterLine+'"')
                      );
                    })()}
                    <div style={{display:"flex",gap:6,marginTop:8,flexWrap:"wrap"}}>
                      <button style={bS(T.green,"#000")} onClick={function(){var v=Math.round(p.contract.salary*1.15*10)/10;if(isNegOpen84)advanceReSignNeg84(p.id,v,3);else startReSignNeg84(p.id,v,3);}}>{"Pay Up $"+Math.round(p.contract.salary*1.15*10)/10+"M"}</button>
                      <button style={bS(T.gold,"#000")} onClick={function(){if(isNegOpen84)advanceReSignNeg84(p.id,p.contract.salary,3);else startReSignNeg84(p.id,p.contract.salary,3);}}>{"Market $"+p.contract.salary+"M"}</button>
                      <button style={bS(T.orange,"#000")} onClick={function(){var v=Math.round(p.contract.salary*0.85*10)/10;if(isNegOpen84)advanceReSignNeg84(p.id,v,3);else startReSignNeg84(p.id,v,3);}}>{"Lowball $"+Math.round(p.contract.salary*0.85*10)/10+"M"}</button>
                      <button style={bS(T.bg3,T.red)} onClick={function(){
                        var pp=p;pp.formerTeam=myId;pp.formerTeamName=my.abbr;
                        var nt84=teams.slice();var u84=nt84.find(function(t){return t.id===myId;});
                        if(u84&&u84.reSignNeg84&&u84.reSignNeg84[pp.id])delete u84.reSignNeg84[pp.id];
                        setReSignPool(function(prev){return prev.filter(function(x){return x.id!==pp.id;});});
                        setTeams(nt84);doSave(nt84);
                        addN("ðŸ‘‹ Let "+pp.name+" walk to FA.","info");
                      }}>{"Let Walk"}</button>
                      {!tagUsed973 && <div style={{display:"flex",gap:3}}>
                        {FRANCHISE_TAG_986.types.map(function(tagType){
                          var adjSal=Math.round(tagSal973*tagType.salaryMult*10)/10;
                          return <button key={tagType.id} style={bS("#a855f7","#fff",{fontSize:8,padding:"3px 6px"})} title={tagType.desc} onClick={function(){
                            franchiseTagReSign973(p.id);
                            addN("ðŸ·ï¸ "+tagType.label+" Tag applied to "+p.name+" ($"+adjSal+"M) â€” "+tagType.desc,"purple");
                          }}>{"ðŸ·ï¸ "+tagType.label}</button>;
                        })}
                      </div>}
                      {tagUsed973 && <span style={{fontSize:9,padding:"5px 8px",borderRadius:6,background:"rgba(168,85,247,0.08)",border:"1px solid rgba(168,85,247,0.25)",color:"#c4b5fd",fontWeight:700}}>
                        {"ðŸ·ï¸ Tag Used ("+tagYear973+")"}
                      </span>}
                      <button style={bS("#1e293b","#a78bfa",{border:"1px solid #a78bfa"})} onClick={function(){setCustomOfferPid(customOfferPid===p.id?null:p.id);setCustomOfferVal("");}}>{"âœï¸"+(customOfferPid===p.id?" Cancel":" Custom")}</button>
                    </div>
                    {customOfferPid===p.id&&(function(){
                      var cv=parseFloat(customOfferVal);
                      var isValid=!isNaN(cv)&&cv>0;
                      var targetAsk84=isNegOpen84?latestAsk84:demand;
                      var aboveDemand=isValid&&cv>=targetAsk84;
                      var statusColor=!isValid?"#64748b":aboveDemand?T.green:T.red;
                      var statusTxt=!isValid?"Enter amount":"$"+cv+"M â†’ "+(aboveDemand?"âœ… Agent accepts!":"âŒ Below ask ($"+targetAsk84+"M)");
                      return React.createElement("div",{style:{marginTop:6,background:"rgba(167,139,250,0.08)",border:"1px solid rgba(167,139,250,0.3)",borderRadius:8,padding:"8px 10px"}},
                        React.createElement("div",{style:{fontSize:10,color:"#a78bfa",fontWeight:700,marginBottom:5}},isNegOpen84?"ðŸ’¸ Counter Offer":"ðŸ’¸ Custom Offer"),
                        React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center"}},
                          React.createElement("span",{style:{fontSize:12,color:T.dim}},"$"),
                          React.createElement("input",{
                            type:"number",step:"0.1",min:"0.1",
                            value:customOfferVal,
                            placeholder:(p.contract.salary)+"",
                            onChange:function(e){setCustomOfferVal(e.target.value);},
                            onKeyDown:function(e){if(e.key==="Enter"&&isValid)submitReSignOffer84(p.id,customOfferVal,3);},
                            style:{flex:1,background:"#1e293b",border:"1px solid rgba(167,139,250,0.4)",borderRadius:6,color:"#fff",padding:"6px 8px",fontSize:13,outline:"none",WebkitAppearance:"none"}
                          }),
                          React.createElement("span",{style:{fontSize:12,color:T.dim}},"M/yr"),
                          React.createElement("button",{
                            onClick:function(){submitReSignOffer84(p.id,customOfferVal,3);},
                            disabled:!isValid,
                            style:{background:isValid?"#7c3aed":"#374151",color:isValid?"#fff":"#6b7280",border:"none",borderRadius:6,padding:"6px 12px",fontSize:11,fontWeight:700,cursor:isValid?"pointer":"not-allowed"}
                          },isNegOpen84?"Counter":"Offer")
                        ),
                        React.createElement("div",{style:{fontSize:9,marginTop:4,color:statusColor}},statusTxt),
                        React.createElement("div",{style:{display:"flex",gap:4,marginTop:6,flexWrap:"wrap"}},
                          [[isNegOpen84?"Agent Ask":"Demand",targetAsk84],["Pay Up",Math.round(p.contract.salary*1.15*10)/10],["Market",p.contract.salary],["Lowball",Math.round(p.contract.salary*0.85*10)/10]].map(function(pair){
                            return React.createElement("button",{key:pair[0],onClick:function(){setCustomOfferVal(String(pair[1]));},style:{fontSize:9,padding:"2px 6px",background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,color:T.dim,cursor:"pointer"}},pair[0]+" $"+pair[1]+"M");
                          })
                        )
                      );
                    })()}
                    {neg84&&(function(){
                      function outcomeBadge(r){
                        if(r.outcome==="accepted")return "âœ… Accepted";
                        if(r.outcome==="walked")return "ðŸšª Walked";
                        if(r.outcome==="deadline")return "â±ï¸ Deadline";
                        if(r.outcome==="counter")return "â†” Counter";
                        return "â€¢ Pending";
                      }
                      var statusLabel=neg84.status==="accepted"?"ACCEPTED":neg84.status==="walked"?"WALKED":neg84.status==="deadline"?"DEADLINE":"ROUND "+((negRounds84.length||0)+1)+"/3 OPEN";
                      var statusColor=neg84.status==="accepted"?T.green:neg84.status==="walked"?T.red:neg84.status==="deadline"?T.orange:T.gold;
                      return <div style={{marginTop:6,padding:"6px 8px",background:"rgba(255,255,255,0.03)",borderRadius:6,border:"1px solid "+T.border}}>
                        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3}}>
                          <div style={{fontSize:8,color:T.faint,fontWeight:800,letterSpacing:0.4}}>{"NEGOTIATION HISTORY (3 rounds max)"}</div>
                          <span style={{fontSize:8,padding:"1px 6px",borderRadius:9,background:statusColor+"22",color:statusColor,fontWeight:800}}>{statusLabel}</span>
                        </div>
                        {(negRounds84||[]).map(function(r,ri){
                          var flavor84=getReSignNegFlavor84(agent.id,dominantTraitKey84,r.round,r.outcome);
                          return <div key={ri} style={{padding:"2px 0",borderBottom:"1px solid "+T.border}}>
                            <div style={{display:"grid",gridTemplateColumns:"34px 1fr 1fr",gap:6,fontSize:8}}>
                              <span style={{color:T.faint,fontWeight:700}}>{"Rnd "+r.round}</span>
                              <span style={{color:T.text}}>{"GM: $"+r.gmOffer+"M"}</span>
                              <span style={{color:r.outcome==="accepted"?T.green:r.outcome==="walked"?T.red:T.dim,fontWeight:700}}>
                                {"Agent: $"+r.agentAsk+"M | "+outcomeBadge(r)}
                              </span>
                            </div>
                            {flavor84&&<div style={{fontSize:8,fontStyle:"italic",color:T.faint,paddingLeft:34,marginTop:1}}>
                              {flavor84}
                            </div>}
                          </div>;
                        })}
                        {isNegOpen84&&<div style={{fontSize:8,color:T.cyan,marginTop:4,fontWeight:700}}>
                          {"Next target ask: $"+latestAsk84+"M"}
                        </div>}
                      </div>;
                    })()}
                    <div style={{fontSize:9,color:T.faint,marginTop:3}}>{"Est. demand: ~$"+demand+"M | Fit "+Math.round(demandInfo.fitScore||70)+"/100"+(agent.id==="loyalty"&&my.wins>=8?" (loyalty discount!)":"")+(agent.id==="hardball"?" âš ï¸ walks below $"+Math.round(p.contract.salary*demandInfo.walkThresh*10)/10+"M":"")}</div>
                    {(function(){
                      var mb=demandInfo.multBreakdown||{};
                      var wb=demandInfo.walkBreakdown||{};
                      var fitTone=(mb.fitAdd||0)<0?T.green:(mb.fitAdd||0)>0?T.red:T.dim;
                      var fitImpact=mb.fitImpact||0;
                      function chip(label,val,col){
                        return <span key={label} style={{fontSize:8,padding:"1px 5px",borderRadius:10,background:(col||T.dim)+"20",color:col||T.dim,fontWeight:700}}>
                          {label+" "+val}
                        </span>;
                      }
                      return <div style={{marginTop:4,padding:"6px 8px",background:"rgba(255,255,255,0.03)",borderRadius:6,border:"1px solid "+T.border}}>
                        <div style={{fontSize:8,color:T.faint,fontWeight:800,letterSpacing:0.4,marginBottom:3}}>{"DEMAND MODIFIERS"}</div>
                        <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:3}}>
                          {chip("Base","x"+((mb.base||1).toFixed(2)),T.dim)}
                          {chip("Infl","x"+((mb.inflation||1).toFixed(2)),T.gold)}
                          {(mb.winAdjMult||1)!==1&&chip("Win","x"+(mb.winAdjMult.toFixed(2)),mb.winAdjMult<1?T.green:T.red)}
                          {(mb.marketAdjMult||1)!==1&&chip("Market","x"+(mb.marketAdjMult.toFixed(2)),T.cyan)}
                          {(mb.persAdd||0)!==0&&chip("Pers",(mb.persAdd>0?"+":"")+mb.persAdd.toFixed(2),mb.persAdd>0?T.red:T.green)}
                          {(mb.fitAdd||0)!==0&&chip("Fit",(mb.fitAdd>0?"+":"")+mb.fitAdd.toFixed(2),fitTone)}
                          {chip("Final","x"+((mb.final||1).toFixed(2)),T.purple)}
                        </div>
                        <div style={{fontSize:8,color:fitTone,fontWeight:700}}>
                          {"Fit impact on ask: "+(fitImpact>=0?"+":"")+fitImpact.toFixed(1)+"M vs neutral-fit demand"}
                        </div>
                        <div style={{fontSize:8,color:T.faint,marginTop:2}}>
                          {"Walk line math: "+(wb.base||0).toFixed(2)+(wb.persAdd>=0?" +":" ")+(wb.persAdd||0).toFixed(2)+(wb.fitAdd>=0?" +":" ")+(wb.fitAdd||0).toFixed(2)+" = "+(wb.preClamp||0).toFixed(2)+" â†’ "+(wb.final||0).toFixed(2)}
                        </div>
                      </div>;
                    })()}
                  </div>;
                })}
              </div>
            </div>
          )}
          
          {tab==="log" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={cS}>
                <div style={{display:"flex",justifyContent:"space-between",marginBottom:8}}>
                  <div style={{fontWeight:700,color:T.cyan}}>{"ðŸ“ Transaction Log ("+txLog.length+" entries)"}</div>
                  <div style={{fontSize:9,color:T.faint}}>{"Seed: "+SEED_GLOBAL}</div>
                </div>
                {txLog.length===0?<div style={{color:T.faint,textAlign:"center",padding:20}}>{"No transactions yet."}</div>
                :txLog.slice(0,50).map(function(tx){
                  var icon=tx.type==="SIM_WEEK"?"ðŸˆ":tx.type==="SIGN_FA"?"âœï¸":tx.type==="CUT_PLAYER"?"âœ‚ï¸":tx.type==="TRADE"?"ðŸ”„":tx.type==="DRAFT_PICK"?"ðŸ“‹":tx.type==="DRAFT_TRADE"?"ðŸ“ž":tx.type==="RESTRUCTURE"?"ðŸ“„":tx.type==="FIRE_COACH"?"ðŸ”¥":tx.type==="HIRE_COACH"?"âœ…":tx.type==="UPGRADE_FACIL"?"ðŸ—ï¸":tx.type==="RE_SIGN"?"ðŸ¤":tx.type==="PS_MOVE"?"ðŸ“‹":tx.type==="PS_POACH"?"âš ï¸":tx.type==="CUT_DAY"?"âœ‚ï¸":"ðŸ“Œ";
                  var color=tx.type==="SIM_WEEK"?"dim":tx.type==="SIGN_FA"?"green":tx.type==="CUT_PLAYER"?"red":tx.type==="TRADE"?"gold":tx.type==="DRAFT_PICK"?"gold":"cyan";
                  var detail="";
                  if(tx.type==="SIM_WEEK")detail=tx.detail.record+" Mood:"+tx.detail.mood+" Cash:$"+tx.detail.cash+"M";
                  else if(tx.type==="SIGN_FA")detail=tx.detail.name+"("+tx.detail.pos+") $"+tx.detail.salary+"M/"+tx.detail.years+"yr";
                  else if(tx.type==="CUT_PLAYER")detail=tx.detail.name+"("+tx.detail.pos+") Dead:$"+(tx.detail.dead||0).toFixed(1)+"M";
                  else if(tx.type==="TRADE")detail="w/"+tx.detail.with+": Sent "+tx.detail.sent+" Got "+tx.detail.got;
                  else if(tx.type==="DRAFT_PICK")detail=tx.detail.name+"("+tx.detail.pos+") OVR"+tx.detail.ovr+" "+tx.detail.devTrait;
                  else if(tx.type==="DRAFT_TRADE")detail="w/"+tx.detail.with+": Got "+tx.detail.received;
                  else if(tx.type==="RESTRUCTURE")detail=tx.detail.name+" Saved $"+tx.detail.saved+"M";
                  else if(tx.type==="FIRE_COACH"||tx.type==="HIRE_COACH")detail=tx.detail.name+" ("+tx.detail.arch+") "+tx.detail.role;
                  else if(tx.type==="UPGRADE_FACIL")detail=tx.detail.type+" â†’ Lvl"+tx.detail.newLvl+" $"+tx.detail.cost+"M";
                  else detail=JSON.stringify(tx.detail).slice(0,60);
                  return (
                    <div key={tx.id} style={{borderBottom:"1px solid "+T.border,padding:"5px 0",fontSize:11}}>
                      <div style={{display:"flex",justifyContent:"space-between"}}>
                        <span style={{color:T[color]||T.dim,fontWeight:700}}>{icon+" "+tx.type}</span>
                        <span style={{color:T.faint,fontSize:9}}>{"Yr"+tx.year+" Wk"+tx.week}</span>
                      </div>
                      <div style={{color:T.dim,fontSize:10,marginTop:1}}>{detail}</div>
                    </div>
                  );
                })}
              </div>
            </div>
          )}
          
          {tab==="ledger" && (function(){
            var lData=season.ledger||[];
            var filtered=lData.filter(function(e){
              if(lFilter!=="ALL"&&e.type!==lFilter)return false;
              if(lTeamFilter!=="ALL"&&e.teamId!==lTeamFilter)return false;
              return true;
            });
            var typeColors={TRADE:T.gold,INJURY:T.red,SIGN:T.green,CUT:"#ef4444",DRAFT:T.cyan,GAME:T.dim,EXTEND:T.purple,PHASE:T.orange,LOCK:T.orange,SIM:"rgba(255,255,255,0.3)"};
            var typeIcons={TRADE:"ðŸ”„",INJURY:"ðŸ¤•",SIGN:"âœï¸",CUT:"âœ‚ï¸",DRAFT:"ðŸ“‹",GAME:"ðŸˆ",EXTEND:"ðŸ“",PHASE:"ðŸ“…",LOCK:"ðŸ”’",SIM:"â­ï¸"};
            var types=["ALL","TRADE","SIGN","CUT","INJURY","DRAFT","GAME","EXTEND","PHASE"];
            var teamAbbrs=["ALL"].concat(teams.map(function(t2){return t2.abbr;}).sort());
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              
              <div style={assign({},cS,{borderColor:GOLDEN_SEED_DRIFT?"#ef4444":T.green,
                background:GOLDEN_SEED_DRIFT?"rgba(239,68,68,0.04)":"rgba(74,222,128,0.04)"})}>
                <div style={{fontWeight:700,fontSize:11,color:GOLDEN_SEED_DRIFT?T.red:T.green,marginBottom:4}}>
                  {"ðŸ”¬ TRUST PANEL â€” "+(GOLDEN_SEED_DRIFT?"âš ï¸ DRIFT DETECTED":"âœ… Determinism Clean")}
                </div>
                <div style={{display:"flex",gap:12,fontSize:9,color:T.dim,flexWrap:"wrap"}}>
                  <span>{"ðŸŽ² League Seed: "+SEED_GLOBAL}</span>
                  <span>{"ðŸ“… Year: "+season.year+" Wk: "+season.week}</span>
                  <span>{"ðŸ”— Streams: play/injury/draft/ai/dev/trade/ui"}</span>
                  <span>{"ðŸ“Š Golden Checks: "+GOLDEN_SEED_CHECKS.length}</span>
                </div>
                {GOLDEN_SEED_DRIFT && <div style={{marginTop:4,padding:"4px 8px",borderRadius:4,background:"rgba(239,68,68,0.1)",fontSize:9,color:T.red}}>
                  <div style={{fontWeight:700}}>{"âš ï¸ "+GOLDEN_SEED_DRIFT.msg}</div>
                  {GOLDEN_SEED_DRIFT.drifts&&GOLDEN_SEED_DRIFT.drifts.map(function(d2,di){
                    return <div key={di} style={{marginTop:2}}>{"  â€¢ "+d2}</div>;
                  })}
                  <div style={{marginTop:2,color:T.faint}}>{"Baseline: Seed "+GOLDEN_SEED_DRIFT.seed+" / v"+GOLDEN_SEED_DRIFT.version+" / Year "+GOLDEN_SEED_DRIFT.year}</div>
                </div>}
                
                {AI_DECISION_LOG.length>0 && <div style={{marginTop:6,borderTop:"1px solid "+T.border,paddingTop:4}}>
                  <div style={{fontSize:9,fontWeight:700,color:T.cyan,marginBottom:3}}>{"ðŸ§  AI DECISION LOG â€” last "+Math.min(AI_DECISION_LOG.length,10)}</div>
                  {AI_DECISION_LOG.slice(-10).reverse().map(function(dl,di){
                    var dlTeam=teams.find(function(tt){return tt.abbr===dl.team;});
                    var dlArch=dlTeam?getTeamGMArchetype90(dlTeam):null;
                    return <div key={di} style={{fontSize:8,color:T.dim,padding:"1px 0"}}>
                      {(dlArch?dlArch.icon+" ":"")+dl.team+" ["+dl.mode+"] "+dl.action+": "+dl.reason}
                    </div>;
                  })}
                </div>}
                
                <div style={{marginTop:6,borderTop:"1px solid "+T.border,paddingTop:4,display:"flex",gap:8,fontSize:8,color:T.faint,flexWrap:"wrap"}}>
                  {DNA_SLIDERS.map(function(sl){
                    var val=DNA_ACTIVE[sl.key]||1.0;
                    return <span key={sl.key} style={{color:val!==1.0?T.cyan:T.faint}}>{sl.emoji+" "+sl.label+": "+val.toFixed(1)+"Ã—"}</span>;
                  })}
                </div>
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,color:T.gold,marginBottom:6}}>{"ðŸ“œ GLASS BOX LEDGER â€” "+lData.length+" entries"}</div>
                <div style={{fontSize:10,color:T.dim,marginBottom:8}}>{"Every transaction, injury, trade, and game result â€” the game's complete memory."}</div>
                <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:8}}>
                  {types.map(function(tp){
                    return <button key={tp} onClick={function(){setLFilter(tp);}} style={mS(S.btn,S.btnSmall,{
                      background:lFilter===tp?"rgba(251,191,36,0.25)":"rgba(255,255,255,0.05)",
                      color:lFilter===tp?T.gold:T.dim,border:"1px solid "+(lFilter===tp?T.gold:T.glassBorder),
                      fontSize:9,padding:"4px 8px"})}>{(typeIcons[tp]||"ðŸ“Œ")+" "+tp}</button>;
                  })}
                </div>
                <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:8}}>
                  <span style={{fontSize:9,color:T.faint,padding:"4px 0"}}>{"Team:"}</span>
                  {teamAbbrs.slice(0,17).map(function(ab){
                    return <button key={ab} onClick={function(){setLTeamFilter(ab);}} style={mS(S.btn,S.btnSmall,{
                      background:lTeamFilter===ab?"rgba(251,191,36,0.2)":"rgba(255,255,255,0.04)",
                      color:lTeamFilter===ab?T.gold:T.faint,fontSize:8,padding:"3px 6px",
                      border:"1px solid "+(lTeamFilter===ab?"rgba(251,191,36,0.3)":T.glassBorder)})}>{ab}</button>;
                  })}
                </div>
                <div style={{fontSize:9,color:T.faint,marginBottom:4}}>{"Showing "+filtered.length+" of "+lData.length+" â€¢ Seed: "+SEED_GLOBAL}</div>
              </div>
              <div style={mS(cS,{padding:0,overflow:"hidden"})}>
                {filtered.length===0?
                  <div style={{padding:20,textAlign:"center",color:T.dim}}>{"No entries match filters. Play some games to fill the ledger!"}</div>:
                  filtered.slice(0,100).map(function(e){
                    var col=typeColors[e.type]||T.text;
                    var icon=typeIcons[e.type]||"ðŸ“Œ";
                    return <div key={e.id} style={{padding:"10px 12px",borderBottom:"1px solid "+T.border,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:8}}>
                      <div style={{flex:1,minWidth:0}}>
                        <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:2}}>
                          <span style={{fontSize:10,color:col,fontWeight:700}}>{icon+" "+e.type}</span>
                          <span style={{fontSize:9,color:T.faint}}>{e.tick}</span>
                          {e.phase && <span style={{fontSize:8,color:T.faint,background:"rgba(255,255,255,0.05)",padding:"1px 4px",borderRadius:4}}>{e.phase}</span>}
                        </div>
                        <div style={{fontSize:11,fontWeight:500,color:T.text,lineHeight:1.3}}>{e.summary}</div>
                      </div>
                      {e.teamId && <span style={{fontSize:9,color:T.dim,flexShrink:0,fontWeight:700}}>{e.teamId}</span>}
                    </div>;
                  })
                }
              </div>
            </div>;
          })()}
          
          {tab==="powerRank" && (function(){
            var BLURBS_GOOD=["Rolling right now","Legit contender","Don't sleep on them","Built different","Championship caliber","On a mission","Scary good"];
            var BLURBS_MID=["Finding their identity","Streaky but dangerous","One piece away","Inconsistent but talented","Living on the edge"];
            var BLURBS_BAD=["Rebuild incoming","Painful to watch","Sellers at the deadline","Long season ahead","Draft pick collectors"];
            // POWER_RANKINGS v17: arc-aware hot takes + narrative injection
            var ARC_HOT_TAKES={
              BREAKOUT:["Built different â€” and their breakout star is just getting started.","Hide your franchise QBs. Their rising star is coming for everyone.","One breakout player can change everything. This team found theirs."],
              ELITE:["All-Pro caliber at the helm. This team is as dangerous as advertised.","That elite-tier player carries them far â€” and everyone knows it.","When you have a generational talent, you have a chance every week."],
              SLUMP:["Key player in a slump is a red flag. Watch how they manage it.","Their star is struggling. If that doesn't turn around, the ranking will follow.","Dangerous team on paper â€” but a slumping star changes the math."],
              COMEBACK:["Comeback story unfolding in real time. Don't sleep on this resurgent squad.","A player finding their stride again is dangerous for everyone above this team.","Redemption arc in progress. The league is watching."],
              DECLINE:["Veteran presence masking some cracks. Age doesn't lie forever.","Living off reputation right now. The decline is real â€” but so is the experience.","Clock is ticking on this core. Championship or bust before the rebuild."],
              HOLDOUT:["Contract drama is a ticking time bomb in that locker room.","Hard to focus on Ws when a star's future is unresolved. Distraction city.","GM needs to get that deal done â€” or everything falls apart."],
              SWAN_SONG:["A legend in their final chapter â€” and they're not going quietly.","Swan song season. Every week is must-watch. Legends don't fade, they burn out bright.","One last ride. This team is playing with house money and loving every second."],
              MENTOR:["That veteran presence in the locker room? Underrated franchise asset.","The mentor effect is real. Watch how the young core has elevated around them.","Quiet leadership from a seasoned vet. Championship culture starts there."]
            };
            var TOP_BLURBS=["The standard. Full stop.","Nobody wants this matchup.","The scariest team on paper.","For real this time.","Quietly elite."];
            var ranked=teams.slice().map(function(t2){
              var gp2=t2.wins+t2.losses;var winPct=gp2>0?t2.wins/gp2:0.5;
              var diff=(t2.pf-t2.pa)/(gp2||1);
              var oppGames=sched.filter(function(g){return g.played&&(g.home===t2.id||g.away===t2.id);});
              var oppWinPct=0;
              if(oppGames.length>0){
                var totalOppW=0;var totalOppG=0;
                oppGames.forEach(function(g){
                  var oppId=g.home===t2.id?g.away:g.home;
                  var opp2=teams.find(function(x){return x.id===oppId;});
                  if(opp2){totalOppW+=opp2.wins;totalOppG+=opp2.wins+opp2.losses;}
                });
                oppWinPct=totalOppG>0?totalOppW/totalOppG:0.5;
              }
              var recent=sched.filter(function(g){return g.played&&(g.home===t2.id||g.away===t2.id);}).slice(-3);
              var recentW=recent.filter(function(g){
                if(!g||!g.result||typeof g.result.home!=="number"||typeof g.result.away!=="number")return false;
                return(g.home===t2.id&&g.result.home>g.result.away)||(g.away===t2.id&&g.result.away>g.result.home);
              }).length;
              var power=Math.round((winPct*40+diff*0.8+recentW*8+oppWinPct*10+(t2.prestige||50)*0.15)*10)/10;
              var streak=t2.streak||0;
              var blurb=winPct>=0.65?pick(BLURBS_GOOD):winPct>=0.4?pick(BLURBS_MID):pick(BLURBS_BAD);
              if(streak>=4)blurb="\ud83d\udd25 "+streak+"-game win streak!";
              if(streak<=-4)blurb="\ud83d\udcc9 "+Math.abs(streak)+"-game skid";
              // v17: find top arc player for this team
              var arcOrder17=["BREAKOUT","ELITE","COMEBACK","SWAN_SONG","HOLDOUT","SLUMP","DECLINE","MENTOR"];
              var arcPlayer=null;var arcKey17=null;
              for(var ai=0;ai<arcOrder17.length;ai++){
                var ak=arcOrder17[ai];
                var found=(t2.roster||[]).find(function(p){return p&&(p._arcState||"")===(ak)&&(p.ovr||0)>=72;});
                if(found){arcPlayer=found;arcKey17=ak;break;}
              }
              var arcBadge=arcKey17&&ARC_SPOTLIGHT.lines[arcKey17]?ARC_SPOTLIGHT.lines[arcKey17].badge:null;
              var arcBadgeColor=arcKey17&&ARC_SPOTLIGHT.lines[arcKey17]?ARC_SPOTLIGHT.lines[arcKey17].badgeColor:null;
              return assign({},t2,{power:power,recentW:recentW,recentG:recent.length,sos:Math.round(oppWinPct*1000)/10,blurb:blurb,streak:streak,arcPlayer:arcPlayer,arcKey17:arcKey17,arcBadge:arcBadge,arcBadgeColor:arcBadgeColor});
            }).sort(function(a,b){return b.power-a.power;});
            var prevRanked=teams.slice().map(function(t2){
              var gp2=Math.max(0,(t2.wins+t2.losses)-1);var winPct=gp2>0?Math.max(0,t2.wins-(t2.streak>0?1:0))/gp2:0.5;
              return assign({},t2,{prevPwr:winPct*40+(t2.prestige||50)*0.2});
            }).sort(function(a,b){return b.prevPwr-a.prevPwr;});
            var prevMap={};prevRanked.forEach(function(t2,i){prevMap[t2.id]=i+1;});
            var movers=ranked.map(function(t2,i){var delta=(prevMap[t2.id]||i+1)-(i+1);return assign({},t2,{rank:i+1,delta:delta});});
            var risers=movers.filter(function(m){return m.delta>0;}).sort(function(a,b){return b.delta-a.delta;}).slice(0,3);
            var fallers=movers.filter(function(m){return m.delta<0;}).sort(function(a,b){return a.delta-b.delta;}).slice(0,3);
            var sparkData=prHistory81.slice(-8);
            return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8}},
              React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(251,191,36,0.15),rgba(15,23,42,0.95))",borderRadius:12,padding:"16px 20px",border:"1px solid rgba(251,191,36,0.3)"}},
                React.createElement("div",{style:{fontSize:8,fontWeight:800,letterSpacing:3,color:T.gold,marginBottom:2}},"MFSN PRESENTS"),
                React.createElement("div",{style:{fontSize:18,fontWeight:900,color:"#fff",textShadow:"0 0 20px rgba(251,191,36,0.3)"}},"\u26a1 POWER RANKINGS"),
                React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:2}},"Week "+season.week+" \u2022 Weighted: Record + Diff + Form + SOS")
              ),
              sparkData.length>1?React.createElement("div",{style:assign({},cS,{padding:12,borderColor:T.gold+"44"})},
                React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,marginBottom:6}},"\ud83d\udcc8 YOUR RANKING TREND (last "+sparkData.length+" weeks)"),
                React.createElement("div",{style:{display:"flex",gap:2,alignItems:"flex-end",height:32}},
                  sparkData.map(function(rank,si){
                    var maxRk=32;var barH=Math.max(4,Math.round((1-rank/maxRk)*30));
                    return React.createElement("div",{key:"sp"+si,style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:2}},
                      React.createElement("div",{style:{fontSize:7,color:rank<=5?T.gold:rank<=10?T.green:rank<=20?T.dim:T.red,fontWeight:700}},rank),
                      React.createElement("div",{style:{width:"100%",height:barH,borderRadius:2,background:rank<=5?T.gold:rank<=10?T.green:rank<=20?T.dim:T.red,opacity:0.7}})
                    );
                  })
                )
              ):null,
              (risers.length>0||fallers.length>0)?React.createElement("div",{style:{display:"flex",gap:6}},
                risers.length>0?React.createElement("div",{style:assign({},cS,{flex:1,padding:10,borderColor:T.green+"44"})},
                  React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.green,marginBottom:4}},"\ud83d\udcc8 RISERS"),
                  risers.map(function(r,ri){
                    return React.createElement("div",{key:"r"+ri,style:{display:"flex",justifyContent:"space-between",fontSize:10,padding:"2px 0"}},
                      React.createElement("span",{style:{fontWeight:600}},r.city),
                      React.createElement("span",{style:{color:T.green,fontWeight:800}},"\u25b2"+r.delta)
                    );
                  })
                ):null,
                fallers.length>0?React.createElement("div",{style:assign({},cS,{flex:1,padding:10,borderColor:T.red+"44"})},
                  React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.red,marginBottom:4}},"\ud83d\udcc9 FALLERS"),
                  fallers.map(function(f,fi){
                    return React.createElement("div",{key:"f"+fi,style:{display:"flex",justifyContent:"space-between",fontSize:10,padding:"2px 0"}},
                      React.createElement("span",{style:{fontWeight:600}},f.city),
                      React.createElement("span",{style:{color:T.red,fontWeight:800}},"\u25bc"+Math.abs(f.delta))
                    );
                  })
                ):null
              ):null,
              // v17: ARC NARRATIVES panel â€” top 10 teams with active arc players
              (function(){
                var arcNarratives=movers.slice(0,10).filter(function(t2){return t2.arcPlayer&&t2.arcKey17;}).map(function(t2,ni){
                  var pool=ARC_HOT_TAKES[t2.arcKey17]||[];
                  var htLine=pool.length>0?pool[Math.floor(RNG.ui()*pool.length)]:"Watch this team closely.";
                  var bColor=t2.arcBadgeColor||T.gold;
                  var isMe2=t2.id===myId;
                  return React.createElement("div",{key:"an"+ni,style:{padding:"8px 10px",borderBottom:"1px solid "+T.border,display:"flex",gap:8,alignItems:"flex-start"}},
                    React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.faint,width:22,flexShrink:0,marginTop:1}},"#"+t2.rank),
                    React.createElement("div",{style:{flex:1}},
                      React.createElement("div",{style:{display:"flex",gap:5,alignItems:"center",marginBottom:2,flexWrap:"wrap"}},
                        React.createElement("span",{style:{fontWeight:700,fontSize:10,color:isMe2?T.gold:T.text}},(t2.abbr||t2.name)),
                        t2.arcBadge?React.createElement("span",{style:{fontSize:8,fontWeight:800,color:bColor,background:"rgba(0,0,0,0.3)",border:"1px solid "+bColor+"55",borderRadius:10,padding:"1px 6px"}},(t2.arcBadge)):null,
                        React.createElement("span",{style:{fontSize:9,color:T.dim}},t2.arcPlayer.name+" ("+t2.arcPlayer.pos+" OVR "+t2.arcPlayer.ovr+")")
                      ),
                      React.createElement("div",{style:{fontSize:9,fontStyle:"italic",color:T.dim,lineHeight:1.35}},"\u201C"+htLine+"\u201D")
                    )
                  );
                });
                if(arcNarratives.length===0)return null;
                return React.createElement("div",{style:assign({},cS,{padding:0,overflow:"hidden",borderColor:"rgba(168,85,247,0.3)"})},
                  React.createElement("div",{style:{background:"linear-gradient(90deg,rgba(168,85,247,0.18),rgba(15,23,42,0.9))",padding:"8px 12px",borderBottom:"1px solid rgba(168,85,247,0.2)"}},
                    React.createElement("div",{style:{fontSize:8,fontWeight:800,color:"#a855f7",letterSpacing:2}},"ðŸ“º MFSN ARC NARRATIVES â€” POWER RANKINGS EDITION"),
                    React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:1}},"What the analysts are saying about arc-driven teams this week")
                  ),
                  arcNarratives
                );
              })(),
              // v17: user team arc alert banner
              (function(){
                var myRanked=movers.find(function(t2){return t2.id===myId;});
                if(!myRanked||!myRanked.arcKey17)return null;
                var alertArcs=["SLUMP","HOLDOUT","DECLINE"];
                var goodArcs=["BREAKOUT","ELITE","COMEBACK","SWAN_SONG"];
                var isAlert=alertArcs.indexOf(myRanked.arcKey17)>=0;
                var isGood=goodArcs.indexOf(myRanked.arcKey17)>=0;
                if(!isAlert&&!isGood)return null;
                var bColor=isAlert?"#ef4444":"#34d399";
                var bgGrad=isAlert?"linear-gradient(90deg,rgba(239,68,68,0.15),rgba(15,23,42,0.9))":"linear-gradient(90deg,rgba(52,211,153,0.15),rgba(15,23,42,0.9))";
                var iconStr=isAlert?"\ud83d\udea8":"\u2b50";
                var alertLabel=isAlert?"ARC ALERT â€” YOUR FRANCHISE":"ARC MOMENTUM â€” YOUR FRANCHISE";
                var pool2=ARC_HOT_TAKES[myRanked.arcKey17]||[];
                var alertLine=pool2.length>0?pool2[Math.floor(RNG.ui()*pool2.length)]:"The narrative around your team is shifting.";
                return React.createElement("div",{style:{background:bgGrad,borderRadius:10,border:"1px solid "+bColor+"55",padding:"10px 14px"}},
                  React.createElement("div",{style:{fontSize:8,fontWeight:800,letterSpacing:2,color:bColor,marginBottom:3}},iconStr+" "+alertLabel),
                  React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:4}},
                    myRanked.arcBadge?React.createElement("span",{style:{fontSize:9,fontWeight:800,color:myRanked.arcBadgeColor||bColor,background:"rgba(0,0,0,0.3)",border:"1px solid "+(myRanked.arcBadgeColor||bColor)+"55",borderRadius:10,padding:"2px 8px"}},(myRanked.arcBadge)):null,
                    React.createElement("span",{style:{fontSize:10,fontWeight:700,color:T.text}},(myRanked.arcPlayer.name)+" Â· "+myRanked.arcPlayer.pos+" Â· OVR "+myRanked.arcPlayer.ovr)
                  ),
                  React.createElement("div",{style:{fontSize:10,fontStyle:"italic",color:T.dim}},"\u201C"+alertLine+"\u201D")
                );
              })(),
              ranked.map(function(t2,i){var isMe2=t2.id===myId;
                var rank=i+1;var prevRk=prevMap[t2.id]||rank;
                var delta=prevRk-rank;
                var arrow=delta>0?"\u25b2"+delta:delta<0?"\u25bc"+Math.abs(delta):"\u2014";
                var arrowColor=delta>0?T.green:delta<0?T.red:T.faint;
                var showHotTake=rank<=5;
                // v17: arc badge pill for player in this team's row
                var arcBadgePill=t2.arcBadge?React.createElement("span",{style:{fontSize:7,fontWeight:800,color:t2.arcBadgeColor||T.gold,background:"rgba(0,0,0,0.35)",border:"1px solid "+(t2.arcBadgeColor||T.gold)+"44",borderRadius:8,padding:"1px 5px",marginLeft:3,verticalAlign:"middle"}},(t2.arcBadge)+" "+(t2.arcPlayer?t2.arcPlayer.name:"")):null;
                return React.createElement("div",{key:t2.id,style:assign({},cS,{padding:"10px 12px",display:"flex",alignItems:"center",gap:8,
                  background:isMe2?"rgba(212,167,75,0.12)":rank===1?"rgba(251,191,36,0.06)":rank<=6?"rgba(16,185,129,0.04)":T.bg2,
                  borderColor:isMe2?T.gold:rank===1?T.gold+"66":rank<=6?T.green:T.border,
                  boxShadow:rank===1?"0 0 12px rgba(251,191,36,0.1)":"none"})},
                  React.createElement("div",{style:{fontSize:rank<=3?24:20,fontWeight:900,width:32,textAlign:"center",color:rank===1?T.gold:rank<=3?T.green:rank<=10?T.dim:T.faint}},rank),
                  React.createElement("div",{style:{fontSize:11,fontWeight:700,width:28,textAlign:"center",color:arrowColor}},arrow),
                  React.createElement(TeamLogo,{team:t2,size:28}),
                  React.createElement("div",{style:{flex:1}},
                    React.createElement("div",{style:{fontWeight:isMe2?800:600,fontSize:12,display:"flex",alignItems:"center",gap:4,flexWrap:"wrap"}},t2.city+" "+t2.name,arcBadgePill),
                    React.createElement("div",{style:{fontSize:10,color:T.dim}},t2.wins+"-"+t2.losses+" \u2022 SOS: "+t2.sos+"% \u2022 L3: "+t2.recentW+"W"),
                    React.createElement("div",{style:{fontSize:9,fontStyle:"italic",color:t2.streak>=3?T.green:t2.streak<=-3?T.red:T.faint,marginTop:1}},t2.blurb),
                    showHotTake?React.createElement("div",{style:{fontSize:8,color:T.gold,marginTop:2,fontStyle:"italic"}},"\ud83c\udf99\ufe0f "+(t2.arcKey17&&ARC_HOT_TAKES[t2.arcKey17]?ARC_HOT_TAKES[t2.arcKey17][0]:pick(TOP_BLURBS))):null
                  ),
                  React.createElement("div",{style:{textAlign:"right"}},
                    React.createElement("div",{style:{fontWeight:800,fontSize:15,color:t2.power>30?T.green:t2.power>20?T.gold:T.red}},t2.power),
                    React.createElement("div",{style:{fontSize:7,color:T.faint,letterSpacing:1}},"PWR")
                  )
                );
              })
            );
          })()}
          
          {tab==="ticker" && (function(){
            // TICKER_INTEL v24: Cinematic MFSN broadcast news center
            // â”€â”€ Section 1: Breaking / Game Results â”€â”€
            var breakingNews=[];
            var playedGames=(sched||[]).filter(function(g){return g&&g.played&&g.result&&typeof g.result.home==="number"&&typeof g.result.away==="number";}).slice(-12).reverse();
            playedGames.forEach(function(g){
              var hT=teams.find(function(t){return t.id===g.home;});var aT=teams.find(function(t){return t.id===g.away;});
              if(!hT||!aT)return;
              var winner=g.result.home>g.result.away?hT:aT;var loser=g.result.home>g.result.away?aT:hT;
              var score=g.result.home+"-"+g.result.away;var margin=Math.abs(g.result.home-g.result.away);
              var isMyGame=g.home===myId||g.away===myId;
              var myWin=isMyGame&&winner.id===myId;
              if(margin>=28){breakingNews.push({cat:"RESULTS",priority:3,icon:"ðŸ’¥",color:"#ef4444",wk:g.week,
                headline:winner.icon+" "+winner.name+" DEMOLISHED "+loser.name+" "+score,
                sub:"Blowout of the week â€” "+margin+" point margin"+(isMyGame?(myWin?" ðŸ† YOUR WIN":" ðŸ˜¤ YOUR LOSS"):"")});}
              else if(margin<=3){breakingNews.push({cat:"RESULTS",priority:3,icon:"ðŸ”¥",color:T.gold,wk:g.week,
                headline:"INSTANT CLASSIC: "+winner.icon+" "+winner.name+" edge "+loser.icon+" "+loser.name+" "+score,
                sub:"Nail-biter â€” decided by "+margin+(margin===1?" point":" points")+(isMyGame?(myWin?" ðŸ† YOUR WIN":" ðŸ’” YOUR LOSS"):"")});}
              else if(isMyGame){breakingNews.push({cat:"RESULTS",priority:2,icon:myWin?"âœ…":"âŒ",color:myWin?T.green:T.red,wk:g.week,
                headline:(myWin?"WIN":"LOSS")+": "+my.icon+" "+my.name+" "+(myWin?"def.":"fall to")+" "+(myWin?loser:winner).icon+" "+(myWin?loser:winner).name+" "+score,
                sub:"Week "+g.week+" result"});}
            });
            // â”€â”€ Section 2: Arc Player Storylines â”€â”€
            var arcNews=[];
            var allArcPlayers=[];
            teams.forEach(function(t){
              (t.roster||[]).forEach(function(p){
                if(p&&p._arcState&&(p.ovr||0)>=72&&p.isStarter){
                  allArcPlayers.push(assign({},p,{teamId:t.id,teamName:t.name,teamIcon:t.icon,teamAbbr:t.abbr}));
                }
              });
            });
            // My arc players first, then league arcs
            var myArcPlayers=allArcPlayers.filter(function(p){return p.teamId===myId;});
            var leagueArcPlayers=allArcPlayers.filter(function(p){return p.teamId!==myId;}).slice(0,4);
            myArcPlayers.forEach(function(p){
              var arcInfo=ARC_SPOTLIGHT.lines[p._arcState]||{};
              var arcBadge24=arcInfo.badge||"ðŸ“°";
              var arcLabel24=arcInfo.badge||String(p._arcState||"ARC").replace(/_/g," ");
              var positiveArc=["BREAKOUT","ELITE","COMEBACK"].indexOf(p._arcState)>=0;
              var isHurt=p.injury&&p.injury.games>0;
              var headline="";
              if(isHurt&&positiveArc){headline=my.icon+" "+p.name+" ("+p.pos+") INJURED on "+arcLabel24+" arc â€” "+p.injury.games+" wks out";}
              else if(p._arcState==="SLUMP"){headline=my.icon+" "+p.name+" ("+p.pos+") slump deepening â€” "+p._arcTurns+" weeks in";}
              else if(p._arcState==="BREAKOUT"){headline="ðŸŒ± BREAKOUT: "+my.icon+" "+p.name+" ("+p.pos+", OVR "+p.ovr+") announcing themselves to the league";}
              else if(p._arcState==="ELITE"){headline="â­ ELITE WATCH: "+my.icon+" "+p.name+" ("+p.pos+") playing at All-Pro level";}
              else if(p._arcState==="HOLDOUT"){headline="ðŸ’° CONTRACT DRAMA: "+my.icon+" "+p.name+" situation demands resolution";}
              else if(p._arcState==="SWAN_SONG"){headline="ðŸ¦¢ LEGEND: "+my.icon+" "+p.name+" writing their final chapter";}
              else if(p._arcState==="COMEBACK"){headline="ðŸ”„ COMEBACK: "+my.icon+" "+p.name+" redemption arc in full swing";}
              else{headline=arcLabel24+" "+my.icon+" "+p.name+" ("+p.pos+") â€” "+p._arcState+" arc active";}
              if(headline)arcNews.push({cat:"ARC",priority:positiveArc&&!isHurt?2:3,icon:arcBadge24,
                color:arcInfo.badgeColor||T.dim,wk:season.week,headline:headline,
                sub:"Your franchise player â€” "+((typeof p._arcTurns==="number"&&isFinite(p._arcTurns))?p._arcTurns:0)+" wk arc",isMyTeam:true});
            });
            leagueArcPlayers.forEach(function(p){
              var arcInfo=ARC_SPOTLIGHT.lines[p._arcState]||{};
              var arcBadge24=arcInfo.badge||"ðŸ“°";
              var arcLabel24=arcInfo.badge||String(p._arcState||"ARC").replace(/_/g," ");
              arcNews.push({cat:"ARC",priority:1,icon:arcBadge24,color:arcInfo.badgeColor||T.dim,
                wk:season.week,headline:arcLabel24+" "+(p.teamIcon||"ðŸˆ")+" "+p.name+" ("+(p.teamAbbr||"TEAM")+", "+p.pos+") â€” "+String(p._arcState||"arc").toLowerCase().replace(/_/g," ")+" arc",
                sub:"League arc watch â€” OVR "+p.ovr});
            });
            // â”€â”€ Section 3: Your Team News â”€â”€
            var myNews=[];
            var myHurt=(my.roster||[]).filter(function(p){return p&&p.injury&&p.injury.games>0;}).sort(function(a,b){return b.ovr-a.ovr;});
            myHurt.forEach(function(p){
              var sev=p.injury.games>=4?"ðŸš¨ SEASON-THREATENING":p.injury.games>=3?"âš ï¸ SIGNIFICANT":p.injury.games>=2?"âš ï¸ MULTI-WEEK":"DTD";
              myNews.push({cat:"MY_TEAM",priority:p.isStarter&&p.ovr>=80?3:2,icon:"ðŸ¥",color:T.red,wk:season.week,
                headline:sev+": "+p.name+" ("+p.pos+", OVR "+p.ovr+") â€” "+p.injury.type+" â€” "+p.injury.games+" wk"+(p.injury.games!==1?"s":""),
                sub:p.isStarter?"Starter down â€” depth tested":p.injury.games<=1?"Back next week":"Check injury tab for rehab options"});
            });
            (txLog||[]).slice(-8).reverse().forEach(function(tx){
              if(tx.type==="TRADE"){myNews.push({cat:"MY_TEAM",priority:2,icon:"ðŸ”„",color:T.purple,wk:tx.week,
                headline:"TRADE COMPLETED: Sent "+tx.detail.sent+" | Received "+tx.detail.got,
                sub:"Deal with "+tx.detail.with+" â€” Wk "+tx.week});}
              if(tx.type==="SIGN_FA"){myNews.push({cat:"MY_TEAM",priority:1,icon:"âœï¸",color:T.green,wk:tx.week,
                headline:"SIGNED: "+tx.detail.name+" ("+tx.detail.pos+") â€” $"+tx.detail.salary+"M/"+tx.detail.years+"yr",
                sub:"Free agent signing complete"});}
              if(tx.type==="CUT_PLAYER"){myNews.push({cat:"MY_TEAM",priority:1,icon:"âœ‚ï¸",color:"#ef4444",wk:tx.week,
                headline:"RELEASED: "+tx.detail.name+" ("+tx.detail.pos+") â€” $"+(tx.detail.dead||0).toFixed(1)+"M dead cap",
                sub:"Roster move â€” Wk "+tx.week});}
            });
            // â”€â”€ Section 4: League Standings Buzz â”€â”€
            var leagueNews=[];
            var sorted24=teams.slice().sort(function(a,b){return b.wins-a.wins||(b.pf-b.pa)-(a.pf-a.pa);});
            var leader24=sorted24[0];var myRank=sorted24.findIndex(function(t){return t.id===myId;})+1;
            if(leader24&&leader24.wins>=6){
              leagueNews.push({cat:"LEAGUE",priority:2,icon:"ðŸ‘‘",color:T.gold,wk:season.week,
                headline:"LEAGUE LEADER: "+leader24.icon+" "+leader24.name+" dominating at "+leader24.wins+"-"+leader24.losses,
                sub:"Best record in the league â€” "+(myRank===1?"That's YOU! ðŸ†":"You're #"+myRank+" overall")});
            }
            // Hot teams â€” 3+ game win streak
            teams.forEach(function(t){
              var recentG=(sched||[]).filter(function(g){return g&&g.played&&(g.home===t.id||g.away===t.id);}).slice(-4);
              var streak=0;
              for(var ri=recentG.length-1;ri>=0;ri--){
                var rg=recentG[ri];
                if(!rg.result||typeof rg.result.home!=="number"||typeof rg.result.away!=="number")break;
                var won=(rg.home===t.id&&rg.result.home>rg.result.away)||(rg.away===t.id&&rg.result.away>rg.result.home);
                if(won)streak++;else break;
              }
              if(streak>=3&&t.id!==myId){
                leagueNews.push({cat:"LEAGUE",priority:1,icon:"ðŸ”¥",color:T.orange,wk:season.week,
                  headline:"HOT STREAK: "+t.icon+" "+t.name+" W"+streak+" â€” playoff picture shifting",
                  sub:"Watch out â€” "+t.wins+"-"+t.losses+" overall"});
              }
            });
            // â”€â”€ Combine all into priority-sorted master feed â”€â”€
            var masterFeed=[].concat(breakingNews,arcNews,myNews,leagueNews).sort(function(a,b){return b.priority-a.priority;});
            // â”€â”€ Breaking alert: pick highest priority item â”€â”€
            var breakingAlert=masterFeed.find(function(n){return n.priority>=3;})||null;
            // â”€â”€ Category sections â”€â”€
            var sections=[
              {id:"ARC",label:"ðŸŽ­ ARC WATCH",color:"rgba(165,180,252,0.8)",bg:"rgba(99,102,241,0.08)",border:"rgba(99,102,241,0.30)",items:masterFeed.filter(function(n){return n.cat==="ARC";})},
              {id:"RESULTS",label:"ðŸˆ GAME RESULTS",color:T.gold,bg:"rgba(212,167,75,0.06)",border:"rgba(212,167,75,0.25)",items:masterFeed.filter(function(n){return n.cat==="RESULTS";})},
              {id:"MY_TEAM",label:"ðŸŸï¸ YOUR FRANCHISE",color:T.cyan,bg:"rgba(34,211,238,0.06)",border:"rgba(34,211,238,0.25)",items:masterFeed.filter(function(n){return n.cat==="MY_TEAM";})},
              {id:"LEAGUE",label:"ðŸ“Š LEAGUE BUZZ",color:T.green,bg:"rgba(16,185,129,0.06)",border:"rgba(16,185,129,0.25)",items:masterFeed.filter(function(n){return n.cat==="LEAGUE";})}
            ].filter(function(s){return s.items.length>0;});
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              {/* Header */}
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div style={{fontWeight:700}}>{"ðŸ“º MFSN Live News Center"}</div>
                <div style={{fontSize:9,color:T.dim}}>{"Week "+season.week+" | "+masterFeed.length+" stories"}</div>
              </div>
              {/* Breaking News Alert */}
              {breakingAlert&&<div style={{background:"linear-gradient(135deg,rgba(239,68,68,0.18),rgba(239,68,68,0.06))",
                border:"1px solid rgba(239,68,68,0.50)",borderRadius:10,padding:"10px 12px"}}>
                <div style={{display:"flex",gap:8,alignItems:"flex-start"}}>
                  <div style={{display:"flex",flexDirection:"column",alignItems:"center",minWidth:36}}>
                    <div style={{fontSize:9,letterSpacing:2,color:"#ef4444",fontWeight:900,textTransform:"uppercase",whiteSpace:"nowrap"}}>{"ðŸš¨ BREAKING"}</div>
                    <div style={{fontSize:22}}>{breakingAlert.icon}</div>
                  </div>
                  <div style={{flex:1}}>
                    <div style={{fontWeight:900,fontSize:13,color:"#fff",lineHeight:1.3,marginBottom:3}}>
                      {breakingAlert.headline}
                    </div>
                    <div style={{fontSize:9,color:"rgba(255,255,255,0.55)"}}>{breakingAlert.sub+" | Wk "+breakingAlert.wk}</div>
                  </div>
                </div>
              </div>}
              {/* Empty state */}
              {masterFeed.length===0&&<div style={{background:"rgba(99,102,241,0.07)",border:"1px solid rgba(99,102,241,0.22)",
                borderRadius:10,padding:24,textAlign:"center"}}>
                <div style={{fontSize:24,marginBottom:8}}>{"ðŸ“º"}</div>
                <div style={{fontWeight:800,fontSize:13,color:"#a5b4fc",marginBottom:6}}>{"MFSN STANDING BY"}</div>
                <div style={{fontSize:10,color:T.dim}}>{"Sim some games and the news will pour in. The league never sleeps."}</div>
              </div>}
              {/* Sectioned news feed */}
              {sections.map(function(sec){
                return <div key={sec.id} style={{background:sec.bg,border:"1px solid "+sec.border,borderRadius:8,padding:10}}>
                  <div style={{fontSize:9,letterSpacing:2,color:sec.color,fontWeight:900,marginBottom:8,textTransform:"uppercase"}}>
                    {sec.label}
                  </div>
                  <div style={{display:"flex",flexDirection:"column",gap:5}}>
                    {sec.items.slice(0,5).map(function(n,ni){
                      return <div key={ni} style={{display:"flex",gap:8,alignItems:"flex-start",padding:"5px 0",
                        borderBottom:ni<Math.min(sec.items.length,5)-1?"1px solid rgba(255,255,255,0.05)":"none"}}>
                        <span style={{fontSize:14,flexShrink:0,minWidth:22}}>{n.icon}</span>
                        <div style={{flex:1}}>
                          <div style={{fontWeight:700,fontSize:11,color:n.color||T.text,lineHeight:1.3}}>{n.headline}</div>
                          <div style={{fontSize:9,color:T.faint,marginTop:1}}>{n.sub+" | Wk "+n.wk}</div>
                        </div>
                        {n.priority>=3&&<div style={{flexShrink:0,fontSize:8,padding:"1px 5px",borderRadius:4,
                          background:"rgba(239,68,68,0.15)",color:"#ef4444",fontWeight:800,alignSelf:"center"}}>
                          {"HOT"}
                        </div>}
                      </div>;
                    })}
                  </div>
                  {sec.items.length>5&&<div style={{fontSize:8,color:T.faint,marginTop:5,textAlign:"center"}}>
                    {"+"+(sec.items.length-5)+" more "+sec.id.toLowerCase().replace("_"," ")+" stories"}
                  </div>}
                </div>;
              })}
            </div>;
          })()}
          
          {tab==="awardsRace" && (function(){
            var allP=teams.reduce(function(acc,t2){return acc.concat(t2.roster.map(function(p){return assign({},p,{tA:t2.abbr,tIcon:t2.icon,tId:t2.id});}));},[]);
            var perfS=function(p){var s=p.stats;var pff=p.pff||50;var pM=(pff-60)*2;
              if(p.pos==="QB")return (s.passYds*1.1+(s.passTD||0)*25-(s.int||0)*35)+pM*1.5+p.ovr*0.8;
              if(p.pos==="RB")return((s.rushYds||0)*1.1+(s.rushTD||0)*35+(s.rec||0)*6)+pM+p.ovr*0.5;
              if(p.pos==="WR"||p.pos==="TE")return((s.recYds||0)*1.1+(s.recTD||0)*45+(s.rec||0)*3)+pM+p.ovr*0.5;
              if(["DL","LB"].indexOf(p.pos)>=0)return((s.sacks||0)*90+(s.tackles||0)*4+(s.defINT||0)*55)+pM+p.ovr*0.5;
              if(["CB","S"].indexOf(p.pos)>=0)return((s.defINT||0)*90+(s.tackles||0)*4)+pM+p.ovr*0.5;
              if(p.pos==="K")return((s.fgM||0)*55)+pM*0.8+p.ovr*0.3;
              if(p.pos==="P"){var pAvg2=s.punts>0?(s.puntYds/s.punts):0;return((s.punts||0)*4+(pAvg2-38)*10)+pM*0.8+p.ovr*0.3;}
              if(p.pos==="OL")return p.ovr*10+pM*1.2-(s.sacksAllowed||0)*22;
              return p.ovr;};
            var pffColor=function(g){return g>=90?"#10b981":g>=80?"#22d3ee":g>=70?"#fbbf24":g>=60?"#9ca3af":"#ef4444";};
            var pffLabel=function(g){return g>=90?"ELITE":g>=80?"HIGH":g>=70?"ABOVE AVG":g>=60?"AVERAGE":"BELOW AVG";};
            var mvpRace=allP.filter(function(p){return p.stats.gp>0;}).map(function(p){
              var base=perfS(p);var side=POS_DEF[p.pos]?POS_DEF[p.pos].side:"O";
              var tm3=teams.find(function(t){return t.id===p.tId;});
              var tW=tm3?tm3.wins:0;
              var teamBonus=tW>=12?1.20:tW>=10?1.12:tW>=8?1.06:1.0;
              var posM=p.pos==="QB"?1.25:side==="O"?1.0:0.7;
              return assign({},p,{score:Math.round(base*posM*teamBonus)});
            }).sort(function(a,b){return b.score-a.score;}).slice(0,5);
            var opoyRace=allP.filter(function(p){return["RB","WR","TE"].indexOf(p.pos)>=0&&p.stats.gp>0;}).sort(function(a,b){return perfS(b)-perfS(a);}).slice(0,5);
            var dpoyRace=allP.filter(function(p){return["DL","LB","CB","S"].indexOf(p.pos)>=0&&p.stats.gp>0;}).sort(function(a,b){return perfS(b)-perfS(a);}).slice(0,5);
            var royRace=allP.filter(function(p){return p.age<=22&&p.stats.gp>0;}).sort(function(a,b){return perfS(b)-perfS(a);}).slice(0,5);
            var cotyRace=teams.slice().map(function(t2){
              var avgOvr2=t2.roster.reduce(function(s,p){return s+p.ovr;},0)/Math.max(1,t2.roster.length);
              return {name:t2.staff.hc.name,team:t2.abbr,icon:t2.icon,wins:t2.wins,losses:t2.losses,
                score:Math.round((t2.wins-(avgOvr2/5))*10+t2.wins*2)};
            }).sort(function(a,b){return b.score-a.score;}).slice(0,5);
            var AP_SLOTS={QB:1,RB:1,WR:2,TE:1,OL:3,DL:2,LB:2,CB:2,S:1,K:1,P:1};
            function awardCard(title,icon2,players,showPff){
              return <div style={cS}>
                <div style={{fontWeight:700,fontSize:12,color:T.gold,marginBottom:6}}>{icon2+" "+title}</div>
                {players.map(function(p,i){var isMe2=p.tId===myId;return <div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"4px 0",borderBottom:"1px solid "+T.border}}>
                  <span style={{fontWeight:900,fontSize:16,width:24,color:i===0?T.gold:T.dim}}>{i+1}</span>
                  {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:26,age:p.age})}
                  <div style={{flex:1}}>
                    <div style={{fontWeight:isMe2?800:600,fontSize:12,cursor:"pointer"}} onClick={function(){setPlayerDetail(p);}}>{p.name}<span style={{color:T.gold,marginLeft:4,fontSize:10}}>{p.pos}</span></div>
                    <div style={{fontSize:10,color:T.dim}}>{p.tIcon+" "+p.tA+" | Score: "+(p.score||Math.round(perfS(p)))}</div>
                  </div>
                  {showPff!==false&&p.pff?<div style={{textAlign:"center",minWidth:36}}>
                    <div style={{fontSize:14,fontWeight:900,color:pffColor(p.pff)}}>{p.pff}</div>
                    <div style={{fontSize:7,color:pffColor(p.pff)}}>{pffLabel(p.pff)}</div>
                  </div>:null}
                </div>;})}
              </div>;
            }
            function allProCard(){
              return <div style={assign({},cS,{borderColor:"rgba(251,191,36,0.3)"})}>
                <div style={{fontWeight:700,fontSize:12,color:T.gold,marginBottom:8}}>{"â­ ALL-PRO PROJECTIONS (1st Team)"}</div>
                {Object.keys(AP_SLOTS).map(function(pos){
                  var n=AP_SLOTS[pos];
                  var pool=allP.filter(function(p){return p.pos===pos&&p.stats.gp>0;});
                  var sorted=pos==="OL"?pool.sort(function(a,b){return(b.pff||50)-(a.pff||50);}):pool.sort(function(a,b){return perfS(b)-perfS(a);});
                  var first=sorted.slice(0,n);var second=sorted.slice(n,n*2);
                  return <div key={pos} style={{marginBottom:6}}>
                    <div style={{fontSize:10,fontWeight:800,color:T.cyan,marginBottom:2}}>{pos+" ("+n+")"}</div>
                    {first.map(function(p,pi){
                      var isMe3=p.tId===myId;
                      return <div key={pi} style={{display:"flex",alignItems:"center",gap:6,padding:"2px 0",fontSize:11}}>
                        <span style={{color:T.gold,fontWeight:800}}>{"1st"}</span>
                        <span style={{fontWeight:isMe3?800:600}}>{p.name}</span>
                        <span style={{color:T.dim,fontSize:9}}>{p.tIcon+" "+p.tA}</span>
                        {p.pff?<span style={{marginLeft:"auto",fontWeight:800,fontSize:11,color:pffColor(p.pff)}}>{p.pff}</span>:null}
                      </div>;
                    })}
                    {second.map(function(p,pi){
                      var isMe3=p.tId===myId;
                      return <div key={"2-"+pi} style={{display:"flex",alignItems:"center",gap:6,padding:"2px 0",fontSize:10,opacity:0.7}}>
                        <span style={{color:T.dim,fontWeight:700}}>{"2nd"}</span>
                        <span style={{fontWeight:isMe3?700:500}}>{p.name}</span>
                        <span style={{color:T.faint,fontSize:9}}>{p.tIcon+" "+p.tA}</span>
                        {p.pff?<span style={{marginLeft:"auto",fontWeight:700,fontSize:10,color:pffColor(p.pff)}}>{p.pff}</span>:null}
                      </div>;
                    })}
                  </div>;
                })}
              </div>;
            }
            var pffTop=allP.filter(function(p){return p.pff&&p.stats.gp>=3;}).sort(function(a,b){return(b.pff||0)-(a.pff||0);}).slice(0,10);
            function pffLeaderboard(){
              return <div style={assign({},cS,{borderColor:"rgba(34,211,238,0.3)"})}>
                <div style={{fontWeight:700,fontSize:12,color:T.cyan,marginBottom:8}}>{"ðŸ“Š MFDF GRADE LEADERS"}</div>
                {pffTop.map(function(p,i){
                  var isMe4=p.tId===myId;
                  return <div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"4px 0",borderBottom:"1px solid "+T.border}}>
                    <span style={{fontWeight:900,fontSize:14,width:22,color:i<3?T.gold:T.dim}}>{i+1}</span>
                    {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:24,age:p.age})}
                    <div style={{flex:1}}>
                      <div style={{fontWeight:isMe4?800:600,fontSize:11}}>{p.name}<span style={{color:T.gold,marginLeft:4,fontSize:9}}>{p.pos}</span></div>
                      <div style={{fontSize:9,color:T.dim}}>{p.tIcon+" "+p.tA}</div>
                    </div>
                    <div style={{textAlign:"center"}}>
                      <div style={{fontSize:18,fontWeight:900,color:pffColor(p.pff)}}>{p.pff}</div>
                      <div style={{fontSize:7,color:pffColor(p.pff),fontWeight:700}}>{pffLabel(p.pff)}</div>
                    </div>
                  </div>;
                })}
              </div>;
            }

            // AWARDS_SURGE v25: MFSN cinematic awards command center
            // Arc-aware analyst commentary + momentum bars + my franchise spotlight
            var AS_ARC_TAKES={
              BREAKOUT:["A player on a BREAKOUT arc in the awards race? That's appointment television. The football gods are writing something special here.","When ascension meets opportunity, history happens. This BREAKOUT candidate is playing like they have something to prove â€” because they do.","BREAKOUT arc + awards trajectory = the story of the season. Clear your schedule for this player's highlights."],
              ELITE:["An ELITE-arc player leading the awards race is exactly what this sport is about. Sustained excellence at the highest level.","This is what legacy looks like. An ELITE player on an ELITE arc, making the case that they're the best on the planet right now.","Elite players make elite plays in elite moments. The awards voters are paying attention."],
              SLUMP:["A SLUMP arc player in the awards race? The numbers are there, but the feel isn't right. This race could get interesting.","You can lead the league and still be in a slump. The stats say one thing, the tape says another â€” awards voters will notice.","The arc says SLUMP but the scoreboard says contender. Something has to give."],
              COMEBACK:["A COMEBACK arc player in the awards conversation? Nobody writes better scripts than football.","From the bottom to the ballot â€” this COMEBACK story is everything this league is about. The voters are watching.","Redemption arcs are the most powerful narratives in sports. And right now, this player is writing one live."],
              DECLINE:["A DECLINE arc player still competing in the awards race. This is what greatness looks like at the edge â€” sheer will holding back the clock.","The arc says DECLINE but the results say otherwise. Veterans who refuse to go quietly are the most dangerous players in any league.","Champions don't decline â€” they transform. This player is rewriting the definition of greatness."],
              HOLDOUT:["A HOLDOUT player in the awards race adds a wrinkle â€” will the contract situation affect voter sentiment? Fascinating subplot.","Playing at an awards level while holding out? The leverage game just got very, very interesting.","You want a raise, you earn a raise. And right now, this HOLDOUT candidate is doing exactly that."],
              SWAN_SONG:["A SWAN_SONG arc player in the awards conversation. If there's a more poetic ending to a career, I haven't seen it.","One last run at glory. A SWAN SONG arc player making the awards ballot â€” this entire league should be watching.","Legends don't retire â€” they go out on their own terms. And right now, these are their terms."],
              MENTOR:["A MENTOR arc player still competitive in the awards race? That's the rarest kind of greatness â€” elevating others AND yourself.","MENTOR mode doesn't mean done. It means evolved. And evolved players still collect hardware.","Teaching the next generation while competing for awards. This is what a football life looks like at its finest."]
            };
            var AS_MVP_NARRATIVE=[
              "The MVP race is the ultimate measure of football in its purest form â€” one player bending an entire season to their will.",
              "Every week that passes without a runaway leader makes this race more valuable. Competitive MVP races produce legends.",
              "When you talk about this season ten years from now, the MVP race is where the story begins.",
              "The Most Valuable Player award is a team award handed to one person. The player who makes everyone around them better.",
              "Some years the MVP is obvious from week one. This isn't one of those years â€” and that's a beautiful thing."
            ];
            var AS_FRANCHISE_LINES={
              leading:["Your franchise has a player in this awards race. The whole league is watching â€” and so is ownership.","{name} isn't just competing for an award. {name} is competing for their place in this franchise's history.","{pos} in the awards conversation means this team's offensive/defensive identity is working. Build around it."],
              close:["Just outside the top spot, but close enough that one big week changes everything. Keep the faith in {name}.","{name} is right there. The gap between #1 and #2 in an awards race is smaller than it looks.","{name} is knocking on the door. In this league, opportunity doesn't knock twice â€” kick it down."],
              bubble:["On the fringe of the awards conversation is still IN the conversation. {name} needs one statement game.","Bubble players win awards when the leader stumbles. Stay ready â€” {name} could be holding that trophy.","Don't underestimate a dark horse in an awards race. {name} has the profile to surge."]
            };
            // Find my arc players in awards races
            var mvpLeader25=mvpRace[0]||null;
            var myArcAwards=[];
            var allAwardsPlayers=[].concat(mvpRace,opoyRace,dpoyRace,royRace);
            allAwardsPlayers.forEach(function(p){
              if(p.tId===myId&&p._arcState&&AS_ARC_TAKES[p._arcState]){
                var alreadyIn=myArcAwards.find(function(x){return x.id===p.id;});
                if(!alreadyIn)myArcAwards.push(p);
              }
            });
            // Surge score: how dominant is the leader vs #2?
            var mvpGap25=mvpRace.length>=2?(mvpRace[0].score-mvpRace[1].score):0;
            var mvpLockStatus=mvpGap25>500?"FRONTRUNNER":mvpGap25>200?"LEADING":"WIDE OPEN";
            var mvpLockColor=mvpGap25>500?T.gold:mvpGap25>200?"#22d3ee":"#ef4444";
            // My franchise presence in each race
            var myMvpRank=mvpRace.findIndex(function(p){return p.tId===myId;})+1;
            var myOpoyRank=opoyRace.findIndex(function(p){return p.tId===myId;})+1;
            var myDpoyRank=dpoyRace.findIndex(function(p){return p.tId===myId;})+1;
            var myRoyRank=royRace.findIndex(function(p){return p.tId===myId;})+1;
            var myBestRace=null;var myBestRank=99;var myBestLabel="";
            if(myMvpRank>0&&myMvpRank<myBestRank){myBestRank=myMvpRank;myBestRace=mvpRace[myMvpRank-1];myBestLabel="MVP";}
            if(myOpoyRank>0&&myOpoyRank<myBestRank){myBestRank=myOpoyRank;myBestRace=opoyRace[myOpoyRank-1];myBestLabel="OPOY";}
            if(myDpoyRank>0&&myDpoyRank<myBestRank){myBestRank=myDpoyRank;myBestRace=dpoyRace[myDpoyRank-1];myBestLabel="DPOY";}
            if(myRoyRank>0&&myRoyRank<myBestRank){myBestRank=myRoyRank;myBestRace=royRace[myRoyRank-1];myBestLabel="ROY";}
            // Analyst pick for arc headline
            var arcLeader25=myArcAwards[0]||(mvpLeader25&&mvpLeader25._arcState?mvpLeader25:null);
            var arcLines25=arcLeader25&&AS_ARC_TAKES[arcLeader25._arcState]?AS_ARC_TAKES[arcLeader25._arcState]:null;
            var arcQuote25=arcLines25?arcLines25[Math.floor(RNG.ui()*arcLines25.length)]:"";
            var arcInfo25=arcLeader25?(ARC_SPOTLIGHT.lines[arcLeader25._arcState]||{}):null;
            var mvpNarrative25=AS_MVP_NARRATIVE[Math.floor(RNG.ui()*AS_MVP_NARRATIVE.length)];
            // Momentum bar helper: max score in race â†’ bar width
            function momentumBar25(score,maxScore,color){
              var pct=maxScore>0?Math.min(100,Math.round((score/maxScore)*100)):0;
              return <div style={{height:4,background:"rgba(255,255,255,0.06)",borderRadius:2,marginTop:3,overflow:"hidden"}}>
                <div style={{height:"100%",width:pct+"%",background:color||T.gold,borderRadius:2,transition:"width 0.3s"}}></div>
              </div>;
            }
            // Enhanced awardCard v25 with momentum bars + arc badges
            function awardCard25(title,icon2,players,accentColor){
              var maxScore25=players.length>0?(players[0].score||Math.round(perfS(players[0]))):1;
              return <div style={assign({},cS,{borderColor:"rgba(255,255,255,0.08)"})}>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8}}>
                  <div style={{fontWeight:700,fontSize:12,color:accentColor||T.gold}}>{icon2+" "+title}</div>
                  {players[0]&&<div style={{fontSize:9,fontWeight:800,color:mvpLockColor,padding:"2px 6px",background:"rgba(255,255,255,0.06)",borderRadius:4}}>{title==="MVP"?mvpLockStatus:"RACE ON"}</div>}
                </div>
                {players.map(function(p,i){
                  var isMe2=p.tId===myId;
                  var arcInf25=p._arcState?(ARC_SPOTLIGHT.lines[p._arcState]||{}):null;
                  var sc25=p.score||Math.round(perfS(p));
                  return <div key={i} style={{padding:"5px 0",borderBottom:"1px solid "+T.border}}>
                    <div style={{display:"flex",alignItems:"center",gap:8}}>
                      <span style={{fontWeight:900,fontSize:16,width:24,color:i===0?(accentColor||T.gold):T.dim}}>{i===0?"ðŸ†":i+1}</span>
                      {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:26,age:p.age})}
                      <div style={{flex:1}}>
                        <div style={{display:"flex",alignItems:"center",gap:6}}>
                          <span style={{fontWeight:isMe2?800:600,fontSize:12,cursor:"pointer"}} onClick={function(){setPlayerDetail(p);}}>{p.name}</span>
                          <span style={{color:accentColor||T.gold,fontSize:10,fontWeight:700}}>{p.pos}</span>
                          {arcInf25&&arcInf25.badge&&<span style={{fontSize:9,fontWeight:800,color:arcInf25.badgeColor||"#a78bfa",padding:"1px 5px",background:"rgba(167,139,250,0.12)",borderRadius:3}}>{arcInf25.badge}</span>}
                          {isMe2&&<span style={{fontSize:8,fontWeight:800,color:T.gold,padding:"1px 4px",background:"rgba(212,167,75,0.15)",borderRadius:3}}>YOUR TEAM</span>}
                        </div>
                        <div style={{fontSize:10,color:T.dim}}>{p.tIcon+" "+p.tA+" | Score: "+sc25}</div>
                        {momentumBar25(sc25,maxScore25,i===0?(accentColor||T.gold):"rgba(255,255,255,0.2)")}
                      </div>
                      {p.pff?<div style={{textAlign:"center",minWidth:36}}>
                        <div style={{fontSize:14,fontWeight:900,color:pffColor(p.pff)}}>{p.pff}</div>
                        <div style={{fontSize:7,color:pffColor(p.pff)}}>{pffLabel(p.pff)}</div>
                      </div>:null}
                    </div>
                  </div>;
                })}
              </div>;
            }

            return <div style={{display:"flex",flexDirection:"column",gap:8}}>

              {/* MFSN AWARDS BROADCAST HEADER */}
              <div style={{background:"linear-gradient(135deg,rgba(212,167,75,0.18),rgba(251,191,36,0.04),rgba(0,0,0,0.9))",border:"2px solid rgba(212,167,75,0.4)",borderRadius:12,padding:"12px 14px"}}>
                <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:6}}>
                  <div style={{fontSize:24}}>ðŸ†</div>
                  <div>
                    <div style={{fontSize:11,fontWeight:900,color:T.gold,letterSpacing:2}}>{"MFSN AWARDS SEASON"}</div>
                    <div style={{fontSize:9,color:T.faint}}>{"Week "+season.week+" Race Coverage â€” Presented by MFSN Analytics"}</div>
                  </div>
                  <div style={{marginLeft:"auto",fontSize:9,fontWeight:800,color:mvpLockColor,padding:"3px 8px",background:"rgba(255,255,255,0.06)",borderRadius:6,border:"1px solid "+mvpLockColor+"44"}}>{mvpLockStatus}</div>
                </div>
                <div style={{fontSize:11,color:"#e2e8f0",fontStyle:"italic",borderLeft:"2px solid rgba(212,167,75,0.4)",paddingLeft:8,lineHeight:1.5}}>{mvpNarrative25}</div>
              </div>

              {/* ARC PLAYER IN AWARDS RACE â€” only renders when arc player is a contender */}
              {arcLeader25&&arcInfo25&&arcQuote25?<div style={{background:"linear-gradient(135deg,rgba(139,92,246,0.14),rgba(99,102,241,0.06))",border:"2px solid rgba(139,92,246,0.35)",borderRadius:10,padding:12}}>
                <div style={{fontWeight:800,fontSize:11,color:"#a78bfa",marginBottom:8,letterSpacing:1}}>{"ðŸ“º MFSN ARC SPOTLIGHT â€” AWARDS EDITION"}</div>
                <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}>
                  {React.createElement(PlayerFace,{id:arcLeader25.id,morale:arcLeader25.morale||70,size:36,age:arcLeader25.age})}
                  <div>
                    <div style={{fontWeight:900,fontSize:13}}>{arcLeader25.name}</div>
                    <div style={{fontSize:10,color:T.dim}}>{arcLeader25.tIcon+" "+arcLeader25.tA+" | "+arcLeader25.pos+" | OVR "+(arcLeader25.ovr||0)}</div>
                    <div style={{display:"flex",alignItems:"center",gap:6,marginTop:3}}>
                      {arcInfo25.badge&&<span style={{fontSize:9,fontWeight:800,color:arcInfo25.badgeColor||"#a78bfa",padding:"2px 6px",background:"rgba(167,139,250,0.12)",borderRadius:3}}>{arcInfo25.badge}</span>}
                      {arcLeader25.tId===myId&&<span style={{fontSize:8,fontWeight:800,color:T.gold,padding:"2px 6px",background:"rgba(212,167,75,0.12)",borderRadius:3}}>{"YOUR FRANCHISE"}</span>}
                    </div>
                  </div>
                </div>
                <div style={{fontSize:11,color:"#e2e8f0",fontStyle:"italic",borderLeft:"3px solid rgba(139,92,246,0.5)",paddingLeft:10,lineHeight:1.6}}>{arcQuote25}</div>
              </div>:null}

              {/* MY FRANCHISE AWARD WATCH â€” only renders when user team has a candidate */}
              {myBestRace&&myBestRank>0?<div style={{background:"linear-gradient(135deg,rgba(212,167,75,0.12),rgba(0,0,0,0.8))",border:"1px solid rgba(212,167,75,0.3)",borderRadius:10,padding:12}}>
                <div style={{fontWeight:800,fontSize:11,color:T.gold,marginBottom:8,letterSpacing:1}}>{"ðŸŸï¸ YOUR FRANCHISE â€” AWARD WATCH"}</div>
                <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}>
                  {React.createElement(PlayerFace,{id:myBestRace.id,morale:myBestRace.morale||70,size:32,age:myBestRace.age})}
                  <div style={{flex:1}}>
                    <div style={{display:"flex",alignItems:"center",gap:6}}>
                      <span style={{fontWeight:900,fontSize:13}}>{myBestRace.name}</span>
                      <span style={{fontSize:9,fontWeight:800,color:"#fff",padding:"2px 6px",background:"rgba(212,167,75,0.3)",borderRadius:4}}>{"#"+myBestRank+" "+myBestLabel}</span>
                    </div>
                    <div style={{fontSize:10,color:T.dim}}>{myBestRace.pos+" | OVR "+(myBestRace.ovr||0)+" | Score: "+(myBestRace.score||0)}</div>
                  </div>
                </div>
                {(function(){
                  var pool25=myBestRank===1?AS_FRANCHISE_LINES.leading:myBestRank<=3?AS_FRANCHISE_LINES.close:AS_FRANCHISE_LINES.bubble;
                  var fLine25=pool25[Math.floor(RNG.ui()*pool25.length)].replace(/\{name\}/g,myBestRace.name.split(" ")[0]).replace(/\{pos\}/g,myBestRace.pos);
                  return <div style={{fontSize:11,color:"#e2e8f0",fontStyle:"italic",borderLeft:"2px solid rgba(212,167,75,0.4)",paddingLeft:8,lineHeight:1.5}}>{fLine25}</div>;
                })()}
                {/* All races at a glance */}
                <div style={{display:"flex",gap:6,marginTop:8,flexWrap:"wrap"}}>
                  {myMvpRank>0&&<span style={{fontSize:9,fontWeight:800,padding:"2px 7px",background:"rgba(212,167,75,0.12)",border:"1px solid rgba(212,167,75,0.2)",borderRadius:4,color:myMvpRank===1?T.gold:T.dim}}>{"MVP #"+myMvpRank}</span>}
                  {myOpoyRank>0&&<span style={{fontSize:9,fontWeight:800,padding:"2px 7px",background:"rgba(52,211,153,0.10)",border:"1px solid rgba(52,211,153,0.2)",borderRadius:4,color:myOpoyRank===1?"#34d399":T.dim}}>{"OPOY #"+myOpoyRank}</span>}
                  {myDpoyRank>0&&<span style={{fontSize:9,fontWeight:800,padding:"2px 7px",background:"rgba(239,68,68,0.10)",border:"1px solid rgba(239,68,68,0.2)",borderRadius:4,color:myDpoyRank===1?"#ef4444":T.dim}}>{"DPOY #"+myDpoyRank}</span>}
                  {myRoyRank>0&&<span style={{fontSize:9,fontWeight:800,padding:"2px 7px",background:"rgba(251,191,36,0.10)",border:"1px solid rgba(251,191,36,0.2)",borderRadius:4,color:myRoyRank===1?"#fbbf24":T.dim}}>{"ROY #"+myRoyRank}</span>}
                  {myMvpRank===0&&myOpoyRank===0&&myDpoyRank===0&&myRoyRank===0&&<span style={{fontSize:9,color:T.faint,fontStyle:"italic"}}>{"No candidates in top 5 yet â€” sim more weeks"}</span>}
                </div>
              </div>:null}

              {/* AWARD RACES â€” enhanced with momentum bars */}
              {awardCard25("MVP","ðŸ†",mvpRace,T.gold)}
              {awardCard25("Offensive Player of the Year","âš”ï¸",opoyRace,"#34d399")}
              {awardCard25("Defensive Player of the Year","ðŸ›¡ï¸",dpoyRace,"#ef4444")}
              {awardCard25("Rookie of the Year","ðŸŒŸ",royRace,"#fbbf24")}

              {/* COTY */}
              <div style={assign({},cS,{borderColor:"rgba(255,255,255,0.08)"})}>
                <div style={{fontWeight:700,fontSize:12,color:"#a855f7",marginBottom:6}}>{"ðŸŽ“ Coach of the Year"}</div>
                {cotyRace.map(function(c,ci){return <div key={ci} style={{display:"flex",alignItems:"center",gap:8,padding:"5px 0",borderBottom:"1px solid "+T.border}}>
                  <span style={{fontWeight:900,fontSize:16,width:24,color:ci===0?"#a855f7":T.dim}}>{ci===0?"ðŸ†":ci+1}</span>
                  <div style={{flex:1}}>
                    <div style={{fontWeight:ci===0?800:600,fontSize:12}}>{c.name}</div>
                    <div style={{fontSize:10,color:T.dim}}>{c.icon+" "+c.team+" ("+c.wins+"-"+c.losses+")"}</div>
                    {(function(){var maxCOTY=cotyRace[0]?cotyRace[0].score:1;var pctCOTY=maxCOTY>0?Math.min(100,Math.round((c.score/maxCOTY)*100)):0;
                      return <div style={{height:3,background:"rgba(255,255,255,0.06)",borderRadius:2,marginTop:3}}><div style={{height:"100%",width:pctCOTY+"%",background:ci===0?"#a855f7":"rgba(255,255,255,0.15)",borderRadius:2}}></div></div>;
                    })()}
                  </div>
                  <div style={{fontSize:12,fontWeight:800,color:ci===0?"#a855f7":T.dim}}>{"+"+(c.score>0?c.score:0)}</div>
                </div>;})}
              </div>

              {pffLeaderboard()}
              {allProCard()}
            </div>;
          })()}
          
          {/* â”€â”€ GLOBAL_BOARD: Global Leaderboard tab â”€â”€ */}
          {tab==="globalBoard" && (function(){
            var allTimeWins=history.reduce(function(s,h){
              var r=h.teamRecords?h.teamRecords.find(function(tr){return tr.id===myId;}):null;
              return s+(r?r.wins:0);},0);
            var allTimeLosses=history.reduce(function(s,h){
              var r=h.teamRecords?h.teamRecords.find(function(tr){return tr.id===myId;}):null;
              return s+(r?r.losses:0);},0);
            var championships=history.filter(function(h){return h.winnerId===myId||h.champId===myId;}).length;
            var legacyScore=championships*10000+allTimeWins*100+Math.floor((allTimeWins/(Math.max(1,allTimeWins+allTimeLosses)))*1000);
            var gmName=my&&my.gm?my.gm.name:(my&&my.gmName)||"Anonymous GM";
            var teamName=my?((my.icon||"ðŸˆ")+" "+(my.name||"My Team")):"My Team";
            function fetchBoard(){
              setGlobalBoardLoading(true);
              fetch("/.netlify/functions/leaderboard?limit=25")
                .then(function(r){return r.json();})
                .then(function(d){setGlobalBoard(d.board||[]);setGlobalBoardLoading(false);})
                .catch(function(){setGlobalBoardLoading(false);addN("âš ï¸ Leaderboard offline â€” check your connection.","orange");});
            }
            function submitScore(){
              if(!my||history.length<1){addN("âš ï¸ Need at least 1 completed season to submit.","orange");return;}
              fetch("/.netlify/functions/leaderboard",{
                method:"POST",headers:{"Content-Type":"application/json"},
                body:JSON.stringify({gmName:gmName,teamName:teamName,championships:championships,legacyScore:legacyScore,
                  record:allTimeWins+"-"+allTimeLosses,seasons:history.length})
              }).then(function(r){return r.json();})
                .then(function(d){if(d.rank){setGlobalBoardRank(d.rank);addN("ðŸŒ Dynasty submitted! You're ranked #"+d.rank+" globally!","gold");fetchBoard();}})
                .catch(function(){addN("âš ï¸ Submit failed â€” try again later.","orange");});
            }
            var rankColors=["#ffd700","#c0c0c0","#cd7f32"];
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={assign({},cS,{background:"linear-gradient(135deg,rgba(251,191,36,0.08),rgba(15,23,42,0.9))",borderColor:"rgba(251,191,36,0.3)"})}>
                <div style={{fontSize:14,fontWeight:900,color:T.gold,marginBottom:2}}>{"ðŸŒ GLOBAL DYNASTY LEADERBOARD"}</div>
                <div style={{fontSize:10,color:T.dim,marginBottom:8}}>{"Greatest dynasties ever built â€” across all platforms, all players, worldwide."}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:10}}>
                  <div style={{textAlign:"center",background:"rgba(255,255,255,0.04)",borderRadius:8,padding:8}}>
                    <div style={{fontSize:22,fontWeight:900,color:T.gold}}>{championships}</div>
                    <div style={{fontSize:8,color:T.dim}}>Championships</div>
                  </div>
                  <div style={{textAlign:"center",background:"rgba(255,255,255,0.04)",borderRadius:8,padding:8}}>
                    <div style={{fontSize:22,fontWeight:900,color:T.cyan}}>{allTimeWins+"-"+allTimeLosses}</div>
                    <div style={{fontSize:8,color:T.dim}}>All-Time Record</div>
                  </div>
                  <div style={{textAlign:"center",background:"rgba(255,255,255,0.04)",borderRadius:8,padding:8}}>
                    <div style={{fontSize:22,fontWeight:900,color:T.purple}}>{legacyScore.toLocaleString()}</div>
                    <div style={{fontSize:8,color:T.dim}}>Legacy Score</div>
                  </div>
                </div>
                <div style={{display:"flex",gap:8}}>
                  <button onClick={submitScore} style={{flex:1,background:"linear-gradient(135deg,#d4a74b,#b8860b)",color:"#000",border:"none",borderRadius:8,padding:"10px",fontWeight:800,cursor:"pointer",fontSize:12}}>
                    {globalBoardRank?"ðŸ”„ Update My Score (#"+globalBoardRank+" globally)":"ðŸ“¤ Submit My Dynasty"}
                  </button>
                  <button onClick={fetchBoard} disabled={globalBoardLoading} style={{background:"rgba(255,255,255,0.06)",color:T.dim,border:"1px solid "+T.border,borderRadius:8,padding:"10px 14px",fontWeight:700,cursor:"pointer",fontSize:11}}>
                    {globalBoardLoading?"â³":"ðŸ”„ Refresh"}
                  </button>
                </div>
              </div>
              {!globalBoard&&!globalBoardLoading&&<div style={{textAlign:"center",color:T.faint,padding:20,fontSize:12}}>{"Click \"Refresh\" to load the global leaderboard."}</div>}
              {globalBoardLoading&&<div style={{textAlign:"center",color:T.cyan,padding:20,fontSize:12}}>{"â³ Loading global rankings..."}</div>}
              {globalBoard&&<div style={cS}>
                <div style={{fontWeight:800,fontSize:11,color:T.gold,marginBottom:8}}>{"ðŸ† TOP DYNASTIES â€” ALL TIME"}</div>
                {globalBoard.length===0?<div style={{color:T.faint,textAlign:"center",padding:16}}>{"No entries yet â€” be the first to submit!"}</div>:
                globalBoard.map(function(entry,i){
                  var rankColor=i<3?rankColors[i]:T.dim;
                  var rankIcon=i===0?"ðŸ¥‡":i===1?"ðŸ¥ˆ":i===2?"ðŸ¥‰":("#"+(i+1));
                  return <div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"8px 0",borderBottom:"1px solid "+T.border,background:i<3?"rgba(255,255,255,0.02)":"transparent"}}>
                    <span style={{fontSize:i<3?18:11,minWidth:28,textAlign:"center",fontWeight:900,color:rankColor}}>{rankIcon}</span>
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontWeight:700,fontSize:11,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:i<3?rankColor:T.text}}>
                        {entry.teamName}
                      </div>
                      <div style={{fontSize:9,color:T.dim}}>{entry.gmName+" â€¢ "+entry.record+" â€¢ "+entry.seasons+" seasons"}</div>
                    </div>
                    <div style={{textAlign:"right",flexShrink:0}}>
                      <div style={{fontSize:11,fontWeight:800,color:rankColor}}>{(entry.legacyScore||0).toLocaleString()}</div>
                      <div style={{fontSize:8,color:T.faint}}>{entry.championships+"ðŸ†"}</div>
                    </div>
                  </div>;
                })}
              </div>}
            </div>;
          })()}

          {/* â”€â”€ PIPELINE: College Pipeline / Scouting Trips tab â”€â”€ */}
          {tab==="pipeline" && my && (function(){
            var teamPipeline=my._pipeline||{};
            var scoutTripsLeft=my._pipelineTripsWeekly!=null?my._pipelineTripsWeekly:4;
            function doScoutTrip(schoolId){
              if(scoutTripsLeft<=0){addN("âš ï¸ No pipeline trips remaining this week.","orange");return;}
              var res=PIPELINE.sendScout(schoolId,teamPipeline);
              var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
              if(!u2)return;
              u2._pipeline=res.pipeline;
              u2._pipelineTripsWeekly=(scoutTripsLeft-1);
              setTeams(nt);doSave(nt);
              var school=PIPELINE_SCHOOLS.find(function(s){return s.id===schoolId;});
              var tier=PIPELINE.getTier(res.newScore);
              addN("ðŸŽ“ Scout sent to "+(school?school.name:schoolId)+"! Pipeline: +"+res.gain+"pts â†’ "+tier.label+" ("+res.newScore+"/100)","cyan");
            }
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={assign({},cS,{padding:12})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <div style={{fontWeight:800,fontSize:13,color:T.cyan}}>{"ðŸŽ“ COLLEGE PIPELINE"}</div>
                  <div style={{fontSize:11,color:scoutTripsLeft>0?T.green:T.red,fontWeight:700}}>
                    {"ðŸŽ“ Pipeline Trips: "+scoutTripsLeft+" this week"+(scoutTripsLeft>4?" (includes carryover)":"")}
                  </div>
                </div>
                <div style={{fontSize:10,color:T.dim,marginBottom:10}}>{"Build relationships with colleges. Higher pipeline = better intel on their prospects + development bonuses when you draft their players."}</div>
                {PIPELINE_TIERS.map(function(tier){
                  return <div key={tier.label} style={{display:"flex",alignItems:"center",gap:8,padding:"2px 0",fontSize:9,color:tier.color}}>
                    <span style={{width:16}}>{tier.emoji}</span>
                    <span style={{fontWeight:700,width:60}}>{tier.label}</span>
                    <span style={{color:T.faint}}>{tier.min+"-"+tier.max+" pts"}</span>
                    {tier.devBonus>0&&<span style={{color:T.green}}>{"+"+Math.round(tier.devBonus*100)+"% dev"}</span>}
                    {tier.intelBonus>0&&<span style={{color:T.cyan}}>{"+"+Math.round(tier.intelBonus*100)+"% intel"}</span>}
                  </div>;
                })}
              </div>
              <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:8}}>
                {PIPELINE_SCHOOLS.map(function(school){
                  var score=teamPipeline[school.id]||0;
                  var tier=PIPELINE.getTier(score);
                  return <div key={school.id} style={assign({},cS,{padding:10,borderColor:tier.color+"44"})}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                      <div style={{fontWeight:700,fontSize:11}}>{school.icon+" "+school.name}</div>
                      <span style={{fontSize:9,padding:"1px 5px",borderRadius:8,background:tier.color+"22",color:tier.color,fontWeight:700}}>{tier.emoji+" "+tier.label}</span>
                    </div>
                    <div style={{fontSize:9,color:T.faint,marginBottom:4}}>{school.tendency.scheme.replace(/_/g," ").toUpperCase()+" â€¢ "+school.tendency.posBonus.join(", ")}</div>
                    <div style={{height:4,background:"rgba(255,255,255,0.08)",borderRadius:2,marginBottom:6}}>
                      <div style={{height:4,width:score+"%",background:tier.color,borderRadius:2,transition:"width 0.3s"}}></div>
                    </div>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <span style={{fontSize:9,color:T.dim}}>{score+"/100"}</span>
                      <button onClick={function(){doScoutTrip(school.id);}} disabled={scoutTripsLeft<=0}
                        style={{fontSize:9,padding:"3px 8px",borderRadius:6,
                          background:scoutTripsLeft>0?tier.color+"22":"rgba(255,255,255,0.05)",
                          color:scoutTripsLeft>0?tier.color:T.faint,
                          border:"1px solid "+(scoutTripsLeft>0?tier.color+"44":T.border),
                          cursor:scoutTripsLeft>0?"pointer":"not-allowed",fontWeight:700}}>
                        {"âœˆï¸ Scout Trip"}
                      </button>
                    </div>
                    {score>=25&&<div style={{fontSize:8,color:T.green,marginTop:4}}>{"ðŸ’¡ Prospects from here: +"+Math.round(tier.intelBonus*100)+"% scouting confidence"}</div>}
                    {score>=50&&<div style={{fontSize:8,color:T.cyan}}>{"âš¡ Draft picks: +"+Math.round(tier.devBonus*100)+"% dev bonus Yr 1"}</div>}
                  </div>;
                })}
              </div>
            </div>;
          })()}

          {tab==="training" && (function(){
            var gymLvl2=my.facilities?my.facilities.gym||0:0;
            var gymLabel=gymLvl2===0?"Basic":gymLvl2===1?"Good":gymLvl2===2?"Elite":"World Class";
            var safeRosterTrain=(my&&my.roster||[]).filter(Boolean);
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div style={{fontWeight:700}}>{"ðŸ‹ï¸ Position Group Training"}</div>
                <div style={{fontSize:10,padding:"3px 8px",borderRadius:4,background:gymLvl2>=2?"rgba(16,185,129,0.1)":"rgba(255,255,255,0.05)",
                  border:"1px solid "+(gymLvl2>=2?T.green:T.border),color:gymLvl2>=2?T.green:T.dim}}>
                  {"ðŸ‹ï¸ Gym: "+gymLabel+" (Lv"+gymLvl2+")"}</div>
              </div>
              <div style={{fontSize:11,color:T.dim,padding:"6px 10px",background:T.bg3,borderRadius:6,borderLeft:"3px solid "+T.gold}}>
                {"Assign a training focus for each position group. Players train that attribute each week. "
                +"Focused training boosts the chosen skill with no stat penalties â€” choose based on your build plan."}</div>
              <div style={{fontSize:9,color:T.green,marginTop:2}}>
                {"âœ… Training is always positive â€” no stat penalties for focusing on specific skills"}
              </div>
              {/* TRAINING_ARC v21: Arc-aware coaching recommendations panel */}
              {(function(){
                // Arcâ†’recommended training group+option mapping
                var ARC_TRAIN_RECS={
                  BREAKOUT:{group:"qb",opt:"accuracy",altGroups:["skill","dline","secondary"],altOpts:["route","passRush","coverage"],
                    coachLine:"Your BREAKOUT star is ascending â€” maximize their dominant skill RIGHT NOW. Don't let momentum stall.",
                    subLine:"Hot hand. Feed it. The reps they get now compound into a ceiling-busting season.",
                    urgency:"MAXIMIZE",urgencyColor:"#34d399"},
                  ELITE:{group:"gameplan",opt:"awareness",altGroups:["qb","dline"],altOpts:["awareness","passRush"],
                    coachLine:"All-Pro players need to stay sharp mentally. Elite film study keeps them reading the game a step ahead.",
                    subLine:"Don't just maintain â€” push the ceiling. All-Pro this week, Hall of Famer next year.",
                    urgency:"SUSTAIN PEAK",urgencyColor:"#fbbf24"},
                  SLUMP:{group:"qb",opt:"accuracy",altGroups:["skill","dline","secondary"],altOpts:["catching","passRush","coverage"],
                    coachLine:"SLUMP player needs focused reps on their core skill. Extra time in the film room and on the practice field breaks slumps.",
                    subLine:"The talent is still there. Repetition and focus rebuilds confidence. Assign the right training now.",
                    urgency:"BREAK THE SLUMP",urgencyColor:"#ef4444"},
                  COMEBACK:{group:"skill",opt:"speed",altGroups:["qb","dline","secondary"],altOpts:["arm","passRush","ballSkills"],
                    coachLine:"Comeback arc player needs physical reps to rebuild explosiveness. They're hungry â€” give them the work.",
                    subLine:"Redemption is earned on the practice field. Their hunger makes training 2x as effective right now.",
                    urgency:"FUEL REDEMPTION",urgencyColor:"#22d3ee"},
                  DECLINE:{group:"gameplan",opt:"awareness",altGroups:["oline","dline"],altOpts:["passBlock","runStop"],
                    coachLine:"Veteran in decline needs to play smarter, not harder. Film study and scheme mastery extends careers.",
                    subLine:"Brain over brawn at this stage. IQ training is the great equalizer for aging stars.",
                    urgency:"EXTEND CAREER",urgencyColor:"#94a3b8"},
                  HOLDOUT:{group:"gameplan",opt:"schemeInstall",altGroups:["qb","skill"],altOpts:["awareness","route"],
                    coachLine:"Contract drama is a distraction. Keep this player locked into scheme work so their focus stays on football.",
                    subLine:"Redirect the energy. Film room keeps chemistry stable while the front office handles negotiations.",
                    urgency:"REDIRECT FOCUS",urgencyColor:"#f97316"},
                  SWAN_SONG:{group:"gameplan",opt:"awareness",altGroups:["oline","secondary"],altOpts:["runBlock","coverage"],
                    coachLine:"This legend's final chapter deserves respect. Protect them with smart positional training â€” go out on top.",
                    subLine:"Let them control their legacy. Smart training, not grinding, gives legends their swan song moment.",
                    urgency:"GO OUT IN STYLE",urgencyColor:"#a855f7"},
                  MENTOR:{group:"gameplan",opt:"schemeInstall",altGroups:["qb","skill"],altOpts:["awareness","route"],
                    coachLine:"Mentor-arc vets are your coaching staff on the field. Scheme study maximizes their impact on young players.",
                    subLine:"Their value multiplies in the film room. What they teach during practice is as valuable as game reps.",
                    urgency:"MULTIPLIER MODE",urgencyColor:"#60a5fa"}
                };
                // Find all arc players on roster
                var arcPlayers21=safeRosterTrain.filter(function(p){return p&&p._arcState&&ARC_TRAIN_RECS[p._arcState];});
                if(arcPlayers21.length===0)return null;
                // For each arc player, figure out which group they're in + what the current training is
                function getPlayerGroup(p){
                  return TRAIN_GROUPS.find(function(grp){return grp.pos.indexOf(p.pos)>=0&&!grp.isGameplan;});
                }
                function getCurrentFocusForPlayer(p){
                  var grp=getPlayerGroup(p);if(!grp)return null;
                  var focusId=trainAssign[grp.id]||null;
                  if(!focusId)return null;
                  return grp.opts.find(function(o){return o.id===focusId;})||null;
                }
                // Separate into alert (mismatched or no training) vs momentum (positive arc + training active)
                var positiveArcs=["BREAKOUT","ELITE","COMEBACK"];
                var negativeArcs=["SLUMP","DECLINE","HOLDOUT","SWAN_SONG","MENTOR"];
                var alertPlayers=[];var momentumPlayers=[];
                arcPlayers21.forEach(function(p){
                  var grp=getPlayerGroup(p);
                  var hasFocus=grp&&(trainAssign[grp.id]||null);
                  var isPositive=positiveArcs.indexOf(p._arcState)>=0;
                  var isNegative=negativeArcs.indexOf(p._arcState)>=0;
                  if(isNegative||!hasFocus){alertPlayers.push(p);}
                  else if(isPositive&&hasFocus){momentumPlayers.push(p);}
                });
                var allArcInfos=arcPlayers21.map(function(p){
                  var arc=ARC_TRAIN_RECS[p._arcState];
                  var grp=getPlayerGroup(p);
                  var currentFocus=getCurrentFocusForPlayer(p);
                  var arcInfo=ARC_SPOTLIGHT.lines[p._arcState]||{};
                  return {p:p,arc:arc,grp:grp,currentFocus:currentFocus,arcInfo:arcInfo};
                });
                return <div style={{display:"flex",flexDirection:"column",gap:8,borderRadius:10,
                  background:"linear-gradient(135deg,rgba(99,102,241,0.08),rgba(16,185,129,0.04))",
                  border:"1px solid rgba(99,102,241,0.35)",padding:12}}>
                  {/* Header */}
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2}}>
                    <div style={{fontSize:14,fontWeight:900,color:"#a5b4fc",letterSpacing:0.5}}>
                      {"ðŸŽ™ï¸ ARC COACHING REPORT"}
                    </div>
                    <div style={{fontSize:9,color:"rgba(165,180,252,0.6)",letterSpacing:1,textTransform:"uppercase"}}>
                      {arcPlayers21.length+" arc player"+(arcPlayers21.length!==1?"s":"")+" on roster"}
                    </div>
                  </div>
                  {/* ALERT section â€” slump/negative arc players or no training assigned */}
                  {alertPlayers.length>0 && <div style={{background:"linear-gradient(135deg,rgba(239,68,68,0.12),rgba(239,68,68,0.04))",
                    border:"1px solid rgba(239,68,68,0.35)",borderRadius:8,padding:10}}>
                    <div style={{fontSize:9,letterSpacing:2,color:"#ef4444",fontWeight:900,marginBottom:6,textTransform:"uppercase"}}>
                      {"ðŸš¨ TRAINING PRIORITY ALERT â€” "+alertPlayers.length+" PLAYER"+(alertPlayers.length!==1?"S":"")+" NEED ATTENTION"}
                    </div>
                    {alertPlayers.map(function(p){
                      var arc=ARC_TRAIN_RECS[p._arcState];
                      var arcInfo=ARC_SPOTLIGHT.lines[p._arcState]||{};
                      var grp=getPlayerGroup(p);
                      var hasFocus=grp&&(trainAssign[grp.id]||null);
                      return <div key={p.id} style={{display:"flex",gap:8,alignItems:"flex-start",padding:"6px 0",
                        borderBottom:"1px solid rgba(239,68,68,0.15)"}}>
                        <div style={{minWidth:60,padding:"2px 6px",borderRadius:4,background:"rgba(239,68,68,0.15)",
                          border:"1px solid rgba(239,68,68,0.3)",textAlign:"center"}}>
                          <div style={{fontSize:8,color:"#ef4444",fontWeight:800}}>{arc.urgency}</div>
                        </div>
                        <div style={{flex:1}}>
                          <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:2}}>
                            <span style={{fontSize:11,fontWeight:800,color:"#fff"}}>{p.name}</span>
                            <span style={{fontSize:9,color:T.dim}}>{p.pos+" | OVR "+p.ovr}</span>
                            <span style={{fontSize:9,padding:"1px 5px",borderRadius:3,
                              background:"rgba(0,0,0,0.3)",color:arcInfo.badgeColor||"#fff",fontWeight:700}}>
                              {arcInfo.badge||p._arcState}
                            </span>
                          </div>
                          <div style={{fontSize:10,color:"rgba(239,68,68,0.9)",fontStyle:"italic",lineHeight:1.4,marginBottom:2}}>
                            {arc.coachLine}
                          </div>
                          {!hasFocus && <div style={{fontSize:9,color:"#f97316",fontWeight:700}}>
                            {"âš ï¸ No training assigned for "+(grp?grp.name:"this group")+" â€” assign one below!"}
                          </div>}
                          {hasFocus && <div style={{fontSize:9,color:T.dim}}>
                            {"ðŸ’¡ "+arc.subLine}
                          </div>}
                        </div>
                      </div>;
                    })}
                  </div>}
                  {/* MOMENTUM section â€” positive arc + active training */}
                  {momentumPlayers.length>0 && <div style={{background:"linear-gradient(135deg,rgba(16,185,129,0.10),rgba(16,185,129,0.03))",
                    border:"1px solid rgba(16,185,129,0.30)",borderRadius:8,padding:10}}>
                    <div style={{fontSize:9,letterSpacing:2,color:T.green,fontWeight:900,marginBottom:6,textTransform:"uppercase"}}>
                      {"ðŸ”¥ ARC MOMENTUM â€” "+momentumPlayers.length+" PLAYER"+(momentumPlayers.length!==1?"S":"")+" IN PEAK TRAINING MODE"}
                    </div>
                    {momentumPlayers.map(function(p){
                      var arc=ARC_TRAIN_RECS[p._arcState];
                      var arcInfo=ARC_SPOTLIGHT.lines[p._arcState]||{};
                      var currentFocus=getCurrentFocusForPlayer(p);
                      return <div key={p.id} style={{display:"flex",gap:8,alignItems:"flex-start",padding:"5px 0",
                        borderBottom:"1px solid rgba(16,185,129,0.12)"}}>
                        <div style={{minWidth:60,padding:"2px 6px",borderRadius:4,
                          background:"rgba(16,185,129,0.15)",border:"1px solid rgba(16,185,129,0.3)",textAlign:"center"}}>
                          <div style={{fontSize:8,color:T.green,fontWeight:800}}>{arc.urgency}</div>
                        </div>
                        <div style={{flex:1}}>
                          <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:2}}>
                            <span style={{fontSize:11,fontWeight:800,color:"#fff"}}>{p.name}</span>
                            <span style={{fontSize:9,color:T.dim}}>{p.pos+" | OVR "+p.ovr}</span>
                            <span style={{fontSize:9,padding:"1px 5px",borderRadius:3,
                              background:"rgba(0,0,0,0.3)",color:arcInfo.badgeColor||"#fff",fontWeight:700}}>
                              {arcInfo.badge||p._arcState}
                            </span>
                            {currentFocus && <span style={{fontSize:9,color:T.cyan}}>{"âœ… Training: "+currentFocus.name}</span>}
                          </div>
                          <div style={{fontSize:10,color:"rgba(16,185,129,0.9)",fontStyle:"italic",lineHeight:1.4}}>
                            {arc.subLine}
                          </div>
                        </div>
                      </div>;
                    })}
                  </div>}
                  {/* Full arc player coaching cards */}
                  <div style={{fontSize:9,letterSpacing:2,color:"rgba(165,180,252,0.7)",fontWeight:700,textTransform:"uppercase",marginTop:2}}>
                    {"ðŸ“‹ COACHING BREAKDOWN"}
                  </div>
                  <div style={{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:6}}>
                    {allArcInfos.slice(0,6).map(function(info){
                      var p=info.p;var arc=info.arc;var arcInfo=info.arcInfo;var currentFocus=info.currentFocus;var grp=info.grp;
                      var urgColor=arc.urgencyColor||"#a5b4fc";
                      var firstName=p.name?p.name.split(" ")[0]:p.name;
                      return <div key={p.id} style={{background:"rgba(0,0,0,0.25)",borderRadius:8,padding:8,
                        border:"1px solid rgba(255,255,255,0.07)"}}>
                        <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:4}}>
                          <div>
                            <div style={{fontSize:11,fontWeight:800,color:"#fff"}}>{firstName}</div>
                            <div style={{fontSize:9,color:T.dim}}>{p.pos+" | "+p.age+"yr | OVR "+p.ovr}</div>
                          </div>
                          <div style={{textAlign:"right"}}>
                            <div style={{fontSize:8,padding:"1px 5px",borderRadius:3,
                              background:"rgba(0,0,0,0.4)",color:arcInfo.badgeColor||urgColor,fontWeight:800,whiteSpace:"nowrap"}}>
                              {arcInfo.badge||p._arcState}
                            </div>
                          </div>
                        </div>
                        <div style={{fontSize:8,color:urgColor,fontWeight:800,textTransform:"uppercase",marginBottom:3,letterSpacing:0.5}}>
                          {"ðŸ“£ "+arc.urgency}
                        </div>
                        <div style={{fontSize:9,color:T.dim,lineHeight:1.4,marginBottom:4}}>
                          {arc.coachLine}
                        </div>
                        {currentFocus
                          ? <div style={{fontSize:8,padding:"2px 6px",borderRadius:4,display:"inline-block",
                              background:"rgba(16,185,129,0.12)",border:"1px solid rgba(16,185,129,0.25)",color:T.green}}>
                              {"âœ… Active: "+(grp?grp.name:"") +" â†’ "+currentFocus.name}
                            </div>
                          : <div style={{fontSize:8,padding:"2px 6px",borderRadius:4,display:"inline-block",
                              background:"rgba(239,68,68,0.10)",border:"1px solid rgba(239,68,68,0.25)",color:"#ef4444"}}>
                              {"âš ï¸ No training assigned"+(grp?" for "+grp.name:"")}
                            </div>
                        }
                      </div>;
                    })}
                  </div>
                  <div style={{fontSize:9,color:"rgba(165,180,252,0.4)",textAlign:"center",marginTop:2,fontStyle:"italic"}}>
                    {"Arc coaching intel powered by MFSN Analytics â€” assign training below to act on these recommendations"}
                  </div>
                </div>;
              })()}
              {TRAIN_GROUPS.map(function(grp){
                var players=safeRosterTrain.filter(function(p){return grp.pos.indexOf(p.pos)>=0;});
                var starters2=players.filter(function(p){return p.isStarter;});
                var injured2=players.filter(function(p){return p.injury&&p.injury.games>0;}).length;
                var currentFocus=trainAssign[grp.id]||null;
                var currentOpt=currentFocus?grp.opts.find(function(o){return o.id===currentFocus;}):null;
                var focusAvg=currentOpt&&starters2.length>0?Math.round(avg(starters2,function(p){return p.ratings[currentOpt.attr]||50;})):0;
                return <div key={grp.id} style={assign({},cS,{padding:0,overflow:"hidden",
                  borderColor:currentFocus?T.green:T.border})}>
                  
                  <div style={{padding:"10px 12px",background:currentFocus?"rgba(16,185,129,0.04)":"rgba(255,255,255,0.02)",
                    borderBottom:"1px solid "+T.border,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <div style={{display:"flex",gap:8,alignItems:"center"}}>
                      <span style={{fontSize:20}}>{grp.icon}</span>
                      <div>
                        <div style={{fontWeight:800,fontSize:13}}>{grp.name}</div>
                        <div style={{fontSize:10,color:T.dim}}>{players.length+" players | "+starters2.length+" starters"+(injured2>0?" | "+injured2+" hurt":"")}</div>
                      </div>
                    </div>
                    {currentFocus?<div style={{textAlign:"right"}}>
                      <div style={{fontSize:9,color:T.faint}}>{"TRAINING"}</div>
                      <div style={{fontSize:12,fontWeight:700,color:T.green}}>{currentOpt?currentOpt.name:"â€”"}</div>
                      {focusAvg>0 && <div style={{fontSize:9,color:T.dim}}>{"Starter avg: "+focusAvg}</div>}
                    </div>:<div style={{fontSize:10,color:T.orange,fontWeight:600}}>{"âš ï¸ No focus set"}</div>}
                  </div>
                  
                  <div style={{padding:"8px 12px"}}>
                    <div style={{display:"grid",gridTemplateColumns:"repeat("+Math.min(grp.opts.length,4)+",1fr)",gap:6}}>
                      {grp.opts.map(function(opt){
                        var isActive=currentFocus===opt.id;
                        var attrAvg=starters2.length>0?Math.round(avg(starters2,function(p){return p.ratings[opt.attr]||50;})):0;
                        var attrColor=attrAvg>=80?T.green:attrAvg>=65?T.gold:attrAvg>=50?T.orange:T.red;
                        var gymLvlCard=my&&my.facilities?my.facilities.gym||0:0;
                        var gymBonCard=gymLvlCard*0.4;
                        var isGameplanOpt=grp.isGameplan||false;
                        var hasMulti=opt.multiAttr&&opt.multiAttr.length>0;
                        var gainMin=Math.round(gymBonCard);var gainMax=Math.round(2+gymBonCard);
                        var projLabel=hasMulti
                          ?"+"+(Math.max(0,Math.floor(gainMin*0.6)))+"-"+(Math.max(1,Math.floor(gainMax*0.6)))+" ea."
                          :"+"+gainMin+(gainMin!==gainMax?"-"+gainMax:"")+" / wk";
                        var decayAttrs=(!isGameplanOpt&&POS_DEF[grp.pos[0]])
                          ?POS_DEF[grp.pos[0]].r.filter(function(r){return r!==opt.attr;}).slice(0,2):[];
                        return <div key={opt.id} onClick={function(){
                          setTrainAssign(function(prev){
                            var n2=assign({},prev);
                            if(n2[grp.id]===opt.id)delete n2[grp.id];// Toggle off
                            else n2[grp.id]=opt.id;
                            return n2;
                          });}}
                          style={{background:isActive?"rgba(16,185,129,0.12)":"rgba(255,255,255,0.03)",
                            border:"2px solid "+(isActive?T.green:T.border),borderRadius:8,padding:"8px 6px",
                            cursor:"pointer",textAlign:"center",transition:"all 0.15s"}}>
                          <div style={{fontSize:18,fontWeight:900,color:attrColor}}>{attrAvg}</div>
                          <div style={{fontSize:10,fontWeight:isActive?800:600,color:isActive?T.green:T.text,marginTop:2}}>{opt.name}</div>
                          <div style={{fontSize:8,color:T.faint,marginTop:1}}>{opt.desc}</div>
                          <div style={{fontSize:8,fontWeight:700,color:T.cyan,marginTop:3,padding:"1px 4px",
                            background:"rgba(96,165,250,0.12)",borderRadius:4,display:"inline-block"}}>{projLabel}</div>
                          {!isGameplanOpt&&decayAttrs.length>0&&(
                            <div style={{fontSize:7,color:isActive?T.orange:T.faint,marginTop:2}}>
                              {"âš ï¸ -1/wk: "+(decayAttrs.map(function(a){return RATING_LABELS[a]||a;}).join(", "))}
                            </div>
                          )}
                          {isGameplanOpt&&<div style={{fontSize:7,color:T.purple,marginTop:2}}>{"ðŸ§  No phys. decay"}</div>}
                          {isGameplanOpt&&opt.schemeDesc&&(
                            <div style={{fontSize:7,color:"rgba(168,85,247,0.7)",marginTop:2,lineHeight:1.3,textAlign:"left"}}>{opt.schemeDesc}</div>
                          )}
                          {isActive && <div style={{fontSize:8,color:T.green,fontWeight:700,marginTop:3}}>{"âœ… ACTIVE"}</div>}
                        </div>;
                      })}
                    </div>
                    
                    <div style={{marginTop:8}}>
                      <div style={{fontSize:9,color:T.faint,fontWeight:700,marginBottom:4}}>{"ROSTER"}</div>
                      {players.sort(function(a,b){return b.ovr-a.ovr;}).slice(0,5).map(function(p){
                        var focusVal=currentOpt?p.ratings[currentOpt.attr]||50:0;
                        var isInj=p.injury&&p.injury.games>0;
                        var gymLvlRow=my&&my.facilities?my.facilities.gym||0:0;
                        var baseGainMax=2+gymLvlRow*0.4;
                        var pGainMax=baseGainMax*(p.devTrait==="superstar"?1.5:p.devTrait==="star"?1.25:1)*(p.age>30?0.5:1);
                        var pGainLabel=isInj?"ðŸ¤• No train":"+0-"+Math.round(pGainMax)+(p.age>30?" (vet)":"");
                        var pGainColor=isInj?T.faint:p.devTrait==="superstar"?T.gold:T.cyan;
                        return <div key={p.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",
                          padding:"3px 0",borderBottom:"1px solid "+T.border,fontSize:10,opacity:isInj?0.5:1,
                          cursor:"pointer"}} onClick={function(){setPlayerDetail(p);}}>
                          <div style={{display:"flex",gap:6,alignItems:"center"}}>
                            <span style={{color:T.gold,fontWeight:700,width:22}}>{p.pos}</span>
                            <span style={{fontWeight:p.isStarter?700:400}}>{p.name}</span>
                            {isInj && <span style={{color:T.red,fontSize:8}}>{"ðŸ¤•"}</span>}
                            {p.devTrait==="superstar" && <span style={{fontSize:8}}>{"ðŸŒŸ"}</span>}
                            {p.devTrait==="star" && <span style={{fontSize:8}}>{"â­"}</span>}
                          </div>
                          <div style={{display:"flex",gap:6,alignItems:"center"}}>
                            {currentOpt && <span style={{fontSize:10,fontWeight:700,
                              color:focusVal>=80?T.green:focusVal>=65?T.gold:T.red}}>
                              {(RATING_LABELS[currentOpt.attr]||currentOpt.name.split(" ")[0])+": "+focusVal}</span>}
                            <span style={{fontSize:8,color:pGainColor,fontWeight:600}}>{pGainLabel}</span>
                            <span style={oS(p.ovr)}>{p.ovr}</span>
                          </div>
                        </div>;
                      })}
                    </div>
                  </div>
                </div>;
              })}
              
              <div style={assign({},cS,{background:"rgba(212,167,75,0.04)",borderColor:T.gold})}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:6}}>{"ðŸ“‹ TRAINING SUMMARY"}</div>
                <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
                  {TRAIN_GROUPS.map(function(grp){
                    var focus=trainAssign[grp.id];
                    var opt=focus?grp.opts.find(function(o){return o.id===focus;}):null;
                    return <div key={grp.id} style={{display:"flex",alignItems:"center",gap:4,padding:"4px 8px",
                      borderRadius:6,background:focus?"rgba(16,185,129,0.1)":"rgba(255,255,255,0.05)",
                      border:"1px solid "+(focus?T.green:T.border),fontSize:10}}>
                      <span>{grp.icon}</span>
                      <span style={{fontWeight:600,color:focus?T.green:T.faint}}>{focus?opt.name:"None"}</span>
                    </div>;
                  })}
                </div>
                <div style={{fontSize:9,color:T.dim,marginTop:6}}>
                  {"Training applies each week during the season. Gym level "+gymLvl2+" adds +"+((gymLvl2*0.4).toFixed(1))+" to weekly gains."}
                </div>
              </div>
            </div>;
          })()}
          
          {tab==="chemistry" && (function(){
            var roster2=my.roster;var avgMorale=Math.round(avg(roster2,function(p){return p.morale||70;}));
            var veterans=roster2.filter(function(p){return p.age>=28;}).length;
            var youngGuns=roster2.filter(function(p){return p.age<=23;}).length;
            var superstars=roster2.filter(function(p){return p.devTrait==="superstar";}).length;
            var locker=roster2.filter(function(p){return hasTrait95(p,"captain")||hasTrait95(p,"vocal_leader");}).length;// v95.6: fixed "leader"â†’captain/vocal_leader + hasTrait95
            var cancers=roster2.filter(function(p){return hasTrait95(p,"cancer")||hasTrait95(p,"holdout");}).length;// v95.6: was "holdout" only, now cancer+holdout + hasTrait95
            var loyals=roster2.filter(function(p){return hasTrait95(p,"loyal");}).length;// v95.6: hasTrait95
            var chemScore=Math.min(99,Math.max(1,avgMorale+locker*5-cancers*8+loyals*2+Math.min(veterans,5)*2-Math.max(0,youngGuns-8)*2+superstars*3));
            var grade=chemScore>=90?"A+":chemScore>=80?"A":chemScore>=70?"B":chemScore>=60?"C":chemScore>=50?"D":"F";
            // Crisis pulse: detect active locker room risks
            var hasCrisisActive=crisisRoom!=null;
            var hasStarDispute=roster2.some(function(p){return p.contractDispute&&p.ovr>=82;});
            var hasCancer=roster2.some(function(p){return hasTrait95(p,"cancer")&&(p.chemistry||60)<35;});// v95.6: hasTrait95
            var hasTradeBlock=roster2.some(function(p){return p.onBlock&&p.ovr>=80;});
            var crisisCount=[hasCrisisActive,hasStarDispute,hasCancer,hasTradeBlock].filter(Boolean).length;
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:700}}>{"ðŸ§¬ Locker Room Chemistry"}</div>
              {/* â”€â”€ Crisis Banner â”€â”€ */}
              {crisisCount>0 && <div style={{background:"linear-gradient(135deg,rgba(239,68,68,0.15),rgba(239,68,68,0.04))",border:"1px solid rgba(239,68,68,0.4)",borderRadius:8,padding:"10px 12px"}}>
                <div style={{fontSize:9,letterSpacing:2,color:"#ef4444",fontWeight:900,marginBottom:4,textTransform:"uppercase"}}>
                  {"ðŸš¨ "+crisisCount+" ACTIVE LOCKER ROOM RISK"+(crisisCount>1?"S":"")}
                </div>
                <div style={{display:"flex",flexDirection:"column",gap:3}}>
                  {hasCrisisActive && <div style={{fontSize:10,color:T.text}}>{"âš¡ "+crisisRoom.headline+" â€” decision pending (check popup)"}</div>}
                  {hasStarDispute && <div style={{fontSize:10,color:T.gold}}>{"ðŸ’° Star demanding extension â€” chemistry dropping until resolved"}</div>}
                  {hasCancer && <div style={{fontSize:10,color:"#ef4444"}}>{"â˜¢ï¸ Locker room cancer below threshold â€” consider cut or meeting"}</div>}
                  {hasTradeBlock && <div style={{fontSize:10,color:"#f97316"}}>{"ðŸ“¦ Franchise player on trade block â€” team morale at risk"}</div>}
                </div>
                {hasCrisisActive && <button onClick={function(){/* crisisRoom state already visible */}} style={{marginTop:6,fontSize:9,padding:"3px 8px",background:"#ef4444",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:700}}>
                  {"â†’ Crisis Awaiting Decision"}
                </button>}
              </div>}
              <div style={cS}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                  <div style={{fontSize:48,fontWeight:900,color:chemScore>=80?T.green:chemScore>=60?T.gold:T.red}}>{grade}</div>
                  <div style={{textAlign:"right"}}>
                    <div style={{fontSize:24,fontWeight:800}}>{chemScore}</div>
                    <div style={{fontSize:10,color:T.faint}}>{"Chemistry Score"}</div>
                    {chemScore<60 && <div style={{fontSize:9,color:"#ef4444",marginTop:2}}>{"âš ï¸ Crisis threshold"}</div>}
                    {chemScore>=85 && <div style={{fontSize:9,color:T.green,marginTop:2}}>{"âœ… Elite locker room"}</div>}
                  </div>
                </div>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6}}>
                {[{label:"Avg Morale",val:avgMorale,color:avgMorale>=70?T.green:T.red},
                  {label:"Leaders",val:locker,color:T.cyan},{label:"Holdouts",val:cancers,color:cancers>0?T.red:T.green},
                  {label:"Loyals",val:loyals,color:T.green},{label:"Veterans",val:veterans,color:T.dim},
                  {label:"Young Guns",val:youngGuns,color:T.gold},{label:"Superstars",val:superstars,color:T.purple},
                  {label:"Avg Age",val:Math.round(avg(roster2,function(p){return p.age;})*10)/10,color:T.dim},
                  {label:"Injured",val:roster2.filter(function(p){return p.injury&&p.injury.games>0;}).length,color:T.red}
                ].map(function(s2){return <div key={s2.label} style={{background:T.bg3,borderRadius:6,padding:8,textAlign:"center"}}>
                  <div style={{fontSize:18,fontWeight:800,color:s2.color}}>{s2.val}</div>
                  <div style={{fontSize:9,color:T.faint}}>{s2.label}</div>
                </div>;})}
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.cyan,marginBottom:6}}>{"ðŸ‘¥ CLIQUE BREAKDOWN"}</div>
                {(function(){
                  var cliques={0:{name:"Unaffiliated",icon:"ðŸ‘¤",members:[]},1:{name:"Veterans",icon:"ðŸŽ–ï¸",members:[]},
                    2:{name:"Stars",icon:"â­",members:[]},3:{name:"Young Core",icon:"ðŸŒ±",members:[]},
                    4:{name:"Role Players",icon:"ðŸ”§",members:[]}};
                  roster2.forEach(function(p){
                    var cId=p.cliqueId||0;
                    if(!cliques[cId])cliques[cId]={name:"Clique "+cId,icon:"ðŸ‘¥",members:[]};
                    cliques[cId].members.push(p);
                  });
                  return Object.keys(cliques).filter(function(k){return cliques[k].members.length>0;}).map(function(k){
                    var c=cliques[k];
                    var avgChem=Math.round(c.members.reduce(function(s,p){return s+(p.chemistry||60);},0)/c.members.length);
                    var avgMor=Math.round(c.members.reduce(function(s,p){return s+(p.morale||70);},0)/c.members.length);
                    var leader=c.members.slice().sort(function(a,b){return b.ovr-a.ovr;})[0];
                    return React.createElement("div",{key:k,style:{background:T.bg3,borderRadius:6,padding:"8px 10px",marginBottom:4,
                      border:"1px solid "+(avgChem>=70?T.green+"33":avgChem>=50?T.gold+"33":T.red+"33")}},
                      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                        React.createElement("div",{style:{fontWeight:700,fontSize:11}},c.icon+" "+c.name+" ("+c.members.length+")"),
                        React.createElement("div",{style:{display:"flex",gap:8}},
                          React.createElement("span",{style:{fontSize:10,color:avgChem>=70?T.green:avgChem>=50?T.gold:T.red}},
                            "Chem: "+avgChem),
                          React.createElement("span",{style:{fontSize:10,color:avgMor>=70?T.green:T.red}},
                            "Morale: "+avgMor)
                        )
                      ),
                      React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:2}},
                        "Leader: "+leader.name+" ("+leader.pos+" "+leader.ovr+")")
                    );
                  });
                })()}
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:6}}>
                  {"âš¡ LOCKER ROOM ACTIONS ("+Math.max(0,2-chemActions)+"/2 remaining this week)"}
                </div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                  {[
                    {id:"team_dinner",name:"Team Dinner",icon:"ðŸ½ï¸",desc:"+3 chemistry for all players",cost:0,
                      apply:function(r){r.forEach(function(p){p.chemistry=cl((p.chemistry||60)+3,15,100);p.morale=cl((p.morale||70)+1,15,100);});}},
                    {id:"film_session",name:"Extra Film Session",icon:"ðŸ“º",desc:"+2 chemistry for starters, +5 awareness",cost:0,
                      apply:function(r){r.forEach(function(p){if(p.isStarter){p.chemistry=cl((p.chemistry||60)+2,15,100);p.ratings.awareness=cl((p.ratings.awareness||50)+1,35,99);}});}},
                    {id:"players_only",name:"Players-Only Meeting",icon:"ðŸ—£ï¸",desc:"+5 chemistry for lowest morale clique",cost:0,
                      apply:function(r){
                        var cliques={};r.forEach(function(p){var c=p.cliqueId||0;if(!cliques[c])cliques[c]=[];cliques[c].push(p);});
                        var lowest=null;var lowestMor=999;
                        Object.keys(cliques).forEach(function(k){var avg2=cliques[k].reduce(function(s,p){return s+(p.morale||70);},0)/cliques[k].length;if(avg2<lowestMor){lowestMor=avg2;lowest=k;}});
                        if(lowest!=null)cliques[lowest].forEach(function(p){p.chemistry=cl((p.chemistry||60)+5,15,100);p.morale=cl((p.morale||70)+2,15,100);});
                      }},
                    {id:"star_spotlight",name:"Star Player Spotlight",icon:"ðŸŒŸ",desc:"+8 chemistry for superstars, -1 for role players",cost:0,
                      apply:function(r){r.forEach(function(p){
                        if(p.devTrait==="superstar"){p.chemistry=cl((p.chemistry||60)+8,15,100);p.morale=cl((p.morale||70)+3,15,100);}
                        else if(p.ovr<70){p.chemistry=cl((p.chemistry||60)-1,15,100);}
                      });}},
                    {id:"community_event",name:"Community Event",icon:"ðŸ˜ï¸",desc:"+2 chemistry & +2 morale for whole roster",cost:0,
                      apply:function(r){r.forEach(function(p){p.chemistry=cl((p.chemistry||60)+2,15,100);p.morale=cl((p.morale||70)+2,15,100);});}},
                    {id:"position_bonding",name:"Position Group Bonding",icon:"ðŸ¤",desc:"+6 chemistry within position groups",cost:0,
                      apply:function(r){
                        var groups={};r.forEach(function(p){if(!groups[p.pos])groups[p.pos]=[];groups[p.pos].push(p);});
                        Object.keys(groups).forEach(function(pos){if(groups[pos].length>=2)groups[pos].forEach(function(p){p.chemistry=cl((p.chemistry||60)+6,15,100);});});
                      }}
                  ].map(function(action){
                    var canAct=chemActions<2;
                    return React.createElement("button",{key:action.id,disabled:!canAct,
                      style:{background:canAct?T.bg3:"rgba(255,255,255,0.02)",border:"1px solid "+(canAct?T.gold+"44":T.border),
                        borderRadius:6,padding:"8px 10px",cursor:canAct?"pointer":"not-allowed",textAlign:"left"},
                      onClick:function(){
                        if(!canAct)return;
                        var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
                        if(!u2||!u2.roster)return;
                        action.apply(u2.roster);
                        u2.roster.forEach(function(p){p.ovr=calcOvr(p);});
                        setTeams(nt);
                        setChemActions(chemActions+1);
                        addN(action.icon+" "+action.name+" â€” "+action.desc,"green");
                        doSave(nt);
                      }},
                      React.createElement("div",{style:{fontWeight:700,fontSize:11,color:canAct?T.gold:T.faint}},action.icon+" "+action.name),
                      React.createElement("div",{style:{fontSize:9,color:canAct?T.dim:T.faint,marginTop:2}},action.desc)
                    );
                  })}
                </div>
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.purple,marginBottom:6}}>{"ðŸ“‹ PLAYER CHEMISTRY DETAILS"}</div>
                <div style={{maxHeight:300,overflowY:"auto"}}>
                  {roster2.slice().sort(function(a,b){return(a.chemistry||60)-(b.chemistry||60);}).map(function(p){
                    var chem=p.chemistry||60;var mor=p.morale||70;
                    var chemColor=chem>=80?T.green:chem>=60?T.gold:chem>=40?T.orange:T.red;
                    var morColor=mor>=70?T.green:mor>=50?T.gold:T.red;
                    var traits97=[];
                    if(hasTrait95(p,"captain"))traits97.push("ðŸŽ–ï¸ Captain");
                    if(hasTrait95(p,"vocal_leader"))traits97.push("ðŸ“¢ Leader");
                    if(hasTrait95(p,"cancer"))traits97.push("â˜¢ï¸ Cancer");
                    if(hasTrait95(p,"loyal"))traits97.push("ðŸ’š Loyal");
                    if(hasTrait95(p,"holdout"))traits97.push("ðŸ’° Holdout");
                    if(hasTrait95(p,"mentor"))traits97.push("ðŸ§‘â€ðŸ« Mentor");
                    return React.createElement("div",{key:p.id,style:{display:"flex",justifyContent:"space-between",
                      alignItems:"center",padding:"4px 8px",borderBottom:"1px solid "+T.border,fontSize:11}},
                      React.createElement("div",{style:{flex:1}},
                        React.createElement("span",{style:{fontWeight:600}},p.name),
                        React.createElement("span",{style:{color:T.dim,marginLeft:4}},p.pos+" "+p.ovr),
                        traits97.length>0?React.createElement("span",{style:{marginLeft:4,fontSize:8}},traits97.join(" ")):null
                      ),
                      React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center"}},
                        React.createElement("div",{style:{textAlign:"center",width:40}},
                          React.createElement("div",{style:{fontSize:12,fontWeight:700,color:chemColor}},chem),
                          React.createElement("div",{style:{fontSize:7,color:T.faint}},"CHEM")),
                        React.createElement("div",{style:{textAlign:"center",width:40}},
                          React.createElement("div",{style:{fontSize:12,fontWeight:700,color:morColor}},mor),
                          React.createElement("div",{style:{fontSize:7,color:T.faint}},"MOR")),
                        React.createElement("div",{style:{width:50,height:6,background:T.bg3,borderRadius:3,overflow:"hidden"}},
                          React.createElement("div",{style:{width:chem+"%",height:"100%",background:chemColor,borderRadius:3}}))
                      )
                    );
                  })}
                </div>
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.green,marginBottom:6}}>{"ðŸ“Š CHEMISTRY IMPACT"}</div>
                <div style={{fontSize:10,color:T.dim,marginBottom:6}}>
                  {"Chemistry affects in-game performance: coordination, morale-based clutch moments, and scheme execution."}
                </div>
                {(function(){
                  var chemMod2=chemistryMod(my);
                  var items971=[
                    {label:"Game Performance Mod",val:(chemMod2>=0?"+":"")+chemMod2.toFixed(1)+"%",
                      color:chemMod2>=0?T.green:T.red,
                      desc:"Applied to team OVR in simulations"},
                    {label:"Clutch Factor",val:chemScore>=80?"Elite":chemScore>=60?"Average":"Weak",
                      color:chemScore>=80?T.green:chemScore>=60?T.dim:T.red,
                      desc:"Likelihood of 4th-quarter comebacks"},
                    {label:"Injury Resilience",val:chemScore>=75?"+10%":"â€”",
                      color:chemScore>=75?T.green:T.dim,
                      desc:"High chemistry = slightly fewer soft-tissue injuries"},
                    {label:"Scheme Execution",val:chemScore>=70?"Tight":"Loose",
                      color:chemScore>=70?T.green:T.red,
                      desc:"How well plays are executed as drawn up"}
                  ];
                  return React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}},
                    items971.map(function(it){return React.createElement("div",{key:it.label,
                      style:{background:T.bg3,borderRadius:6,padding:8}},
                      React.createElement("div",{style:{fontSize:12,fontWeight:800,color:it.color}},it.val),
                      React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.text}},it.label),
                      React.createElement("div",{style:{fontSize:8,color:T.faint}},it.desc)
                    );})
                  );
                })()}
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:6}}>{"MORALE WATCH"}</div>
                {roster2.filter(function(p){return(p.morale||70)<50;}).sort(function(a,b){return(a.morale||70)-(b.morale||70);}).slice(0,5).map(function(p){
                  return <div key={p.id} style={{display:"flex",justifyContent:"space-between",padding:"3px 0",borderBottom:"1px solid "+T.border,fontSize:11}}>
                    <span>{p.name+" ("+p.pos+")"}</span>
                    <span style={{color:T.red,fontWeight:700}}>{(p.morale||70)+" ðŸ˜¤"}</span>
                  </div>;
                })}
                {roster2.filter(function(p){return(p.morale||70)<50;}).length===0 && <div style={{color:T.green,fontSize:11}}>{"âœ… No unhappy players!"}</div>}
              </div>
            </div>;
          })()}
          
          {tab==="injuries" && (function(){
            var safeRosterInj=(my&&my.roster||[]).filter(Boolean);
            var hurt=safeRosterInj.filter(function(p){return p.injury&&p.injury.games>0;}).sort(function(a,b){return b.ovr-a.ovr;});
            var healthy=safeRosterInj.length-hurt.length;
            // INJURY_INTEL v22: Cinematic injury command center
            var INJTL_LINES={
              star_arc_hurt:[
                "This is the worst possible time for {name} to go down. The {arc} arc was just getting started â€” now the whole season narrative shifts.",
                "{name} was becoming one of the most exciting stories in the league. A {inj} is a gut punch. The arc doesn't stop â€” but it's on pause.",
                "Every dynasty has setbacks. {name} going down mid-{arc} arc is yours. How you respond defines this season.",
                "You cannot script a more painful storyline. {name} on a {arc} arc and now this. The comeback from the comeback starts now."
              ],
              star_no_arc:[
                "Losing a player of {name}'s caliber ({pos}, OVR {ovr}) is never a one-week problem. Depth is being tested right now.",
                "{name} is one of your best â€” and they're out with {inj}. The rest of the roster needs to step up. This is where seasons are made or broken.",
                "OVR {ovr} doesn't grow on trees. {name} is out. Someone has to fill that void. The injury report just became the most important document in your building."
              ],
              depth_hit:[
                "It's not always the star that gets you â€” it's the depth. {name} coming off the field means someone needs to step up.",
                "{name} ({pos}, OVR {ovr}) hurts the rotation. Not a crisis â€” but the margin for error just shrunk.",
                "Injury depth test: {name} is out. Who steps up? Right now, that answer determines your season."
              ],
              full_health:[
                "Full health heading into the week. That's an advantage most teams don't have. Use it.",
                "No injury report worth talking about. This is the window â€” healthy roster, clear path. Go take it.",
                "Clean bill of health across the board. Your medical staff is earning their paychecks. Now go win a game."
              ]
            };
            function pickInj22(pool,p,arcKey){
              var line=pool[Math.floor(RNG.ui()*pool.length)];
              return line.replace(/\{name\}/g,p?p.name:"").replace(/\{pos\}/g,p?p.pos:"").replace(/\{ovr\}/g,p?(p.ovr||0):"").replace(/\{arc\}/g,arcKey?(arcKey.toLowerCase().replace(/_/g," ")):"").replace(/\{inj\}/g,p&&p.injury?(p.injury.type||"injury"):"injury");
            }
            // Headline injury player + analyst line
            var arcHurt22=hurt.filter(function(p){return p._arcState&&["BREAKOUT","ELITE","COMEBACK","SWAN_SONG"].indexOf(p._arcState)>=0;});
            var starHurt22=hurt.filter(function(p){return p.ovr>=80;});
            var headline22=arcHurt22.length>0?arcHurt22[0]:starHurt22.length>0?starHurt22[0]:hurt.length>0?hurt[0]:null;
            var analystArc22=headline22&&headline22._arcState?headline22._arcState:null;
            var analystLine22="";
            if(hurt.length===0){analystLine22=pickInj22(INJTL_LINES.full_health,null,null);}
            else if(headline22&&analystArc22&&["BREAKOUT","ELITE","COMEBACK","SWAN_SONG"].indexOf(analystArc22)>=0){analystLine22=pickInj22(INJTL_LINES.star_arc_hurt,headline22,analystArc22);}
            else if(headline22&&(headline22.ovr||0)>=80){analystLine22=pickInj22(INJTL_LINES.star_no_arc,headline22,null);}
            else if(headline22){analystLine22=pickInj22(INJTL_LINES.depth_hit,headline22,null);}
            // Position group depth impact
            var POS_GRPS22=[
              {label:"QB",pos:["QB"],icon:"ðŸŽ¯"},
              {label:"Skill",pos:["RB","WR","TE"],icon:"âš¡"},
              {label:"O-Line",pos:["OL"],icon:"ðŸ—ï¸"},
              {label:"Front 7",pos:["DL","LB"],icon:"ðŸ¦¬"},
              {label:"Secondary",pos:["CB","S"],icon:"ðŸ›¡ï¸"},
              {label:"K/P",pos:["K","P"],icon:"ðŸ¦µ"}
            ];
            var depthGrid22=POS_GRPS22.map(function(grp){
              var grpAll=safeRosterInj.filter(function(p){return grp.pos.indexOf(p.pos)>=0;});
              var grpSt=grpAll.filter(function(p){return p.isStarter;});
              var grpHt=grpSt.filter(function(p){return p.injury&&p.injury.games>0;});
              var backups=grpAll.filter(function(p){return !p.isStarter&&!(p.injury&&p.injury.games>0);}).sort(function(a,b){return b.ovr-a.ovr;});
              var pct22=grpSt.length>0?Math.round((grpHt.length/grpSt.length)*100):0;
              var lbl=pct22>=100?"DECIMATED":pct22>=67?"CRITICAL":pct22>=33?"WEAKENED":pct22>0?"DENTED":"HEALTHY";
              var col=pct22>=100?"#ef4444":pct22>=67?"#f97316":pct22>=33?"#fbbf24":pct22>0?"#a3e635":T.green;
              return {grp:grp,pct:pct22,lbl:lbl,col:col,hurtN:grpHt.length,stN:grpSt.length,topBack:backups[0]||null};
            }).filter(function(d){return d.stN>0;});
            var anyHurt22=depthGrid22.some(function(d){return d.hurtN>0;});
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              {/* Header */}
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div style={{fontWeight:700}}>{"ðŸ¥ Injury Command Center"}</div>
                <div style={{fontSize:11,fontWeight:700,color:hurt.length>3?T.red:hurt.length>0?T.orange:T.green}}>
                  {healthy+" healthy"+(hurt.length>0?" | "+hurt.length+" injured":"")}
                </div>
              </div>
              {/* MFSN Analyst take */}
              <div style={{background:"linear-gradient(135deg,rgba(99,102,241,0.10),rgba(99,102,241,0.03))",
                border:"1px solid rgba(99,102,241,0.30)",borderRadius:8,padding:10}}>
                <div style={{fontSize:9,letterSpacing:2,color:"#a5b4fc",fontWeight:900,marginBottom:5,textTransform:"uppercase"}}>
                  {"ðŸ“º MFSN INJURY ANALYST"}
                </div>
                <div style={{fontSize:11,color:"#e0e7ff",fontStyle:"italic",lineHeight:1.5}}>{"\u201C"+analystLine22+"\u201D"}</div>
                {headline22&&hurt.length>0&&<div style={{fontSize:9,color:"rgba(165,180,252,0.55)",marginTop:5}}>
                  {"Headline: "+headline22.name+" ("+headline22.pos+", OVR "+(headline22.ovr||0)+")"
                    +(analystArc22?(" â€” "+(ARC_SPOTLIGHT.lines[analystArc22]||{badge:analystArc22}).badge+" arc"):"")
                  }
                </div>}
              </div>
              {/* Arc player injury crisis */}
              {arcHurt22.length>0&&<div style={{background:"linear-gradient(135deg,rgba(239,68,68,0.13),rgba(239,68,68,0.04))",
                border:"1px solid rgba(239,68,68,0.40)",borderRadius:8,padding:10}}>
                <div style={{fontSize:9,letterSpacing:2,color:"#ef4444",fontWeight:900,marginBottom:6,textTransform:"uppercase"}}>
                  {"ðŸš¨ ARC PLAYER INJURY CRISIS â€” "+arcHurt22.length+" PLAYER"+(arcHurt22.length!==1?"S":"")+" DOWN"}
                </div>
                {arcHurt22.map(function(p){
                  var msk=getInjuryMask92(p,my);var aI=ARC_SPOTLIGHT.lines[p._arcState]||{};
                  var tw=typeof p._trueInjuryWeeks==="number"?p._trueInjuryWeeks:(p.injury.games||0);
                  var rp=tw>0?Math.max(0,Math.round((1-(p.injury.games/tw))*100)):100;
                  return <div key={p.id} style={{display:"flex",gap:8,alignItems:"center",padding:"5px 0",borderBottom:"1px solid rgba(239,68,68,0.12)"}}>
                    {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:26,age:p.age})}
                    <div style={{flex:1}}>
                      <div style={{display:"flex",gap:5,alignItems:"center",flexWrap:"wrap"}}>
                        <span style={{fontWeight:800,fontSize:11}}>{p.name}</span>
                        <span style={{fontSize:9,color:T.dim}}>{p.pos+" OVR "+p.ovr}</span>
                        <span style={{fontSize:9,padding:"1px 5px",borderRadius:3,background:"rgba(0,0,0,0.3)",color:aI.badgeColor||"#fff",fontWeight:700}}>{aI.badge||p._arcState}</span>
                      </div>
                      <div style={{fontSize:9,color:"#f87171",marginTop:1}}>{(p.injury.type||"Injury")+" â€” "+msk.status}</div>
                      <div style={{marginTop:3,height:4,background:"rgba(255,255,255,0.07)",borderRadius:2,overflow:"hidden"}}>
                        <div style={{height:"100%",width:rp+"%",background:"linear-gradient(90deg,#ef4444,#f97316)",borderRadius:2}}/>
                      </div>
                      <div style={{fontSize:8,color:T.faint,marginTop:1}}>{rp+"% recovered â€” "+p.injury.games+" wk"+(p.injury.games!==1?"s":"")+" remaining"}</div>
                    </div>
                    <div style={{textAlign:"center",minWidth:30}}>
                      <div style={{fontSize:16,fontWeight:900,color:"#ef4444"}}>{msk.badge||p.injury.games}</div>
                      <div style={{fontSize:7,color:T.faint}}>{msk.badge==="DTD"?"STATUS":"WKS"}</div>
                    </div>
                  </div>;
                })}
              </div>}
              {/* Depth Impact Meter */}
              {anyHurt22&&<div style={{background:"rgba(0,0,0,0.18)",border:"1px solid "+T.border,borderRadius:8,padding:10}}>
                <div style={{fontSize:9,letterSpacing:2,color:T.gold,fontWeight:900,marginBottom:8,textTransform:"uppercase"}}>
                  {"ðŸ“Š DEPTH IMPACT METER"}
                </div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6}}>
                  {depthGrid22.map(function(d){
                    return <div key={d.grp.label} style={{background:"rgba(255,255,255,0.03)",borderRadius:6,padding:"6px 8px",
                      border:"1px solid "+(d.hurtN>0?"rgba(239,68,68,0.2)":T.border)}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3}}>
                        <span style={{fontSize:10}}>{d.grp.icon+" "+d.grp.label}</span>
                        <span style={{fontSize:8,fontWeight:800,color:d.col}}>{d.lbl}</span>
                      </div>
                      <div style={{height:3,background:"rgba(255,255,255,0.06)",borderRadius:2,marginBottom:3}}>
                        <div style={{height:"100%",width:d.pct+"%",background:d.col,borderRadius:2}}/>
                      </div>
                      <div style={{fontSize:8,color:T.faint}}>{d.hurtN+"/"+d.stN+" starters out"}</div>
                      {d.topBack&&d.hurtN>0&&<div style={{fontSize:8,color:T.cyan,marginTop:2}}>{"â†‘ "+d.topBack.name+" ("+d.topBack.ovr+") up next"}</div>}
                    </div>;
                  })}
                </div>
              </div>}
              {/* Rehab timeline â€” full player list */}
              {hurt.length===0
                ? <div style={assign({},cS,{textAlign:"center",padding:24,color:T.green})}>
                    <div style={{fontSize:24,marginBottom:6}}>{"âœ…"}</div>
                    <div style={{fontWeight:700,fontSize:13}}>{"Full health! No injuries on the roster."}</div>
                    <div style={{fontSize:10,color:T.dim,marginTop:4}}>{"Your medical staff is doing elite work. Protect it."}</div>
                  </div>
                : <div style={{display:"flex",flexDirection:"column",gap:6}}>
                    <div style={{fontSize:9,letterSpacing:2,color:T.dim,fontWeight:700,textTransform:"uppercase"}}>
                      {"â±ï¸ REHAB TIMELINE"}
                    </div>
                    {hurt.map(function(p){
                      var msk22=getInjuryMask92(p,my);
                      var rehabOpt22=p.injury._rehab78?REHAB_SYSTEM.options.find(function(o){return o.id===p.injury._rehab78;}):null;
                      var tw22=typeof p._trueInjuryWeeks==="number"?p._trueInjuryWeeks:(p.injury.games||0);
                      var rp22=tw22>0?Math.max(0,Math.round((1-(p.injury.games/tw22))*100)):100;
                      var aI22=p._arcState?(ARC_SPOTLIGHT.lines[p._arcState]||{}):null;
                      var barC22=p.injury.games<=1?"#10b981":p.injury.games<=3?"#fbbf24":"#ef4444";
                      return <div key={p.id} style={assign({},cS,{padding:10,
                        borderColor:aI22&&aI22.badgeColor?(aI22.badgeColor):((p.ovr||0)>=80?T.red:T.border)})}>
                        <div style={{display:"flex",gap:8,alignItems:"center",marginBottom:6}}>
                          {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:28,age:p.age})}
                          <div style={{flex:1}}>
                            <div style={{display:"flex",gap:5,alignItems:"center",flexWrap:"wrap"}}>
                              <span style={{fontWeight:800,fontSize:12}}>{p.name}</span>
                              <span style={{color:T.gold,fontSize:10,fontWeight:700}}>{p.pos}</span>
                              <span style={assign({fontSize:10,fontWeight:800},oS(p.ovr||0))}>{p.ovr}</span>
                              {aI22&&aI22.badge&&<span style={{fontSize:9,padding:"1px 5px",borderRadius:3,background:"rgba(0,0,0,0.3)",color:aI22.badgeColor,fontWeight:700}}>{aI22.badge}</span>}
                              {p.isStarter&&<span style={{fontSize:8,color:T.cyan,fontWeight:700}}>{"STARTER"}</span>}
                            </div>
                            <div style={{fontSize:10,color:"#f87171",fontWeight:600,marginTop:1}}>
                              {(p.injury.type||"Injury")}
                              {rehabOpt22&&<span style={{marginLeft:6,fontSize:9,color:rehabOpt22.color}}>{rehabOpt22.icon+" "+rehabOpt22.label}</span>}
                            </div>
                          </div>
                          <div style={{textAlign:"center",minWidth:36}}>
                            <div style={{fontSize:20,fontWeight:900,color:barC22}}>{msk22.badge||p.injury.games}</div>
                            <div style={{fontSize:7,color:T.faint}}>{msk22.badge==="DTD"?"STATUS":"WKS LEFT"}</div>
                          </div>
                        </div>
                        {/* Progress bar */}
                        <div style={{display:"flex",alignItems:"center",gap:8}}>
                          <div style={{flex:1,height:6,background:"rgba(255,255,255,0.06)",borderRadius:3,overflow:"hidden"}}>
                            <div style={{height:"100%",width:rp22+"%",
                              background:"linear-gradient(90deg,"+(rp22>=80?"#10b981,#34d399":"#ef4444,#f97316")+")",borderRadius:3}}/>
                          </div>
                          <div style={{fontSize:9,color:T.faint,minWidth:32,textAlign:"right"}}>{rp22+"%"}</div>
                        </div>
                        <div style={{display:"flex",justifyContent:"space-between",marginTop:3}}>
                          <div style={{fontSize:8,color:T.faint}}>{"ðŸ¤• Injured"}</div>
                          <div style={{fontSize:8,color:p.injury.games<=1?T.green:T.dim,fontWeight:p.injury.games<=1?700:400}}>
                            {p.injury.games<=1?"BACK NEXT WEEK":""+p.injury.games+" wks remaining"}
                          </div>
                          <div style={{fontSize:8,color:T.green}}>{"âœ… Return"}</div>
                        </div>
                      </div>;
                    })}
                  </div>
              }
            </div>;
          })()}
          
          {tab==="playoffPic" && (function(){
            function tieReason(a,b){
              if(a.wins!==b.wins)return a.wins>b.wins?"Better record":"";
              var h2h=sched.filter(function(g){return g.played&&((g.home===a.id&&g.away===b.id)||(g.away===a.id&&g.home===b.id));});
              if(h2h.length>0){
                var aW=h2h.filter(function(g){return(g.home===a.id&&g.result.home>g.result.away)||(g.away===a.id&&g.result.away>g.result.home);}).length;
                var bW=h2h.length-aW;if(aW!==bW)return aW>bW?"H2H: "+aW+"-"+bW:"";
              }
              if((a.pf-a.pa)!==(b.pf-b.pa))return(a.pf-a.pa)>(b.pf-b.pa)?"Point diff: +"+Math.round(a.pf-a.pa):"";
              return"Points for: "+a.pf;
            }
            if(LEAGUE_TEAM_COUNT97>=30){
              function teamGamesPlayedConf97(t2){return Math.max(0,(t2&&t2.wins||0)+(t2&&t2.losses||0)+((t2&&t2.ties)||0));}
              function teamRemainConf97(t2){return Math.max(0,17-teamGamesPlayedConf97(t2));}
              function buildConfPanel97(confCode){
                var confData=buildConferenceSeeds97(confCode,teams);
                var order=(confData&&confData.raceOrder?confData.raceOrder:[]).slice();
                var seedIds={};(confData.seeds||[]).forEach(function(s){seedIds[s.id]=1;});
                function rankOf(teamId){
                  for(var i=0;i<order.length;i++){if(order[i].id===teamId)return i+1;}
                  return 0;
                }
                function statusFor(t2){
                  var rank=rankOf(t2.id);
                  var remain=teamRemainConf97(t2);
                  var cutoff=order[3]||null;
                  var firstOut=order[4]||null;
                  var cutoffWins=cutoff?(cutoff.wins||0):0;
                  var firstOutMax=firstOut?((firstOut.wins||0)+teamRemainConf97(firstOut)):-999;
                  var myMax=(t2.wins||0)+remain;
                  if(remain===0){
                    return rank>0&&rank<=4?{status:"clinched",label:"CLINCHED",color:T.green,rank:rank}:{status:"eliminated",label:"ELIMINATED",color:T.red,rank:rank};
                  }
                  if(rank>0&&rank<=4&&((t2.wins||0)>firstOutMax)){
                    return {status:"clinched",label:"CLINCHED",color:T.green,rank:rank};
                  }
                  if(myMax<cutoffWins){
                    return {status:"eliminated",label:"ELIMINATED",color:T.red,rank:rank};
                  }
                  if(rank>0&&rank<=4){
                    var magic=Math.max(0,firstOutMax-(t2.wins||0)+1);
                    return {status:"contending",label:"MN: "+magic,color:T.cyan,rank:rank};
                  }
                  if(rank>4&&rank<=6){
                    return {status:"bubble",label:Math.max(0,cutoffWins-(t2.wins||0))+" back",color:T.orange,rank:rank};
                  }
                  return {status:"alive",label:"ALIVE",color:T.faint,rank:rank};
                }
                return {confCode:confCode,confName:getConfName97(confCode),confData:confData,order:order,seedIds:seedIds,rankOf:rankOf,statusFor:statusFor};
              }
              function rowStyle97(isMe2,isSeed){
                return {display:"flex",gap:8,alignItems:"center",padding:"6px 8px",
                  background:isMe2?"rgba(212,167,75,0.1)":isSeed?"rgba(52,211,153,0.03)":"transparent",
                  borderRadius:6,borderLeft:isMe2?"3px solid rgba(212,167,75,0.45)":"3px solid transparent"};
              }
              function confRow97(panel,t2){
                var st=panel.statusFor(t2);var rank=st.rank||panel.rankOf(t2.id)||0;var isMe2=t2.id===myId;
                var nextT=panel.order[rank]||null;
                var reason=nextT?getTiebreakReason97(t2,nextT):"";
                var seedStub=(panel.confData.seeds||[]).find(function(s){return s.id===t2.id;})||null;
                var diff=Math.round((t2.pf||0)-(t2.pa||0));
                return React.createElement("div",{key:t2.id,style:rowStyle97(isMe2,!!seedStub)},
                  React.createElement("span",{style:{fontWeight:900,fontSize:14,width:24,color:seedStub?(seedStub.seed<=3?T.green:T.cyan):T.dim,textAlign:"center"}},rank||"â€”"),
                  React.createElement(TeamLogo,{team:t2,size:20}),
                  React.createElement("div",{style:{flex:1,minWidth:0}},
                    React.createElement("div",{style:{display:"flex",alignItems:"center",gap:5,flexWrap:"wrap"}},
                      React.createElement("span",{style:{fontWeight:isMe2?800:600,fontSize:12,color:isMe2?T.gold:T.text}},t2.name),
                      seedStub?React.createElement("span",{style:{fontSize:7,fontWeight:800,color:seedStub.isDivChamp?T.green:T.orange,padding:"1px 4px",background:"rgba(255,255,255,0.04)",borderRadius:3}},seedStub.isDivChamp?"DIV CHAMP":"WILD CARD"):null
                    ),
                    React.createElement("div",{style:{fontSize:10,color:T.dim,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},
                      "("+t2.wins+"-"+t2.losses+") â€¢ Diff "+(diff>=0?"+":"")+diff+(reason?" | "+reason:"")
                    )
                  ),
                  st.label?React.createElement("span",{style:{fontSize:8,fontWeight:800,color:st.color,padding:"2px 6px",background:"rgba(255,255,255,0.04)",borderRadius:4}},st.label):null
                );
              }
              function projectedMatchCard97(label,s1,s2,confCode){
                if(!s1||!s2)return React.createElement("div",{key:label,style:{background:T.bg3,borderRadius:6,padding:8,fontSize:10,color:T.faint,textAlign:"center"}},"TBD");
                var inv=(s1.id===myId||s2.id===myId);
                return React.createElement("div",{key:label,style:{background:inv?"rgba(212,167,75,0.08)":T.bg3,borderRadius:6,padding:8,border:"1px solid "+(inv?"rgba(212,167,75,0.3)":T.border)}},
                  React.createElement("div",{style:{fontWeight:800,fontSize:9,color:confCode==="EC"?T.cyan:T.orange,marginBottom:4}},label),
                  React.createElement("div",{style:{display:"flex",alignItems:"center",gap:4}},
                    React.createElement(TeamLogo,{team:s1,size:14}),
                    React.createElement("span",{style:{fontSize:11,fontWeight:700}},"#"+(s1.seed||1)+" "+s1.abbr)
                  ),
                  React.createElement("div",{style:{fontSize:9,color:T.faint,margin:"3px 0"}},"vs"),
                  React.createElement("div",{style:{display:"flex",alignItems:"center",gap:4}},
                    React.createElement(TeamLogo,{team:s2,size:14}),
                    React.createElement("span",{style:{fontSize:11,fontWeight:700}},"#"+(s2.seed||2)+" "+s2.abbr)
                  ),
                  inv?React.createElement("div",{style:{fontSize:8,fontWeight:800,color:T.gold,marginTop:4}},"ðŸˆ YOUR PROJECTED MATCHUP"):null
                );
              }
              if(poBracket&&(season.phase==="playoffs"||season.phase==="reSign")){
                var prForBracket97=buildPowerRanks(teams,sched);
                return React.createElement(PlayoffBracket,{bracket:poBracket,powerRanks:prForBracket97,myId:myId});
              }
              var ecPanel97=buildConfPanel97("EC");
              var wcPanel97=buildConfPanel97("WC");
              var myConf97=(my&&my.conf)?my.conf:"EC";
              var myPanel97=myConf97==="WC"?wcPanel97:ecPanel97;
              var myStatus97=my?myPanel97.statusFor(my):{status:"alive",label:"",color:T.faint,rank:0};
              var myRank97=myStatus97.rank||myPanel97.rankOf(myId)||0;
              var mySeed97=(myPanel97.confData.seeds||[]).find(function(s){return s.id===myId;})||null;
              var userGamesLeft97=my?teamRemainConf97(my):0;
              function confColumn97(panel,accent){
                var seedsList=(panel.confData.seedTeams||[]).slice(0,4);
                var bubbleList=(panel.order||[]).slice(4,8);
                var outList=(panel.order||[]).slice(8);
                var cutoff=panel.order[3]||null;
                return React.createElement("div",{style:assign({},cS,{borderColor:accent+"55",padding:10})},
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
                    React.createElement("div",{style:{fontWeight:900,fontSize:11,color:accent,letterSpacing:1}},panel.confCode+" PLAYOFF RACE"),
                    React.createElement("div",{style:{fontSize:8,color:T.faint}},cutoff?"#4 is "+cutoff.wins+"-"+cutoff.losses:"")
                  ),
                  React.createElement("div",{style:{fontSize:9,color:T.green,fontWeight:800,marginBottom:4}},"âœ… QUALIFIERS (Seeds 1â€“4)"),
                  seedsList.map(function(t2){return confRow97(panel,t2);}),
                  React.createElement("div",{style:{fontSize:9,color:T.orange,fontWeight:800,marginTop:8,marginBottom:4}},"ðŸ”¥ BUBBLE"),
                  bubbleList.length?bubbleList.map(function(t2){return confRow97(panel,t2);}):React.createElement("div",{style:{fontSize:10,color:T.faint,padding:"4px 2px"}},"No bubble teams"),
                  React.createElement("div",{style:{fontSize:9,color:T.red,fontWeight:800,marginTop:8,marginBottom:4}},"âŒ OUTSIDE"),
                  React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:2}},
                    outList.slice(0,7).map(function(t2){return confRow97(panel,t2);})
                  )
                );
              }
              var ecSeeds97=ecPanel97.confData.seeds||[];
              var wcSeeds97=wcPanel97.confData.seeds||[];
              return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8}},
                React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(34,197,94,0.14),rgba(0,0,0,0.9))",border:"2px solid rgba(34,197,94,0.35)",borderRadius:12,padding:"12px 14px",display:"flex",alignItems:"center",gap:10}},
                  React.createElement("div",{style:{fontSize:24}},"ðŸˆ"),
                  React.createElement("div",null,
                    React.createElement("div",{style:{fontSize:11,fontWeight:900,color:"#34d399",letterSpacing:2}},"MFSN PLAYOFF PICTURE"),
                    React.createElement("div",{style:{fontSize:9,color:T.faint}},"Week "+(season.week||1)+" â€” Conference format (EC/WC)")
                  ),
                  my?React.createElement("div",{style:{marginLeft:"auto",textAlign:"right"}},
                    React.createElement("div",{style:{fontSize:9,fontWeight:800,color:myStatus97.color||T.faint,padding:"3px 8px",background:"rgba(255,255,255,0.06)",borderRadius:6,border:"1px solid "+((myStatus97.color||T.faint)+"44")}},myStatus97.label||String(myStatus97.status||"ALIVE").toUpperCase()),
                    React.createElement("div",{style:{fontSize:8,color:T.dim,marginTop:3}},(myConf97||"EC")+" Rank #"+(myRank97||"â€”")+(mySeed97?" â€¢ Seed #"+mySeed97.seed:"")+" â€¢ "+userGamesLeft97+" left")
                  ):null
                ),
                my?React.createElement("div",{style:assign({},cS,{borderColor:(myStatus97.color||T.gold)+"55",background:"rgba(255,255,255,0.02)"})},
                  React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
                    React.createElement(TeamLogo,{team:my,size:28}),
                    React.createElement("div",{style:{flex:1}},
                      React.createElement("div",{style:{fontWeight:900,fontSize:12}},my.name),
                      React.createElement("div",{style:{fontSize:10,color:T.dim}},(my.conf||"EC")+" â€¢ "+my.wins+"-"+my.losses+" â€¢ Diff "+(Math.round((my.pf||0)-(my.pa||0))>=0?"+":"")+Math.round((my.pf||0)-(my.pa||0)))
                    ),
                    mySeed97?React.createElement("div",{style:{fontSize:9,fontWeight:800,color:mySeed97.isDivChamp?T.green:T.orange}},mySeed97.isDivChamp?"DIV CHAMP SEED":"WILD CARD SEED"):null
                  )
                ):null,
                React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}},
                  confColumn97(ecPanel97,T.cyan),
                  confColumn97(wcPanel97,T.orange)
                ),
                React.createElement("div",{style:assign({},cS,{borderColor:"rgba(212,167,75,0.2)"})},
                  React.createElement("div",{style:{fontWeight:700,fontSize:11,color:T.gold,marginBottom:8}},"ðŸ—“ï¸ PROJECTED CONFERENCE ROUND 1"),
                  React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}},
                    projectedMatchCard97("EC #1 vs #4",ecSeeds97[0],ecSeeds97[3],"EC"),
                    projectedMatchCard97("EC #2 vs #3",ecSeeds97[1],ecSeeds97[2],"EC"),
                    projectedMatchCard97("WC #1 vs #4",wcSeeds97[0],wcSeeds97[3],"WC"),
                    projectedMatchCard97("WC #2 vs #3",wcSeeds97[1],wcSeeds97[2],"WC")
                  )
                )
              );
            }
            var sorted2=teams.slice().sort(function(a,b){
              if(a.wins!==b.wins)return b.wins-a.wins;
              var h2h=sched.filter(function(g){return g.played&&((g.home===a.id&&g.away===b.id)||(g.away===a.id&&g.home===b.id));});
              if(h2h.length>0){
                var aW=h2h.filter(function(g){return(g.home===a.id&&g.result.home>g.result.away)||(g.away===a.id&&g.result.away>g.result.home);}).length;
                var bW=h2h.length-aW;if(aW!==bW)return bW-aW;
              }
              if((a.pf-a.pa)!==(b.pf-b.pa))return(b.pf-b.pa)-(a.pf-a.pa);
              return b.pf-a.pf;
            });
            var playoffTeams=sorted2.slice(0,8);var bubble=sorted2.slice(8,12);var out=sorted2.slice(12);
            function teamGamesPlayed73(t2){return Math.max(0,(t2&&t2.wins||0)+(t2&&t2.losses||0)+((t2&&t2.ties)||0));}
            function teamRemain73(t2){return Math.max(0,17-teamGamesPlayed73(t2));}
            var userGamesLeft73=teamRemain73(my);
            var team8Wins=sorted2[7]?sorted2[7].wins:0;// 8th seed wins
            var team8GamesLeft73=teamRemain73(sorted2[7]);
            function clinchStatus73(t2,rank){
              var remain=teamRemain73(t2);
              if(remain===0){return rank<=8?{status:"clinched",label:"CLINCHED",color:T.green}:{status:"eliminated",label:"ELIMINATED",color:T.red};}
              var ninthMaxWins=sorted2[8]?((sorted2[8].wins||0)+teamRemain73(sorted2[8])):999;
              if(t2.wins>ninthMaxWins){return {status:"clinched",label:"CLINCHED",color:T.green};}
              var myMaxWins=t2.wins+remain;
              if(myMaxWins<team8Wins){return {status:"eliminated",label:"ELIMINATED",color:T.red};}
              var magicNum=Math.max(0,ninthMaxWins-t2.wins+1);
              if(rank<=8&&magicNum<=remain){return {status:"contending",label:"MN: "+magicNum,color:T.cyan};}
              if(rank>8&&rank<=12){
                var gapToPlayoffs=team8Wins-t2.wins;
                return {status:"bubble",label:gapToPlayoffs+" back",color:T.orange};
              }
              return {status:"alive",label:"",color:T.faint};
            }
            function seedCard(seed,t2){var isMe2=t2.id===myId;
              var nextTeam=sorted2[seed]||null;// Team right below this one
              var reason=nextTeam?tieReason(t2,nextTeam):"";
              var cs73=clinchStatus73(t2,seed);
              return React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"6px 8px",background:isMe2?"rgba(212,167,75,0.1)":"transparent",borderRadius:6}},
                React.createElement("span",{style:{fontWeight:900,fontSize:16,color:T.gold,width:20}},seed),
                React.createElement(TeamLogo,{team:t2,size:22}),
                React.createElement("div",{style:{flex:1}},
                  React.createElement("div",{style:{fontWeight:isMe2?800:600,fontSize:12}},t2.name+" ("+t2.wins+"-"+t2.losses+")"),
                  React.createElement("div",{style:{fontSize:10,color:T.dim}},"+"+Math.round(t2.pf-t2.pa)+" diff"+(reason?" | "+reason:""))
                ),
                cs73.label?React.createElement("span",{style:{fontSize:8,fontWeight:700,color:cs73.color,padding:"2px 6px",background:"rgba(255,255,255,0.05)",borderRadius:4}},cs73.label):null
              );
            }
            function liveBracketCard(g,label){
              if(!g||!g.home)return React.createElement("div",{style:{background:T.bg3,borderRadius:6,padding:8,border:"1px solid "+T.border,opacity:0.4,textAlign:"center",fontSize:10,color:T.faint}},"TBD");
              var played=!!g.result;var hW=played&&g.result.home>g.result.away;var aW=played&&!hW;
              return React.createElement("div",{style:{background:played?"rgba(212,167,75,0.03)":T.bg3,borderRadius:6,padding:8,border:"1px solid "+(g.winner&&g.winner.id===myId?T.gold:played?T.green:T.border)}},
                React.createElement("div",{style:{fontSize:8,color:T.faint,fontWeight:700,marginBottom:3}},label),
                React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                  React.createElement("div",{style:{display:"flex",alignItems:"center",gap:4}},
                    React.createElement(TeamLogo,{team:g.home,size:16}),
                    React.createElement("span",{style:{fontWeight:hW?900:500,fontSize:11,color:hW?T.gold:T.text}},g.home.abbr)
                  ),
                  played?React.createElement("span",{style:{fontWeight:900,fontSize:13,color:T.gold}},g.result.home+"-"+g.result.away):React.createElement("span",{style:{fontSize:10,color:T.dim}},"VS")
                ),
                React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:2}},
                  React.createElement("div",{style:{display:"flex",alignItems:"center",gap:4}},
                    React.createElement(TeamLogo,{team:g.away,size:16}),
                    React.createElement("span",{style:{fontWeight:aW?900:500,fontSize:11,color:aW?T.gold:T.text}},g.away.abbr)
                  ),
                  ""
                ),
                g.winner?React.createElement("div",{style:{fontSize:8,color:T.green,fontWeight:700,marginTop:3}},"âœ… "+g.winner.icon+" "+g.winner.abbr+" advances"):null
              );
            }
            if(poBracket&&(season.phase==="playoffs"||season.phase==="reSign")){
              var prForBracket=buildPowerRanks(teams,sched);
              return React.createElement(PlayoffBracket,{bracket:poBracket,powerRanks:prForBracket,myId:myId});
            }
            // PLAYOFF_SURGE v26: MFSN cinematic playoff picture command center
            var PS_NARR={clinched:(PLAYOFF_NARRATIVE_993.clinchedBerth&&PLAYOFF_NARRATIVE_993.clinchedBerth.length?PLAYOFF_NARRATIVE_993.clinchedBerth:["Your franchise has PUNCHED THE TICKET. The real season starts now.","Clinched. Locked in. The playoffs are a different animal â€” are you ready?","A playoff berth earned, not given. Now go do something with it."]),contending:["One or two wins seals it. The pressure is real â€” but so is the opportunity.","Your magic number is ticking down. Every game matters. Every point matters.","You're close enough to smell the playoffs. Don't let it slip."],bubble:["On the bubble is not a bad place to be â€” until it is. Win or go home territory.","The standings don't lie. Your franchise needs a statement.","Bubble teams that make the playoffs become legends. Bubble teams that don't become cautionary tales."],eliminated:["The math has spoken. But the tape doesn't lie â€” use the rest of this season to build.","Out of the race. That's fuel. Bank it. Channel it. Come back angrier.","Sometimes missing the playoffs teaches you more than making them. Learn the lesson."]};
            var PS_ARC_N={BREAKOUT:"A BREAKOUT arc player is driving your playoff push. When the arc peaks and the playoffs align â€” history happens.",ELITE:"An ELITE arc player in a playoff race is the most dangerous thing in football. Clear the path.",SLUMP:"Your franchise is in the playoff picture despite a SLUMP arc. Imagine what happens when they snap out of it.",COMEBACK:"A COMEBACK arc player making a playoff run. The league should be taking notes.",DECLINE:"Even in decline, this player is helping you compete. Maximize these playoff windows while they last.",HOLDOUT:"Contract drama and a playoff race colliding is appointment television. Resolve this â€” now.",SWAN_SONG:"A SWAN_SONG arc player chasing one last playoff run. The whole sport should be watching.",MENTOR:"MENTOR arc + playoff race = a veteran who knows exactly what these games mean."};
            var myRank26=sorted2.findIndex(function(t2){return t2.id===myId;})+1;
            var myCS26=clinchStatus73(my,myRank26);
            var myPSPool=myCS26.status==="clinched"?PS_NARR.clinched:myCS26.status==="contending"?PS_NARR.contending:myCS26.status==="bubble"?PS_NARR.bubble:PS_NARR.eliminated;
            var myPSLine=myPSPool[Math.floor(RNG.ui()*myPSPool.length)];
            var myArcStar26=(my.roster||[]).filter(function(p){return p&&p._arcState&&(p.ovr||0)>=72&&p.isStarter;}).sort(function(a,b){return(b.ovr||0)-(a.ovr||0);})[0]||null;
            var myArcInfo26=myArcStar26?(ARC_SPOTLIGHT.lines[myArcStar26._arcState]||{}):null;
            var psC=myCS26.status==="clinched"?T.green:myCS26.status==="contending"?T.cyan:myCS26.status==="bubble"?T.orange:T.red;
            var psBg=myCS26.status==="clinched"?"rgba(52,211,153,0.12)":myCS26.status==="contending"?"rgba(34,211,238,0.12)":myCS26.status==="bubble"?"rgba(249,115,22,0.12)":"rgba(239,68,68,0.10)";
            function seedPS(seed,t2){
              var isMe2=t2.id===myId;var nextT=sorted2[seed]||null;var reason=nextT?tieReason(t2,nextT):"";var cs=clinchStatus73(t2,seed);
              var tArc=(t2.roster||[]).filter(function(p){return p&&p._arcState&&(p.ovr||0)>=72&&p.isStarter;}).sort(function(a,b){return(b.ovr||0)-(a.ovr||0);})[0]||null;
              var tArcI=tArc?(ARC_SPOTLIGHT.lines[tArc._arcState]||{}):null;
              return React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"6px 8px",background:isMe2?"rgba(212,167,75,0.1)":seed<=3?"rgba(52,211,153,0.03)":"transparent",borderRadius:6,borderLeft:isMe2?"3px solid rgba(212,167,75,0.5)":"3px solid transparent"}},
                React.createElement("span",{style:{fontWeight:900,fontSize:15,width:20,color:seed===1?T.gold:seed<=3?T.green:seed<=8?T.cyan:T.dim}},seed),
                React.createElement(TeamLogo,{team:t2,size:22}),
                React.createElement("div",{style:{flex:1}},
                  React.createElement("div",{style:{display:"flex",alignItems:"center",gap:5}},
                    React.createElement("span",{style:{fontWeight:isMe2?800:600,fontSize:12}},t2.name),
                    tArcI&&tArcI.badge?React.createElement("span",{style:{fontSize:8,fontWeight:800,color:tArcI.badgeColor||"#a78bfa",padding:"1px 4px",background:"rgba(167,139,250,0.1)",borderRadius:3}},tArcI.badge):null
                  ),
                  React.createElement("div",{style:{fontSize:10,color:T.dim}},"("+t2.wins+"-"+t2.losses+") diff:"+(Math.round(t2.pf-t2.pa)>=0?"+":"")+Math.round(t2.pf-t2.pa)+(reason?" | "+reason:""))
                ),
                cs.label?React.createElement("span",{style:{fontSize:8,fontWeight:700,color:cs.color,padding:"2px 6px",background:"rgba(255,255,255,0.05)",borderRadius:4}},cs.label):null
              );
            }
            return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8}},
              React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(34,197,94,0.14),rgba(0,0,0,0.9))",border:"2px solid rgba(34,197,94,0.35)",borderRadius:12,padding:"12px 14px",display:"flex",alignItems:"center",gap:10}},
                React.createElement("div",{style:{fontSize:24}},"ðŸˆ"),
                React.createElement("div",null,
                  React.createElement("div",{style:{fontSize:11,fontWeight:900,color:"#34d399",letterSpacing:2}},"MFSN PLAYOFF PICTURE"),
                  React.createElement("div",{style:{fontSize:9,color:T.faint}},"Week "+(season.week||1)+" â€” "+userGamesLeft73+" Games Left (You)")
                ),
                React.createElement("div",{style:{marginLeft:"auto",fontSize:9,fontWeight:800,color:psC,padding:"3px 8px",background:"rgba(255,255,255,0.06)",borderRadius:6,border:"1px solid "+psC+"44"}},myCS26.label||myCS26.status.toUpperCase())
              ),
              React.createElement("div",{style:{background:psBg,border:"2px solid "+psC+"44",borderRadius:10,padding:12}},
                React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8}},
                  React.createElement(TeamLogo,{team:my,size:32}),
                  React.createElement("div",{style:{flex:1}},
                    React.createElement("div",{style:{fontWeight:900,fontSize:13}},my.name),
                    React.createElement("div",{style:{fontSize:10,color:T.dim}},"Seed #"+myRank26+" | "+my.wins+"-"+my.losses+" | Diff: "+(Math.round(my.pf-my.pa)>=0?"+":"")+Math.round(my.pf-my.pa))
                  ),
                  React.createElement("div",{style:{textAlign:"right"}},
                    React.createElement("div",{style:{fontSize:12,fontWeight:900,color:psC}},myCS26.label||myCS26.status.toUpperCase()),
                    userGamesLeft73>0?React.createElement("div",{style:{fontSize:9,color:T.dim}},userGamesLeft73+" games left"):null
                  )
                ),
                React.createElement("div",{style:{fontSize:11,color:"#e2e8f0",fontStyle:"italic",borderLeft:"2px solid "+psC+"66",paddingLeft:8,lineHeight:1.5,marginBottom:myArcStar26?8:0}},myPSLine),
                myArcStar26&&myArcInfo26&&PS_ARC_N[myArcStar26._arcState]?React.createElement("div",{style:{display:"flex",alignItems:"center",gap:6}},
                  React.createElement("span",{style:{fontSize:9,fontWeight:800,color:myArcInfo26.badgeColor||"#a78bfa",padding:"2px 6px",background:"rgba(167,139,250,0.12)",borderRadius:3}},myArcInfo26.badge||myArcStar26._arcState),
                  React.createElement("span",{style:{fontSize:10,color:T.dim,fontStyle:"italic"}},PS_ARC_N[myArcStar26._arcState])
                ):null
              ),
              React.createElement("div",{style:assign({},cS,{borderColor:"rgba(52,211,153,0.2)"})},
                React.createElement("div",{style:{fontWeight:700,fontSize:11,color:T.green,marginBottom:6}},"âœ… PLAYOFF FIELD â€” Top 8 Seeds"),
                playoffTeams.map(function(t2,i){return React.createElement("div",{key:t2.id},seedPS(i+1,t2));})
              ),
              React.createElement("div",{style:assign({},cS,{borderColor:"rgba(249,115,22,0.2)"})},
                React.createElement("div",null,
                  React.createElement("div",{style:{fontWeight:700,fontSize:11,color:T.orange,marginBottom:2}},"ðŸ”¥ ON THE BUBBLE"),
                  React.createElement("div",{style:{fontSize:9,color:T.faint,marginBottom:6}},"8th seed has "+(playoffTeams[7]?playoffTeams[7].wins:"â€”")+" wins | "+team8GamesLeft73+" left")
                ),
                bubble.map(function(t2,i){return React.createElement("div",{key:t2.id},seedPS(i+9,t2));})
              ),
              React.createElement("div",{style:assign({},cS,{borderColor:"rgba(212,167,75,0.2)"})},
                React.createElement("div",{style:{fontWeight:700,fontSize:11,color:T.gold,marginBottom:8}},"ðŸ—“ï¸ PROJECTED FIRST ROUND"),
                React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}},
                  [[1,8],[2,7],[3,6],[4,5]].map(function(matchup){
                    var s1=playoffTeams[matchup[0]-1];var s2=playoffTeams[matchup[1]-1];
                    if(!s1||!s2)return React.createElement("div",{key:matchup[0],style:{background:T.bg3,borderRadius:6,padding:8,fontSize:10,color:T.faint,textAlign:"center"}},"TBD");
                    var inv=(s1.id===myId||s2.id===myId);
                    var a1=(s1.roster||[]).filter(function(p){return p&&p._arcState&&(p.ovr||0)>=72&&p.isStarter;})[0]||null;
                    var a2=(s2.roster||[]).filter(function(p){return p&&p._arcState&&(p.ovr||0)>=72&&p.isStarter;})[0]||null;
                    var ai1=a1?(ARC_SPOTLIGHT.lines[a1._arcState]||{}):null;var ai2=a2?(ARC_SPOTLIGHT.lines[a2._arcState]||{}):null;
                    return React.createElement("div",{key:matchup[0],style:{background:inv?"rgba(212,167,75,0.08)":T.bg3,borderRadius:6,padding:8,border:"1px solid "+(inv?"rgba(212,167,75,0.3)":T.border)}},
                      React.createElement("div",{style:{fontWeight:700,fontSize:9,color:T.faint,marginBottom:4}},"QF "+matchup[0]),
                      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:3}},
                        React.createElement(TeamLogo,{team:s1,size:14}),
                        React.createElement("span",{style:{fontSize:11,fontWeight:s1.id===myId?900:600}},"#"+matchup[0]+" "+s1.abbr),
                        ai1&&ai1.badge?React.createElement("span",{style:{fontSize:7,fontWeight:800,color:ai1.badgeColor||"#a78bfa",marginLeft:"auto"}},ai1.badge):null
                      ),
                      React.createElement("div",{style:{fontSize:9,color:T.faint,marginBottom:3}},"vs"),
                      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:4}},
                        React.createElement(TeamLogo,{team:s2,size:14}),
                        React.createElement("span",{style:{fontSize:11,fontWeight:s2.id===myId?900:600}},"#"+matchup[1]+" "+s2.abbr),
                        ai2&&ai2.badge?React.createElement("span",{style:{fontSize:7,fontWeight:800,color:ai2.badgeColor||"#a78bfa",marginLeft:"auto"}},ai2.badge):null
                      ),
                      inv?React.createElement("div",{style:{fontSize:8,fontWeight:800,color:T.gold,marginTop:4}},"ðŸˆ YOUR MATCHUP"):null
                    );
                  })
                )
              ),
              React.createElement("div",{style:assign({},cS,{borderColor:"rgba(239,68,68,0.15)"})},
                React.createElement("div",{style:{fontWeight:700,fontSize:11,color:T.red,marginBottom:6}},"âŒ ELIMINATED ("+out.length+" teams)"),
                React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4}},
                  out.map(function(t2,i){
                    return React.createElement("div",{key:t2.id,style:{fontSize:10,color:T.faint,padding:"2px 4px",display:"flex",alignItems:"center",gap:4}},
                      React.createElement("span",{style:{color:T.dim,fontWeight:600,width:24}},(i+13)+"."),
                      React.createElement(TeamLogo,{team:t2,size:14}),
                      React.createElement("span",null,t2.abbr+" ("+t2.wins+"-"+t2.losses+")")
                    );
                  })
                )
              )
            );
          })()}
          
          {tab==="weekRecap" && (function(){
            var lastWk=Math.max(1,season.week-1);
            var wkGames=sched.filter(function(g){return g.week===lastWk&&g.played;});
            var userGame=wkGames.find(function(g){return g.home===myId||g.away===myId;});
            var otherGames=wkGames.filter(function(g){return g!==userGame;});
            return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10}},

              // MFSN BROADCAST HEADER
              React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(251,191,36,0.12),rgba(0,0,0,0.8))",border:"2px solid rgba(251,191,36,0.3)",borderRadius:12,padding:"10px 14px",display:"flex",alignItems:"center",gap:10}},
                React.createElement("div",{style:{fontSize:22}},"\ud83d\udcfa"),
                React.createElement("div",null,
                  React.createElement("div",{style:{fontSize:11,fontWeight:900,color:T.gold,letterSpacing:2}},"MFSN SUNDAY NIGHT FOOTBALL"),
                  React.createElement("div",{style:{fontSize:9,color:T.faint}},"Week "+lastWk+" Game Coverage")
                )
              ),

              // USER'S GAME â€” FULL BROADCAST TREATMENT
              userGame&&userGame.result?(function(){
                var hT2=teams.find(function(t2){return t2.id===userGame.home;});
                var aT2=teams.find(function(t2){return t2.id===userGame.away;});
                var gameRes=userGame.result||null;
                if(!hT2||!aT2||!gameRes)return null;
                var hasScore=typeof gameRes.home==="number"&&typeof gameRes.away==="number";
                if(!hasScore){
                  return React.createElement("div",{style:{background:T.glass,border:"1px solid "+T.glassBorder,borderRadius:8,padding:12}},
                    React.createElement("div",{style:{fontSize:10,color:T.faint,textAlign:"center"}},"User game recap data unavailable for Week "+lastWk+".")
                  );
                }
                var isH=userGame.home===myId;
                var won=isH?gameRes.home>gameRes.away:gameRes.away>gameRes.home;
                var uScore=isH?gameRes.home:gameRes.away;
                var oScore=isH?gameRes.away:gameRes.home;
                var margin=Math.abs(uScore-oScore);
                var halfScore=gameRes.halftime&&typeof gameRes.halftime==="object"?gameRes.halftime:null;
                var uHalf=halfScore&&typeof(isH?halfScore.homeHalf:halfScore.awayHalf)==="number"?(isH?halfScore.homeHalf:halfScore.awayHalf):null;
                var oHalf=halfScore&&typeof(isH?halfScore.awayHalf:halfScore.homeHalf)==="number"?(isH?halfScore.awayHalf:halfScore.homeHalf):null;
                var userT2=isH?hT2:aT2;var oppT2=isH?aT2:hT2;
                var uRec=gameRes.recap?(gameRes.recap[isH?"home":"away"]||null):null;
                var highlights=MFSN_BROADCAST.generateHighlights(gameRes,hT2,aT2,isH);
                var opener=MFSN_BROADCAST.postgameOpener(uScore,oScore,userT2,oppT2,lastWk);
                var analystLine=MFSN_BROADCAST.analystTake(won,uRec);
                var htScript=(uHalf!==null&&oHalf!==null)?MFSN_BROADCAST.halftimeScript(uHalf,oHalf,userT2,oppT2):null;
                var qtrsData=gameRes.qtrs&&typeof gameRes.qtrs==="object"?gameRes.qtrs:null;
                var qtrsHome=qtrsData?(qtrsData.home||qtrsData.h||[]):[];
                var qtrsAway=qtrsData?(qtrsData.away||qtrsData.a||[]):[];
                return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8}},

                  // SCORE BANNER
                  React.createElement("div",{style:{background:won?"linear-gradient(135deg,rgba(52,211,153,0.12),rgba(15,23,42,0.9))":"linear-gradient(135deg,rgba(239,68,68,0.12),rgba(15,23,42,0.9))",border:"2px solid "+(won?T.green:T.red),borderRadius:12,padding:14}},
                    React.createElement("div",{style:{fontSize:9,color:T.faint,fontWeight:700,letterSpacing:1,marginBottom:6}},"FINAL SCORE"),
                    React.createElement("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8}},
                      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
                        React.createElement(TeamLogo,{team:userT2,size:40}),
                        React.createElement("div",null,
                          React.createElement("div",{style:{fontWeight:900,fontSize:15}},userT2.abbr||userT2.name||"TEAM"),
                          React.createElement("div",{style:{fontSize:12,color:T.dim}},userT2.wins+"-"+userT2.losses)
                        )
                      ),
                      React.createElement("div",{style:{textAlign:"center",flex:1}},
                        React.createElement("div",{style:{fontSize:32,fontWeight:900,color:won?T.green:T.red}},uScore+"-"+oScore),
                        React.createElement("div",{style:{fontSize:9,color:T.faint}},(margin>=21?"BLOWOUT":margin>=14?"DOMINANT":margin<=3?"NAIL-BITER":margin<=7?"CLOSE GAME":"SOLID WIN/LOSS"))
                      ),
                      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
                        React.createElement(TeamLogo,{team:oppT2,size:40}),
                        React.createElement("div",null,
                          React.createElement("div",{style:{fontWeight:900,fontSize:15}},oppT2.abbr||oppT2.name||"OPP"),
                          React.createElement("div",{style:{fontSize:12,color:T.dim}},oppT2.wins+"-"+oppT2.losses)
                        )
                      )
                    ),
                    // Quarter scores
                    qtrsData&&React.createElement("div",{style:{display:"flex",gap:4,fontSize:9,borderTop:"1px solid "+T.border,paddingTop:6}},
                      ["Q1","Q2","Q3","Q4","OT"].map(function(q,qi){
                        var hV=qtrsHome[qi];var aV=qtrsAway[qi];
                        var uV=isH?hV:aV;var oV=isH?aV:hV;
                        if(qi>=4&&hV===undefined&&aV===undefined)return null;
                        return React.createElement("div",{key:q,style:{textAlign:"center",flex:1,padding:"3px 0",background:"rgba(255,255,255,0.02)",borderRadius:4}},
                          React.createElement("div",{style:{color:T.faint,fontWeight:700}},q),
                          React.createElement("div",{style:{fontWeight:800,color:uV>oV?T.green:uV<oV?T.red:T.dim}},uV||0),
                          React.createElement("div",{style:{fontSize:8,color:T.faint}},oV||0)
                        );
                      })
                    )
                  ),

                  // POSTGAME OPENER (broadcaster voice)
                  React.createElement("div",{style:{background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.2)",borderRadius:8,padding:10}},
                    React.createElement("div",{style:{fontSize:9,color:T.gold,fontWeight:800,marginBottom:4,letterSpacing:1}},"ðŸ“¢ BROADCAST"),
                    React.createElement("div",{style:{fontSize:11,fontStyle:"italic",color:T.text,lineHeight:1.5}},'"'+opener+'"')
                  ),

                  // HALFTIME REPORT (if available)
                  htScript&&React.createElement("div",{style:{background:"rgba(96,165,250,0.06)",border:"1px solid rgba(96,165,250,0.2)",borderRadius:8,padding:10}},
                    React.createElement("div",{style:{fontSize:9,color:T.blue,fontWeight:800,marginBottom:4,letterSpacing:1}},"âš¡ HALFTIME REPORT"),
                    React.createElement("div",{style:{fontSize:10,color:T.text,fontStyle:"italic",lineHeight:1.5}},'"'+htScript+'"'),
                    React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:4}},"Halftime: "+userT2.abbr+" "+uHalf+" â€” "+oppT2.abbr+" "+oHalf)
                  ),

                  // HIGHLIGHTS
                  React.createElement("div",{style:{background:T.glass,border:"1px solid "+T.glassBorder,borderRadius:8,padding:10}},
                    React.createElement("div",{style:{fontSize:9,color:T.cyan,fontWeight:800,marginBottom:8,letterSpacing:1}},"ðŸŽ¬ GAME HIGHLIGHTS"),
                    React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:6}},
                      highlights.map(function(play,pi){
                        return React.createElement("div",{key:pi,style:{display:"flex",gap:8,alignItems:"flex-start",padding:"4px 6px",borderLeft:"2px solid "+T.cyan+"44"}},
                          React.createElement("span",{style:{fontSize:14,minWidth:20}},play.icon),
                          React.createElement("span",{style:{fontSize:10,color:T.text,lineHeight:1.4}},play.text)
                        );
                      })
                    )
                  ),

                  // KEY STATS
                  uRec&&React.createElement("div",{style:{background:T.glass,border:"1px solid "+T.glassBorder,borderRadius:8,padding:10}},
                    React.createElement("div",{style:{fontSize:9,color:T.dim,fontWeight:800,marginBottom:8,letterSpacing:1}},"ðŸ“Š KEY STATS"),
                    React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6}},
                      [{label:"Pass Yds",val:(uRec.passYds||0)+"yd",good:(uRec.passYds||0)>=200},
                       {label:"Rush Yds",val:(uRec.rushYds||0)+"yd",good:(uRec.rushYds||0)>=100},
                       {label:"Turnovers",val:((uRec.ints||0)+(uRec.fumbles||0))+"",good:((uRec.ints||0)+(uRec.fumbles||0))===0,invert:true},
                       {label:"Pass TD",val:(uRec.passTD||0)+"",good:(uRec.passTD||0)>=2},
                       {label:"Rush TD",val:(uRec.rushTD||0)+"",good:(uRec.rushTD||0)>=1},
                       {label:"Sacks Taken",val:(uRec.sacks||0)+"",good:(uRec.sacks||0)===0,invert:true}
                      ].map(function(stat,si){
                        var color=stat.invert?(stat.val==="0"?T.green:T.red):(stat.good?T.green:T.dim);
                        return React.createElement("div",{key:si,style:{textAlign:"center",padding:"5px 4px",background:"rgba(255,255,255,0.02)",borderRadius:4}},
                          React.createElement("div",{style:{fontSize:14,fontWeight:900,color:color}},stat.val),
                          React.createElement("div",{style:{fontSize:8,color:T.faint}},stat.label)
                        );
                      })
                    )
                  ),

                  // ANALYST TAKE
                  React.createElement("div",{style:{background:"rgba(167,139,250,0.06)",border:"1px solid rgba(167,139,250,0.2)",borderRadius:8,padding:10}},
                    React.createElement("div",{style:{fontSize:9,color:T.purple,fontWeight:800,marginBottom:4,letterSpacing:1}},"ðŸŽ™ï¸ ANALYST TAKE"),
                    React.createElement("div",{style:{fontSize:10,fontStyle:"italic",color:T.dim,lineHeight:1.5}},analystLine)
                  )
                );
              })():null,

              // ARC SPOTLIGHT â€” arc-aware MFSN analyst commentary on user's roster
              (function(){
                if(!my||!my.roster||!userGame||!userGame.result||typeof userGame.result.home!=="number"||typeof userGame.result.away!=="number")return null;
                var isH2=userGame.home===myId;
                var didWin=isH2?userGame.result.home>userGame.result.away:userGame.result.away>userGame.result.home;
                var spots=ARC_SPOTLIGHT.generate(my.roster,didWin,lastWk,my);
                if(!spots||spots.length===0)return null;
                return React.createElement("div",{style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(251,191,36,0.15)",borderRadius:10,padding:"10px 12px"}},
                  React.createElement("div",{style:{fontSize:9,fontWeight:900,color:T.gold,letterSpacing:2,marginBottom:8,textTransform:"uppercase"}},"ðŸ“º MFSN ARC SPOTLIGHT â€” WEEK "+lastWk),
                  spots.map(function(sp,si){
                    return React.createElement("div",{key:si,style:{
                        borderLeft:"3px solid "+sp.badgeColor,
                        paddingLeft:10,marginBottom:si<spots.length-1?10:0,
                        paddingBottom:si<spots.length-1?10:0,
                        borderBottom:si<spots.length-1?"1px solid rgba(255,255,255,0.04)":"none"}},
                      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:4}},
                        React.createElement("span",{style:{fontSize:9,fontWeight:800,color:sp.badgeColor,
                          background:"rgba(255,255,255,0.04)",padding:"2px 6px",borderRadius:4,
                          border:"1px solid "+sp.badgeColor+"44"}},(sp.badge||sp.arcKey)),
                        React.createElement("span",{style:{fontSize:11,fontWeight:700,color:"#fff"}},(sp.playerName)),
                        React.createElement("span",{style:{fontSize:9,color:T.faint}},(sp.pos+" â€¢ OVR "+sp.ovr+" â€¢ Age "+sp.age))
                      ),
                      React.createElement("div",{style:{fontSize:10,fontStyle:"italic",color:T.dim,lineHeight:1.6}},
                        "\u201C"+sp.line+"\u201D")
                    );
                  })
                );
              })(),

              // DIVIDER
              otherGames.length>0&&React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.faint,letterSpacing:1,padding:"4px 0",borderTop:"1px solid "+T.border,marginTop:4}},"AROUND THE LEAGUE â€” WEEK "+lastWk),

              // OTHER GAMES (compact)
              React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:4}},
                wkGames.length===0?React.createElement("div",{style:{color:T.faint,padding:20,textAlign:"center"}},"No games played in Week "+lastWk+"."):
                otherGames.map(function(g){
                  var hT2=teams.find(function(t2){return t2.id===g.home;});var aT2=teams.find(function(t2){return t2.id===g.away;});
                  if(!hT2||!aT2||!g.result||typeof g.result.home!=="number"||typeof g.result.away!=="number")return null;var hW=g.result.home>g.result.away;var margin=Math.abs(g.result.home-g.result.away);
                  var upset=(!hW&&aT2.wins<hT2.wins)||(hW&&hT2.wins<aT2.wins);
                  return React.createElement("div",{key:[g.week,g.home,g.away].join(":"),style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 8px",background:"rgba(255,255,255,0.02)",borderRadius:6,border:"1px solid "+T.border+"44"}},
                    React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center"}},
                      React.createElement(TeamLogo,{team:hW?hT2:aT2,size:18}),
                      React.createElement("span",{style:{fontSize:11,fontWeight:700}},(hW?hT2:aT2).abbr),
                      React.createElement("span",{style:{fontSize:11,color:T.gold,fontWeight:800,margin:"0 4px"}},g.result.home+"-"+g.result.away),
                      React.createElement("span",{style:{fontSize:11,color:T.faint}},(hW?aT2:hT2).abbr)
                    ),
                    React.createElement("div",{style:{display:"flex",gap:4}},
                      upset&&React.createElement("span",{style:{fontSize:8,fontWeight:700,color:T.red,padding:"1px 4px",borderRadius:3,border:"1px solid "+T.red+"44"}},"UPSET"),
                      margin>=21&&React.createElement("span",{style:{fontSize:8,fontWeight:700,color:T.green,padding:"1px 4px",borderRadius:3,border:"1px solid "+T.green+"44"}},"BLOWOUT"),
                      margin<=3&&React.createElement("span",{style:{fontSize:8,fontWeight:700,color:T.gold,padding:"1px 4px",borderRadius:3,border:"1px solid "+T.gold+"44"}},"CLOSE")
                    )
                  );
                })
              )
            );
          })()}
          
          {tab==="milestones" && (function(){
            // DYNASTY_WATCH v19 â€” Cinematic milestone achievement wall
            var DW_TIERS={
              LEGENDARY:{label:"LEGENDARY",color:"#fbbf24",glow:"rgba(251,191,36,0.35)",bg:"linear-gradient(135deg,rgba(251,191,36,0.18),rgba(15,23,42,0.95))",border:"rgba(251,191,36,0.5)",badge:"ðŸ‘‘"},
              ELITE:{label:"ELITE",color:"#10b981",glow:"rgba(16,185,129,0.25)",bg:"linear-gradient(135deg,rgba(16,185,129,0.12),rgba(15,23,42,0.95))",border:"rgba(16,185,129,0.4)",badge:"â­"},
              NOTABLE:{label:"NOTABLE",color:"#60a5fa",glow:"rgba(96,165,250,0.2)",bg:"linear-gradient(135deg,rgba(96,165,250,0.10),rgba(15,23,42,0.95))",border:"rgba(96,165,250,0.35)",badge:"ðŸ…"}
            };
            // Season milestone definitions: {pos[], stat, thresh, tier, icon, shortLabel, narrative}
            var DW_SEASON=[
              // QB
              {pos:["QB"],stat:"passYds",thresh:5000,tier:"LEGENDARY",icon:"ðŸˆ",shortLabel:"5,000 Pass Yds",narrative:"Five thousand yards passing in a season. That's not a quarterback â€” that's a weapon of mass destruction."},
              {pos:["QB"],stat:"passYds",thresh:4000,tier:"ELITE",icon:"ðŸˆ",shortLabel:"4,000 Pass Yds",narrative:"Four thousand yards. Only the elite get here. This franchise has a real one."},
              {pos:["QB"],stat:"passYds",thresh:3000,tier:"NOTABLE",icon:"ðŸˆ",shortLabel:"3,000 Pass Yds",narrative:"Three thousand yards through the air. Consistent, reliable, dangerous."},
              {pos:["QB"],stat:"passTD",thresh:40,tier:"LEGENDARY",icon:"ðŸŽ¯",shortLabel:"40 Pass TDs",narrative:"Forty touchdown passes. That's an MVP campaign. That's a poster on someone's wall."},
              {pos:["QB"],stat:"passTD",thresh:30,tier:"ELITE",icon:"ðŸŽ¯",shortLabel:"30 Pass TDs",narrative:"Thirty scores through the air. The franchise QB is delivering."},
              {pos:["QB"],stat:"passTD",thresh:20,tier:"NOTABLE",icon:"ðŸŽ¯",shortLabel:"20 Pass TDs",narrative:"Twenty touchdown passes. The signal caller is earning that contract."},
              // RB
              {pos:["RB"],stat:"rushYds",thresh:2000,tier:"LEGENDARY",icon:"ðŸƒ",shortLabel:"2,000 Rush Yds",narrative:"Two thousand yards on the ground. That's not a running back. That's a freight train with a highlight reel."},
              {pos:["RB"],stat:"rushYds",thresh:1500,tier:"ELITE",icon:"ðŸƒ",shortLabel:"1,500 Rush Yds",narrative:"Fifteen hundred rushing yards. Workhouse, game-changer, franchise cornerstone."},
              {pos:["RB"],stat:"rushYds",thresh:1000,tier:"NOTABLE",icon:"ðŸƒ",shortLabel:"1,000 Rush Yds",narrative:"The 1,000-yard club. Not everyone makes it. This back did."},
              {pos:["RB"],stat:"rushTD",thresh:15,tier:"ELITE",icon:"ðŸ”¥",shortLabel:"15 Rush TDs",narrative:"Fifteen rushing scores. The end zone knows this player's name by now."},
              // WR/TE
              {pos:["WR","TE"],stat:"recYds",thresh:1500,tier:"LEGENDARY",icon:"ðŸ“¡",shortLabel:"1,500 Rec Yds",narrative:"Fifteen hundred receiving yards. Uncoverable. Unguardable. Unmissable."},
              {pos:["WR","TE"],stat:"recYds",thresh:1200,tier:"ELITE",icon:"ðŸ“¡",shortLabel:"1,200 Rec Yds",narrative:"Twelve hundred yards through the air. The receiver market just got reset."},
              {pos:["WR","TE"],stat:"recYds",thresh:800,tier:"NOTABLE",icon:"ðŸ“¡",shortLabel:"800 Rec Yds",narrative:"Eight hundred receiving yards. A legitimate weapon in this offense."},
              {pos:["WR","TE"],stat:"recTD",thresh:12,tier:"ELITE",icon:"ðŸ™Œ",shortLabel:"12 Rec TDs",narrative:"Twelve touchdown receptions. Someone's cashing in on red zone looks."},
              // DL/LB
              {pos:["DL","LB"],stat:"sacks",thresh:20,tier:"LEGENDARY",icon:"ðŸ’¥",shortLabel:"20 Sacks",narrative:"Twenty sacks in a single season. That's not a pass rusher â€” that's a wrecking ball with a contract extension attached."},
              {pos:["DL","LB"],stat:"sacks",thresh:15,tier:"ELITE",icon:"ðŸ’¥",shortLabel:"15 Sacks",narrative:"Fifteen sacks. Opposing offensive coordinators lose sleep over this player."},
              {pos:["DL","LB"],stat:"sacks",thresh:10,tier:"NOTABLE",icon:"ðŸ’¥",shortLabel:"10 Sacks",narrative:"Double-digit sacks. The double-team is coming every snap now."},
              // CB/S
              {pos:["CB","S"],stat:"defINT",thresh:10,tier:"LEGENDARY",icon:"ðŸ¦…",shortLabel:"10 INTs",narrative:"Ten interceptions in a season. That's historic. Lock this player up and never let them go."},
              {pos:["CB","S"],stat:"defINT",thresh:7,tier:"ELITE",icon:"ðŸ¦…",shortLabel:"7 INTs",narrative:"Seven picks. The secondary is a death sentence for opposing QBs."},
              {pos:["CB","S"],stat:"defINT",thresh:4,tier:"NOTABLE",icon:"ðŸ¦…",shortLabel:"4 INTs",narrative:"Four interceptions. The ballhawk is making plays when it matters."},
              // K
              {pos:["K"],stat:"fgM",thresh:35,tier:"LEGENDARY",icon:"ðŸŽ¯",shortLabel:"35 FGs Made",narrative:"Thirty-five field goals. Automatic. You could set your watch to this kicker."},
              {pos:["K"],stat:"fgM",thresh:25,tier:"ELITE",icon:"ðŸŽ¯",shortLabel:"25 FGs Made",narrative:"Twenty-five made field goals. Reliable. Clutch. An underrated franchise asset."}
            ];
            // Career thresholds for HOF Watch
            var DW_CAREER=[
              {pos:["QB"],stat:"passYds",thresh:50000,tier:"LEGENDARY",icon:"ðŸˆ",shortLabel:"50K Career Pass Yds",hof:true},
              {pos:["QB"],stat:"passTD",thresh:300,tier:"LEGENDARY",icon:"ðŸŽ¯",shortLabel:"300 Career Pass TDs",hof:true},
              {pos:["RB"],stat:"rushYds",thresh:15000,tier:"LEGENDARY",icon:"ðŸƒ",shortLabel:"15K Career Rush Yds",hof:true},
              {pos:["RB"],stat:"rushYds",thresh:10000,tier:"ELITE",icon:"ðŸƒ",shortLabel:"10K Career Rush Yds",hof:false},
              {pos:["WR","TE"],stat:"recYds",thresh:15000,tier:"LEGENDARY",icon:"ðŸ“¡",shortLabel:"15K Career Rec Yds",hof:true},
              {pos:["DL","LB"],stat:"sacks",thresh:100,tier:"LEGENDARY",icon:"ðŸ’¥",shortLabel:"100 Career Sacks",hof:true},
              {pos:["DL","LB"],stat:"sacks",thresh:50,tier:"ELITE",icon:"ðŸ’¥",shortLabel:"50 Career Sacks",hof:false},
              {pos:["CB","S"],stat:"defINT",thresh:50,tier:"LEGENDARY",icon:"ðŸ¦…",shortLabel:"50 Career INTs",hof:true}
            ];
            function safeMetricNum(v){
              var n=Number(v);
              return isFinite(n)?n:0;
            }
            // Build season achievements
            var seasonAch=[];
            var approaching=[];
            (my.roster||[]).forEach(function(p){
              if(!p||!p.stats)return;
              var arcBadge19=(p._arcState&&ARC_SPOTLIGHT.lines[p._arcState])?ARC_SPOTLIGHT.lines[p._arcState].badge:null;
              var arcColor19=(p._arcState&&ARC_SPOTLIGHT.lines[p._arcState])?ARC_SPOTLIGHT.lines[p._arcState].badgeColor:null;
              DW_SEASON.forEach(function(def){
                if(def.pos.indexOf(p.pos)<0)return;
                var val=safeMetricNum(p.stats[def.stat]);
                if(val>=def.thresh){
                  seasonAch.push({p:p,def:def,val:val,arcBadge:arcBadge19,arcColor:arcColor19});
                } else {
                  var pct=def.thresh>0?val/def.thresh:0;
                  if(!isFinite(pct))pct=0;
                  if(pct>=0.78){// within 22% of threshold
                    approaching.push({p:p,def:def,val:val,pct:pct,arcBadge:arcBadge19,arcColor:arcColor19});
                  }
                }
              });
            });
            // Sort: LEGENDARY first, then ELITE, then NOTABLE
            var tierOrder={LEGENDARY:0,ELITE:1,NOTABLE:2};
            seasonAch.sort(function(a,b){return (tierOrder[a.def.tier]||2)-(tierOrder[b.def.tier]||2);});
            // Deduplicate: skip lower tiers for same player+stat
            var seen={};
            seasonAch=seasonAch.filter(function(a){
              var k=a.p.id+a.def.stat;
              if(seen[k])return false;
              seen[k]=true;
              return true;
            });
            // Build HOF Watch
            var hofWatch=[];
            (my.roster||[]).forEach(function(p){
              if(!p)return;
              var cs=p.careerStats||{};
              var arcBadge19=(p._arcState&&ARC_SPOTLIGHT.lines[p._arcState])?ARC_SPOTLIGHT.lines[p._arcState].badge:null;
              var arcColor19=(p._arcState&&ARC_SPOTLIGHT.lines[p._arcState])?ARC_SPOTLIGHT.lines[p._arcState].badgeColor:null;
              DW_CAREER.forEach(function(def){
                if(def.pos.indexOf(p.pos)<0)return;
                // Estimate career total: careerStats from history + this season's stats
                var careerVal=safeMetricNum(cs[def.stat])+safeMetricNum((p.stats&&p.stats[def.stat]));
                var pct=def.thresh>0?careerVal/def.thresh:0;
                if(!isFinite(pct))pct=0;
                if(pct>=0.5){// at least halfway there
                  hofWatch.push({p:p,def:def,careerVal:careerVal,pct:Math.min(1,pct),arcBadge:arcBadge19,arcColor:arcColor19,achieved:careerVal>=def.thresh});
                }
              });
            });
            hofWatch.sort(function(a,b){return b.pct-a.pct;});
            // Approaching: sort by pct desc, dedupe same player+stat
            var seenA={};
            approaching=approaching.filter(function(a){
              var k=a.p.id+a.def.stat;
              if(seenA[k])return false;
              seenA[k]=true;
              return true;
            }).sort(function(a,b){return b.pct-a.pct;}).slice(0,5);

            return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8}},
              // Header
              React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(251,191,36,0.15),rgba(15,23,42,0.95))",borderRadius:12,padding:"14px 18px",border:"1px solid rgba(251,191,36,0.3)"}},
                React.createElement("div",{style:{fontSize:8,fontWeight:800,letterSpacing:3,color:T.gold,marginBottom:2}},"MFSN PRESENTS"),
                React.createElement("div",{style:{fontSize:18,fontWeight:900,color:"#fff",textShadow:"0 0 20px rgba(251,191,36,0.3)"}},"ðŸ† DYNASTY WATCH"),
                React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:2}},"Season "+((season&&season.year)||2026)+" Â· Week "+((season&&season.week)||1)+" Â· "+my.city+" "+my.name)
              ),
              // Approaching milestones (chase bar)
              approaching.length>0?React.createElement("div",{style:assign({},cS,{padding:0,overflow:"hidden",borderColor:"rgba(96,165,250,0.3)"})},
                React.createElement("div",{style:{background:"linear-gradient(90deg,rgba(96,165,250,0.15),rgba(15,23,42,0.9))",padding:"8px 12px",borderBottom:"1px solid rgba(96,165,250,0.2)"}},
                  React.createElement("div",{style:{fontSize:8,fontWeight:800,color:T.cyan,letterSpacing:2}},"â³ MILESTONE CHASE â€” CLOSING IN")
                ),
                approaching.map(function(a,ai){
                  var left=a.def.thresh-a.val;
                  var statLabel=a.def.stat==="passYds"?"pass yds":a.def.stat==="rushYds"?"rush yds":a.def.stat==="recYds"?"rec yds":a.def.stat==="passTD"?"pass TDs":a.def.stat==="rushTD"?"rush TDs":a.def.stat==="recTD"?"rec TDs":a.def.stat==="sacks"?"sacks":a.def.stat==="defINT"?"INTs":a.def.stat==="fgM"?"FGs":"stat";
                  var tierCol=(DW_TIERS[a.def.tier]||DW_TIERS.NOTABLE).color;
                  return React.createElement("div",{key:"ap"+ai,style:{padding:"8px 12px",borderBottom:ai<approaching.length-1?"1px solid "+T.border:"none"}},
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}},
                      React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",flex:1,flexWrap:"wrap"}},
                        React.createElement("span",{style:{fontSize:12,fontWeight:700,color:T.text}},a.p.name),
                        React.createElement("span",{style:{fontSize:9,color:T.dim}},a.p.pos+" Â· OVR "+a.p.ovr),
                        a.arcBadge?React.createElement("span",{style:{fontSize:7,fontWeight:800,color:a.arcColor,background:"rgba(0,0,0,0.3)",border:"1px solid "+a.arcColor+"55",borderRadius:8,padding:"1px 5px"}},(a.arcBadge)):null
                      ),
                      React.createElement("div",{style:{textAlign:"right",flexShrink:0}},
                        React.createElement("div",{style:{fontSize:9,fontWeight:700,color:tierCol}},(DW_TIERS[a.def.tier]||{}).badge+" "+a.def.shortLabel),
                        React.createElement("div",{style:{fontSize:8,color:T.faint}},left.toLocaleString()+" "+statLabel+" away")
                      )
                    ),
                    React.createElement("div",{style:{height:4,borderRadius:2,background:"rgba(255,255,255,0.08)",overflow:"hidden"}},
                      React.createElement("div",{style:{height:"100%",width:Math.round(a.pct*100)+"%",borderRadius:2,background:tierCol,transition:"width 0.3s"}})
                    )
                  );
                })
              ):null,
              // Season achievements
              seasonAch.length===0?React.createElement("div",{style:assign({},cS,{padding:20,textAlign:"center",color:T.faint})},"No milestone thresholds crossed yet this season. The chase is on â€” keep playing!"):
              React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:6}},
                React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,letterSpacing:2,marginTop:4}},"ðŸŽ–ï¸ THIS SEASON'S ACHIEVEMENTS"),
                seasonAch.map(function(a,ai){
                  var tier=DW_TIERS[a.def.tier]||DW_TIERS.NOTABLE;
                  var hasArc=!!a.arcBadge;
                  return React.createElement("div",{key:"sa"+ai,style:{background:tier.bg,borderRadius:10,border:"1px solid "+tier.border,padding:"12px 14px",boxShadow:"0 0 14px "+tier.glow}},
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:6}},
                      React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",flex:1,flexWrap:"wrap"}},
                        React.createElement("span",{style:{fontSize:28}},(a.def.icon)),
                        React.createElement("div",null,
                          React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}},
                            React.createElement("span",{style:{fontSize:13,fontWeight:900,color:"#fff"}},(a.p.name)),
                            React.createElement("span",{style:{fontSize:9,color:tier.color,fontWeight:700}},(a.p.pos+" Â· OVR "+a.p.ovr+" Â· Age "+a.p.age)),
                            hasArc?React.createElement("span",{style:{fontSize:8,fontWeight:800,color:a.arcColor,background:"rgba(0,0,0,0.35)",border:"1px solid "+a.arcColor+"55",borderRadius:10,padding:"1px 7px"}},(a.arcBadge)):null
                          ),
                          React.createElement("div",{style:{fontSize:10,fontWeight:800,color:tier.color,marginTop:2}},tier.badge+" "+tier.label+" Â· "+a.def.shortLabel)
                        )
                      ),
                      React.createElement("div",{style:{textAlign:"right",flexShrink:0}},
                        React.createElement("div",{style:{fontSize:20,fontWeight:900,color:tier.color}},(a.val.toLocaleString())),
                        React.createElement("div",{style:{fontSize:7,color:T.faint,letterSpacing:1}},a.def.stat.toUpperCase())
                      )
                    ),
                    React.createElement("div",{style:{fontSize:9,fontStyle:"italic",color:"rgba(255,255,255,0.65)",lineHeight:1.4}},('"'+a.def.narrative+(hasArc?" And "+a.p.name.split(" ")[0]+" is on a "+a.arcBadge+" arc right now. The story is writing itself.":"")+'"'))
                  );
                })
              ),
              // HOF Watch
              hofWatch.length>0?React.createElement("div",{style:assign({},cS,{padding:0,overflow:"hidden",borderColor:"rgba(168,85,247,0.4)"})},
                React.createElement("div",{style:{background:"linear-gradient(90deg,rgba(168,85,247,0.18),rgba(15,23,42,0.9))",padding:"8px 12px",borderBottom:"1px solid rgba(168,85,247,0.25)"}},
                  React.createElement("div",{style:{fontSize:8,fontWeight:800,color:"#a855f7",letterSpacing:2}},"ðŸ›ï¸ HALL OF FAME WATCH â€” CAREER TRAJECTORIES")
                ),
                hofWatch.slice(0,6).map(function(h,hi){
                  var tier=DW_TIERS[h.def.tier]||DW_TIERS.NOTABLE;
                  var pctDisplay=Math.round(h.pct*100);
                  return React.createElement("div",{key:"hw"+hi,style:{padding:"8px 12px",borderBottom:hi<Math.min(hofWatch.length,6)-1?"1px solid "+T.border:"none"}},
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3}},
                      React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",flex:1,flexWrap:"wrap"}},
                        React.createElement("span",{style:{fontSize:11}},(h.def.icon)),
                        React.createElement("span",{style:{fontSize:11,fontWeight:700,color:h.achieved?tier.color:T.text}},(h.p.name)),
                        React.createElement("span",{style:{fontSize:9,color:T.dim}},(h.p.pos+" Â· OVR "+h.p.ovr)),
                        h.arcBadge?React.createElement("span",{style:{fontSize:7,fontWeight:800,color:h.arcColor,background:"rgba(0,0,0,0.3)",border:"1px solid "+h.arcColor+"55",borderRadius:8,padding:"1px 5px"}},(h.arcBadge)):null,
                        h.achieved?React.createElement("span",{style:{fontSize:8,fontWeight:800,color:tier.color,background:tier.color+"22",borderRadius:8,padding:"1px 6px"}},"âœ… ACHIEVED"):null
                      ),
                      React.createElement("div",{style:{textAlign:"right",flexShrink:0}},
                        React.createElement("div",{style:{fontSize:9,fontWeight:700,color:h.achieved?tier.color:T.dim}},(h.careerVal.toLocaleString()+" / "+h.def.thresh.toLocaleString())),
                        React.createElement("div",{style:{fontSize:8,color:tier.color,fontWeight:800}},(pctDisplay+"%"))
                      )
                    ),
                    React.createElement("div",{style:{height:3,borderRadius:2,background:"rgba(255,255,255,0.08)"}},
                      React.createElement("div",{style:{height:"100%",width:pctDisplay+"%",borderRadius:2,background:h.achieved?"#a855f7":tier.color,opacity:h.achieved?1:0.7}})
                    ),
                    React.createElement("div",{style:{fontSize:8,color:T.faint,marginTop:2}},(tier.badge+" "+h.def.shortLabel+(h.def.hof?" Â· Hall of Fame threshold":"")))
                  );
                })
              ):null
            );
          })()}
          
          
          {tab==="staff"&&my&&my.staff&&(function(){
            var coaches81=[{role:"HC",coach:my.staff.hc},{role:"OC",coach:my.staff.oc},{role:"DC",coach:my.staff.dc}];
            var hasAnyTree=coaches81.some(function(c){return c.coach&&c.coach.level>=3;});
            if(!hasAnyTree)return null;
            return React.createElement("div",{style:{padding:12}},
              React.createElement("div",{style:{fontSize:14,fontWeight:900,color:T.purple,marginBottom:8,letterSpacing:1}},"ðŸŒ³ COACH SKILL TREES"),
              coaches81.map(function(c81){
                if(!c81.coach||c81.coach.level<3)return null;
                var treeKey=COACH_SKILL_TREE.getTreeKey(c81.coach.arch||"Disciplinarian");
                var tree=COACH_SKILL_TREE.trees[treeKey];
                if(!tree)return null;
                var cId=c81.coach.id||c81.role;
                var sel=coachSkillTree81[cId];
                return React.createElement("div",{key:c81.role,style:mS(S.card,{padding:12,marginBottom:8})},
                  React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.cyan,marginBottom:6}},c81.role+": "+c81.coach.name+" (Lv."+c81.coach.level+" "+c81.coach.arch+")"),
                  tree.branches.map(function(branch){
                    var isChosen=sel&&sel.branch===branch.id;
                    var canChoose=!sel&&c81.coach.level>=3;
                    var isLocked=sel&&!isChosen;
                    return React.createElement("div",{key:branch.id,style:{padding:8,marginBottom:4,borderRadius:8,
                      background:isChosen?"rgba(168,85,247,0.08)":"transparent",
                      border:isChosen?"1px solid "+T.purple+"66":"1px solid "+T.border,
                      opacity:isLocked?0.35:1,cursor:canChoose?"pointer":"default"},
                      onClick:canChoose?function(){
                        setCoachSkillTree81(function(prev){var u=assign({},prev);u[cId]={branch:branch.id,tier:1,archForLookup:c81.coach.arch};return u;});
                        addN("ðŸŒ³ "+c81.coach.name+" chose the "+branch.name+" specialization!","purple");
                      }:null},
                      React.createElement("div",{style:{fontSize:10,fontWeight:700,marginBottom:4}},branch.icon+" "+branch.name+(canChoose?" (click to choose)":"")),
                      branch.tiers.map(function(tier,ti){
                        var unlocked=isChosen&&sel.tier>ti;
                        var canUnlock=isChosen&&sel.tier===ti+1&&c81.coach.level>=tier.level;
                        return React.createElement("div",{key:ti,style:{fontSize:8,padding:"2px 6px",marginTop:2,display:"flex",justifyContent:"space-between",alignItems:"center",
                          color:unlocked?T.green:canUnlock?T.gold:T.faint}},
                          React.createElement("span",null,(unlocked?"âœ… ":"ðŸ”’ ")+"Lv."+tier.level+": "+tier.label+" â€” "+tier.desc),
                          canUnlock?React.createElement("button",{style:{fontSize:7,padding:"2px 6px",borderRadius:4,background:T.gold,color:"#000",border:"none",cursor:"pointer",fontWeight:700},
                            onClick:function(e){e.stopPropagation();
                              setCoachSkillTree81(function(prev){var u=assign({},prev);u[cId]=assign({},u[cId],{tier:ti+2});return u;});
                              addN("â¬†ï¸ "+c81.coach.name+" unlocked "+tier.label+"!","gold");
                            }},"UNLOCK"):null
                        );
                      })
                    );
                  })
                );
              })
            );
          })()}
          {tab==="capLab" && (function(){
            var posGroups2=["QB","RB","WR","TE","OL","DL","LB","CB","S","K","P"];
            var capByPos={};var totalCap=0;
            posGroups2.forEach(function(pos){capByPos[pos]=0;});
            my.roster.forEach(function(p){var hit=v36_capHit(p.contract);capByPos[p.pos]=(capByPos[p.pos]||0)+hit;totalCap+=hit;});
            var theCap35=getSalaryCap(season.year);var dead35=(my.deadCap||0);
            var room2=Math.round((theCap35-totalCap-dead35)*10)/10;
            var floor35=getCapFloor(season.year);var aboveFloor35=(totalCap+dead35)>=floor35;
            var expiring=my.roster.filter(function(p){return p.contract.years<=1;});
            var topContracts=my.roster.slice().sort(function(a,b){return v36_capHit(b.contract)-v36_capHit(a.contract);}).slice(0,10);
            var cashBudget=calcCashBudget(my,season.year);
            var cashUsed=Math.round(my.roster.reduce(function(s,p){return s+v36_cashPaid(p.contract);},0)*10)/10;
            var cashAvail=Math.round(((my.cash||50)-cashUsed)*10)/10;
            var mkt=getMarketTier(my.abbr);
            var proj35=[];for(var yy=0;yy<3;yy++){
              var fC=getSalaryCap(season.year+yy);var fU=Math.round(sum(my.roster,function(p){return p.contract.years>yy?v36_capHit(p.contract):0;})*10)/10;
              var fD=my.deadCapByYear?Math.round((my.deadCapByYear[String(season.year+yy)]||0)*10)/10:0;
              proj35.push({yr:season.year+yy,cap:fC,used:fU,dead:fD,space:Math.round((fC-fU-fD)*10)/10});}
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:900,fontSize:16,color:T.gold}}>{"ðŸ¦ CAP LAB â€” The Iron Bank"}</div>
              {my.franchiseTag973 && <div style={{
                background:"rgba(168,85,247,0.1)", border:"1px solid rgba(168,85,247,0.3)",
                borderRadius:8, padding:"8px 12px"
              }}>
                <div style={{fontSize:11, fontWeight:900, color:"#a855f7"}}>
                  {"ðŸ·ï¸ FRANCHISE TAG: "+my.franchiseTag973.playerName+" ("+my.franchiseTag973.pos+") â€” $"+my.franchiseTag973.salary+"M"+(my.franchiseTag973.year?(" â€¢ "+my.franchiseTag973.year):"")}
                </div>
                <div style={{fontSize:9, color:
                  my.franchiseTag973.reaction==="happy" ? T.green :
                  my.franchiseTag973.reaction==="holdout" ? T.red :
                  my.franchiseTag973.reaction==="unhappy" ? T.orange : T.gold}}>
                  {my.franchiseTag973.reaction==="happy" ? "âœ… Player accepted the tag gracefully" :
                   my.franchiseTag973.reaction==="holdout" ? "ðŸš¨ HOLDOUT â€” Player refusing to report until long-term deal" :
                   my.franchiseTag973.reaction==="unhappy" ? "ðŸ˜¤ Playing under protest â€” chemistry dipped" :
                   "ðŸ“‹ Playing under the tag â€” monitoring situation"}
                </div>
                {my.franchiseTag973.reaction==="holdout" && <div style={{display:"flex",gap:6,marginTop:6,flexWrap:"wrap"}}>
                  <button style={bS(T.green,"#000")} onClick={function(){handleTaggedHoldoutAction973("pay");}}>{"ðŸ’° Pay the Man"}</button>
                  <button style={bS(T.orange,"#000")} onClick={function(){handleTaggedHoldoutAction973("wait");}}>{"â³ Wait It Out"}</button>
                  <button style={bS(T.red,"#fff")} onClick={function(){handleTaggedHoldoutAction973("trade");}}>{"ðŸ”„ Trade Him"}</button>
                </div>}
              </div>}
              
              {(function(){
                var cv=buildCapVisualization(my);
                if(!cv)return null;
                return <div style={assign({},cS,{borderColor:"rgba(96,165,250,0.3)"})}>
                  <div style={{fontSize:10,color:T.cyan,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ’° POSITION CAP BREAKDOWN"}</div>
                  {cv.breakdown.slice(0,8).map(function(bp,bi){
                    return <div key={bi} style={{display:"flex",gap:6,alignItems:"center",marginBottom:2}}>
                      <span style={{width:20,fontSize:9,fontWeight:700,color:T.faint}}>{bp.pos}</span>
                      <div style={{flex:1,height:10,background:T.bg3,borderRadius:4,overflow:"hidden"}}>
                        <div style={{width:Math.max(2,bp.pct)+"%",height:"100%",background:bp.pct>25?"#ef4444":bp.pct>15?"#f59e0b":"#60a5fa",borderRadius:4}}></div>
                      </div>
                      <span style={{fontSize:8,fontWeight:700,width:40,textAlign:"right"}}>{"$"+bp.cap+"M"}</span>
                      <span style={{fontSize:7,color:T.faint,width:24}}>{bp.pct+"%"}</span>
                    </div>;
                  })}
                  <div style={{display:"flex",justifyContent:"space-between",marginTop:6,fontSize:9,borderTop:"1px solid "+T.border,paddingTop:4}}>
                    <span>{"Used: $"+cv.totalUsed+"M"}</span>
                    <span>{"Dead: $"+cv.deadCap+"M"}</span>
                    <span style={{color:cv.capRoom<10?T.red:T.green,fontWeight:700}}>{"Space: $"+cv.capRoom+"M"}</span>
                  </div>
                  {cv.topHits.length>0 && <div style={{marginTop:6}}>
                    <div style={{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}}>{"TOP CAP HITS"}</div>
                    {cv.topHits.slice(0,5).map(function(h,hi){
                      return <div key={hi} style={{display:"flex",gap:4,alignItems:"center",fontSize:8,padding:"1px 0"}}>
                        <span style={{flex:1,fontWeight:700}}>{h.name}</span>
                        <span style={{color:T.cyan}}>{h.pos}</span>
                        <span>{h.ovr+" OVR"}</span>
                        <span style={{fontWeight:700}}>{"$"+h.salary+"M"}</span>
                        <span style={{fontSize:7,color:h.value.indexOf("âœ…")>=0?T.green:h.value.indexOf("âš ï¸")>=0?T.orange:T.red}}>{h.value}</span>
                      </div>;
                    })}
                  </div>}
                  {cv.projections.length>0 && <div style={{marginTop:6}}>
                    <div style={{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}}>{"3-YEAR PROJECTION"}</div>
                    <div style={{display:"flex",gap:8}}>
                      {cv.projections.map(function(pr,pi){
                        return <div key={pi} style={{flex:1,background:T.bg3,borderRadius:4,padding:4,textAlign:"center"}}>
                          <div style={{fontSize:8,fontWeight:700}}>{pr.year}</div>
                          <div style={{fontSize:10,fontWeight:800,color:pr.space<10?T.red:T.green}}>{"$"+pr.space+"M"}</div>
                          <div style={{fontSize:7,color:T.faint}}>{"space"}</div>
                          {pr.warning && <div style={{fontSize:7,color:T.orange,fontWeight:700}}>{pr.warning}</div>}
                        </div>;
                      })}
                    </div>
                  </div>}
                </div>;
              })()}
              
              <div style={{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6}}>
                <div style={{background:T.bg3,borderRadius:6,padding:8,textAlign:"center"}}>
                  <div style={{fontSize:16,fontWeight:800,color:T.cyan}}>{"$"+theCap35+"M"}</div>
                  <div style={{fontSize:9,color:T.faint}}>{"Salary Cap"}</div>
                </div>
                <div style={{background:T.bg3,borderRadius:6,padding:8,textAlign:"center"}}>
                  <div style={{fontSize:16,fontWeight:800,color:T.txt}}>{"$"+Math.round(totalCap*10)/10+"M"}</div>
                  <div style={{fontSize:9,color:T.faint}}>{"Cap Used"}</div>
                </div>
                <div style={{background:T.bg3,borderRadius:6,padding:8,textAlign:"center"}}>
                  <div style={{fontSize:16,fontWeight:800,color:dead35>15?"#ef4444":T.orange}}>{"$"+dead35.toFixed(1)+"M"}</div>
                  <div style={{fontSize:9,color:T.faint}}>{"â˜ ï¸ Dead Cap"}</div>
                </div>
                <div style={{background:T.bg3,borderRadius:6,padding:8,textAlign:"center"}}>
                  <div style={{fontSize:16,fontWeight:800,color:room2<0?"#ef4444":room2<20?"#f59e0b":"#22c55e"}}>{"$"+room2+"M"}</div>
                  <div style={{fontSize:9,color:T.faint}}>{"Cap Space"}</div>
                </div>
                <div style={{background:T.bg3,borderRadius:6,padding:8,textAlign:"center"}}>
                  <div style={{fontSize:16,fontWeight:800,color:cashAvail<10?"#ef4444":"#22c55e"}}>{"$"+Math.round((my.cash||0)*10)/10+"M"}</div>
                  <div style={{fontSize:9,color:T.faint}}>{"ðŸ’µ Cash"}</div>
                </div>
              </div>
              
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.cyan,marginBottom:6}}>{"ðŸ“Š CAP vs CASH"}</div>
                <div style={{marginBottom:8}}>
                  <div style={{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:2}}>
                    <span style={{color:T.faint}}>{"SALARY CAP"}</span>
                    <span>{Math.round(totalCap+dead35)+"M / "+theCap35+"M ("+Math.round((totalCap+dead35)/theCap35*100)+"%)"}</span>
                  </div>
                  <div style={{height:16,background:T.bg3,borderRadius:4,overflow:"hidden",position:"relative"}}>
                    <div style={{width:Math.min(100,Math.round(totalCap/theCap35*100))+"%",height:"100%",background:T.cyan,borderRadius:"4px 0 0 4px"}}></div>
                    {dead35>0&&<div style={{position:"absolute",left:Math.round(totalCap/theCap35*100)+"%",top:0,width:Math.min(100-Math.round(totalCap/theCap35*100),Math.round(dead35/theCap35*100))+"%",height:"100%",background:"rgba(239,68,68,0.6)"}}></div>}
                  </div>
                </div>
                <div>
                  <div style={{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:2}}>
                    <span style={{color:T.faint}}>{"CASH BUDGET"}</span>
                    <span>{"$"+Math.round((my.cash||0)*10)/10+"M avail | "+mkt.label+" ("+((my.ownerSpendRate||1)*100).toFixed(0)+"% spend rate)"}</span>
                  </div>
                  <div style={{height:16,background:T.bg3,borderRadius:4,overflow:"hidden"}}>
                    <div style={{width:Math.min(100,Math.round(Math.max(0,cashBudget-(my.cash||0))/cashBudget*100))+"%",height:"100%",background:"#22c55e",borderRadius:"4px 0 0 4px"}}></div>
                  </div>
                </div>
              </div>
              {!aboveFloor35 && <div style={{background:"rgba(239,68,68,0.12)",border:"1px solid #ef4444",borderRadius:6,padding:8,fontSize:11,color:"#ef4444",fontWeight:700}}>
                {"âš ï¸ BELOW CAP FLOOR â€” Must spend at least $"+floor35+"M (90% of cap)"}
              </div>}
              
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.cyan,marginBottom:6}}>{"ðŸ“Š 3-YEAR CAP PROJECTION"}</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:4,fontSize:10,color:T.faint,fontWeight:700}}>
                  <div>{"YEAR"}</div><div>{"CAP"}</div><div>{"COMMITTED"}</div><div>{"SPACE"}</div>
                </div>
                {proj35.map(function(row){return <div key={row.yr} style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:4,fontSize:11,padding:"4px 0",borderTop:"1px solid "+T.border}}>
                  <div style={{fontWeight:700}}>{row.yr}</div><div>{"$"+row.cap+"M"}</div>
                  <div><span style={{color:T.cyan}}>{"$"+row.used+"M"}</span>{row.dead>0?<span style={{color:"#ef4444"}}>{" +$"+row.dead+"Mâ˜ ï¸"}</span>:null}</div>
                  <div style={{color:row.space<0?"#ef4444":row.space<15?"#f59e0b":"#22c55e",fontWeight:700}}>{"$"+row.space+"M"}</div>
                </div>;})}
              </div>
              {(function(){
                var cliffYear = null;
                var cliffSeverity = null;
                proj35.forEach(function(p) {
                  if (p.space < 5 && !cliffYear) {
                    cliffYear = p.yr;
                    cliffSeverity = p.space < 0 ? "CRITICAL" : p.space < 5 ? "WARNING" : null;
                  }
                });
                if (!cliffYear) return null;
                return React.createElement("div", {style: {
                  background: cliffSeverity === "CRITICAL" ? "rgba(239,68,68,0.12)" : "rgba(251,146,60,0.1)",
                  border: "1px solid " + (cliffSeverity === "CRITICAL" ? "rgba(239,68,68,0.4)" : "rgba(251,146,60,0.3)"),
                  borderRadius: 8, padding: "10px 12px", marginTop: 0
                }},
                  React.createElement("div", {style: {fontSize: 11, fontWeight: 900,
                    color: cliffSeverity === "CRITICAL" ? "#ef4444" : "#f97316", marginBottom: 4}},
                    (cliffSeverity === "CRITICAL" ? "ðŸš¨ CAP CLIFF â€” CRITICAL" : "âš ï¸ CAP CLIFF WARNING") + " (" + cliffYear + ")"
                  ),
                  React.createElement("div", {style: {fontSize: 10, color: T.dim}},
                    cliffSeverity === "CRITICAL"
                      ? "You're projected OVER the cap in " + cliffYear + ". You must cut, trade, or restructure to get compliant."
                      : "Cap space drops below $5M in " + cliffYear + ". Consider extending cheap deals or planning roster cuts."
                  ),
                  React.createElement("div", {style: {fontSize: 9, color: T.faint, marginTop: 4}},
                    "ðŸ’¡ Tip: Restructuring pushes money forward â€” it helps NOW but makes the cliff worse. Extensions + cuts are the real fix."
                  )
                );
              })()}
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:6}}>{"CAP BY POSITION"}</div>
                {posGroups2.map(function(pos){var amt=capByPos[pos]||0;var pct=totalCap>0?Math.round(amt/totalCap*100):0;
                  return <div key={pos} style={{display:"flex",alignItems:"center",gap:8,padding:"3px 0"}}>
                    <span style={{width:24,fontWeight:700,color:T.gold,fontSize:11}}>{pos}</span>
                    <div style={{flex:1,height:12,background:T.bg3,borderRadius:4,overflow:"hidden"}}>
                      <div style={{width:pct+"%",height:"100%",background:pct>25?T.red:pct>15?T.orange:T.green,borderRadius:4}}></div>
                    </div>
                    <span style={{fontSize:10,width:60,textAlign:"right"}}>{"$"+amt.toFixed(1)+"M ("+pct+"%)"}</span>
                  </div>;
                })}
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:6}}>{"ðŸ’¸ BIGGEST CONTRACTS â€” v36 Dead Cap Preview"}</div>
                {topContracts.map(function(p){
                  var hit35=v36_capHit(p.contract);var deadCut=v36_deadIfCut(p.contract);var deadTrade=v36_deadIfTraded(p.contract);
                  var tradeSave=v36_tradeSavings(p.contract);
                  var canR35=canDoAction(season.phase,"canRestructure")&&p.contract.years>1&&(p.contract.baseSalary||v36_capHit(p.contract))>getMinSalary(Math.max((p.age||22)-22,0))+1.0&&!p.contract.restructured;
                  var canVoid73=canDoAction(season.phase,"canRestructure")&&p.contract.years>1&&p.contract.prorated>0&&(p.contract.voidYears||0)<3;// v73
                  return <div key={p.id} style={{display:"flex",flexDirection:"column",padding:"5px 0",borderBottom:"1px solid "+T.border,fontSize:11,gap:2}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <span style={{cursor:"pointer",textDecoration:"underline",textDecorationColor:T.border}} onClick={function(){setPlayerDetail(p);}}>{p.name+" ("+p.pos+")"}</span>
                    <div style={{display:"flex",gap:6,alignItems:"center"}}>
                      <span style={{fontWeight:700}}>{"$"+hit35+"M/"+p.contract.years+"yr"+(p.contract.voidYears?" +"+p.contract.voidYears+"v":"")}</span>
                      {canR35 && <button onClick={function(){restructure(p.id);}} style={{background:"rgba(52,211,153,0.15)",border:"1px solid "+T.green,color:T.green,
                        borderRadius:4,padding:"2px 8px",fontSize:9,cursor:"pointer",fontWeight:700,whiteSpace:"nowrap"}}>
                        {"ðŸ’° Restructure"}
                      </button>}
                      {canVoid73 && <button onClick={function(){addVoidYearsToPlayer(p.id);}} style={{background:"rgba(251,191,36,0.15)",border:"1px solid "+T.orange,color:T.orange,
                        borderRadius:4,padding:"2px 8px",fontSize:9,cursor:"pointer",fontWeight:700,whiteSpace:"nowrap"}}>
                        {"ðŸ¦ Void Year"}
                      </button>}
                    </div>
                  </div>
                  
                  <div style={{display:"flex",gap:12,fontSize:9,color:T.dim,flexWrap:"wrap"}}>
                    {deadCut>0&&<span style={{color:"#ef4444"}}>{"âœ‚ï¸ Cut: $"+deadCut+"M dead"}</span>}
                    {deadTrade>0&&<span style={{color:"#f59e0b"}}>{"ðŸ”„ Trade: $"+deadTrade+"M dead"+(tradeSave>=0?" (+$"+tradeSave+"M save)":" ($"+Math.abs(tradeSave)+"M LOSS)")}</span>}
                    {p.contract.baseSalary!==undefined&&<span>{"ðŸ’µ Cash: $"+v36_cashPaid(p.contract)+"M/yr"}</span>}
                    {p.contract.voidYears>0&&<span style={{color:"#ef4444",fontWeight:700}}>{"âš ï¸ "+p.contract.voidYears+" void yr"+(p.contract.voidYears>1?"s":"")+" ($"+voidYearDeadCap(p.contract)+"M bomb)"}</span>}
                  </div>
                </div>;})}
              </div>
              
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:"#a78bfa",marginBottom:6}}>{"ðŸ” SCOUT STAFF"}</div>
                {(my.scouts||[]).map(function(sc,si){
                  return <div key={sc.id||si} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 0",borderBottom:"1px solid "+T.border,fontSize:11}}>
                    <div>
                      <span style={{fontWeight:700,color:T.txt}}>{sc.name}</span>
                      <span style={{fontSize:9,color:T.dim,marginLeft:6}}>{"Acc: "+sc.accuracy+" | "+sc.specialty+" specialist"}</span>
                    </div>
                    <div style={{display:"flex",gap:6,alignItems:"center"}}>
                      <span style={{fontSize:9,padding:"1px 6px",background:"rgba(167,139,250,0.15)",borderRadius:4,color:"#a78bfa"}}>{sc.bias==="balanced"?"Neutral":sc.bias.replace("loves_","Loves ")}</span>
                      <span style={{fontSize:9,color:T.dim}}>{"$"+sc.salary+"M"}</span>
                    </div>
                  </div>;
                })}
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.orange,marginBottom:6}}>{"âš ï¸ EXPIRING CONTRACTS ("+expiring.length+")"}</div>
                {expiring.sort(function(a,b){return b.ovr-a.ovr;}).slice(0,10).map(function(p){return <div key={p.id} style={{display:"flex",justifyContent:"space-between",padding:"3px 0",borderBottom:"1px solid "+T.border,fontSize:11}}>
                  <span>{p.name+" ("+p.pos+" "+p.ovr+")"}</span>
                  <span style={{color:T.red}}>{"$"+v36_capHit(p.contract)+"M â€” Last Year"}</span>
                </div>;})}
              </div>
              
              {(function(){
                var fixes=buildCapFixes(my,season.year);
                if(fixes.length===0)return <div style={assign({},cS,{borderColor:"rgba(16,185,129,0.3)"})}>
                  <div style={{fontSize:10,color:T.green,fontWeight:700}}>{"âœ… CAP HEALTH: GOOD"}</div>
                  <div style={{fontSize:9,color:T.dim,marginTop:2}}>{"You have cap room. No fixes needed right now."}</div>
                </div>;
                var totalSavings=fixes.reduce(function(s,f){return s+f.savings;},0);
                return <div style={assign({},cS,{borderColor:"rgba(239,68,68,0.3)",background:"rgba(239,68,68,0.03)"})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                    <div style={{fontSize:10,color:T.red,fontWeight:700,letterSpacing:1}}>{"ðŸ”§ FIX MY CAP â€” "+fixes.length+" Options"}</div>
                    <span style={{fontSize:9,color:T.green,fontWeight:700}}>{"Potential savings: $"+Math.round(totalSavings*10)/10+"M"}</span>
                  </div>
                  {fixes.slice(0,6).map(function(fix,fi){
                    var bgCol=fix.type==="restructure"?"rgba(96,165,250,0.06)":fix.type==="cut"?"rgba(239,68,68,0.06)":"rgba(251,191,36,0.06)";
                    var borderCol=fix.type==="restructure"?T.cyan:fix.type==="cut"?T.red:T.gold;
                    return <div key={fi} style={{padding:6,marginBottom:4,borderRadius:6,background:bgCol,borderLeft:"3px solid "+borderCol}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                        <div>
                          <span style={{fontWeight:800,fontSize:11}}>{fix.emoji+" "+fix.player}</span>
                          <span style={{fontSize:9,color:T.faint,marginLeft:4}}>{fix.pos+" "+fix.ovr+" OVR"}</span>
                        </div>
                        <span style={{fontSize:10,fontWeight:900,color:T.green}}>{"$"+fix.savings+"M"}</span>
                      </div>
                      <div style={{fontSize:9,color:T.dim,marginTop:2}}>{fix.desc}</div>
                      <div style={{fontSize:8,color:fix.type==="cut"?T.red:T.faint,marginTop:1}}>{"âš ï¸ "+fix.risk}</div>
                    </div>;
                  })}
                </div>;
              })()}
              
              {canDoAction(season.phase,"canRestructure") && <div style={assign({},cS,{borderColor:"rgba(251,191,36,0.3)",textAlign:"center"})}>
                <button onClick={function(){doCascadeRestructure();}} style={{background:"rgba(251,191,36,0.15)",border:"1px solid "+T.orange,color:T.orange,
                  borderRadius:6,padding:"6px 16px",fontSize:11,cursor:"pointer",fontWeight:700}}>
                  {"ðŸ¦ CASCADE RESTRUCTURE â€” Auto-fix cap with multiple restructures"}
                </button>
                <div style={{fontSize:8,color:T.faint,marginTop:4}}>{"Restructures your biggest contracts in sequence until you're under the cap + $5M buffer. Adds future dead cap risk."}</div>
          
          {tab==="capLab"&&my&&(function(){
            var foCapB81=FRONT_OFFICE.getBonus(frontOffice78,"restructure");
            var totalDead81=Math.round(my.roster.reduce(function(s,p){var c=p.contract;if(!c)return s;return s+(c.prorated||0)*(c.years||0);},0)*10)/10;
            var activeTab973=(capRestructTab==="backload"||capRestructTab==="extend")?capRestructTab:"restructure";
            var tabs973=[
              {id:"restructure",label:"ðŸ’° Restructure",color:T.cyan},
              {id:"backload",label:"ðŸ¦ Backload",color:T.orange},
              {id:"extend",label:"ðŸ§¾ Extend + Restructure",color:"#a78bfa"}
            ];
            function isEligible973(p){
              var c=p&&p.contract;
              if(!c||c.baseSalary===undefined)return false;
              if((c.baseSalary||0)<3)return false;
              if(c.isTagged)return false;
              if(activeTab973==="restructure"){
                if(c.years<=1||c.restructured)return false;
                var yoe973=Math.max((p.age||22)-22,0);
                return (c.baseSalary||0)>=(getMinSalary(yoe973)+1.0);
              }
              if(activeTab973==="backload"){
                return c.years>1&&!c.backloaded;
              }
              if(activeTab973==="extend"){
                return (c.years||0)>=1&&!c.restructured;
              }
              return false;
            }
            function clonePlayer973(p){
              return assign({},p,{contract:assign({},p.contract||{})});
            }
            function buildPreview973(p){
              var beforeC=p.contract||{};
              var beforeHit=Math.round(v36_capHit(beforeC)*10)/10;
              var beforeDead=Math.round(v36_deadIfCut(beforeC)*10)/10;
              var mock=clonePlayer973(p);
              var res;
              if(activeTab973==="restructure")res=restructureContract(mock);
              else if(activeTab973==="backload")res=backloadContract973(mock,2);
              else res=extendAndRestructure973(mock,2);
              var afterC=mock.contract||beforeC;
              return {
                ok:!!(res&&res.ok),
                res:res||{ok:false,msg:"Preview failed."},
                beforeHit:beforeHit,
                afterHit:Math.round(v36_capHit(afterC)*10)/10,
                beforeDead:beforeDead,
                afterDead:Math.round(v36_deadIfCut(afterC)*10)/10,
                afterVoid:afterC.voidYears||0,
                afterYears:afterC.years||0
              };
            }
            function runAction973(pid){
              if(activeTab973==="restructure")restructure(pid);
              else if(activeTab973==="backload")backloadPlayer973(pid);
              else extendAndRestructurePlayer973(pid);
            }
            function actionBtn973(){
              return activeTab973==="restructure"?"Restructure":activeTab973==="backload"?"Backload":"Extend+Restructure";
            }
            function actionColor973(){
              return activeTab973==="restructure"?T.cyan:activeTab973==="backload"?T.orange:"#a78bfa";
            }
            var eligible81=(my.roster||[]).filter(isEligible973).sort(function(a,b){
              return v36_capHit(b.contract)-v36_capHit(a.contract)||((b.ovr||0)-(a.ovr||0));
            });
            return <div style={{padding:12,marginTop:8}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,flexWrap:"wrap",gap:6}}>
                <div style={{fontSize:14,fontWeight:900,color:T.cyan,letterSpacing:1}}>{"ðŸ’° CAP RESTRUCTURE CENTER"}</div>
                <div style={{fontSize:9,padding:"3px 8px",borderRadius:6,background:"rgba(239,68,68,0.1)",color:T.red,fontWeight:700}}>{"Dead Cap Exposure: $"+totalDead81+"M"}</div>
              </div>
              {foCapB81>0&&<div style={{fontSize:8,color:T.green,marginBottom:6}}>{"ðŸ’¼ Cap Analyst bonus: "+Math.round(foCapB81*5)+"% dead cap reduction active"}</div>}
              <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:8}}>
                {tabs973.map(function(tb973){
                  var active973=activeTab973===tb973.id;
                  return <button key={tb973.id} onClick={function(){setCapRestructTab(tb973.id);}} style={{
                    fontSize:9,padding:"4px 10px",borderRadius:6,cursor:"pointer",fontWeight:700,
                    background:active973?(tb973.color+"22"):"rgba(255,255,255,0.04)",
                    border:"1px solid "+(active973?tb973.color:T.border),color:active973?tb973.color:T.dim
                  }}>{tb973.label}</button>;
                })}
              </div>
              <div style={{fontSize:8,color:T.faint,marginBottom:6}}>
                {activeTab973==="restructure" ? "Convert base salary into bonus to create immediate cap relief (future dead-cap risk rises)." :
                 activeTab973==="backload" ? "Push more money into future years and add void years to reduce this year's hit." :
                 "Add years, then restructure. Best for long-term core players you plan to keep."}
              </div>
              {eligible81.length===0 ? <div style={{padding:"10px 12px",borderRadius:8,background:"rgba(255,255,255,0.03)",border:"1px solid "+T.border,fontSize:10,color:T.dim}}>
                {"No eligible players for "+(activeTab973==="extend"?"Extend + Restructure":activeTab973.charAt(0).toUpperCase()+activeTab973.slice(1))+" right now."}
              </div> : eligible81.slice(0,10).map(function(p,i){
                var c=p.contract||{};
                var pv=buildPreview973(p);
                var beforeHit=pv.beforeHit;
                var afterHit=pv.afterHit;
                var deltaHit=Math.round((beforeHit-afterHit)*10)/10;
                var riskDelta=Math.round((pv.afterDead-pv.beforeDead)*10)/10;
                var accent=actionColor973();
                return <div key={p.id||i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",marginBottom:4,borderRadius:8,background:T.bg3,border:"1px solid "+T.border,gap:8}}>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{fontSize:10,fontWeight:700}}>{p.name+" ("+p.pos+" "+p.ovr+")"}</div>
                    <div style={{fontSize:8,color:T.dim}}>
                      {"Cap hit: $"+beforeHit+"M â†’ "}
                      <span style={{color:pv.ok&&afterHit<=beforeHit?T.green:accent,fontWeight:700}}>{"$"+afterHit+"M"}</span>
                      {" â€¢ "+(c.years||0)+"yr â†’ "+(pv.afterYears||c.years||0)+"yr"}
                      {pv.afterVoid>0?(" â€¢ "+pv.afterVoid+" void yr"+(pv.afterVoid>1?"s":"")):""}
                    </div>
                    <div style={{fontSize:8,color:T.faint,marginTop:2}}>
                      {"Impact Preview: "+(deltaHit>=0?"Save ":"Add ")+"$"+Math.abs(deltaHit)+"M cap now â€¢ Cut dead cap "+(riskDelta>=0?"+":"")+"$"+riskDelta+"M"}
                    </div>
                    {!pv.ok&&<div style={{fontSize:8,color:T.red,marginTop:2}}>{pv.res&&pv.res.msg?pv.res.msg:"Not eligible"}</div>}
                  </div>
                  <div style={{textAlign:"right",marginRight:2,minWidth:78}}>
                    <div style={{fontSize:9,color:deltaHit>=0?T.green:T.red,fontWeight:700}}>{(deltaHit>=0?"Save ":"Cost ")+"$"+Math.abs(deltaHit)+"M"}</div>
                    <div style={{fontSize:7,color:riskDelta>0?T.red:T.dim}}>{"Dead cap "+(riskDelta>=0?"+":"")+"$"+riskDelta+"M"}</div>
                  </div>
                  <button disabled={!pv.ok} style={{fontSize:8,padding:"4px 10px",borderRadius:6,background:pv.ok?accent:"#374151",color:pv.ok?"#000":"#9ca3af",border:"none",cursor:pv.ok?"pointer":"not-allowed",fontWeight:700,whiteSpace:"nowrap"}}
                    onClick={function(){runAction973(p.id);}}>{actionBtn973()}</button>
                </div>;
              })}
            </div>;
          })()}
              </div>}
            </div>;
          })()}
          
          {tab==="warRoom"&&unlocks.warRoom&&(function(){
            var prospects79=(Array.isArray(dc)?dc:[]).slice().sort(function(a,b){return (b.projOvr||b.ovr||0)-(a.projOvr||a.ovr||0);});
            var top15=prospects79.slice(0,15);
            var foD79=FRONT_OFFICE.getBonus(frontOffice78,"drafting");
            var tradePwr79=FRONT_OFFICE.getBonus(frontOffice78,"trades");
            var tabs79=["bigBoard","intel","tradeCalc"];
            var tabLabels79={bigBoard:"ðŸ“‹ Big Board",intel:"ðŸ” Intel Feed",tradeCalc:"âš–ï¸ Trade Calc"};
            return React.createElement("div",{style:{padding:12}},
              React.createElement("div",{style:{fontSize:16,fontWeight:900,color:T.gold,marginBottom:2,letterSpacing:1}},"ðŸŸï¸ WAR ROOM"),
              React.createElement("div",{style:{fontSize:9,color:T.dim,marginBottom:10}},"Your pre-draft command center. Scout prospects, generate intel, and simulate trades."),
              React.createElement("div",{style:{display:"flex",gap:6,marginBottom:12}},
                tabs79.map(function(tid){
                  var isA=warRoomTab79===tid;
                  return React.createElement("button",{key:tid,onClick:function(){setWarRoomTab79(tid);},
                    style:{padding:"4px 10px",fontSize:10,fontWeight:700,borderRadius:6,cursor:"pointer",
                      background:isA?"rgba(251,191,36,0.15)":"rgba(255,255,255,0.04)",
                      border:"1px solid "+(isA?T.gold:T.border),color:isA?T.gold:T.dim}},
                    tabLabels79[tid]);
                })
              ),
              warRoomTab79==="bigBoard"&&React.createElement("div",null,
                React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.cyan,marginBottom:6}},"ðŸ“‹ TOP 15 PROSPECTS"),
                foD79>0&&React.createElement("div",{style:{fontSize:8,color:T.green,marginBottom:6}},"ðŸŽ“ Scout Director bonus: +"+Math.round(foD79*40)+" confidence on all targets"),
                React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:4}},
                  top15.map(function(p,i){
                    var flag79=warRoomFlags79&&warRoomFlags79[p.id];
                    var isShortlisted=draftShortlist79&&draftShortlist79.indexOf(p.id)>=0;
                    var flagColor=flag79==="target"?T.green:flag79==="reach"?T.orange:flag79==="avoid"?T.red:T.dim;
                    var conf=Math.min(100,(p.scoutConfidence||50)+(foD79>0?Math.round(foD79*40):0));
                    var gymLvlWR=my&&my.facilities?my.facilities.gym||0:0;
                    var errWR=SCOUT_MATH.getErrorBand(gymLvlWR,foD79||0);
                    var ovrWRDisplay=SCOUT_MATH.getOvrDisplay(p.projOvr||p.ovr||0,conf,errWR);
                    var ovrWRColor=conf>=100?T.green:ovrWRDisplay.indexOf("-")>=0?T.gold:T.faint;
                    return React.createElement("div",{key:p.id,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",borderRadius:6,background:T.bg3,border:"1px solid "+(isShortlisted?T.gold+"55":T.border)}},
                      React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center"}},
                        React.createElement("span",{style:{fontSize:11,fontWeight:900,color:T.faint,minWidth:20}},i+1),
                        React.createElement("div",null,
                          React.createElement("div",{style:{fontSize:11,fontWeight:700}},p.name+" ("+p.pos+")"),
                          React.createElement("div",{style:{fontSize:8,color:T.dim}},
                            React.createElement("span",{style:{color:ovrWRColor,fontWeight:700}},ovrWRDisplay+" OVR"),
                            " â€¢ Conf: "+conf+"% Â±"+errWR+(p.school?" â€¢ "+p.school:""))
                        )
                      ),
                      React.createElement("div",{style:{display:"flex",gap:4,alignItems:"center"}},
                        flag79&&React.createElement("span",{style:{fontSize:8,color:flagColor,fontWeight:700,border:"1px solid "+flagColor,borderRadius:4,padding:"1px 5px"}},flag79.toUpperCase()),
                        React.createElement("button",{style:{fontSize:7,padding:"2px 5px",borderRadius:4,cursor:"pointer",background:isShortlisted?"rgba(251,191,36,0.15)":"rgba(255,255,255,0.05)",border:"1px solid "+(isShortlisted?T.gold:T.border),color:isShortlisted?T.gold:T.faint},
                          onClick:function(){setDraftShortlist79(function(prev){var n=prev.slice();var idx=n.indexOf(p.id);if(idx>=0)n.splice(idx,1);else n.push(p.id);return n;});}},
                          isShortlisted?"â˜…":"â˜†"),
                        React.createElement("select",{value:flag79||"",style:{fontSize:7,borderRadius:4,padding:"1px 3px",background:"rgba(0,0,0,0.4)",border:"1px solid "+T.border,color:T.text,cursor:"pointer"},
                          onChange:function(e){var v=e.target.value;setWarRoomFlags79(function(prev){var u=assign({},prev);if(v)u[p.id]=v;else delete u[p.id];return u;});}},
                          React.createElement("option",{value:""},"Flag..."),
                          React.createElement("option",{value:"target"},"ðŸŽ¯ Target"),
                          React.createElement("option",{value:"reach"},"âš ï¸ Reach"),
                          React.createElement("option",{value:"avoid"},"ðŸš« Avoid")
                        )
                      )
                    );
                  })
                )
              ),
              warRoomTab79==="intel"&&React.createElement("div",null,
                React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.cyan,marginBottom:6}},"ðŸ” DRAFT INTEL"),
                draftShortlist79&&draftShortlist79.length>0?React.createElement("div",null,
                  React.createElement("div",{style:{fontSize:9,color:T.dim,marginBottom:6}},"Shortlisted: "+draftShortlist79.length+" prospects"),
                  draftShortlist79.map(function(pid){
                    var pr=prospects79.find(function(x){return x.id===pid;});
                    if(!pr)return null;
                    var conf=Math.min(100,(pr.scoutConfidence||50)+(foD79>0?Math.round(foD79*40):0));
                    var archNote=pr.arch||pr.archetype||"Standard";
                    var charNote=pr.character75?pr.character75.label:"Unknown Character";
                    var gymLvlIF=my&&my.facilities?my.facilities.gym||0:0;
                    var errIF=SCOUT_MATH.getErrorBand(gymLvlIF,foD79||0);
                    var ovrIF=SCOUT_MATH.getOvrDisplay(pr.projOvr||pr.ovr||0,conf,errIF);
                    return React.createElement("div",{key:pid},
                      SCOUT_REPORT_CARD(pr,{conf:conf,errBand:errIF,ovrDisplay:ovrIF,archNote:archNote,charNote:charNote},T)
                    );
                  })
                ):React.createElement("div",{style:{color:T.dim,fontSize:11,textAlign:"center",padding:20}},"Shortlist prospects on the Big Board to generate intel reports.")
              ),
              warRoomTab79==="tradeCalc"&&React.createElement("div",null,
                React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.cyan,marginBottom:6}},"âš–ï¸ PICK TRADE SIMULATOR"),
                tradePwr79>0&&React.createElement("div",{style:{fontSize:8,color:T.green,marginBottom:6}},"ðŸ’¼ GM Trade bonus: +"+Math.round(tradePwr79*15)+"% offer value boost active"),
                React.createElement("div",{style:{padding:12,borderRadius:8,background:T.bg3,border:"1px solid "+T.border,fontSize:9,color:T.dim}},
                  "ðŸ“Š Draft pick values (2026 standard chart):",
                  React.createElement("div",{style:{marginTop:8,display:"grid",gridTemplateColumns:"1fr 1fr",gap:4}},
                    [{pick:"#1 Overall",val:3000},{pick:"#5",val:1700},{pick:"#10",val:1100},{pick:"#15",val:800},
                     {pick:"#20",val:600},{pick:"#32",val:400},{pick:"2nd Rd",val:200},{pick:"3rd Rd",val:100}
                    ].map(function(row){
                      return React.createElement("div",{key:row.pick,style:{display:"flex",justifyContent:"space-between",padding:"3px 6px",borderRadius:4,background:"rgba(255,255,255,0.03)"}},
                        React.createElement("span",null,row.pick),
                        React.createElement("span",{style:{fontWeight:700,color:T.gold}},row.val+(tradePwr79>0?" â†’ "+Math.round(row.val*(1+tradePwr79*0.15)):""))
                      );
                    })
                  ),
                  tradePwr79>0&&React.createElement("div",{style:{marginTop:8,fontSize:8,color:T.green,fontStyle:"italic"}},"Your GM's trade acumen inflates your side of every deal.")
                )
              )
            );
          })()}
          
          {tab==="ownerReport" && (function(){
            var mood=my.ownerMood||70;var grade=mood>=90?"A+":mood>=80?"A":mood>=70?"B":mood>=60?"C":mood>=50?"D":"F";
            var ownerArc=OWNER_CONFIDENCE_ARC.get(ownerPatience80,mood);
            var factors=[
              {label:"Win-Loss Record",val:my.wins+"-"+my.losses,impact:my.wins>my.losses?"+":"-",color:my.wins>my.losses?T.green:T.red},
              {label:"Cap Management",val:"$"+Math.round(getSalaryCap(season.year)-capCalc(my?my.roster:[])-((my?my.deadCap:0)||0))+"M room",impact:(my.deadCap||0)>30?"-":"+",color:(my.deadCap||0)>30?T.red:T.green},
              {label:"Playoff Contention",val:standings.findIndex(function(t2){return t2.id===myId;})<8?"In picture":"Outside",impact:standings.findIndex(function(t2){return t2.id===myId;})<8?"+":"-",color:standings.findIndex(function(t2){return t2.id===myId;})<8?T.green:T.red},
              {label:"Team Prestige",val:(my.prestige||50)+"/100",impact:(my.prestige||50)>=60?"+":"-",color:(my.prestige||50)>=60?T.green:T.red},
              {label:"Fan Revenue",val:"$"+(my.cash||0).toFixed(0)+"M",impact:(my.cash||0)>20?"+":"-",color:(my.cash||0)>20?T.green:T.red}
            ];
            var traitReasons=getTraitMoraleExplainer(my.roster);
            var ownerType=OWNER_TYPES[(hashId(my.id||"x"))%OWNER_TYPES.length];
            var meetingReady=season.phase==="offseason"||season.week>=17;
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:700}}>{"ðŸ‘” Owner Report Card"}</div>
              
              <div style={assign({},cS,{background:"rgba(212,167,75,0.05)",borderLeft:"3px solid "+T.gold})}>
                <div style={{fontSize:11,color:T.gold,fontWeight:700}}>{ownerType.icon+" "+ownerType.name+" Owner"}</div>
                <div style={{fontSize:10,color:T.dim}}>{ownerType.desc}</div>
              </div>
              <div style={assign({},cS,{borderLeft:"3px solid "+ownerArc.color,background:"rgba(0,0,0,0.14)"})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                  <div>
                    <div style={{fontSize:11,color:ownerArc.color,fontWeight:800}}>{ownerArc.emoji+" OWNER CONFIDENCE ARC: "+ownerArc.id}</div>
                    <div style={{fontSize:10,color:T.dim}}>{"Score "+ownerArc.score+" (Patience "+Math.round(ownerPatience80)+" / Mood "+mood+")"}</div>
                  </div>
                  <div style={{textAlign:"right"}}>
                    <div style={{fontSize:22,fontWeight:900,color:ownerArc.heatColor}}>{ownerArc.heat+"%"}</div>
                    <div style={{fontSize:9,color:T.faint}}>{"Heat"}</div>
                  </div>
                </div>
                <div style={{position:"relative",height:12,borderRadius:999,background:"rgba(255,255,255,0.06)",overflow:"hidden"}}>
                  <div style={{position:"absolute",left:0,top:0,height:"100%",width:ownerArc.heat+"%",background:"linear-gradient(90deg,#facc15,"+ownerArc.heatColor+")"}}/>
                  <div style={{position:"absolute",left:"30%",top:0,width:1,height:"100%",background:"rgba(255,255,255,0.25)"}}></div>
                  <div style={{position:"absolute",left:"50%",top:0,width:1,height:"100%",background:"rgba(255,255,255,0.25)"}}></div>
                  <div style={{position:"absolute",left:"70%",top:0,width:1,height:"100%",background:"rgba(255,255,255,0.25)"}}></div>
                </div>
                <div style={{display:"flex",justifyContent:"space-between",fontSize:8,color:T.dim,marginTop:4}}>
                  <span>{"PATIENT"}</span>
                  <span>{"RESTLESS"}</span>
                  <span>{"DEMANDING"}</span>
                  <span style={{color:T.red,fontWeight:700}}>{"ULTIMATUM"}</span>
                </div>
                <div style={{fontSize:9,color:ownerArc.color,marginTop:4,fontStyle:"italic"}}>
                  {ownerArc.desc+(ownerArc.nextTarget?(" Next tier at score "+ownerArc.nextTarget+"."):" Highest tier secured.")}
                </div>
              </div>
              <div style={cS}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                  <div>
                    <div style={{fontSize:48,fontWeight:900,color:mood>=70?T.green:mood>=50?T.gold:T.red}}>{grade}</div>
                    <div style={{fontSize:10,color:T.faint}}>{"Owner Satisfaction"}</div>
                  </div>
                  <div style={{textAlign:"right"}}>
                    <div style={{fontSize:32,fontWeight:800}}>{mood}</div>
                    <div style={{fontSize:10,color:T.faint}}>{"Mood (0-100)"}</div>
                    <div style={{fontSize:10,color:mood<40?T.red:T.faint,marginTop:4}}>{mood<40?"ðŸ”¥ HOT SEAT!":mood>=80?"ðŸ˜Š Love you!":"ðŸ˜ Prove yourself"}</div>
                  </div>
                </div>
              </div>
              <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.gold,marginBottom:6}}>{"FACTORS"}</div>
                {factors.map(function(f){return <div key={f.label} style={{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:"1px solid "+T.border}}>
                  <span style={{fontSize:12}}>{f.label}</span>
                  <div style={{display:"flex",gap:8,alignItems:"center"}}>
                    <span style={{fontSize:11,color:T.dim}}>{f.val}</span>
                    <span style={{fontSize:14,fontWeight:800,color:f.color}}>{f.impact}</span>
                  </div>
                </div>;})}
              </div>
              
              {traitReasons.length>0 && <div style={cS}>
                <div style={{fontWeight:700,fontSize:11,color:T.purple,marginBottom:6}}>{"ðŸ§¬ WEEKLY MORALE MODIFIERS"}</div>
                <div style={{fontSize:10,color:T.dim,marginBottom:4}}>{"Traits that affect your team's mood each week:"}</div>
                {traitReasons.map(function(r,i){return <div key={i} style={{fontSize:11,padding:"2px 0"}}>{r}</div>;})}
              </div>}
              
              {meetingReady && !ownerMtg && <button onClick={function(){
                var pool=OWNER_GOALS.filter(function(g){return ownerType.goalBias.indexOf(g.id)>=0;});
                if(pool.length<2)pool=OWNER_GOALS.slice();
                var g1=pool[Math.floor(RNG.play()*pool.length)];
                var g2=pool.filter(function(g){return g.id!==g1.id;})[Math.floor(RNG.play()*(pool.length-1))];
                if(!g2)g2=OWNER_GOALS[0];
                var capRoom3=Math.max(0,getSalaryCap(season.year)-capCalc(my.roster)-(my.deadCap||0));
                var rookStarters=my.roster.filter(function(p){return p.age<=23&&p.isStarter;}).length;
                var bestRookie=my.roster.filter(function(p){return p.age<=23;}).sort(function(a,b){return b.ovr-a.ovr;})[0];
                var madePlay=false;
                if(typeof buildPlayoffField97==="function"){
                  try{
                    var field97=buildPlayoffField97(standings);
                    madePlay=!!((field97&&field97.seeds)||[]).some(function(s){return s&&s.id===myId;});
                  }catch(eMade97){
                    madePlay=standings.findIndex(function(t2){return t2.id===myId;})<8;
                  }
                }else{
                  madePlay=standings.findIndex(function(t2){return t2.id===myId;})<8;
                }
                var defRank2=standings.map(function(t2){return {id:t2.id,pa:t2.pa||999};}).sort(function(a,b){return a.pa-b.pa;}).findIndex(function(t2){return t2.id===myId;})+1;
                var wonC=history.length>0&&history[history.length-1]&&history[history.length-1].champId===myId;
                var myDivId97=(my&&my.divId)||((MFD97_CONF_DIV_MAP[myId]||{}).divId)||null;
                var divR=1;
                if(myDivId97){
                  var divTeams97=teams.filter(function(t2){
                    if(!t2)return false;
                    applyLeagueAlignment97(t2);
                    return t2.divId===myDivId97;
                  }).sort(function(a,b){
                    return (b.wins||0)-(a.wins||0)||((b.pf||0)-(b.pa||0))-((a.pf||0)-(a.pa||0));
                  });
                  divR=divTeams97.findIndex(function(t2){return t2.id===myId;})+1;
                  if(divR<1)divR=1;
                }
                var ctx3={wins:my.wins||0,losses:my.losses||0,madePlayoffs:madePlay,wonChamp:wonC,divRank:divR,capRoom:capRoom3,deadCap:my.deadCap||0,rookieStarters:rookStarters,bestRookieOvr:bestRookie?bestRookie.ovr:0,defRank:defRank2};
                var g1Result=g1.exceed(ctx3)?"EXCEEDED":g1.check(ctx3)?"MET":"MISSED";
                var g2Result=g2.exceed(ctx3)?"EXCEEDED":g2.check(ctx3)?"MET":"MISSED";
                var totalGrade=(g1Result==="EXCEEDED"?2:g1Result==="MET"?1:0)+(g2Result==="EXCEEDED"?2:g2Result==="MET"?1:0);
                var verdict=totalGrade>=3?"Exceeded expectations!":totalGrade>=2?"Met expectations.":totalGrade>=1?"Needs improvement.":"Deeply disappointed.";
                var nt3=teams.slice();var u3=nt3.find(function(t){return t.id===myId;});
                var moodShift=totalGrade>=3?15:totalGrade>=2?5:totalGrade>=1?-8:-20;
                var cashShift=totalGrade>=3?15:totalGrade>=2?5:totalGrade>=1?-5:-15;
                u3.ownerMood=cl((u3.ownerMood||70)+moodShift,5,99);
                u3.cash=(u3.cash||0)+cashShift;
                setTeams(nt3);
                setOwnerMtg({goals:[{goal:g1,result:g1Result},{goal:g2,result:g2Result}],verdict:verdict,totalGrade:totalGrade,moodShift:moodShift,cashShift:cashShift,ownerType:ownerType});
                addN("ðŸ¤µ Owner Meeting complete: "+verdict+" Mood "+(moodShift>=0?"+":"")+moodShift+", Budget "+(cashShift>=0?"+$":"$")+cashShift+"M",totalGrade>=2?"green":"red");
              }} style={{background:"rgba(212,167,75,0.15)",border:"1px solid "+T.gold,color:T.gold,
                borderRadius:6,padding:"10px 16px",fontSize:12,cursor:"pointer",fontWeight:700,width:"100%"}}>
                {"ðŸ¤µ Hold Annual Owner Meeting"}
              </button>}
              
              {ownerMtg && <div style={assign({},cS,{borderLeft:"3px solid "+(ownerMtg.totalGrade>=2?T.green:ownerMtg.totalGrade>=1?T.gold:T.red)})}>
                <div style={{fontWeight:700,fontSize:13,marginBottom:8}}>{"ðŸ¤µ Annual Meeting Results"}</div>
                <div style={{fontSize:11,color:T.dim,marginBottom:8}}>{ownerMtg.ownerType.icon+" "+ownerMtg.ownerType.name+" owner evaluated your performance:"}</div>
                {ownerMtg.goals.map(function(g,i){
                  var resColor=g.result==="EXCEEDED"?T.green:g.result==="MET"?T.gold:T.red;
                  var resIcon=g.result==="EXCEEDED"?"ðŸŒŸ":g.result==="MET"?"âœ…":"âŒ";
                  return <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"6px 0",borderBottom:"1px solid "+T.border}}>
                    <span style={{fontSize:12}}>{"Goal "+(i+1)+": "+g.goal.label}</span>
                    <span style={{fontWeight:700,color:resColor}}>{resIcon+" "+g.result}</span>
                  </div>;
                })}
                <div style={{marginTop:10,padding:8,background:ownerMtg.totalGrade>=2?"rgba(52,211,153,0.1)":"rgba(239,68,68,0.1)",borderRadius:4}}>
                  <div style={{fontWeight:800,fontSize:14,color:ownerMtg.totalGrade>=2?T.green:ownerMtg.totalGrade>=1?T.gold:T.red}}>{ownerMtg.verdict}</div>
                  <div style={{fontSize:10,color:T.dim,marginTop:4}}>{"Mood: "+(ownerMtg.moodShift>=0?"+":"")+ownerMtg.moodShift+" | Budget: "+(ownerMtg.cashShift>=0?"+$":"$")+ownerMtg.cashShift+"M"}</div>
                </div>
              </div>}
            </div>;
          })()}
          
          {tab==="facilities" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              {/* FACILITIES_SURGE v29: MFSN franchise infrastructure broadcast header */}
              {(function(){
                var facs29=my.facilities||{};
                var FL29=[
                  {id:"gym",label:"Training Ctr",icon:"ðŸ‹ï¸",effect:"Dev Boost",maxLvl:3},
                  {id:"med",label:"Medical Staff",icon:"ðŸ¥",effect:"Heal Speed",maxLvl:3},
                  {id:"stad",label:"Stadium",icon:"ðŸŸï¸",effect:"Revenue",maxLvl:3},
                  {id:"film",label:"Film Room",icon:"ðŸ“¹",effect:"Gameplan",maxLvl:3},
                  {id:"rehab",label:"Rehab Center",icon:"ðŸ’†",effect:"Recovery",maxLvl:3}
                ];
                var fs_totalLvl=FL29.reduce(function(s,f){return s+(facs29[f.id]||0);},0);
                var fs_maxTotal=FL29.reduce(function(s,f){return s+f.maxLvl;},0);
                var fs_compositePct=Math.round(Math.min(1,fs_totalLvl/Math.max(1,fs_maxTotal))*100);
                var fs_compositeLabel=fs_compositePct>=90?"WORLD CLASS":fs_compositePct>=70?"ELITE FACILITY":fs_compositePct>=50?"ABOVE AVERAGE":fs_compositePct>=30?"DEVELOPING":"BARE BONES";
                var fs_compositeColor=fs_compositePct>=90?T.gold:fs_compositePct>=70?T.green:fs_compositePct>=50?T.cyan:fs_compositePct>=30?T.orange:T.red;
                var FS_INFRA_TAKES=[
                  "Every championship franchise knows: facilities aren't an expense, they're an investment. The infrastructure here is sending a message to free agents.",
                  "You can't out-develop the competition with outdated equipment. Every level upgrade is a direct line to player development and cap efficiency.",
                  "Scouts talk. Players talk. Free agents drive past your facilities before they sign. What story is this building telling them?",
                  "The dynasties that last don't just roster-build â€” they build the machine. Facilities are the machine.",
                  "Look at the elite franchises. Not one of them skimped on the Training Center. That's not a coincidence.",
                  "In a league where margins are thin, your facilities are your competitive edge. Every upgrade compounds over time."
                ];
                var fs_take=FS_INFRA_TAKES[Math.floor(RNG.ui()*FS_INFRA_TAKES.length)];
                var FS_PRIORITY_REC={
                  gym:["Your training center is your development engine. Upgrade it first â€” every young player on your roster benefits.",
                       "Gym upgrade now means 3 more OVR points on your next breakout player. Do the math."],
                  med:["One star going down for 8 weeks costs more than the upgrade. Medical Staff is your insurance policy.",
                       "The best ability is availability. Medical Staff at max means you field your best 53 every week."],
                  stad:["Stadium revenue funds everything else. Max this early and watch your cash position transform.",
                        "Revenue solves roster problems. A bigger stadium means bigger offers for bigger players."],
                  film:["Film Room converts raw talent into executed schemes. Your gameplan bonus scales with every upgrade.",
                        "Championship teams win the chess match before kickoff. Film Room is how you prepare to win."],
                  rehab:["Your star is always one injury from a 6-week absence. Rehab Center changes the equation on recovery timelines.",
                         "Rehab Center at max means your injured players return 25% faster. That's playoff seasons saved."]
                };
                var fs_needUpgrade=FL29.filter(function(f){return (facs29[f.id]||0)<f.maxLvl;});
                var fs_priority=fs_needUpgrade.length>0?fs_needUpgrade.reduce(function(best,f){
                  var curLvl=facs29[f.id]||0;var bestLvl=facs29[best.id]||0;
                  return curLvl<bestLvl?f:best;
                },fs_needUpgrade[0]):null;
                return <div style={{marginBottom:4}}>
                  {/* MFSN INFRASTRUCTURE COMMAND CENTER header */}
                  <div style={{background:"linear-gradient(135deg,rgba(34,211,238,0.12) 0%,rgba(34,211,238,0.04) 100%)",border:"1px solid rgba(34,211,238,0.3)",borderRadius:8,padding:"10px 12px",marginBottom:8}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:6}}>
                      <div>
                        <div style={{fontSize:8,fontWeight:800,color:T.cyan,letterSpacing:2,textTransform:"uppercase"}}>{"ðŸ“º MFSN INFRASTRUCTURE COMMAND CENTER"}</div>
                        <div style={{fontSize:15,fontWeight:900,color:"#fff",marginTop:2}}>{(my.city||"")+" "+(my.name||"")+" Facilities"}</div>
                        <div style={{fontSize:9,color:T.dim}}>{"Season "+season.year+" â€¢ Infrastructure Report"}</div>
                      </div>
                      <div style={{textAlign:"right"}}>
                        <div style={{fontSize:26,fontWeight:900,color:fs_compositeColor}}>{fs_compositePct+"%"}</div>
                        <div style={{fontSize:8,fontWeight:800,color:fs_compositeColor}}>{fs_compositeLabel}</div>
                      </div>
                    </div>
                    {/* Composite bar */}
                    <div style={{height:8,borderRadius:999,background:"rgba(255,255,255,0.07)",overflow:"hidden",marginBottom:4}}>
                      <div style={{height:"100%",width:fs_compositePct+"%",background:"linear-gradient(90deg,rgba(34,211,238,0.5),"+fs_compositeColor+")",borderRadius:999,transition:"width 0.4s"}}></div>
                    </div>
                    {/* Mini 5-bar facility grid */}
                    <div style={{display:"flex",gap:3,marginTop:4}}>
                      {FL29.map(function(f29){
                        var lvl29=facs29[f29.id]||0;var pct29=Math.round(lvl29/f29.maxLvl*100);
                        var c29=pct29>=100?T.gold:pct29>=66?T.green:pct29>=33?T.cyan:T.red;
                        return <div key={f29.id} style={{flex:1,textAlign:"center"}}>
                          <div style={{fontSize:11}}>{f29.icon}</div>
                          <div style={{height:4,borderRadius:2,background:T.bg3,overflow:"hidden",margin:"2px 0"}}>
                            <div style={{height:"100%",width:pct29+"%",background:c29,borderRadius:2}}></div>
                          </div>
                          <div style={{fontSize:7,color:c29,fontWeight:700}}>{"L"+lvl29}</div>
                        </div>;
                      })}
                    </div>
                    {/* Analyst take */}
                    <div style={{fontSize:9,color:"rgba(255,255,255,0.6)",fontStyle:"italic",marginTop:6,borderLeft:"2px solid rgba(34,211,238,0.4)",paddingLeft:8,lineHeight:1.4}}>
                      {"\u201c"+fs_take+"\u201d"}
                    </div>
                  </div>
                  {/* INVESTMENT PRIORITY PANEL */}
                  {fs_priority && <div style={{background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.25)",borderRadius:6,padding:"8px 10px",marginBottom:8}}>
                    <div style={{fontSize:8,fontWeight:800,color:T.gold,letterSpacing:1,marginBottom:4}}>{"ðŸŽ¯ MFSN INVESTMENT PRIORITY"}</div>
                    <div style={{display:"flex",alignItems:"center",gap:8}}>
                      <div style={{fontSize:20}}>{fs_priority.icon}</div>
                      <div style={{flex:1}}>
                        <div style={{fontSize:11,fontWeight:800,color:T.gold}}>{fs_priority.label}</div>
                        <div style={{fontSize:9,color:"rgba(255,255,255,0.65)",fontStyle:"italic",lineHeight:1.4}}>
                          {(FS_PRIORITY_REC[fs_priority.id]||["Upgrade this facility to unlock its full competitive advantage."])[Math.floor(RNG.ui()*((FS_PRIORITY_REC[fs_priority.id]||[""]).length))]}
                        </div>
                      </div>
                      <div style={{textAlign:"center"}}>
                        <div style={{fontSize:16,fontWeight:900,color:T.gold}}>{"L"+(facs29[fs_priority.id]||1)+"\u2192L"+((facs29[fs_priority.id]||1)+1)}</div>
                        <div style={{fontSize:7,color:T.faint}}>{"NEXT TIER"}</div>
                      </div>
                    </div>
                  </div>}
                </div>;
              })()}
              <div style={{fontWeight:700}}>{"ðŸŸï¸ Facilities & Upgrades"}</div>
              <div style={{fontSize:11,color:T.dim,marginBottom:4}}>{"Invest in your franchise infrastructure. Cash: $"+(my.cash||0).toFixed(0)+"M"}</div>
              {FACILS.map(function(fac){
                var cur=my.facilities&&my.facilities[fac.id]?my.facilities[fac.id]:1;
                var maxed=cur>=fac.maxLvl;
                var cost=fac.cost*cur;
                return <div key={fac.id} style={assign({},cS,{padding:12})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                    <div>
                      <div style={{fontWeight:700,fontSize:13}}>{fac.icon+" "+fac.name}</div>
                      <div style={{fontSize:10,color:T.dim}}>{fac.desc}</div>
                    </div>
                    <div style={{textAlign:"right"}}>
                      <div style={{fontSize:18,fontWeight:900,color:cur>=3?T.green:cur>=2?T.gold:T.dim}}>{"Lvl "+cur}</div>
                      <div style={{fontSize:9,color:T.faint}}>{"Max: "+fac.maxLvl}</div>
                    </div>
                  </div>
                  <div style={{display:"flex",gap:4,marginBottom:4}}>
                    {Array.from({length:fac.maxLvl},function(_,i){return <div key={i} style={{flex:1,height:6,borderRadius:3,background:i<cur?T.green:T.bg3}}></div>;})}
                  </div>
                  {!maxed?<button style={bS(T.gold,"#000")} onClick={function(){
                    if((my.cash||0)<cost){addN("ðŸ’° Need $"+cost+"M to upgrade "+fac.name,"red");return;}
                    var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
                    if(!u2.facilities)u2.facilities={};u2.facilities[fac.id]=cur+1;u2.cash-=cost;
                    addN("ðŸ—ï¸ "+fac.name+" upgraded to Lvl "+(cur+1)+"!","green");
                    logTx("UPGRADE_FACIL",{type:fac.name,newLvl:cur+1,cost:cost});
                    setTeams(nt);doSave(nt);
                  }}>{"Upgrade â†’ Lvl "+(cur+1)+" ($"+cost+"M)"}</button>
                  :<div style={{fontSize:11,color:T.green,fontWeight:700}}>{"âœ… MAXED OUT"}</div>}
                </div>;
              })}
              {/* â”€â”€ FRANCHISE RELOCATION v97.6 â”€â”€ */}
              {(function(){
                var relocCheck=RELOCATION976.canRelocate(my,season,history);
                var relocCost=relocDest976?30+Math.floor((relocDest976.marketMod||1.0)*20):0;
                return <div style={assign({},cS,{padding:12,marginTop:4})}>
                  <div style={{fontWeight:700,marginBottom:4}}>{"ðŸ™ï¸ Franchise Relocation"}</div>
                  {my._prevCity976&&<div style={{fontSize:10,color:T.dim,marginBottom:6}}>{"ðŸ“ Previously: "+my._prevCity976+" "+my._prevName976}</div>}
                  {!relocCheck.ok&&<div style={{fontSize:11,color:T.faint,padding:"8px 10px",background:"rgba(255,255,255,0.03)",borderRadius:8}}>
                    {"ðŸ”’ "+relocCheck.msg}
                  </div>}
                  {relocCheck.ok&&<div>
                    <div style={{fontSize:11,color:T.dim,marginBottom:8}}>{"Select a destination city. Relocation costs $30M+ (market premium). Stadium resets to Lvl 1."}</div>
                    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:8}}>
                      {RELOCATION_CITIES976.map(function(dest){
                        var destCost=30+Math.floor((dest.marketMod||1.0)*20);
                        var selected=relocDest976&&relocDest976.city===dest.city;
                        return <div key={dest.city} onClick={function(){setRelocDest976(dest);setRelocName976(dest.city+" Football Club");setRelocAbbr976(dest.abbr);}}
                          style={{padding:"8px 10px",borderRadius:8,border:"1px solid "+(selected?T.gold:T.border),background:selected?"rgba(251,191,36,0.1)":"rgba(255,255,255,0.03)",cursor:"pointer"}}>
                          <div style={{fontWeight:700,fontSize:12}}>{dest.icon+" "+dest.city}</div>
                          <div style={{fontSize:9,color:T.dim,marginTop:2,lineHeight:1.3}}>{dest.desc}</div>
                          <div style={{fontSize:10,color:T.gold,fontWeight:700,marginTop:4}}>{"$"+destCost+"M Â· "+dest.fanbaseStart+"% fanbase"}</div>
                        </div>;
                      })}
                    </div>
                    {relocDest976&&<div style={{display:"flex",flexDirection:"column",gap:6,marginBottom:8}}>
                      <div style={{fontSize:11,fontWeight:700,color:T.gold}}>{"ðŸ“‹ Customize: "+relocDest976.city}</div>
                      <div style={{display:"flex",gap:6,alignItems:"center"}}>
                        <div style={{fontSize:10,color:T.dim,minWidth:70}}>{"Team Name:"}</div>
                        <input value={relocName976} onChange={function(e){setRelocName976(e.target.value);}}
                          style={{flex:1,background:"rgba(255,255,255,0.08)",border:"1px solid "+T.border,borderRadius:6,padding:"4px 8px",color:T.text,fontSize:11}} maxLength={30} />
                      </div>
                      <div style={{display:"flex",gap:6,alignItems:"center"}}>
                        <div style={{fontSize:10,color:T.dim,minWidth:70}}>{"Abbr (3):"}</div>
                        <input value={relocAbbr976} onChange={function(e){setRelocAbbr976(e.target.value.slice(0,3).toUpperCase());}}
                          style={{width:60,background:"rgba(255,255,255,0.08)",border:"1px solid "+T.border,borderRadius:6,padding:"4px 8px",color:T.text,fontSize:11,textTransform:"uppercase"}} maxLength={3} />
                      </div>
                      <button style={bS(T.gold,"#000")} onClick={function(){
                        if((my.cash||0)<relocCost){addN("ðŸ’° Need $"+relocCost+"M to relocate.","red");return;}
                        var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
                        var result=RELOCATION976.relocate(u2,relocDest976,season,{teamName:relocName976,abbr:relocAbbr976});
                        if(!result.ok){addN("âŒ "+result.msg,"red");return;}
                        addN("âœˆï¸ RELOCATED! Welcome to "+result.newCity+"! "+result.msg,"gold");
                        logTx("RELOCATE976",{dest:relocDest976.city,name:result.newName,cost:result.cost});
                        setTeams(nt);doSave(nt);setRelocDest976(null);setRelocName976("");setRelocAbbr976("");
                      }}>{"âœˆï¸ Relocate to "+relocDest976.city+" ($"+relocCost+"M)"}</button>
                    </div>}
                  </div>}
                </div>;
              })()}
              {/* â”€â”€ STADIUM NAMING RIGHTS v97.6 â”€â”€ */}
              {(function(){
                var deal=my.stadiumDeal976;
                return <div style={assign({},cS,{padding:12,marginTop:4})}>
                  <div style={{fontWeight:700,marginBottom:4}}>{"ðŸŸï¸ Stadium Naming Rights"}</div>
                  <div style={{fontSize:11,color:T.dim,marginBottom:8}}>{"Current stadium: "+getStadiumName976(my)}</div>
                  {deal&&(deal.yearsLeft||0)>0&&<div style={{background:"rgba(251,191,36,0.1)",border:"1px solid rgba(251,191,36,0.3)",borderRadius:8,padding:"10px 12px",marginBottom:8}}>
                    <div style={{fontWeight:800,color:T.gold,fontSize:13}}>{deal.name}</div>
                    <div style={{display:"flex",gap:16,marginTop:4,fontSize:10,color:T.dim}}>
                      <span>{"ðŸ’° $"+(deal.revenue||0).toFixed(1)+"M/yr"}</span>
                      <span>{"ðŸ“… "+(deal.yearsLeft||0)+" year"+(deal.yearsLeft===1?"":"s")+" remaining"}</span>
                    </div>
                  </div>}
                  {(!deal||(deal.yearsLeft||0)<=0)&&!stDeals976&&<button style={bS(T.cyan,"#000")} onClick={function(){setStDeals976(generateStadiumDeals976());}}>{"ðŸ’¼ Browse Naming Rights Offers"}</button>}
                  {stDeals976&&<div>
                    <div style={{fontSize:11,color:T.gold,fontWeight:700,marginBottom:6}}>{"ðŸ“¨ 3 Offers Available"}</div>
                    {stDeals976.map(function(offer,idx){
                      return <div key={idx} style={assign({},cS,{padding:10,marginBottom:6})}>
                        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                          <div>
                            <span style={{fontSize:16}}>{offer.icon}</span>
                            <span style={{fontWeight:700,fontSize:13,marginLeft:6}}>{offer.name}</span>
                          </div>
                          <div style={{textAlign:"right"}}>
                            <div style={{fontSize:14,fontWeight:900,color:T.gold}}> {"$"+(offer.revenue||0).toFixed(1)+"M/yr"}</div>
                            <div style={{fontSize:9,color:T.dim}}>{offer.years+" years"}</div>
                          </div>
                        </div>
                        {offer.prestige>0&&<div style={{fontSize:9,color:T.cyan,marginBottom:4}}>{"â­ +"+offer.prestige+" prestige"}</div>}
                        <button style={bS(T.green,"#000")} onClick={function(){
                          var nt=teams.slice();var u2=nt.find(function(t){return t.id===myId;});
                          u2.stadiumName976=offer.name;
                          u2.stadiumDeal976={name:offer.name,revenue:offer.revenue,years:offer.years,yearsLeft:offer.years,prestige:offer.prestige,icon:offer.icon};
                          if(offer.prestige)u2.prestige=cl((u2.prestige||50)+offer.prestige,10,99);
                          addN("ðŸŸï¸ "+offer.name+" naming rights signed! $"+offer.revenue.toFixed(1)+"M/yr for "+offer.years+" years.","gold");
                          logTx("STADIUM_DEAL976",{name:offer.name,revenue:offer.revenue,years:offer.years});
                          setTeams(nt);doSave(nt);setStDeals976(null);
                        }}>{"âœï¸ Sign Deal"}</button>
                      </div>;
                    })}
                    <button style={assign({},bS(T.faint,"#000"),{marginTop:4})} onClick={function(){setStDeals976(null);}}>{"âŒ Dismiss Offers"}</button>
                  </div>}
                </div>;
              })()}
            </div>
          )}


          {tab==="gmIntel" && (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:700}}>{"ðŸ•µï¸ GM Intel â€” League Decision Log"}</div>
              <div style={{fontSize:10,color:T.dim,marginBottom:4}}>{"Track what other GMs are doing and why. Updated after each trade, FA signing, and draft pick."}</div>
              {/* RIVAL_INTEL v20: Franchise storylines + threat meter injected above decision log */}
              {(function(){
                // Build rival franchise narrative data
                var rivalNarratives20=teams.filter(function(t){return t&&!t.isUser;}).map(function(t){
                  var gp20=(t.wins||0)+(t.losses||0);
                  var winPct20=gp20>0?(t.wins||0)/gp20:0.5;
                  var arch20=getTeamGMArchetype90?getTeamGMArchetype90(t):null;
                  // Arc player scan
                  var arcOrder20=["BREAKOUT","ELITE","COMEBACK","SWAN_SONG","HOLDOUT","SLUMP","DECLINE","MENTOR"];
                  var topArc=null;var topArcKey=null;
                  for(var ai=0;ai<arcOrder20.length;ai++){
                    var ak=arcOrder20[ai];
                    var found=(t.roster||[]).find(function(p){return p&&(p._arcState||"")===ak&&(p.ovr||0)>=72;});
                    if(found){topArc=found;topArcKey=ak;break;}
                  }
                  // Power score (same formula as powerRank tab)
                  var diff20=((t.pf||0)-(t.pa||0))/(gp20||1);
                  var recent20=(sched||[]).filter(function(g){return g&&g.played&&(g.home===t.id||g.away===t.id);}).slice(-3);
                  var recentW20=recent20.filter(function(g){return(g.home===t.id&&g.result&&g.result.home>g.result.away)||(g.away===t.id&&g.result&&g.result.away>g.result.home);}).length;
                  var power20=Math.round((winPct20*40+diff20*0.8+recentW20*8+(t.prestige||50)*0.15)*10)/10;
                  // Threat level
                  var arcMomentum=topArcKey&&["BREAKOUT","ELITE","COMEBACK","SWAN_SONG"].indexOf(topArcKey)>=0?1:topArcKey&&["SLUMP","DECLINE"].indexOf(topArcKey)>=0?-1:0;
                  var threat=power20+(arcMomentum*8)+(winPct20>=0.65?10:0);
                  return {t:t,arch:arch20,topArc:topArc,topArcKey:topArcKey,winPct:winPct20,power:power20,threat:threat,recentW:recentW20,gp:gp20};
                }).sort(function(a,b){return b.threat-a.threat;});

                // Narrative templates keyed by GM archetype + arc combo
                var RIVAL_NARRATIVE={
                  analytics:{
                    BREAKOUT:"The ðŸ“Š Analytics regime doesn't need hype â€” their data found {name} ({pos}) before anyone else. Now the breakout is confirmed. Terrifying.",
                    ELITE:"Calculated, cold, effective. {name} ({pos}) is the jewel of a roster built by the spreadsheet. They know exactly what they have.",
                    SLUMP:"Even the analytics GM can't algorithm a slump away. {name} ({pos}) is struggling and the numbers don't lie. Vulnerability detected.",
                    COMEBACK:"The board said {name} ({pos}) had more left. The board was right. A comeback built on data, unfolding on schedule.",
                    SWAN_SONG:"Valuing veterans by efficiency, not sentiment. {name} ({pos}) is flagged as high-value farewell tour. Maximizing the exit.",
                    default:"Quiet. Methodical. Building something the league won't see coming until it's too late."
                  },
                  old_school:{
                    BREAKOUT:"Old School GM, new blood emerging. {name} ({pos}) is exactly the kind of hardworking kid they love developing. Danger.",
                    ELITE:"{name} ({pos}) is their cornerstone â€” exactly the type of two-way, blue-collar star this franchise is built around. Lock them in and run.",
                    SLUMP:"Old School GMs stick with their guys. {name} ({pos}) is in a funk, but they won't panic. Question is â€” should they?",
                    COMEBACK:"Classic rebuild-through-loyalty. {name} ({pos}) was written off. This GM never gave up. Now watch.",
                    default:"They'll run the ball and play defense until the clock hits zero. Don't let them control the line of scrimmage."
                  },
                  contender:{
                    BREAKOUT:"Win-Now GM + emerging superstar = red alert. {name} ({pos}) is peaking at the exact right time for a championship push.",
                    ELITE:"This is why they traded future picks. {name} ({pos}) is operating at All-Pro level and the window is wide open. They're coming.",
                    SLUMP:"The clock is ticking on a contender window and {name} ({pos}) is struggling. Panic incoming? Or genius patience?",
                    HOLDOUT:"Contract drama while chasing a ring. {name} ({pos}) holdout could unravel everything. The contender is sweating.",
                    default:"All-in. No plan B. They're betting the entire franchise on this window. Respect it and prepare for it."
                  },
                  rebuilder:{
                    BREAKOUT:"{name} ({pos}) was supposed to be a project. The ðŸ› ï¸ Rebuilder is ahead of schedule. This is no longer a soft schedule â€” it's a real team.",
                    ELITE:"The rebuild is complete. {name} ({pos}) is the cornerstone they drafted and developed. Watch out â€” the contention window just opened.",
                    SLUMP:"The slump in {name} ({pos}) is a speed bump in a long-term plan. Rebuilders play chess, not checkers. They can wait.",
                    default:"Patient. Accumulating assets. The rebuild looks soft now â€” but check back in two years."
                  },
                  moneyball:{
                    BREAKOUT:"They found {name} ({pos}) for pennies. The ðŸ’¸ Moneyball GM is laughing all the way to the cap sheet. Breakout on a rookie deal is a dynasty maker.",
                    ELITE:"{name} ({pos}) was undervalued until they weren't. Now the Moneyball GM has an All-Pro on a bargain contract. Structural advantage.",
                    SLUMP:"Even the best value plays regress. {name} ({pos}) is underperforming the contract â€” which for Moneyball is a crisis of a different kind.",
                    default:"Value-hunting. Cap efficiency. Somewhere on their roster is a player you've never heard of who's about to make everyone regret sleeping on them."
                  },
                  loyalist:{
                    BREAKOUT:"{name} ({pos}) has been with this franchise since day one. The ðŸ¤ Loyalist GM built around them, and now the breakout proves them right.",
                    SWAN_SONG:"The farewell tour for {name} ({pos}) is a franchise moment. The Loyalist GM will give them every chance to go out on their terms. Beautiful â€” and dangerous.",
                    ELITE:"{name} ({pos}) stayed loyal and got paid in rings. This is the Loyalist culture on full display â€” and opponents should be worried.",
                    default:"Culture. Continuity. They've built something money can't replicate. Never count out a team that believes in each other."
                  }
                };
                function getRivalNarrative(archId,arcKey,playerName,playerPos){
                  var pool=RIVAL_NARRATIVE[archId||"analytics"]||RIVAL_NARRATIVE.analytics;
                  var template=pool[arcKey]||pool.default||"Something is brewing. Watch this franchise closely.";
                  return template.replace(/\{name\}/g,playerName||"their star").replace(/\{pos\}/g,playerPos||"");
                }

                var topRivals=rivalNarratives20.slice(0,5);
                var threatLabels=["ðŸ”¥ ELITE THREAT","âš¡ MAJOR THREAT","âš ï¸ NOTABLE THREAT","ðŸ‘€ WATCH LIST","ðŸ“‰ FADING"];
                var threatColors=["#ef4444","#f97316",T.gold,T.cyan,T.dim];

                if(topRivals.length===0)return null;
                return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:6}},
                  // Header
                  React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(239,68,68,0.15),rgba(15,23,42,0.95))",borderRadius:12,padding:"12px 16px",border:"1px solid rgba(239,68,68,0.3)"}},
                    React.createElement("div",{style:{fontSize:8,fontWeight:800,letterSpacing:3,color:"#ef4444",marginBottom:2}},"ðŸ“º MFSN RIVAL INTEL â€” WEEK "+season.week),
                    React.createElement("div",{style:{fontSize:16,fontWeight:900,color:"#fff"}},"ðŸ•µï¸ FRANCHISE THREAT REPORT"),
                    React.createElement("div",{style:{fontSize:10,color:T.dim,marginTop:1}},"Arc-aware rival analysis Â· Top 5 franchises by threat level")
                  ),
                  // Threat cards
                  topRivals.map(function(rv,ri){
                    var tColor=threatColors[ri]||T.dim;
                    var tLabel=threatLabels[ri]||"ðŸ‘€ WATCH LIST";
                    var arch=rv.arch;
                    var arcBadge20=rv.topArcKey&&ARC_SPOTLIGHT.lines[rv.topArcKey]?ARC_SPOTLIGHT.lines[rv.topArcKey].badge:null;
                    var arcBadgeColor20=rv.topArcKey&&ARC_SPOTLIGHT.lines[rv.topArcKey]?ARC_SPOTLIGHT.lines[rv.topArcKey].badgeColor:null;
                    var narrative=getRivalNarrative(arch?arch.id:null,rv.topArcKey,rv.topArc?rv.topArc.name:null,rv.topArc?rv.topArc.pos:null);
                    var bgGrad=ri===0?"linear-gradient(135deg,rgba(239,68,68,0.12),rgba(15,23,42,0.95))":ri===1?"linear-gradient(135deg,rgba(249,115,22,0.10),rgba(15,23,42,0.95))":"linear-gradient(135deg,rgba(255,255,255,0.04),rgba(15,23,42,0.95))";
                    return React.createElement("div",{key:"ri"+ri,style:{background:bgGrad,borderRadius:10,border:"1px solid "+tColor+"44",padding:"10px 12px",boxShadow:ri===0?"0 0 12px rgba(239,68,68,0.18)":"none"}},
                      React.createElement("div",{style:{display:"flex",gap:8,alignItems:"flex-start"}},
                        React.createElement("div",{style:{fontSize:18,fontWeight:900,color:tColor,width:24,flexShrink:0,marginTop:2}},(ri+1)),
                        React.createElement(TeamLogo,{team:rv.t,size:30}),
                        React.createElement("div",{style:{flex:1}},
                          React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",marginBottom:3}},
                            React.createElement("span",{style:{fontWeight:900,fontSize:12,color:"#fff"}},(rv.t.city+" "+rv.t.name)),
                            React.createElement("span",{style:{fontSize:8,fontWeight:800,color:tColor,background:tColor+"22",border:"1px solid "+tColor+"55",borderRadius:8,padding:"1px 6px"}},(tLabel)),
                            arch?React.createElement("span",{style:{fontSize:8,fontWeight:700,color:T[arch.color]||T.cyan,background:"rgba(0,0,0,0.3)",border:"1px solid "+(T[arch.color]||T.cyan)+"44",borderRadius:8,padding:"1px 6px"}},(arch.icon+" "+arch.label)):null
                          ),
                          React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:3,fontSize:9,color:T.dim,flexWrap:"wrap"}},
                            React.createElement("span",null,(rv.t.wins||0)+"-"+(rv.t.losses||0)),
                            React.createElement("span",null,"L3: "+rv.recentW+"W"),
                            React.createElement("span",{style:{fontWeight:700,color:rv.power>30?T.green:rv.power>20?T.gold:T.red}},"PWR: "+rv.power),
                            rv.topArc&&arcBadge20?React.createElement("span",{style:{fontSize:8,fontWeight:800,color:arcBadgeColor20,background:"rgba(0,0,0,0.3)",border:"1px solid "+arcBadgeColor20+"55",borderRadius:8,padding:"1px 5px"}},(arcBadge20+" "+rv.topArc.name+" ("+rv.topArc.pos+" "+rv.topArc.ovr+")")):null
                          ),
                          React.createElement("div",{style:{fontSize:9,fontStyle:"italic",color:"rgba(255,255,255,0.6)",lineHeight:1.4}},('\u201C'+narrative+'\u201D'))
                        ),
                        React.createElement("div",{style:{textAlign:"right",flexShrink:0}},
                          React.createElement("div",{style:{fontSize:16,fontWeight:900,color:tColor}},(Math.round(rv.threat))),
                          React.createElement("div",{style:{fontSize:7,color:T.faint,letterSpacing:1}},"THREAT")
                        )
                      )
                    );
                  })
                );
              })()}
              {AI_DECISION_LOG.length===0?<div style={cS}><div style={{fontSize:11,color:T.faint,textAlign:"center"}}>{"No AI decisions logged yet this session. Sim some games to see GM activity."}</div></div>:
              (function(){
                var byTeam74={};
                AI_DECISION_LOG.forEach(function(d){
                  if(!byTeam74[d.team])byTeam74[d.team]=[];
                  byTeam74[d.team].push(d);
                });
                var teamKeys74=Object.keys(byTeam74).sort();
                var actionColor74=function(a){return a==="TRADE_OFFER"?"#f59e0b":a==="FA_SIGN"?"#10b981":a==="DRAFT_PICK"?"#3b82f6":a==="CUT"?"#ef4444":"#9ca3af";};
                var actionIcon74=function(a){return a==="TRADE_OFFER"?"ðŸ¤":a==="FA_SIGN"?"âœï¸":a==="DRAFT_PICK"?"ðŸŽ¯":a==="CUT"?"âœ‚ï¸":"ðŸ“‹";};
                return <div style={{display:"flex",flexDirection:"column",gap:6}}>
                  
                  <div style={assign({},cS,{display:"flex",gap:12,flexWrap:"wrap"})}>
                    <div style={{fontSize:11,fontWeight:700,color:T.gold}}>{AI_DECISION_LOG.length+" total decisions"}</div>
                    <div style={{fontSize:10,color:"#f59e0b"}}>{AI_DECISION_LOG.filter(function(d){return d.action==="TRADE_OFFER";}).length+" trades"}</div>
                    <div style={{fontSize:10,color:"#10b981"}}>{AI_DECISION_LOG.filter(function(d){return d.action==="FA_SIGN";}).length+" signings"}</div>
                    <div style={{fontSize:10,color:"#3b82f6"}}>{AI_DECISION_LOG.filter(function(d){return d.action==="DRAFT_PICK";}).length+" draft picks"}</div>
                    <div style={{fontSize:10,color:"#ef4444"}}>{AI_DECISION_LOG.filter(function(d){return d.action==="CUT";}).length+" cuts"}</div>
                  </div>
                  
                  {teamKeys74.map(function(tm){
                    var decisions=byTeam74[tm];
                    var t74=teams.find(function(t){return t.abbr===tm;});
                    var strategy74=t74?t74.aiStrategy:"unknown";
                    var stratColor=strategy74==="contend"?T.green:strategy74==="bubble"?T.gold:T.red;
                    var gmArch74=t74?getTeamGMArchetype90(t74):null;
                    var archColor74=gmArch74&&gmArch74.color&&T[gmArch74.color]?T[gmArch74.color]:T.purple;
                    return <div key={tm} style={assign({},cS,{borderLeft:"3px solid "+stratColor})}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                        <div style={{display:"flex",alignItems:"center",gap:4}}>
                          {t74&&React.createElement(TeamLogo,{team:t74,size:18})}
                          <span style={{fontWeight:700,fontSize:12}}>{tm}</span>
                          <span style={{fontSize:8,padding:"1px 5px",borderRadius:4,background:stratColor+"22",color:stratColor,fontWeight:600}}>
                            {strategy74==="contend"?"CONTENDER":strategy74==="bubble"?"BUBBLE":"REBUILDING"}
                          </span>
                          {gmArch74&&<span style={{fontSize:8,padding:"1px 5px",borderRadius:4,background:archColor74+"22",color:archColor74,fontWeight:700}}>
                            {gmArch74.icon+" "+gmArch74.label}
                          </span>}
                        </div>
                        <span style={{fontSize:9,color:T.dim}}>{decisions.length+" move"+(decisions.length>1?"s":"")}</span>
                      </div>
                      {gmArch74&&<div style={{fontSize:8,color:T.faint,marginBottom:4,fontStyle:"italic"}}>{gmArch74.flavor}</div>}
                      {decisions.slice(-5).reverse().map(function(d,di){
                        return <div key={di} style={{fontSize:10,padding:"3px 0",borderTop:di>0?"1px solid "+T.border:"none",display:"flex",gap:6,alignItems:"flex-start"}}>
                          <span style={{color:actionColor74(d.action),fontWeight:700,flexShrink:0}}>{actionIcon74(d.action)}</span>
                          <span style={{color:T.dim}}>{d.reason}</span>
                        </div>;
                      })}
                    </div>;
                  })}
                </div>;
              })()}
            </div>
          )}
          {tab==="settings" && (
            <div style={{display:"flex",flexDirection:"column",gap:12}}>
              <div style={{fontWeight:700}}>{"âš™ï¸ Game Settings"}</div>
              
              <div style={assign({},cS,{padding:16})}>
                <div style={{fontWeight:800,fontSize:13,marginBottom:10}}>Difficulty Level</div>
                <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                  {Object.keys(DIFF_SETTINGS).map(function(k){
                    var ds=DIFF_SETTINGS[k];
                    var isCur=difficulty===k;
                    return React.createElement("div",{key:k,onClick:function(){setDifficulty(k);doSave();},
                      style:{flex:1,minWidth:70,background:isCur?"rgba(212,167,75,0.12)":T.bg3,border:"2px solid "+(isCur?T.gold:T.border),
                        borderRadius:8,padding:10,cursor:"pointer",textAlign:"center",transition:"border 0.2s"}},
                      React.createElement("div",{style:{fontSize:20}},ds.icon),
                      React.createElement("div",{style:{fontWeight:800,fontSize:12,color:isCur?T.gold:T.text,marginTop:3}},ds.name),
                      React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:3,lineHeight:1.3}},ds.desc)
                    );
                  })}
                </div>
                <div style={{marginTop:12,fontSize:10,color:T.faint}}>
                  <div style={{fontWeight:700,color:T.dim,marginBottom:4}}>Current modifiers:</div>
                  {(function(){var ds2=DIFF_SETTINGS[difficulty];return React.createElement("div",{style:{display:"flex",gap:6,flexWrap:"wrap"}},
                    ["Trade: "+Math.round(ds2.tradeMod*100)+"%","Injury: "+Math.round(ds2.injMod*100)+"%",
                     "Owner: "+Math.round(ds2.ownerMod*100)+"%","Clutch: "+Math.round(ds2.clutchSwing*100)+"%",
                     "Morale: "+Math.round(ds2.moraleMod*100)+"%","AI Bids: "+Math.round(ds2.aiBidMod*100)+"%"
                    ].map(function(lbl){return React.createElement("span",{key:lbl,style:{fontSize:9,background:T.bg2,padding:"2px 6px",borderRadius:3,color:T.dim}},lbl);})
                  );})()}
                </div>
              </div>
              
              {my && (function(){
                var snap84=buildIdentityFitSnapshot(my,my.schemeOff,my.schemeDef);
                var groupMap84={};
                (snap84.groups||[]).forEach(function(g){groupMap84[g.id]=g;});
                var activeProfile85=detectFitAlertProfile85(my,season.week||1);
                var profileBtns85=[
                  {id:"strict",label:"Strict"},
                  {id:"balanced",label:"Balanced"},
                  {id:"minimal",label:"Minimal"}
                ];
                function derivePreset(pref){
                  var wk=season.week||1;
                  var p85=normalizeFitAlertPref85(pref);
                  if((p85.snoozeUntil||0)>=9999)return "silent";
                  if(p85.snoozeUntil&&p85.snoozeUntil>wk+10)return "season";
                  if(p85.snoozeUntil&&p85.snoozeUntil>wk)return "3wk";
                  return "active";
                }
                return <div style={assign({},cS,{padding:12,borderColor:"rgba(248,113,113,0.35)",background:"rgba(127,29,29,0.08)"})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                    <div style={{fontWeight:800,fontSize:12,color:T.red}}>{"ðŸš¨ INBOX FIT ALERT CONTROLS"}</div>
                    <button style={mS(S.btn,S.btnSmall,{padding:"4px 8px",fontSize:9})} onClick={resetFitAlertPrefs84}>{"Reset All"}</button>
                  </div>
                  <div style={{fontSize:9,color:T.faint,marginBottom:8}}>{"Manage which position groups can trigger GM fit-risk alerts."}</div>
                  <div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",marginBottom:8}}>
                    {profileBtns85.map(function(pf){
                      var active=activeProfile85===pf.id;
                      return <button key={pf.id}
                        style={mS(S.btn,S.btnSmall,{padding:"4px 10px",fontSize:9,
                          background:active?"rgba(248,113,113,0.18)":T.bg3,color:active?T.red:T.dim,
                          border:"1px solid "+(active?"rgba(248,113,113,0.45)":T.border)})}
                        onClick={function(){applyAlertProfile84(pf.id);}}>
                        {pf.label}
                      </button>;
                    })}
                    <span style={{fontSize:9,color:activeProfile85==="custom"?T.gold:T.faint,fontWeight:700}}>
                      {"Current: "+(activeProfile85==="custom"?"Custom":activeProfile85==="strict"?"Strict":activeProfile85==="balanced"?"Balanced":"Minimal")}
                    </span>
                  </div>
                  {FIT_GROUP_DEFS.map(function(gd){
                    var pref=normalizeFitAlertPref85((my.fitAlertPrefs84||{})[gd.id]||{});
                    var preset=derivePreset(pref);
                    var floor=pref.minSeverity==="high"?"high":"any";
                    if(pref.highOnlyWeek!==null&&(season.week||1)>=pref.highOnlyWeek)floor="high";
                    var gNow=groupMap84[gd.id]?groupMap84[gd.id].avgScore:0;
                    var gCol=gNow>=75?T.green:gNow>=63?T.gold:T.red;
                    return <div key={gd.id} style={{display:"grid",gridTemplateColumns:"120px 1fr 1fr",gap:6,alignItems:"center",padding:"6px 0",borderTop:"1px solid "+T.border}}>
                      <div style={{fontSize:10,fontWeight:700,color:T.text}}>
                        {gd.label+" "}
                        <span style={{color:gCol,fontWeight:800}}>{gNow}</span>
                      </div>
                      <select value={preset} onChange={function(e){applyFitAlertPreset84(gd.id,e.target.value);}}
                        style={{width:"100%",background:T.bg3,color:T.text,border:"1px solid "+T.border,borderRadius:6,padding:"5px 6px",fontSize:9}}>
                        <option value="active">{"Active"}</option>
                        <option value="3wk">{"Snooze 3wk"}</option>
                        <option value="season">{"Snooze Season"}</option>
                        <option value="silent">{"Permanently Silent"}</option>
                      </select>
                      <select value={floor} onChange={function(e){setFitAlertPref84(gd.id,"minSeverity",e.target.value,true);}}
                        style={{width:"100%",background:T.bg3,color:T.text,border:"1px solid "+T.border,borderRadius:6,padding:"5px 6px",fontSize:9}}>
                        <option value="any">{"Any Severity"}</option>
                        <option value="high">{"Critical Only"}</option>
                      </select>
                    </div>;
                  })}
                </div>;
              })()}
              
              <div style={assign({},cS,{padding:12})}>
                <div style={{fontWeight:700,fontSize:12,marginBottom:8}}>{"ðŸŽ¨ Visual Preferences"}</div>
                <div style={{display:"flex",gap:8,flexWrap:"wrap"}}>
                  <button style={mS(S.btn,S.btnSmall,{background:showScanlines?"rgba(251,191,36,0.15)":"rgba(255,255,255,0.04)",color:showScanlines?T.gold:T.faint,border:"1px solid "+(showScanlines?"rgba(251,191,36,0.3)":T.border)})}
                    onClick={function(){setShowScanlines(function(v){return !v;});}}>
                    {showScanlines?"ðŸ“º CRT Scanlines ON":"ðŸ“º CRT Scanlines OFF"}
                  </button>
                  <button style={mS(S.btn,S.btnSmall,{background:"rgba(34,211,238,0.15)",color:T.cyan,border:"1px solid rgba(34,211,238,0.3)"})}>
                    {"â–¦ Normal Roster"}
                  </button>
                </div>
                <div style={{fontSize:9,color:T.faint,marginTop:6}}>{"CRT scanlines add retro atmosphere. Disable if eye strain occurs."}</div>
              </div>
              
              <div style={assign({},cS,{padding:12})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <div style={{fontWeight:800,fontSize:13,color:T.purple}}>{"Music"}</div>
                  <div style={{display:"flex",gap:6}}>
                    <button style={mS(S.btn,S.btnSmall,{background:audioMuted?"rgba(239,68,68,0.12)":"rgba(16,185,129,0.12)",color:audioMuted?T.red:T.green,padding:"4px 10px"})}
                      onClick={function(){var m=AUDIO.toggle();setAudioMuted(m);}}>
                      {audioMuted?"Unmute":"Mute"}
                    </button>
                    {!audioMuted&&React.createElement("button",{style:mS(S.btn,S.btnSmall,{padding:"4px 10px"}),onClick:function(){AUDIO.next();}},"Skip")}
                  </div>
                </div>
                {!audioMuted&&nowPlaying&&React.createElement("div",{style:{fontSize:10,color:T.faint,marginBottom:8,fontStyle:"italic"}},"Playing: "+nowPlaying)}
                <div style={{fontSize:9,color:T.dim,marginBottom:8}}>
                  {(gamedayTrack?"Gameday: "+AUDIO.getName(gamedayTrack):"Gameday: Auto")+" - "+(userPlaylist.length)+"/"+MFD_JUKEBOX_ALL.length+" tracks in shuffle"}
                </div>
                <button style={mS(S.btn,{width:"100%",padding:"11px",fontWeight:800,fontSize:13,background:"rgba(168,85,247,0.12)",color:T.purple,border:"1px solid rgba(168,85,247,0.35)",borderRadius:10})}
                  onClick={function(){setScreen("music");}}>
                  {"Open Jukebox ->"}
                </button>
              </div>
                            
              <div style={assign({},cS,{padding:12})}>
                <div style={{fontWeight:700,fontSize:12,marginBottom:6}}>Game Info</div>
                <div style={{fontSize:10,color:T.dim,lineHeight:1.6}}>
                  {"Mr. Football Dynasty â€” v1 Public Release"}
                  {React.createElement("br")}
                  {"Save Version: "+SAVE_VERSION}
                  {React.createElement("br")}
                  {"ðŸ›ï¸ Vault: "+(DB.ready?"âœ… IndexedDB Active":"âš ï¸ Using window.storage fallback")}
                  {React.createElement("br")}
                  {"Mr. Football Dynasty â€” v1 Public Release"}
                  {React.createElement("br")}
                  {"ðŸ¤– Co-created with AI across 75+ sessions"}
                  {React.createElement("br")}
                  {"All teams, players, and names are fictional."}
                  {React.createElement("br")}
                  {"Seed: "+SEED_GLOBAL}
                </div>
                <button onClick={function(){setShowHelp(true);}} style={mS(S.btn,S.btnGhost,{marginTop:8,width:"100%",padding:"10px 16px"})}>{"ðŸ“– How to Play â€” Field Guide"}</button>
              </div>
              
              <div style={assign({},cS,{padding:12})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <div style={{fontWeight:700,fontSize:12}}>{"ðŸ›ï¸ Season Archive"}</div>
                  <button onClick={loadVaultArchives} style={mS(S.btn,S.btnGhost,{padding:"4px 10px",fontSize:10})}>{"ðŸ” Load Archives"}</button>
                </div>
                {vaultArchives===null && <div style={{fontSize:10,color:T.faint}}>{"Click 'Load Archives' to browse saved seasons from the Vault."}</div>}
                {vaultArchives&&vaultArchives.length===0 && <div style={{fontSize:10,color:T.faint}}>{"No archived seasons yet. Complete a season to auto-archive!"}</div>}
                {vaultArchives&&vaultArchives.length>0 && <div style={{display:"flex",flexDirection:"column",gap:6}}>
                  {vaultArchives.map(function(ar){
                    return <div key={ar.seasonId||ar.year} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",background:T.bg3,borderRadius:6,border:"1px solid "+T.border}}>
                      <div>
                        <div style={{fontWeight:700,fontSize:11,color:T.gold}}>{"Season "+ar.year}</div>
                        <div style={{fontSize:9,color:T.dim}}>
                          {ar.entry&&ar.entry.champ?("ðŸ† "+ar.entry.champ):""}
                          {ar.standings?" | "+ar.standings.length+" teams":""}
                          {ar.timestamp?" | "+new Date(ar.timestamp).toLocaleDateString():""}
                        </div>
                      </div>
                      <button onClick={function(){deleteVaultArchive(ar.seasonId||ar.year);}} style={mS(S.btn,{padding:"3px 8px",fontSize:9,background:"rgba(239,68,68,0.15)",color:T.red,border:"1px solid rgba(239,68,68,0.3)"})}>{"ðŸ—‘ï¸"}</button>
                    </div>;
                  })}
                </div>}
                <div style={{display:"flex",gap:6,marginTop:8}}>
                  <button style={mS(S.btn,S.btnGhost,{flex:1,padding:"8px",fontSize:10})} onClick={exportSave}>{"â¬‡ï¸ Export Save JSON"}</button>
                </div>
              </div>
            </div>
          )}
          
          {tab==="calendar" && (
            <div style={{display:"flex",flexDirection:"column",gap:6}}>
              <div style={{fontWeight:700}}>{"ðŸ“… Season Calendar"}</div>
              <div style={{fontSize:11,color:T.dim,marginBottom:4}}>{"Key dates, deadlines, and milestones. Tap an active step to jump right in."}</div>
              {CALENDAR.map(function(ev){
                var isPast=ev.week<season.week;var isCurrent=ev.week===season.week||ev.week===season.week+1;
                var calAction=null;var calPhaseMatch=false;
                if(ev.event==="Training Camp"&&season.phase==="preseason"){calPhaseMatch=true;calAction=function(){setTab("home");};}
                if(ev.event==="Opening Day"&&season.phase==="regular"&&season.week<=2){calPhaseMatch=true;calAction=simWeek;}
                if(ev.event==="Cut Day"&&season.phase==="cutDay"){calPhaseMatch=true;calAction=function(){setTab("roster");};}
                if(ev.event==="Trade Deadline"&&season.phase==="regular"&&season.week>=8&&season.week<=10){calPhaseMatch=true;calAction=function(){setTab("trade");};}
                if(ev.event==="Regular Season Ends"&&season.phase==="regular"&&done){calPhaseMatch=true;calAction=function(){setSeason(function(s){return assign({},s,{phase:"playoffs"});});};}
                if(ev.event==="Playoffs Begin"&&season.phase==="playoffs"){calPhaseMatch=true;calAction=function(){setTab("home");};}
                if(ev.event==="Re-Sign Phase"&&season.phase==="reSign"){calPhaseMatch=true;calAction=function(){setTab("reSign");};}
                if(ev.event==="Free Agency"&&season.phase==="freeAgency"){calPhaseMatch=true;calAction=function(){setTab("fa");};}
                if(ev.event==="Combine"&&season.phase==="combine"){calPhaseMatch=true;calAction=function(){setTab("combine");};}
                if(ev.event==="Draft"&&(season.phase==="draft"||season.phase==="drafting")){calPhaseMatch=true;calAction=season.phase==="draft"?startDraft:function(){setTab("draft");};}
                if(ev.event==="Owner Meeting"&&(season.phase==="offseason")){calPhaseMatch=true;calAction=function(){setTab("ownerReport");};}
                return React.createElement("div",{key:ev.week,style:assign({},cS,{
                  display:"flex",alignItems:"center",gap:12,padding:"10px 12px",
                  borderLeft:"4px solid "+(calPhaseMatch?T.gold:isCurrent?T.gold:isPast?T.faint:T.border),
                  opacity:isPast&&!calPhaseMatch?0.5:1,background:calPhaseMatch?"rgba(212,167,75,0.08)":isCurrent?"rgba(212,167,75,0.06)":T.bg2})},
                  React.createElement("div",{style:{fontSize:22,flexShrink:0}},ev.icon),
                  React.createElement("div",{style:{flex:1}},
                    React.createElement("div",{style:{fontWeight:700,fontSize:12,color:calPhaseMatch?T.gold:isCurrent?T.gold:T.text}},ev.event),
                    React.createElement("div",{style:{fontSize:10,color:T.dim}},ev.desc)
                  ),
                  calPhaseMatch&&calAction?React.createElement("button",{style:mS(S.btn,S.btnPrimary,{padding:"6px 14px",fontSize:10,flexShrink:0}),onClick:calAction},"â–¶ GO"):
                  React.createElement("div",{style:{fontSize:10,color:calPhaseMatch?T.gold:isCurrent?T.gold:T.faint,fontWeight:700,textAlign:"right"}},
                    ev.phase==="regular"?"Wk "+ev.week:ev.phase==="playoffs"?"Playoffs":"Offseason"
                  )
                );
              })}
            </div>
          )}
          
          {tab==="stories" && (function(){
            // STORY_STAGE v23: Cinematic storylines broadcast center
            var STORY_STAKES={
              holdout:{heat:"ðŸ”¥ FRANCHISE CRISIS",heatColor:"#ef4444",analystTake:"Money talks and drama walks. A holdout mid-season can poison a locker room faster than a losing streak. GM pressure is REAL."},
              rookie_spotlight:{heat:"â­ MUST-WATCH TV",heatColor:"#fbbf24",analystTake:"Every generational career starts with a moment. Is this the week this rookie announces themselves to the league?"},
              rivalry_heat:{heat:"âš”ï¸ BEEF ON SIGHT",heatColor:"#f97316",analystTake:"This isn't just a game anymore. Personal scores are getting settled. The league is watching."},
              hot_seat:{heat:"ðŸª‘ COACHING CROSSROADS",heatColor:"#ef4444",analystTake:"The margin between genius and fired is razor thin. This is the week that could define a coaching tenure."},
              milestone:{heat:"ðŸ“ˆ HISTORY IN THE MAKING",heatColor:"#22d3ee",analystTake:"Numbers that echo forever. One great game away from etching a name into the record books."},
              injury_comeback:{heat:"ðŸ¥ COMEBACK STORY",heatColor:"#a855f7",analystTake:"Nothing in sports hits harder than a player fighting back from the abyss. This comeback arc is must-see."},
              trade_rumor:{heat:"ðŸ“± TRADE WINDS",heatColor:"#f97316",analystTake:"When a player's name hits the wires, everything changes. The locker room feels it. The fans feel it. The player feels it."},
              fa_frenzy:{heat:"ðŸ’° MONEY SEASON",heatColor:"#10b981",analystTake:"FA frenzy is where dynasties are made and broken. Spend right and you're a genius. Overpay and you're handcuffed for years."},
              coaching_carousel:{heat:"ðŸŽ  STAFF POACHING",heatColor:"#f97316",analystTake:"Losing a coordinator is losing institutional knowledge. Your system bleeds when your staff walks out the door."},
              qb_controversy:{heat:"ðŸˆ QB DRAMA",heatColor:"#fbbf24",analystTake:"Two quarterbacks on a roster means you might have zero. This decision defines the season's identity."},
              locker_split:{heat:"ðŸ’¥ CULTURE WAR",heatColor:"#ef4444",analystTake:"Locker room splits are contagious. Handle this wrong and a playoff team becomes a .500 mess in three weeks."},
              contract_year:{heat:"ðŸ’Ž CONTRACT YEAR",heatColor:"#22d3ee",analystTake:"Playing for a payday brings out the best in some and the worst in others. Which type is this player?"},
              rookie_wall:{heat:"ðŸ§± WALL CHECK",heatColor:"#94a3b8",analystTake:"The rookie wall is real, it's predictable, and it's brutal. How a coach handles it determines if this kid develops or regresses."},
              record_chase:{heat:"ðŸ“Š HISTORY WATCH",heatColor:"#a855f7",analystTake:"Records fall once and stay in the books forever. We're witnessing history in real time."},
              underdog_run:{heat:"ðŸº CINDERELLA ALERT",heatColor:"#34d399",analystTake:"Every dynasty has its origin story. Don't overlook what's happening here. Nobody believes in them. That's the point."}
            };
            var storyList=(stories||[]).filter(Boolean);
            var activeStories=storyList.filter(function(s){return !s.resolved;});
            var resolvedStories=storyList.filter(function(s){return s.resolved;});
            // Headline story = highest-stakes active story
            var headlineStory=activeStories.length>0?activeStories[0]:null;
            var headlineTmpl=headlineStory?STORY_TEMPLATES.find(function(t2){return t2.id===headlineStory.templateId;}):null;
            // Arc cross-reference: find arc players matching story cast
            function getStoryArcInfo(s){
              if(!s.cast||!s.cast.playerName)return null;
              var matchP=(my.roster||[]).find(function(p){return p&&p.name===s.cast.playerName&&p._arcState;});
              if(!matchP)return null;
              return {p:matchP,arcInfo:ARC_SPOTLIGHT.lines[matchP._arcState]||{}};
            }
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              {/* Header */}
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div style={{fontWeight:700}}>{"ðŸ“º MFSN Storyline Center"}</div>
                <div style={{fontSize:10,color:T.dim}}>
                  {activeStories.length+" active"+(resolvedStories.length>0?" | "+resolvedStories.length+" resolved":"")}
                </div>
              </div>
              {/* Empty state */}
              {storyList.length===0&&<div style={{background:"linear-gradient(135deg,rgba(99,102,241,0.08),rgba(99,102,241,0.02))",
                border:"1px solid rgba(99,102,241,0.25)",borderRadius:10,padding:24,textAlign:"center"}}>
                <div style={{fontSize:28,marginBottom:8}}>{"ðŸŽ¬"}</div>
                <div style={{fontWeight:800,fontSize:13,color:"#a5b4fc",marginBottom:6}}>{"NO ACTIVE STORYLINES"}</div>
                <div style={{fontSize:10,color:T.dim,lineHeight:1.5}}>{"Sim weeks and watch drama unfold. Holdouts, rookie spotlights, rivalry escalations, QB controversies â€” the league writes its own script."}</div>
              </div>}
              {/* MFSN Headline Story panel */}
              {headlineStory&&headlineTmpl&&(function(){
                var stakes=STORY_STAKES[headlineStory.templateId]||{heat:"ðŸ“° DEVELOPING",heatColor:T.orange,analystTake:"Something big is brewing. Stay tuned."};
                var progress=Math.round(((headlineStory.stateIdx+1)/headlineTmpl.states.length)*100);
                var headline=headlineTmpl.headlines[headlineStory.stateIdx]||headlineTmpl.headlines[0];
                var cast23=headlineStory.cast||{};
                var castName23=cast23.playerName||"";
                headline=headline.replace(/\{name\}/g,castName23).replace(/\{team1\}/g,my.name||"").replace(/\{team2\}/g,"Rival").replace(/\{deadline\}/g,(headlineStory.weekExpires||0)+"");
                var arcInfo23=getStoryArcInfo(headlineStory);
                return <div style={{background:"linear-gradient(135deg,rgba(245,158,11,0.12),rgba(239,68,68,0.06))",
                  border:"1px solid rgba(245,158,11,0.40)",borderRadius:10,padding:12}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8}}>
                    <div style={{fontSize:9,letterSpacing:2,color:"#a5b4fc",fontWeight:900,textTransform:"uppercase"}}>
                      {"ðŸ“º MFSN HEADLINE STORY â€” WEEK "+season.week}
                    </div>
                    <div style={{fontSize:9,fontWeight:800,color:stakes.heatColor,padding:"2px 7px",
                      borderRadius:4,background:"rgba(0,0,0,0.3)"}}>{stakes.heat}</div>
                  </div>
                  <div style={{fontSize:14,fontWeight:900,color:"#fff",marginBottom:6,lineHeight:1.3}}>{headline}</div>
                  {castName23&&<div style={{display:"flex",gap:6,alignItems:"center",marginBottom:6}}>
                    <span style={{fontSize:9,color:T.dim}}>{"Starring:"}</span>
                    <span style={{fontSize:10,fontWeight:700,color:T.gold}}>{castName23}</span>
                    {arcInfo23&&<span style={{fontSize:9,padding:"1px 5px",borderRadius:3,
                      background:"rgba(0,0,0,0.3)",color:arcInfo23.arcInfo.badgeColor||"#fff",fontWeight:700}}>
                      {arcInfo23.arcInfo.badge||arcInfo23.p._arcState}
                    </span>}
                    {arcInfo23&&<span style={{fontSize:9,color:"rgba(165,180,252,0.7)",fontStyle:"italic"}}>
                      {"arc active â€” story and arc converging ðŸ”¥"}
                    </span>}
                  </div>}
                  <div style={{fontSize:10,color:"rgba(255,255,255,0.75)",fontStyle:"italic",lineHeight:1.5,
                    borderLeft:"3px solid "+stakes.heatColor,paddingLeft:8,marginBottom:8}}>
                    {"\u201C"+stakes.analystTake+"\u201D"}
                  </div>
                  {/* Progress states bar */}
                  <div style={{display:"flex",gap:3,marginBottom:6}}>
                    {headlineTmpl.states.map(function(st,si){
                      var done=si<=headlineStory.stateIdx;
                      var cur=si===headlineStory.stateIdx;
                      return <div key={si} style={{flex:1,height:5,borderRadius:3,
                        background:done?(cur?"linear-gradient(90deg,"+T.orange+","+T.gold+")":T.green+"88"):"rgba(255,255,255,0.08)",
                        border:cur?"none":"none",
                        transition:"background 0.3s"}}/>;
                    })}
                  </div>
                  <div style={{display:"flex",justifyContent:"space-between",fontSize:8,color:T.faint,marginBottom:headlineTmpl.actions&&headlineTmpl.actions.length>0?8:0}}>
                    <span>{"Act "+(headlineStory.stateIdx+1)+"/"+headlineTmpl.states.length+": "+headlineTmpl.states[headlineStory.stateIdx]}</span>
                    <span>{"Expires Wk "+headlineStory.weekExpires}</span>
                  </div>
                  {/* Action buttons â€” ONLY for headline story */}
                  {headlineTmpl.actions&&headlineTmpl.actions.length>0&&<div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                    {headlineTmpl.actions.map(function(a){
                      var btnBg=a.id==="pay"?"linear-gradient(90deg,#10b981,#059669)":a.id==="fire"?"linear-gradient(90deg,#ef4444,#dc2626)":a.id==="rush"?"linear-gradient(90deg,#f97316,#ea580c)":"rgba(255,255,255,0.08)";
                      var btnColor=["pay","fire","rush"].indexOf(a.id)>=0?"#fff":T.text;
                      return <button key={a.id} onClick={function(){handleStoryAction(headlineStory.id,a.id);}}
                        style={{background:btnBg,color:btnColor,border:"1px solid rgba(255,255,255,0.15)",
                          borderRadius:6,padding:"7px 14px",fontWeight:800,fontSize:10,cursor:"pointer",
                          transition:"opacity 0.15s"}}>
                        {a.label+(a.cost>0?" ($"+a.cost+"M)":"")}
                      </button>;
                    })}
                  </div>}
                </div>;
              })()}
              {/* Secondary active stories */}
              {activeStories.length>1&&<div>
                <div style={{fontSize:9,letterSpacing:2,color:T.dim,fontWeight:700,textTransform:"uppercase",marginBottom:6}}>
                  {"ðŸ“° OTHER DEVELOPING STORIES"}
                </div>
                <div style={{display:"flex",flexDirection:"column",gap:6}}>
                  {activeStories.slice(1).map(function(s){
                    var tmpl2=STORY_TEMPLATES.find(function(t2){return t2.id===s.templateId;});
                    if(!tmpl2)return null;
                    var stakes2=STORY_STAKES[s.templateId]||{heat:"ðŸ“° DEVELOPING",heatColor:T.orange};
                    var prog2=Math.round(((s.stateIdx+1)/tmpl2.states.length)*100);
                    var hl2=tmpl2.headlines[s.stateIdx]||tmpl2.headlines[0];
                    var sCast2=s.cast||{};
                    hl2=hl2.replace(/\{name\}/g,sCast2.playerName||"").replace(/\{team1\}/g,my.name||"").replace(/\{team2\}/g,"Rival").replace(/\{deadline\}/g,(s.weekExpires||0)+"");
                    var arcI2=getStoryArcInfo(s);
                    return <div key={s.id} style={{background:"rgba(255,255,255,0.02)",border:"1px solid "+T.border,
                      borderLeft:"3px solid "+stakes2.heatColor,borderRadius:8,padding:"8px 10px"}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                        <div style={{display:"flex",gap:6,alignItems:"center"}}>
                          <span style={{fontSize:16}}>{tmpl2.icon}</span>
                          <div>
                            <div style={{fontWeight:800,fontSize:11,color:"#fff"}}>{hl2}</div>
                            <div style={{display:"flex",gap:5,alignItems:"center",marginTop:1}}>
                              <span style={{fontSize:8,color:stakes2.heatColor,fontWeight:700}}>{stakes2.heat}</span>
                              {arcI2&&<span style={{fontSize:8,padding:"0px 4px",borderRadius:3,
                                background:"rgba(0,0,0,0.3)",color:arcI2.arcInfo.badgeColor||"#fff",fontWeight:700}}>{arcI2.arcInfo.badge}</span>}
                            </div>
                          </div>
                        </div>
                        <div style={{textAlign:"right",minWidth:40}}>
                          <div style={{fontSize:9,color:T.gold,fontWeight:800}}>{prog2+"%"}</div>
                          <div style={{fontSize:7,color:T.faint}}>{"Wk "+s.weekExpires}</div>
                        </div>
                      </div>
                      {/* Mini progress bar */}
                      <div style={{height:3,background:"rgba(255,255,255,0.06)",borderRadius:2}}>
                        <div style={{height:"100%",width:prog2+"%",background:"linear-gradient(90deg,"+stakes2.heatColor+","+T.gold+")",borderRadius:2}}/>
                      </div>
                      {/* Action buttons for non-headline stories */}
                      {tmpl2.actions&&tmpl2.actions.length>0&&<div style={{display:"flex",gap:5,marginTop:6,flexWrap:"wrap"}}>
                        {tmpl2.actions.map(function(a2){
                          return <button key={a2.id} onClick={function(){handleStoryAction(s.id,a2.id);}}
                            style={{background:"rgba(255,255,255,0.07)",color:T.text,border:"1px solid "+T.border,
                              borderRadius:5,padding:"4px 10px",fontWeight:700,fontSize:9,cursor:"pointer"}}>
                            {a2.label+(a2.cost>0?" ($"+a2.cost+"M)":"")}
                          </button>;
                        })}
                      </div>}
                    </div>;
                  })}
                </div>
              </div>}
              {/* Resolved stories vault */}
              {resolvedStories.length>0&&<div style={{background:"rgba(16,185,129,0.05)",
                border:"1px solid rgba(16,185,129,0.20)",borderRadius:8,padding:10}}>
                <div style={{fontSize:9,letterSpacing:2,color:T.green,fontWeight:900,marginBottom:6,textTransform:"uppercase"}}>
                  {"âœ… RESOLVED STORYLINES â€” SEASON "+season.year+" VAULT"}
                </div>
                {resolvedStories.slice(0,4).map(function(s){
                  var tmpl3=STORY_TEMPLATES.find(function(t2){return t2.id===s.templateId;});
                  if(!tmpl3)return null;
                  var sCast3=s.cast||{};
                  var finalHl=tmpl3.headlines[tmpl3.headlines.length-1]||tmpl3.headlines[0];
                  finalHl=finalHl.replace(/\{name\}/g,sCast3.playerName||"").replace(/\{team1\}/g,my.name||"").replace(/\{team2\}/g,"Rival");
                  return <div key={s.id} style={{display:"flex",gap:8,alignItems:"center",padding:"5px 0",
                    borderBottom:"1px solid rgba(16,185,129,0.10)"}}>
                    <span style={{fontSize:16}}>{tmpl3.icon}</span>
                    <div style={{flex:1}}>
                      <div style={{fontSize:10,fontWeight:700,color:T.green}}>{finalHl}</div>
                      <div style={{fontSize:8,color:T.faint}}>{"Wk "+s.weekStarted+"â€“"+s.weekExpires+(sCast3.playerName?" | "+sCast3.playerName:"")}</div>
                    </div>
                    <span style={{fontSize:9,color:T.green,fontWeight:800}}>{"âœ…"}</span>
                  </div>;
                })}
                {resolvedStories.length>4&&<div style={{fontSize:9,color:T.faint,marginTop:4,textAlign:"center"}}>
                  {"+"+(resolvedStories.length-4)+" more resolved this season"}
                </div>}
              </div>}
            </div>;
          })()}
          
          {tab==="records"&&(function(){
            var recs80=RECORDS_WALL.build(history,teams,myId);
            var seasonRecs80=RECORDS_WALL.categories.filter(function(c){return c.scope==="season";});
            var careerRecs80=RECORDS_WALL.categories.filter(function(c){return c.scope==="career";});
            return React.createElement("div",{style:{padding:12}},
              React.createElement("div",{style:{fontSize:16,fontWeight:900,color:T.gold,marginBottom:2,letterSpacing:1}},"ðŸ… ALL-TIME FRANCHISE RECORDS"),
              React.createElement("div",{style:{fontSize:9,color:T.dim,marginBottom:12}},"Every great moment. Every broken barrier. The permanent ledger of this franchise."),
              React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.cyan,marginBottom:6,paddingBottom:3,borderBottom:"1px solid "+T.cyan+"44"}},"ðŸ“… SINGLE-SEASON RECORDS"),
              React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:12}},
                seasonRecs80.map(function(cat80){
                  var rec80=recs80[cat80.id];
                  var hasRecord=rec80&&rec80.holder;
                  return React.createElement("div",{key:"sr"+cat80.id,style:{padding:"8px 10px",borderRadius:8,background:T.bg3,border:"1px solid "+(hasRecord?T.gold+"55":T.border)}},
                    React.createElement("div",{style:{fontSize:8,color:T.dim,marginBottom:2}},cat80.icon+" "+cat80.label),
                    hasRecord?React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:14,fontWeight:900,color:T.gold}},rec80.value.toLocaleString()),
                      React.createElement("div",{style:{fontSize:9,fontWeight:700}},rec80.holder),
                      React.createElement("div",{style:{fontSize:7,color:T.dim}},(rec80.team||"")+(rec80.year?" â€¢ "+rec80.year:""))
                    ):React.createElement("div",{style:{fontSize:9,color:T.faint,fontStyle:"italic"}},"Yours to set.")
                  );
                })
              ),
              React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.purple,marginBottom:6,paddingBottom:3,borderBottom:"1px solid "+T.purple+"44"}},"ðŸ“š CAREER RECORDS"),
              React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}},
                careerRecs80.map(function(cat80){
                  var rec80=recs80[cat80.id];
                  var hasRecord=rec80&&rec80.holder;
                  return React.createElement("div",{key:"cr"+cat80.id,style:{padding:"8px 10px",borderRadius:8,background:T.bg3,border:"1px solid "+(hasRecord?T.purple+"55":T.border)}},
                    React.createElement("div",{style:{fontSize:8,color:T.dim,marginBottom:2}},cat80.icon+" "+cat80.label),
                    hasRecord?React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:14,fontWeight:900,color:T.purple}},rec80.value.toLocaleString()),
                      React.createElement("div",{style:{fontSize:9,fontWeight:700}},rec80.holder),
                      React.createElement("div",{style:{fontSize:7,color:T.dim}},rec80.team||"")
                    ):React.createElement("div",{style:{fontSize:9,color:T.faint,fontStyle:"italic"}},"No record holder yet.")
                  );
                })
              )
            );
          })()}
          
          {tab==="mentors"&&my&&(function(){
            var eligibleMentors=my.roster.filter(MENTOR_SYSTEM.isMentorEligible);
            var eligibleMentees=my.roster.filter(MENTOR_SYSTEM.isMenteeEligible);
            var activePairs=Object.keys(mentorships80).map(function(mId){
              var mentor=my.roster.find(function(p){return p.id===mId;});
              var mentee=my.roster.find(function(p){return p.id===mentorships80[mId];});
              return mentor&&mentee?{mentor:mentor,mentee:mentee}:null;
            }).filter(Boolean);
            var foBonus=frontOffice78?FRONT_OFFICE.getBonus(frontOffice78,"morale"):0;
            var SUB_TABS=[{id:"active",label:"\u2b50 Active Bonds",count:activePairs.length},{id:"mentors",label:"\ud83e\uddd3 Mentors",count:eligibleMentors.filter(function(m){return !mentorships80[m.id];}).length},{id:"mentees",label:"\ud83c\udf31 Mentees",count:eligibleMentees.length}];
            return React.createElement("div",{style:{padding:12}},
              React.createElement("div",{style:{fontSize:16,fontWeight:900,color:T.cyan,marginBottom:2}},"\ud83e\udd1d MENTOR / PROT\xc9G\xc9"),
              React.createElement("div",{style:{fontSize:9,color:T.dim,marginBottom:8}},"Pair veterans with young players. The vet passes on wisdom. The kid grows faster."+(foBonus>0?" \ud83c\udfaf FO Bonus: +"+Math.round(foBonus*10)+"% weekly gain":"")),
              React.createElement("div",{style:{display:"flex",gap:4,marginBottom:12}},
                SUB_TABS.map(function(st){
                  var isActive=mentorView81===st.id;
                  return React.createElement("button",{key:st.id,onClick:function(){setMentorView81(st.id);},
                    style:{flex:1,padding:"6px 4px",fontSize:9,fontWeight:isActive?800:500,borderRadius:8,border:"1px solid "+(isActive?T.cyan+"66":T.border),
                    background:isActive?"rgba(34,211,238,0.1)":"transparent",color:isActive?T.cyan:T.dim,cursor:"pointer"}},
                    st.label+(st.count>0?" ("+st.count+")":"")
                  );
                })
              ),
              mentorView81==="active"?React.createElement("div",null,
                activePairs.length===0?React.createElement("div",{style:{color:T.faint,fontSize:10,padding:20,textAlign:"center"}},"No active mentor bonds. Pair a veteran with a young player to start developing talent!"):null,
                activePairs.map(function(pair,pi){
                  var weeklyBonus=MENTOR_SYSTEM.weeklyBonus(pair.mentor,pair.mentee);
                  var boosted=foBonus>0?weeklyBonus*(1+foBonus*0.1):weeklyBonus;
                  var ovrGap=pair.mentor.ovr-pair.mentee.ovr;
                  var compat=ovrGap>=20?"\ud83d\udfe2 Perfect":ovrGap>=10?"\ud83d\udfe1 Good":"\ud83d\udfe0 Fair";
                  return React.createElement("div",{key:"ap"+pi,style:{padding:"12px 14px",marginBottom:6,borderRadius:10,background:"rgba(251,191,36,0.06)",border:"1px solid "+T.gold+"44"}},
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
                      React.createElement("div",null,
                        React.createElement("div",{style:{fontSize:11,fontWeight:800,color:"#fff"}},pair.mentor.name),
                        React.createElement("div",{style:{fontSize:8,color:T.dim}},pair.mentor.pos+" \u2022 "+pair.mentor.ovr+" OVR \u2022 Age "+pair.mentor.age)
                      ),
                      React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.gold}},"\u2193 mentoring \u2193")
                    ),
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
                      React.createElement("div",null,
                        React.createElement("div",{style:{fontSize:11,fontWeight:800,color:"#fff"}},pair.mentee.name),
                        React.createElement("div",{style:{fontSize:8,color:T.dim}},pair.mentee.pos+" \u2022 "+pair.mentee.ovr+" OVR \u2192 pot "+pair.mentee.pot)
                      ),
                      React.createElement("div",{style:{textAlign:"right"}},
                        React.createElement("div",{style:{fontSize:14,fontWeight:900,color:T.green}},"+"+boosted.toFixed(1)+"/wk"),
                        React.createElement("div",{style:{fontSize:7,color:T.faint}},compat)
                      )
                    ),
                    React.createElement("div",{style:{height:4,borderRadius:2,background:T.bg3,marginBottom:6}},
                      React.createElement("div",{style:{height:"100%",borderRadius:2,background:"linear-gradient(90deg,"+T.cyan+","+T.gold+")",width:Math.min(100,Math.round((pair.mentee.ovr/pair.mentee.pot)*100))+"%"}})
                    ),
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                      React.createElement("div",{style:{fontSize:8,color:T.faint}},Math.round((pair.mentee.ovr/pair.mentee.pot)*100)+"% to potential"),
                      React.createElement("button",{style:{fontSize:8,padding:"3px 10px",borderRadius:6,background:"rgba(239,68,68,0.1)",border:"1px solid "+T.red+"66",cursor:"pointer",color:T.red},onClick:function(){setMentorships80(function(prev){var upd=assign({},prev);delete upd[pair.mentor.id];return upd;});}
                      },"End Bond")
                    )
                  );
                })
              ):null,
              mentorView81==="mentors"?React.createElement("div",null,
                eligibleMentors.filter(function(m){return !mentorships80[m.id];}).length===0?React.createElement("div",{style:{color:T.faint,fontSize:10,padding:20,textAlign:"center"}},"No available mentors. Veterans (30+, 75+ OVR starters) qualify."):null,
                eligibleMentors.filter(function(m){return !mentorships80[m.id];}).map(function(mentor80,mi){
                  var compatMentees=eligibleMentees.filter(function(m){return MENTOR_SYSTEM.canPair(mentor80,m)&&!Object.keys(mentorships80).map(function(k){return mentorships80[k];}).some(function(id){return id===m.id;});});
                  return React.createElement("div",{key:"em"+mi,style:{padding:"10px 12px",marginBottom:6,borderRadius:10,background:T.bg3,border:"1px solid "+T.border}},
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
                      React.createElement("div",null,
                        React.createElement("div",{style:{fontWeight:700,fontSize:11}},mentor80.name),
                        React.createElement("div",{style:{color:T.dim,fontSize:9}},mentor80.pos+" \u2022 "+mentor80.ovr+" OVR \u2022 Age "+mentor80.age)
                      ),
                      React.createElement("span",{style:{fontSize:8,color:T.gold,fontWeight:700,padding:"2px 8px",borderRadius:6,background:T.gold+"15"}},
                        mentor80.devTrait==="superstar"?"\ud83c\udf1f Superstar":mentor80.devTrait==="star"?"\u2b50 Star":"\u2714 Vet"
                      )
                    ),
                    compatMentees.length>0?React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:8,color:T.faint,marginBottom:4}},"Compatible mentees:"),
                      React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap"}},
                        compatMentees.slice(0,4).map(function(mentee80,mti){
                          var gap81=mentor80.ovr-mentee80.ovr;
                          var compatColor=gap81>=20?T.green:gap81>=10?T.gold:T.orange;
                          return React.createElement("button",{key:"mm"+mti,
                            style:{padding:"4px 10px",fontSize:8,borderRadius:6,background:compatColor+"15",border:"1px solid "+compatColor+"44",cursor:"pointer",color:compatColor,fontWeight:700},
                            onClick:function(){
                              setMentorships80(function(prev){var upd=assign({},prev);upd[mentor80.id]=mentee80.id;return upd;});
                              addN("\ud83e\udd1d MENTOR BOND: "+mentor80.name+" will mentor "+mentee80.name+". Watch them grow.","gold");
                              setMentorView81("active");
                            }
                          },mentee80.name.split(" ").slice(-1)[0]+" ("+mentee80.ovr+")");
                        })
                      )
                    ):React.createElement("div",{style:{fontSize:8,color:T.faint,fontStyle:"italic"}},"No compatible mentees available")
                  );
                })
              ):null,
              mentorView81==="mentees"?React.createElement("div",null,
                eligibleMentees.length===0?React.createElement("div",{style:{color:T.faint,fontSize:10,padding:20,textAlign:"center"}},"No eligible mentees. Young players (\u226423, same position group) qualify."):null,
                eligibleMentees.map(function(mentee81,mti){
                  var alreadyPaired=Object.keys(mentorships80).some(function(k){return mentorships80[k]===mentee81.id;});
                  var potGap=mentee81.pot-mentee81.ovr;
                  return React.createElement("div",{key:"me"+mti,style:{padding:"10px 12px",marginBottom:4,borderRadius:8,background:alreadyPaired?"rgba(34,197,94,0.06)":T.bg3,border:"1px solid "+(alreadyPaired?T.green+"44":T.border),opacity:alreadyPaired?0.7:1}},
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                      React.createElement("div",null,
                        React.createElement("div",{style:{fontWeight:700,fontSize:11}},mentee81.name),
                        React.createElement("div",{style:{color:T.dim,fontSize:9}},mentee81.pos+" \u2022 "+mentee81.ovr+" OVR \u2192 "+mentee81.pot+" pot \u2022 Age "+mentee81.age)
                      ),
                      React.createElement("div",{style:{textAlign:"right"}},
                        React.createElement("div",{style:{fontSize:12,fontWeight:800,color:potGap>=15?T.gold:potGap>=8?T.green:T.dim}},"+"+potGap),
                        React.createElement("div",{style:{fontSize:7,color:T.faint}},"growth room"),
                        alreadyPaired?React.createElement("div",{style:{fontSize:7,color:T.green,marginTop:2}},"\u2714 Paired"):null
                      )
                    )
                  );
                })
              ):null
            );
          })()}
          
          {tab==="almanac" && (function(){
            var champs={};// teamAbbr â†’ ring count
            var dynastyMap={};// teamAbbr â†’ {wins, losses, seasons, titles, bestW, bestL}
            var mvpHistory=[];var dpoyHistory=[];
            history.forEach(function(h){
              var abbr=h.champ?h.champ.abbr:"?";
              champs[abbr]=(champs[abbr]||0)+1;
              if(h.teamRecords){h.teamRecords.forEach(function(tr){
                if(!dynastyMap[tr.abbr])dynastyMap[tr.abbr]={wins:0,losses:0,seasons:0,titles:0,bestW:0,bestL:0,id:tr.id};
                var d=dynastyMap[tr.abbr];d.wins+=tr.wins;d.losses+=tr.losses;d.seasons+=1;
                if(tr.wins>d.bestW||(tr.wins===d.bestW&&tr.losses<d.bestL)){d.bestW=tr.wins;d.bestL=tr.losses;}
                if(tr.id===(h.winnerId))d.titles+=1;
              });}
              if(h.mvp)mvpHistory.push({year:h.year,name:h.mvp.name,pos:h.mvp.pos,tm:h.mvp.tm});
              if(h.dpoy)dpoyHistory.push({year:h.year,name:h.dpoy.name,pos:h.dpoy.pos,tm:h.dpoy.tm});
            });
            var champList=Object.keys(champs).map(function(k){
              var t2=teams.find(function(t3){return t3.abbr===k;});
              return {abbr:k,rings:champs[k],team:t2};
            }).sort(function(a,b){return b.rings-a.rings;});
            var teamMVPs={};var teamDPOYs={};
            mvpHistory.forEach(function(m){teamMVPs[m.tm]=(teamMVPs[m.tm]||0)+1;});
            dpoyHistory.forEach(function(m){teamDPOYs[m.tm]=(teamDPOYs[m.tm]||0)+1;});
            var dynastyList=Object.keys(dynastyMap).map(function(k){
              var d=assign({},dynastyMap[k],{abbr:k,team:teams.find(function(t3){return t3.abbr===k;})});
              d.mvps=teamMVPs[k]||0;d.dpoys=teamDPOYs[k]||0;
              d.dynastyIdx=calcDynastyIndex(d);
              var teamId2=d.team?d.team.id:null;
              d.peak=teamId2?calcPeakPower(history,teamId2):{score:0};
              d.longevity=teamId2?calcLongevity(history,teamId2):{score:0};
              return d;
            }).sort(function(a,b){return b.dynastyIdx-a.dynastyIdx;});
            var mvpCounts={};mvpHistory.forEach(function(m){mvpCounts[m.name]=(mvpCounts[m.name]||0)+1;});
            var topMVPs=Object.keys(mvpCounts).map(function(k){return{name:k,count:mvpCounts[k]};}).sort(function(a,b){return b.count-a.count;}).slice(0,5);
            var rivEntries=season.rivalries?Object.keys(season.rivalries).map(function(k){return season.rivalries[k];}).filter(function(r){return r.heat>=6;}).sort(function(a,b){return b.heat-a.heat;}).slice(0,5):[];
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:700}}>{"ðŸ“– League Almanac"}</div>
              <div style={{fontSize:11,color:T.dim}}>{"Complete championship history, dynasty tracker, and league records."}</div>
              
              <div style={assign({},cS,{borderColor:T.gold})}>
                <div style={{fontSize:10,color:T.gold,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ† CHAMPIONSHIP RINGS"}</div>
                {champList.length===0?<div style={{color:T.faint,fontSize:11}}>{"No champions yet. Win the first ring!"}</div>:
                champList.map(function(c,ci){
                  return <div key={c.abbr} style={{display:"flex",alignItems:"center",gap:8,padding:"4px 0",borderBottom:ci<champList.length-1?"1px solid "+T.border:"none"}}>
                    <div style={{width:24,textAlign:"center",fontWeight:900,fontSize:14,color:ci===0?T.gold:ci<3?T.green:T.dim}}>{ci+1}</div>
                    {c.team&&React.createElement(TeamLogo,{team:c.team,size:20})}
                    <div style={{flex:1,fontWeight:700,fontSize:12}}>{c.abbr}</div>
                    <div style={{display:"flex",gap:1}}>{Array.from({length:c.rings},function(_,ri){return <span key={ri}>{"ðŸ’"}</span>;})}</div>
                    <div style={{fontWeight:800,fontSize:14,color:T.gold}}>{c.rings}</div>
                  </div>;
                })}
              </div>
              
              {dynastyList.length>0 && <div style={assign({},cS,{borderColor:T.cyan})}>
                <div style={{fontSize:10,color:T.cyan,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ‘‘ DYNASTY INDEX RANKINGS"}</div>
                {dynastyList.slice(0,10).map(function(d,di){
                  return <div key={d.abbr}>
                    <div style={{display:"flex",alignItems:"center",gap:8,padding:"3px 0",borderBottom:di<Math.min(dynastyList.length,10)-1?"1px solid "+T.border:"none"}}>
                      <div style={{width:22,textAlign:"center",fontWeight:800,fontSize:12,color:di===0?T.gold:di<3?T.green:T.dim}}>{di+1}</div>
                      {d.team&&React.createElement(TeamLogo,{team:d.team,size:16})}
                      <div style={{flex:1,fontSize:11}}><span style={{fontWeight:700}}>{d.abbr}</span>{" "+d.wins+"-"+d.losses+" ("+d.seasons+"s)"}</div>
                      <span style={{fontSize:9,color:T.faint}}>{"Best: "+d.bestW+"-"+d.bestL}</span>
                      {d.titles>0 && <span style={{fontSize:10}}>{"ðŸ’Ã—"+d.titles}</span>}
                      <span style={{fontSize:10,fontWeight:800,color:di===0?T.gold:T.cyan,minWidth:35,textAlign:"right"}}>{d.dynastyIdx}</span>
                    </div>
                    <div style={{fontSize:8,color:T.faint,paddingLeft:24,marginTop:1}}>
                      {d.peak&&d.peak.score>0?"âš¡ Peak: "+d.peak.score+" ("+d.peak.startYear+"-"+d.peak.endYear+")":""}
                      {d.longevity&&d.longevity.score>0?" | ðŸ›ï¸ Longevity: "+d.longevity.score+" ("+d.longevity.consistency+"%W seasons)":""}
                    </div>
                  </div>;
                })}
              </div>}
              
              {history.length>=5 && dynastyList.length>0 && <div style={assign({},cS,{borderColor:"#818cf8"})}>
                <div style={{fontSize:10,color:"#818cf8",fontWeight:700,letterSpacing:1,marginBottom:6}}>{"âš¡ PEAK POWER (Best 5-Year Window)"}</div>
                {dynastyList.slice(0,8).map(function(d,di){
                  var pk=d.team?calcPeakPower(history,d.team.id):{score:0};
                  return <div key={d.abbr+"pk"} style={{display:"flex",alignItems:"center",gap:6,padding:"2px 0",fontSize:11,
                    borderBottom:di<7?"1px solid "+T.border:"none"}}>
                    <span style={{width:18,fontWeight:800,color:di<3?T.gold:T.dim}}>{di+1}</span>
                    {d.team&&React.createElement(TeamLogo,{team:d.team,size:14})}
                    <span style={{fontWeight:700,flex:1}}>{d.abbr}</span>
                    <span style={{fontSize:9,color:T.faint}}>{pk.startYear&&pk.endYear?pk.startYear+"â€“"+pk.endYear:""}</span>
                    <span style={{fontWeight:800,color:"#818cf8"}}>{pk.score}</span>
                  </div>;
                })}
              </div>}
              {history.length>=3 && dynastyList.length>0 && <div style={assign({},cS,{borderColor:T.green})}>
                <div style={{fontSize:10,color:T.green,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸŒ¿ LONGEVITY (Sustained Excellence)"}</div>
                {dynastyList.slice(0,8).map(function(d,di){
                  var lg=d.team?calcLongevity(history,d.team.id):{score:0,winningSzns:0,consistency:0};
                  return <div key={d.abbr+"lg"} style={{display:"flex",alignItems:"center",gap:6,padding:"2px 0",fontSize:11,
                    borderBottom:di<7?"1px solid "+T.border:"none"}}>
                    <span style={{width:18,fontWeight:800,color:di<3?T.gold:T.dim}}>{di+1}</span>
                    {d.team&&React.createElement(TeamLogo,{team:d.team,size:14})}
                    <span style={{fontWeight:700,flex:1}}>{d.abbr}</span>
                    <span style={{fontSize:9,color:T.faint}}>{lg.winningSzns+"W szns Â· "+lg.consistency+"%"}</span>
                    <span style={{fontWeight:800,color:T.green}}>{lg.score}</span>
                  </div>;
                }).sort(function(a,b){return 0;})}
              </div>}
              
              {topMVPs.length>0 && <div style={assign({},cS,{borderColor:T.purple})}>
                <div style={{fontSize:10,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸŒŸ MVP LEADERS"}</div>
                {topMVPs.map(function(m,mi){
                  return <div key={mi} style={{display:"flex",gap:6,fontSize:11,padding:"2px 0"}}>
                    <span style={{fontWeight:800,color:mi===0?T.gold:T.dim,width:18}}>{m.count+"Ã—"}</span>
                    <span style={{fontWeight:700}}>{m.name}</span>
                  </div>;
                })}
              </div>}
              
              {(function(){
                var ladder=buildRivalryLadder(season.rivalries,teams);
                if(ladder.length===0)return null;
                return <div style={assign({},cS,{borderColor:T.orange})}>
                  <div style={{fontSize:10,color:T.orange,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ”¥ RIVALRY LADDER"}</div>
                  {ladder.map(function(r,ri){
                    var nextGame=sched.find(function(g){return !g.played&&((g.home===r.t1.id&&g.away===r.t2.id)||(g.home===r.t2.id&&g.away===r.t1.id));});
                    return <div key={ri} style={{padding:"5px 0",borderBottom:ri<ladder.length-1?"1px solid "+T.border:"none"}}>
                      <div style={{display:"flex",gap:6,fontSize:11,alignItems:"center"}}>
                        {React.createElement(TeamLogo,{team:r.t1,size:14})}
                        <span style={{fontWeight:700}}>{r.t1.abbr+" vs "+r.t2.abbr}</span>
                        {React.createElement(TeamLogo,{team:r.t2,size:14})}
                        <span style={{fontSize:9,color:T.faint}}>{"Series: "+r.seriesRecord}</span>
                        <span>{r.emoji}</span>
                        <span style={{fontWeight:800,color:r.heat>=13?T.red:T.orange}}>{r.heat}</span>
                        <span style={{fontSize:8,padding:"1px 4px",borderRadius:3,color:T.bg,fontWeight:700,
                          background:r.tier==="BLOOD_FEUD"?"#ef4444":r.tier==="BITTER"?"#f59e0b":"#64748b"}}>{r.tier.replace("_"," ")}</span>
                      </div>
                      
                      {(function(){
                        var tName=getTrophyName(trophyNames,r.t1.id,r.t2.id);
                        return <div style={{display:"flex",gap:4,alignItems:"center",paddingLeft:20,marginTop:1}}>
                          {tName && <span style={{fontSize:8,color:T.gold,fontWeight:700}}>{"ðŸ·ï¸ "+tName}</span>}
                          <button onClick={function(){
                            var newName=prompt("Name this rivalry trophy:"+(tName?" (current: "+tName+")":""),tName||"");
                            if(newName!==null){setTrophyNames(function(old){return setTrophyNameForRivalry(old,r.t1.id,r.t2.id,newName);});}
                          }} style={{fontSize:7,padding:"1px 4px",borderRadius:3,border:"1px solid "+T.border,
                            background:"transparent",color:T.faint,cursor:"pointer"}}>{tName?"âœï¸":"ðŸ·ï¸ Name"}</button>
                        </div>;
                      })()}
                      {r.moments.length>0 && <div style={{fontSize:9,color:T.dim,paddingLeft:20,marginTop:2}}>
                        {r.moments.map(function(m,mi){
                          var catEmojis=(m.categories||[]).map(function(c){return MOMENT_CATEGORIES[c]?MOMENT_CATEGORIES[c].emoji:"";}).join("");
                          return <span key={mi}>{(mi>0?" Â· ":"")+(catEmojis||m.emoji||"âš¡")+" "+m.text}</span>;
                        })}
                      </div>}
                      
                      {r.trophies&&r.trophies.length>0 && <div style={{fontSize:8,color:T.faint,paddingLeft:20,marginTop:2,display:"flex",gap:8}}>
                        {r.trophies.map(function(tr,ti){
                          return <span key={ti} style={{color:tr.winner==="tie"?T.dim:T.gold}}>{"ðŸ† "+tr.label+": "+tr.value}</span>;
                        })}
                      </div>}
                      {nextGame && <div style={{fontSize:8,color:T.cyan,paddingLeft:20,marginTop:1}}>
                        {"ðŸ“… Next meeting: Week "+nextGame.week}
                      </div>}
                    </div>;
                  })}
                </div>;
              })()}
              
              {(function(){
                var eraCards=generateEraCards(history,teams);
                if(eraCards.length===0)return null;
                return <div style={assign({},cS,{borderColor:"#818cf8"})}>
                  <div style={{fontSize:10,color:"#818cf8",fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ“œ ERA CARDS"}</div>
                  {eraCards.map(function(era,ei){
                    var winPct=era.wins+era.losses>0?Math.round(era.wins/(era.wins+era.losses)*100):0;
                    return <div key={ei} style={{padding:"6px 0",borderBottom:ei<eraCards.length-1?"1px solid "+T.border:"none"}}>
                      <div style={{display:"flex",gap:6,alignItems:"center",justifyContent:"space-between"}}>
                        <div style={{display:"flex",gap:6,alignItems:"center"}}>
                          {era.team&&React.createElement(TeamLogo,{team:era.team,size:16})}
                          <div style={{fontWeight:800,fontSize:12,color:era.titles>=2?T.gold:T.fg}}>{era.start+"â€“"+era.end+": "+era.abbr+" Era"}</div>
                        </div>
                        <span style={{fontSize:9,fontWeight:800,color:"#818cf8",padding:"1px 5px",borderRadius:4,
                          background:"rgba(129,140,248,0.1)"}}>{era.avgDom+" DOM"}</span>
                      </div>
                      <div style={{fontSize:10,color:T.dim,marginTop:2}}>
                        {era.titles>0?("ðŸ’Ã—"+era.titles+" | "):""}
                        {era.wins+"-"+era.losses+" ("+winPct+"% W) | "+era.seasons+" seasons"}
                        {era.playoffWins>0?(" | ðŸ† "+era.playoffWins+" playoff W"):""}
                        {era.offRank1>0?(" | #1 OFF Ã—"+era.offRank1):""}
                        {era.defRank1>0?(" | #1 DEF Ã—"+era.defRank1):""}
                      </div>
                      
                      <div style={{fontSize:9,color:"#818cf8",fontStyle:"italic",marginTop:3,paddingLeft:4,
                        borderLeft:"2px solid rgba(129,140,248,0.3)"}}>{generateEraStoryline(era,history,teams)}</div>
                    </div>;
                  })}
                </div>;
              })()}
              
              {(function(){
                var hos=buildHallOfSeasons(history,teams);
                if(hos.length===0)return null;
                return <div style={assign({},cS,{borderColor:T.gold})}>
                  <div style={{fontSize:10,color:T.gold,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ›ï¸ HALL OF SEASONS â€” GREATEST TEAMS EVER"}</div>
                  {hos.map(function(hs,hsi){
                    var winPct=hs.wins+hs.losses>0?Math.round(hs.wins/(hs.wins+hs.losses)*100):0;
                    return <div key={hsi} style={{padding:"5px 0",borderBottom:hsi<hos.length-1?"1px solid "+T.border:"none"}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                        <div style={{display:"flex",gap:6,alignItems:"center"}}>
                          <span style={{width:18,fontSize:11,fontWeight:800,color:hsi<3?T.gold:hsi<10?T.text:T.dim}}>{hsi+1}</span>
                          {hs.team&&React.createElement(TeamLogo,{team:hs.team,size:14})}
                          <span style={{fontWeight:800,fontSize:11,color:hs.isChamp?T.gold:T.fg}}>{hs.year+" "+(hs.icon||"")+hs.abbr}</span>
                          {hs.isChamp && <span style={{fontSize:8,color:T.gold}}>{"ðŸ’"}</span>}
                        </div>
                        <span style={{fontSize:9,fontWeight:800,color:"#818cf8",padding:"1px 5px",borderRadius:4,
                          background:"rgba(129,140,248,0.1)"}}>{hs.dom+" DOM"}</span>
                      </div>
                      <div style={{fontSize:9,color:T.dim,marginTop:2,paddingLeft:24}}>
                        {hs.wins+"-"+hs.losses+" ("+winPct+"%W)"}
                        {hs.topPlayer?" | â­ "+hs.topPlayer.name+" ("+hs.topPlayer.label+")":""}
                        {hs.sigWin?" | ðŸŽ¬ "+hs.sigWin.hAbbr+" "+hs.sigWin.hScore+"-"+hs.sigWin.aScore+" "+hs.sigWin.aAbbr:""}
                      </div>
                      
                      {hs.plaque && <div style={{fontSize:8,color:T.faint,fontStyle:"italic",marginTop:1,paddingLeft:24}}>
                        {"ðŸ“œ "+hs.plaque}
                      </div>}
                      
                      {hs.idTags&&hs.idTags.length>0 && <div style={{display:"flex",gap:3,paddingLeft:24,marginTop:2,flexWrap:"wrap"}}>
                        {hs.idTags.map(function(tag,ti){
                          return <span key={ti} style={{fontSize:7,padding:"1px 4px",borderRadius:3,fontWeight:700,
                            color:tag.color,background:"rgba(255,255,255,0.04)"}}>{tag.label}</span>;
                        })}
                      </div>}
                    </div>;
                  })}
                </div>;
              })()}
              
              {history.length>=1 && (function(){
                var leaders=CACHED_LEADERS||buildAllTimeLeaders(history);// v55: prefer cache
                if(!leaders)return null;
                var LEADER_CATS=[
                  {key:"passYds",label:"Passing Yards",emoji:"ðŸˆ",stat:"passYds",suffix:" yds"},
                  {key:"passTD",label:"Passing TDs",emoji:"ðŸŽ¯",stat:"passTD",suffix:" TD"},
                  {key:"rushYds",label:"Rushing Yards",emoji:"ðŸƒ",stat:"rushYds",suffix:" yds"},
                  {key:"rushTD",label:"Rushing TDs",emoji:"ðŸ’¨",stat:"rushTD",suffix:" TD"},
                  {key:"recYds",label:"Receiving Yards",emoji:"ðŸ–ï¸",stat:"recYds",suffix:" yds"},
                  {key:"sacks",label:"Sacks",emoji:"ðŸ’¥",stat:"sacks",suffix:" sacks"},
                  {key:"ints",label:"Interceptions",emoji:"ðŸ¤š",stat:"ints",suffix:" INT"}
                ];
                return <div style={assign({},cS,{borderColor:"#f59e0b"})}>
                  <div style={{fontSize:10,color:"#f59e0b",fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ“Š ALL-TIME STATS LEADERS"}</div>
                  {LEADER_CATS.map(function(cat){
                    var list=leaders[cat.key];
                    if(!list||list.length===0)return null;
                    return <div key={cat.key} style={{marginBottom:8}}>
                      <div style={{fontSize:9,fontWeight:700,color:T.dim,marginBottom:3}}>{cat.emoji+" "+cat.label}</div>
                      {list.slice(0,5).map(function(p,pi){
                        return <div key={pi} style={{display:"flex",gap:6,alignItems:"center",padding:"2px 0",fontSize:10}}>
                          <span style={{width:14,fontWeight:800,color:pi===0?T.gold:pi<3?"#f59e0b":T.faint,textAlign:"right"}}>{pi+1}</span>
                          <span style={{fontWeight:600,flex:1,cursor:"pointer",textDecoration:"underline",textDecorationColor:T.border}}
                            onClick={function(){var cp=getCachedCareerPage(p.name,history,teams);if(cp)setCareerPage(cp);}}
                            title={"Click for "+p.name+"'s career page"}>{p.name+" ("+p.pos+")"}</span>
                          <span style={{fontSize:8,color:T.faint}}>{p.seasons+" yr"+(Object.keys(p.teams).length>1?" | "+Object.keys(p.teams).join(","):"")}</span>
                          <span style={{fontWeight:800,color:pi===0?T.gold:T.text}}>{(p[cat.stat]||0).toLocaleString()+cat.suffix}</span>
                        </div>;
                      })}
                    </div>;
                  })}
                </div>;
              })()}
              
              {history.length>=1 && (function(){
                var recs=buildFranchiseRecords(history,myId);
                if(!recs)return null;
                return <div style={assign({},cS,{borderColor:"#a78bfa"})}>
                  <div style={{fontSize:10,color:"#a78bfa",fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ† FRANCHISE RECORDS"}</div>
                  
                  <div style={{fontSize:9,fontWeight:700,color:T.faint,marginBottom:3}}>{"ðŸ“… Single-Season Bests"}</div>
                  <div style={{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8}}>
                    {[["Most Wins","wins"],["Fewest Losses","losses"],["Most Points","pointsFor"],["Fewest Points Allowed","pointsAgainst"]].map(function(rec){
                      var d=recs.singleSeason[rec[1]];
                      if(!d)return null;
                      return <div key={rec[1]} style={{flex:"1 1 45%",padding:4,borderRadius:4,background:"rgba(167,139,250,0.05)"}}>
                        <div style={{fontSize:8,color:T.faint}}>{rec[0]}</div>
                        <div style={{fontSize:12,fontWeight:800,color:"#a78bfa"}}>{d.val}</div>
                        <div style={{fontSize:7,color:T.dim}}>{d.year+" season"}</div>
                      </div>;
                    })}
                  </div>
                  
                  {[["ðŸˆ Career Passing","careerPassYds","passYds"," yds"],
                    ["ðŸƒ Career Rushing","careerRushYds","rushYds"," yds"],
                    ["ðŸ’¥ Career Sacks","careerSacks","sacks"," sck"]].map(function(cat){
                    var list=recs[cat[1]];
                    if(!list||list.length===0)return null;
                    return <div key={cat[1]} style={{marginBottom:6}}>
                      <div style={{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}}>{cat[0]}</div>
                      {list.slice(0,3).map(function(p,pi){
                        return <div key={pi} style={{display:"flex",gap:6,fontSize:9,padding:"1px 0"}}>
                          <span style={{width:12,fontWeight:800,color:pi===0?"#a78bfa":T.faint}}>{pi+1}</span>
                          <span style={{fontWeight:600,flex:1}}>{p.name+" ("+p.pos+")"}</span>
                          <span style={{fontWeight:800,color:pi===0?"#a78bfa":T.text}}>{(p[cat[2]]||0).toLocaleString()+cat[3]}</span>
                        </div>;
                      })}
                    </div>;
                  })}
                </div>;
              })()}
              
              {history.length>=2 && (function(){
                var timeline=buildFranchiseTimeline(history,myId);
                if(timeline.length===0)return null;
                var rings=timeline.filter(function(e){return e.isChamp;}).length;
                return <div style={assign({},cS,{borderColor:"rgba(129,140,248,0.3)"})}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                    <div style={{fontSize:10,color:"#818cf8",fontWeight:700,letterSpacing:1}}>{"ðŸ“œ FRANCHISE TIMELINE"}</div>
                    {rings>0 && <span style={{fontSize:9,color:T.gold,fontWeight:800}}>{"ðŸ’Ã—"+rings}</span>}
                  </div>
                  <div style={{display:"flex",gap:2,alignItems:"flex-end",height:60,padding:"0 2px"}}>
                    {timeline.map(function(evt,ei){
                      var barH=Math.max(8,evt.wpct*0.55);
                      return <div key={ei} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:1}}>
                        {evt.isChamp && <span style={{fontSize:7}}>{"ðŸ’"}</span>}
                        <div style={{width:"100%",height:barH,background:evt.color,borderRadius:2,minWidth:4,
                          border:evt.isChamp?"1px solid #fbbf24":"none",opacity:0.85}} title={evt.year+": "+evt.wins+"-"+evt.losses}></div>
                        {ei%3===0 && <span style={{fontSize:6,color:T.faint}}>{(""+evt.year).slice(-2)}</span>}
                      </div>;
                    })}
                  </div>
                  <div style={{display:"flex",gap:8,marginTop:4,flexWrap:"wrap"}}>
                    {[["ðŸ’","Ring","#fbbf24"],["â­","Elite","#818cf8"],["âœ…","Winning","#34d399"],["ðŸ“…","Normal","#6b7280"],["ðŸ”¨","Rebuild","#ef4444"]].map(function(leg){
                      return <span key={leg[1]} style={{fontSize:7,color:leg[2]}}>{leg[0]+" "+leg[1]}</span>;
                    })}
                  </div>
                </div>;
              })()}
              
              {AWARD_HISTORY_LOG.length>0 && <div style={assign({},cS,{borderColor:"#fbbf24"})}>
                <div style={{fontSize:10,color:T.gold,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ“œ AWARD HISTORY"}</div>
                <div style={{maxHeight:200,overflow:"auto"}}>
                  {AWARD_HISTORY_LOG.slice().reverse().map(function(ah,ai2){
                    return <div key={ai2} style={{padding:"3px 0",borderBottom:"1px solid "+T.border,fontSize:9}}>
                      <span style={{fontWeight:800,color:T.gold,marginRight:6}}>{ah.year}</span>
                      {ah.mvp && <span style={{marginRight:8}}>{"ðŸ† MVP: "+ah.mvp.name+" ("+ah.mvp.pos+", "+ah.mvp.team+")"}</span>}
                      {ah.dpoy && <span style={{marginRight:8}}>{"ðŸ›¡ï¸ "+ah.dpoy.name}</span>}
                      {ah.roy && <span style={{marginRight:8}}>{"ðŸŒ± "+ah.roy.name}</span>}
                      {ah.coty && <span>{"ðŸŽ“ "+ah.coty.name}</span>}
                    </div>;
                  })}
                </div>
                
                {(function(){
                  var multiMVP=getMultiTimeWinners("mvp");
                  if(multiMVP.length===0)return null;
                  return <div style={{marginTop:6,borderTop:"1px solid "+T.border,paddingTop:4}}>
                    <div style={{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}}>{"ðŸ† MULTI-TIME MVPs"}</div>
                    {multiMVP.map(function(mw,mi){
                      return <div key={mi} style={{fontSize:9}}>
                        <span style={{fontWeight:700,color:T.gold}}>{mw.name}</span>
                        <span style={{color:T.dim}}>{" â€” "+mw.count+"Ã— MVP ("+mw.years.join(", ")+")"}</span>
                      </div>;
                    })}
                  </div>;
                })()}
              </div>}
              
              {Object.keys(COACH_LEGACY_LOG).length>0 && (function(){
                var topCoaches=getCoachLegacyTop(8);
                if(topCoaches.length===0)return null;
                return <div style={assign({},cS,{borderColor:"rgba(96,165,250,0.3)"})}>
                  <div style={{fontSize:10,color:T.cyan,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ‘¨â€ðŸ« COACHING LEGENDS"}</div>
                  {topCoaches.map(function(cl2,ci){
                    return <div key={ci} style={{display:"flex",gap:6,alignItems:"center",padding:"3px 0",
                      borderBottom:ci<topCoaches.length-1?"1px solid "+T.border:"none",fontSize:10}}>
                      <span style={{width:14,fontWeight:800,color:ci<3?T.gold:T.faint}}>{ci+1}</span>
                      <span style={{fontWeight:700,flex:1}}>{cl2.name}</span>
                      <span style={{fontSize:8,color:T.faint}}>{Object.keys(cl2.teams).join(", ")}</span>
                      <span style={{fontWeight:700}}>{cl2.totalWins+"-"+cl2.totalLosses}</span>
                      {cl2.rings>0 && <span style={{color:T.gold,fontWeight:800}}>{"ðŸ’Ã—"+cl2.rings}</span>}
                      <span style={{fontSize:8,color:T.dim}}>{cl2.seasons+" yr"}</span>
                    </div>;
                  })}
                </div>;
              })()}
              
              {(function(){
                var ring=getRingOfHonor(myId);
                if(ring.length===0)return null;
                return <div style={assign({},cS,{borderColor:"rgba(251,191,36,0.3)",background:"rgba(251,191,36,0.02)"})}>
                  <div style={{fontSize:10,color:T.gold,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ… RING OF HONOR"}</div>
                  <div style={{maxHeight:180,overflow:"auto"}}>
                    {ring.map(function(h,hi){
                      return <div key={hi} style={{display:"flex",gap:8,alignItems:"center",padding:"4px 0",
                        borderBottom:hi<ring.length-1?"1px solid "+T.border:"none"}}>
                        <span style={{width:28,height:28,borderRadius:"50%",background:"rgba(251,191,36,0.15)",
                          display:"flex",alignItems:"center",justifyContent:"center",fontWeight:900,fontSize:11,color:T.gold}}>
                          {h.number||"?"}</span>
                        <div style={{flex:1}}>
                          <div style={{fontWeight:700,fontSize:11}}>{h.name}</div>
                          <div style={{fontSize:8,color:T.dim}}>{h.pos+" | Inducted "+h.year+" | Peak "+h.ovr+" OVR"}</div>
                        </div>
                        <span style={{fontSize:8,color:T.faint,fontStyle:"italic"}}>{h.reason}</span>
                      </div>;
                    })}
                  </div>
                </div>;
              })()}
              
              {HALL_OF_FAME_LOG.length>0 && <div style={assign({},cS,{borderColor:"rgba(212,167,75,0.4)",background:"rgba(212,167,75,0.03)"})}>
                <div style={{fontSize:10,color:T.gold,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ›ï¸ HALL OF FAME â€” "+HALL_OF_FAME_LOG.length+" Inducted"}</div>
                <div style={{maxHeight:220,overflow:"auto"}}>
                  {HALL_OF_FAME_LOG.slice().sort(function(a,b){return b.score-a.score;}).map(function(h,hi){
                    return <div key={hi} style={{padding:"6px 0",borderBottom:hi<HALL_OF_FAME_LOG.length-1?"1px solid "+T.border:"none"}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                        <div style={{flex:1}}>
                          <span style={{fontWeight:800,fontSize:12,color:T.gold}}>{h.name}</span>
                          <span style={{fontSize:9,color:T.faint,marginLeft:6}}>{h.pos+" | "+h.teams.join(", ")}</span>
                        </div>
                        <div style={{textAlign:"right"}}>
                          <span style={{fontSize:11,fontWeight:900,color:T.gold}}>{"Legacy: "+h.score}</span>
                          <span style={{fontSize:8,color:T.faint,marginLeft:4}}>{"Class of "+h.inducted}</span>
                        </div>
                      </div>
                      <div style={{display:"flex",gap:6,marginTop:3,flexWrap:"wrap"}}>
                        {h.rings>0 && <span style={{fontSize:8,padding:"1px 5px",borderRadius:3,background:"rgba(212,167,75,0.15)",color:T.gold,fontWeight:700}}>{"ðŸ’Ã—"+h.rings}</span>}
                        {h.mvps>0 && <span style={{fontSize:8,padding:"1px 5px",borderRadius:3,background:"rgba(168,85,247,0.15)",color:T.purple,fontWeight:700}}>{"ðŸ† MVPÃ—"+h.mvps}</span>}
                        <span style={{fontSize:8,color:T.dim}}>{"Peak "+h.peakOvr+" OVR | "+h.seasons+" seasons"+(h.totalYds>0?" | "+Math.round(h.totalYds/1000)+"K yds":"")}</span>
                      </div>
                      {h.highlights&&h.highlights.length>0 && <div style={{fontSize:7,color:T.faint,marginTop:2}}>{h.highlights.slice(0,4).join(" â€¢ ")}</div>}
                    </div>;
                  })}
                </div>
              </div>}
              
              {dnaReport && <div style={assign({},cS,{borderColor:"rgba(52,211,153,0.3)"})}>
                <div style={{fontSize:10,color:T.green,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ§¬ DNA IMPACT REPORT â€” "+dnaReport.year}</div>
                {dnaReport.insights.map(function(ins,ii){
                  return <div key={ii} style={{padding:"3px 0",borderBottom:ii<dnaReport.insights.length-1?"1px solid "+T.border:"none"}}>
                    <div style={{fontSize:10,fontWeight:700}}>{ins.emoji+" "+ins.label}</div>
                    <div style={{fontSize:9,color:T.dim}}>{ins.text}</div>
                  </div>;
                })}
              </div>}
              
              <div style={assign({},cS)}>
                <div style={{fontSize:10,color:T.cyan,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ“… SEASON-BY-SEASON"+(almDrill?" â€” "+almDrill.year+" Details":"")}</div>
                {almDrill ? <div>
                  <button onClick={function(){setAlmDrill(null);}} style={mS(S.btn,S.btnGhost,{fontSize:9,marginBottom:6})}>{"â† Back to all seasons"}</button>
                  <div style={{fontSize:13,fontWeight:800,color:almDrill.winnerId===myId?T.gold:T.fg,marginBottom:4}}>{almDrill.year+" Season"}</div>
                  <div style={{fontSize:11,marginBottom:4}}>{"ðŸ† Champion: "+(almDrill.champ?almDrill.champ.abbr+" ("+almDrill.champ.w+"-"+almDrill.champ.l+")":"?")}</div>
                  {almDrill.mvp && <div style={{fontSize:10,color:T.dim}}>{"ðŸŒŸ MVP: "+almDrill.mvp.name+" ("+almDrill.mvp.pos+", "+almDrill.mvp.tm+")"}</div>}
                  {almDrill.dpoy && <div style={{fontSize:10,color:T.dim}}>{"ðŸ›¡ï¸ DPOY: "+almDrill.dpoy.name+" ("+almDrill.dpoy.pos+", "+almDrill.dpoy.tm+")"}</div>}
                  {almDrill.roy && <div style={{fontSize:10,color:T.dim}}>{"ðŸŒ± ROY: "+almDrill.roy.name+" ("+almDrill.roy.pos+", "+almDrill.roy.tm+")"}</div>}
                  {almDrill.coty && <div style={{fontSize:10,color:T.dim}}>{"ðŸŽ“ COTY: "+almDrill.coty.name+" ("+almDrill.coty.tm+", "+almDrill.coty.w+"-"+almDrill.coty.l+")"}</div>}
                  
                  {almDrill.standings && <div style={{marginTop:8}}>
                    <div style={{fontSize:9,color:T.faint,fontWeight:700,marginBottom:4}}>{"FINAL STANDINGS"}</div>
                    {almDrill.standings.slice(0,10).map(function(st,si){
                      return <div key={si} style={{display:"flex",gap:6,fontSize:10,padding:"2px 0"}}>
                        <span style={{width:16,color:si<4?T.green:T.dim,fontWeight:700}}>{si+1}</span>
                        <span>{st.i}</span>
                        <span style={{fontWeight:700}}>{st.a}</span>
                        <span style={{color:T.faint}}>{st.w+"-"+st.l}</span>
                      </div>;
                    })}
                  </div>}
                  
                  {almDrill.allPro1st && <div style={{marginTop:8}}>
                    <div style={{fontSize:9,color:T.gold,fontWeight:700,marginBottom:4}}>{"ALL-PRO 1ST TEAM"}</div>
                    {Object.keys(almDrill.allPro1st).map(function(pos){
                      return almDrill.allPro1st[pos].map(function(ap,api){
                        return <div key={pos+api} style={{fontSize:10,display:"flex",gap:6,padding:"1px 0"}}>
                          <span style={{width:22,color:T.faint}}>{pos}</span>
                          <span style={{fontWeight:700}}>{ap.name}</span>
                          <span style={{color:T.faint}}>{(ap.tIcon||"")+ap.tm}</span>
                          <span style={{color:T.cyan}}>{ap.ovr+" OVR"}</span>
                        </div>;
                      });
                    })}
                  </div>}
                  
                  {almDrill.topGames && almDrill.topGames.length>0 && <div style={{marginTop:8}}>
                    <div style={{fontSize:9,color:T.orange,fontWeight:700,marginBottom:4}}>{"ðŸŽ¬ TOP 5 GAMES OF THE SEASON"}</div>
                    {almDrill.topGames.slice(0,5).map(function(tg,tgi){
                      return <div key={tgi} style={{display:"flex",gap:6,fontSize:10,padding:"3px 0",borderBottom:"1px solid "+T.border}}>
                        <span style={{width:14,color:tgi===0?T.gold:T.dim,fontWeight:800}}>{tgi+1}</span>
                        <span style={{fontWeight:700}}>{(tg.hIcon||"")+tg.hAbbr+" "+tg.hScore+" - "+tg.aScore+" "+(tg.aIcon||"")+tg.aAbbr}</span>
                        <span style={{color:T.faint,fontSize:9}}>{"Wk"+tg.week+(tg.playoff?" ðŸ†":"")}</span>
                        {tg.margin<=3 && <span style={{fontSize:7,color:T.red,fontWeight:700}}>{"THRILLER"}</span>}
                      </div>;
                    })}
                  </div>}
                  
                  {almDrill.biggestUpset && <div style={{marginTop:8}}>
                    <div style={{fontSize:9,color:T.red,fontWeight:700,marginBottom:4}}>{"ðŸ˜± BIGGEST UPSET"}</div>
                    <div style={{fontSize:11}}>
                      <span style={{fontWeight:800}}>{(almDrill.biggestUpset.wIcon||"")+almDrill.biggestUpset.winner}</span>
                      {" over "}
                      <span style={{fontWeight:800}}>{(almDrill.biggestUpset.lIcon||"")+almDrill.biggestUpset.loser}</span>
                      <span style={{color:T.faint}}>{" ("+almDrill.biggestUpset.score+", Wk"+almDrill.biggestUpset.week+")"}</span>
                    </div>
                    <div style={{fontSize:9,color:T.dim}}>{"Power rank gap: "+(almDrill.biggestUpset.rankGap||"?")+", "+
                      (almDrill.biggestUpset.winnerRecord||"")+" over "+(almDrill.biggestUpset.loserRecord||"")}</div>
                  </div>}
                  
                  {almDrill.mvpLadder && almDrill.mvpLadder.length>0 && <div style={{marginTop:8}}>
                    <div style={{fontSize:9,color:T.purple,fontWeight:700,marginBottom:4}}>{"ðŸ… MVP LADDER"}</div>
                    {almDrill.mvpLadder.slice(0,5).map(function(ml,mli){
                      return <div key={mli} style={{display:"flex",gap:6,fontSize:10,padding:"2px 0"}}>
                        <span style={{width:14,color:mli===0?T.gold:T.dim,fontWeight:800}}>{mli+1}</span>
                        <span style={{fontWeight:700}}>{ml.name}</span>
                        <span style={{color:T.faint}}>{ml.pos+" "+(ml.tIcon||"")+ml.tm}</span>
                        <span style={{color:T.cyan,fontWeight:700}}>{ml.score+" pts"}</span>
                      </div>;
                    })}
                  </div>}
                </div> :
                (history.length===0?<div style={{color:T.faint,fontSize:11}}>{"Complete your first season to build history."}</div>:
                history.slice().reverse().map(function(h,hi){
                  var isMyChamp=h.winnerId===myId;
                  return <div key={hi} style={{padding:"6px 0",borderBottom:"1px solid "+T.border,background:isMyChamp?"rgba(212,167,75,0.08)":"transparent",cursor:"pointer"}}
                    onClick={function(){setAlmDrill(h);}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <div style={{fontWeight:800,fontSize:13,color:isMyChamp?T.gold:T.fg}}>{h.year+" Season"}</div>
                      <div style={{display:"flex",gap:4,alignItems:"center"}}>
                        <div style={{fontSize:11,fontWeight:700}}>{isMyChamp?"ðŸ’":""}{"ðŸ† "+(h.champ?h.champ.abbr:"?")+" ("+(h.champ?h.champ.w+"-"+h.champ.l:"?")+")"}</div>
                        <span style={{fontSize:9,color:T.faint}}>{"â–¸"}</span>
                      </div>
                    </div>
                    <div style={{fontSize:10,color:T.dim,marginTop:2}}>
                      {(h.mvp?"ðŸŒŸ MVP: "+h.mvp.name+" ("+h.mvp.pos+", "+h.mvp.tm+")":"")
                       +(h.dpoy?" | ðŸ›¡ï¸ DPOY: "+h.dpoy.name+" ("+h.dpoy.pos+", "+h.dpoy.tm+")":"")
                       +(h.oroy?" | ðŸŒ± OROY: "+h.oroy.name:"")
                       +(h.droy?" | ðŸŒ± DROY: "+h.droy.name:"")}
                    </div>
                  </div>;
                }))}
              </div>
              
              {hallOfFame&&hallOfFame.length>0 && <div style={assign({},cS)}>
                <div style={{fontSize:10,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:6}}>{"ðŸ›ï¸ HALL OF FAME INDUCTEES"}</div>
                {hallOfFame.slice().reverse().slice(0,15).map(function(h2,hi2){
                  var cs2=h2.careerStats||{};
                  return <div key={hi2} style={{display:"flex",gap:8,padding:"4px 0",borderBottom:"1px solid "+T.border,alignItems:"center"}}>
                    <div style={{fontSize:10,color:T.gold,fontWeight:700,width:35}}>{h2.yearInducted}</div>
                    <div style={{flex:1}}>
                      <div style={{fontWeight:700,fontSize:11}}>{h2.name}</div>
                      <div style={{fontSize:9,color:T.dim}}>{h2.pos+" | "+(h2.teamIcon||"")+h2.team+" | Peak "+(h2.peakOvr||"?")+" OVR | "+(cs2.seasons||0)+" seasons"}</div>
                    </div>
                  </div>;
                })}
              </div>}
            </div>;
          })()}
          
          {tab==="rivalries" && (function(){
            var myRivals=(my.rivals||[]).filter(function(r){return r.heat>=10;}).sort(function(a,b){return(b.heat||0)-(a.heat||0);});
            var seasonRivs=getTopRivalries(season.rivalries||{},myId,6);
            return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10}},
              React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
                React.createElement("div",{style:{fontSize:18}},"âš”ï¸"),
                React.createElement("div",null,
                  React.createElement("div",{style:{fontWeight:900,fontSize:13,letterSpacing:0.5}},"RIVALRY TRACKER"),
                  React.createElement("div",{style:{fontSize:9,color:T.dim}},"GM Beef â€¢ Head-to-Head â€¢ Media Noise")
                )
              ),
              seasonRivs.length>0?React.createElement("div",{style:{background:"rgba(239,68,68,0.06)",border:"1px solid rgba(239,68,68,0.2)",borderRadius:10,padding:10}},
                React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.red,letterSpacing:1,marginBottom:8}},"ðŸ“° GM BEEF REPORT"),
                React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8}},
                  seasonRivs.slice(0,3).map(function(r){
                    var oppId=r.a===myId?r.b:r.a;var opp=teams.find(function(t2){return t2.id===oppId;});if(!opp)return null;
                    var beefLevel=RIVAL_SAGA.getBeefLevel(r.heat);var beefTier=RIVAL_SAGA.getBeefTier(beefLevel);
                    var trashLine=beefLevel>=15?RIVAL_SAGA.generateTrashTalk(opp,my,beefLevel):null;
                    var gmB=RIVAL_SAGA.grudgeMatchBonus(r.heat);
                    var serA=r.a===myId?(r.seriesA||0):(r.seriesB||0);var serB=r.a===myId?(r.seriesB||0):(r.seriesA||0);
                    return React.createElement("div",{key:r.a+"_"+r.b,style:{padding:10,background:"rgba(255,255,255,0.02)",borderRadius:8,border:"1px solid rgba(239,68,68,0.15)"}},
                      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
                        React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center"}},
                          React.createElement(TeamLogo,{team:opp,size:28}),
                          React.createElement("div",null,
                            React.createElement("div",{style:{fontWeight:800,fontSize:12}},opp.city+" "+opp.name),
                            React.createElement("div",{style:{fontSize:9,color:T.dim}},"Series: "+serA+"-"+serB+(r.heat>=9?" | "+(r.meetings||[]).length+" meetings":""))
                          )
                        ),
                        React.createElement("div",{style:{textAlign:"right"}},
                          React.createElement("div",{style:{fontSize:20}},beefTier.emoji),
                          React.createElement("div",{style:{fontSize:9,fontWeight:800,color:beefTier.color}},beefTier.tier),
                          React.createElement("div",{style:{fontSize:9,color:T.faint}},"Beef: "+beefLevel+"%")
                        )
                      ),
                      React.createElement("div",{style:{height:3,background:T.bg3,borderRadius:2,marginBottom:6}},
                        React.createElement("div",{style:{height:3,width:beefLevel+"%",background:beefTier.color,borderRadius:2}})
                      ),
                      trashLine&&React.createElement("div",{style:{fontSize:9,fontStyle:"italic",color:T.faint,borderLeft:"2px solid rgba(239,68,68,0.3)",paddingLeft:6,marginBottom:4}},trashLine),
                      gmB&&React.createElement("div",{style:{fontSize:8,color:T.orange,fontWeight:700}},"âš”ï¸ GRUDGE MATCH BONUS: +"+gmB.moraleBoost+" team morale")
                    );
                  })
                )
              ):null,
              seasonRivs.some(function(r){return r.heat>=9;})&&React.createElement("div",{style:{background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.2)",borderRadius:8,padding:10}},
                React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,letterSpacing:1,marginBottom:6}},"ðŸŽ™ï¸ PRESS RESPONSE"),
                React.createElement("div",{style:{fontSize:9,color:T.dim,marginBottom:6}},"How do you handle the media noise from your rivals?"),
                React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:4}},
                  Object.keys(PRESS_RESPONSES_RIVAL).map(function(key){
                    var opt=PRESS_RESPONSES_RIVAL[key];
                    return React.createElement("button",{key:key,style:mS(S.btn,S.btnGhost,{textAlign:"left",justifyContent:"flex-start",fontSize:9,padding:"6px 10px"}),
                      onClick:function(){
                        addN("ðŸ“¢ "+opt.label+(opt.moraleMod>0?" | Team morale +"+opt.moraleMod:opt.moraleMod<0?" | Team morale "+opt.moraleMod:""),opt.beefMod>0?"orange":opt.credMod>0?"green":"cyan");
                        if(opt.moraleMod!==0){var nt2=teams.slice();var u2=nt2.find(function(t2){return t2.id===myId;});if(u2)u2.roster.forEach(function(p){p.morale=Math.max(30,Math.min(99,(p.morale||70)+opt.moraleMod));});setTeams(nt2);}
                      }},opt.label+" (Cred "+(opt.credMod>0?"+":"")+opt.credMod+(opt.beefMod>0?" | Beef +"+opt.beefMod:opt.beefMod<0?" | Beef "+opt.beefMod:"")+")"
                    );
                  })
                )
              ),
              myRivals.length===0&&seasonRivs.length===0?React.createElement("div",{style:{color:T.faint,padding:20,textAlign:"center"}},"No rivalries yet. Heat builds from close games, playoff meetings, and blowout losses!"):
              myRivals.map(function(r){
                var opp=teams.find(function(t2){return t2.id===r.teamId;});if(!opp)return null;
                var tier=getRivalryLabel(r.heat);
                var hColor=r.heat>=80?T.red:r.heat>=60?"#f97316":r.heat>=40?T.orange:r.heat>=20?"#facc15":T.dim;
                return React.createElement("div",{key:r.teamId,style:assign({},cS,{padding:12,borderColor:r.heat>=60?hColor:T.border,borderLeft:"3px solid "+hColor})},
                  React.createElement("div",{style:{display:"flex",gap:10,alignItems:"center"}},
                    React.createElement(TeamLogo,{team:opp,size:32}),
                    React.createElement("div",{style:{flex:1}},
                      React.createElement("div",{style:{fontWeight:700,fontSize:13}},opp.city+" "+opp.name),
                      r.name&&React.createElement("div",{style:{fontSize:10,color:hColor,fontWeight:700,fontStyle:"italic"}},r.name),
                      React.createElement("div",{style:{fontSize:10,color:T.dim}},"H2H: "+r.history.wins+"-"+r.history.losses+(r.history.playoffMeetings?" â€¢ "+r.history.playoffMeetings+" playoff meetings":"")),
                      React.createElement("div",{style:{fontSize:9,color:T.faint}},"Origin: "+r.origin+(r.history.streak>0?" â€¢ W"+r.history.streak:r.history.streak<0?" â€¢ L"+Math.abs(r.history.streak):""))
                    ),
                    React.createElement("div",{style:{textAlign:"right"}},
                      React.createElement("div",{style:{fontSize:18,fontWeight:900,color:hColor}},r.heat),
                      React.createElement("div",{style:{fontSize:8,color:T.faint}},"HEAT"),
                      tier.label&&React.createElement("div",{style:{fontSize:8,color:hColor,fontWeight:700,marginTop:2}},tier.emoji+" "+tier.label)
                    )
                  ),
                  React.createElement("div",{style:{height:4,background:T.bg3,borderRadius:2,marginTop:6}},
                    React.createElement("div",{style:{height:4,borderRadius:2,background:hColor,width:r.heat+"%"}})
                  )
                );
              })
            );
          })()}
          
          {tab==="ringOfHonor" && (function(){
            var activeLegends=my.roster.filter(function(p){
              var cs2=p.careerStats||{};return(cs2.seasons||0)>=5||(cs2.mvps||0)>0||(cs2.allPros||0)>0||(cs2.rings||0)>0||p.ovr>=85;
            });
            var retiredLegends=(hallOfFame||[]).filter(function(h){return h.team===my.abbr;});
            var allLegends=retiredLegends.concat(activeLegends).sort(function(a,b){
              var aS=(a.careerStats||{}).rings||0;var bS2=(b.careerStats||{}).rings||0;
              var aM=(a.careerStats||{}).mvps||0;var bM=(b.careerStats||{}).mvps||0;
              return(bS2*100+bM*50+(b.ovr||b.peakOvr||70))-(aS*100+aM*50+(a.ovr||a.peakOvr||70));
            });
            var teamColor=my.color||T.gold;
            var JerseyBanner=function(props){
              var p2=props.player;var cs2=p2.careerStats||{};var num=((p2.id||"").charCodeAt(0)%90)+10;
              var isRetired=!!p2.yearInducted;
              return React.createElement("div",{style:{display:"inline-flex",flexDirection:"column",alignItems:"center",margin:"6px 4px",cursor:"pointer"},
                onClick:function(){setPlayerDetail(p2);}},
                React.createElement("svg",{width:60,height:80,viewBox:"0 0 60 80"},
                  React.createElement("path",{d:"M0,0 L60,0 L60,60 L30,80 L0,60 Z",fill:teamColor,stroke:isRetired?"#d4a74b":"#fff",strokeWidth:isRetired?3:2}),
                  React.createElement("text",{x:30,y:20,fontSize:7,fill:"#fff",textAnchor:"middle",fontWeight:"bold"},p2.name.split(" ").pop()),
                  React.createElement("text",{x:30,y:48,fontSize:22,fill:"#fff",textAnchor:"middle",fontWeight:"bold"},num),
                  React.createElement("text",{x:30,y:63,fontSize:7,fill:"rgba(255,255,255,0.7)",textAnchor:"middle"},p2.pos)
                ),
                React.createElement("div",{style:{fontSize:8,color:isRetired?T.gold:T.dim,textAlign:"center",maxWidth:60,overflow:"hidden",whiteSpace:"nowrap",marginTop:2}},
                  (cs2.rings?"ðŸ’":"")+(cs2.mvps?"ðŸ†":"")+(isRetired?" HOF":"")
                )
              );
            };
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:700}}>{"ðŸ… Ring of Honor â€” The Rafters"}</div>
              <div style={{fontSize:11,color:T.dim,marginBottom:4}}>{"Franchise legends immortalized in the rafters. Tap a banner for details."}</div>
              
              {allLegends.length===0?<div style={{color:T.faint,padding:20,textAlign:"center"}}>{"No legends yet. Build your dynasty!"}</div>:
              <div style={{background:T.bg3,borderRadius:8,padding:12,display:"flex",flexWrap:"wrap",justifyContent:"center",border:"1px solid "+T.border}}>
                {allLegends.slice(0,20).map(function(p){
                  return React.createElement(JerseyBanner,{key:p.id,player:p});
                })}
              </div>}
              
              {allLegends.length>0 && <div style={{fontSize:10,color:T.gold,fontWeight:700,marginTop:8,letterSpacing:1}}>{"LEGEND ROSTER"}</div>}
              {allLegends.slice(0,20).map(function(p){
                var cs2=p.careerStats||{};var isRetired=!!p.yearInducted;
                return <div key={p.id+"_list"} style={assign({},cS,{padding:8,display:"flex",gap:10,alignItems:"center",borderColor:isRetired?T.gold:T.border})}>
                  {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:32,age:p.age})}
                  <div style={{flex:1}}>
                    <div style={{fontWeight:800,fontSize:12,cursor:"pointer",textDecoration:"underline",textDecorationColor:T.border}} onClick={function(){setPlayerDetail(p);}}>{p.name}{isRetired?" (HOF "+p.yearInducted+")":""}</div>
                    <div style={{fontSize:10,color:T.dim}}>
                      {p.pos+" | "+(p.ovr||p.peakOvr)+" OVR | "+(cs2.seasons||0)+"yr"+(cs2.rings?" | ðŸ’Ã—"+cs2.rings:"")+((cs2.mvps||0)>0?" | ðŸ†Ã—"+cs2.mvps:"")+((cs2.allPros||0)>0?" | â­Ã—"+cs2.allPros:"")}
                    </div>
                  </div>
                  {isRetired&&<button onClick={function(){
                    SHARE_CARD.generate({
                      icon:"ðŸ›ï¸",teamIcon:my.icon||"ðŸˆ",teamName:p.name+" â€” Hall of Fame",
                      teamColor:my.color||"#0f172a",
                      headline:"HALL OF FAME INDUCTEE",
                      season:p.yearInducted||p.inducted||"",record:(cs2.seasons||0)+" seasons",
                      stats:[
                        {label:"OVR",val:p.ovr||p.peakOvr||"--"},
                        {label:"SEASONS",val:cs2.seasons||0},
                        {label:"RINGS",val:(cs2.rings||0)+"xðŸ’"},
                        {label:"MVP",val:(cs2.mvps||0)>0?(cs2.mvps+"xðŸ†"):"â€”"}
                      ]
                    },"hof-"+p.name.replace(/\s+/g,"-").toLowerCase());
                  }} style={{background:"rgba(251,191,36,0.12)",border:"1px solid rgba(251,191,36,0.4)",borderRadius:8,padding:"3px 8px",fontSize:9,color:"#fbbf24",fontWeight:700,cursor:"pointer",whiteSpace:"nowrap"}}>{"ðŸ“¸ Share"}</button>}
                </div>;
              })}
            </div>;
          })()}
          
          {tab==="timeline" && (function(){
            if(!history.length)return React.createElement("div",{style:{color:T.faint,padding:40,textAlign:"center"}},"Your dynasty story begins after your first season.");
            var sum=buildDynastySummary(history,myId);
            var dynScore=sum.titles*30+sum.playoffAppearances*10+(history.filter(function(h){
              var rec=h.teamRecords?h.teamRecords.find(function(tr){return tr.id===myId;}):null;
              return rec&&rec.wins>rec.losses;
            }).length)*5;
            var tier=dynScore>=150?"LEGENDARY":dynScore>=100?"ELITE":dynScore>=60?"ESTABLISHED":dynScore>=30?"RISING":"BUILDING";
            var tierColor=dynScore>=150?T.gold:dynScore>=100?T.green:dynScore>=60?T.cyan:dynScore>=30?T.orange:T.dim;
            var milestones=[];
            var firstPlayoff=null;var firstTitle=null;var win100=false;
            var runW=0;
            history.forEach(function(h,hi){
              var rec=h.teamRecords?h.teamRecords.find(function(tr){return tr.id===myId;}):null;
              if(rec){
                runW+=rec.wins;
                if(rec.playoffs&&!firstPlayoff)firstPlayoff=h.year;
                if(h.winnerId===myId&&!firstTitle)firstTitle=h.year;
                if(runW>=100&&!win100){win100=true;milestones.push({year:h.year,icon:"\ud83c\udfc6",text:"100th Career Win",color:T.gold});}
              }
            });
            if(firstPlayoff)milestones.unshift({year:firstPlayoff,icon:"\u2b50",text:"First Playoff Berth",color:T.green});
            if(firstTitle)milestones.push({year:firstTitle,icon:"\ud83d\udc8d",text:"First Championship",color:T.gold});
            return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8}},
              React.createElement("div",{style:{background:"linear-gradient(135deg,rgba(251,191,36,0.1),rgba(15,23,42,0.95))",borderRadius:14,padding:"18px 20px",border:"1px solid "+tierColor+"44",textAlign:"center"}},
                React.createElement("div",{style:{fontSize:8,fontWeight:800,letterSpacing:3,color:tierColor}},"DYNASTY STATUS"),
                React.createElement("div",{style:{fontSize:36,fontWeight:900,color:tierColor,textShadow:"0 0 20px "+tierColor+"44",margin:"4px 0"}},dynScore),
                React.createElement("div",{style:{fontSize:14,fontWeight:800,color:"#fff"}},tier+" DYNASTY"),
                React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:16,marginTop:10}},
                  React.createElement("div",null,React.createElement("div",{style:{fontSize:18,fontWeight:900,color:T.gold}},sum.titles+"\ud83c\udfc6"),React.createElement("div",{style:{fontSize:8,color:T.dim}},"Titles")),
                  React.createElement("div",null,React.createElement("div",{style:{fontSize:18,fontWeight:900,color:T.green}},sum.playoffAppearances),React.createElement("div",{style:{fontSize:8,color:T.dim}},"Playoffs")),
                  React.createElement("div",null,React.createElement("div",{style:{fontSize:18,fontWeight:900,color:T.cyan}},sum.totalW+"-"+sum.totalL),React.createElement("div",{style:{fontSize:8,color:T.dim}},"All-Time")),
                  React.createElement("div",null,React.createElement("div",{style:{fontSize:18,fontWeight:900,color:T.orange}},sum.bestSeason+"W"),React.createElement("div",{style:{fontSize:8,color:T.dim}},"Best"))
                )
              ),
              milestones.length>0?React.createElement("div",{style:assign({},cS,{padding:10})},
                React.createElement("div",{style:{fontSize:9,fontWeight:800,color:T.gold,marginBottom:6}},"\ud83c\udfaf DYNASTY MILESTONES"),
                React.createElement("div",{style:{display:"flex",gap:8,flexWrap:"wrap"}},
                  milestones.map(function(ms,mi){
                    return React.createElement("div",{key:"ms"+mi,style:{padding:"4px 10px",borderRadius:8,background:ms.color+"15",border:"1px solid "+ms.color+"33",fontSize:9}},
                      React.createElement("span",{style:{marginRight:4}},ms.icon),
                      React.createElement("span",{style:{fontWeight:700,color:ms.color}},ms.text),
                      React.createElement("span",{style:{color:T.faint,marginLeft:4}},"("+ms.year+")")
                    );
                  })
                )
              ):null,
              React.createElement("div",{style:{position:"relative",paddingLeft:36}},
                React.createElement("div",{style:{position:"absolute",left:16,top:0,bottom:0,width:2,background:T.border}}),
                history.slice().reverse().map(function(h,i){
                  var cls=classifySeason(h,myId);var isChamp33=cls.type==="championship";
                  var moments=generateKeyMoments(h,myId,history,hallOfFame);
                  var isExpanded=timelineExpanded81[h.year];
                  var rec=h.teamRecords?h.teamRecords.find(function(tr){return tr.id===myId;}):null;
                  return React.createElement("div",{key:i,style:{position:"relative",marginBottom:12}},
                    React.createElement("div",{style:{position:"absolute",left:-28,top:6,fontSize:9,fontWeight:800,color:T.dim,width:24,textAlign:"right"}},h.year),
                    React.createElement("div",{style:{position:"absolute",left:-7,top:8,width:isChamp33?12:8,height:isChamp33?12:8,borderRadius:"50%",background:isChamp33?T.gold:cls.color,border:"2px solid "+(isChamp33?"#fff":T.border),zIndex:1,boxShadow:isChamp33?"0 0 8px rgba(251,191,36,0.5)":"none"}}),
                    React.createElement("div",{style:assign({},cS,{padding:isExpanded?"14px 12px":"10px 12px",cursor:"pointer",borderColor:isChamp33?"rgba(251,191,36,0.3)":"rgba(255,255,255,0.06)",
                      background:isChamp33?"linear-gradient(90deg,rgba(251,191,36,0.08),rgba(30,41,59,0.7))":"rgba(30,41,59,0.6)",
                      transition:"all 0.2s ease"}),
                      onClick:function(){setTimelineExpanded81(function(prev){var u=assign({},prev);u[h.year]=!u[h.year];return u;});}},
                      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:isExpanded?6:0}},
                        React.createElement("span",{style:{fontWeight:800,fontSize:11,color:cls.color}},cls.icon+" "+cls.label),
                        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
                          rec?React.createElement("span",{style:{fontSize:10,color:T.dim,fontWeight:600}},rec.wins+"-"+rec.losses):null,
                          React.createElement("span",{style:{fontSize:10,color:T.faint}},isExpanded?"\u25b2":"\u25bc")
                        )
                      ),
                      isExpanded?React.createElement("div",null,
                        moments.map(function(m,mi){return React.createElement("div",{key:mi,style:{fontSize:10,color:T.dim,lineHeight:1.5}},"\u2022 "+m);}),
                        h.mvp?React.createElement("div",{style:{fontSize:9,color:T.cyan,marginTop:4}},"\ud83c\udfc6 MVP: "+h.mvp.name+" ("+h.mvp.tm+")"):null,
                        h.dpoy?React.createElement("div",{style:{fontSize:9,color:T.orange}},"\ud83d\udee1\ufe0f DPOY: "+h.dpoy.name+" ("+h.dpoy.tm+")"):null,
                        h.champ?React.createElement("div",{style:{fontSize:9,color:T.gold,marginTop:2}},"\ud83c\udfc6 Champion: "+h.champ.icon+" "+h.champ.city+" "+h.champ.name):null
                      ):null
                    )
                  );
                })
              )
            );
          })()}
          
          {/* â”€â”€ DYNASTY_LEGACY: Multi-Decade Dynasty Mode tab â”€â”€ */}
          {tab==="dynastyMode" && (function(){
            if(history.length<1)return React.createElement("div",{style:{color:T.faint,padding:40,textAlign:"center",fontSize:14}},
              "Complete your first season to begin your dynasty chronicle.");
            // Build comprehensive multi-decade stats
            var myHistory=history.map(function(h){
              var rec=h.teamRecords?h.teamRecords.find(function(tr){return tr.id===myId;}):null;
              return{year:h.year,wins:rec?rec.wins:0,losses:rec?rec.losses:0,
                playoffs:rec?!!rec.playoffs:false,champ:h.winnerId===myId||h.champId===myId,
                mvp:h.mvp,coach:h.champ&&h.champ.id===myId?h.champ.coach:"",
                champName:h.champ?h.champ.name:"",pf:rec?rec.pf||0:0,pa:rec?rec.pa||0:0};
            });
            var totalW=myHistory.reduce(function(s,h){return s+h.wins;},0);
            var totalL=myHistory.reduce(function(s,h){return s+h.losses;},0);
            var titles=myHistory.filter(function(h){return h.champ;}).length;
            var playoffYears=myHistory.filter(function(h){return h.playoffs;}).length;
            var bestSeason=myHistory.reduce(function(b,h){return h.wins>b.wins?h:b;},{wins:0});
            var worstSeason=myHistory.reduce(function(b,h){return h.wins<b.wins&&myHistory.indexOf(b)>=0?h:b;},myHistory[0]);
            var winPct=totalW+totalL>0?Math.round(totalW/(totalW+totalL)*1000)/10:0;
            // HOF players
            var hofPlayers=(my&&my.roster?my.roster.filter(function(p){return p.yearInducted;}):[]).concat(
              (HALL_OF_FAME_LOG||[]).filter(function(e){return e.teamId===myId;}).map(function(e){return{name:e.name,pos:e.pos,yearInducted:e.year};})
            );
            // Decade grouping
            var decades={};
            myHistory.forEach(function(h){
              var d=Math.floor((h.year-1)/10)*10+1;
              if(!decades[d])decades[d]={start:d,end:d+9,seasons:[],titles:0,wins:0,losses:0};
              decades[d].seasons.push(h);decades[d].wins+=h.wins;decades[d].losses+=h.losses;
              if(h.champ)decades[d].titles++;
            });
            var decadeList=Object.values(decades).sort(function(a,b){return a.start-b.start;});
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              {/* Dynasty Overview Hero */}
              <div style={{background:"linear-gradient(135deg,rgba(251,191,36,0.12),rgba(15,23,42,0.96))",borderRadius:14,padding:"18px 20px",border:"1px solid rgba(251,191,36,0.3)",textAlign:"center"}}>
                <div style={{fontSize:8,fontWeight:800,letterSpacing:3,color:T.gold,marginBottom:4}}>{"DYNASTY CHRONICLE"}</div>
                <div style={{fontSize:36,fontWeight:900,color:T.text,letterSpacing:-1,marginBottom:4}}>
                  {(my&&my.icon||"ðŸˆ")+" "+(my&&my.name||"My Team")}
                </div>
                <div style={{fontSize:13,color:T.gold,fontWeight:800,marginBottom:8}}>
                  {titles>0?titles+"x ðŸ† World Champion":"Building a Dynasty"}
                </div>
                <div style={{display:"flex",justifyContent:"center",gap:20,flexWrap:"wrap"}}>
                  {[{label:"Seasons",val:history.length},{label:"All-Time",val:totalW+"-"+totalL},
                    {label:"Win%",val:winPct+"%"},{label:"Playoffs",val:playoffYears+"x"},
                    {label:"Titles",val:titles+"x"},{label:"HOF",val:hofPlayers.length+"x"}
                  ].map(function(s){return <div key={s.label} style={{textAlign:"center"}}>
                    <div style={{fontSize:20,fontWeight:900,color:s.label==="Titles"&&titles>0?T.gold:T.text}}>{s.val}</div>
                    <div style={{fontSize:8,color:T.faint}}>{s.label}</div>
                  </div>;})}
                </div>
              </div>
              {/* Championship Banners */}
              {titles>0&&<div style={assign({},cS,{padding:10})}>
                <div style={{fontSize:9,fontWeight:800,color:T.gold,letterSpacing:1,marginBottom:6}}>{"ðŸ† CHAMPIONSHIP BANNERS"}</div>
                <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                  {myHistory.filter(function(h){return h.champ;}).map(function(h){
                    return <div key={h.year} style={{background:"linear-gradient(135deg,rgba(212,167,75,0.2),rgba(212,167,75,0.08))",border:"1px solid "+T.gold+"44",borderRadius:8,padding:"6px 10px",textAlign:"center",minWidth:70}}>
                      <div style={{fontSize:14}}>{"ðŸ†"}</div>
                      <div style={{fontSize:10,fontWeight:800,color:T.gold}}>{h.year}</div>
                      <div style={{fontSize:8,color:T.dim}}>{h.wins+"-"+h.losses}</div>
                    </div>;
                  })}
                </div>
              </div>}
              {/* Season-by-Season Record */}
              <div style={cS}>
                <div style={{fontSize:9,fontWeight:800,color:T.cyan,letterSpacing:1,marginBottom:6}}>{"ðŸ“… SEASON-BY-SEASON RECORD"}</div>
                <div style={{overflowX:"auto"}}>
                  <table style={{width:"100%",borderCollapse:"collapse",fontSize:10}}>
                    <thead><tr>{["Year","W","L","W%","Playoffs","Result"].map(function(h){return <th key={h} style={{textAlign:"left",color:T.faint,fontSize:8,fontWeight:700,padding:"3px 6px",borderBottom:"1px solid "+T.border}}>{h}</th>;})}</tr></thead>
                    <tbody>{myHistory.slice().reverse().map(function(h,i){
                      var wPct=h.wins+h.losses>0?Math.round(h.wins/(h.wins+h.losses)*100):0;
                      var result=h.champ?"ðŸ† CHAMP":h.playoffs?"Playoffs":"Miss";
                      var resultC=h.champ?T.gold:h.playoffs?T.green:T.faint;
                      return <tr key={i} style={{background:h.champ?"rgba(212,167,75,0.06)":"transparent"}}>
                        <td style={{padding:"4px 6px",fontWeight:h.champ?800:400,color:h.champ?T.gold:T.text}}>{h.year}</td>
                        <td style={{padding:"4px 6px",color:T.green,fontWeight:700}}>{h.wins}</td>
                        <td style={{padding:"4px 6px",color:T.red}}>{h.losses}</td>
                        <td style={{padding:"4px 6px",color:wPct>=50?T.text:T.faint}}>{wPct+"%"}</td>
                        <td style={{padding:"4px 6px",color:h.playoffs?T.green:T.faint}}>{h.playoffs?"âœ…":"â€”"}</td>
                        <td style={{padding:"4px 6px",fontWeight:800,color:resultC}}>{result}</td>
                      </tr>;})}
                    </tbody>
                  </table>
                </div>
              </div>
              {/* Decade Breakdown */}
              {decadeList.length>1&&<div style={cS}>
                <div style={{fontSize:9,fontWeight:800,color:T.purple,letterSpacing:1,marginBottom:6}}>{"ðŸ“Š DYNASTY BY DECADE"}</div>
                {decadeList.map(function(dec){
                  var wPct=dec.wins+dec.losses>0?Math.round(dec.wins/(dec.wins+dec.losses)*100):0;
                  return <div key={dec.start} style={{padding:"8px 0",borderBottom:"1px solid "+T.border}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                      <div style={{fontWeight:700,fontSize:11}}>{dec.start+"s Era"+" ("+dec.seasons.length+" seasons)"}</div>
                      <div style={{display:"flex",gap:8,fontSize:10}}>
                        <span style={{color:T.text,fontWeight:700}}>{dec.wins+"-"+dec.losses}</span>
                        <span style={{color:T.dim}}>{"("+wPct+"%)"}</span>
                        {dec.titles>0&&<span style={{color:T.gold,fontWeight:800}}>{dec.titles+"xðŸ†"}</span>}
                      </div>
                    </div>
                    <div style={{height:5,background:"rgba(255,255,255,0.06)",borderRadius:3}}>
                      <div style={{height:5,width:wPct+"%",background:dec.titles>0?T.gold:wPct>=60?T.green:wPct>=40?T.cyan:T.red,borderRadius:3,transition:"width 0.5s"}}></div>
                    </div>
                  </div>;})}
              </div>}
              {/* â”€â”€ LEGACY SCORE & MILESTONES v97.6 â”€â”€ */}
              {(function(){
                var legStats=LEGACY.buildStats(history,myId,teams,season);
                var legScore=LEGACY.calcScore(legStats);
                var bd=legScore.breakdown;
                var tierColor=legScore.tier==="Hall of Fame"?T.gold:legScore.tier==="Legendary"?"#a855f7":legScore.tier==="Great"?T.green:legScore.tier==="Good"?T.cyan:T.faint;
                var earnedMilestones=0;
                LEGACY_MILESTONES976.forEach(function(m){if(m.check(legStats))earnedMilestones++;});
                var timeline976=buildDynastyTimeline976(history,myId,teams,hallOfFame,null);
                var eras976=detectDynastyEras976(timeline976);
                return <div style={{display:"flex",flexDirection:"column",gap:6}}>
                  <div style={{background:"linear-gradient(135deg,rgba(168,85,247,0.12),rgba(15,23,42,0.96))",borderRadius:14,padding:"14px 16px",border:"1px solid rgba(168,85,247,0.3)"}}>
                    <div style={{fontSize:8,fontWeight:800,letterSpacing:3,color:"#a855f7",marginBottom:4}}>{"ðŸ›ï¸ LEGACY SCORE"}</div>
                    <div style={{display:"flex",alignItems:"flex-end",gap:10,marginBottom:10}}>
                      <div style={{fontSize:52,fontWeight:900,color:tierColor,lineHeight:1}}>{legScore.score}</div>
                      <div>
                        <div style={{fontSize:15,fontWeight:800,color:tierColor}}>{legScore.tier}</div>
                        <div style={{fontSize:9,color:T.faint}}>{"out of 100"}</div>
                      </div>
                    </div>
                    {[
                      {label:"Win %",val:bd.winPct,max:30,color:T.cyan},
                      {label:"Rings",val:bd.rings,max:25,color:T.gold},
                      {label:"Playoffs",val:bd.playoffs,max:15,color:T.green},
                      {label:"Draft Hits",val:bd.draftHits,max:10,color:"#a855f7"},
                      {label:"Cap Mastery",val:bd.cap,max:10,color:T.cyan},
                      {label:"Development",val:bd.dev,max:10,color:T.green}
                    ].map(function(row){
                      return <div key={row.label} style={{marginBottom:4}}>
                        <div style={{display:"flex",justifyContent:"space-between",fontSize:8,color:T.faint,marginBottom:1}}>
                          <span>{row.label}</span><span style={{color:row.color,fontWeight:700}}>{Math.round(row.val)+"/"+row.max}</span>
                        </div>
                        <div style={{height:5,background:"rgba(255,255,255,0.08)",borderRadius:3}}>
                          <div style={{height:5,width:row.max>0?Math.min(100,Math.round((row.val/row.max)*100))+"%":"0%",background:row.color,borderRadius:3}}></div>
                        </div>
                      </div>;
                    })}
                    <div style={{display:"flex",gap:10,flexWrap:"wrap",marginTop:6,fontSize:9}}>
                      {bd.integrity>0&&<span style={{color:T.green}}>{"âœ… Integrity +"+bd.integrity}</span>}
                      {bd.dynastyDecade>0&&<span style={{color:T.gold}}>{"ðŸ‘‘ Dynasty Decade +"+bd.dynastyDecade}</span>}
                      {bd.eraBonus>0&&<span style={{color:"#a855f7"}}>{"âš¡ Era Bonus +"+bd.eraBonus}</span>}
                      {bd.coachStability>0&&<span style={{color:T.cyan}}>{"ðŸŽ“ Coach Stability +"+bd.coachStability}</span>}
                    </div>
                  </div>
                  <div style={assign({},cS,{padding:12})}>
                    <div style={{fontSize:9,fontWeight:800,color:T.cyan,letterSpacing:1,marginBottom:6}}>{"ðŸŽ¯ LEGACY MILESTONES â€” "+earnedMilestones+"/"+LEGACY_MILESTONES976.length+" ACHIEVED"}</div>
                    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:5}}>
                      {LEGACY_MILESTONES976.map(function(m){
                        var earned=m.check(legStats);
                        return <div key={m.id} style={{display:"flex",alignItems:"center",gap:6,padding:"6px 8px",borderRadius:7,
                          background:earned?"rgba(34,197,94,0.1)":"rgba(255,255,255,0.03)",
                          border:"1px solid "+(earned?"rgba(34,197,94,0.3)":"rgba(255,255,255,0.07)"),opacity:earned?1:0.55}}>
                          <span style={{fontSize:14}}>{m.icon}</span>
                          <span style={{fontSize:9,fontWeight:earned?700:400,color:earned?T.text:T.faint,lineHeight:1.25}}>{m.label}</span>
                        </div>;
                      })}
                    </div>
                  </div>
                  {eras976.length>0&&<div style={assign({},cS,{padding:12})}>
                    <div style={{fontSize:9,fontWeight:800,color:T.gold,letterSpacing:1,marginBottom:6}}>{"ðŸ‘‘ DYNASTY ERAS"}</div>
                    {eras976.map(function(era,i){
                      return <div key={i} style={{padding:"10px 12px",background:"linear-gradient(135deg,rgba(212,167,75,0.12),rgba(15,23,42,0.95))",borderRadius:10,border:"1px solid rgba(212,167,75,0.3)",marginBottom:6}}>
                        <div style={{fontWeight:800,fontSize:13,color:T.gold}}>{era.name}</div>
                        <div style={{fontSize:10,color:T.dim,marginTop:2}}>{era.startYear+" \u2013 "+era.endYear+" \u00b7 "+era.rings+" \uD83C\uDFC6"+(era.rings>1?" Championships":" Championship")}</div>
                      </div>;
                    })}
                  </div>}
                </div>;
              })()}
              {/* Share Dynasty Card button */}
              <button onClick={function(){
                SHARE_CARD.generate({
                  icon:titles>0?"ðŸ†":"ðŸˆ",teamIcon:my&&my.icon||"ðŸˆ",
                  teamName:(my&&my.name)||"My Dynasty",
                  teamColor:(my&&my.color)||"#0f172a",
                  headline:titles>0?"MULTI-DECADE DYNASTY â€” "+titles+"x CHAMPION":"THE DYNASTY IS BUILDING",
                  season:(history[history.length-1]&&history[history.length-1].year)||season.year,
                  record:totalW+"-"+totalL,
                  stats:[
                    {label:"SEASONS",val:history.length},
                    {label:"WIN%",val:winPct+"%"},
                    {label:"TITLES",val:titles+"xðŸ†"},
                    {label:"PLAYOFFS",val:playoffYears+"x"}
                  ]
                },"dynasty-all-time");
              }} style={{background:"rgba(251,191,36,0.15)",border:"1px solid rgba(251,191,36,0.4)",borderRadius:10,padding:"10px",fontWeight:700,cursor:"pointer",fontSize:11,color:T.gold}}>
                {"ðŸ“¸ Share My Dynasty Card"}
              </button>
            </div>;
          })()}

          {/* v98.6 #13: FRANCHISE TIMELINE */}
          {tab==="timeline986" && (function(){
            var tl=timeline986||[];
            if(tl.length===0)return <div style={{textAlign:"center",padding:40,color:T.faint}}>
              <div style={{fontSize:32,marginBottom:8}}>{"ðŸ“…"}</div>
              <div style={{fontWeight:700}}>{"No Timeline Events Yet"}</div>
              <div style={{fontSize:11}}>{"Events will populate as you play through seasons."}</div>
            </div>;
            var grouped={};
            tl.forEach(function(ev){
              var key=ev.year||"?";
              if(!grouped[key])grouped[key]=[];
              grouped[key].push(ev);
            });
            var years=Object.keys(grouped).sort(function(a,b){return Number(b)-Number(a);});
            return <div style={{display:"flex",flexDirection:"column",gap:8}}>
              <div style={{fontWeight:900,fontSize:15,color:T.gold,marginBottom:4}}>{"ðŸ“… FRANCHISE TIMELINE â€” "+tl.length+" Events"}</div>
              {years.map(function(yr){
                return <div key={yr} style={assign({},cS,{padding:12})}>
                  <div style={{fontWeight:800,fontSize:13,color:T.gold,marginBottom:6}}>{"Season "+yr}</div>
                  {grouped[yr].sort(function(a,b){return(a.week||0)-(b.week||0);}).map(function(ev,ei){
                    var typeColors={trade:T.cyan,draft:T.green,sign:"#a78bfa",championship:"#fbbf24",milestone:T.gold,injury:"#ef4444",retire:T.dim,record:T.cyan};
                    return <div key={ei} style={{display:"flex",gap:8,alignItems:"flex-start",padding:"5px 0",borderBottom:"1px solid "+T.border}}>
                      <span style={{fontSize:14,minWidth:20}}>{ev.icon||"ðŸ“Œ"}</span>
                      <div>
                        <div style={{fontSize:11,fontWeight:600,color:typeColors[ev.type]||T.text}}>{ev.text}</div>
                        {ev.week>0&&<div style={{fontSize:9,color:T.faint}}>{"Week "+ev.week}</div>}
                      </div>
                    </div>;
                  })}
                </div>;
              })}
            </div>;
          })()}

          {/* v98.6 #14: PLAYER COMPARISON â€” Accessible from roster via compare button */}
          {compareMode986&&(function(){
            var p1=compareMode986.p1;var p2=compareMode986.p2;
            if(!p1)return null;
            // If only p1 selected, show picker for p2
            if(!p2){
              var allPlayers986=teams.reduce(function(acc,t){return acc.concat(t.roster.map(function(p){return assign({},p,{teamAbbr:t.abbr,teamIcon:t.icon});}));},[]);
              var samePos=allPlayers986.filter(function(p){return p.pos===p1.pos&&p.id!==p1.id;}).sort(function(a,b){return(b.ovr||0)-(a.ovr||0);}).slice(0,20);
              return <div style={assign({},cS,{padding:14})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <div style={{fontWeight:900,fontSize:14,color:T.gold}}>{"âš”ï¸ COMPARE: "+p1.name+" ("+p1.pos+" "+p1.ovr+") vs ..."}</div>
                  <button onClick={function(){setCompareMode986(null);}} style={{padding:"4px 8px",borderRadius:4,border:"1px solid "+T.border,background:"rgba(255,255,255,0.05)",color:T.text,cursor:"pointer",fontSize:10}}>{"âœ• Close"}</button>
                </div>
                <div style={{fontSize:10,color:T.dim,marginBottom:6}}>{"Select a player to compare:"}</div>
                {samePos.map(function(p,i){
                  return <button key={i} onClick={function(){setCompareMode986({p1:p1,p2:p});}} style={{display:"block",width:"100%",textAlign:"left",
                    padding:"6px 8px",marginBottom:3,border:"1px solid "+T.border,borderRadius:4,background:"rgba(255,255,255,0.03)",
                    color:T.text,cursor:"pointer",fontSize:11}}>
                    {p.teamIcon+" "+p.name+" ("+p.pos+" "+p.ovr+" OVR) â€” "+p.teamAbbr}
                  </button>;
                })}
              </div>;
            }
            // Both selected â€” show comparison
            var radar=PLAYER_COMPARE_986.buildRadar(p1,p2);
            return <div style={assign({},cS,{padding:14})}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                <div style={{fontWeight:900,fontSize:14,color:T.gold}}>{"âš”ï¸ PLAYER COMPARISON"}</div>
                <button onClick={function(){setCompareMode986(null);}} style={{padding:"4px 8px",borderRadius:4,border:"1px solid "+T.border,background:"rgba(255,255,255,0.05)",color:T.text,cursor:"pointer",fontSize:10}}>{"âœ• Close"}</button>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 60px 1fr",gap:6,marginBottom:10}}>
                <div style={{textAlign:"center",padding:8,background:"rgba(34,197,94,0.1)",borderRadius:6}}>
                  <div style={{fontWeight:800,fontSize:13}}>{p1.name}</div>
                  <div style={{color:T.dim,fontSize:10}}>{p1.pos+" | Age "+p1.age}</div>
                  <div style={{fontWeight:900,fontSize:20,color:T.green}}>{p1.ovr}</div>
                </div>
                <div style={{display:"flex",alignItems:"center",justifyContent:"center",fontWeight:900,color:T.gold,fontSize:16}}>{"VS"}</div>
                <div style={{textAlign:"center",padding:8,background:"rgba(96,165,250,0.1)",borderRadius:6}}>
                  <div style={{fontWeight:800,fontSize:13}}>{p2.name}</div>
                  <div style={{color:T.dim,fontSize:10}}>{p2.pos+" | Age "+p2.age}</div>
                  <div style={{fontWeight:900,fontSize:20,color:T.cyan}}>{p2.ovr}</div>
                </div>
              </div>
              {/* Radar chart as bars */}
              {radar.categories.map(function(cat,ci){
                var v1=radar.p1[ci]||50;var v2=radar.p2[ci]||50;
                return <div key={ci} style={{marginBottom:4}}>
                  <div style={{display:"flex",justifyContent:"space-between",fontSize:9,marginBottom:2}}>
                    <span style={{color:v1>v2?T.green:T.dim,fontWeight:v1>v2?700:400}}>{v1}</span>
                    <span style={{fontWeight:700}}>{cat}</span>
                    <span style={{color:v2>v1?T.cyan:T.dim,fontWeight:v2>v1?700:400}}>{v2}</span>
                  </div>
                  <div style={{display:"flex",gap:2,height:6}}>
                    <div style={{flex:1,display:"flex",justifyContent:"flex-end"}}>
                      <div style={{width:v1+"%",height:6,background:T.green,borderRadius:3}}/>
                    </div>
                    <div style={{flex:1}}>
                      <div style={{width:v2+"%",height:6,background:T.cyan,borderRadius:3}}/>
                    </div>
                  </div>
                </div>;
              })}
              {/* Career stats comparison */}
              <div style={{marginTop:10,fontSize:10,color:T.dim}}>
                <div style={{display:"grid",gridTemplateColumns:"1fr 100px 1fr",gap:4}}>
                  {[{label:"Pro Bowls",k:"proBowls"},{label:"All-Pro",k:"allPro"},{label:"Potential",k:"pot"},{label:"Dev Trait",k:"devTrait"}].map(function(stat,si){
                    var v1p=stat.k==="devTrait"?(p1[stat.k]||"normal"):(p1.careerStats?p1.careerStats[stat.k]:p1[stat.k])||0;
                    var v2p=stat.k==="devTrait"?(p2[stat.k]||"normal"):(p2.careerStats?p2.careerStats[stat.k]:p2[stat.k])||0;
                    return <React.Fragment key={si}>
                      <div style={{textAlign:"right",fontWeight:600}}>{String(v1p)}</div>
                      <div style={{textAlign:"center",fontWeight:700,color:T.gold}}>{stat.label}</div>
                      <div style={{fontWeight:600}}>{String(v2p)}</div>
                    </React.Fragment>;
                  })}
                </div>
              </div>
            </div>;
          })()}

          {/* v98.6 #12/#20: RETIREMENT & HOF CEREMONY MODALS */}
          {retireCeremony986&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={function(){setRetireCeremony986(null);}}>
            <div style={{background:T.card,borderRadius:12,padding:24,maxWidth:400,width:"90%",border:"2px solid "+T.gold}} onClick={function(e){e.stopPropagation();}}>
              <div style={{textAlign:"center",marginBottom:12}}>
                <div style={{fontSize:28}}>{"ðŸŽ‰"}</div>
                <div style={{fontWeight:900,fontSize:18,color:T.gold}}>{retireCeremony986.type==="hof"?"HALL OF FAME INDUCTION":"RETIREMENT CEREMONY"}</div>
                <div style={{fontWeight:700,fontSize:14,marginTop:6}}>{retireCeremony986.player}</div>
              </div>
              {(retireCeremony986.lines||[]).map(function(line,i){
                return <div key={i} style={{fontSize:12,color:T.text,padding:"6px 0",borderBottom:"1px solid "+T.border,fontStyle:"italic"}}>
                  {line}
                </div>;
              })}
              <button onClick={function(){setRetireCeremony986(null);}} style={{width:"100%",padding:"10px",marginTop:12,borderRadius:6,border:"none",background:T.gold,color:"#000",fontWeight:800,cursor:"pointer",fontSize:13}}>
                {retireCeremony986.type==="hof"?"Welcome to Immortality":"Thank You, Legend"}
              </button>
            </div>
          </div>}

          {/* v98.6 #20: Separate HOF Ceremony from natural induction */}
          {hofCeremony986&&!retireCeremony986&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={function(){setHofCeremony986(null);}}>
            <div style={{background:"linear-gradient(135deg, #1e1b4b 0%, "+T.bg2+" 100%)",borderRadius:16,padding:28,maxWidth:420,width:"90%",border:"3px solid #d4a74b",boxShadow:"0 0 40px rgba(212,167,75,0.3)"}} onClick={function(e){e.stopPropagation();}}>
              <div style={{textAlign:"center",marginBottom:14}}>
                <div style={{fontSize:36}}>{"ðŸ›ï¸"}</div>
                <div style={{fontWeight:900,fontSize:20,color:"#d4a74b",letterSpacing:1}}>{"HALL OF FAME"}</div>
                <div style={{fontWeight:800,fontSize:16,marginTop:6,color:"#fff"}}>{hofCeremony986.player}</div>
                {hofCeremony986.score&&<div style={{fontSize:11,color:T.dim,marginTop:2}}>{"Legacy Score: "+hofCeremony986.score}</div>}
              </div>
              {(hofCeremony986.lines||[]).map(function(line,i){
                return <div key={i} style={{fontSize:13,color:"#e2e8f0",padding:"8px 0",borderBottom:"1px solid rgba(212,167,75,0.2)",fontStyle:"italic",lineHeight:1.5}}>
                  {line}
                </div>;
              })}
              <button onClick={function(){setHofCeremony986(null);}} style={{width:"100%",padding:"12px",marginTop:14,borderRadius:8,border:"2px solid #d4a74b",background:"linear-gradient(135deg, #d4a74b, #b8860b)",color:"#000",fontWeight:900,cursor:"pointer",fontSize:14,letterSpacing:1}}>
                {"â­ Welcome to Immortality â­"}
              </button>
            </div>
          </div>}

          {tab==="draftArchive" && (function(){
            var dh=draftHistory98||[];
            if(dh.length===0)return React.createElement("div",{style:{textAlign:"center",padding:40,color:T.faint}},
              React.createElement("div",{style:{fontSize:32,marginBottom:8}},"ðŸ“‹"),
              React.createElement("div",{style:{fontSize:14,fontWeight:700}},"No Drafts Yet"),
              React.createElement("div",{style:{fontSize:11,marginTop:4}},"Complete your first draft and it will be permanently archived here.")
            );
            var _archYear98=useState(dh[0]?dh[0].year:null),archYear98=_archYear98[0],setArchYear98=_archYear98[1];
            var selDraft=dh.find(function(d){return d.year===archYear98;})||dh[0];
            var userPicks=selDraft?selDraft.picks.filter(function(pk){return pk.isUser;}):[];
            var rounds=[];if(selDraft)(selDraft.picks||[]).forEach(function(pk){if(rounds.indexOf(pk.round)<0&&pk.round>0)rounds.push(pk.round);});
            rounds.sort(function(a,b){return a-b;});
            var _archRound98=useState(0),archRound98=_archRound98[0],setArchRound98=_archRound98[1];
            var filtPicks=selDraft?(selDraft.picks||[]).filter(function(pk){return archRound98===0||pk.round===archRound98;}):[]; 
            return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8}},
              /* Header */
              React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                React.createElement("div",{style:{fontSize:16,fontWeight:900,color:T.gold}},"ðŸ“‹ DRAFT ARCHIVE"),
                React.createElement("div",{style:{fontSize:10,color:T.dim}},dh.length+" draft"+(dh.length!==1?"s":"")+" on record")
              ),
              /* Year selector */
              React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:4}},
                dh.map(function(d){
                  var isActive=d.year===archYear98||(d===dh[0]&&!archYear98);
                  return React.createElement("button",{key:d.year,style:bS(isActive?T.gold:T.bg3,isActive?"#000":T.text),
                    onClick:function(){setArchYear98(d.year);setArchRound98(0);}},
                    (d.isInaugural?"ðŸŒŸ ":"")+d.year+" Draft"+(d.isInaugural?" (Inaugural)":""));
                })
              ),
              /* Draft summary card */
              selDraft && React.createElement("div",{style:assign({},cS,{borderColor:selDraft.isInaugural?T.gold:T.border})},
                React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
                  React.createElement("div",null,
                    React.createElement("div",{style:{fontSize:14,fontWeight:900,color:selDraft.isInaugural?T.gold:T.text}},
                      (selDraft.isInaugural?"ðŸŒŸ INAUGURAL ":"")+selDraft.year+" MFDF Draft"),
                    React.createElement("div",{style:{fontSize:10,color:T.dim}},selDraft.picks.length+" total picks | "+userPicks.length+" by your team")
                  ),
                  selDraft.isInaugural && React.createElement("div",{style:{background:"rgba(217,169,0,0.12)",border:"1px solid rgba(217,169,0,0.3)",borderRadius:6,padding:"4px 10px",fontSize:9,fontWeight:800,color:T.gold}},"FOUNDING DRAFT")
                ),
                /* Your picks highlight */
                userPicks.length>0 && React.createElement("div",{style:{background:"rgba(34,197,94,0.06)",border:"1px solid rgba(34,197,94,0.2)",borderRadius:6,padding:8,marginBottom:8}},
                  React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.green,marginBottom:4}},"ðŸˆ YOUR PICKS"),
                  React.createElement("div",{style:{display:"flex",gap:6,flexWrap:"wrap"}},
                    userPicks.map(function(pk,i){
                      var devColor=pk.devTrait==="superstar"?"#d946ef":pk.devTrait==="star"?T.gold:T.dim;
                      return React.createElement("div",{key:i,style:{background:T.bg3,borderRadius:6,padding:"6px 10px",minWidth:100,border:"1px solid "+T.border}},
                        React.createElement("div",{style:{fontSize:8,color:T.faint}},"Rd"+pk.round+" #"+pk.pickNum),
                        React.createElement("div",{style:{fontSize:11,fontWeight:800}},(pk.name||"?")),
                        React.createElement("div",{style:{display:"flex",gap:4,alignItems:"center",fontSize:9}},
                          React.createElement("span",{style:{color:T.gold,fontWeight:700}},pk.pos),
                          React.createElement("span",{style:{color:pk.ovr>=80?T.green:pk.ovr>=70?T.cyan:T.dim,fontWeight:800}},pk.ovr),
                          React.createElement("span",{style:{color:devColor,fontSize:7}},pk.devTrait==="superstar"?"ðŸŒŸ":pk.devTrait==="star"?"â­":"")
                        ),
                        React.createElement("div",{style:{fontSize:7,color:T.faint}},pk.college||"?")
                      );
                    })
                  )
                ),
                /* Round filter */
                React.createElement("div",{style:{display:"flex",gap:3,marginBottom:6}},
                  React.createElement("button",{style:bS(archRound98===0?T.cyan:T.bg3,archRound98===0?"#000":T.dim),onClick:function(){setArchRound98(0);}},"All Rounds"),
                  rounds.map(function(rd){
                    return React.createElement("button",{key:rd,style:bS(archRound98===rd?T.cyan:T.bg3,archRound98===rd?"#000":T.dim),
                      onClick:function(){setArchRound98(rd);}},"Rd "+rd);
                  })
                ),
                /* Full picks table */
                React.createElement("div",{style:{maxHeight:400,overflowY:"auto"}},
                  filtPicks.map(function(pk,i){
                    var devIcon=pk.devTrait==="superstar"?"ðŸŒŸ":pk.devTrait==="star"?"â­":"";
                    return React.createElement("div",{key:i,style:{display:"flex",alignItems:"center",gap:6,padding:"5px 8px",fontSize:10,
                      borderBottom:"1px solid "+T.border,background:pk.isUser?"rgba(34,197,94,0.06)":"transparent"}},
                      React.createElement("span",{style:{color:T.faint,fontWeight:700,width:42,fontSize:9}},"#"+pk.pickNum),
                      React.createElement("span",{style:{width:50,fontSize:10}},(pk.icon||"ðŸˆ")+" "+pk.team),
                      React.createElement("span",{style:{color:T.gold,fontWeight:700,width:24}},pk.pos),
                      React.createElement("span",{style:{fontWeight:700,flex:1}},pk.name+(pk.isUser?" ðŸ“Œ":"")),
                      React.createElement("span",{style:{color:pk.ovr>=80?T.green:pk.ovr>=70?T.cyan:pk.ovr>=60?T.dim:T.red,fontWeight:800,width:28}},pk.ovr),
                      devIcon && React.createElement("span",{style:{width:16}},devIcon),
                      React.createElement("span",{style:{color:T.faint,fontSize:8,width:80,textAlign:"right"}},pk.college||"?")
                    );
                  })
                )
              )
            );
          })()}

          {tab==="boxScores" && (function(){
            var sorted=boxHistory.slice().sort(function(a,b){return (b.year*100+b.week)-(a.year*100+a.week);});
            var years=[];sorted.forEach(function(g){if(years.indexOf(g.year)<0)years.push(g.year);});
            return <div style={{display:"flex",flexDirection:"column",gap:6}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div style={{fontWeight:700}}>{"ðŸ“Š Box Score Archive â€” "+boxHistory.length+" Games"}</div>
                {boxHistory.length>0 && <button style={bS(T.green,"#000")} onClick={exportSave}>{"ðŸ’¾ Export All"}</button>}
              </div>
              {boxHistory.length===0 && <div style={{color:T.faint,padding:20,textAlign:"center"}}>{"No games played yet. Box scores will appear here after simming weeks."}</div>}
              {years.map(function(yr){
                var yrGames=sorted.filter(function(g){return g.year===yr;});
                return <div key={yr}>
                  <div style={{fontWeight:700,color:T.gold,fontSize:13,padding:"6px 0",borderBottom:"2px solid "+T.gold}}>{"Season "+yr+" ("+yrGames.length+" games)"}</div>
                  {yrGames.map(function(g){
                    var isUserGame=g.homeId===myId||g.awayId===myId;
                    var userWon=isUserGame&&((g.homeId===myId&&g.homeScore>g.awayScore)||(g.awayId===myId&&g.awayScore>g.homeScore));
                    return <div key={g.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 4px",borderBottom:"1px solid "+T.border,
                      background:isUserGame?(userWon?"rgba(34,197,94,0.06)":"rgba(239,68,68,0.06)"):"transparent",cursor:"pointer"}}
                      onClick={function(){setBoxScore({result:{home:g.homeScore,away:g.awayScore,qtrs:g.qtrs,box:g.box,leaders:g.leaders,log:g.log,recap:null},
                        hTeam:teams.find(function(t){return t.id===g.homeId;})||{abbr:g.homeName,icon:""},
                        aTeam:teams.find(function(t){return t.id===g.awayId;})||{abbr:g.awayName,icon:""}});}}>
                      <div style={{fontSize:12}}>
                        <span style={{color:T.faint}}>{"Wk"+g.week+" "}</span>
                        <span style={{fontWeight:isUserGame?700:400}}>{g.homeName}</span>
                        <span style={{color:T.gold,fontWeight:800}}>{" "+g.homeScore+"-"+g.awayScore+" "}</span>
                        <span style={{fontWeight:isUserGame?700:400}}>{g.awayName}</span>
                      </div>
                      <div style={{fontSize:10,color:isUserGame?(userWon?T.green:T.red):T.faint}}>{isUserGame?(userWon?"W":"L"):""}</div>
                    </div>;
                  })}
                </div>;
              })}
            </div>;
          })()}
          
          {tab==="analyticsHub"&&my&&(function(){
            // â”€â”€ ANALYTICS HUB â€” Feature 10: ANALYTICS_HUB â”€â”€
            var POS_PEAK={QB:28,RB:24,WR:26,TE:26,OL:28,DL:26,LB:26,CB:25,S:26,K:30,P:30};
            var DECLINE_RATE={QB:0.012,RB:0.030,WR:0.018,TE:0.020,OL:0.010,DL:0.020,LB:0.020,CB:0.025,S:0.020,K:0.008,P:0.008};
            function projectOVR(player,targetAge){
              var peak=POS_PEAK[player.pos]||27;var rate=DECLINE_RATE[player.pos]||0.018;
              if(targetAge<=peak){
                var yearsToGrow=targetAge-player.age;
                if(yearsToGrow<=0)return player.ovr;
                return Math.min(99,Math.round(player.ovr*(1+yearsToGrow*0.012)));
              }
              var yearsPast=targetAge-peak;
              return Math.max(40,Math.round(player.ovr*Math.exp(-rate*yearsPast)));
            }
            function schedIds(g){
              var homeId=g?(g.home!==undefined?g.home:g.homeId):null;
              var awayId=g?(g.away!==undefined?g.away:g.awayId):null;
              return {homeId:homeId,awayId:awayId};
            }
            var selfMatch=SIM_CULL.matchupOVR(my,my)||{offStrength:70,defStrength:70};
            var selfStrength=((selfMatch.offStrength||70)+(selfMatch.defStrength||70))/2;
            function calcPlayoffOdds(team,remainingSched){
              var teamId=team?team.id:null;
              var teamStr=selfStrength;
              var expW=team.wins;
              (remainingSched||[]).forEach(function(g){
                var ids=schedIds(g);
                if(ids.homeId===null||ids.awayId===null)return;
                var oppId=ids.homeId===teamId?ids.awayId:ids.homeId;
                if(oppId===null||oppId===undefined)return;
                var opp=teams.find(function(t2){return t2.id===oppId;});
                if(!opp)return;
                var om=SIM_CULL.matchupOVR(opp,opp)||{offStrength:70,defStrength:70};
                var oppStr=((om.offStrength||70)+(om.defStrength||70))/2;
                var diff=(teamStr-oppStr)/100;
                var homeAdv=ids.homeId===teamId?0.04:-0.04;
                expW+=Math.max(0.15,Math.min(0.85,0.5+diff+homeAdv));
              });
              var gp=(team.wins||0)+(team.losses||0);
              var totalGames=gp+(remainingSched||[]).length;
              var pct=totalGames>0?Math.min(99,Math.max(1,Math.round((expW/Math.max(1,totalGames))*100+10))):50;
              return{projWins:Math.round(expW*10)/10,playoffPct:pct};
            }
            // Remaining schedule for user team
            var gp=(my.wins||0)+(my.losses||0);
            var remainingSched=(sched||[]).filter(function(g){
              var ids=schedIds(g);
              return season.phase==="regular"&&(ids.homeId===myId||ids.awayId===myId)&&!g.played;
            });
            var playoffOdds=calcPlayoffOdds(my,remainingSched);
            // DVOA
            var dvoaRaw=ADVANCED_ANALYTICS.calcDVOA(my)||{};
            var dvoa={off:typeof dvoaRaw.off==="number"?dvoaRaw.off:0,def:typeof dvoaRaw.def==="number"?dvoaRaw.def:0};
            // Cap health
            var capUsed=capCalc(my.roster);var deadC=my.deadCap||0;
            var theCap=getSalaryCap(season.year);
            var capSpace=Math.round((theCap-capUsed-deadC)*10)/10;
            var capPct=theCap>0?Math.round(((capUsed+deadC)/theCap)*100):0;
            // Aging risk â€” top 10 starters by ovr
            var topPlayers=(my.roster||[]).filter(function(p){return p.isStarter||p.ovr>=75;})
              .sort(function(a,b){return b.ovr-a.ovr;}).slice(0,8);
            // Schedule difficulty for remaining games
            var schedHeat=remainingSched.slice(0,8).map(function(g){
              var ids=schedIds(g);
              if(ids.homeId===null||ids.awayId===null)return null;
              var oppId=ids.homeId===myId?ids.awayId:ids.homeId;
              var opp=teams.find(function(t2){return t2.id===oppId;});
              if(!opp)return null;
              var om=SIM_CULL.matchupOVR(opp,opp)||{offStrength:70,defStrength:70};
              var oppStrength=((om.offStrength||70)+(om.defStrength||70))/2;
              var oppStr=Math.round(oppStrength);
              var isHome=ids.homeId===myId;
              var diff=Math.round(selfStrength-oppStrength);
              return{opp:opp,str:oppStr,diff:diff,isHome:isHome,week:g.week};
            }).filter(function(x){return x;});
            // Draft value chart (standard NFL scale approximation)
            var DRAFT_VALUES=[3000,2600,2200,1800,1600,1400,1250,1100,1000,900,800,720,660,600,550,500,460,420,390,360,
              330,310,290,270,250,230,210,200,190,180,170,160,150,140,130,120,115,110,105,100,
              95,90,86,82,78,74,70,66,62,58,55,52,49,46,43,41,39,37,35,33];
            // Top EPA contributors this season
            var epaPlayers=(my.roster||[]).filter(function(p){return p.stats&&(p.stats.gp||0)>0;})
              .map(function(p){return assign({},p,{_epa:ADVANCED_ANALYTICS.calcEPA(p,my.wins,gp)});})
              .sort(function(a,b){return b._epa-a._epa;}).slice(0,6);
            // Front Office Report bullets
            var foReport=[];
            if(dvoa.off>=15)foReport.push({icon:"ðŸš€",text:"Offense is elite (DVOA "+dvoa.off+"%) â€” lean into it",color:T.green});
            else if(dvoa.off<=-10)foReport.push({icon:"âš ï¸",text:"Offense underperforming (DVOA "+dvoa.off+"%) â€” consider FA upgrades",color:T.red});
            if(dvoa.def>=15)foReport.push({icon:"ðŸ›¡ï¸",text:"Defense top-tier (DVOA "+dvoa.def+"%) â€” keep the core together",color:T.green});
            else if(dvoa.def<=-10)foReport.push({icon:"ðŸš¨",text:"Defense is a liability (DVOA "+dvoa.def+"%) â€” must address this offseason",color:T.red});
            if(capSpace<10)foReport.push({icon:"ðŸ’¸",text:"Cap space critical ($"+capSpace+"M) â€” avoid long-term deals this week",color:T.red});
            else if(capSpace>=40)foReport.push({icon:"ðŸ’°",text:"Strong cap position ($"+capSpace+"M) â€” room to be aggressive in FA",color:T.green});
            var agingRisk=(my.roster||[]).filter(function(p){return p.age>=31&&p.ovr>=75&&p.isStarter;});
            if(agingRisk.length>=3)foReport.push({icon:"â³",text:agingRisk.length+" starters age 31+ â€” plan succession this draft",color:T.orange});
            if(season.phase==="regular"){
              if(playoffOdds.playoffPct>=75)foReport.push({icon:"ðŸ†",text:"Playoff odds "+playoffOdds.playoffPct+"% â€” this is a win-now window",color:T.gold});
              else if(playoffOdds.playoffPct<=30)foReport.push({icon:"ðŸ”„",text:"Playoff odds "+playoffOdds.playoffPct+"% â€” consider retooling",color:T.dim});
            }else{
              foReport.push({icon:"ðŸ“…",text:"Playoff odds update returns when regular season resumes",color:T.dim});
            }
            var injuryLoad=(my.roster||[]).filter(function(p){return p.injury&&p.injury.games>0;}).length;
            if(injuryLoad>=5)foReport.push({icon:"ðŸ¥",text:injuryLoad+" players injured â€” depth is being tested",color:T.red});
            if(foReport.length===0)foReport.push({icon:"âœ…",text:"Franchise is healthy â€” maintain course",color:T.green});

            return React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10}},

              // HEADER
              React.createElement("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:2}},
                React.createElement("div",{style:{fontSize:20}},"\ud83d\udcca"),
                React.createElement("div",null,
                  React.createElement("div",{style:{fontSize:14,fontWeight:900,letterSpacing:0.5,color:T.cyan}},"ANALYTICS HUB"),
                  React.createElement("div",{style:{fontSize:10,color:T.dim}},"Front Office Intelligence Dashboard")
                )
              ),

              // TOP 4 KPIs
              React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8}},
                // Playoff %
                React.createElement("div",{style:{background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.2)",borderRadius:10,padding:"10px 6px",textAlign:"center"}},
                  React.createElement("div",{style:{fontSize:10,color:T.gold,fontWeight:800,letterSpacing:0.5,marginBottom:4}},"PLAYOFF%"),
                  React.createElement("div",{style:{fontSize:26,fontWeight:900,color:season.phase==="regular"?T.gold:T.dim,lineHeight:1}},
                    season.phase==="regular"?playoffOdds.playoffPct+"%":"â€”"),
                  React.createElement("div",{style:{fontSize:9,color:T.faint,marginTop:3}},"Proj "+playoffOdds.projWins+"W")
                ),
                // Off DVOA
                React.createElement("div",{style:{background:"rgba(34,197,94,0.06)",border:"1px solid rgba(34,197,94,0.2)",borderRadius:10,padding:"10px 6px",textAlign:"center"}},
                  React.createElement("div",{style:{fontSize:10,color:T.green,fontWeight:800,letterSpacing:0.5,marginBottom:4}},"OFF DVOA"),
                  React.createElement("div",{style:{fontSize:26,fontWeight:900,color:dvoa.off>0?T.green:dvoa.off<-10?T.red:T.orange,lineHeight:1}},(dvoa.off>0?"+":"")+dvoa.off+"%"),
                  React.createElement("div",{style:{fontSize:9,color:T.faint,marginTop:3}},dvoa.off>=15?"Elite":dvoa.off>=-5?"Average":"Below Avg")
                ),
                // Def DVOA
                React.createElement("div",{style:{background:"rgba(167,139,250,0.06)",border:"1px solid rgba(167,139,250,0.2)",borderRadius:10,padding:"10px 6px",textAlign:"center"}},
                  React.createElement("div",{style:{fontSize:10,color:T.purple,fontWeight:800,letterSpacing:0.5,marginBottom:4}},"DEF DVOA"),
                  React.createElement("div",{style:{fontSize:26,fontWeight:900,color:dvoa.def>0?T.green:dvoa.def<-10?T.red:T.orange,lineHeight:1}},(dvoa.def>0?"+":"")+dvoa.def+"%"),
                  React.createElement("div",{style:{fontSize:9,color:T.faint,marginTop:3}},dvoa.def>=15?"Elite":dvoa.def>=-5?"Average":"Below Avg")
                ),
                // Cap Health
                React.createElement("div",{style:{background:"rgba(34,211,238,0.06)",border:"1px solid rgba(34,211,238,0.2)",borderRadius:10,padding:"10px 6px",textAlign:"center"}},
                  React.createElement("div",{style:{fontSize:10,color:T.cyan,fontWeight:800,letterSpacing:0.5,marginBottom:4}},"CAP HEALTH"),
                  React.createElement("div",{style:{fontSize:capSpace>=0?26:20,fontWeight:900,color:capSpace>=20?T.green:capSpace>=5?T.gold:T.red,lineHeight:1}},"$"+capSpace+"M"),
                  React.createElement("div",{style:{fontSize:9,color:T.faint,marginTop:3}},"Used: "+capPct+"% of cap")
                )
              ),

              // FRONT OFFICE REPORT
              React.createElement("div",{style:{background:T.glass,border:"1px solid "+T.glassBorder,borderRadius:RAD.lg,padding:12}},
                React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.gold,marginBottom:8,letterSpacing:0.5}},"ðŸ“‹ FRONT OFFICE REPORT"),
                React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:5}},
                  foReport.map(function(item,i){
                    return React.createElement("div",{key:i,style:{display:"flex",gap:8,alignItems:"flex-start",padding:"5px 8px",borderRadius:6,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.04)"}},
                      React.createElement("span",{style:{fontSize:14,lineHeight:1}},item.icon),
                      React.createElement("span",{style:{fontSize:11,color:item.color,fontWeight:600,lineHeight:1.4}},item.text)
                    );
                  })
                )
              ),

              // EPA CONTRIBUTORS
              React.createElement("div",{style:{background:T.glass,border:"1px solid "+T.glassBorder,borderRadius:RAD.lg,padding:12}},
                React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.cyan,marginBottom:8,letterSpacing:0.5}},"âš¡ TOP EPA CONTRIBUTORS"),
                epaPlayers.length===0?
                  React.createElement("div",{style:{color:T.faint,fontSize:10,textAlign:"center",padding:8}},"Play some games to see EPA data"):
                  epaPlayers.map(function(p,i){
                    var epaColor=p._epa>30?T.green:p._epa>10?T.gold:p._epa>=0?T.dim:T.red;
                    var tgt=(p.pos==="WR"||p.pos==="TE"||p.pos==="RB")?ADVANCED_ANALYTICS.calcTargetShare(p,my.roster):null;
                    return React.createElement("div",{key:p.id,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 6px",borderBottom:i<epaPlayers.length-1?"1px solid "+T.border+"33":"none"}},
                      React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center"}},
                        React.createElement("span",{style:{fontSize:10,color:T.faint,minWidth:14,fontWeight:700}},"#"+(i+1)),
                        React.createElement("span",{style:{fontSize:11,fontWeight:700}},p.name),
                        React.createElement("span",{style:{fontSize:9,color:T.dim,background:"rgba(255,255,255,0.05)",padding:"1px 5px",borderRadius:4}},p.pos)
                      ),
                      React.createElement("div",{style:{display:"flex",gap:10,alignItems:"center"}},
                        tgt?React.createElement("span",{style:{fontSize:9,color:T.cyan}},"TGT "+tgt+"%"):null,
                        React.createElement("span",{style:{fontSize:12,fontWeight:900,color:epaColor}},(p._epa>0?"+":"")+p._epa+" EPA")
                      )
                    );
                  })
              ),

              // AGING CURVE PROJECTOR
              React.createElement("div",{style:{background:T.glass,border:"1px solid "+T.glassBorder,borderRadius:RAD.lg,padding:12}},
                React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.orange,marginBottom:8,letterSpacing:0.5}},"ðŸ“ˆ AGING CURVE PROJECTOR"),
                React.createElement("div",{style:{fontSize:9,color:T.faint,marginBottom:8}},"Top starters â€” projected OVR trajectory"),
                topPlayers.length===0?React.createElement("div",{style:{color:T.faint,fontSize:10,textAlign:"center",padding:8}},"No starters found"):
                topPlayers.map(function(p){
                  var now=p.ovr;
                  var yr1=projectOVR(p,p.age+1);
                  var yr2=projectOVR(p,p.age+2);
                  var yr3=projectOVR(p,p.age+3);
                  var peak=POS_PEAK[p.pos]||27;
                  var isPeak=p.age>=peak-1&&p.age<=peak+1;
                  var isDeclining=p.age>peak;
                  var trendColor=isDeclining?T.red:yr1>now?T.green:T.gold;
                  var arrow=yr1>now?"â†‘":yr1<now?"â†“":"â†’";
                  function ovrBar(val,maxW){
                    var pct=Math.min(99,Math.max(40,val));
                    var c=val>=85?T.green:val>=75?T.gold:val>=65?T.orange:T.red;
                    return React.createElement("div",{style:{display:"inline-flex",flexDirection:"column",alignItems:"center",gap:1,minWidth:maxW||32}},
                      React.createElement("div",{style:{fontSize:10,fontWeight:800,color:c}},val),
                      React.createElement("div",{style:{width:maxW||32,height:3,background:"rgba(255,255,255,0.08)",borderRadius:2}},
                        React.createElement("div",{style:{width:Math.round((pct-40)/59*100)+"%",height:3,background:c,borderRadius:2}})
                      )
                    );
                  }
                  return React.createElement("div",{key:p.id,style:{display:"flex",alignItems:"center",gap:6,padding:"5px 4px",borderBottom:"1px solid "+T.border+"22"}},
                    React.createElement("div",{style:{flex:1,display:"flex",gap:6,alignItems:"center"}},
                      React.createElement("div",null,
                        React.createElement("div",{style:{fontSize:11,fontWeight:700}},p.name),
                        React.createElement("div",{style:{fontSize:9,color:T.dim}},p.pos+" | Age "+p.age+(isPeak?" ðŸ”¥ PEAK":"")+(isDeclining?" âš ï¸ Decline":""))
                      )
                    ),
                    React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center"}},
                      React.createElement("div",{style:{textAlign:"center"}},React.createElement("div",{style:{fontSize:8,color:T.faint,marginBottom:1}},"NOW"),ovrBar(now,28)),
                      React.createElement("span",{style:{color:trendColor,fontWeight:900,fontSize:14}},arrow),
                      React.createElement("div",{style:{textAlign:"center"}},React.createElement("div",{style:{fontSize:8,color:T.faint,marginBottom:1}},"+1yr"),ovrBar(yr1,28)),
                      React.createElement("div",{style:{textAlign:"center"}},React.createElement("div",{style:{fontSize:8,color:T.faint,marginBottom:1}},"+2yr"),ovrBar(yr2,28)),
                      React.createElement("div",{style:{textAlign:"center"}},React.createElement("div",{style:{fontSize:8,color:T.faint,marginBottom:1}},"+3yr"),ovrBar(yr3,28))
                    )
                  );
                })
              ),

              // SCHEDULE DIFFICULTY HEATMAP
              React.createElement("div",{style:{background:T.glass,border:"1px solid "+T.glassBorder,borderRadius:RAD.lg,padding:12}},
                React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.purple,marginBottom:8,letterSpacing:0.5}},"ðŸ—“ï¸ SCHEDULE DIFFICULTY â€” REMAINING"),
                season.phase!=="regular"?
                  React.createElement("div",{style:{fontSize:9,color:T.faint}},"Regular season only. Heatmap repopulates when next regular season begins."):
                schedHeat.length===0?
                  React.createElement("div",{style:{fontSize:9,color:T.faint}},"No remaining regular-season games on your schedule."):
                  React.createElement("div",null,
                    React.createElement("div",{style:{fontSize:9,color:T.faint,marginBottom:8}},"Opponent strength vs. your team â€” colored by matchup difficulty"),
                    React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:6}},
                      schedHeat.map(function(g,i){
                        var difficulty=g.diff>8?"Easy":g.diff>2?"Favorable":g.diff>-2?"Toss-Up":g.diff>-8?"Tough":"Brutal";
                        var diffColor=g.diff>8?T.green:g.diff>2?"#6ee7b7":g.diff>-2?T.gold:g.diff>-8?T.orange:T.red;
                        return React.createElement("div",{key:i,style:{background:"rgba(255,255,255,0.03)",border:"2px solid "+diffColor+"55",borderRadius:8,padding:"6px 10px",minWidth:90,textAlign:"center"}},
                          React.createElement("div",{style:{fontSize:8,color:T.faint,fontWeight:700}},"WK "+g.week+(g.isHome?" ðŸ ":" âœˆï¸")),
                          React.createElement("div",{style:{fontSize:12,fontWeight:800,marginTop:2}},g.opp.abbr||g.opp.name),
                          React.createElement("div",{style:{fontSize:9,fontWeight:700,color:diffColor,marginTop:2}},difficulty),
                          React.createElement("div",{style:{fontSize:9,color:T.faint}},"Str: "+g.str)
                        );
                      })
                    )
                  )
              ),

              // DRAFT VALUE CHART
              React.createElement("div",{style:{background:T.glass,border:"1px solid "+T.glassBorder,borderRadius:RAD.lg,padding:12}},
                React.createElement("div",{style:{fontSize:11,fontWeight:800,color:T.gold,marginBottom:8,letterSpacing:0.5}},"ðŸ“‹ DRAFT VALUE CHART"),
                React.createElement("div",{style:{fontSize:9,color:T.faint,marginBottom:8}},"Trade value by pick number â€” use in negotiations"),
                React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:4}},
                  [1,2,3,4,5,6,7,8,10,12,15,20,25,32,40,50,60].map(function(pickNum){
                    var val=DRAFT_VALUES[Math.min(pickNum-1,DRAFT_VALUES.length-1)];
                    var c=pickNum<=5?T.gold:pickNum<=15?T.green:pickNum<=32?T.cyan:T.dim;
                    return React.createElement("div",{key:pickNum,style:{background:"rgba(255,255,255,0.03)",border:"1px solid "+c+"33",borderRadius:6,padding:"5px 8px",textAlign:"center",minWidth:44}},
                      React.createElement("div",{style:{fontSize:9,color:T.faint}},"#"+pickNum),
                      React.createElement("div",{style:{fontSize:11,fontWeight:800,color:c}},val)
                    );
                  })
                ),
                // User's own picks
                React.createElement("div",{style:{marginTop:10,borderTop:"1px solid "+T.border,paddingTop:8}},
                  React.createElement("div",{style:{fontSize:9,fontWeight:700,color:T.cyan,marginBottom:4}},"YOUR PICK ASSETS"),
                  (my.draftPicks||[]).length===0?
                    React.createElement("div",{style:{fontSize:9,color:T.faint}},"No picks stored â€” check with trade system"):
                    React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:4}},
                      (my.draftPicks||[]).slice(0,10).map(function(pk,pi){
                        // v95: Show year + original team on pick chip (ChatGPT UX pattern)
                        var pNum=typeof pk==="object"?pk.pick||pk.round*32:pi*32+1;
                        var pVal=DRAFT_VALUES[Math.min(pNum-1,DRAFT_VALUES.length-1)];
                        var pRound=typeof pk==="object"?pk.round:pi+1;
                        var pkYear=typeof pk==="object"&&pk.year?("'"+String(pk.year).slice(2)):null;
                        var origTeam=typeof pk==="object"&&pk.original?pk.original:null;
                        // Find original team abbr if we have team data
                        var origAbbr=origTeam?(TD.find(function(t){return t.id===origTeam;})||{abbr:origTeam.slice(0,3).toUpperCase()}).abbr:null;
                        var isOwn=!origTeam||origTeam===myId;
                        return React.createElement("div",{key:pi,style:{background:isOwn?"rgba(251,191,36,0.08)":"rgba(34,211,238,0.08)",border:"1px solid "+(isOwn?"rgba(251,191,36,0.35)":"rgba(34,211,238,0.35)"),borderRadius:8,padding:"5px 8px",textAlign:"center",minWidth:52}},
                          React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:4}},
                            React.createElement("span",{style:{fontSize:9,fontWeight:800,color:isOwn?T.gold:T.cyan}},"R"+pRound),
                            pkYear&&React.createElement("span",{style:{fontSize:8,color:T.dim}},pkYear)
                          ),
                          React.createElement("div",{style:{fontSize:10,fontWeight:800,color:T.text}},pVal||"~"+(300-pRound*50)),
                          !isOwn&&origAbbr&&React.createElement("div",{style:{fontSize:7,color:T.cyan,marginTop:1}},"\u2934 "+origAbbr)
                        );
                      })
                    )
                )
              )

            ); // end return
          })()}

          {playerDetail && (function(){
            var p=playerDetail;var arch=p.archetype||PLAYER_ARCHETYPES.classify(p);if(!p.archetype&&arch)p.archetype=arch;var def=POS_DEF[p.pos]||{r:[],w:[]};
            var trObj=TRAITS[p.trait||"none"]||TRAITS.none;
            var cs=p.careerStats||{};
            var phase=getAgingPhase(p);
            var htFt=p.height?Math.floor(p.height/12):6;var htIn=p.height?p.height%12:0;
            var htStr=htFt+"'"+htIn+'"';var wtStr=p.weight?p.weight+" lbs":"";
            var expYrs=(cs.seasons||0);
            var ovrColor=p.ovr>=90?"#10b981":p.ovr>=80?"#22d3ee":p.ovr>=70?"#fbbf24":p.ovr>=60?"#f97316":"#ef4444";
            var ovrGlow=p.ovr>=85?"0 0 12px "+ovrColor+"66":"none";
            var seasonLine=p.pos==="QB"?(p.stats.passYds||0)+"yd "+(p.stats.passTD||0)+"TD "+(p.stats.int||0)+"INT"
              :p.pos==="RB"?(p.stats.rushYds||0)+"yd "+(p.stats.rushTD||0)+"TD"
              :(p.pos==="WR"||p.pos==="TE")?(p.stats.rec||0)+"rec "+(p.stats.recYds||0)+"yd "+(p.stats.recTD||0)+"TD"
              :(["DL","LB"].indexOf(p.pos)>=0)?(p.stats.sacks||0)+"sk "+(p.stats.tackles||0)+"tkl"
              :(["CB","S"].indexOf(p.pos)>=0)?(p.stats.defINT||0)+"INT "+(p.stats.tackles||0)+"tkl"
              :p.pos==="K"?(p.stats.fgM||0)+"/"+(p.stats.fgA||0)+"FG"
              :p.pos==="P"?(p.stats.punts||0)+"pnt "+(p.stats.punts>0?Math.round((p.stats.puntYds||0)/p.stats.punts):"0")+"avg"
              :(p.stats.gp||0)+"GP";
            var careerLine=p.pos==="QB"?(cs.passYds||0)+"yd "+(cs.passTD||0)+"TD "+(cs.int||0)+"INT"
              :p.pos==="RB"?(cs.rushYds||0)+"yd "+(cs.rushTD||0)+"TD"
              :(p.pos==="WR"||p.pos==="TE")?(cs.rec||0)+"rec "+(cs.recYds||0)+"yd "+(cs.recTD||0)+"TD"
              :(["DL","LB"].indexOf(p.pos)>=0)?(cs.sacks||0)+"sk "+(cs.tackles||0)+"tkl"
              :(["CB","S"].indexOf(p.pos)>=0)?(cs.defINT||0)+"INT "+(cs.tackles||0)+"tkl"
              :p.pos==="K"?(cs.fgM||0)+"/"+(cs.fgA||0)+"FG"
              :p.pos==="P"?(cs.punts||0)+"pnt "+(cs.punts>0?Math.round((cs.puntYds||0)/cs.punts):"0")+"avg"
              :(cs.seasons||0)+" seasons";
            return <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.88)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,padding:10}}
              onClick={function(){setPlayerDetail(null);}}>
              <div style={{width:"100%",maxWidth:400,background:T.bg2,borderRadius:16,overflow:"hidden",maxHeight:"92vh",overflowY:"auto",border:"1px solid "+ovrColor+"33",boxShadow:"0 8px 32px rgba(0,0,0,0.5), 0 0 1px "+ovrColor+"55"}}
                onClick={function(e){e.stopPropagation();}}>
                
                <div style={{background:"linear-gradient(135deg, "+ovrColor+"18 0%, "+T.bg3+" 60%)",padding:"0",position:"relative"}}>
                  
                  <div style={{height:4,background:"linear-gradient(90deg, "+ovrColor+", "+ovrColor+"88, transparent)"}}></div>
                  <div style={{padding:"16px 20px 14px",display:"flex",gap:16,alignItems:"flex-start"}}>
                    {React.createElement(PlayerFace,{id:p.id,morale:p.morale||70,size:64,age:p.age})}
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontWeight:900,fontSize:20,letterSpacing:-0.5,lineHeight:1.1}}>{p.name}</div>
                      <div style={{display:"flex",gap:6,alignItems:"center",marginTop:4,flexWrap:"wrap"}}>
                        <span style={{background:ovrColor+"22",color:ovrColor,fontWeight:800,fontSize:11,padding:"2px 8px",borderRadius:4,border:"1px solid "+ovrColor+"44"}}>{p.pos}</span>
                        {arch && <span title={(arch.label||"")+": "+(arch.description||"")} style={{background:"rgba(255,255,255,0.06)",border:"1px solid "+T.border,color:"#fff",fontWeight:800,fontSize:11,padding:"2px 8px",borderRadius:4}}>{arch.emoji+" "+arch.label}</span>}
                        <span style={{fontSize:11,color:T.dim}}>{"Age "+p.age}</span>
                        <span style={{fontSize:10,color:phase.color}}>{phase.label+" "+phase.tip}</span>
                        {/* v95: Up to 3 trait badges in player detail header */}
                        {(p.traits95||[p.trait]).filter(function(tk){return tk&&tk!=="none"&&TRAITS[tk]&&TRAITS[tk].icon;}).slice(0,3).map(function(tk,ti){var tO=TRAITS[tk];return <span key={ti} title={tO.name+": "+(tO.desc||"")} style={{fontSize:10,background:"rgba(255,255,255,0.07)",padding:"1px 6px",borderRadius:6,border:"1px solid rgba(255,255,255,0.12)",fontWeight:600}}>{tO.icon+" "+tO.name}</span>;})}
                      </div>

                      <div style={{display:"flex",gap:8,marginTop:6,fontSize:10,color:T.dim,flexWrap:"wrap"}}>
                        {p.college && <span style={{color:T.cyan}}>{"ðŸŽ“ "+p.college.school}</span>}
                        {p.height && <span>{htStr}</span>}
                        {p.weight && <span>{wtStr}</span>}
                        {expYrs>0 && <span>{expYrs+"yr exp"}</span>}
                        {p.isRookie && <span style={{color:T.green}}>{"ROOKIE"}</span>}
                      </div>
                      
                      {p.character75 && <div style={{display:"flex",gap:4,marginTop:4,alignItems:"center",flexWrap:"wrap"}}>
                        <span style={{fontSize:9,padding:"1px 6px",borderRadius:4,background:"rgba(167,139,250,0.12)",color:T.purple,fontWeight:700}}>{p.character75.icon+" "+p.character75.label}</span>
                        <span style={{fontSize:8,color:T.dim}}>{p.character75.desc}</span>
                      </div>}
                      {p.holdout75 && (function(){
                        /* v80: 5-stage holdout badge with escalation colors (credit: Claude â€” Dynasty Experience) */
                        var stg80=holdoutStages80&&holdoutStages80[p.id]||1;
                        var stgColors80=["#fbbf24","#f97316","#ef4444","#dc2626","#7f1d1d"];
                        var stgLabels80=["STAGE 1: NO-SHOW","STAGE 2: STATEMENT","STAGE 3: TRADE DEMAND","STAGE 4: SUSPENDED","STAGE 5: NUCLEAR â˜¢ï¸"];
                        var stgIcons80=["âš ï¸","ðŸ“¢","ðŸ”€","ðŸš«","â˜¢ï¸"];
                        var sc80=stgColors80[stg80-1]||"#ef4444";
                        var sl80=stgLabels80[stg80-1]||"HOLDOUT";
                        var si80=stgIcons80[stg80-1]||"âš ï¸";
                        return React.createElement("div",{style:{marginTop:3,fontSize:9,fontWeight:700,display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},
                          React.createElement("span",{style:{color:sc80,border:"1px solid "+sc80,borderRadius:4,padding:"1px 5px",background:"rgba(0,0,0,0.3)",letterSpacing:"0.3px"}},
                            si80+" "+sl80+" â€” Wk "+(p.holdout75.week||1)),
                          my&&my.roster.some(function(rp){return rp.id===p.id;})&&!holdoutNegot77&&React.createElement("button",{
                            onClick:function(e){e.stopPropagation();var n77=HOLDOUT_NEGOTIATION.start(p);setHoldoutNegot77(n77);},
                            style:assign({},bS(sc80,"#fff"),{padding:"1px 6px",fontSize:8,borderRadius:4})
                          },"ðŸ¤ Negotiate")
                        );
                      })()}
                      
                      {p.injury&&p.injury.games>0&&my&&my.roster.some(function(rp){return rp.id===p.id;})&&!p.injury._rehab78&&<div style={{marginTop:4}}>
                        <div style={{fontSize:8,fontWeight:700,color:T.faint,marginBottom:2}}>{"ðŸ¥ CHOOSE REHAB PLAN"}</div>
                        <div style={{display:"flex",gap:4}}>
                          {REHAB_SYSTEM.options.map(function(opt78){
                            return <button key={opt78.id} onClick={function(e){
                              e.stopPropagation();
                              var nt78=teams.slice();var ut78=nt78.find(function(t){return t.id===myId;});
                              if(!ut78)return;var pp78=ut78.roster.find(function(rp){return rp.id===p.id;});
                              if(!pp78)return;
                              var res78=REHAB_SYSTEM.applyRehab(pp78,opt78.id);
                              if(res78)addN(opt78.icon+" "+res78.text,opt78.id==="aggressive"?"red":opt78.id==="conservative"?"blue":"purple");
                              setTeams(nt78);doSave(nt78);setPlayerDetail(assign({},pp78));
                            }} style={assign({},bS(opt78.color,"#fff"),{padding:"2px 6px",fontSize:7,borderRadius:4})}>
                              {opt78.icon+" "+opt78.label}
                            </button>;
                          })}
                        </div>
                      </div>}
                      {p.injury&&p.injury._rehab78&&<div style={{marginTop:3,fontSize:9,fontWeight:700,color:p.injury._rehab78==="aggressive"?T.red:p.injury._rehab78==="conservative"?"#3b82f6":"#a855f7"}}>
                        {"ðŸ¥ Rehab: "+(p.injury._rehab78||"standard").toUpperCase()+" â€” "+p.injury.games+"wk remaining"}
                      </div>}
                    </div>
                  </div>
                  
                  <div style={{display:"flex",justifyContent:"space-around",padding:"0 20px 14px",gap:4}}>
                    {[
                      {label:"OVR",val:p.ovr,color:ovrColor,glow:ovrGlow},
                      {label:"POT",val:p.pot,color:T.cyan,glow:"none"},
                      {label:"MRL",val:p.morale||70,color:(p.morale||70)>=70?T.green:(p.morale||70)>=45?T.orange:T.red,glow:"none"},
                      p.pff?{label:"MFDF",val:p.pff,color:p.pff>=85?"#10b981":p.pff>=75?"#22d3ee":p.pff>=60?"#fbbf24":"#ef4444",glow:"none"}:null
                    ].filter(Boolean).map(function(g){
                      return <div key={g.label} style={{textAlign:"center",flex:1}}>
                        <div style={{fontSize:28,fontWeight:900,color:g.color,lineHeight:1,textShadow:g.glow}}>{g.val}</div>
                        <div style={{fontSize:8,color:T.faint,fontWeight:700,letterSpacing:1.5,marginTop:2}}>{g.label}</div>
                      </div>;
                    })}
                  </div>
                  
                  <div style={{position:"absolute",top:8,right:12}}>
                    <span style={{fontSize:9,fontWeight:700,padding:"2px 8px",borderRadius:10,
                      background:p.devTrait==="superstar"?"rgba(251,191,36,0.2)":p.devTrait==="star"?"rgba(34,211,238,0.15)":"rgba(255,255,255,0.05)",
                      color:p.devTrait==="superstar"?T.gold:p.devTrait==="star"?T.cyan:T.faint,
                      border:"1px solid "+(p.devTrait==="superstar"?T.gold+"44":p.devTrait==="star"?T.cyan+"44":"transparent")}}>
                      {p.devTrait==="superstar"?"ðŸŒŸ Superstar":p.devTrait==="star"?"â­ Star":"Normal"}
                    </span>
                  </div>
                </div>
                
                <div style={{padding:"14px 20px",borderTop:"1px solid "+T.border,borderBottom:"1px solid "+T.border}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
                    <div style={{fontSize:9,color:T.gold,fontWeight:700,letterSpacing:1.5}}>{"ATTRIBUTES ("+def.r.length+")"}</div>
                    <div style={{fontSize:8,color:T.faint}}>{p.pos+" â€¢ "+Object.keys(def.cat||{}).join(" | ")}</div>
                  </div>
                  
                  {(function(){
                    var cats=def.cat||{ALL:def.r};
                    return Object.keys(cats).map(function(catName){
                      var catRatings=cats[catName];
                      return <div key={catName} style={{marginBottom:10}}>
                        <div style={{fontSize:8,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:4,paddingBottom:2,borderBottom:"1px solid "+T.purple+"20"}}>{catName}</div>
                        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2px 12px"}}>
                          {catRatings.map(function(r){
                            var val=p.ratings[r]||50;
                            var barColor=val>=85?"#10b981":val>=75?"#22d3ee":val>=65?"#fbbf24":val>=50?"#f97316":"#ef4444";
                            var isCore=def.r.indexOf(r)<5;// First 5 are legacy core
                            return <div key={r} style={{display:"flex",alignItems:"center",gap:4,marginBottom:1}}>
                              <div style={{width:28,fontSize:8,color:isCore?T.gold:T.dim,fontWeight:isCore?700:500}}>{RATING_LABELS[r]||r.slice(0,3)}</div>
                              <div style={{flex:1,height:7,background:T.bg3,borderRadius:4,overflow:"hidden"}}>
                                <div style={{width:val+"%",height:"100%",background:"linear-gradient(90deg, "+barColor+"cc, "+barColor+")",borderRadius:4}} />
                              </div>
                              <div style={{width:24,textAlign:"right",fontWeight:700,fontSize:10,color:barColor}}>{val}</div>
                            </div>;
                          })}
                        </div>
                      </div>;
                    });
                  })()}
                </div>
                
                {cs.ovrHistory && cs.ovrHistory.length>1 && (function(){
                  var hist=cs.ovrHistory;
                  var peakOvr=Math.max.apply(null,hist);var lowestOvr=Math.min.apply(null,hist);
                  var range=Math.max(peakOvr-lowestOvr,10);// min 10-point range
                  var barW=Math.floor(280/hist.length);
                  var peakIdx=hist.indexOf(peakOvr);
                  return <div style={{padding:"10px 20px",borderBottom:"1px solid "+T.border}}>
                    <div style={{fontSize:9,color:T.gold,fontWeight:700,letterSpacing:1.5,marginBottom:6}}>{"ðŸ“ˆ CAREER ARC"}</div>
                    <div style={{display:"flex",alignItems:"flex-end",gap:1,height:40,marginBottom:4}}>
                      {hist.map(function(ovr,si){
                        var h=Math.max(4,Math.round(((ovr-lowestOvr+5)/range)*35));
                        var barColor=ovr>=85?"#10b981":ovr>=75?"#22d3ee":ovr>=65?"#fbbf24":"#f97316";
                        return <div key={si} title={"Season "+(si+1)+": "+ovr+" OVR"} style={{width:Math.max(barW,8),maxWidth:20,height:h,background:si===peakIdx?"linear-gradient(180deg, "+T.gold+", "+barColor+")":barColor,
                          borderRadius:"2px 2px 0 0",opacity:si===hist.length-1?1:0.7,cursor:"default"}}></div>;
                      })}
                    </div>
                    <div style={{display:"flex",justifyContent:"space-between",fontSize:8,color:T.faint}}>
                      <span>{"S1: "+hist[0]}</span>
                      <span style={{color:T.gold,fontWeight:700}}>{"Peak: "+peakOvr+" (S"+(peakIdx+1)+")"}</span>
                      <span>{"Now: "+hist[hist.length-1]}</span>
                    </div>
                  </div>;
                })()}
                
                {p.scouting && (function(){
                  var sc=p.scouting;var tier=confTier(sc.confidence);var cCol=confColor(sc.confidence);
                  var confPct=Math.round(sc.confidence*100);
                  var rpt=getScoutRpt(tier,p.ovr);
                  var rptText=rpt.t.replace(/\{player\.name\}/g,p.name).replace(/\{player\.pos\}/g,p.pos).replace(/\{player\.age\}/g,String(p.age||"?"))
                    .replace(/\{player\.college\.school\}/g,(p.college||{}).school||"Unknown")
                    .replace(/\{range\.min\}/g,String(p.scoutRange?p.scoutRange.min:"?")).replace(/\{range\.max\}/g,String(p.scoutRange?p.scoutRange.max:"?"))
                    .replace(/\{topRating\}/g,def.r[0]||"athleticism").replace(/\{weakRating\}/g,def.r[def.r.length-1]||"durability")
                    .replace(/\{scout\.name\}/g,(my.scouts&&my.scouts[0])?my.scouts[0].name:"Scout");
                  var reporter=rpt.r==="rex"?"Rex Buckley":rpt.r==="dana"?"Dana Sharpe":"Scout Report";
                  return <div style={{padding:"12px 20px",borderBottom:"1px solid "+T.border,background:"rgba(167,139,250,0.03)"}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                      <div style={{fontSize:9,color:"#a78bfa",fontWeight:700,letterSpacing:1.5}}>{"ðŸ” SCOUTING INTEL"}</div>
                      <div style={{display:"flex",alignItems:"center",gap:6}}>
                        <div style={{width:50,height:6,background:T.bg3,borderRadius:3,overflow:"hidden"}}>
                          <div style={{width:confPct+"%",height:"100%",background:cCol,borderRadius:3}}></div>
                        </div>
                        <span style={{fontSize:10,fontWeight:700,color:cCol}}>{tier.toUpperCase()+" ("+confPct+"%)"}</span>
                      </div>
                    </div>
                    
                    <div style={{fontSize:11,color:T.dim,fontStyle:"italic",marginBottom:6,lineHeight:1.4}}>
                      {"\""+rptText+"\""}
                    </div>
                    <div style={{fontSize:9,color:T.faint,textAlign:"right"}}>{"â€” "+reporter}</div>
                    {sc.events&&sc.events.length>0&&<div style={{fontSize:9,color:T.faint,marginTop:4}}>
                      {"Events: "+sc.events.join(", ")}
                    </div>}
                    {sc.isRookie&&<div style={{fontSize:9,color:"#f59e0b",marginTop:4,fontWeight:600}}>{"âš ï¸ Rookie â€” high variance (Â±15 OVR). Scout extensively before drafting."}</div>}
                  </div>;
                })()}
                
                <div style={{padding:"12px 20px",borderBottom:"1px solid "+T.border}}>
                  <div style={{fontSize:9,color:T.blue,fontWeight:700,marginBottom:6,letterSpacing:1.5}}>{"CONTRACT"}</div>
                  <div style={{display:"flex",gap:20,fontSize:12,flexWrap:"wrap"}}>
                    <div><span style={{color:T.faint}}>{"Cap Hit "}</span><span style={{fontWeight:800,color:T.green}}>{"$"+v36_capHit(p.contract)+"M"}</span></div>
                    <div><span style={{color:T.faint}}>{"Cash "}</span><span style={{fontWeight:800,color:"#22c55e"}}>{"$"+v36_cashPaid(p.contract)+"M/yr"}</span></div>
                    <div><span style={{color:T.faint}}>{"Years "}</span><span style={{fontWeight:800}}>{p.contract.years}</span></div>
                    {(p.contract.prorated||0)>0 && <div><span style={{color:T.faint}}>{"Bonus "}</span><span style={{fontWeight:800,color:T.orange}}>{"$"+Math.round((p.contract.prorated||0)*10)/10+"M/yr"}</span></div>}
                  </div>
                  
                  {(p.contract.prorated||0)>0 && <div style={{display:"flex",gap:16,fontSize:10,marginTop:6,color:T.dim}}>
                    <span style={{color:"#ef4444"}}>{"âœ‚ï¸ Cut: $"+v36_deadIfCut(p.contract)+"M dead"}</span>
                    <span style={{color:"#f59e0b"}}>{"ðŸ”„ Trade: $"+v36_deadIfTraded(p.contract)+"M dead (save $"+Math.abs(v36_tradeSavings(p.contract))+"M)"}</span>
                  </div>}
                  {/* v95: All traits listed in contract section */}
                  {(p.traits95||[p.trait]).filter(function(tk){return tk&&tk!=="none"&&TRAITS[tk]&&TRAITS[tk].name;}).length>0&&<div style={{marginTop:8,display:"flex",flexDirection:"column",gap:4}}>
                    {(p.traits95||[p.trait]).filter(function(tk){return tk&&tk!=="none"&&TRAITS[tk]&&TRAITS[tk].name;}).slice(0,3).map(function(tk,ti){var tO=TRAITS[tk];return <div key={ti} style={{fontSize:10,color:T.dim,display:"flex",alignItems:"center",gap:4}}>
                      <span style={{fontSize:12}}>{tO.icon}</span>
                      <span style={{fontWeight:700,color:T.text}}>{tO.name}</span>
                      {tO.desc&&<span style={{color:T.faint}}>{"â€” "+tO.desc}</span>}
                    </div>;})}
                  </div>}
                </div>
                
                {godMode && (function(){
                  var editBtn=function(label,onClick){return React.createElement("button",{style:mS(S.btn,{background:"rgba(167,139,250,0.15)",color:T.purple,border:"1px solid rgba(167,139,250,0.3)",padding:"4px 8px",fontSize:9,fontWeight:700}),onClick:onClick},label);};
                  var secBtn=function(label,onClick){return React.createElement("button",{style:mS(S.btn,{background:"rgba(255,255,255,0.04)",color:T.cyan,border:"1px solid "+T.border,padding:"3px 7px",fontSize:8,fontWeight:700}),onClick:onClick},label);};
                  var dangerBtn=function(label,onClick){return React.createElement("button",{style:mS(S.btn,{background:"rgba(239,68,68,0.15)",color:T.red,border:"1px solid rgba(239,68,68,0.3)",padding:"3px 7px",fontSize:8,fontWeight:700}),onClick:onClick},label);};
                  // v98: Find player on ANY team
                  var findPTeam=teams.find(function(t){return t.roster.some(function(x){return x.id===p.id;});});
                  if(!findPTeam)return null;
                  var pers=p.personality||{};
                  var fmtHt=function(h){if(!h)return "?";return Math.floor(h/12)+"'"+h%12+'"';};
                  return React.createElement("div",{style:{padding:"12px 20px",borderBottom:"1px solid rgba(167,139,250,0.3)",background:"rgba(167,139,250,0.04)"}},
                    React.createElement("div",{style:{fontSize:10,color:T.purple,fontWeight:700,marginBottom:4,letterSpacing:1}},"âš¡ GOD MODE â€” FULL PLAYER EDITOR"),
                    React.createElement("div",{style:{fontSize:8,color:T.faint,marginBottom:8}},"On: "+findPTeam.icon+" "+findPTeam.abbr+" â€” Click any field to edit"),
                    
                    /* === ROW 1: IDENTITY === */
                    React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:3}},"IDENTITY"),
                    React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                      editBtn("âœ "+p.name,function(){var v=prompt("Player name:",p.name);if(v){godModeEdit(p.id,"name",v);setPlayerDetail(assign({},p,{name:v}));}}),
                      editBtn("ðŸˆ "+p.pos,function(){var v=prompt("Position (QB/RB/WR/TE/OL/DL/LB/CB/S/K/P):",p.pos);if(v){godModeEdit(p.id,"pos",v);setPlayerDetail(null);}}),
                      editBtn("ðŸŽ‚ Age: "+p.age,function(){var v=prompt("Age (19-45):",p.age);if(v){godModeEdit(p.id,"age",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ“ "+fmtHt(p.height),function(){var v=prompt("Height in inches (e.g. 73 = 6'1\"):",p.height||73);if(v){godModeEdit(p.id,"height",v);setPlayerDetail(null);}}),
                      editBtn("âš–ï¸ "+(p.weight||220)+"lb",function(){var v=prompt("Weight (lbs):",p.weight||220);if(v){godModeEdit(p.id,"weight",v);setPlayerDetail(null);}}),
                      editBtn("ðŸŽ“ "+(p.college?p.college.school||p.college:"?"),function(){var v=prompt("College:",p.college?p.college.school||p.college:"");if(v){godModeEdit(p.id,"college",v);setPlayerDetail(null);}}),
                      editBtn("#"+(p.number||"??"),function(){var v=prompt("Jersey Number:",p.number||"");if(v){godModeEdit(p.id,"number",v);setPlayerDetail(null);}})
                    ),
                    
                    /* === ROW 2: CORE RATINGS === */
                    React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:3}},"RATINGS & DEVELOPMENT"),
                    React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                      editBtn("ðŸ“Š OVR: "+p.ovr,function(){var v=prompt("Overall (35-99):",p.ovr);if(v){godModeEdit(p.id,"ovr",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ“ˆ POT: "+p.pot,function(){var v=prompt("Potential (1-99):",p.pot);if(v){godModeEdit(p.id,"pot",v);setPlayerDetail(null);}}),
                      editBtn("â­ Dev: "+(p.devTrait||"normal"),function(){var v=prompt("Dev Trait (normal/star/superstar):",p.devTrait||"normal");if(v){godModeEdit(p.id,"devTrait",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ˜Š Morale: "+(p.morale||70),function(){var v=prompt("Morale (0-99):",(p.morale||70));if(v){godModeEdit(p.id,"morale",v);setPlayerDetail(null);}}),
                      editBtn(p.isStarter?"â­ Starter":"ðŸ“‹ Backup",function(){godModeEdit(p.id,"isStarter",p.isStarter?"false":"true");setPlayerDetail(null);}),
                      editBtn(p.onTradeBlock?"ðŸ”´ On Block":"Trade Block",function(){godModeEdit(p.id,"tradeBlock",p.onTradeBlock?"false":"true");setPlayerDetail(null);})
                    ),
                    
                    /* === ROW 3: TRAITS === */
                    React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:3}},"TRAITS"),
                    React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                      editBtn(TRAITS[p.trait]?TRAITS[p.trait].icon+" "+TRAITS[p.trait].name:"No Trait",function(){
                        var traitList=Object.keys(TRAITS).map(function(k){return k+" ("+TRAITS[k].name+")";}).join(", ");
                        var v=prompt("Trait ID:\n"+traitList,p.trait||"none");if(v){godModeEdit(p.id,"trait",v);setPlayerDetail(null);}
                      }),
                      p.injury&&p.injury.games>0?editBtn("ðŸ¥ Heal ("+p.injury.games+"wk)",function(){godModeEdit(p.id,"injury","heal");setPlayerDetail(null);}):
                        editBtn("ðŸ¤• Injure",function(){var v=prompt("Injury weeks (1-20):",4);if(v){godModeEdit(p.id,"injury",v);setPlayerDetail(null);}})
                    ),
                    
                    /* === ROW 4: CONTRACT === */
                    React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:3}},"CONTRACT"),
                    React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                      editBtn("ðŸ’° Base: $"+(p.contract.baseSalary||0).toFixed(1)+"M",function(){var v=prompt("Base Salary ($M):",p.contract.baseSalary||p.contract.salary);if(v){godModeEdit(p.id,"salary",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ“… "+p.contract.years+"yr",function(){var v=prompt("Contract years (1-8):",p.contract.years);if(v){godModeEdit(p.id,"years",v);setPlayerDetail(null);}}),
                      editBtn("ðŸŽ Bonus: $"+(p.contract.signingBonus||0).toFixed(1)+"M",function(){var v=prompt("Signing Bonus ($M):",p.contract.signingBonus||0);if(v){godModeEdit(p.id,"signingBonus",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ”’ GTD: $"+(p.contract.guaranteed||0).toFixed(1)+"M",function(){var v=prompt("Guaranteed Money ($M):",p.contract.guaranteed||0);if(v){godModeEdit(p.id,"guaranteed",v);setPlayerDetail(null);}}),
                      secBtn("Cap Hit: $"+calcCapHit(p.contract).toFixed(1)+"M",function(){addN("Cap hit is calculated from base + prorated bonus","info");})
                    ),
                    
                    /* === ROW 5: PERSONALITY (1-10 scales) === */
                    React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:3}},"PERSONALITY (1-10)"),
                    React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                      editBtn("ðŸ’ª Work: "+(pers.workEthic||5),function(){var v=prompt("Work Ethic (1-10):",pers.workEthic||5);if(v){godModeEdit(p.id,"workEthic",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ’™ Loyal: "+(pers.loyalty||5),function(){var v=prompt("Loyalty (1-10):",pers.loyalty||5);if(v){godModeEdit(p.id,"loyalty",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ’° Greed: "+(pers.greed||5),function(){var v=prompt("Greed (1-10):",pers.greed||5);if(v){godModeEdit(p.id,"greed",v);setPlayerDetail(null);}}),
                      editBtn("â­ Clutch: "+(pers.pressure||5),function(){var v=prompt("Clutch / Pressure (1-10):",pers.pressure||5);if(v){godModeEdit(p.id,"pressure",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ”¥ Ambition: "+(pers.ambition||5),function(){var v=prompt("Ambition (1-10):",pers.ambition||5);if(v){godModeEdit(p.id,"ambition",v);setPlayerDetail(null);}})
                    ),
                    
                    /* === ROW 6: INTANGIBLES === */
                    React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:3}},"INTANGIBLES"),
                    React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                      editBtn("ðŸ¤ Chemistry: "+(p.chemistry||60),function(){var v=prompt("Team Chemistry (0-100):",p.chemistry||60);if(v){godModeEdit(p.id,"chemistry",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ“š System Fit: "+(p.systemFit||50),function(){var v=prompt("System Fit (0-100):",p.systemFit||50);if(v){godModeEdit(p.id,"systemFit",v);setPlayerDetail(null);}})
                    ),
                    
                    /* === ROW 7: CAREER ACCOLADES === */
                    React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:3}},"CAREER & ACCOLADES"),
                    React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                      editBtn("ðŸ† Pro Bowls: "+(p.careerStats?p.careerStats.proBowls||0:0),function(){var v=prompt("Pro Bowl selections:",p.careerStats?p.careerStats.proBowls||0:0);if(v){godModeEdit(p.id,"proBowls",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ¥‡ All-Pros: "+(p.careerStats?p.careerStats.allPros||0:0),function(){var v=prompt("All-Pro selections:",p.careerStats?p.careerStats.allPros||0:0);if(v){godModeEdit(p.id,"allPros",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ“Š Draft Yr: "+(p.draftInfo?p.draftInfo.year||"?":"UDFA"),function(){var v=prompt("Draft Year:",p.draftInfo?p.draftInfo.year||2026:2026);if(v){godModeEdit(p.id,"draftYear",v);setPlayerDetail(null);}}),
                      editBtn("ðŸ“‹ Draft Rd: "+(p.draftInfo?p.draftInfo.round||"?":"?"),function(){var v=prompt("Draft Round (1-7):",p.draftInfo?p.draftInfo.round||1:1);if(v){godModeEdit(p.id,"draftRound",v);setPlayerDetail(null);}}),
                      editBtn("ðŸŽ¯ Draft Pick: "+(p.draftInfo?p.draftInfo.pick||"?":"?"),function(){var v=prompt("Draft Pick # (1-32):",p.draftInfo?p.draftInfo.pick||1:1);if(v){godModeEdit(p.id,"draftPick",v);setPlayerDetail(null);}})
                    ),
                    
                    /* === ROW 8: ACTIONS === */
                    React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:3}},"ACTIONS"),
                    React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6}},
                      editBtn("âš”ï¸ Compare",function(){setCompareMode986({p1:assign({},p,{teamAbbr:findPTeam?findPTeam.abbr:"?"}),p2:null});setPlayerDetail(null);setTab("home");}),
                      editBtn("ðŸ§¬ Clone",function(){godModeClonePlayer(findPTeam.id,p.id);}),
                      editBtn("âœˆï¸ Move",function(){var dest=prompt("Move "+p.name+" to team (abbr):",my.abbr);if(!dest)return;var destT=teams.find(function(t){return t.abbr.toLowerCase()===dest.toLowerCase();});if(destT){godModeMovePlayer(p.id,findPTeam.id,destT.id);setPlayerDetail(null);}else addN("Team not found: "+dest,"red");}),
                      findPTeam.id!==myId&&editBtn("âš¡ Steal",function(){godModeStealPlayer(findPTeam.id,p.id);setPlayerDetail(null);}),
                      dangerBtn("ðŸ—‘ Reset Season Stats",function(){if(confirm("Clear "+p.name+"'s season stats?")){godModeEdit(p.id,"resetStats","1");setPlayerDetail(null);}}),
                      dangerBtn("ðŸ—‘ Reset Career Stats",function(){if(confirm("Clear "+p.name+"'s ENTIRE career stats?")){godModeEdit(p.id,"resetCareer","1");setPlayerDetail(null);}}),
                      dangerBtn("ðŸšª Force Retire",function(){if(confirm("Force retire "+p.name+"?")){godModeForceRetire(findPTeam.id,p.id);}})
                    ),
                    
                    /* === INDIVIDUAL RATINGS (existing) === */
                    React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginTop:4,marginBottom:3}},"INDIVIDUAL RATINGS ("+def.r.length+" attributes)"),
                    (function(){
                      var cats=def.cat||{ALL:def.r};
                      return Object.keys(cats).map(function(catName){
                        return React.createElement("div",{key:catName,style:{marginBottom:6}},
                          React.createElement("div",{style:{fontSize:7,color:T.purple,fontWeight:700,letterSpacing:1,marginBottom:2}},catName),
                          React.createElement("div",{style:{display:"flex",gap:3,flexWrap:"wrap"}},
                            cats[catName].map(function(r){
                              var val=p.ratings[r]||50;
                              var rColor=val>=80?T.green:val>=65?T.gold:val>=50?T.orange:T.red;
                              return React.createElement("button",{key:r,style:mS(S.btn,{background:"rgba(255,255,255,0.04)",border:"1px solid "+rColor+"44",color:rColor,padding:"2px 5px",fontSize:7,fontWeight:700}),
                                onClick:function(){var v=prompt((RATING_LABELS[r]||r)+" ("+r+") rating (1-99):",val);if(v){godModeEdit(p.id,"rating",r+":"+v);setPlayerDetail(null);}}},
                                (RATING_LABELS[r]||r.slice(0,4))+": "+val);
                            })
                          )
                        );
                      });
                    })(),
                    React.createElement("div",{style:{fontSize:8,color:T.faint,marginTop:6}},"Changes save instantly. Close & reopen to refresh displayed values.")
                  );
                })()}
                
                <div style={{padding:"12px 20px",borderBottom:"1px solid "+T.border}}>
                  <div style={{fontSize:9,color:T.green,fontWeight:700,marginBottom:8,letterSpacing:1.5}}>{"THIS SEASON"}</div>
                  <div style={{display:"flex",gap:16,marginBottom:6,fontSize:12}}>
                    <div style={{display:"flex",gap:4,alignItems:"baseline"}}><span style={{fontSize:20,fontWeight:900}}>{p.stats.gp||0}</span><span style={{fontSize:9,color:T.faint}}>{"GP"}</span></div>
                    <div style={{display:"flex",gap:4,alignItems:"baseline"}}><span style={{fontSize:20,fontWeight:900}}>{p.stats.snaps||0}</span><span style={{fontSize:9,color:T.faint}}>{"SNAPS"}</span></div>
                    {p.isStarter && <span style={{fontSize:9,fontWeight:700,color:T.green,background:"rgba(16,185,129,0.12)",padding:"2px 8px",borderRadius:4,alignSelf:"center"}}>{"STARTER"}</span>}
                  </div>
                  <div style={{fontSize:13,fontWeight:700,color:T.text,padding:"6px 10px",background:"rgba(255,255,255,0.03)",borderRadius:6,borderLeft:"3px solid "+T.green}}>{seasonLine}</div>
                  {(p.pos==="WR"||p.pos==="TE")&&p.stats.targets>0 && <div style={{fontSize:10,color:T.dim,marginTop:4}}>
                    {"Targets:"+p.stats.targets+" | Drops:"+p.stats.drops+" | YAC:"+p.stats.yac}
                  </div>}
                  {p.pos==="OL"&&(p.stats.sacksAllowed||0)>0 && <div style={{fontSize:10,color:T.red,marginTop:4}}>
                    {"Sacks Allowed: "+p.stats.sacksAllowed}
                  </div>}
                </div>
                
                <div style={{padding:"12px 20px",borderBottom:"1px solid "+T.border}}>
                  <div style={{fontSize:9,color:T.purple,fontWeight:700,marginBottom:8,letterSpacing:1.5}}>{"CAREER"}</div>
                  <div style={{display:"flex",gap:12,marginBottom:6,fontSize:12,flexWrap:"wrap",alignItems:"center"}}>
                    <div style={{display:"flex",gap:4,alignItems:"baseline"}}><span style={{fontSize:18,fontWeight:900}}>{cs.seasons||0}</span><span style={{fontSize:9,color:T.faint}}>{"YRS"}</span></div>
                    <div style={{display:"flex",gap:4,alignItems:"baseline"}}><span style={{fontSize:18,fontWeight:900}}>{cs.gp||0}</span><span style={{fontSize:9,color:T.faint}}>{"GP"}</span></div>
                    {(cs.rings||0)>0 && <span style={{fontSize:12,fontWeight:800,color:T.gold}}>{"ðŸ’Ã—"+cs.rings}</span>}
                    {(cs.mvps||0)>0 && <span style={{fontSize:12,fontWeight:800,color:T.gold}}>{"ðŸ†Ã—"+cs.mvps}</span>}
                    {(cs.allPros||0)>0 && <span style={{fontSize:12,fontWeight:800,color:T.cyan}}>{"â­Ã—"+cs.allPros}</span>}
                  </div>
                  <div style={{fontSize:13,fontWeight:700,color:T.text,padding:"6px 10px",background:"rgba(255,255,255,0.03)",borderRadius:6,borderLeft:"3px solid "+T.purple}}>{careerLine}</div>
                </div>
                
                {p.injury&&p.injury.games>0 && <div style={{padding:"10px 20px",borderBottom:"1px solid "+T.border,background:"rgba(239,68,68,0.06)"}}>
                  <div style={{fontSize:11,color:T.red,fontWeight:700}}>{(function(){var injMask92=getInjuryMask92(p,my);return "ðŸ¤• "+injMask92.type+" â€” "+injMask92.status;})()}</div>
                </div>}
                
                {p.college && (p.college.passYds||p.college.rushYds||p.college.rec||p.college.starts) && (
                  <div style={{padding:"12px 20px",borderBottom:"1px solid "+T.border}}>
                    <div style={{fontSize:9,color:T.cyan,fontWeight:700,marginBottom:6,letterSpacing:1.5}}>{"COLLEGE â€” "+p.college.school.toUpperCase()}</div>
                    <div style={{display:"flex",gap:12,fontSize:11,flexWrap:"wrap"}}>
                      {p.college.passYds && <span><span style={{color:T.faint}}>{"Pass "}</span><span style={{fontWeight:700}}>{p.college.passYds+"yd "+p.college.passTD+"TD "+p.college.int+"INT "+p.college.comp+"%"}</span></span>}
                      {p.college.rushYds && <span><span style={{color:T.faint}}>{"Rush "}</span><span style={{fontWeight:700}}>{p.college.rushYds+"yd "+p.college.rushTD+"TD "+p.college.ypc+"ypc"}</span></span>}
                      {p.college.rec && <span><span style={{color:T.faint}}>{"Rec "}</span><span style={{fontWeight:700}}>{p.college.rec+"rec "+p.college.recYds+"yd "+p.college.recTD+"TD"}</span></span>}
                      {p.college.starts && <span><span style={{color:T.faint}}>{"Starts "}</span><span style={{fontWeight:700}}>{p.college.starts}</span>{p.college.awards&&p.college.awards!=="None" && <span style={{color:T.gold,marginLeft:4}}>{" "+p.college.awards}</span>}</span>}
                    </div>
                    {p.combine && <div style={{display:"flex",gap:10,fontSize:10,color:T.dim,marginTop:4}}>
                      <span>{"40: "+p.combine.forty+"s"}</span>
                      <span>{"Bench: "+p.combine.bench}</span>
                      <span>{"Vert: "+p.combine.vertical+'"'}</span>
                      <span>{"Shuttle: "+p.combine.shuttle+"s"}</span>
                    </div>}
                  </div>
                )}
                
                {(function(){
                  var tags=[];
                  var phase=getAgingPhase(p);
                  tags.push({icon:phase.label.split(" ")[0],text:phase.tip,color:phase.color});
                  // v95.6: hasTrait95 for player card trait tags
                  if(hasTrait95(p,"captain"))tags.push({icon:"Â©ï¸",text:"Team Captain â€” locker room leader",color:T.gold});
                  if(hasTrait95(p,"clutch"))tags.push({icon:"â„ï¸",text:"Ice in Veins â€” performs under pressure",color:T.cyan});// v95.6
                  if(hasTrait95(p,"cancer"))tags.push({icon:"â˜¢ï¸",text:"Locker Room Cancer â€” hurts team morale",color:T.red});
                  if(hasTrait95(p,"ironman"))tags.push({icon:"ðŸ¦¾",text:"Ironman â€” rarely misses time",color:T.green});
                  if(hasTrait95(p,"glass"))tags.push({icon:"ðŸ”®",text:"Made of Glass â€” always hurt",color:T.red});
                  if(hasTrait95(p,"workhorse"))tags.push({icon:"ðŸ´",text:"Workhorse â€” extra development gains",color:T.green});
                  if(p.devTrait==="superstar")tags.push({icon:"ðŸŒŸ",text:"Generational Talent",color:T.gold});
                  if((cs.rings||0)>=2)tags.push({icon:"ðŸ’",text:"Dynasty Builder â€” "+cs.rings+" rings",color:T.gold});
                  else if((cs.rings||0)>=1)tags.push({icon:"ðŸ’",text:"Champion",color:T.gold});
                  if((cs.mvps||0)>=1)tags.push({icon:"ðŸ†",text:"League MVP"+((cs.mvps>1)?"Ã—"+cs.mvps:""),color:T.gold});
                  if((cs.allPros||0)>=1)tags.push({icon:"â­",text:"All-ProÃ—"+(cs.allPros),color:T.gold});
                  if((cs.proBowls||0)>=1)tags.push({icon:"ðŸˆ",text:"Pro BowlÃ—"+(cs.proBowls),color:T.cyan});
                  if(p.pff&&p.pff>=85)tags.push({icon:"ðŸ“Š",text:"MFDF Elite ("+p.pff+")",color:"#10b981"});
                  else if(p.pff&&p.pff>=75)tags.push({icon:"ðŸ“Š",text:"MFDF High Grade ("+p.pff+")",color:"#22d3ee"});
                  if((cs.seasons||0)>=8)tags.push({icon:"ðŸŽ–ï¸",text:"Franchise Legend â€” "+(cs.seasons)+" seasons",color:T.purple});
                  else if((cs.seasons||0)>=5)tags.push({icon:"ðŸ“œ",text:"Established Veteran",color:T.dim});
                  if(p.formerTeam)tags.push({icon:"ðŸ”¥",text:"Revenge Game eligible â€” ex-"+p.formerTeamName,color:T.red});
                  if(p.udfaSleeper)tags.push({icon:"ðŸ’Ž",text:"Undrafted Gem â€” rose from nothing",color:T.cyan});
                  if(p.ovr>=90)tags.push({icon:"ðŸ‘‘",text:"Generational â€” Top of the game",color:T.gold});
                  else if(p.ovr>=82)tags.push({icon:"â­",text:"Elite â€” true difference maker",color:T.green});
                  else if(p.ovr<55)tags.push({icon:"ðŸª‘",text:"Roster Bubble â€” fighting for a spot",color:T.red});
                  return tags.length>0?<div style={{padding:"10px 20px",borderBottom:"1px solid "+T.border}}>
                    <div style={{fontSize:10,color:T.orange,fontWeight:700,marginBottom:6,letterSpacing:1}}>{"STORYLINES"}</div>
                    <div style={{display:"flex",flexWrap:"wrap",gap:4}}>
                      {tags.slice(0,6).map(function(tag,ti){
                        return <span key={ti} style={{display:"inline-flex",alignItems:"center",gap:3,padding:"3px 8px",borderRadius:12,fontSize:9,fontWeight:600,
                          background:"rgba(255,255,255,0.05)",border:"1px solid "+tag.color+"33",color:tag.color}}>
                          <span>{tag.icon}</span><span>{tag.text}</span>
                        </span>;
                      })}
                    </div>
                  </div>:null;
                })()}
                
                <div style={{padding:"8px 20px",borderBottom:"1px solid "+T.border}}>
                  <button onClick={function(e){e.stopPropagation();shopPlayer(p);}} style={mS(S.btn,S.btnPrimary,{width:"100%",padding:10})}>{"ðŸ›’ Shop "+p.name}</button>
                  {shopOffers.length>0 && <div style={{marginTop:8}}>
                    <div style={{fontSize:10,fontWeight:800,color:T.gold,marginBottom:6}}>{"ðŸ“Š OFFERS RECEIVED"}</div>
                    {shopOffers.map(function(off,oi){
                      var pickStr=off.picks.map(function(pk){return "Rd"+pk.round+(pk.year?" '"+String(pk.year).slice(2):"");}).join(", ");
                      var plStr=off.players.map(function(pl){return pl.name+" ("+pl.pos+" "+pl.ovr+")";}).join(", ");
                      var offerStr=[pickStr,plStr].filter(Boolean).join(" + ");
                      return React.createElement("div",{key:oi,style:mS(S.card,{padding:10,marginBottom:6,cursor:"pointer",borderColor:T.gold}),
                        onClick:function(e){e.stopPropagation();
                          setTTI(off.team.id);setTMP([p.id]);setTAP(off.players.map(function(pl){return pl.id;}));
                          setTMPk([]);setTAPk([]);setTMyPkCond972({});setTAiPkCond972({});setTMsg("");setPlayerDetail(null);setTab("trade");setShopOffers([]);
                        }},
                        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
                          React.createElement(TeamLogo,{team:off.team,size:22}),
                          React.createElement("div",null,
                            React.createElement("div",{style:{fontWeight:700,fontSize:11}},off.team.abbr+" offers:"),
                            React.createElement("div",{style:{fontSize:10,color:T.cyan}},offerStr||"No valid package")
                          )
                        )
                      );
                    })}
                  </div>}
                </div>
                
                <div style={{padding:"12px 20px"}}>
                  <button onClick={function(){setPlayerDetail(null);setShopOffers([]);}} style={mS(S.btn,S.btnGhost,{width:"100%",padding:10})}>{"Close"}</button>
                </div>
              </div>
            </div>;
          })()}
          
          {holdoutNegot77 && (function(){
            var hn=holdoutNegot77;
            var styleLbl=HOLDOUT_NEGOTIATION.getStyleDesc(hn.agentStyle);
            var roundColors=["#fbbf24","#f97316","#ef4444"];
            var foHoldoutBonus=frontOffice78?FRONT_OFFICE.getBonus(frontOffice78,"holdouts"):0;
            var foAcceptBoost=Math.round(foHoldoutBonus*10);
            var stg80=holdoutStages80&&holdoutStages80[hn.playerId]||1;
            var stageLabels=["","Grumbling","Frustrated","Demanding","Threatening","Holdout"];
            var stageColors=["",T.dim,T.orange,T.orange,T.red,T.red];
            var sliderId="holdoutSlider81_"+hn.playerId;
            var sliderMin=Math.round(hn.demand*0.5*10)/10;
            var sliderMax=Math.round(hn.demand*1.2*10)/10;
            var sliderDefault=Math.round(hn.demand*0.8*10)/10;
            return React.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.92)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:110,padding:10},
              onClick:function(){if(hn.resolved)setHoldoutNegot77(null);}},
              React.createElement("div",{style:{width:"100%",maxWidth:400,background:T.bg2,borderRadius:16,overflow:"hidden",border:"1px solid "+T.gold+"44",boxShadow:"0 8px 32px rgba(0,0,0,0.6)"},
                onClick:function(e){e.stopPropagation();}},
                React.createElement("div",{style:{background:"linear-gradient(135deg, rgba(239,68,68,0.15), rgba(251,191,36,0.1))",padding:"16px 20px",borderBottom:"1px solid "+T.border}},
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                    React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:16,fontWeight:900,color:"#fff"}},"\ud83e\udd1d Contract Negotiation"),
                      React.createElement("div",{style:{fontSize:11,color:T.dim,marginTop:2}},hn.playerName+" ("+hn.playerPos+" "+hn.playerOvr+" OVR)")
                    ),
                    stg80>1?React.createElement("div",{style:{padding:"4px 10px",borderRadius:8,background:stageColors[stg80]+"15",border:"1px solid "+stageColors[stg80]+"44"}},
                      React.createElement("div",{style:{fontSize:8,fontWeight:800,color:stageColors[stg80]}},stageLabels[stg80]),
                      React.createElement("div",{style:{fontSize:7,color:T.faint}},"Stage "+stg80+"/5")
                    ):null
                  )
                ),
                React.createElement("div",{style:{padding:"12px 20px",borderBottom:"1px solid "+T.border+"55"}},
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                    React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:12,fontWeight:800,color:"#fff"}},"\ud83d\udd74\ufe0f Agent: "+hn.agentName),
                      React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:2,fontStyle:"italic"}},styleLbl)
                    ),
                    React.createElement("div",{style:{textAlign:"right"}},
                      React.createElement("div",{style:{fontSize:9,color:T.faint}},"Style"),
                      React.createElement("div",{style:{fontSize:11,fontWeight:700,color:hn.agentStyle==="shark"?T.red:hn.agentStyle==="emotional"?T.orange:hn.agentStyle==="patient"?T.cyan:T.green}},hn.agentStyle.toUpperCase())
                    )
                  ),
                  foAcceptBoost>0?React.createElement("div",{style:{marginTop:6,padding:"4px 8px",borderRadius:6,background:"rgba(34,211,238,0.08)",border:"1px solid "+T.cyan+"33",fontSize:8,color:T.cyan}},
                    "\ud83c\udfaf FO Player Relations: +"+foAcceptBoost+"% acceptance chance"
                  ):null
                ),
                React.createElement("div",{style:{padding:"10px 20px",display:"flex",gap:6,alignItems:"center"}},
                  React.createElement("span",{style:{fontSize:10,color:T.faint,fontWeight:700}},"ROUND"),
                  [1,2,3].map(function(r77){
                    var isDone=r77<hn.round;
                    var isCurrent=r77===hn.round&&!hn.resolved;
                    return React.createElement("div",{key:r77,style:{width:28,height:28,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:900,
                      background:isDone?"rgba(34,197,94,0.2)":isCurrent?"rgba(251,191,36,0.2)":"rgba(255,255,255,0.05)",
                      color:isDone?T.green:isCurrent?T.gold:T.faint,
                      border:"2px solid "+(isDone?T.green+"66":isCurrent?T.gold+"66":"transparent")}},r77);
                  }),
                  hn.resolved?React.createElement("span",{style:{fontSize:10,fontWeight:800,marginLeft:8,color:hn.result==="accepted"?T.green:T.red}},hn.result==="accepted"?"\u2705 DEAL DONE":"\u274c TALKS COLLAPSED"):null,
                  !hn.resolved&&stg80>=3?React.createElement("span",{style:{fontSize:8,color:T.red,marginLeft:8,fontWeight:700}},"\u26a0\ufe0f Patience running out!"):null
                ),
                hn.history.length>0?React.createElement("div",{style:{padding:"0 20px 10px"}},
                  hn.history.map(function(h77,i77){
                    return React.createElement("div",{key:i77,style:{display:"flex",justifyContent:"space-between",padding:"6px 10px",borderRadius:8,marginBottom:4,background:"rgba(255,255,255,0.03)",fontSize:10}},
                      React.createElement("span",{style:{color:T.dim}},"Round "+h77.round),
                      React.createElement("span",{style:{color:T.cyan}},"Your offer: $"+h77.offer+"M"),
                      React.createElement("span",{style:{color:T.orange}},"Demand: $"+h77.demand+"M")
                    );
                  })
                ):null,
                !hn.resolved?React.createElement("div",{style:{padding:"10px 20px 16px"}},
                  React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
                    React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:9,color:T.faint,fontWeight:700}},"AGENT DEMAND"),
                      React.createElement("div",{style:{fontSize:22,fontWeight:900,color:T.gold}},"$"+hn.demand+"M"),
                      React.createElement("div",{style:{fontSize:8,color:T.dim}},"per year")
                    ),
                    React.createElement("div",{style:{textAlign:"right"}},
                      React.createElement("div",{style:{fontSize:9,color:T.faint,fontWeight:700}},"YOUR OFFER"),
                      React.createElement("div",{id:"holdoutOfferDisplay81",style:{fontSize:22,fontWeight:900,color:T.cyan}},"$"+sliderDefault+"M"),
                      React.createElement("div",{style:{fontSize:8,color:T.dim}},"per year")
                    )
                  ),
                  React.createElement("div",{style:{marginBottom:12}},
                    React.createElement("input",{id:sliderId,type:"range",min:sliderMin*10,max:sliderMax*10,defaultValue:sliderDefault*10,step:1,
                      style:{width:"100%",accentColor:T.cyan},
                      onChange:function(e){var disp=document.getElementById("holdoutOfferDisplay81");if(disp)disp.textContent="$"+(parseInt(e.target.value)/10).toFixed(1)+"M";}
                    }),
                    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:8,color:T.faint}},
                      React.createElement("span",null,"$"+sliderMin+"M (lowball)"),
                      React.createElement("span",null,"$"+sliderMax+"M (overpay)")
                    )
                  ),
                  React.createElement("div",{style:{padding:"6px 10px",borderRadius:8,background:"rgba(255,255,255,0.03)",marginBottom:10,fontSize:9,color:T.dim,textAlign:"center"}},
                    "Acceptance depends on offer ratio, agent style, and round"+(foAcceptBoost>0?" (+"+foAcceptBoost+"% FO bonus)":"")
                  ),
                  React.createElement("button",{onClick:function(){
                    var slider=document.getElementById(sliderId);
                    var val=slider?parseInt(slider.value)/10:0;
                    if(!val||val<=0){return;}
                    var updated=HOLDOUT_NEGOTIATION.respond(hn,val);
                    if(!updated.resolved&&foHoldoutBonus>0){
                      var ratio=val/hn.demand;
                      if(ratio>=0.85&&RNG.ai()<foHoldoutBonus*0.1){
                        updated.resolved=true;updated.result="accepted";updated.finalSalary=Math.round(val*10)/10;
                      }
                    }
                    setHoldoutNegot77(updated);
                    if(updated.resolved&&updated.result==="accepted"){
                      var nt77=teams.slice();
                      var ut77=nt77.find(function(t){return t.id===myId;});
                      if(ut77){
                        var hp77=ut77.roster.find(function(rp){return rp.id===updated.playerId;});
                        if(hp77){
                          hp77.contract=makeContract(updated.finalSalary,cl(Math.round(updated.finalSalary/2)+1,1,5),0,0);
                          HOLDOUT_SYSTEM.resolve(hp77);
                          ut77.capUsed=capCalc(ut77.roster);
                          setTeams(nt77);
                          addN("\u2705 "+updated.playerName+" signs for $"+updated.finalSalary+"M/yr! Holdout over.","green");
                          setHoldoutStages80(function(prev){var u=assign({},prev);delete u[updated.playerId];return u;});
                        }
                      }
                    } else if(updated.resolved&&updated.result==="failed"){
                      setHoldoutStages80(function(prev){var u=assign({},prev);u[hn.playerId]=Math.min(5,(u[hn.playerId]||1)+1);return u;});
                      addN("\ud83d\ude24 "+hn.playerName+"'s holdout escalates to Stage "+Math.min(5,(stg80||1)+1)+"!","red");
                    }
                  },style:assign({},bS(T.gold,"#000"),{width:"100%",padding:"10px",fontSize:13,fontWeight:900,borderRadius:10})},"\ud83d\udcb0 Submit Offer \u2014 Round "+hn.round+" of 3")
                ):null,
                hn.resolved?React.createElement("div",{style:{padding:"10px 20px 16px"}},
                  hn.result==="accepted"?React.createElement("div",{style:{textAlign:"center",padding:16,background:"rgba(34,197,94,0.08)",borderRadius:12,marginBottom:10}},
                    React.createElement("div",{style:{fontSize:28}},"\ud83c\udf89"),
                    React.createElement("div",{style:{fontSize:14,fontWeight:900,color:T.green,marginTop:4}},"DEAL ACCEPTED!"),
                    React.createElement("div",{style:{fontSize:12,color:T.dim,marginTop:4}},hn.playerName+" signs for $"+hn.finalSalary+"M/yr")
                  ):null,
                  hn.result==="failed"?React.createElement("div",{style:{textAlign:"center",padding:16,background:"rgba(239,68,68,0.08)",borderRadius:12,marginBottom:10}},
                    React.createElement("div",{style:{fontSize:28}},"\ud83d\ude24"),
                    React.createElement("div",{style:{fontSize:14,fontWeight:900,color:T.red,marginTop:4}},"NEGOTIATIONS FAILED"),
                    React.createElement("div",{style:{fontSize:12,color:T.dim,marginTop:4}},hn.agentName+" walks away. "+hn.playerName+" remains unhappy."),
                    stg80>=4?React.createElement("div",{style:{fontSize:10,color:T.red,marginTop:6,fontWeight:700}},"\u26a0\ufe0f Player may demand a trade if holdout continues!"):null
                  ):null,
                  React.createElement("button",{onClick:function(){setHoldoutNegot77(null);},style:assign({},bS(T.bg3,T.dim),{width:"100%",padding:10,fontSize:12,borderRadius:10})},"Close")
                ):null
              )
            );
          })()}
          
          {boxScore && (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,padding:10}}
              onClick={function(){setBoxScore(null);}}>
              <div style={{width:"100%",maxWidth:420,background:T.bg2,borderRadius:12,overflow:"hidden",maxHeight:"90vh",overflowY:"auto"}}
                onClick={function(e){e.stopPropagation();}}>
                
                <div style={{background:T.bg3,padding:"16px 20px",borderBottom:"1px solid "+T.border}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:4}}>
                      {boxScore.hTeam&&React.createElement(TeamLogo,{team:boxScore.hTeam,size:40})}
                      <div style={{fontWeight:800,fontSize:12}}>{boxScore.hTeam?boxScore.hTeam.abbr:"HOME"}</div>
                    </div>
                    <div style={{textAlign:"center"}}>
                      <div style={{fontSize:9,color:T.faint,letterSpacing:2}}>{"FINAL"}</div>
                      <div style={{fontSize:32,fontWeight:900,letterSpacing:2}}>{boxScore.result.home+" - "+boxScore.result.away}</div>
                    </div>
                    <div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:4}}>
                      {boxScore.aTeam&&React.createElement(TeamLogo,{team:boxScore.aTeam,size:40})}
                      <div style={{fontWeight:800,fontSize:12}}>{boxScore.aTeam?boxScore.aTeam.abbr:"AWAY"}</div>
                    </div>
                  </div>
                </div>
                
                {boxScore.result.qtrs && (
                  <div style={{padding:"10px 20px",borderBottom:"1px solid "+T.border}}>
                    <table style={{width:"100%",borderCollapse:"collapse",fontSize:12}}>
                      <thead><tr style={{color:T.faint,fontSize:10}}>
                        <th style={{textAlign:"left",padding:4}}>{"TEAM"}</th>
                        <th style={{textAlign:"center",padding:4,width:30}}>{"Q1"}</th>
                        <th style={{textAlign:"center",padding:4,width:30}}>{"Q2"}</th>
                        <th style={{textAlign:"center",padding:4,width:30}}>{"Q3"}</th>
                        <th style={{textAlign:"center",padding:4,width:30}}>{"Q4"}</th>
                        <th style={{textAlign:"center",padding:4,width:36,fontWeight:800}}>{"T"}</th>
                      </tr></thead>
                      <tbody>
                        <tr style={{borderTop:"1px solid "+T.border}}>
                          <td style={{padding:4,fontWeight:700}}>{boxScore.hTeam?boxScore.hTeam.abbr:"H"}</td>
                          {boxScore.result.qtrs.h.map(function(q,qi){return <td key={qi} style={{textAlign:"center",padding:4}}>{q}</td>;})}
                          <td style={{textAlign:"center",padding:4,fontWeight:800}}>{boxScore.result.home}</td>
                        </tr>
                        <tr style={{borderTop:"1px solid "+T.border}}>
                          <td style={{padding:4,fontWeight:700}}>{boxScore.aTeam?boxScore.aTeam.abbr:"A"}</td>
                          {boxScore.result.qtrs.a.map(function(q,qi){return <td key={qi} style={{textAlign:"center",padding:4}}>{q}</td>;})}
                          <td style={{textAlign:"center",padding:4,fontWeight:800}}>{boxScore.result.away}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                )}
                
                {boxScore.result.leaders && (
                  <div style={{padding:"10px 20px"}}>
                    <div style={{fontSize:10,color:T.gold,fontWeight:700,marginBottom:8,letterSpacing:1}}>{"STAT LEADERS"}</div>
                    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
                      {[{side:"home",team:boxScore.hTeam},{side:"away",team:boxScore.aTeam}].map(function(s){
                        var ld=boxScore.result.leaders[s.side];if(!ld) return null;
                        return React.createElement("div",{key:s.side,style:{background:T.bg3,borderRadius:6,padding:8}},
                          React.createElement("div",{style:{fontWeight:700,fontSize:11,marginBottom:6,color:T.gold}},
                            s.team?(s.team.icon+" "+s.team.abbr):(s.side==="home"?"HOME":"AWAY")),
                          ld.pass?React.createElement("div",{style:{fontSize:10,marginBottom:4}},
                            React.createElement("span",{style:{color:T.faint}},"ðŸˆ "),
                            React.createElement("span",{style:{fontWeight:600}},ld.pass.name),
                            React.createElement("span",{style:{color:T.dim}}," "+ld.pass.yds+"yd "+ld.pass.td+"TD "+ld.pass.int+"INT")):null,
                          ld.rush?React.createElement("div",{style:{fontSize:10,marginBottom:4}},
                            React.createElement("span",{style:{color:T.faint}},"ðŸƒ "),
                            React.createElement("span",{style:{fontWeight:600}},ld.rush.name),
                            React.createElement("span",{style:{color:T.dim}}," "+ld.rush.yds+"yd "+ld.rush.td+"TD")):null,
                          ld.rec&&ld.rec.length>0?ld.rec.map(function(r,ri){
                            return React.createElement("div",{key:ri,style:{fontSize:10,marginBottom:2}},
                              React.createElement("span",{style:{color:T.faint}},"ðŸŽ¯ "),
                              React.createElement("span",{style:{fontWeight:600}},r.name),
                              React.createElement("span",{style:{color:T.dim}}," "+r.rec+"rec "+r.yds+"yd"));
                          }):null,
                          ld.sack&&ld.sack.length>0?ld.sack.map(function(sk,si){
                            return React.createElement("div",{key:"s"+si,style:{fontSize:10,marginBottom:2}},
                              React.createElement("span",{style:{color:T.faint}},"ðŸ’¥ "),
                              React.createElement("span",{style:{fontWeight:600}},sk.name),
                              React.createElement("span",{style:{color:T.dim}}," "+sk.n+"sk"));
                          }):null,
                          ld.ints&&ld.ints.length>0?ld.ints.map(function(it2,ii){
                            return React.createElement("div",{key:"i"+ii,style:{fontSize:10,marginBottom:2}},
                              React.createElement("span",{style:{color:T.faint}},"ðŸ–ï¸ "),
                              React.createElement("span",{style:{fontWeight:600}},it2.name),
                              React.createElement("span",{style:{color:T.dim}}," "+it2.n+"INT"));
                          }):null
                        );
                      })}
                    </div>
                  </div>
                )}
                
                {boxScore.result.recap && boxScore.result.recap.home && boxScore.result.recap.away && (
                  <div style={{padding:"10px 20px",borderTop:"1px solid "+T.border}}>
                    <div style={{fontSize:10,color:T.blue,fontWeight:700,marginBottom:6,letterSpacing:1}}>{"GAME ANALYSIS"}</div>
                    <div style={{display:"grid",gridTemplateColumns:"1fr 50px 1fr",gap:4,fontSize:11}}>
                      {[
                        {label:"Pocket",h:boxScore.result.recap.home.pressureRate,a:boxScore.result.recap.away.pressureRate},
                        {label:"Coverage",h:boxScore.result.recap.home.coverageWin,a:boxScore.result.recap.away.coverageWin},
                        {label:"Run Lanes",h:boxScore.result.recap.home.runLaneAdv,a:boxScore.result.recap.away.runLaneAdv},
                        {label:"Turnovers",h:boxScore.result.recap.home.turnovers,a:boxScore.result.recap.away.turnovers,inv:true},
                        {label:"RZ Eff",h:boxScore.result.recap.home.rzEff,a:boxScore.result.recap.away.rzEff}
                      ].map(function(m){
                        var hW=m.inv?(m.h<m.a):(m.h>m.a);var aW=m.inv?(m.a<m.h):(m.a>m.h);
                        return React.createElement("div",{key:m.label,style:{display:"contents"}},
                          React.createElement("div",{style:{textAlign:"right",fontWeight:hW?800:400,color:hW?T.green:T.dim}},m.h+(m.label==="RZ Eff"?"%":"")),
                          React.createElement("div",{style:{textAlign:"center",color:T.faint,fontSize:9}},m.label),
                          React.createElement("div",{style:{textAlign:"left",fontWeight:aW?800:400,color:aW?T.green:T.dim}},m.a+(m.label==="RZ Eff"?"%":""))
                        );
                      })}
                    </div>
                  </div>
                )}
                
                
                {boxScore.result.explain && (
                  <div style={{padding:"12px 20px",borderTop:"1px solid "+T.border,background:"rgba(251,191,36,0.04)"}}>
                    <div style={{fontSize:10,color:T.gold,fontWeight:700,marginBottom:8,letterSpacing:1}}>{"ðŸ§  WHY " + (boxScore.result.explain.factors ? "THIS HAPPENED" : "")}</div>
                    {boxScore.result.explain.factors && boxScore.result.explain.factors.map(function(f,fi){
                      return <div key={fi}>
                        <div style={{fontSize:11,color:T.text,padding:"4px 0",paddingLeft:12,borderLeft:"2px solid "+T.gold,marginBottom:2,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                          <span>{(fi+1)+". "+f}</span>
                          
                          <button onClick={function(){setShowReceipts(showReceipts===fi?null:fi);}}
                            style={mS(S.btn,{fontSize:7,padding:"1px 4px",background:"rgba(251,191,36,0.1)",color:T.gold,border:"none"})}>
                            {showReceipts===fi?"Hide":"ðŸ§¾ Receipts"}
                          </button>
                        </div>
                        {showReceipts===fi && (function(){
                          var reasonKey=fi===0?"pressureRate":fi===1?"turnovers":"rzEff";
                          var rcts=generateReceipts(boxScore.result,{key:reasonKey});
                          var drill=FIX_IT_DRILLS[reasonKey];
                          if(rcts.length===0)return <div style={{fontSize:8,color:T.faint,paddingLeft:16,marginBottom:4}}>{"No matching drives found"}</div>;
                          return <div style={{paddingLeft:16,marginBottom:6}}>
                            {rcts.map(function(rc,rci){
                              return <div key={rci} style={{fontSize:9,color:T.dim,padding:"2px 0",borderLeft:"1px solid "+T.faint,paddingLeft:6,cursor:"pointer"}}
                                title={"Jump to Drive #"+rc.drive}>
                                {"ðŸ“Ž "+rc.text}
                              </div>;
                            })}
                            
                            {drill && <div style={{marginTop:4,padding:"4px 8px",borderRadius:4,
                              background:"rgba(96,165,250,0.08)",border:"1px solid rgba(96,165,250,0.2)"}}>
                              <div style={{fontSize:9,fontWeight:700,color:T.cyan}}>{drill.icon+" FIX-IT DRILL: "+drill.drill}</div>
                              <div style={{fontSize:8,color:T.dim,marginTop:1}}>{"ðŸ’¡ "+drill.action}</div>
                            </div>}
                          </div>;
                        })()}
                      </div>;
                    })}
                    {boxScore.result.explain.fix && (
                      <div style={{marginTop:8,padding:"8px 10px",background:"rgba(59,130,246,0.1)",borderRadius:6,borderLeft:"3px solid "+T.blue}}>
                        <div style={{fontSize:9,color:T.blue,fontWeight:700,marginBottom:2}}>{"ðŸ’¡ RECOMMENDATION"}</div>
                        <div style={{fontSize:11,color:T.text}}>{boxScore.result.explain.fix}</div>
                      </div>
                    )}
                  </div>
                )}
                {boxScore.result.box && (
                  <div style={{padding:"10px 20px",borderTop:"1px solid "+T.border}}>
                    <div style={{fontSize:10,color:T.green,fontWeight:700,marginBottom:6,letterSpacing:1}}>{"TEAM STATS"}</div>
                    <div style={{display:"grid",gridTemplateColumns:"1fr 110px 1fr",gap:3,fontSize:11}}>
                      {[
                        {label:"Pass Yds",h:boxScore.result.box.home?boxScore.result.box.home.passYds:0,a:boxScore.result.box.away?boxScore.result.box.away.passYds:0},
                        {label:"Pass TD",h:boxScore.result.box.home?boxScore.result.box.home.passTD:0,a:boxScore.result.box.away?boxScore.result.box.away.passTD:0},
                        {label:"Rush Yds",h:boxScore.result.box.home?boxScore.result.box.home.rushYds:0,a:boxScore.result.box.away?boxScore.result.box.away.rushYds:0},
                        {label:"Rush TD",h:boxScore.result.box.home?boxScore.result.box.home.rushTD:0,a:boxScore.result.box.away?boxScore.result.box.away.rushTD:0},
                        {label:"Sacks Taken",h:boxScore.result.box.home?boxScore.result.box.home.sacks:0,a:boxScore.result.box.away?boxScore.result.box.away.sacks:0,inv:true},
                        {label:"INTs Thrown",h:boxScore.result.box.home?boxScore.result.box.home.int:0,a:boxScore.result.box.away?boxScore.result.box.away.int:0,inv:true},
                        {label:"FGs Made",h:boxScore.result.box.home?boxScore.result.box.home.fgM:0,a:boxScore.result.box.away?boxScore.result.box.away.fgM:0},
                        {label:"Punts/3Out",h:boxScore.result.box.home?boxScore.result.box.home.punts:0,a:boxScore.result.box.away?boxScore.result.box.away.punts:0,inv:true},
                        {label:"Penalties",h:boxScore.result.box.home?boxScore.result.box.home.penalties:0,a:boxScore.result.box.away?boxScore.result.box.away.penalties:0,inv:true},
                        {label:"Pen Yds",h:boxScore.result.box.home?boxScore.result.box.home.penYds:0,a:boxScore.result.box.away?boxScore.result.box.away.penYds:0,inv:true},
                        {label:"3rd Dn Conv",h:boxScore.result.box.home?(boxScore.result.box.home.thirdConv+"/"+boxScore.result.box.home.thirdDown):"",
                         a:boxScore.result.box.away?(boxScore.result.box.away.thirdConv+"/"+boxScore.result.box.away.thirdDown):"",raw:true},
                        {label:"Time of Poss",h:boxScore.result.box.home?boxScore.result.box.home.TOP+":00":"",a:boxScore.result.box.away?boxScore.result.box.away.TOP+":00":"",raw:true}
                      ].map(function(m){
                        var hV=m.raw?m.h:(m.h||0);var aV=m.raw?m.a:(m.a||0);
                        var hW=m.raw?false:m.inv?(hV<aV):(hV>aV);var aW=m.raw?false:m.inv?(aV<hV):(aV>hV);
                        return React.createElement("div",{key:m.label,style:{display:"contents"}},
                          React.createElement("div",{style:{textAlign:"right",fontWeight:hW?700:400,color:hW?T.green:T.dim,padding:"1px 0"}},String(hV)),
                          React.createElement("div",{style:{textAlign:"center",color:T.faint,fontSize:9,padding:"1px 0"}},m.label),
                          React.createElement("div",{style:{textAlign:"left",fontWeight:aW?700:400,color:aW?T.green:T.dim,padding:"1px 0"}},String(aV))
                        );
                      })}
                    </div>
                  </div>
                )}
                
                {boxScore.result.log && boxScore.result.log.length>0 && (
                  <div style={{padding:"10px 20px",borderTop:"1px solid "+T.border}}>
                    <div style={{fontSize:10,color:T.cyan,fontWeight:700,marginBottom:6,letterSpacing:1}}>{"PLAY-BY-PLAY ("+boxScore.result.log.filter(function(l){return l.indexOf("â”€â”€ Q")!==0;}).length+" drives)"}</div>
                    <div style={{maxHeight:200,overflowY:"auto"}}>
                      {boxScore.result.log.map(function(l,li){
                        var isHdr=l.indexOf("â”€â”€ Q")===0;
                        if(isHdr) return React.createElement("div",{key:li,style:{fontSize:9,padding:"3px 0",color:T.gold,fontWeight:800,letterSpacing:1,textAlign:"center",borderTop:li>0?"1px solid "+T.border:"none",marginTop:li>0?4:0}},l);
                        var isTD2=l.indexOf("TOUCHDOWN")>=0;var isFG2=l.indexOf("FG GOOD")>=0;
                        var isTO2=l.indexOf("INTERCEPT")>=0||l.indexOf("FUMBLE")>=0;var isSack2=l.indexOf("sacks")>=0;
                        return React.createElement("div",{key:li,style:{fontSize:10,padding:"2px 4px",borderLeft:"3px solid "+(isTD2?T.gold:isFG2?T.green:isTO2?T.red:isSack2?T.orange:T.border),
                          color:isTD2?T.gold:isFG2?T.green:isTO2?T.red:isSack2?T.orange:T.dim,marginBottom:1}},l);
                      })}
                    </div>
                  </div>
                )}
                
                <div style={{padding:"12px 20px",borderTop:"1px solid "+T.border}}>
                  <button onClick={function(){setBoxScore(null);}} style={{width:"100%",padding:10,background:T.bg3,border:"1px solid "+T.border,borderRadius:6,color:T.text,fontWeight:700,cursor:"pointer"}}>{"Close GameCast"}</button>
                </div>
              </div>
            </div>
          )}
          
          {theater && (function(){
            var res=theater.result;var hT2=theater.homeTeam;var aT2=theater.awayTeam;
            var totalDrives=res.log.length;var idx=theater.driveIdx;
            var hScore=0,aScore=0;
            var hAbbr=hT2?hT2.abbr:"";var aAbbr=aT2?aT2.abbr:"";
            res.log.slice(0,idx).forEach(function(entry){
              if(entry.indexOf("â”€â”€ Q")===0) return;// Skip quarter headers
              var pts=0;if(entry.indexOf("TOUCHDOWN")>=0)pts=7;else if(entry.indexOf("FG GOOD")>=0)pts=3;
              if(hAbbr&&entry.indexOf(hAbbr+":")>=0)hScore+=pts;else if(aAbbr&&entry.indexOf(aAbbr+":")>=0)aScore+=pts;
            });
            var qtr=idx<Math.floor(totalDrives*0.25)?1:idx<Math.floor(totalDrives*0.5)?2:idx<Math.floor(totalDrives*0.75)?3:4;
            var momentum=hScore-aScore;var moMax=Math.max(21,Math.abs(momentum)+7);
            var winPct=Math.round(((hScore+1)/(hScore+aScore+2))*100);
            var isClutch=qtr===4&&Math.abs(hScore-aScore)<=7&&idx>0;
            var currentDrive=idx>0?res.log[idx-1]:"";
            var isQtrHdr=currentDrive.indexOf("â”€â”€ Q")===0;
            var isTD=currentDrive.indexOf("TOUCHDOWN")>=0;var isTO=currentDrive.indexOf("INTERCEPT")>=0||currentDrive.indexOf("FUMBLE")>=0;
            var isFG=currentDrive.indexOf("FG GOOD")>=0;var isSack=currentDrive.indexOf("sacks")>=0;
            var done=idx>=totalDrives;
            var _bPR=buildPowerRanks(teams,sched);
            var _homePR=_bPR.find(function(r){return r.id===(hT2?hT2.id:"");});
            var _awayPR=_bPR.find(function(r){return r.id===(aT2?aT2.id:"");});
            var _spread=(_homePR&&_awayPR)?Math.round((_homePR.score-_awayPR.score)*14):0;
            var _curEntry=res.log[idx]||"";var _showHalf=(_curEntry==="â”€â”€ Q3 â”€â”€");
            var _highlights=done?extractHighlights(res.log):null;
            return (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:100,background:"rgba(0,0,0,0.97)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",paddingTop:10,overflow:"auto"}}>
              {/* â•â•â• BROADCAST-QUALITY SCOREBOARD â•â•â• */}
              <div style={{width:"100%",maxWidth:500,marginBottom:8}}>
                {/* MFSN Network Bar */}
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 16px",
                  background:"linear-gradient(90deg, rgba(212,167,75,0.12), transparent)"}}>
                  <div style={{display:"flex",alignItems:"center",gap:6}}>
                    <span style={{fontSize:9,fontWeight:900,color:T.gold,letterSpacing:2}}>{"MFSN"}</span>
                    {!done&&<span style={{width:5,height:5,borderRadius:"50%",background:"#ef4444"}}/>}
                    {!done&&<span style={{fontSize:8,fontWeight:700,color:"#ef4444"}}>{"LIVE"}</span>}
                    {done&&<span style={{fontSize:9,fontWeight:800,color:T.text}}>{"FINAL"}</span>}
                  </div>
                  <span style={{fontSize:9,color:T.dim}}>{done?"":"Q"+qtr+(isClutch?" â€¢ ðŸ”¥ CLUTCH TIME":"")}</span>
                  <span style={{fontSize:9,color:T.faint}}>{"Drive "+Math.min(idx,totalDrives)+"/"+totalDrives}</span>
                </div>

                {/* Scoreboard Strip */}
                <div style={{display:"flex",alignItems:"stretch",background:"linear-gradient(180deg, rgba(30,41,59,0.95), rgba(15,23,42,0.98))",
                  border:"1px solid rgba(212,167,75,0.2)",borderRadius:8,overflow:"hidden",margin:"0 12px"}}>
                  {/* Home Team */}
                  <div style={{flex:1,padding:"10px 12px",display:"flex",alignItems:"center",gap:8,
                    background:hScore>aScore?"rgba(34,197,94,0.06)":"transparent"}}>
                    {React.createElement(TeamLogo,{team:hT2,size:36})}
                    <div>
                      <div style={{fontWeight:900,fontSize:13,color:T.text}}>{hT2?hT2.abbr:""}</div>
                      <div style={{fontSize:9,color:T.dim}}>{hT2?(hT2.wins||0)+"-"+(hT2.losses||0):""}</div>
                    </div>
                  </div>
                  {/* Score */}
                  <div style={{display:"flex",alignItems:"center",gap:6,padding:"0 16px",
                    background:"rgba(0,0,0,0.3)",borderLeft:"1px solid rgba(255,255,255,0.05)",borderRight:"1px solid rgba(255,255,255,0.05)"}}>
                    <div style={{fontSize:36,fontWeight:900,color:hScore>=aScore?T.gold:T.dim,letterSpacing:1,minWidth:36,textAlign:"right"}}>{hScore}</div>
                    <div style={{fontSize:14,color:"rgba(255,255,255,0.15)",fontWeight:300}}>{"â€”"}</div>
                    <div style={{fontSize:36,fontWeight:900,color:aScore>=hScore?T.gold:T.dim,letterSpacing:1,minWidth:36,textAlign:"left"}}>{aScore}</div>
                  </div>
                  {/* Away Team */}
                  <div style={{flex:1,padding:"10px 12px",display:"flex",alignItems:"center",gap:8,justifyContent:"flex-end",
                    background:aScore>hScore?"rgba(34,197,94,0.06)":"transparent"}}>
                    <div style={{textAlign:"right"}}>
                      <div style={{fontWeight:900,fontSize:13,color:T.text}}>{aT2?aT2.abbr:""}</div>
                      <div style={{fontSize:9,color:T.dim}}>{aT2?(aT2.wins||0)+"-"+(aT2.losses||0):""}</div>
                    </div>
                    {React.createElement(TeamLogo,{team:aT2,size:36})}
                  </div>
                </div>

                {/* Quarter Scores Strip */}
                {res.qtrs&&<div style={{display:"flex",justifyContent:"center",gap:0,margin:"4px 12px 0",
                  background:"rgba(0,0,0,0.3)",borderRadius:4,overflow:"hidden",fontSize:9}}>
                  {["Q1","Q2","Q3","Q4"].map(function(ql,qi){
                    var hq=res.qtrs.h&&res.qtrs.h[qi]!==undefined?res.qtrs.h[qi]:"-";
                    var aq=res.qtrs.a&&res.qtrs.a[qi]!==undefined?res.qtrs.a[qi]:"-";
                    var isActive=qi+1===qtr&&!done;
                    return <div key={qi} style={{flex:1,textAlign:"center",padding:"3px 0",
                      borderRight:qi<3?"1px solid rgba(255,255,255,0.05)":"none",
                      background:isActive?"rgba(212,167,75,0.08)":"transparent"}}>
                      <div style={{fontWeight:800,color:isActive?T.gold:T.faint,fontSize:8}}>{ql}</div>
                      <div style={{color:T.text,fontWeight:600}}>{hq+"-"+aq}</div>
                    </div>;
                  })}
                  {res.qtrs.h&&res.qtrs.h.length>4&&<div style={{flex:1,textAlign:"center",padding:"3px 0",background:"rgba(212,167,75,0.08)"}}>
                    <div style={{fontWeight:800,color:T.gold,fontSize:8}}>{"OT"}</div>
                    <div style={{color:T.text,fontWeight:600}}>{res.qtrs.h[4]+"-"+res.qtrs.a[4]}</div>
                  </div>}
                </div>}
              </div>

              {/* â•â•â• WIN PROBABILITY + MOMENTUM â•â•â• */}
              <div style={{width:"100%",maxWidth:460,marginBottom:6,padding:"0 16px"}}>
                <div style={{display:"flex",justifyContent:"space-between",fontSize:9,color:T.dim}}><span>{(hT2?hT2.abbr:"H")+" "+winPct+"%"}</span><span>{"WIN PROBABILITY"}</span><span>{(100-winPct)+"% "+(aT2?aT2.abbr:"A")}</span></div>
                <div style={{height:8,background:T.bg3,borderRadius:4,overflow:"hidden"}}><div style={{width:winPct+"%",height:"100%",background:"linear-gradient(90deg,"+T.gold+","+T.green+")",transition:"width 0.5s"}} /></div>
              </div>
              <div style={{width:"100%",maxWidth:460,marginBottom:8,padding:"0 16px"}}>
                <div style={{fontSize:8,color:T.dim,textAlign:"center",letterSpacing:1}}>{"MOMENTUM"}</div>
                <div style={{height:6,background:T.bg3,borderRadius:3,position:"relative"}}><div style={{position:"absolute",left:"50%",top:0,width:2,height:6,background:T.faint}} /><div style={{position:"absolute",left:cl(50+(momentum/moMax*50),5,95)+"%",top:-2,width:10,height:10,borderRadius:5,background:momentum>0?T.green:momentum<0?T.red:T.dim,transition:"left 0.5s",transform:"translateX(-5px)"}} /></div>
              </div>

              {/* â•â•â• LIVE STAT TRACKER â€” Key Players â•â•â• */}
              {idx>2&&!done&&(function(){
                var hQB=starters(hT2.roster,"QB")[0];var aQB=starters(aT2.roster,"QB")[0];
                var hRB=starters(hT2.roster,"RB")[0];var aRB=starters(aT2.roster,"RB")[0];
                var hWR=starters(hT2.roster,"WR")[0];var aWR=starters(aT2.roster,"WR")[0];
                function gsd(p,f){return typeof gameStatDelta==="function"?gameStatDelta(p,f):(p&&p.stats?p.stats[f]||0:0);}
                return <div style={{width:"100%",maxWidth:460,padding:"0 16px",marginBottom:8}}>
                  <div style={{fontSize:8,fontWeight:800,color:T.cyan,letterSpacing:1,marginBottom:4,textAlign:"center"}}>{"ðŸ“Š LIVE STATS"}</div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,fontSize:9}}>
                    {hQB&&<div style={{padding:"4px 8px",borderRadius:4,background:"rgba(255,255,255,0.03)",borderLeft:"2px solid "+T.gold}}>
                      <span style={{fontWeight:700,color:T.text}}>{hQB.name}</span>
                      <span style={{color:T.dim}}>{" "+gsd(hQB,"passYds")+"yds "+(gsd(hQB,"passTD")||0)+"TD "+(gsd(hQB,"int")||0)+"INT"}</span>
                    </div>}
                    {aQB&&<div style={{padding:"4px 8px",borderRadius:4,background:"rgba(255,255,255,0.03)",borderRight:"2px solid "+T.gold,textAlign:"right"}}>
                      <span style={{color:T.dim}}>{gsd(aQB,"passYds")+"yds "+(gsd(aQB,"passTD")||0)+"TD "+(gsd(aQB,"int")||0)+"INT "}</span>
                      <span style={{fontWeight:700,color:T.text}}>{aQB.name}</span>
                    </div>}
                    {hRB&&<div style={{padding:"4px 8px",borderRadius:4,background:"rgba(255,255,255,0.03)",borderLeft:"2px solid "+T.green}}>
                      <span style={{fontWeight:700,color:T.text}}>{hRB.name}</span>
                      <span style={{color:T.dim}}>{" "+gsd(hRB,"rushYds")+"yds "+(gsd(hRB,"rushTD")||0)+"TD"}</span>
                    </div>}
                    {aRB&&<div style={{padding:"4px 8px",borderRadius:4,background:"rgba(255,255,255,0.03)",borderRight:"2px solid "+T.green,textAlign:"right"}}>
                      <span style={{color:T.dim}}>{gsd(aRB,"rushYds")+"yds "+(gsd(aRB,"rushTD")||0)+"TD "}</span>
                      <span style={{fontWeight:700,color:T.text}}>{aRB.name}</span>
                    </div>}
                  </div>
                </div>;
              }())}
              {theater.decisions&&theater.decisions.length>0?React.createElement("div",{style:{fontSize:9,color:T.gold,textAlign:"center",marginBottom:4}},
                "ðŸŽ® "+theater.decisions.length+" coaching decision"+(theater.decisions.length>1?"s":"")+" remaining"):null}
              {theater.decisionActive && (function(){
                var dec=theater.decisionActive;
                var opts=[];
                if(dec.type==="4th_down"){
                  var fgRange=dec.yardLine>=60;
                  opts=[
                    {id:"go",label:"ðŸˆ Go For It",desc:"45% conversion â€” gutsy call",risk:"high"},
                    {id:"punt",label:"ðŸ¦µ Punt",desc:"Safe â€” flip field position",risk:"low"}
                  ];
                  if(fgRange)opts.splice(1,0,{id:"fg",label:"3ï¸âƒ£ Field Goal",desc:(dec.yardLine>=75?"80%":dec.yardLine>=65?"60%":"35%")+" make",risk:"medium"});
                }else if(dec.type==="two_min"){
                  opts=[
                    {id:"aggressive",label:"âš¡ Aggressive",desc:"+15% TD, +10% turnover risk",risk:"high"},
                    {id:"balanced",label:"âš–ï¸ Balanced",desc:"No change â€” trust the gameplan",risk:"medium"},
                    {id:"conservative",label:"ðŸ§Š Conservative",desc:"Run clock, protect the ball",risk:"low"}
                  ];
                }else if(dec.type==="challenge"){
                  opts=[
                    {id:"challenge",label:"ðŸš© Challenge!",desc:"40% reversed â€” worth the risk?",risk:"high"},
                    {id:"accept",label:"âœ‹ Accept the Call",desc:"Move on, save the timeout",risk:"low"}
                  ];
                }else if(dec.type==="timeout"){
                  opts=[
                    {id:"timeout",label:"â±ï¸ Call Timeout",desc:"Stop clock â€” get the ball back",risk:"medium"},
                    {id:"letrun",label:"â³ Let Clock Run",desc:"Defensive momentum â€” trust your guys",risk:"low"}
                  ];
                }
                var riskColors={high:"#ef4444",medium:"#f59e0b",low:"#10b981"};
                return React.createElement("div",{style:{
                  width:"100%",maxWidth:420,padding:"16px 20px",margin:"8px auto",
                  background:"linear-gradient(135deg, rgba(251,191,36,0.15), rgba(251,191,36,0.04))",
                  border:"2px solid rgba(251,191,36,0.5)",borderRadius:12
                }},
                  React.createElement("div",{style:{fontSize:13,fontWeight:900,color:T.gold,textAlign:"center",marginBottom:8,letterSpacing:1}},
                    dec.type==="4th_down"?"ðŸˆ 4TH DOWN DECISION":
                    dec.type==="two_min"?"â±ï¸ TWO-MINUTE DRILL":
                    dec.type==="challenge"?"ðŸš© CHALLENGE PLAY?":"â±ï¸ TIMEOUT DECISION"
                  ),
                  React.createElement("div",{style:{fontSize:10,color:T.dim,textAlign:"center",marginBottom:10}},
                    dec.type==="4th_down"?"Your offense stalled at the "+(100-(dec.yardLine||50))+" yard line.":
                    dec.type==="two_min"?"Q"+(dec.quarter||4)+" winding down â€” how do you want to play it?":
                    dec.type==="challenge"?"That turnover looks questionable. Got a timeout to burn?":
                    "Late in the 4th â€” clock management time."
                  ),
                  React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:6}},
                    opts.map(function(opt){
                      return React.createElement("button",{key:opt.id,style:{
                        padding:"10px 14px",borderRadius:8,cursor:"pointer",textAlign:"left",
                        background:T.bg2,border:"1px solid "+riskColors[opt.risk]+"44"
                      },onClick:function(){resolveDecision972(dec,opt.id);}},
                        React.createElement("div",{style:{fontWeight:700,fontSize:12,color:T.text}},opt.label),
                        React.createElement("div",{style:{fontSize:9,color:T.dim,marginTop:2}},opt.desc),
                        React.createElement("div",{style:{fontSize:8,color:riskColors[opt.risk],marginTop:1}},"Risk: "+opt.risk.toUpperCase())
                      );
                    })
                  )
                );
              })()}
              
              {idx===0&&!done?React.createElement("div",{style:{width:"100%",maxWidth:500,padding:"0 16px",marginBottom:8}},makePregameCard(hT2,aT2,_homePR,_awayPR,_spread)):null}
              
              {currentDrive && !isQtrHdr && (function(){
                var yMatch=currentDrive.match(/(\d+)yds/);var yds=yMatch?parseInt(yMatch[1]):0;
                var startYd=25;// approximate start
                var endYd=isTD?100:Math.min(95,startYd+yds);
                var isRZ=endYd>=80;
                return React.createElement("div",{style:{width:"100%",maxWidth:400,padding:"0 16px",marginBottom:8}},
                  React.createElement("div",{style:{height:28,background:"linear-gradient(90deg,#1a3d16,#2e5a22,#1a3d16)",border:"1px solid #4a7a3e",borderRadius:4,position:"relative",overflow:"hidden"}},
                    [10,20,30,40,50,60,70,80,90].map(function(mk){
                      return React.createElement("div",{key:mk,style:{position:"absolute",left:mk+"%",top:0,bottom:0,width:1,background:"rgba(255,255,255,0.15)"}},
                        React.createElement("span",{style:{position:"absolute",top:1,left:2,fontSize:6,color:"rgba(255,255,255,0.3)"}},mk==="50"?"50":""));}),
                    React.createElement("div",{style:{position:"absolute",left:"50%",top:0,bottom:0,width:2,background:"rgba(255,255,255,0.3)"}}),
                    isRZ?React.createElement("div",{style:{position:"absolute",left:"80%",right:0,top:0,bottom:0,background:"rgba(255,50,50,0.12)"}}):null,
                    React.createElement("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:"3%",background:"rgba(100,100,100,0.3)"}}),
                    React.createElement("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"3%",background:isTD?"rgba(212,167,75,0.4)":"rgba(100,100,100,0.3)"}}),
                    React.createElement("div",{style:{position:"absolute",left:cl(endYd,3,97)+"%",top:4,bottom:4,width:8,height:8,borderRadius:"50%",background:isTD?T.gold:isTO?T.red:T.text,boxShadow:"0 0 6px "+(isTD?T.gold:isTO?T.red:"rgba(255,255,255,0.5)"),transition:"left 0.5s ease-out",transform:"translateX(-4px)"}})
                  )
                );
              })()}
              {currentDrive && !isQtrHdr && (function(){
                var commentType=isTD?"TD":isTO?"TO":isFG?"FG":isSack?"PUNT":"PUNT";
                var comment93=BROADCAST_COMMENTARY.get("drives",commentType,RNG.play);
                var prevScore=hScore;var prevAScore=aScore;// already computed above
                var scoreDiff=hScore-aScore;var prevDiff=prevScore-prevAScore;
                var momentumComment93="";
                var isUserHome=theater.homeTeam&&theater.homeTeam.id===myId;
                if(isTD||isFG){
                  var justLedChange=(scoreDiff>0&&prevDiff<=0)||(scoreDiff<0&&prevDiff>=0);
                  var bigLead=Math.abs(scoreDiff)>=14&&Math.abs(prevDiff)<14;
                  if(justLedChange)momentumComment93=BROADCAST_COMMENTARY.get("momentum","takeLead",RNG.play);
                  else if(bigLead)momentumComment93=BROADCAST_COMMENTARY.get("momentum","extendLead",RNG.play);
                }
                return React.createElement("div",{style:{maxWidth:400,width:"100%",marginBottom:12}},
                  React.createElement("div",{style:{padding:"12px 20px",borderRadius:"8px 8px 0 0",textAlign:"center",fontSize:14,fontWeight:700,
                    background:isTD?"rgba(212,167,75,0.2)":isTO?"rgba(239,68,68,0.2)":isFG?"rgba(52,211,153,0.15)":isSack?"rgba(239,68,68,0.1)":"rgba(255,255,255,0.05)",
                    color:isTD?T.gold:isTO?T.red:isFG?T.green:isSack?T.orange:T.text,border:"1px solid "+(isTD?T.gold:isTO?T.red:isFG?T.green:T.border),borderBottom:"none"}},
                    currentDrive
                  ),
                  React.createElement("div",{style:{padding:"6px 20px 10px",borderRadius:"0 0 8px 8px",textAlign:"center",fontSize:10,fontStyle:"italic",color:T.dim,
                    background:"rgba(15,23,42,0.6)",border:"1px solid "+(isTD?T.gold:isTO?T.red:isFG?T.green:T.border),borderTop:"none"}},
                    momentumComment93||comment93
                  )
                );
              })()}
              {isQtrHdr && <div style={{padding:"8px 20px",borderRadius:6,marginBottom:8,textAlign:"center",
                background:"linear-gradient(90deg, transparent, rgba(212,167,75,0.08), transparent)",
                borderTop:"1px solid rgba(212,167,75,0.2)",borderBottom:"1px solid rgba(212,167,75,0.2)"}}>
                <div style={{fontSize:13,fontWeight:900,color:T.gold,letterSpacing:3}}>{currentDrive}</div>
                {qtr===2&&<div style={{fontSize:9,color:T.dim,marginTop:2}}>{"Halftime approaching..."}</div>}
                {qtr===4&&<div style={{fontSize:9,color:T.red,marginTop:2,fontWeight:700}}>{"Final quarter â€” every play matters!"}</div>}
              </div>}
              
              {_showHalf?React.createElement("div",{style:{width:"100%",maxWidth:500,padding:"0 16px",marginBottom:8}},makeHalftimeCard(hScore,aScore,hT2,aT2,res.qtrs)):null}

              {/* ATMOSPHERE INDICATOR */}
              {!done&&idx>0&&(function(){
                var atmoLevel986=Math.abs(momentum)<=3?"TENSE":Math.abs(momentum)>=14?"ELECTRIC":hScore+aScore>40?"HIGH-SCORING":"COMPETITIVE";
                var atmoEmoji986=atmoLevel986==="TENSE"?"ðŸ«¨":atmoLevel986==="ELECTRIC"?"âš¡":atmoLevel986==="HIGH-SCORING"?"ðŸ”¥":"ðŸŸï¸";
                var atmoColor986=atmoLevel986==="TENSE"?T.orange:atmoLevel986==="ELECTRIC"?T.gold:atmoLevel986==="HIGH-SCORING"?T.red:T.cyan;
                return <div style={{fontSize:8,color:atmoColor986,textAlign:"center",marginBottom:4,fontWeight:700,letterSpacing:1}}>
                  {atmoEmoji986+" ATMOSPHERE: "+atmoLevel986+" "+atmoEmoji986}
                </div>;
              }())}

              {/* PLAY FEED â€” Scrollable */}
              <div style={{width:"100%",maxWidth:460,maxHeight:200,overflowY:"auto",marginBottom:8,padding:"0 16px"}}>
                {res.log.slice(0,idx).map(function(entry,ei){
                  var isHdr=entry.indexOf("â”€â”€ Q")===0;
                  if(isHdr) return <div key={ei} style={{fontSize:10,padding:"4px 8px",color:T.gold,fontWeight:800,letterSpacing:1,textAlign:"center",borderTop:ei>0?"1px solid "+T.border:"none",marginTop:ei>0?4:0}}>{entry}</div>;
                  var hasTD2=entry.indexOf("TOUCHDOWN")>=0;var hasFG2=entry.indexOf("FG GOOD")>=0||entry.indexOf("FG")>=0&&entry.indexOf("GOOD")>=0;
                  var hasTO=entry.indexOf("INTERCEPT")>=0||entry.indexOf("FUMBLE")>=0;var hasSack=entry.indexOf("sacks")>=0||entry.indexOf("SACK")>=0;
                  var isCurrent986=ei===idx-1;
                  return <div key={ei} style={{fontSize:10,padding:"4px 10px",marginBottom:2,borderRadius:4,
                    borderLeft:"3px solid "+(hasTD2?T.gold:hasFG2?T.green:hasTO?T.red:hasSack?T.orange:T.border),
                    color:hasTD2?T.gold:hasFG2?T.green:hasTO?T.red:hasSack?T.orange:T.dim,
                    background:isCurrent986?"rgba(255,255,255,0.06)":hasTD2?"rgba(212,167,75,0.04)":hasTO?"rgba(239,68,68,0.04)":"transparent",
                    fontWeight:hasTD2||hasTO?700:400,
                    lineHeight:1.4}}>{entry}</div>;
                })}
              </div>
              
              {done&&_highlights?React.createElement("div",{style:{width:"100%",maxWidth:500,padding:"0 16px",marginBottom:8}},makePostgameCard(res,_highlights,hT2,aT2,res.leaders)):null}
              <div style={{display:"flex",gap:8,marginBottom:12,padding:"0 16px",justifyContent:"center"}}>
                {!done && <button style={bS(theater.paused?T.green:T.orange,"#000")} onClick={function(){setTheater(assign({},theater,{paused:!theater.paused}));}}>{theater.paused?"â–¶ Play":"â¸ Pause"}</button>}
                {!done && <button style={bS(T.bg3,T.text)} onClick={function(){setTheater(assign({},theater,{speed:theater.speed==="fast"?"normal":"fast"}));}}>{"âš¡ "+(theater.speed==="fast"?"Normal":"Fast")}</button>}
                {!done && <button style={bS(T.bg3,T.text)} onClick={function(){setTheater(assign({},theater,{driveIdx:totalDrives,decisionActive:null,decisions:[],paused:true}));}}>{"â­ Skip"}</button>}
                {done && <button style={bS(T.green,"#000")} onClick={function(){
                  var nt=teams.slice();var ns=sched.slice();var gr=theater.gameRef;
                  var gi=ns.findIndex(function(x){return x.home===gr.home&&x.away===gr.away&&x.week===gr.week;});
                  if(gi>=0){ns[gi].played=true;ns[gi].result=res;}
                  var h=nt.find(function(t){return t.id===gr.home;}),a=nt.find(function(t){return t.id===gr.away;});
                  if(h&&a){
                    if(res.home>res.away){h.wins++;a.losses++;h.streak=Math.max(1,(h.streak||0)+1);a.streak=Math.min(-1,(a.streak||0)-1);}
                    else{a.wins++;h.losses++;a.streak=Math.max(1,(a.streak||0)+1);h.streak=Math.min(-1,(h.streak||0)-1);}
                    h.pf+=res.home;h.pa+=res.away;a.pf+=res.away;a.pa+=res.home;
                  }
                  setTeams(nt);setSched(ns);setTheater(null);
                  var isH3=gr.home===myId;var uWon=isH3?res.home>res.away:res.away>res.home;
                  AUDIO.play(uWon?"victory":"defeat");// v27: Context-aware post-game audio
                  addN("ðŸ“º "+hT2.abbr+" "+res.home+"-"+res.away+" "+aT2.abbr+(uWon?" âœ… W":" âŒ L"),uWon?"green":"red",{type:"boxScore",game:res});
                  var finalMargin93=Math.abs((res.home||0)-(res.away||0));
                  var finalType93=finalMargin93>=20?"blowout":finalMargin93>=10?"comfortable":finalMargin93>=4?"close":"walkoff";
                  var finalComment93=BROADCAST_COMMENTARY.get("finalScore",finalType93,RNG.play);
                  addN("\uD83C\uDFA4 MFSN: \""+finalComment93+"\"","dim");
                  setSelGame(res);if(res.recap){setGameRecap(isH3?res.recap.home:res.recap.away);}
                  try{setGameKeys(generateGameKeys(res,hT2,aT2));}catch(e){setGameKeys(null);}
                  doSave(nt,ns);
                }}>{"âœ… Confirm Result"}</button>}
                <button style={bS(T.bg3,T.red)} onClick={function(){AUDIO.play("hub");setTheater(null);}}>{"âœ– Close"}</button>
              </div>
              <div style={{fontSize:9,color:T.faint}}>{"Drive "+Math.min(idx,totalDrives)+"/"+totalDrives}</div>
            </div>);
          }())}
          
          {/* â•â•â• v98.6: PLAY-BY-PLAY MODE â€” Madden-style real football! â•â•â• */}
          {liveGame986 && (function(){
            var lg=liveGame986;
            var isUserOff=LIVE_GAME_986.isUserPoss(lg);
            var userIsHome=lg.userId===lg.homeTeam.id;
            var userTeam=userIsHome?lg.homeTeam:lg.awayTeam;
            var oppTeam=userIsHome?lg.awayTeam:lg.homeTeam;
            var offT=LIVE_GAME_986.offTeam(lg);var defT=LIVE_GAME_986.defTeam(lg);
            var uScore=userIsHome?lg.hScore:lg.aScore;var oScore=userIsHome?lg.aScore:lg.hScore;
            var isDone=lg.phase==="postgame";
            var clockStr=LIVE_GAME_986.clockStr(lg.clock);
            var posStr=LIVE_GAME_986.sideStr(lg.fieldPos);
            var downStr=lg.down+""+({1:"st",2:"nd",3:"rd",4:"th"}[lg.down]||"th")+" & "+(lg.yardsToGo>=lg.fieldPos?"Goal":lg.yardsToGo);
            var isRedZone=lg.fieldPos>=80;
            var _playCategory=liveResult986&&liveResult986._cat||null;
            var _setCat=function(cat){setLiveResult986(cat?{_cat:cat}:null);};
            // AI auto-play helper
            function aiDefPlay(){return LIVE_GAME_986.aiSmartDefPlay(lg);}
            function aiOffPlay(){return LIVE_GAME_986.aiSmartOffPlay(lg);}
            function doPlay(play){
              var newLg=JSON.parse(JSON.stringify(lg));
              newLg.homeTeam=lg.homeTeam;newLg.awayTeam=lg.awayTeam;
              if(isUserOff){
                LIVE_GAME_986.executePlay(newLg,play,aiDefPlay());
              }else{
                LIVE_GAME_986.executePlay(newLg,aiOffPlay(),play);
              }
              setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
            }
            function doKickoff(type){
              var newLg=JSON.parse(JSON.stringify(lg));newLg.homeTeam=lg.homeTeam;newLg.awayTeam=lg.awayTeam;
              LIVE_GAME_986.resolveKickoff(newLg,type||"normal");
              setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
            }
            // Watch Drive â€” auto-sim opponent's drive with delay
            function startWatchDrive(coverage){
              var newLg=JSON.parse(JSON.stringify(lg));newLg.homeTeam=lg.homeTeam;newLg.awayTeam=lg.awayTeam;
              newLg.watchDriveActive=true;newLg.watchDriveCoverage=coverage;
              // Sim one play at a time with the selected coverage
              var offPlay=LIVE_GAME_986.aiSmartOffPlay(newLg);
              LIVE_GAME_986.executePlay(newLg,offPlay,coverage);
              setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
              // Check if drive ended (possession changed, TD, etc.)
              var driveOver=newLg.phase!=="play_call"||LIVE_GAME_986.isUserPoss(newLg);
              if(driveOver){newLg.watchDriveActive=false;setLiveGame986(newLg);}
            }
            function doFourth(choice){
              var newLg=JSON.parse(JSON.stringify(lg));newLg.homeTeam=lg.homeTeam;newLg.awayTeam=lg.awayTeam;
              LIVE_GAME_986.fourthDown(newLg,choice);
              setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
            }
            function doPAT(choice){
              var newLg=JSON.parse(JSON.stringify(lg));newLg.homeTeam=lg.homeTeam;newLg.awayTeam=lg.awayTeam;
              LIVE_GAME_986.handlePAT(newLg,choice);
              setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
            }
            return(
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:100,
              background:"#0a0f1a",display:"flex",flexDirection:"column",overflow:"hidden"}}>

              {/* â•â•â• SCOREBOARD BAR â€” Madden-style â•â•â• */}
              <div style={{flexShrink:0,background:"linear-gradient(180deg,#1a2744,#0f1729)",borderBottom:"2px solid "+T.gold+"44"}}>
                <div style={{display:"flex",alignItems:"stretch",maxWidth:500,margin:"0 auto"}}>
                  {/* Home */}
                  <div style={{flex:1,display:"flex",alignItems:"center",gap:6,padding:"6px 10px",
                    background:lg.possession==="home"?"rgba(212,167,75,0.08)":"transparent"}}>
                    {React.createElement(TeamLogo,{team:lg.homeTeam,size:24})}
                    <div>
                      <div style={{fontWeight:900,fontSize:11,color:T.text}}>{lg.homeTeam.abbr}</div>
                      <div style={{fontSize:8,color:T.dim}}>{(lg.homeTeam.wins||0)+"-"+(lg.homeTeam.losses||0)}</div>
                    </div>
                    <div style={{fontSize:22,fontWeight:900,color:lg.hScore>=lg.aScore?T.gold:"rgba(255,255,255,0.4)",marginLeft:"auto"}}>{lg.hScore}</div>
                  </div>
                  {/* Clock */}
                  <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",
                    padding:"4px 12px",background:"rgba(0,0,0,0.4)",minWidth:60}}>
                    <div style={{fontSize:16,fontWeight:900,color:lg.clock<=120&&lg.quarter>=4?"#ef4444":T.text,fontFamily:"monospace"}}>{clockStr}</div>
                    <div style={{fontSize:9,fontWeight:800,color:T.gold}}>{isDone?"FINAL":(lg.isOT?"OT":"Q"+lg.quarter)}</div>
                  </div>
                  {/* Away */}
                  <div style={{flex:1,display:"flex",alignItems:"center",gap:6,padding:"6px 10px",
                    flexDirection:"row-reverse",
                    background:lg.possession==="away"?"rgba(212,167,75,0.08)":"transparent"}}>
                    {React.createElement(TeamLogo,{team:lg.awayTeam,size:24})}
                    <div style={{textAlign:"right"}}>
                      <div style={{fontWeight:900,fontSize:11,color:T.text}}>{lg.awayTeam.abbr}</div>
                      <div style={{fontSize:8,color:T.dim}}>{(lg.awayTeam.wins||0)+"-"+(lg.awayTeam.losses||0)}</div>
                    </div>
                    <div style={{fontSize:22,fontWeight:900,color:lg.aScore>=lg.hScore?T.gold:"rgba(255,255,255,0.4)",marginRight:"auto"}}>{lg.aScore}</div>
                  </div>
                </div>
              </div>

              {/* â•â•â• WIN PROBABILITY BAR v99.1 â•â•â• */}
              {!isDone&&lg.phase!=="coin_toss"&&(lg.totalPlays||0)>0&&(function(){
                var sd=lg.hScore-lg.aScore;
                var q=Math.min(4,Math.max(1,lg.quarter||1));
                var _wp993=calcWinProbV2_993(sd,q,lg.clock||0,lg.down||1,lg.yardsToGo||10,lg.fieldPos||20,lg.possession==="home");
                var hwp=Math.round(_wp993*100);
                var awp=100-hwp;
                return <div style={{flexShrink:0,height:20,background:"rgba(0,0,0,0.45)",
                  borderBottom:"1px solid rgba(255,255,255,0.04)",overflow:"hidden",
                  position:"relative",display:"flex",alignItems:"center",maxWidth:500,margin:"0 auto",width:"100%"}}>
                  <div style={{height:"100%",width:hwp+"%",background:"linear-gradient(90deg,rgba(212,167,75,0.5),rgba(212,167,75,0.22))",
                    transition:"width 0.5s ease",display:"flex",alignItems:"center",paddingLeft:7,minWidth:hwp<15?0:undefined}}>
                    {hwp>=15&&<span style={{fontSize:8,fontWeight:800,color:T.gold,whiteSpace:"nowrap"}}>{lg.homeTeam.abbr} {hwp}%</span>}
                  </div>
                  <div style={{position:"absolute",right:0,height:"100%",width:awp+"%",
                    background:"linear-gradient(270deg,rgba(59,130,246,0.5),rgba(59,130,246,0.22))",
                    transition:"width 0.5s ease",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:7}}>
                    {awp>=15&&<span style={{fontSize:8,fontWeight:800,color:"#60a5fa",whiteSpace:"nowrap"}}>{awp+"% "+lg.awayTeam.abbr}</span>}
                  </div>
                  <div style={{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",
                    fontSize:7,color:"rgba(255,255,255,0.22)",letterSpacing:1,pointerEvents:"none",whiteSpace:"nowrap"}}>WIN PROB</div>
                </div>;
              })()}

              {/* â•â•â• MOMENTUM METER v99.1 â•â•â• */}
              {!isDone&&lg.phase!=="coin_toss"&&(lg.totalPlays||0)>0&&(function(){
                var mom=lg.momentum||0;
                var homePct=Math.round((mom+10)/20*100);// -10â†’0%, 0â†’50%, +10â†’100%
                var awayPct=100-homePct;
                var abs=Math.abs(mom);
                var surgeLbl=abs>=8?"ðŸ”¥ SURGE":abs>=5?"âš¡ EDGE":abs>=2?"â†‘ SHIFT":"NEUTRAL";
                var leadTeam=mom>0?lg.homeTeam.abbr:mom<0?lg.awayTeam.abbr:"";
                var momCol=mom>0?"rgba(212,167,75,"+(0.35+abs*0.05)+")":"rgba(59,130,246,"+(0.35+abs*0.05)+")";
                return <div style={{flexShrink:0,height:16,background:"rgba(0,0,0,0.3)",
                  borderBottom:"1px solid rgba(255,255,255,0.03)",position:"relative",overflow:"hidden",
                  maxWidth:500,margin:"0 auto",width:"100%"}}>
                  <div style={{position:"absolute",left:0,top:0,height:"100%",width:homePct+"%",
                    background:"linear-gradient(90deg,rgba(212,167,75,0.08),rgba(212,167,75,"+(0.12+abs*0.04)+"))",
                    transition:"width 0.6s ease"}}/>
                  <div style={{position:"absolute",right:0,top:0,height:"100%",width:awayPct+"%",
                    background:"linear-gradient(270deg,rgba(59,130,246,0.08),rgba(59,130,246,"+(0.12+abs*0.04)+"))",
                    transition:"width 0.6s ease"}}/>
                  <div style={{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",
                    alignItems:"center",justifyContent:"center",pointerEvents:"none"}}>
                    <span style={{fontSize:7,fontWeight:800,letterSpacing:1,whiteSpace:"nowrap",
                      color:abs>=5?momCol:"rgba(255,255,255,0.2)"}}>
                      {abs>=2?(leadTeam+" "+surgeLbl):"MOMENTUM"}
                    </span>
                  </div>
                </div>;
              })()}

              {/* â•â•â• OTHER SCORES TICKER â•â•â• */}
              {lg.otherScores&&lg.otherScores.length>0&&!isDone&&lg.phase!=="coin_toss"&&<div style={{flexShrink:0,
                background:"rgba(0,0,0,0.5)",borderBottom:"1px solid rgba(255,255,255,0.03)",
                padding:"3px 0",overflow:"hidden"}}>
                <div style={{display:"flex",gap:16,overflowX:"auto",padding:"0 12px",scrollbarWidth:"none"}}>
                  {lg.otherScores.slice(0,8).map(function(sc,i){
                    return <div key={i} style={{display:"flex",alignItems:"center",gap:4,flexShrink:0,fontSize:8}}>
                      <span style={{color:T.faint}}>{sc.homeEmoji}{sc.homeAbbr}</span>
                      <span style={{color:sc.hScore>sc.aScore?T.green:T.dim,fontWeight:700}}>{sc.hScore}</span>
                      <span style={{color:T.faint}}>{"â€“"}</span>
                      <span style={{color:sc.aScore>sc.hScore?T.green:T.dim,fontWeight:700}}>{sc.aScore}</span>
                      <span style={{color:T.faint}}>{sc.awayEmoji}{sc.awayAbbr}</span>
                      <span style={{color:"#ef4444",fontSize:6,fontWeight:700}}>{sc.status}</span>
                    </div>;
                  })}
                </div>
              </div>}

              {/* â•â•â• LIVE BOX SCORE BAR â•â•â• */}
              {!isDone&&lg.phase!=="coin_toss"&&lg.phase!=="halftime"&&lg.boxScore&&(function(){
                var off=LIVE_GAME_986.offTeam(lg);
                var userHome2=lg.userId===lg.homeTeam.id;
                var ut=userHome2?lg.homeTeam:lg.awayTeam;
                var qb2=ut.roster.find(function(p){return p.pos==="QB"&&p.isStarter;});
                var rb2=ut.roster.find(function(p){return p.pos==="RB"&&p.isStarter;});
                var qbBS=qb2&&lg.boxScore[qb2.name]?lg.boxScore[qb2.name]:null;
                var rbBS=rb2&&lg.boxScore[rb2.name]?lg.boxScore[rb2.name]:null;
                if(!qbBS&&!rbBS)return null;
                return <div style={{flexShrink:0,padding:"3px 12px",background:"rgba(0,0,0,0.3)",
                  borderBottom:"1px solid rgba(255,255,255,0.03)",display:"flex",justifyContent:"center",gap:16,maxWidth:500,margin:"0 auto"}}>
                  {qbBS&&<div style={{fontSize:8,color:T.dim,display:"flex",gap:4,alignItems:"center"}}>
                    <span style={{color:T.gold,fontWeight:700}}>{qb2.name.split(" ").pop()}</span>
                    <span>{(qbBS.comp||0)+"/"+(qbBS.att||0)}</span>
                    <span>{(qbBS.passYds||0)+" yds"}</span>
                    {(qbBS.passTD||0)>0&&<span style={{color:T.green}}>{(qbBS.passTD||0)+" TD"}</span>}
                    {(qbBS.int||0)>0&&<span style={{color:T.red}}>{(qbBS.int||0)+" INT"}</span>}
                  </div>}
                  {rbBS&&(rbBS.rushAtt||0)>0&&<div style={{fontSize:8,color:T.dim,display:"flex",gap:4,alignItems:"center"}}>
                    <span style={{color:"#60a5fa",fontWeight:700}}>{rb2.name.split(" ").pop()}</span>
                    <span>{(rbBS.rushAtt||0)+" car"}</span>
                    <span>{(rbBS.rushYds||0)+" yds"}</span>
                    {(rbBS.rushTD||0)>0&&<span style={{color:T.green}}>{(rbBS.rushTD||0)+" TD"}</span>}
                  </div>}
                </div>;
              })()}

              {/* â•â•â• DOWN & DISTANCE BAR â•â•â• */}
              {!isDone&&lg.phase!=="halftime"&&lg.phase!=="coin_toss"&&lg.phase!=="kickoff"&&<div style={{flexShrink:0,padding:"6px 16px",
                background:isRedZone?"rgba(239,68,68,0.08)":"rgba(212,167,75,0.04)",
                borderBottom:"1px solid "+(isRedZone?"rgba(239,68,68,0.2)":"rgba(255,255,255,0.05)")}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",maxWidth:500,margin:"0 auto"}}>
                  <div style={{display:"flex",alignItems:"center",gap:8}}>
                    <div style={{fontWeight:900,fontSize:15,color:isRedZone?"#ef4444":T.gold}}>{downStr}</div>
                    {lg.possession==="home"?React.createElement(TeamLogo,{team:lg.homeTeam,size:16}):React.createElement(TeamLogo,{team:lg.awayTeam,size:16})}
                    <span style={{fontSize:10,fontWeight:700,color:T.text}}>{offT.abbr+" ball"}</span>
                  </div>
                  <div style={{fontSize:10,color:T.dim,fontWeight:600}}>{"ðŸ“ "+posStr}</div>
                  {isRedZone&&<div style={{fontSize:9,color:"#ef4444",fontWeight:800}}>{"ðŸ”´ RED ZONE"}</div>}
                </div>

                {/* Mini field position bar */}
                <div style={{height:16,borderRadius:4,margin:"6px auto 0",maxWidth:500,position:"relative",overflow:"hidden",
                  background:"linear-gradient(90deg,#1a3d16,#2e5a22,#2e5a22,#2e5a22,#1a3d16)",border:"1px solid #4a7a3e"}}>
                  {[10,20,30,40,50,60,70,80,90].map(function(m){
                    return <div key={m} style={{position:"absolute",left:m+"%",top:0,bottom:0,width:1,background:"rgba(255,255,255,0.12)"}} />;
                  })}
                  <div style={{position:"absolute",left:"50%",top:0,bottom:0,width:2,background:"rgba(255,255,255,0.25)"}} />
                  {/* First down marker */}
                  <div style={{position:"absolute",left:Math.min(98,Math.max(2,lg.fieldPos+lg.yardsToGo))+"%",top:0,bottom:0,width:3,
                    background:"rgba(251,191,36,0.6)",borderRadius:1}} />
                  {/* Ball position */}
                  <div style={{position:"absolute",left:Math.min(97,Math.max(3,lg.fieldPos))+"%",top:2,width:12,height:12,
                    borderRadius:"50%",background:isRedZone?"#ef4444":T.gold,
                    boxShadow:"0 0 8px "+(isRedZone?"rgba(239,68,68,0.5)":"rgba(212,167,75,0.5)"),
                    transition:"left 0.4s ease-out",transform:"translateX(-6px)"}} />
                  {/* End zones */}
                  <div style={{position:"absolute",left:0,top:0,bottom:0,width:"3%",background:"rgba(100,100,100,0.3)"}} />
                  <div style={{position:"absolute",right:0,top:0,bottom:0,width:"3%",background:"rgba(212,167,75,0.15)"}} />
                </div>
              </div>}

              {/* â•â•â• MAIN CONTENT AREA â•â•â• */}
              <div style={{flex:1,overflow:"auto",display:"flex",flexDirection:"column"}}>

                {/* COIN TOSS â€” Multi-phase: call â†’ result â†’ choice */}
                {lg.phase==="coin_toss"&&(function(){
                  var ctState=lg.coinTossState||"call";// call â†’ result â†’ choice
                  return <div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20}}>
                    <div style={{fontSize:40,marginBottom:12}}>{ctState==="result"?"ðŸª™âœ¨":"ðŸª™"}</div>
                    <div style={{fontSize:18,fontWeight:900,color:T.gold,letterSpacing:2}}>{"GAME TIME"}</div>
                    <div style={{fontSize:12,color:T.text,marginTop:8}}>{userTeam.city+" "+userTeam.name+" vs "+oppTeam.city+" "+oppTeam.name}</div>
                    <div style={{fontSize:9,color:T.faint,marginTop:8,padding:"6px 12px",background:"rgba(255,255,255,0.03)",borderRadius:6}}>
                      {userIsHome?"ðŸŸï¸ HOME GAME â€” Opponent calls the toss":"âœˆï¸ ROAD GAME â€” You call the toss"}
                    </div>

                    {/* PHASE 1: Call heads or tails (road) or auto-call (home) */}
                    {ctState==="call"&&<div style={{marginTop:16,textAlign:"center"}}>
                      {!userIsHome?<div>
                        <div style={{fontSize:11,color:T.dim,marginBottom:8}}>{"The ref flips the coin. Call it!"}</div>
                        <div style={{display:"flex",gap:12}}>
                          {["Heads","Tails"].map(function(call){
                            return <button key={call} onClick={function(){
                              var newLg=Object.assign({},lg);
                              var flipResult=Math.random()<0.5?"Heads":"Tails";
                              newLg.coinTossCall=call;
                              newLg.coinTossResult=flipResult;
                              newLg.coinTossUserWon=(call===flipResult);
                              newLg.coinTossState="result";
                              setLiveGame986(newLg);
                            }} style={{padding:"12px 24px",borderRadius:8,cursor:"pointer",fontWeight:800,fontSize:13,
                              background:call==="Heads"?"linear-gradient(135deg,#d4a74b,#b8860b)":"linear-gradient(135deg,#94a3b8,#64748b)",
                              color:call==="Heads"?"#000":"#fff",border:"none",
                              boxShadow:"0 3px 10px rgba(0,0,0,0.3)"}}>
                              {(call==="Heads"?"ðŸ‘‘":"ðŸ¦…")+" "+call}
                            </button>;
                          })}
                        </div>
                      </div>:<div>
                        <div style={{fontSize:11,color:T.dim,marginBottom:8}}>{"The visitor calls the toss..."}</div>
                        <button onClick={function(){
                          var newLg=Object.assign({},lg);
                          var oppCall=Math.random()<0.5?"Heads":"Tails";
                          var flipResult=Math.random()<0.5?"Heads":"Tails";
                          newLg.coinTossCall=oppCall;
                          newLg.coinTossResult=flipResult;
                          newLg.coinTossUserWon=(oppCall!==flipResult);// user wins when opponent's call is WRONG
                          newLg.coinTossState="result";
                          setLiveGame986(newLg);
                        }} style={{padding:"12px 30px",borderRadius:8,cursor:"pointer",fontWeight:800,fontSize:13,
                          background:"linear-gradient(135deg,#d4a74b,#b8860b)",color:"#000",border:"none"}}>
                          {"ðŸª™ Flip the Coin"}
                        </button>
                      </div>}
                    </div>}

                    {/* PHASE 2: Show result */}
                    {ctState==="result"&&<div style={{marginTop:16,textAlign:"center"}}>
                      <div style={{fontSize:28,fontWeight:900,color:T.gold,marginBottom:4}}>{lg.coinTossResult==="Heads"?"ðŸ‘‘":"ðŸ¦…"}</div>
                      <div style={{fontSize:16,fontWeight:900,color:T.text}}>{"It's "+lg.coinTossResult+"!"}</div>
                      <div style={{fontSize:11,color:lg.coinTossUserWon?T.green:T.red,marginTop:4,fontWeight:700}}>
                        {lg.coinTossUserWon?"You WON the toss!":"You LOST the toss."}
                      </div>
                      {!userIsHome&&<div style={{fontSize:9,color:T.dim,marginTop:2}}>{"You called "+lg.coinTossCall}</div>}
                      <button onClick={function(){
                        var newLg=Object.assign({},lg);
                        newLg.coinTossState="choice";
                        setLiveGame986(newLg);
                      }} style={{marginTop:12,padding:"10px 24px",borderRadius:8,cursor:"pointer",fontWeight:700,fontSize:11,
                        background:"rgba(255,255,255,0.06)",border:"1px solid "+T.border,color:T.text}}>
                        {"Continue â–¶"}
                      </button>
                    </div>}

                    {/* PHASE 3: Winner chooses */}
                    {ctState==="choice"&&<div style={{marginTop:16,textAlign:"center"}}>
                      {lg.coinTossUserWon?<div>
                        <div style={{fontSize:11,color:T.dim,marginBottom:10}}>{"You won the toss! What do you want to do?"}</div>
                        <div style={{display:"flex",flexDirection:"column",gap:6,maxWidth:260}}>
                          {[
                            {id:"receive",label:"ðŸ“¥ Receive",desc:"Get the ball first"},
                            {id:"kick",label:"ðŸ“¤ Kick Off",desc:"Give opponent the ball, receive in 2nd half"},
                            {id:"defer",label:"â¸ï¸ Defer to 2nd Half",desc:"Let opponent choose now, you choose after halftime"}
                          ].map(function(opt){
                            return <button key={opt.id} onClick={function(){
                              var newLg=Object.assign({},lg);
                              var userSide=userIsHome?"home":"away";
                              var oppSide=userIsHome?"away":"home";
                              if(opt.id==="receive"){
                                newLg.possession=oppSide;newLg.receivedFirst=userSide;
                              }else if(opt.id==="kick"){
                                newLg.possession=userSide;newLg.receivedFirst=oppSide;
                              }else{// defer
                                // Opponent receives first, user gets ball in 2nd half
                                newLg.possession=userSide;newLg.receivedFirst=oppSide;
                                newLg.deferredTo2ndHalf=userSide;
                              }
                              newLg.phase="kickoff";newLg.kickType="normal";
                              newLg.log.push("â”€â”€ Q1 â”€â”€");
                              LIVE_GAME_986.generateOtherScores(newLg,teams,sched,season.week);
                              LIVE_GAME_986.startDrive(newLg);
                              setLiveGame986(newLg);setLiveResult986(null);
                            }} style={{padding:"10px 16px",borderRadius:8,cursor:"pointer",textAlign:"left",
                              background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",
                              display:"flex",alignItems:"center",gap:10}}>
                              <div style={{fontSize:11,fontWeight:700,color:T.text}}>{opt.label}</div>
                              <div style={{fontSize:9,color:T.dim,flex:1,textAlign:"right"}}>{opt.desc}</div>
                            </button>;
                          })}
                        </div>
                      </div>:<div>
                        <div style={{fontSize:11,color:T.dim,marginBottom:8}}>{"Opponent won the toss..."}</div>
                        {(function(){
                          // Use stored AI choice or generate once
                          var aiPick=lg.aiCoinChoice;
                          if(!aiPick){
                            var aiChoice=Math.random();
                            aiPick=aiChoice<0.90?"receive":(aiChoice<0.95?"kick":"defer");
                            // Store immediately so it doesn't recalculate
                            lg.aiCoinChoice=aiPick;
                          }
                          var aiDesc=aiPick==="receive"?"They elect to RECEIVE.":aiPick==="kick"?"They elect to KICK OFF.":"They DEFER to the 2nd half.";
                          return <div>
                            <div style={{fontSize:13,fontWeight:700,color:T.gold,marginBottom:12}}>{aiDesc}</div>
                            <button onClick={function(){
                              var newLg=Object.assign({},lg);
                              var userSide=userIsHome?"home":"away";
                              var oppSide=userIsHome?"away":"home";
                              if(aiPick==="receive"){
                                newLg.possession=userSide;newLg.receivedFirst=oppSide;
                              }else if(aiPick==="kick"){
                                newLg.possession=oppSide;newLg.receivedFirst=userSide;
                              }else{
                                newLg.possession=oppSide;newLg.receivedFirst=userSide;
                                newLg.deferredTo2ndHalf=oppSide;
                              }
                              newLg.phase="kickoff";newLg.kickType="normal";
                              newLg.log.push("â”€â”€ Q1 â”€â”€");
                              LIVE_GAME_986.generateOtherScores(newLg,teams,sched,season.week);
                              LIVE_GAME_986.startDrive(newLg);
                              setLiveGame986(newLg);setLiveResult986(null);
                            }} style={{padding:"12px 30px",borderRadius:8,cursor:"pointer",fontWeight:800,fontSize:13,
                              background:"linear-gradient(135deg,#d4a74b,#b8860b)",color:"#000",border:"none"}}>
                              {"ðŸˆ KICK OFF!"}
                            </button>
                          </div>;
                        })()}
                      </div>}
                    </div>}
                  </div>;
                })()}

                {/* HALFTIME v99.1 â€” Broadcast Show */}
                {lg.phase==="halftime"&&(function(){
                  var hs=lg.stats&&lg.stats.home?lg.stats.home:{};
                  var as=lg.stats&&lg.stats.away?lg.stats.away:{};
                  var hPss=hs.passYds||0;var aPss=as.passYds||0;
                  var hRsh=hs.rushYds||0;var aRsh=as.rushYds||0;
                  var hFst=hs.firstDowns||0;var aFst=as.firstDowns||0;
                  var hTO=(hs.int||0)+(hs.fumbles||0);var aTO=(as.int||0)+(as.fumbles||0);
                  var potg=LIVE_GAME_986.getPOTG(lg);
                  var adjSel=lg.halfAdj991;
                  var ADJS991=[
                    {type:"tempo",label:"âš¡ PUSH THE TEMPO",desc:"Attack downfield â€” full playbook open",offEdge:2.5,defEdge:0,detail:"+2.5 offensive edge 2nd half",col:T.gold,rbg:"212,167,75"},
                    {type:"defense",label:"ðŸ›¡ï¸ TIGHTEN DEFENSE",desc:"Shut them down â€” stop the big play",offEdge:0,defEdge:-1.5,detail:"âˆ’1.5 vs opponent offense 2nd half",col:"#60a5fa",rbg:"59,130,246"},
                    {type:"balanced",label:"âš–ï¸ STAY BALANCED",desc:"Trust the system â€” steady execution wins",offEdge:1.5,defEdge:-0.5,detail:"+1.5 off / âˆ’0.5 def edge 2nd half",col:"#a78bfa",rbg:"167,139,250"}
                  ];
                  function mkBar991(hv,av,lbl){
                    var tot=hv+av;var hp=tot>0?Math.round(hv/tot*100):50;var ap=100-hp;
                    return <div style={{marginBottom:7}}>
                      <div style={{display:"flex",justifyContent:"space-between",fontSize:9,marginBottom:2}}>
                        <span style={{color:hv>av&&tot>0?T.gold:T.dim,fontWeight:hv>av?800:400}}>{hv}</span>
                        <span style={{color:T.faint,fontSize:8,letterSpacing:1}}>{lbl}</span>
                        <span style={{color:av>hv?"#60a5fa":T.dim,fontWeight:av>hv?800:400}}>{av}</span>
                      </div>
                      <div style={{height:4,display:"flex",borderRadius:2,overflow:"hidden",background:"rgba(255,255,255,0.05)"}}>
                        <div style={{width:hp+"%",background:"rgba(212,167,75,0.65)",transition:"width 0.3s"}}/>
                        <div style={{width:ap+"%",background:"rgba(59,130,246,0.65)",transition:"width 0.3s"}}/>
                      </div>
                    </div>;
                  }
                  return <div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"14px 14px",overflowY:"auto",width:"100%",maxWidth:460,margin:"0 auto"}}>
                    <div style={{width:"100%",textAlign:"center",padding:"8px 0 12px",borderBottom:"1px solid rgba(212,167,75,0.18)",marginBottom:12}}>
                      <div style={{fontSize:9,fontWeight:800,letterSpacing:3,color:"#60a5fa",marginBottom:4}}>{"ðŸ“º HALFTIME SHOW"}</div>
                      <div style={{fontSize:30,fontWeight:900,color:T.text,fontFamily:"monospace",letterSpacing:2}}>
                        <span style={{color:lg.hScore>=lg.aScore?T.gold:"rgba(255,255,255,0.45)"}}>{lg.hScore}</span>
                        <span style={{color:T.faint,margin:"0 10px"}}>{"â€“"}</span>
                        <span style={{color:lg.aScore>lg.hScore?T.gold:"rgba(255,255,255,0.45)"}}>{lg.aScore}</span>
                      </div>
                      <div style={{display:"flex",justifyContent:"center",gap:24,marginTop:3,fontSize:9,color:T.dim}}>
                        <span style={{fontWeight:700,color:T.gold}}>{lg.homeTeam.abbr}</span>
                        <span style={{fontWeight:700,color:"#60a5fa"}}>{lg.awayTeam.abbr}</span>
                      </div>
                      <div style={{marginTop:8,fontSize:11,fontWeight:800,color:uScore>oScore?T.green:uScore<oScore?"#ef4444":T.gold}}>
                        {uScore>oScore?"You lead by "+(uScore-oScore)+" â€” protect it!":uScore<oScore?"Down by "+(oScore-uScore)+". Time to adjust.":"All tied at the half!"}
                      </div>
                    </div>
                    <div style={{width:"100%",marginBottom:12}}>
                      <div style={{fontSize:8,fontWeight:800,letterSpacing:2,color:T.faint,textAlign:"center",marginBottom:8}}>{"â”€â”€ 1ST HALF STATS â”€â”€"}</div>
                      <div style={{display:"flex",justifyContent:"space-between",marginBottom:5,fontSize:9}}>
                        <span style={{color:T.gold,fontWeight:700}}>{lg.homeTeam.abbr}</span>
                        <span/>
                        <span style={{color:"#60a5fa",fontWeight:700}}>{lg.awayTeam.abbr}</span>
                      </div>
                      {mkBar991(hPss,aPss,"PASS YDS")}
                      {mkBar991(hRsh,aRsh,"RUSH YDS")}
                      {mkBar991(hFst,aFst,"1ST DOWNS")}
                      {mkBar991(Math.max(0,4-hTO),Math.max(0,4-aTO),"BALL SECURITY")}
                    </div>
                    {potg&&<div style={{width:"100%",padding:"7px 12px",background:"rgba(212,167,75,0.06)",borderRadius:8,border:"1px solid rgba(212,167,75,0.15)",marginBottom:12}}>
                      <div style={{fontSize:8,fontWeight:800,letterSpacing:1,color:T.gold,marginBottom:3}}>{"â­ PLAYER OF THE GAME SO FAR"}</div>
                      <div style={{display:"flex",alignItems:"center",gap:10}}>
                        <span style={{fontSize:13,fontWeight:900,color:T.text}}>{potg.name}</span>
                        {potg.statLine&&<span style={{fontSize:9,color:T.dim}}>{potg.statLine}</span>}
                      </div>
                    </div>}
                    <div style={{width:"100%",marginBottom:12}}>
                      <div style={{fontSize:8,fontWeight:800,letterSpacing:2,color:T.gold,textAlign:"center",marginBottom:8}}>{"â”€â”€ HALFTIME ADJUSTMENTS â”€â”€"}</div>
                      {ADJS991.map(function(adj,ai){
                        var sel=adjSel&&adjSel.type===adj.type;
                        return <button key={ai} onClick={function(){
                          var newLg=Object.assign({},lg);
                          newLg.halfAdj991={type:adj.type,label:adj.label,offEdge:adj.offEdge,defEdge:adj.defEdge};
                          setLiveGame986(newLg);
                        }} style={{display:"block",width:"100%",marginBottom:6,padding:"9px 12px",borderRadius:8,cursor:"pointer",textAlign:"left",border:"2px solid "+(sel?adj.col:"rgba(255,255,255,0.08)"),background:sel?"rgba("+adj.rbg+",0.12)":"rgba(255,255,255,0.02)",transition:"border 0.15s"}}>
                          <div style={{fontSize:11,fontWeight:900,color:sel?adj.col:T.text}}>{adj.label+(sel?" âœ“":"")}</div>
                          <div style={{fontSize:9,color:sel?adj.col:T.dim,marginTop:1}}>{adj.desc}</div>
                          <div style={{fontSize:8,color:"rgba(255,255,255,0.22)",marginTop:2}}>{adj.detail}</div>
                        </button>;
                      })}
                    </div>
                    <button onClick={function(){
                      var newLg=Object.assign({},lg);
                      newLg.clock=900;newLg.twoMinWarned=false;
                      newLg.phase="kickoff";newLg.kickType="normal";
                      if(!newLg.halfAdj991){newLg.halfAdj991={type:"balanced",label:"âš–ï¸ STAY BALANCED",offEdge:1.5,defEdge:-0.5};}
                      setLiveGame986(newLg);setLiveResult986(null);
                    }} style={{width:"100%",padding:"13px",borderRadius:10,cursor:"pointer",fontWeight:900,fontSize:14,letterSpacing:1,background:adjSel?"linear-gradient(135deg,"+T.gold+",#b8860b)":"rgba(212,167,75,0.55)",color:"#000",border:"none",boxShadow:adjSel?"0 4px 18px rgba(212,167,75,0.35)":"none",transition:"all 0.25s"}}>
                      {"â–¶ START 2ND HALF"}
                    </button>
                    {!adjSel&&<div style={{fontSize:8,color:T.faint,marginTop:5,textAlign:"center"}}>{"Select a halftime adjustment for a 2nd half edge â€” or start now"}</div>}
                  </div>;
                })()}

                {/* â•â•â• KICKOFF PHASE â•â•â• */}
                {lg.phase==="kickoff"&&<div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20}}>
                  {(function(){
                    var kickTeam=LIVE_GAME_986.offTeam(lg);// kicking team is current possession
                    var recTeam=LIVE_GAME_986.defTeam(lg);
                    var isUserKicking=LIVE_GAME_986.isUserPoss(lg);
                    var scoreDiff=uScore-oScore;
                    var canOnside=lg.quarter>=4&&scoreDiff<0&&isUserKicking;// only user can choose onside

                    // If OPPONENT is kicking, auto-resolve immediately
                    if(!isUserKicking){
                      return <React.Fragment>
                        <div style={{fontSize:36,marginBottom:8}}>{"ðŸˆ"}</div>
                        <div style={{fontSize:14,fontWeight:900,color:T.gold,letterSpacing:2}}>{"KICKOFF"}</div>
                        <div style={{fontSize:11,color:T.text,marginTop:6}}>{kickTeam.abbr+" kicks to "+recTeam.abbr}</div>
                        <button onClick={function(){
                          var newLg=JSON.parse(JSON.stringify(lg));newLg.homeTeam=lg.homeTeam;newLg.awayTeam=lg.awayTeam;
                          // AI decides: onside kick if losing by 9+ in Q4 final 5 min, otherwise normal
                          var aiScoreDiff=(LIVE_GAME_986.side(lg)==="home")?(lg.hScore-lg.aScore):(lg.aScore-lg.hScore);
                          var aiOnside=lg.quarter>=4&&lg.clock<=300&&aiScoreDiff<=-9&&Math.random()<0.7;
                          LIVE_GAME_986.resolveKickoff(newLg,aiOnside?"onside":"normal");
                          setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
                        }} style={{marginTop:20,padding:"14px 32px",borderRadius:10,cursor:"pointer",fontWeight:900,fontSize:14,
                          background:"linear-gradient(135deg,#d4a74b,#b8860b)",color:"#000",border:"none",
                          boxShadow:"0 4px 12px rgba(212,167,75,0.3)"}}>
                          {"â–¶ RECEIVE KICK"}
                        </button>
                      </React.Fragment>;
                    }

                    // User is kicking â€” show kick options
                    return <React.Fragment>
                      <div style={{fontSize:36,marginBottom:8}}>{"ðŸˆ"}</div>
                      <div style={{fontSize:14,fontWeight:900,color:T.gold,letterSpacing:2}}>{"KICKOFF"}</div>
                      <div style={{fontSize:11,color:T.text,marginTop:6}}>{kickTeam.abbr+" kicks to "+recTeam.abbr}</div>
                      {lg.lastPlay&&lg.lastPlay.isKick!==true&&<div style={{fontSize:10,color:T.dim,marginTop:4,padding:"4px 10px",
                        background:"rgba(255,255,255,0.03)",borderRadius:6}}>
                        {lg.lastPlay.desc}
                      </div>}
                      <div style={{display:"flex",gap:10,marginTop:20,flexWrap:"wrap",justifyContent:"center"}}>
                        <button onClick={function(){
                          var newLg=JSON.parse(JSON.stringify(lg));newLg.homeTeam=lg.homeTeam;newLg.awayTeam=lg.awayTeam;
                          LIVE_GAME_986.resolveKickoff(newLg,"normal");
                          setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
                        }} style={{padding:"14px 32px",borderRadius:10,cursor:"pointer",fontWeight:900,fontSize:14,
                          background:"linear-gradient(135deg,#d4a74b,#b8860b)",color:"#000",border:"none",
                          boxShadow:"0 4px 12px rgba(212,167,75,0.3)"}}>
                          {"ðŸ¦¶ KICK IT DEEP"}
                        </button>
                        {canOnside&&<button onClick={function(){
                          var newLg=JSON.parse(JSON.stringify(lg));newLg.homeTeam=lg.homeTeam;newLg.awayTeam=lg.awayTeam;
                          LIVE_GAME_986.resolveKickoff(newLg,"onside");
                          setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
                        }} style={{padding:"14px 24px",borderRadius:10,cursor:"pointer",fontWeight:900,fontSize:13,
                          background:"rgba(239,68,68,0.12)",border:"2px solid rgba(239,68,68,0.4)",color:T.red}}>
                          {"ðŸŽ² ONSIDE KICK"}
                        </button>}
                      </div>
                      {canOnside&&<div style={{fontSize:8,color:T.faint,marginTop:8}}>{"Onside kick: ~12% recovery rate â€¢ High risk, high reward"}</div>}
                    </React.Fragment>;
                  })()}
                </div>}

                {/* â•â•â• 2-MINUTE WARNING OVERLAY â•â•â• */}
                {lg.pendingTwoMin&&lg.phase==="play_call"&&<div style={{padding:16,display:"flex",flexDirection:"column",alignItems:"center",
                  background:"linear-gradient(135deg,rgba(239,68,68,0.08),rgba(239,68,68,0.02))",borderBottom:"1px solid rgba(239,68,68,0.2)"}}>
                  <div style={{fontSize:14,fontWeight:900,color:"#ef4444",letterSpacing:2}}>{"â±ï¸ TWO-MINUTE WARNING"}</div>
                  <div style={{fontSize:10,color:T.dim,marginTop:4}}>
                    {lg.quarter===2?"End of the first half approaching!":"Final 2 minutes of the game!"}
                    {" â€¢ "}{lg.hScore+" - "+lg.aScore}
                  </div>
                  <button onClick={function(){
                    var newLg=Object.assign({},lg);newLg.pendingTwoMin=false;
                    setLiveGame986(newLg);setLiveResult986(null);
                  }} style={{marginTop:10,padding:"8px 24px",borderRadius:6,cursor:"pointer",fontWeight:700,fontSize:11,
                    background:"rgba(239,68,68,0.15)",border:"1px solid rgba(239,68,68,0.3)",color:T.red}}>
                    {"â–¶ RESUME PLAY"}
                  </button>
                </div>}

                {/* POSTGAME */}
                {isDone&&<div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20}}>
                  <div style={{fontSize:20,fontWeight:900,color:uScore>oScore?T.green:T.red,letterSpacing:2}}>
                    {uScore>oScore?"ðŸ† VICTORY!":"ðŸ’” DEFEAT"}
                  </div>
                  <div style={{fontSize:36,fontWeight:900,color:T.gold,marginTop:4}}>{lg.hScore+" - "+lg.aScore}</div>
                  <div style={{fontSize:10,color:T.dim,marginTop:4}}>{lg.totalPlays+" total plays called"}</div>
                  {/* POTG */}
                  {(function(){var potg=LIVE_GAME_986.getPOTG(lg);
                    return potg?<div style={{marginTop:8,padding:"6px 16px",background:"rgba(212,167,75,0.08)",
                      borderRadius:8,border:"1px solid rgba(212,167,75,0.2)",textAlign:"center"}}>
                      <div style={{fontSize:9,fontWeight:800,letterSpacing:1,color:T.gold}}>{"â­ PLAYER OF THE GAME"}</div>
                      <div style={{fontSize:14,fontWeight:900,color:T.text,marginTop:2}}>{potg.name}</div>
                      {lg.boxScore&&lg.boxScore[potg.name]&&(function(){
                        var bs=lg.boxScore[potg.name];var statLine=[];
                        if(bs.att>0)statLine.push(bs.comp+"/"+bs.att+", "+bs.passYds+" yds"+(bs.passTD?", "+bs.passTD+" TD":"")+(bs.int?", "+bs.int+" INT":""));
                        if(bs.rushAtt>0)statLine.push(bs.rushAtt+" car, "+bs.rushYds+" yds"+(bs.rushTD?", "+bs.rushTD+" TD":""));
                        if(bs.rec>0)statLine.push(bs.rec+" rec, "+bs.recYds+" yds"+(bs.recTD?", "+bs.recTD+" TD":""));
                        return statLine.length>0?<div style={{fontSize:9,color:T.dim,marginTop:2}}>{statLine.join(" | ")}</div>:null;
                      })()}
                    </div>:null;
                  })()}
                  {/* Top Box Score Lines */}
                  {lg.boxScore&&Object.keys(lg.boxScore).length>0&&<div style={{marginTop:8,width:"100%",maxWidth:340}}>
                    <div style={{fontSize:8,fontWeight:800,letterSpacing:1,color:T.faint,textAlign:"center"}}>{"BOX SCORE LEADERS"}</div>
                    {Object.keys(lg.boxScore).slice(0,6).map(function(name,i){
                      var bs=lg.boxScore[name];var line="";
                      if(bs.att>0)line+=bs.comp+"/"+bs.att+", "+bs.passYds+" pass yds"+(bs.passTD?", "+bs.passTD+" TD":"");
                      if(bs.rushAtt>0)line+=(line?" | ":"")+bs.rushAtt+" car, "+bs.rushYds+" rush yds"+(bs.rushTD?", "+bs.rushTD+" TD":"");
                      if(bs.rec>0)line+=(line?" | ":"")+bs.rec+" rec, "+bs.recYds+" yds"+(bs.recTD?", "+bs.recTD+" TD":"");
                      if(bs.sacks>0&&bs.pos==="DL")line+=(line?" | ":"")+bs.sacks+" sack"+(bs.sacks>1?"s":"");
                      if(!line)return null;
                      return <div key={i} style={{fontSize:8,padding:"2px 6px",borderBottom:"1px solid "+T.border+"22",
                        display:"flex",justifyContent:"space-between"}}>
                        <span style={{color:T.text,fontWeight:600}}>{name.split(" ").pop()}</span>
                        <span style={{color:T.dim}}>{line}</span>
                      </div>;
                    })}
                  </div>}
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:16,fontSize:10,width:"100%",maxWidth:340}}>
                    {[["1st Downs",lg.stats.home.firstDowns,lg.stats.away.firstDowns],
                      ["Pass Yds",lg.stats.home.passYds,lg.stats.away.passYds],
                      ["Rush Yds",lg.stats.home.rushYds,lg.stats.away.rushYds],
                      ["Pass TDs",lg.stats.home.passTD,lg.stats.away.passTD],
                      ["Rush TDs",lg.stats.home.rushTD,lg.stats.away.rushTD],
                      ["Turnovers",lg.stats.home.int+lg.stats.home.fumbles,lg.stats.away.int+lg.stats.away.fumbles],
                      ["Sacks",lg.stats.away.sacks,lg.stats.home.sacks],
                      ["Kick Ret Yds",lg.stats.home.kickRetYds||0,lg.stats.away.kickRetYds||0],
                      ["Punt Ret Yds",lg.stats.home.puntRetYds||0,lg.stats.away.puntRetYds||0],
                      ["Penalties",(lg.stats.home.penalties||0)+"/"+(lg.stats.home.penYds||0),(lg.stats.away.penalties||0)+"/"+(lg.stats.away.penYds||0)],
                      ["TOP",Math.floor((lg.stats.home.TOP||0)/60)+":"+("0"+((lg.stats.home.TOP||0)%60)).slice(-2),Math.floor((lg.stats.away.TOP||0)/60)+":"+("0"+((lg.stats.away.TOP||0)%60)).slice(-2)],
                      ["Plays",lg.stats.home.plays,lg.stats.away.plays]
                    ].map(function(r,i){var hBetter=r[1]>(r[0]==="Turnovers"||r[0]==="Sacks"?r[2]+1:r[2]);
                      return <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"3px 8px",borderBottom:"1px solid "+T.border+"33"}}>
                      <span style={{color:hBetter?T.green:T.dim,fontWeight:hBetter?700:400}}>{r[1]}</span>
                      <span style={{color:T.faint,fontSize:9}}>{r[0]}</span>
                      <span style={{color:!hBetter?T.green:T.dim,fontWeight:!hBetter?700:400}}>{r[2]}</span>
                    </div>;})}
                  </div>
                  <div style={{display:"flex",gap:8,marginTop:20}}>
                    <button onClick={function(){
                      var nt=teams.slice();var ns=sched.slice();var gr=lg._gameRef;
                      // Clean up in-game injury flags
                      [lg.homeTeam,lg.awayTeam].forEach(function(t){t.roster.forEach(function(p){delete p._gameInjured;});});
                      var gi=ns.findIndex(function(x){return x.home===gr.home&&x.away===gr.away&&x.week===gr.week;});
                      if(gi>=0){ns[gi].played=true;ns[gi].result={home:lg.hScore,away:lg.aScore,qtrs:lg.qtrs,log:lg.log,box:lg.stats,leaders:null,recap:null};}
                      var h=nt.find(function(t){return t.id===gr.home;}),a=nt.find(function(t){return t.id===gr.away;});
                      if(h&&a){if(lg.hScore>lg.aScore){h.wins++;a.losses++;h.streak=Math.max(1,(h.streak||0)+1);a.streak=Math.min(-1,(a.streak||0)-1);}
                        else{a.wins++;h.losses++;a.streak=Math.max(1,(a.streak||0)+1);h.streak=Math.min(-1,(h.streak||0)-1);}
                        h.pf+=lg.hScore;h.pa+=lg.aScore;a.pf+=lg.aScore;a.pa+=lg.hScore;}
                      setTeams(nt);setSched(ns);AUDIO.play(uScore>oScore?"victory":"defeat");
                      addN("ðŸˆ "+lg.homeTeam.abbr+" "+lg.hScore+"-"+lg.aScore+" "+lg.awayTeam.abbr+(uScore>oScore?" âœ… W":" âŒ L"),uScore>oScore?"green":"red");
                      setLiveGame986(null);setLiveResult986(null);doSave(nt,ns);
                    }} style={{padding:"12px 24px",borderRadius:8,cursor:"pointer",fontWeight:800,fontSize:13,
                      background:"linear-gradient(135deg,"+T.green+",#16a34a)",color:"#000",border:"none"}}>{"âœ… Confirm"}</button>
                    <button onClick={function(){
                      // Clean up in-game injury flags
                      if(lg.homeTeam)lg.homeTeam.roster.forEach(function(p){delete p._gameInjured;});
                      if(lg.awayTeam)lg.awayTeam.roster.forEach(function(p){delete p._gameInjured;});
                      setLiveGame986(null);setLiveResult986(null);AUDIO.play("hub");}} style={{
                      padding:"12px 16px",borderRadius:8,cursor:"pointer",fontWeight:700,fontSize:11,
                      background:"rgba(255,255,255,0.06)",color:T.dim,border:"1px solid "+T.border}}>{"âœ– Discard"}</button>
                  </div>
                </div>}

                {/* â•â•â• GAME-WINNING DRIVE BANNER â•â•â• */}
                {lg.isGWD&&lg.phase==="play_call"&&!lg.pendingTwoMin&&<div style={{flexShrink:0,padding:"4px 0",textAlign:"center",
                  background:"linear-gradient(90deg,rgba(239,68,68,0.15),rgba(212,167,75,0.15),rgba(239,68,68,0.15))",
                  borderBottom:"1px solid rgba(239,68,68,0.3)"}}>
                  <div style={{fontSize:10,fontWeight:900,letterSpacing:2,
                    color:"#ef4444",textShadow:"0 0 10px rgba(239,68,68,0.5)"}}>{"ðŸˆ GAME-WINNING DRIVE ðŸˆ"}</div>
                </div>}

                {/* â•â•â• CLUTCH MODE INDICATOR â•â•â• */}
                {(function(){var scoreDiffC=Math.abs(lg.hScore-lg.aScore);
                  return(lg.quarter>=4&&scoreDiffC<=8&&lg.phase==="play_call"&&!lg.pendingTwoMin)?
                  <div style={{flexShrink:0,textAlign:"center",padding:"2px 0",
                    background:"rgba(239,68,68,0.04)"}}>
                    <span style={{fontSize:8,fontWeight:800,letterSpacing:1,color:"#f59e0b"}}>{"ðŸ”¥ CLUTCH MODE"}</span>
                  </div>:null;
                })()}

                {/* â•â•â• CROWD METER â•â•â• */}
                {!isDone&&lg.phase!=="coin_toss"&&lg.phase!=="halftime"&&(function(){
                  var cl=LIVE_GAME_986.getCrowdLevel(lg);
                  var crowdPct=Math.max(5,Math.min(95,((lg.crowd||0)+10)/20*100));
                  var advLine=(lg.crowd||0)>=7?getHomeAdvLine991(lg.homeTeam):null;// v99.2
                  return <div style={{flexShrink:0,maxWidth:500,margin:"0 auto"}}>
                    <div style={{padding:"2px 16px",display:"flex",alignItems:"center",gap:6}}>
                      <span style={{fontSize:7,color:cl.color,fontWeight:800,width:75,textAlign:"right"}}>{cl.label}</span>
                      <div style={{flex:1,height:4,borderRadius:2,background:"rgba(255,255,255,0.05)",overflow:"hidden"}}>
                        <div style={{height:"100%",width:crowdPct+"%",borderRadius:2,
                          background:"linear-gradient(90deg,#475569,"+cl.color+")",
                          transition:"width 0.5s ease-out"}} />
                      </div>
                      <span style={{fontSize:7,color:T.faint,width:40}}>{"ðŸŸï¸ "+(lg.crowd>0?"+":"")+Math.round(lg.crowd||0)}</span>
                    </div>
                    {advLine&&<div style={{padding:"2px 16px 3px",textAlign:"center",fontSize:8,fontWeight:800,color:"#ef4444",letterSpacing:0.5}}>{advLine}</div>}
                  </div>;
                })()}

                {/* â•â•â• PLAY RESULT DISPLAY â€” Enhanced with NGS, injury, challenge â•â•â• */}
                {lg.lastPlay&&(lg.phase==="play_call"||lg.phase==="kickoff")&&<div style={{flexShrink:0,margin:"6px 12px",padding:"10px 14px",borderRadius:8,
                  background:lg.lastPlay.isTD?"rgba(212,167,75,0.12)":lg.lastPlay.turnover||lg.lastPlay.type==="turnover_on_downs"?"rgba(239,68,68,0.10)":
                    lg.lastPlay.type==="sack"?"rgba(249,115,22,0.08)":lg.lastPlay.type==="incomplete"?"rgba(100,116,139,0.08)":
                    lg.lastPlay.isPenalty?"rgba(251,191,36,0.08)":
                    lg.lastPlay.isKick?"rgba(59,130,246,0.08)":
                    lg.lastPlay.type==="challenge_won"?"rgba(52,211,153,0.12)":
                    lg.lastPlay.type==="challenge_lost"?"rgba(239,68,68,0.08)":
                    lg.lastPlay.big?"rgba(52,211,153,0.08)":"rgba(255,255,255,0.03)",
                  border:"1px solid "+(lg.lastPlay.isTD?T.gold:lg.lastPlay.turnover||lg.lastPlay.type==="turnover_on_downs"?T.red:
                    lg.lastPlay.isPenalty?"#fbbf24":lg.lastPlay.isKick?"#3b82f6":lg.lastPlay.big?T.green:T.border)+"44",
                  // Animation classes
                  animation:lg.lastPlay.isTD?"none":lg.lastPlay.turnover?"none":"none"}}>
                  {/* TD celebration overlay */}
                  {lg.lastPlay.isTD&&<div style={{textAlign:"center",marginBottom:4,fontSize:20,
                    animation:"pulse 0.5s ease-in-out"}}>{"ðŸŽ‰ðŸˆðŸŽ‰"}</div>}
                  {lg.lastPlay.commentary&&<div style={{fontSize:9,color:T.cyan,fontStyle:"italic",marginBottom:3}}>{"ðŸ“¢ "+lg.lastPlay.commentary}</div>}
                  <div style={{fontSize:12,fontWeight:700,lineHeight:1.4,
                    color:lg.lastPlay.isTD?T.gold:lg.lastPlay.turnover||lg.lastPlay.type==="turnover_on_downs"?T.red:
                      lg.lastPlay.type==="sack"?T.orange:lg.lastPlay.isPenalty?"#fbbf24":
                      lg.lastPlay.isKick?"#60a5fa":lg.lastPlay.big?T.green:
                      lg.lastPlay.type==="challenge_won"?T.green:lg.lastPlay.type==="challenge_lost"?T.red:T.text}}>
                    {lg.lastPlay.desc}
                  </div>
                  {/* Broadcast voice quote v99.1 */}
                  {(function(){
                    var p=lg.lastPlay;
                    if(!p.isTD&&!p.turnover&&p.type!=="sack"&&!p.big&&p.type!=="safety")return null;
                    var ct=p.isTD?"td":p.type==="sack"?"sack":(p.turnover&&p.type==="fumble")?"fumble":p.turnover?"int":p.type==="safety"?"safety":"big";
                    var v=BROADCAST_VOICES_991.pick(lg);
                    var q=v&&v.calls[ct];
                    if(!q)return null;
                    var qcol=p.isTD?T.gold:p.turnover?"#ef4444":p.type==="sack"?T.orange:T.text;
                    return <div style={{marginTop:5,padding:"5px 8px",borderRadius:4,background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.05)"}}>
                      <div style={{fontSize:7,fontWeight:800,color:T.faint,letterSpacing:1,marginBottom:1}}>{(v.name||"").toUpperCase()}</div>
                      <div style={{fontSize:10,fontStyle:"italic",color:qcol}}>{"\u201c"+q+"\u201d"}</div>
                    </div>;
                  })()}
                  {lg.lastPlay.big&&!lg.lastPlay.isTD&&!lg.lastPlay.isKick&&<div style={{fontSize:10,color:T.gold,fontWeight:800,marginTop:2}}>{"âš¡ BIG PLAY!"}</div>}
                  {lg.lastPlay.isKick&&lg.lastPlay.big&&<div style={{fontSize:10,color:"#3b82f6",fontWeight:800,marginTop:2}}>{"âš¡ BIG RETURN!"}</div>}
                  {lg.lastPlay.type==="turnover_on_downs"&&<div style={{fontSize:10,color:T.red,fontWeight:800,marginTop:2}}>{"ðŸ“‰ TURNOVER ON DOWNS"}</div>}
                  {lg.lastPlay.type==="timeout"&&<div style={{fontSize:10,color:T.gold,fontWeight:800,marginTop:2}}>{"â¸ï¸ Clock Stopped"}</div>}

                  {/* Next Gen Stats */}
                  {lg.lastPlay.ngs&&<div style={{marginTop:4,padding:"3px 6px",borderRadius:4,
                    background:"rgba(96,165,250,0.06)",border:"1px solid rgba(96,165,250,0.1)",
                    display:"flex",gap:8,flexWrap:"wrap"}}>
                    <span style={{fontSize:7,fontWeight:800,color:"#60a5fa",letterSpacing:1}}>{"NGS"}</span>
                    {lg.lastPlay.ngs.compProb!==undefined&&<span style={{fontSize:8,color:T.dim}}>
                      {"Comp%: "+lg.lastPlay.ngs.compProb+"% â†’ "+(lg.lastPlay.ngs.completed?"âœ…":"âŒ")}
                    </span>}
                    {lg.lastPlay.ngs.yoe!==undefined&&<span style={{fontSize:8,
                      color:lg.lastPlay.ngs.yoe>3?T.green:lg.lastPlay.ngs.yoe<-2?T.red:T.dim}}>
                      {"YOE: "+(lg.lastPlay.ngs.yoe>0?"+":"")+lg.lastPlay.ngs.yoe}
                    </span>}
                  </div>}

                  {/* Matchup Wins/Losses */}
                  {lg.lastPlay.matchups&&lg.lastPlay.matchups.length>0&&<div style={{marginTop:4,padding:"4px 6px",borderRadius:4,
                    background:"rgba(168,85,247,0.04)",border:"1px solid rgba(168,85,247,0.08)"}}>
                    <div style={{fontSize:7,fontWeight:800,color:"#a855f7",letterSpacing:1,marginBottom:2}}>{"MATCHUPS"}</div>
                    {lg.lastPlay.matchups.map(function(m,mi){
                      return <div key={mi} style={{display:"flex",alignItems:"center",gap:4,fontSize:8,marginBottom:1}}>
                        <span style={{color:m.winner==="off"?T.green:m.winner==="def"?T.red:T.dim,fontWeight:700,width:8,textAlign:"center"}}>
                          {m.winner==="off"?"W":m.winner==="def"?"L":"â€”"}</span>
                        <span style={{color:m.winner==="off"?T.green:T.dim}}>{m.off}</span>
                        <span style={{color:T.faint}}>{"vs"}</span>
                        <span style={{color:m.winner==="def"?T.red:T.dim}}>{m.def}</span>
                        <span style={{color:T.faint,fontStyle:"italic",flex:1,textAlign:"right"}}>{"â€” "+m.desc}</span>
                      </div>;
                    })}
                  </div>}

                  {/* Injury notification */}
                  {lg.lastPlay.injury&&<div style={{marginTop:4,padding:"4px 8px",borderRadius:4,
                    background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.15)"}}>
                    <div style={{fontSize:9,fontWeight:700,color:T.red}}>
                      {"ðŸ¥ "+lg.lastPlay.injury.name+" ("+lg.lastPlay.injury.pos+") â€” "+lg.lastPlay.injury.type+" â€” "+lg.lastPlay.injury.severity}
                    </div>
                  </div>}

                  {/* Challenge button â€” only on turnovers the user didn't commit, before a new play */}
                  {lg.lastPlay.turnover&&!lg.challenged&&!LIVE_GAME_986.isUserPoss(lg)&&(function(){
                    var userSideTO=lg.userId===lg.homeTeam.id?"home":"away";
                    return lg.timeouts[userSideTO]>0?<button onClick={function(){
                      var newLg=JSON.parse(JSON.stringify(lg));newLg.homeTeam=lg.homeTeam;newLg.awayTeam=lg.awayTeam;
                      LIVE_GAME_986.challengePlay(newLg);
                      setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
                    }} style={{marginTop:6,padding:"6px 14px",borderRadius:6,cursor:"pointer",fontWeight:700,fontSize:10,
                      background:"rgba(239,68,68,0.10)",border:"1px solid rgba(239,68,68,0.3)",color:T.red,width:"100%"}}>
                      {"ðŸš© CHALLENGE (costs timeout if wrong â€” 40% overturn rate)"}
                    </button>:null;
                  })()}
                </div>}

                {/* â•â•â• PAT DECISION â•â•â• */}
                {lg.phase==="pat"&&(function(){
                  var isUserScoring=LIVE_GAME_986.isUserPoss(lg);
                  if(!isUserScoring){
                    // Opponent scored â€” AI auto-decides PAT (95% XP, 5% go for 2)
                    return <div style={{padding:20,display:"flex",flexDirection:"column",alignItems:"center"}}>
                      <div style={{fontSize:40,marginBottom:4}}>{"ðŸˆ"}</div>
                      <div style={{fontSize:16,fontWeight:900,color:T.red}}>{"OPPONENT TOUCHDOWN"}</div>
                      <div style={{fontSize:11,color:T.dim,marginTop:4}}>{LIVE_GAME_986.offTeam(lg).abbr+" scores!"}</div>
                      {lg.driveSummary&&<div style={{marginTop:5,padding:"3px 10px",borderRadius:5,
                        background:"rgba(239,68,68,0.05)",border:"1px solid rgba(239,68,68,0.12)"}}>
                        <span style={{fontSize:9,fontWeight:700,color:T.faint}}>
                          {lg.driveSummary.plays+" plays Â· "+Math.abs(lg.driveSummary.yards)+" yds Â· "+lg.driveSummary.time}
                        </span>
                      </div>}
                      {lg.driveComment994&&<div style={{marginTop:3,padding:"2px 10px",fontSize:9,color:T.cyan,fontStyle:"italic",textAlign:"center",opacity:0.8,lineHeight:1.4}}>{lg.driveComment994}</div>}
                      <button onClick={function(){
                        var aiChoice=Math.random()<0.95?"xp":"two_pt";
                        // In desperate situations, AI goes for 2 more often
                        var aiSide=LIVE_GAME_986.side(lg);
                        var aiScore=aiSide==="home"?lg.hScore:lg.aScore;
                        var oppAiScore=aiSide==="home"?lg.aScore:lg.hScore;
                        if(lg.quarter>=4&&(aiScore-oppAiScore===-2||aiScore-oppAiScore===5))aiChoice="two_pt";
                        doPAT(aiChoice);
                      }} style={{marginTop:16,padding:"12px 32px",borderRadius:8,cursor:"pointer",fontWeight:800,fontSize:13,
                        background:"rgba(255,255,255,0.06)",border:"1px solid "+T.border,color:T.text}}>
                        {"â–¶ CONTINUE"}
                      </button>
                    </div>;
                  }
                  // User scored â€” show PAT options
                  return <div style={{padding:20,display:"flex",flexDirection:"column",alignItems:"center"}}>
                    <div style={{fontSize:40,marginBottom:4}}>{"ðŸˆ"}</div>
                    <div style={{fontSize:16,fontWeight:900,color:T.gold}}>{"TOUCHDOWN!"}</div>
                    {lg.driveSummary&&<div style={{marginTop:5,padding:"3px 10px",borderRadius:5,
                      background:"rgba(212,167,75,0.06)",border:"1px solid rgba(212,167,75,0.12)"}}>
                      <span style={{fontSize:9,fontWeight:700,color:T.faint}}>
                        {lg.driveSummary.plays+" plays Â· "+Math.abs(lg.driveSummary.yards)+" yds Â· "+lg.driveSummary.time}
                      </span>
                    </div>}
                    <div style={{fontSize:11,color:T.dim,marginTop:6}}>{"Extra point or go for 2?"}</div>
                    <div style={{display:"flex",gap:10,marginTop:12}}>
                      <button onClick={function(){doPAT("xp");}} style={{padding:"12px 24px",borderRadius:8,cursor:"pointer",fontWeight:800,
                        background:"rgba(34,197,94,0.15)",border:"1px solid rgba(34,197,94,0.4)",color:T.green}}>{"ðŸ‘Ÿ Extra Point (94%)"}</button>
                      <button onClick={function(){doPAT("two_pt");}} style={{padding:"12px 24px",borderRadius:8,cursor:"pointer",fontWeight:800,
                        background:"rgba(239,68,68,0.10)",border:"1px solid rgba(239,68,68,0.3)",color:T.red}}>{"âœŒï¸ Go For 2 (48%)"}</button>
                    </div>
                  </div>;
                })()}

                {/* â•â•â• 4TH DOWN DECISION â•â•â• */}
                {lg.phase==="fourth_down"&&(function(){
                  var isUserOn4th=LIVE_GAME_986.isUserPoss(lg);
                  if(!isUserOn4th){
                    // Opponent's 4th down â€” AI auto-decides
                    return <div style={{padding:16,display:"flex",flexDirection:"column",alignItems:"center",
                      background:"linear-gradient(135deg,rgba(100,116,139,0.08),rgba(100,116,139,0.02))"}}>
                      <div style={{fontSize:14,fontWeight:900,color:T.dim,letterSpacing:1}}>{"OPPONENT 4TH DOWN"}</div>
                      <div style={{fontSize:11,color:T.faint,marginTop:4}}>
                        {"4th & "+lg.yardsToGo+" at the "+posStr}
                      </div>
                      <button onClick={function(){
                        // AI logic: FG if in range, go for it if short yardage in enemy territory or desperate, else punt
                        var fgDist=100-lg.fieldPos+17;
                        var aiChoice="punt";
                        if(fgDist<=52&&lg.fieldPos>=48)aiChoice="fg";
                        else if(lg.yardsToGo<=2&&lg.fieldPos>=60)aiChoice="go";
                        else if(lg.quarter>=4){
                          var aiSide=LIVE_GAME_986.side(lg);
                          var aiScore2=aiSide==="home"?lg.hScore:lg.aScore;
                          var oppScore2=aiSide==="home"?lg.aScore:lg.hScore;
                          if(oppScore2>aiScore2&&lg.clock<=300)aiChoice=lg.fieldPos>=55?"fg":"go";// desperate
                        }
                        doFourth(aiChoice);
                      }} style={{marginTop:12,padding:"10px 28px",borderRadius:8,cursor:"pointer",fontWeight:700,fontSize:12,
                        background:"rgba(255,255,255,0.06)",border:"1px solid "+T.border,color:T.text}}>
                        {"â–¶ SEE THEIR DECISION"}
                      </button>
                    </div>;
                  }
                  // User's 4th down â€” show options
                  return <div style={{padding:16,display:"flex",flexDirection:"column",alignItems:"center",
                    background:"linear-gradient(135deg,rgba(251,191,36,0.08),rgba(251,191,36,0.02))"}}>
                    <div style={{fontSize:14,fontWeight:900,color:T.gold,letterSpacing:1}}>{"4TH DOWN DECISION"}</div>
                    <div style={{fontSize:11,color:T.dim,marginTop:4}}>
                      {"4th & "+lg.yardsToGo+" at the "+posStr+" | "+(100-lg.fieldPos+17)+"yd FG attempt"}
                    </div>
                    {MFSN_FOURTH_DOWN_994.situational.fourthDownGo&&MFSN_FOURTH_DOWN_994.situational.fourthDownGo.length&&<div style={{fontSize:9,color:T.cyan,fontStyle:"italic",marginTop:3,textAlign:"center",opacity:0.8,maxWidth:280,lineHeight:1.4}}>{pick(MFSN_FOURTH_DOWN_994.situational.fourthDownGo)}</div>}
                    <div style={{display:"flex",gap:8,marginTop:12,flexWrap:"wrap",justifyContent:"center"}}>
                      {lg.fieldPos>=55&&<button onClick={function(){doFourth("fg");}} style={{padding:"10px 20px",borderRadius:8,cursor:"pointer",fontWeight:700,
                        background:"rgba(52,211,153,0.12)",border:"1px solid rgba(52,211,153,0.3)",color:T.green}}>
                        {"ðŸŽ¯ Field Goal ("+(100-lg.fieldPos+17)+"yd)"}</button>}
                      <button onClick={function(){doFourth("punt");}} style={{padding:"10px 20px",borderRadius:8,cursor:"pointer",fontWeight:700,
                        background:"rgba(100,116,139,0.12)",border:"1px solid rgba(100,116,139,0.3)",color:T.dim}}>{"ðŸ¦µ Punt"}</button>
                      <button onClick={function(){doFourth("go");}} style={{padding:"10px 20px",borderRadius:8,cursor:"pointer",fontWeight:700,
                        background:"rgba(239,68,68,0.10)",border:"1px solid rgba(239,68,68,0.3)",color:T.red}}>{"ðŸˆ Go For It!"}</button>
                    </div>
                  </div>;
                })()}

                {/* â•â•â• PLAY CALLING â€” Madden-style categories â•â•â• */}
                {lg.phase==="play_call"&&!isDone&&!lg.pendingTwoMin&&<div style={{flex:1,padding:"8px 12px",display:"flex",flexDirection:"column"}}>

                  {/* Drive Summary Card (shows after possession change) */}
                  {lg.driveSummary&&<div style={{padding:"6px 10px",marginBottom:6,borderRadius:6,
                    background:lg.driveSummary.result==="TOUCHDOWN"?"rgba(212,167,75,0.08)":
                      lg.driveSummary.result==="FIELD GOAL"?"rgba(52,211,153,0.06)":"rgba(100,116,139,0.06)",
                    border:"1px solid "+(lg.driveSummary.result==="TOUCHDOWN"?T.gold+"33":"rgba(255,255,255,0.05)"),
                    textAlign:"center"}}>
                    <div style={{fontSize:8,fontWeight:800,letterSpacing:1,color:T.faint}}>{"PREV DRIVE"}</div>
                    <div style={{fontSize:10,fontWeight:700,color:T.text}}>
                      {lg.driveSummary.plays+" plays, "+Math.abs(lg.driveSummary.yards)+" yds, "+lg.driveSummary.time+" â€” "+lg.driveSummary.result}
                    </div>
                  </div>}

                  {/* Halftime Adjustment Active Badge v99.1 */}
                  {lg.halfAdj991&&lg.quarter>=3&&!isDone&&(function(){
                    var adj=lg.halfAdj991;
                    var col=adj.type==="tempo"?T.gold:adj.type==="defense"?"#60a5fa":"#a78bfa";
                    var bg=adj.type==="tempo"?"rgba(212,167,75,0.07)":adj.type==="defense"?"rgba(59,130,246,0.07)":"rgba(167,139,250,0.07)";
                    return <div style={{padding:"4px 10px",marginBottom:5,borderRadius:5,background:bg,
                      border:"1px solid rgba(255,255,255,0.06)",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                      <span style={{fontSize:9,fontWeight:800,color:col}}>{adj.label||adj.type}</span>
                      <span style={{fontSize:7,fontWeight:700,color:"rgba(255,255,255,0.2)",letterSpacing:1}}>{"ACTIVE"}</span>
                    </div>;
                  })()}

                  {/* Pre-snap read */}
                  {lg.preSnapRead&&isUserOff&&<div style={{padding:"4px 8px",marginBottom:4,borderRadius:4,
                    background:"rgba(96,165,250,0.06)",border:"1px solid rgba(96,165,250,0.12)"}}>
                    <div style={{fontSize:9,color:"#60a5fa",fontStyle:"italic"}}>{lg.preSnapRead}</div>
                  </div>}

                  <div style={{textAlign:"center",marginBottom:6}}>
                    <div style={{fontSize:10,fontWeight:800,letterSpacing:2,
                      color:isUserOff?"#fbbf24":"#a78bfa"}}>
                      {isUserOff?"ðŸˆ OFFENSE â€” PICK YOUR PLAY":"ðŸ›¡ï¸ DEFENSE â€” PICK YOUR COVERAGE"}
                    </div>
                  </div>

                  {isUserOff ? (
                    /* â”€â”€ OFFENSIVE PLAY SELECTION â”€â”€ */
                    <div style={{flex:1,display:"flex",flexDirection:"column",gap:4}}>
                      {/* No-Huddle Toggle */}
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2}}>
                        <button onClick={function(){
                          var newLg=Object.assign({},lg);
                          newLg.noHuddle=!newLg.noHuddle;
                          if(newLg.noHuddle){
                            var nhPick=LIVE_GAME_986.noHuddleQBPick(newLg);
                            newLg.noHuddlePlay=nhPick;
                          }else{newLg.noHuddlePlay=null;}
                          setLiveGame986(newLg);
                        }} style={{padding:"3px 10px",borderRadius:4,cursor:"pointer",fontWeight:700,fontSize:8,
                          background:lg.noHuddle?"rgba(168,85,247,0.12)":"rgba(255,255,255,0.03)",
                          border:"1px solid "+(lg.noHuddle?"rgba(168,85,247,0.3)":"rgba(255,255,255,0.06)"),
                          color:lg.noHuddle?"#a855f7":T.dim}}>
                          {lg.noHuddle?"ðŸ§  QB CALLING PLAYS â€” click to take over":"ðŸ§  No-Huddle: Let QB Call Plays"}
                        </button>
                      </div>

                      {/* No-Huddle active: show QB's pick */}
                      {lg.noHuddle&&lg.noHuddlePlay?<div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:8}}>
                        <div style={{fontSize:10,fontWeight:800,color:"#a855f7",letterSpacing:1}}>{"ðŸ§  QB IS CALLING THE PLAY"}</div>
                        <div style={{padding:"12px 16px",borderRadius:8,background:"rgba(168,85,247,0.06)",border:"1px solid rgba(168,85,247,0.15)",
                          textAlign:"center",maxWidth:300}}>
                          <div style={{fontSize:9,color:T.dim,marginBottom:4}}>{lg.noHuddlePlay.qbName+" (Awareness: "+lg.noHuddlePlay.awareness+")"}</div>
                          <div style={{fontSize:16,fontWeight:900,color:T.gold}}>{lg.noHuddlePlay.play.icon+" "+lg.noHuddlePlay.play.label}</div>
                          <div style={{fontSize:9,color:T.dim,marginTop:4,fontStyle:"italic"}}>{"\""+lg.noHuddlePlay.reason+"\""}</div>
                        </div>
                        <div style={{display:"flex",gap:8}}>
                          <button onClick={function(){
                            doPlay(lg.noHuddlePlay.play);_setCat(null);
                            // Auto-pick next play for next snap â€” use functional updater to avoid stale closure overwrite
                            setTimeout(function(){
                              setLiveGame986(function(cur){
                                if(!cur||!cur.noHuddle)return cur;
                                var nhPick=LIVE_GAME_986.noHuddleQBPick(cur);
                                var newLg2=Object.assign({},cur);newLg2.noHuddlePlay=nhPick;return newLg2;
                              });
                            },100);
                          }} style={{padding:"10px 24px",borderRadius:8,cursor:"pointer",fontWeight:800,fontSize:12,
                            background:"linear-gradient(135deg,#a855f7,#7c3aed)",color:"#fff",border:"none"}}>
                            {"â–¶ SNAP IT"}
                          </button>
                          <button onClick={function(){
                            var newLg=Object.assign({},lg);
                            var nhPick=LIVE_GAME_986.noHuddleQBPick(newLg);
                            newLg.noHuddlePlay=nhPick;setLiveGame986(newLg);
                          }} style={{padding:"10px 16px",borderRadius:8,cursor:"pointer",fontWeight:700,fontSize:10,
                            background:"rgba(255,255,255,0.04)",border:"1px solid "+T.border,color:T.dim}}>
                            {"ðŸ”„ Audible"}
                          </button>
                          <button onClick={function(){
                            var newLg=Object.assign({},lg);newLg.noHuddle=false;newLg.noHuddlePlay=null;
                            setLiveGame986(newLg);
                          }} style={{padding:"10px 16px",borderRadius:8,cursor:"pointer",fontWeight:700,fontSize:10,
                            background:"rgba(239,68,68,0.06)",border:"1px solid rgba(239,68,68,0.15)",color:T.red}}>
                            {"âœ‹ Take Over"}
                          </button>
                        </div>
                      </div>:
                      /* Normal play selection */
                      <div style={{display:"flex",flexDirection:"column",gap:4,flex:1}}>
                      {/* Category tabs */}
                      <div style={{display:"flex",gap:3,marginBottom:4,flexWrap:"wrap"}}>
                        {[{id:"run",label:"ðŸˆ RUN",c:"#22c55e"},{id:"shortPass",label:"ðŸŽ¯ SHORT",c:"#3b82f6"},
                          {id:"deepPass",label:"ðŸš€ DEEP",c:"#a855f7"},{id:"special",label:"âš¡ SPECIAL",c:"#f59e0b"},
                          {id:"trick",label:"ðŸŽª TRICK",c:"#ef4444"}
                        ].map(function(cat){
                          var isActive=_playCategory===cat.id;
                          // Only show trick plays if momentum >= 3 or it's 4th down
                          if(cat.id==="trick"&&lg.momentum<3&&lg.down!==4)return null;
                          return <button key={cat.id} onClick={function(){_setCat(isActive?null:cat.id);}} style={{
                            flex:1,padding:"7px 3px",borderRadius:6,cursor:"pointer",fontWeight:800,fontSize:9,
                            background:isActive?cat.c+"22":"rgba(255,255,255,0.03)",
                            border:"2px solid "+(isActive?cat.c:T.border),
                            color:isActive?cat.c:T.dim,letterSpacing:0.5,minWidth:0
                          }}>{cat.label}</button>;
                        })}
                      </div>
                      {/* Play list for selected category */}
                      {_playCategory&&<div style={{display:"flex",flexDirection:"column",gap:4,flex:1,overflow:"auto"}}>
                        {/* Audible hint */}
                        <div style={{display:"flex",justifyContent:"center",marginBottom:2}}>
                          <button onClick={function(){_setCat(null);}} style={{fontSize:8,padding:"2px 10px",borderRadius:4,cursor:"pointer",
                            background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.15)",color:T.gold,fontWeight:700}}>
                            {"ðŸ”Š AUDIBLE â€” switch category"}
                          </button>
                        </div>
                        {(PLAYBOOK_986.offense[_playCategory]||[]).map(function(play){
                          if(play.is4thOnly&&lg.down!==4)return null;
                          if(play.type==="spike"&&lg.down>=4)return null;// Can't spike on 4th
                          var diagram=LIVE_GAME_986.getPlayDiagram(play.id);
                          return <button key={play.id} onClick={function(){doPlay(play);_setCat(null);}} style={{
                            padding:"8px 10px",borderRadius:8,cursor:"pointer",textAlign:"left",
                            background:play.isTrick?"rgba(239,68,68,0.04)":"rgba(255,255,255,0.03)",
                            border:"1px solid "+(play.isTrick?"rgba(239,68,68,0.15)":"rgba(255,255,255,0.08)"),
                            display:"flex",alignItems:"center",gap:8,transition:"background 0.15s"
                          }}>
                            {/* Mini play diagram SVG */}
                            {diagram?<svg width="36" height="28" viewBox="0 0 100 60" style={{flexShrink:0,borderRadius:3,background:"rgba(34,80,34,0.4)"}}>
                              {/* LOS */}
                              <line x1="10" y1="30" x2="90" y2="30" stroke="rgba(255,255,255,0.2)" strokeWidth="1"/>
                              {/* QB dot */}
                              <circle cx="50" cy="42" r="3" fill="#fbbf24"/>
                              {/* OL dots */}
                              {[35,42,50,58,65].map(function(ox,ii){return <circle key={ii} cx={ox} cy="30" r="2" fill="rgba(255,255,255,0.4)"/>;})}
                              {/* Routes */}
                              {diagram.routes.map(function(r,ri){
                                return <line key={ri} x1={r.x} y1={r.y} x2={r.ex} y2={r.ey}
                                  stroke={r.type==="run"?"#22c55e":r.type==="fake"?"rgba(255,255,255,0.2)":"#60a5fa"}
                                  strokeWidth={r.type==="run"?2:1.5} strokeDasharray={r.type==="fake"?"3,3":"none"}/>;
                              })}
                              {/* WR dots at route starts */}
                              {diagram.routes.filter(function(r){return r.type==="route";}).map(function(r,ri){
                                return <circle key={"wr"+ri} cx={r.x} cy={r.y} r="2.5" fill="#60a5fa"/>;
                              })}
                              {/* RB dot for run plays */}
                              {diagram.routes.filter(function(r){return r.type==="run";}).map(function(r,ri){
                                return <circle key={"rb"+ri} cx={r.x} cy={r.y} r="2.5" fill="#22c55e"/>;
                              })}
                            </svg>:<div style={{fontSize:18,flexShrink:0,width:36,textAlign:"center"}}>{play.icon}</div>}
                            <div style={{flex:1}}>
                              <div style={{fontWeight:700,fontSize:11,color:play.isTrick?T.red:T.text}}>{play.label}</div>
                              <div style={{fontSize:8,color:T.dim,marginTop:1}}>{play.desc}</div>
                            </div>
                            <div style={{fontSize:9,color:T.faint}}>{"â–¶"}</div>
                          </button>;
                        })}
                      </div>}
                      {!_playCategory&&<div style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center"}}>
                        <div style={{textAlign:"center",color:T.faint,fontSize:11}}>{"Pick a play category above â˜ï¸"}</div>
                      </div>}
                      </div>}
                    </div>
                  ) : (
                    /* â”€â”€ DEFENSIVE PLAY SELECTION + WATCH DRIVE â”€â”€ */
                    <div style={{display:"flex",flexDirection:"column",gap:4}}>
                      {/* Watch Drive option */}
                      {!lg.watchDriveActive&&<div style={{display:"flex",gap:4,marginBottom:4}}>
                        <div style={{fontSize:8,color:T.faint,flex:1,display:"flex",alignItems:"center"}}>{"Pick coverage for each play, or set it and watch:"}</div>
                      </div>}
                      {lg.watchDriveActive&&<div style={{padding:"8px",background:"rgba(168,85,247,0.06)",borderRadius:6,textAlign:"center",marginBottom:4}}>
                        <div style={{fontSize:9,color:"#a78bfa",fontWeight:700}}>{"ðŸ“º WATCHING DRIVE â€” Auto-playing..."}</div>
                        <div style={{display:"flex",justifyContent:"center",gap:8,marginTop:6}}>
                          <button onClick={function(){
                            // Continue watching â€” play another snap
                            startWatchDrive(lg.watchDriveCoverage||PLAYBOOK_986.defense.coverage[1]);
                          }} style={{padding:"6px 16px",borderRadius:6,cursor:"pointer",fontWeight:700,fontSize:10,
                            background:"rgba(168,85,247,0.12)",border:"1px solid rgba(168,85,247,0.3)",color:"#a78bfa"}}>
                            {"â–¶ Next Play"}
                          </button>
                          <button onClick={function(){
                            var newLg=Object.assign({},lg);newLg.watchDriveActive=false;
                            setLiveGame986(newLg);
                          }} style={{padding:"6px 12px",borderRadius:6,cursor:"pointer",fontWeight:700,fontSize:10,
                            background:"rgba(255,255,255,0.05)",border:"1px solid "+T.border,color:T.dim}}>
                            {"âœ‹ Take Over"}
                          </button>
                        </div>
                      </div>}
                      {!lg.watchDriveActive&&PLAYBOOK_986.defense.coverage.map(function(play){
                        return <div key={play.id} style={{display:"flex",gap:4}}>
                          <button onClick={function(){doPlay(play);}} style={{
                            flex:1,padding:"10px 12px",borderRadius:8,cursor:"pointer",textAlign:"left",
                            background:"rgba(168,85,247,0.04)",border:"1px solid rgba(168,85,247,0.15)",
                            display:"flex",alignItems:"center",gap:10
                          }}>
                            <div style={{fontSize:18,flexShrink:0,width:28,textAlign:"center"}}>{play.icon}</div>
                            <div style={{flex:1}}>
                              <div style={{fontWeight:700,fontSize:12,color:T.text}}>{play.label}</div>
                              <div style={{fontSize:9,color:T.dim,marginTop:1}}>{play.desc}</div>
                            </div>
                          </button>
                          <button onClick={function(){startWatchDrive(play);}} title={"Set "+play.label+" and watch drive"}
                            style={{padding:"4px 8px",borderRadius:6,cursor:"pointer",fontSize:14,
                              background:"rgba(168,85,247,0.06)",border:"1px solid rgba(168,85,247,0.12)",color:"#a78bfa",
                              display:"flex",alignItems:"center"}}>
                            {"ðŸ“º"}
                          </button>
                        </div>;
                      })}
                    </div>
                  )}
                </div>}
              </div>

              {/* â•â•â• DRIVE LOG â€” Bottom strip â•â•â• */}
              {lg.driveLog.length>0&&!isDone&&lg.phase!=="halftime"&&lg.phase!=="coin_toss"&&
                <div style={{flexShrink:0,maxHeight:100,overflowY:"auto",padding:"4px 12px",
                  borderTop:"1px solid rgba(255,255,255,0.05)",background:"rgba(0,0,0,0.3)"}}>
                  <div style={{fontSize:7,fontWeight:800,color:T.faint,letterSpacing:1}}>{"THIS DRIVE"}</div>
                  {lg.driveLog.slice().reverse().map(function(e,i){
                    return <div key={i} style={{fontSize:9,padding:"1px 4px",
                      color:e.type==="td"?T.gold:e.type==="to"?T.red:T.dim}}>{e.icon+" "+e.text}</div>;
                  })}
              </div>}

              {/* EXIT + TIMEOUTS */}
              {!isDone&&<div style={{flexShrink:0,padding:"6px 12px",borderTop:"1px solid rgba(255,255,255,0.05)",
                display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div style={{display:"flex",alignItems:"center",gap:6}}>
                  <div style={{fontSize:8,color:T.faint}}>{"Plays: "+lg.totalPlays}</div>
                  <div style={{fontSize:8,color:lg.momentum>0?T.green:lg.momentum<0?T.red:T.faint}}>
                    {lg.momentum>0?"â–² +"+lg.momentum:lg.momentum<0?"â–¼ "+lg.momentum:"â€”"}
                  </div>
                </div>
                <div style={{display:"flex",alignItems:"center",gap:6}}>
                  {/* Timeout dots */}
                  <div style={{display:"flex",alignItems:"center",gap:2}}>
                    <span style={{fontSize:7,color:T.faint}}>{userIsHome?lg.homeTeam.abbr:lg.awayTeam.abbr}</span>
                    {[0,1,2].map(function(i){
                      var has=i<(userIsHome?lg.timeouts.home:lg.timeouts.away);
                      return <div key={i} style={{width:6,height:6,borderRadius:"50%",
                        background:has?T.gold:"rgba(255,255,255,0.1)"}} />;
                    })}
                  </div>
                  {lg.phase==="play_call"&&!lg.pendingTwoMin&&(function(){
                    var userSide=userIsHome?"home":"away";
                    var toLeft=lg.timeouts[userSide];
                    return toLeft>0?<button onClick={function(){
                      var newLg=Object.assign({},lg);
                      LIVE_GAME_986.useTimeout(newLg,userSide);
                      setLiveGame986(newLg);setLiveResult986(newLg.pendingResult||null);
                    }} style={{fontSize:7,padding:"2px 6px",borderRadius:4,cursor:"pointer",fontWeight:700,
                      background:"rgba(251,191,36,0.12)",border:"1px solid rgba(251,191,36,0.3)",color:T.gold}}>
                      {"â¸ï¸ TIMEOUT ("+toLeft+")"}
                    </button>:null;
                  })()}
                  <div style={{fontSize:7,color:T.faint}}>{"vs"}</div>
                  <div style={{display:"flex",alignItems:"center",gap:2}}>
                    {[0,1,2].map(function(i){
                      var has=i<(userIsHome?lg.timeouts.away:lg.timeouts.home);
                      return <div key={i} style={{width:6,height:6,borderRadius:"50%",
                        background:has?"rgba(255,255,255,0.4)":"rgba(255,255,255,0.1)"}} />;
                    })}
                    <span style={{fontSize:7,color:T.faint}}>{userIsHome?lg.awayTeam.abbr:lg.homeTeam.abbr}</span>
                  </div>
                  <button onClick={function(){if(confirm("Abandon game?")){setLiveGame986(null);setLiveResult986(null);AUDIO.play("hub");}}}
                    style={{fontSize:8,color:T.faint,background:"none",border:"none",cursor:"pointer",textDecoration:"underline",marginLeft:4}}>{"Quit"}</button>
                </div>
              </div>}
            </div>);
          }())}
          {presser && !presser.done && (function(){
            var q=presser.questions[presser.current];if(!q) return null;
            return (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:90,background:"rgba(0,0,0,0.92)",display:"flex",alignItems:"center",justifyContent:"center",padding:16}}>
              <div style={{background:T.bg2,border:"1px solid "+T.border,borderRadius:12,padding:20,maxWidth:500,width:"100%"}}>
                <div style={{textAlign:"center",marginBottom:16}}>
                  <div style={{fontSize:28}}>ðŸŽ™ï¸</div>
                  <div style={{fontWeight:800,color:T.gold,fontSize:14}}>PRESS CONFERENCE</div>
                  <div style={{fontSize:10,color:T.dim}}>{"Question "+(presser.current+1)+"/"+presser.questions.length}</div>
                </div>
                <div style={{background:T.bg3,borderRadius:8,padding:14,marginBottom:16}}>
                  <div style={{fontSize:13,fontWeight:600,color:T.text,lineHeight:1.5}}>{"\""+q.q+"\""}</div>
                </div>
                <div style={{display:"flex",flexDirection:"column",gap:8}}>
                  {q.opts.map(function(opt,oi){return (
                    <button key={oi} onClick={function(){handlePresserAnswer(oi);}}
                      style={{background:T.bg3,border:"1px solid "+T.border,borderRadius:8,padding:"10px 14px",cursor:"pointer",textAlign:"left",color:T.text}}>
                      <div style={{fontWeight:700,fontSize:12}}>{opt.text}</div>
                      <div style={{fontSize:9,color:T.faint,marginTop:2}}>
                        {opt.label}
                        {opt.fx.morale!==0?(" | Morale "+(opt.fx.morale>0?"+":"")+opt.fx.morale):""}
                        {opt.fx.owner!==0?(" | Owner "+(opt.fx.owner>0?"+":"")+opt.fx.owner):""}
                        {opt.fx.prep>0?" | âš ï¸ Opp prep +"+opt.fx.prep+"%":""}
                      </div>
                    </button>);})}
                </div>
                {presser.answers.length>0 && <div style={{marginTop:12,borderTop:"1px solid "+T.border,paddingTop:8}}>
                  {presser.answers.map(function(ans,ai2){return <div key={ai2} style={{fontSize:10,color:T.dim,marginBottom:2}}>{"Q"+(ai2+1)+": \""+ans.a+"\""}</div>;})}
                </div>}
              </div>
            </div>);
          }())}
          
          
          {React.createElement("div",{style:S.scanlines})}
          
          {weekShow && weekShow.headlines && weekShow.headlines.length>0 && season.phase==="regular" && React.createElement("div",{style:{position:"fixed",bottom:0,left:0,right:0,zIndex:25,background:T.bg2,borderTop:"2px solid "+T.gold,padding:"5px 12px",display:"flex",alignItems:"center",gap:8}},
            React.createElement("span",{style:{fontSize:8,fontWeight:900,color:"#000",background:T.gold,padding:"2px 6px",borderRadius:3,flexShrink:0,letterSpacing:1}},"LIVE"),
              React.createElement("div",{style:{flex:1,overflow:"hidden",whiteSpace:"nowrap"}},
                React.createElement("div",{style:{fontSize:10,fontWeight:700,color:T.gold,transition:"opacity 0.5s"}},weekShow.headlines[tickerIdx]||"")
              )
            )}
          {schemeConfirm && (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:97,background:"rgba(0,0,0,0.92)",display:"flex",alignItems:"center",justifyContent:"center",padding:10}}
              onClick={function(){setSchemeConfirm(null);}}>
              <div style={mS(S.card,{maxWidth:580,width:"100%",maxHeight:"90vh",overflowY:"auto",borderColor:T.orange,padding:0})}
                onClick={function(e){e.stopPropagation();}}>
                <div style={{background:"linear-gradient(135deg,rgba(251,146,60,0.18),rgba(15,23,42,0.95))",padding:"14px 16px 10px",borderBottom:"1px solid "+T.border}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <div>
                      <div style={{fontWeight:900,fontSize:15,color:T.orange}}>{"ðŸ”­ SCHEME FIT FORECAST"}</div>
                      <div style={{fontSize:10,color:T.dim}}>
                        {"Switching "+(schemeConfirm.side==="off"?"OFFENSE":"DEFENSE")+" to "+
                          (((schemeConfirm.side==="off"?OFF_SCHEMES:DEF_SCHEMES).find(function(s){return s.id===schemeConfirm.newScheme;})||{}).name||schemeConfirm.newScheme)}
                      </div>
                      {(function(){var fl=getSchemeFlavorLine(schemeConfirm.newScheme,schemeConfirm.side==="off"?"offense":"defense");return fl?<div style={{fontSize:9,color:T.faint,marginTop:3,fontStyle:"italic"}}>{"\""+fl+"\""}</div>:null;})()}
                    </div>
                    <button style={bS(T.bg3,T.text)} onClick={function(){setSchemeConfirm(null);}}>{"âœ•"}</button>
                  </div>
                </div>
                <div style={{padding:"10px 12px"}}>
                  <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:8}}>
                    <span style={{fontSize:9,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:T.dim,fontWeight:700}}>
                      {"Avg "+(schemeConfirm.currentAvgFit||0)+" â†’ "+(schemeConfirm.projectedAvgFit||0)}
                    </span>
                    <span style={{fontSize:9,padding:"2px 6px",borderRadius:10,background:(schemeConfirm.avgFitDelta>=0?T.green:T.red)+"20",
                      color:schemeConfirm.avgFitDelta>=0?T.green:T.red,fontWeight:800}}>
                      {(schemeConfirm.avgFitDelta>=0?"+":"")+schemeConfirm.avgFitDelta}
                    </span>
                    <span style={{fontSize:9,padding:"2px 6px",borderRadius:10,background:"rgba(251,146,60,0.2)",color:T.orange,fontWeight:700}}>
                      {"~"+(schemeConfirm.fitLoss||0)+" pt transition cost (2 wks)"}
                    </span>
                  </div>
                  <div style={{fontSize:10,fontWeight:800,color:T.gold,letterSpacing:1,marginBottom:4}}>{"GROUP IMPACT"}</div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 52px 56px 38px 40px 40px",gap:3,fontSize:8,color:T.faint,fontWeight:700,marginBottom:2,padding:"0 3px"}}>
                    <div>{"Group"}</div><div style={{textAlign:"center"}}>{"Now"}</div><div style={{textAlign:"center"}}>{"Proj"}</div><div style={{textAlign:"center"}}>{"Î”"}</div><div style={{textAlign:"center"}}>{"Spec"}</div><div style={{textAlign:"center"}}>{"Sys"}</div>
                  </div>
                  {(schemeConfirm.groupDeltas||[]).map(function(gd,gi){
                    var gdCol=gd.delta>0?T.green:gd.delta<0?T.red:T.dim;
                    return <div key={gd.id||gi} style={{display:"grid",gridTemplateColumns:"1fr 52px 56px 38px 40px 40px",gap:3,fontSize:9,padding:"3px",borderRadius:4,background:gi%2===0?"rgba(255,255,255,0.02)":"transparent"}}>
                      <div style={{fontWeight:700}}>{gd.label}</div>
                      <div style={{textAlign:"center",color:T.dim}}>{gd.current}</div>
                      <div style={{textAlign:"center",fontWeight:800}}>{gd.next}</div>
                      <div style={{textAlign:"center",fontWeight:800,color:gdCol}}>{(gd.delta>0?"+":"")+gd.delta}</div>
                      <div style={{textAlign:"center",color:gd.specDelta>0?T.green:gd.specDelta<0?T.red:T.dim}}>{(gd.specDelta>0?"+":"")+gd.specDelta}</div>
                      <div style={{textAlign:"center",color:gd.sysDelta>0?T.green:gd.sysDelta<0?T.red:T.dim}}>{(gd.sysDelta>0?"+":"")+gd.sysDelta}</div>
                    </div>;
                  })}
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:10}}>
                    <div>
                      <div style={{fontSize:9,fontWeight:700,color:T.green,marginBottom:3}}>{"ðŸ“ˆ Top Risers"}</div>
                      {(schemeConfirm.risers&&schemeConfirm.risers.length>0)?schemeConfirm.risers.map(function(m){
                        return <div key={m.id} style={{fontSize:8,padding:"3px 0",borderBottom:"1px solid "+T.border}}>
                          <span style={{color:T.text,fontWeight:700}}>{m.name+" ("+m.pos+")"}</span>
                          <span style={{float:"right",color:T.green,fontWeight:800}}>{m.current+"â†’"+m.next+" (+"+m.delta+")"}</span>
                        </div>;
                      }):<div style={{fontSize:8,color:T.faint}}>{"No projected risers."}</div>}
                    </div>
                    <div>
                      <div style={{fontSize:9,fontWeight:700,color:T.red,marginBottom:3}}>{"ðŸ“‰ Top Fallers"}</div>
                      {(schemeConfirm.fallers&&schemeConfirm.fallers.length>0)?schemeConfirm.fallers.map(function(m){
                        return <div key={m.id} style={{fontSize:8,padding:"3px 0",borderBottom:"1px solid "+T.border}}>
                          <span style={{color:T.text,fontWeight:700}}>{m.name+" ("+m.pos+")"}</span>
                          <span style={{float:"right",color:T.red,fontWeight:800}}>{m.current+"â†’"+m.next+" ("+m.delta+")"}</span>
                        </div>;
                      }):<div style={{fontSize:8,color:T.faint}}>{"No projected fallers."}</div>}
                    </div>
                  </div>
                  <div style={{fontSize:8,color:T.faint,marginTop:8}}>
                    {"Transition cost (-"+(schemeConfirm.fitLoss||0)+" pts avg for 2 wks) is not included in projected steady-state fit."}
                  </div>
                  <div style={{display:"flex",gap:8,marginTop:10}}>
                    <button onClick={confirmSchemeChange} style={mS(S.btn,{flex:1,background:T.orange,color:"#000",fontWeight:800,padding:"9px",fontSize:11})}>{"âœ… Confirm Scheme Change"}</button>
                    <button onClick={function(){setSchemeConfirm(null);}} style={mS(S.btn,S.btnGhost,{flex:1,padding:"9px",fontSize:11})}>{"âŒ Cancel"}</button>
                  </div>
                </div>
              </div>
            </div>
          )}
          {fitDrilldown && (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:96,background:"rgba(0,0,0,0.92)",display:"flex",alignItems:"center",justifyContent:"center",padding:10}}
              onClick={function(){setFitDrilldown(null);}}>
              <div style={mS(S.card,{maxWidth:560,width:"100%",maxHeight:"90vh",overflowY:"auto",borderColor:T.cyan,padding:0})}
                onClick={function(e){e.stopPropagation();}}>
                <div style={{background:"linear-gradient(135deg,rgba(34,211,238,0.14),rgba(15,23,42,0.95))",padding:"14px 16px 10px",borderBottom:"1px solid "+T.border}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <div>
                      <div style={{fontWeight:900,fontSize:15,color:T.cyan}}>{"ðŸ§­ FIT DRILLDOWN â€” WEEK "+fitDrilldown.week}</div>
                      <div style={{fontSize:10,color:T.dim}}>
                        {fitDrilldown.prevAvg===null?"Baseline snapshot (no prior comparison)":"Avg "+fitDrilldown.prevAvg+" â†’ "+fitDrilldown.avgFit+" ("+(fitDrilldown.avgDelta>=0?"+":"")+fitDrilldown.avgDelta+")"}
                      </div>
                    </div>
                    <button style={bS(T.bg3,T.text)} onClick={function(){setFitDrilldown(null);}}>{"âœ•"}</button>
                  </div>
                </div>
                <div style={{padding:"10px 12px"}}>
                  {fitDrilldown.prevAvg===null && <div style={{fontSize:11,color:T.faint,padding:"8px 0"}}>
                    {"Need one completed week before before/after deltas appear."}
                  </div>}
                  {fitDrilldown.prevAvg!==null && <div>
                    <div style={{fontSize:10,fontWeight:800,color:T.gold,letterSpacing:1,marginBottom:4}}>{"GROUP CHANGES"}</div>
                    <div style={{display:"grid",gridTemplateColumns:"1fr 54px 54px 44px 44px 44px 44px",gap:3,fontSize:8,color:T.faint,fontWeight:700,marginBottom:2,padding:"0 3px"}}>
                      <div>{"Group"}</div><div style={{textAlign:"center"}}>{"Before"}</div><div style={{textAlign:"center"}}>{"After"}</div><div style={{textAlign:"center"}}>{"Î”"}</div><div style={{textAlign:"center"}}>{"Spec"}</div><div style={{textAlign:"center"}}>{"Pers"}</div><div style={{textAlign:"center"}}>{"Sys"}</div>
                    </div>
                    {(fitDrilldown.groupDeltas||[]).map(function(gd,gi){
                      var gdCol=gd.delta>0?T.green:gd.delta<0?T.red:T.dim;
                      return <div key={gd.id||gi} style={{display:"grid",gridTemplateColumns:"1fr 54px 54px 44px 44px 44px 44px",gap:3,fontSize:9,padding:"3px",borderRadius:4,background:gi%2===0?"rgba(255,255,255,0.02)":"transparent"}}>
                        <div style={{fontWeight:700}}>{gd.label}</div>
                        <div style={{textAlign:"center",color:T.dim}}>{gd.previous===null?"â€”":gd.previous}</div>
                        <div style={{textAlign:"center",fontWeight:800}}>{gd.current}</div>
                        <div style={{textAlign:"center",fontWeight:800,color:gdCol}}>{(gd.delta>0?"+":"")+gd.delta}</div>
                        <div style={{textAlign:"center",color:gd.specDelta>0?T.green:gd.specDelta<0?T.red:T.dim}}>{(gd.specDelta>0?"+":"")+gd.specDelta}</div>
                        <div style={{textAlign:"center",color:gd.persDelta>0?T.green:gd.persDelta<0?T.red:T.dim}}>{(gd.persDelta>0?"+":"")+gd.persDelta}</div>
                        <div style={{textAlign:"center",color:gd.sysDelta>0?T.green:gd.sysDelta<0?T.red:T.dim}}>{(gd.sysDelta>0?"+":"")+gd.sysDelta}</div>
                      </div>;
                    })}
                    <div style={{display:"flex",alignItems:"center",gap:6,marginTop:10,marginBottom:6}}>
                      <div style={{fontSize:10,fontWeight:800,color:T.cyan,letterSpacing:1}}>{"PLAYER CHANGES"}</div>
                      <button style={mS(S.btn,S.btnSmall,{padding:"2px 8px",fontSize:9,background:fitDrillFilter==="all"?"rgba(34,211,238,0.18)":"rgba(255,255,255,0.05)",color:fitDrillFilter==="all"?T.cyan:T.faint,border:"1px solid "+(fitDrillFilter==="all"?T.cyan:T.border)})} onClick={function(){setFitDrillFilter("all");}}>{"All"}</button>
                      <button style={mS(S.btn,S.btnSmall,{padding:"2px 8px",fontSize:9,background:fitDrillFilter==="up"?"rgba(52,211,153,0.18)":"rgba(255,255,255,0.05)",color:fitDrillFilter==="up"?T.green:T.faint,border:"1px solid "+(fitDrillFilter==="up"?T.green:T.border)})} onClick={function(){setFitDrillFilter("up");}}>{"Risers"}</button>
                      <button style={mS(S.btn,S.btnSmall,{padding:"2px 8px",fontSize:9,background:fitDrillFilter==="down"?"rgba(239,68,68,0.18)":"rgba(255,255,255,0.05)",color:fitDrillFilter==="down"?T.red:T.faint,border:"1px solid "+(fitDrillFilter==="down"?T.red:T.border)})} onClick={function(){setFitDrillFilter("down");}}>{"Fallers"}</button>
                    </div>
                    {(function(){
                      var rows=(fitDrilldown.playerChanges||[]).filter(function(pc){
                        if(fitDrillFilter==="up")return pc.delta>0;
                        if(fitDrillFilter==="down")return pc.delta<0;
                        return true;
                      });
                      if(rows.length===0)return <div style={{fontSize:9,color:T.faint,padding:"8px 0"}}>{"No players in this filter."}</div>;
                      return <div>
                        <div style={{display:"grid",gridTemplateColumns:"1fr 34px 46px 46px 40px 38px 38px 38px",gap:3,fontSize:8,color:T.faint,fontWeight:700,marginBottom:2,padding:"0 3px"}}>
                          <div>{"Player"}</div><div style={{textAlign:"center"}}>{"Pos"}</div><div style={{textAlign:"center"}}>{"Before"}</div><div style={{textAlign:"center"}}>{"After"}</div><div style={{textAlign:"center"}}>{"Î”"}</div><div style={{textAlign:"center"}}>{"Spec"}</div><div style={{textAlign:"center"}}>{"Pers"}</div><div style={{textAlign:"center"}}>{"Sys"}</div>
                        </div>
                        {rows.slice(0,80).map(function(pc,pi){
                          var dCol=pc.delta>0?T.green:pc.delta<0?T.red:T.dim;
                          return <div key={(pc.id||pi)+"_"+pi} style={{display:"grid",gridTemplateColumns:"1fr 34px 46px 46px 40px 38px 38px 38px",gap:3,fontSize:9,padding:"3px",borderRadius:4,background:pi%2===0?"rgba(255,255,255,0.02)":"transparent"}}>
                            <div style={{fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{pc.name}</div>
                            <div style={{textAlign:"center",color:T.gold}}>{pc.pos}</div>
                            <div style={{textAlign:"center",color:T.dim}}>{pc.from}</div>
                            <div style={{textAlign:"center",fontWeight:800}}>{pc.to}</div>
                            <div style={{textAlign:"center",fontWeight:800,color:dCol}}>{(pc.delta>0?"+":"")+pc.delta}</div>
                            <div style={{textAlign:"center",color:pc.specDelta>0?T.green:pc.specDelta<0?T.red:T.dim}}>{(pc.specDelta>0?"+":"")+pc.specDelta}</div>
                            <div style={{textAlign:"center",color:pc.persDelta>0?T.green:pc.persDelta<0?T.red:T.dim}}>{(pc.persDelta>0?"+":"")+pc.persDelta}</div>
                            <div style={{textAlign:"center",color:pc.sysDelta>0?T.green:pc.sysDelta<0?T.red:T.dim}}>{(pc.sysDelta>0?"+":"")+pc.sysDelta}</div>
                          </div>;
                        })}
                      </div>;
                    })()}
                  </div>}
                </div>
              </div>
            </div>
          )}
          
          {seasonReport && (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:95,background:"rgba(0,0,0,0.95)",display:"flex",alignItems:"center",justifyContent:"center",padding:10}}
              onClick={function(){setSeasonReport(null);}}>
              <div style={mS(S.card,{maxWidth:500,width:"100%",maxHeight:"90vh",overflowY:"auto",borderColor:T.gold,padding:0})}
                onClick={function(e){e.stopPropagation();}}>
                <div style={{background:"linear-gradient(135deg,rgba(212,167,75,0.15),rgba(212,167,75,0.04))",padding:"20px 20px 12px",textAlign:"center",borderBottom:"1px solid "+T.border}}>
                  <div style={{fontSize:28}}>{"ðŸ“Š"}</div>
                  <div style={{fontWeight:900,fontSize:18,color:T.gold}}>{seasonReport.teamIcon+" "+seasonReport.teamName}</div>
                  <div style={{fontSize:13,color:T.dim,marginTop:2}}>{seasonReport.year+" Season Report â€” "+seasonReport.wins+"W-"+seasonReport.losses+"L"}</div>
                  <div style={{display:"flex",justifyContent:"center",gap:20,marginTop:10}}>
                    <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:T.dim,fontSize:18})}>{seasonReport.avgBefore}</div><div style={S.kpiLabel}>{"Avg Before"}</div></div>
                    <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:T.gold,fontSize:24})}>{seasonReport.avgAfter}</div><div style={S.kpiLabel}>{"Avg After"}</div></div>
                    <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:seasonReport.avgAfter>=seasonReport.avgBefore?T.green:T.red,fontSize:18})}>{(seasonReport.avgAfter>=seasonReport.avgBefore?"+":"")+(seasonReport.avgAfter-seasonReport.avgBefore)}</div><div style={S.kpiLabel}>{"Change"}</div></div>
                  </div>
                </div>
                <div style={{padding:"8px 12px"}}>
                  <div style={{fontSize:10,fontWeight:800,color:T.gold,letterSpacing:1,marginBottom:6}}>{"PLAYER PROGRESSION"}</div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 40px 40px 40px 40px",gap:2,fontSize:10,fontWeight:700,color:T.faint,marginBottom:4,padding:"0 4px"}}>
                    <div>{"Player"}</div><div style={{textAlign:"center"}}>{"Pos"}</div><div style={{textAlign:"center"}}>{"Before"}</div><div style={{textAlign:"center"}}>{"After"}</div><div style={{textAlign:"center"}}>{"Î”"}</div>
                  </div>
                  {seasonReport.players.slice(0,40).map(function(p,pi){
                    var dCol=p.delta>3?T.green:p.delta>0?"#4ade80":p.delta===0?T.dim:p.delta>=-2?T.orange:T.red;
                    return <div key={pi} style={{display:"grid",gridTemplateColumns:"1fr 40px 40px 40px 40px",gap:2,fontSize:10,padding:"3px 4px",borderRadius:3,
                      background:pi%2===0?"rgba(255,255,255,0.02)":"transparent"}}>
                      <div style={{fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>
                        {p.name}
                        {p.devTrait==="superstar"?" ðŸŒŸ":p.devTrait==="star"?" â­":""}
                      </div>
                      <div style={{textAlign:"center",color:T.gold}}>{p.pos}</div>
                      <div style={{textAlign:"center",color:T.dim}}>{p.ovrBefore}</div>
                      <div style={{textAlign:"center",fontWeight:800}}>{p.ovrAfter}</div>
                      <div style={{textAlign:"center",fontWeight:800,color:dCol}}>{(p.delta>=0?"+":"")+p.delta}</div>
                    </div>;
                  })}
                  {seasonReport.retired.length>0 && <div style={{marginTop:8}}>
                    <div style={{fontSize:10,fontWeight:800,color:T.red,letterSpacing:1,marginBottom:4}}>{"DEPARTURES & RETIREMENTS"}</div>
                    {seasonReport.retired.map(function(r,ri){
                      return <div key={ri} style={{fontSize:10,color:T.dim,marginBottom:2}}>{"ðŸ‘‹ "+r.name+" ("+r.pos+" "+r.ovr+" OVR, Age "+r.age+")"}</div>;
                    })}
                  </div>}
                </div>
                <div style={{padding:"12px 16px"}}>
                  <button onClick={function(){setSeasonReport(null);}} style={mS(S.btn,S.btnPrimary,{width:"100%",padding:"12px 16px"})}>{"Continue to Training Camp â†’"}</button>
                </div>
              </div>
            </div>
          )}
          
          {showLegacy && history.length>0 && (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.92)",zIndex:100,overflowY:"auto",padding:16}}>
              <div style={{maxWidth:480,margin:"0 auto"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
                  <div style={{fontSize:20,fontWeight:900,color:T.gold}}>{"ðŸ“œ FRANCHISE LEGACY"}</div>
                  <button style={bS(T.bg3,T.text)} onClick={function(){setShowLegacy(false);}}>{"âœ• CLOSE"}</button>
                </div>
                
                {(function(){
                  var sum=buildDynastySummary(history,myId);
                  return <div style={mS(S.card,{padding:14,borderColor:T.gold,marginBottom:16,background:"linear-gradient(135deg,rgba(251,191,36,0.08),rgba(15,23,42,0.95))"})}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <div>
                        <div style={{fontWeight:900,fontSize:16}}>{my.icon+" "+my.city+" "+my.name}</div>
                        <div style={{color:T.dim,fontSize:11}}>{"Est. "+((history[0]||{}).year||2026)}</div>
                      </div>
                      <div style={{textAlign:"right"}}>
                        <div style={{color:T.gold,fontWeight:900,fontSize:18}}>{sum.titles+"Ã—ðŸ†"}</div>
                        <div style={{color:T.dim,fontSize:10}}>{sum.totalW+"-"+sum.totalL+" All-Time"}</div>
                      </div>
                    </div>
                    <div style={{display:"flex",gap:8,marginTop:10}}>
                      <div style={mS(S.kpiBox,{flex:1})}><div style={mS(S.kpiValue,{fontSize:14})}>{sum.seasons}</div><div style={S.kpiLabel}>{"Seasons"}</div></div>
                      <div style={mS(S.kpiBox,{flex:1})}><div style={mS(S.kpiValue,{fontSize:14,color:T.green})}>{sum.playoffAppearances}</div><div style={S.kpiLabel}>{"Playoffs"}</div></div>
                      <div style={mS(S.kpiBox,{flex:1})}><div style={mS(S.kpiValue,{fontSize:14,color:T.cyan})}>{sum.bestSeason+"-"+(17-sum.bestSeason)}</div><div style={S.kpiLabel}>{"Best"}</div></div>
                    </div>
                  </div>;
                })()}
                
                <div style={{position:"relative",paddingLeft:40}}>
                  <div style={{position:"absolute",left:18,top:0,bottom:0,width:2,background:T.border}}/>
                  {history.slice().reverse().map(function(h,i){
                    var cls=classifySeason(h,myId);
                    var isChamp33=cls.type==="championship";
                    var moments=generateKeyMoments(h,myId,history,hallOfFame);
                    return <div key={i} style={{position:"relative",marginBottom:16}}>
                      <div style={{position:"absolute",left:-32,top:6,fontSize:10,fontWeight:800,color:T.dim,width:28,textAlign:"right"}}>{h.year}</div>
                      <div style={{position:"absolute",left:-9,top:8,width:10,height:10,borderRadius:"50%",
                        background:isChamp33?T.gold:cls.color,border:"2px solid "+(isChamp33?"#fff":T.border),
                        boxShadow:isChamp33?"0 0 8px "+T.gold:"none",zIndex:1}}/>
                      <div style={mS(S.card,{padding:12,borderColor:isChamp33?"rgba(251,191,36,0.4)":"rgba(255,255,255,0.06)",
                        background:isChamp33?"linear-gradient(90deg,rgba(251,191,36,0.1),rgba(30,41,59,0.8))":"rgba(30,41,59,0.7)"})}>
                        <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
                          <span style={{fontWeight:800,fontSize:12,color:cls.color}}>{cls.icon+" "+cls.label}</span>
                          <span style={{fontSize:9,color:T.faint}}>{h.champ?h.champ.icon+" "+h.champ.abbr+" won title":""}</span>
                        </div>
                        {moments.map(function(m,mi){
                          return <div key={mi} style={{fontSize:10,color:T.dim,lineHeight:1.5}}>{"â€¢ "+m}</div>;
                        })}
                        {h.mvp && <div style={{marginTop:6,fontSize:9,color:T.faint,borderTop:"1px solid rgba(255,255,255,0.05)",paddingTop:4}}>
                          {"League MVP: "+h.mvp.name+" ("+h.mvp.pos+", "+h.mvp.tm+")"}
                        </div>}
                        
                        {h.goalResults && h.goalResults.completed.length>0 && <div style={{marginTop:4,fontSize:9,color:T.green}}>
                          {"ðŸŽ¯ "+h.goalResults.completed.length+" goals met"}
                        </div>}
                      </div>
                    </div>;
                  })}
                </div>
              </div>
            </div>
          )}
          
          {preseasonReport && (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,padding:10}}
              onClick={function(){setPreseasonReport(null);}}>
              <div style={mS(S.card,{maxWidth:480,width:"100%",maxHeight:"80vh",overflow:"auto",padding:0})}
                onClick={function(e){e.stopPropagation();}}>
                <div style={{padding:"16px 16px 8px",background:"linear-gradient(180deg,rgba(52,211,153,0.1),transparent)"}}>
                  <div style={{fontWeight:900,fontSize:16,color:T.green}}>{"ðŸ“ˆ PRESEASON PROGRESSION CHECK"}</div>
                  <div style={{fontSize:11,color:T.dim,marginTop:4}}>{"Training camp reps build young players. "+preseasonReport.improved+" players improved."}</div>
                  <div style={{display:"flex",gap:12,marginTop:10}}>
                    <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:T.green,fontSize:20})}>{preseasonReport.improved}</div><div style={S.kpiLabel}>{"Improved"}</div></div>
                    <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:T.gold,fontSize:20})}>{"+"+(preseasonReport.avgDelta||0)}</div><div style={S.kpiLabel}>{"Avg Gain"}</div></div>
                    <div style={S.kpiBox}><div style={mS(S.kpiValue,{color:T.dim,fontSize:20})}>{preseasonReport.players.length}</div><div style={S.kpiLabel}>{"Roster"}</div></div>
                  </div>
                </div>
                <div style={{padding:"8px 16px 16px"}}>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 32px 32px 32px 32px 32px",gap:2,fontSize:10,fontWeight:700,color:T.faint,marginBottom:4,padding:"0 4px"}}>
                    <div>{"Player"}</div><div style={{textAlign:"center"}}>{"Pos"}</div><div style={{textAlign:"center"}}>{"Age"}</div><div style={{textAlign:"center"}}>{"Was"}</div><div style={{textAlign:"center"}}>{"Now"}</div><div style={{textAlign:"center"}}>{"Î”"}</div>
                  </div>
                  {preseasonReport.players.slice(0,35).map(function(p,pi){
                    var dCol=p.delta>2?T.green:p.delta>0?"#4ade80":p.delta===0?T.faint:T.red;
                    return React.createElement("div",{key:pi,style:{display:"grid",gridTemplateColumns:"1fr 32px 32px 32px 32px 32px",gap:2,fontSize:10,padding:"3px 4px",borderRadius:3,
                      background:pi%2===0?"rgba(255,255,255,0.02)":"transparent"}},
                      React.createElement("div",{style:{fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},
                        p.name+(p.devTrait==="superstar"?" ðŸŒŸ":p.devTrait==="star"?" â­":"")
                      ),
                      React.createElement("div",{style:{textAlign:"center",color:T.gold}},p.pos),
                      React.createElement("div",{style:{textAlign:"center",color:p.age<=24?T.cyan:T.dim}},p.age),
                      React.createElement("div",{style:{textAlign:"center",color:T.dim}},p.ovrBefore),
                      React.createElement("div",{style:{textAlign:"center",fontWeight:800}},p.ovrAfter),
                      React.createElement("div",{style:{textAlign:"center",fontWeight:800,color:dCol}},(p.delta>=0?"+":"")+p.delta)
                    );
                  })}
                </div>
                {(preseasonReport.posBattles974&&preseasonReport.posBattles974.length>0) && <div style={{padding:"0 16px 12px"}}>
                  <div style={{fontSize:10,fontWeight:800,color:T.orange,letterSpacing:1,marginBottom:4}}>{"âš”ï¸ POSITION BATTLES"}</div>
                  {preseasonReport.posBattles974.map(function(b,bi){
                    return <div key={bi} style={{fontSize:10,padding:"4px 6px",marginBottom:3,borderRadius:4,background:"rgba(251,146,60,0.06)",borderLeft:"3px solid "+T.orange}}>
                      <span style={{fontWeight:700,color:T.gold}}>{b.pos+": "}</span>
                      <span style={{fontWeight:700}}>{b.winner}</span>
                      <span style={{color:T.dim}}>{" beat "+b.loser+(b.autoResolved?" (auto-resolved)":"")}</span>
                    </div>;
                  })}
                </div>}
                {(preseasonReport.campStandouts974&&preseasonReport.campStandouts974.length>0) && <div style={{padding:"0 16px 12px"}}>
                  <div style={{fontSize:10,fontWeight:800,color:T.cyan,letterSpacing:1,marginBottom:4}}>{"ðŸŒŸ CAMP STANDOUTS"}</div>
                  {preseasonReport.campStandouts974.map(function(s,si){
                    return <div key={si} style={{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:10,padding:"3px 6px",
                      background:si%2===0?"rgba(34,211,238,0.04)":"transparent",borderRadius:3}}>
                      <div style={{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>
                        <span style={{fontWeight:700}}>{s.name}</span><span style={{color:T.faint}}>{" ("+s.pos+")"}</span>
                      </div>
                      <div style={{display:"flex",gap:6,alignItems:"center",flexShrink:0}}>
                        <span style={{color:T.green,fontWeight:800}}>{"+"+s.delta}</span>
                        <span style={{color:T.dim}}>{(s.newOvr||s.ovrAfter||"?")+" OVR"}</span>
                      </div>
                    </div>;
                  })}
                </div>}
                {preseasonReport.cutAdvisor974 && <div style={{padding:"0 16px 12px"}}>
                  <div style={{fontSize:10,fontWeight:800,color:T.red,letterSpacing:1,marginBottom:4}}>{"âœ‚ï¸ CUT DAY PREVIEW"}</div>
                  <div style={{fontSize:9,color:T.dim,marginBottom:4}}>
                    {"You're "+preseasonReport.cutAdvisor974.overBy+" over the limit. Top suggested cuts:"}
                  </div>
                  {(preseasonReport.cutAdvisor974.suggestions||[]).slice(0,5).map(function(s,si){
                    return <div key={si} style={{fontSize:9,padding:"3px 6px",borderBottom:si<Math.min(5,(preseasonReport.cutAdvisor974.suggestions||[]).length)-1?"1px solid "+T.border:"none"}}>
                      <span style={{color:si<preseasonReport.cutAdvisor974.overBy?T.red:T.dim,fontWeight:700}}>{si<preseasonReport.cutAdvisor974.overBy?"âœ‚ï¸ ":"â€¢ "}</span>
                      <span style={{fontWeight:600}}>{s.name}</span>
                      <span style={{color:T.faint}}>{" ("+s.pos+" "+s.ovr+")"}</span>
                      <span style={{color:T.dim}}>{" $"+s.salary+"M"}</span>
                      {s.deadMoney>0&&<span style={{color:T.red}}>{" â˜ ï¸$"+s.deadMoney+"M"}</span>}
                    </div>;
                  })}
                </div>}
                <div style={{padding:"8px 16px 16px"}}>
                  <button onClick={function(){setPreseasonReport(null);}} style={mS(S.btn,S.btnPrimary,{width:"100%",padding:"12px 16px"})}>{"Continue to Cut Day â†’"}</button>
                </div>
              </div>
            </div>
          )}
          
          {showHelp && (
            <div style={GS.overlay} onClick={function(){setShowHelp(false);}}>
              <div style={mS({},GS.modal,{maxWidth:640})} onClick={function(e){e.stopPropagation();}}>
                <div style={GS.hdr}>
                  <div style={GS.hdrGold}/>
                  <div style={GS.hdrBadge}>{"QUICK REFERENCE â€” IN-SEASON"}</div>
                  <div style={GS.hdrTitle}>{"OPERATIONS PLAYBOOK"}</div>
                  <div style={GS.hdrSub}>{"In-season reference for active GMs â€” " + (season?season.year:"") + " Season, Week " + (season?season.week:"")}</div>
                </div>
                <div style={GS.body}>

  <div style={GS.sec}>{"SEASON FLOW"}</div>
  <div style={GS.p}>{"Training Camp (75-man roster, 3 preseason weeks, position battles) â†’ Cut Day (trim to 53 + 16 PS) â†’ 17-Week Regular Season (Game Day: pre-game speech â†’ halftime adjustment â†’ postgame locker room) â†’ Trade Deadline (Week 10) â†’ Playoffs (top 6 per conference, single-elim bracket) â†’ Offseason (Re-Sign â†’ Franchise Tag â†’ Free Agency â†’ Combine â†’ Draft â†’ Press Conference â†’ Owner Meeting) â†’ Repeat."}</div>

  <div style={GS.sec}>{"GAME DAY OPERATIONS"}</div>
  <div style={GS.p}>{"Every game: choose a Pre-Game Speech (affects morale/chemistry/turnover risk) â†’ pick a Halftime Adjustment (affects scoring/clock/turnovers in 2nd half) â†’ view Post-Game Locker Room (player reactions). Effects stack. Rivalry games unlock a special Rivalry Speech (+5 morale, +3 chem). Game of the Week selection = +$3M revenue."}</div>
  <div style={GS.tip}><div style={GS.tipLabel}>{"COMBO GUIDE"}</div>{"Safe: Lock In + Stay the Course. Aggressive: Fire Them Up + Open It Up. Rivalry: Rivalry Speech + any. Skip speech for 'Lock In' default."}</div>

  <div style={GS.sec}>{"SALARY CAP ($255M)"}</div>
  <div style={GS.p}>{"Cap grows ~5%/year. Tools: Restructure (convert salaryâ†’bonus for immediate relief, adds future dead money), Backload (push hits to future years), Franchise Tag (1 per offseason, retains best expiring player at 120% position avg), Extensions (re-sign before FA for discount). Dead Money = remaining bonus owed when cutting."}</div>
  <div style={GS.warn}><div style={GS.warnLabel}>{"CAP RULE"}</div>{"Never restructure more than 2 contracts per offseason. Dead money cliff = dynasty death."}</div>

  <div style={GS.sec}>{"PLAYER DEVELOPMENT"}</div>
  <div style={GS.p}>{"OVR (current) + POT (ceiling). Ages 21-25 develop fastest. Dev Traits: ðŸŒŸ Superstar (1.5Ã—), â­ Star (1.2Ã—), Normal (1Ã—). Up to 3 Personality Traits per player â€” combos create unique profiles. System Knowledge grows with stable schemes + Opponent Scout practice. Changing schemes resets ~40% knowledge."}</div>
  <div style={GS.p}>{"Key traits: âš¡ Clutch, Â©ï¸ Captain (boosts team), ðŸ’ª Workhorse (faster dev), ðŸ›¡ï¸ Ironman (durability), â˜ ï¸ Cancer (avoid), ðŸ’€ Glass (injury-prone), ðŸ˜¤ Chip on Shoulder, ðŸ”„ Comeback Kid, ðŸ¡ Hometown Hero (takes discounts), ðŸ’° Money Hungry (demands max)."}</div>

  <div style={GS.sec}>{"SCOUTING & DRAFT"}</div>
  <div style={GS.p}>{"Start with 1,000 Scout Points (+25/win, +50/playoff win, +100 gym upgrade). Combine tests: Measurables (physical), Interview (IQ/fit/traits), Film Study (true OVR â€” most valuable). Draft: 7 rounds, 30 teams. Trade picks on the clock. Post-draft press conference affects morale/owner mood."}</div>
  <div style={GS.p}>{"Draft priority: QBs, EDGE, CBs first (highest variance + impact). Round 1-3 = starters, 4-5 = projects, 6-7 = hidden gems. Dev Trait > draft position long-term."}</div>

  <div style={GS.sec}>{"TRADING"}</div>
  <div style={GS.p}>{"Available Weeks 1-10 + offseason. Player Shop ('ðŸ›’ Shop' on any player card) gets instant AI offers. AI counter-offers with multi-player packages and conditional picks. GM archetypes affect trade tendencies. Rebuild-mode teams sell stars for picks. Contend-mode teams overpay for veterans. Grudge penalty for re-acquiring cut players."}</div>

  <div style={GS.sec}>{"COACHING & STAFF"}</div>
  <div style={GS.p}>{"Front Office: Asst GM + Scout Director + Analytics Coordinator. Coaching Carousel: hire/fire OC and DC coordinators. Coaching Clinic: XP-based perk tree (Leadership, Analytics, Development, Conditioning tiers). Position Battles during camp give dev boosts to winners. Cut Advisor recommends roster moves."}</div>
  <div style={GS.p}>{"Weekly Practice: ðŸ” Opponent Scout (system knowledge), ðŸ“ˆ Dev Camp (player growth), ðŸ§Š Recovery (injury reduction), ðŸ’ª Full Pads (balanced + injury risk). Rotate Scout and Pads during season."}</div>

  <div style={GS.sec}>{"RIVALRIES & TROPHIES"}</div>
  <div style={GS.p}>{"Heat builds 0-100 through matchups. At 60+ a trophy auto-generates (Cup, Bell, Boot, Axe, Shield, Flame, Hammer). Trophy changes hands each game. Rivalry Week: atmosphere effects (morale/chem boost, crowd bonus, injury risk). MFSN Rivalry Watch segment. View trophy case on âš”ï¸ Rivalries tab under Standings."}</div>

  <div style={GS.sec}>{"RELOCATION & STADIUM"}</div>
  <div style={GS.p}>{"After 3+ seasons with $30M+ cash: relocate to 10 cities (London, Mexico City, Toronto, Austin, Portland, St. Louis, Orlando, Las Cruces, Honolulu, Berlin). Each has unique market/prestige mods. Cost: $30-55M. 5-year cooldown. Stadium Naming Rights: 3 random sponsor deals per season for weekly revenue."}</div>

  <div style={GS.sec}>{"OWNER & LEGACY"}</div>
  <div style={GS.p}>{"Owner Mood 0-99. Below 30 = ultimatum. Below 15 = fired. Owner types: Patient, Meddler, Win-Now. Mandates: periodic objectives for goodwill. Dynasty Legacy Dashboard: composite score (wins, rings, playoffs, draft hits, cap, dev), 12 career milestones, era detection, Hall of Fame, franchise records."}</div>

  <div style={GS.sec}>{"MFSN BROADCAST"}</div>
  <div style={GS.p}>{"MFSN Weekly Show: 3 rotating anchors (Marcus Cole, Diana Chen, Big Trev) deliver Headlines, Power Rankings, Your Team analysis, Storylines, Hot Seat Watch, Rivalry Watch, and Press Conference. Your press answers affect morale and owner mood. Post-game Broadcast Breakdown: 3 Keys to Victory, Turning Point, Player of the Game."}</div>

  <div style={GS.sec}>{"EXECUTIVE QUICK TIPS"}</div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Build through the draft â€” rookie contracts are the cap advantage"}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Always carry a backup QB â€” one injury ends your season without one"}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Re-sign Superstar devs before FA â€” they price out on the open market"}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Pre-game + halftime effects stack â€” plan complementary strategies"}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Franchise Tag your best expiring player â€” cheaper than losing them"}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Defend rivalry trophies â€” they add to your dynasty legacy score"}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Stadium naming deals = free weekly revenue. Always pick one."}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"RBs/CBs decline fast after 27 â€” don't overinvest in aging players"}</div></div>
  <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Keyboard: D=Dashboard, R=Roster, G=Trade, O=Office. Ctrl+S saves."}</div></div>

                </div>
                <div style={GS.footer}>
                  <button onClick={function(){setShowHelp(false);}} style={GS.closeBtn}>{"CLOSE PLAYBOOK"}</button>
                </div>
              </div>
            </div>
          )}
          
          {crisisRoom && (function(){
            var cr=crisisRoom;
            var tier=cr.tier||"CRITICAL";
            var accentColor=CRISIS_ROOM.tierColors[tier]||"#f97316";
            var glowColor=CRISIS_ROOM.tierGlows[tier]||"rgba(249,115,22,0.25)";
            var bgGrad=CRISIS_ROOM.tierBg[tier]||"linear-gradient(135deg,rgba(249,115,22,0.14),rgba(249,115,22,0.03))";
            var tierLabel=CRISIS_ROOM.tierLabel[tier]||"âš ï¸ SITUATION";
            function handleCrisisChoice(action){
              if(!my)return;
              var fakeItem={id:"crisis_"+cr.eventId,eventId:cr.eventId};
              handleLockerChoice(fakeItem,action);
            }
            return React.createElement("div",{
              style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:98,
                background:"rgba(0,0,0,0.96)",display:"flex",alignItems:"center",
                justifyContent:"center",padding:12}},
              React.createElement("div",{
                style:{background:T.bg2,border:"2px solid "+accentColor,borderRadius:16,
                  maxWidth:520,width:"100%",overflow:"hidden",
                  boxShadow:"0 0 80px "+glowColor+", 0 0 0 1px rgba(0,0,0,0.5)"}},
                /* â”€â”€ Crisis Header â”€â”€ */
                React.createElement("div",{style:{background:bgGrad,padding:"18px 20px 14px",textAlign:"center",borderBottom:"1px solid rgba(255,255,255,0.06)"}},
                  React.createElement("div",{style:{fontSize:9,letterSpacing:3,color:accentColor,fontWeight:900,marginBottom:6,textTransform:"uppercase",opacity:0.9}},
                    tierLabel),
                  React.createElement("div",{style:{fontSize:44,lineHeight:1,marginBottom:10}},cr.icon||"âš¡"),
                  React.createElement("div",{style:{fontSize:22,fontWeight:900,color:"#fff",letterSpacing:0.5,textShadow:"0 0 20px "+accentColor}},
                    cr.headline||cr.label),
                  React.createElement("div",{style:{fontSize:10,color:accentColor,fontWeight:700,marginTop:4}},
                    "ðŸ“… Week "+(cr.week||"?")+" â€¢ "+(cr.teamAbbr||"TEAM")+" Front Office")
                ),
                /* â”€â”€ Situation Brief â”€â”€ */
                React.createElement("div",{style:{padding:"12px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"}},
                  React.createElement("div",{style:{fontSize:9,letterSpacing:2,color:T.faint,fontWeight:700,marginBottom:6,textTransform:"uppercase"}},
                    "ðŸ”´ SITUATION REPORT"),
                  React.createElement("div",{style:{fontSize:12,color:T.text,lineHeight:1.7,fontStyle:"italic",
                    padding:"10px 12px",background:"rgba(0,0,0,0.3)",borderRadius:8,
                    borderLeft:"3px solid "+accentColor}},
                    "\u201C"+cr.msg+"\u201D"),
                  cr.subtext && React.createElement("div",{style:{fontSize:10,color:T.dim,marginTop:8,fontStyle:"italic"}},
                    cr.subtext)
                ),
                /* â”€â”€ Decision Options â”€â”€ */
                React.createElement("div",{style:{padding:"12px 20px 6px"}},
                  React.createElement("div",{style:{fontSize:9,letterSpacing:2,color:T.faint,fontWeight:700,marginBottom:10,textTransform:"uppercase"}},
                    "ðŸˆ HEAD COACH DECISION â€” CHOOSE WISELY")
                ),
                React.createElement("div",{style:{padding:"0 20px 16px",display:"flex",flexDirection:"column",gap:8}},
                  cr.options&&cr.options.map(function(opt,oi){
                    var cons=CRISIS_ROOM.consequences[opt.action]||{short:opt.desc,risk:"Unknown",reward:"Unknown"};
                    var isFirst=oi===0;
                    return React.createElement("button",{key:oi,
                      style:{background:isFirst?"linear-gradient(135deg,"+accentColor+",rgba(0,0,0,0.4))":"rgba(255,255,255,0.04)",
                        border:"1px solid "+(isFirst?accentColor:"rgba(255,255,255,0.08)"),
                        borderRadius:10,padding:"12px 14px",cursor:"pointer",textAlign:"left",
                        color:"#fff",width:"100%",transition:"all 0.15s"},
                      onClick:function(){handleCrisisChoice(opt.action);}},
                      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:8}},
                        React.createElement("div",{style:{flex:1}},
                          React.createElement("div",{style:{fontSize:13,fontWeight:800,marginBottom:4}},opt.label),
                          React.createElement("div",{style:{fontSize:10,color:isFirst?accentColor:T.dim}},cons.short||opt.desc)
                        ),
                        React.createElement("div",{style:{flexShrink:0,textAlign:"right",fontSize:9}},
                          React.createElement("div",{style:{color:"#ef4444",marginBottom:2}},"\u26A0 "+cons.risk),
                          React.createElement("div",{style:{color:"#22c55e"}},"\u2713 "+cons.reward)
                        )
                      )
                    );
                  })
                ),
                /* â”€â”€ Footer â”€â”€ */
                React.createElement("div",{style:{padding:"0 20px 16px"}},
                  React.createElement("div",{style:{fontSize:9,color:T.faint,textAlign:"center",paddingTop:8,borderTop:"1px solid rgba(255,255,255,0.06)"}},
                    "This crisis will impact your franchise trajectory. There is no perfect answer.")
                )
              )
            );
          })()}

          {shareCardQueue.length>0 && (function(){
            var sc=shareCardQueue[0];
            var isMyP=sc.isMyPlayer;
            var accentColor=isMyP?T.gold:"#a855f7";
            var bgGrad=isMyP
              ?"linear-gradient(135deg,rgba(251,191,36,0.12),rgba(251,191,36,0.02))"
              :"linear-gradient(135deg,rgba(168,85,247,0.12),rgba(168,85,247,0.02))";
            function dismissCard(){setShareCardQueue(function(q){return q.slice(1);});}
            return React.createElement("div",{
              style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:97,
                background:"rgba(0,0,0,0.93)",display:"flex",alignItems:"center",
                justifyContent:"center",padding:12},
              onClick:dismissCard},
              React.createElement("div",{
                style:{background:T.bg2,border:"2px solid "+accentColor,borderRadius:16,
                  maxWidth:480,width:"100%",overflow:"hidden",
                  boxShadow:"0 0 60px "+(isMyP?"rgba(251,191,36,0.25)":"rgba(168,85,247,0.25)")},
                onClick:function(e){e.stopPropagation();}},
                /* â”€â”€ Header â”€â”€ */
                React.createElement("div",{style:{background:bgGrad,padding:"18px 20px 14px",textAlign:"center",borderBottom:"1px solid "+T.border}},
                  React.createElement("div",{style:{fontSize:9,letterSpacing:2,color:accentColor,fontWeight:800,marginBottom:4,textTransform:"uppercase"}},
                    "ðŸ›ï¸ ALL-TIME RECORD BROKEN"+(sc.isMyPlayer?" â€¢ YOUR PLAYER":"")),
                  React.createElement("div",{style:{fontSize:40,lineHeight:1.1,marginBottom:8}},sc.icon||"ðŸ†"),
                  React.createElement("div",{style:{fontSize:20,fontWeight:900,color:accentColor,letterSpacing:0.5}},sc.headline||"RECORD BROKEN"),
                  React.createElement("div",{style:{fontSize:13,color:T.dim,marginTop:4}},
                    (sc.teamIcon||"ðŸˆ")+" "+(sc.teamName||"")+" \u2022 Season "+(sc.season||""))
                ),
                /* â”€â”€ Player Block â”€â”€ */
                React.createElement("div",{style:{padding:"14px 20px",borderBottom:"1px solid "+T.border}},
                  React.createElement("div",{style:{display:"flex",alignItems:"center",gap:12}},
                    React.createElement("div",{style:{width:48,height:48,borderRadius:10,
                      background:"linear-gradient(135deg,"+accentColor+","+T.bg3+")",
                      display:"flex",alignItems:"center",justifyContent:"center",
                      fontSize:20,fontWeight:900,flexShrink:0}},
                      (sc.pos||"?").substring(0,2)),
                    React.createElement("div",null,
                      React.createElement("div",{style:{fontSize:17,fontWeight:900,color:T.text}},sc.playerName||"Unknown"),
                      React.createElement("div",{style:{fontSize:11,color:T.dim}},
                        (sc.pos||"")+" â€¢ "+(sc.teamName||"")+(sc.isMyPlayer?" â€¢ ðŸŒŸ YOUR FRANCHISE PLAYER":""))
                    )
                  )
                ),
                /* â”€â”€ Stats Row â”€â”€ */
                sc.stats&&sc.stats.length>0 && React.createElement("div",{
                  style:{display:"flex",gap:0,borderBottom:"1px solid "+T.border}},
                  sc.stats.slice(0,4).map(function(s,si){
                    return React.createElement("div",{key:si,
                      style:{flex:1,textAlign:"center",padding:"12px 6px",
                        borderRight:si<sc.stats.length-1?"1px solid "+T.border:"none"}},
                      React.createElement("div",{style:{fontSize:16,fontWeight:900,color:accentColor}},
                        typeof s.val==="number"?s.val.toLocaleString():s.val),
                      React.createElement("div",{style:{fontSize:8,color:T.faint,letterSpacing:1,marginTop:2,textTransform:"uppercase"}},s.label)
                    );
                  })
                ),
                /* â”€â”€ Queue indicator â”€â”€ */
                shareCardQueue.length>1 && React.createElement("div",{
                  style:{textAlign:"center",padding:"6px",fontSize:9,color:T.faint,borderBottom:"1px solid "+T.border}},
                  shareCardQueue.length-1+" more record"+(shareCardQueue.length-1>1?"s":"")+" broken this season!"
                ),
                /* â”€â”€ Buttons â”€â”€ */
                React.createElement("div",{style:{display:"flex",gap:10,padding:"14px 20px"}},
                  React.createElement("button",{
                    style:{flex:1,background:"linear-gradient(135deg,"+accentColor+","+(isMyP?"#d97706":"#7c3aed")+")",
                      color:"#000",border:"none",borderRadius:8,padding:"12px 0",
                      fontWeight:900,fontSize:13,cursor:"pointer",letterSpacing:0.5},
                    onClick:function(){
                      SHARE_CARD.generate({
                        icon:sc.icon,teamIcon:sc.teamIcon,teamName:sc.teamName,
                        teamColor:sc.teamColor,headline:sc.headline,
                        season:sc.season,record:sc.record||"",stats:sc.stats
                      },sc.filename||"record-break");
                      dismissCard();
                    }},
                    "ðŸ“¸ Download Card"),
                  shareCardQueue.length>1
                    ? React.createElement("button",{
                        style:{flex:1,background:T.bg3,color:T.text,border:"1px solid "+T.border,
                          borderRadius:8,padding:"12px 0",fontWeight:700,fontSize:13,cursor:"pointer"},
                        onClick:dismissCard},
                        "Next â†’ ("+(shareCardQueue.length-1)+" left)")
                    : React.createElement("button",{
                        style:{flex:1,background:T.bg3,color:T.dim,border:"1px solid "+T.border,
                          borderRadius:8,padding:"12px 0",fontWeight:700,fontSize:13,cursor:"pointer"},
                        onClick:dismissCard},
                        "âœ• Dismiss")
                )
              )
            );
          })()}

          {fieldGuide && (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:96,background:"rgba(0,0,0,0.95)",display:"flex",alignItems:"center",justifyContent:"center",padding:10}}
              onClick={function(){
                if(pendingDraft){
                  var pd=pendingDraft;setPendingDraft(null);
                  if(pd.type==="auction"){initExpAuctionDraft(pd.idx,pd.depth);}
                  else{initExpSnakeDraft(pd.idx,pd.depth);}
                }
                setFieldGuide(null);
              }}>
              <div style={mS({},GS.modal,{maxWidth:540})} onClick={function(e){e.stopPropagation();}}>
                <div style={GS.hdr}>
                  <div style={GS.hdrGold}/>
                  <div style={GS.hdrBadge}>{fieldGuide==="expansion"?"INAUGURAL OPERATIONS":fieldGuide==="draft"?"DRAFT ROOM BRIEF":fieldGuide==="fa"?"FREE AGENCY BRIEF":"OPERATIONS BRIEF"}</div>
                  <div style={GS.hdrTitle}>{
                    fieldGuide==="expansion"?"LEAGUE INAUGURAL DRAFT":
                    fieldGuide==="draft"?"DRAFT DAY OPERATIONS":
                    fieldGuide==="fa"?"FREE AGENCY MARKET":
                    "FIELD GUIDE"
                  }</div>
                  <div style={GS.hdrSub}>{
                    fieldGuide==="expansion"?"Build your franchise from a shared player pool":
                    fieldGuide==="draft"?"7 rounds to shape the next generation":
                    fieldGuide==="fa"?"Fill roster gaps before the new season":
                    ""
                  }</div>
                </div>
                <div style={GS.body}>
                  {fieldGuide==="expansion" && <div>
                    <div style={GS.sec}>{"DRAFT MECHANICS"}</div>
                    <div style={GS.p}>{"This is your League Inaugural Draft â€” a snake-style draft where all "+getLeagueTeamCountLabel97()+" teams build rosters from a shared player pool. When you're on the clock, pick the best player available. AI teams draft based on position need and player value when it's their turn."}</div>
                    <div style={GS.intel}><div style={GS.intelLabel}>{"DRAFT ORDER"}</div>{"Snake format: if you pick 5th overall in Round 1, you pick 26th in Round 2 (reverse order), 5th again in Round 3, etc. This balances early vs. late picks across all rounds."}</div>

                    <div style={GS.sec}>{"POSITION PRIORITY FRAMEWORK"}</div>
                    <div style={GS.p}>{"Not all positions are created equal. Follow this priority framework for maximum roster value:"}</div>
                    <table style={GS.tbl}>
                      <thead><tr><th style={GS.th}>{"Tier"}</th><th style={GS.th}>{"Positions"}</th><th style={GS.th}>{"Why"}</th></tr></thead>
                      <tbody>
                        <tr><td style={GS.td}>{"ðŸ”´ Critical"}</td><td style={GS.td}>{"QB, EDGE"}</td><td style={GS.td}>{"Highest impact, hardest to replace"}</td></tr>
                        <tr><td style={GS.td}>{"ðŸŸ  High"}</td><td style={GS.td}>{"CB, OT, WR"}</td><td style={GS.td}>{"Premium positions, scarce talent"}</td></tr>
                        <tr><td style={GS.td}>{"ðŸŸ¡ Medium"}</td><td style={GS.td}>{"LB, DT, S, TE"}</td><td style={GS.td}>{"Important but deeper talent pools"}</td></tr>
                        <tr><td style={GS.td}>{"ðŸŸ¢ Late"}</td><td style={GS.td}>{"RB, IOL, K, P"}</td><td style={GS.td}>{"Replaceable or low-impact"}</td></tr>
                      </tbody>
                    </table>
                    <div style={GS.tip}><div style={GS.tipLabel}>{"STRATEGY"}</div>{"QB first is always safe. Build inside-out: QB â†’ OL/DL â†’ skill positions â†’ depth. Don't forget K and P â€” they're required. Use position filters to find needs. Watch AI picks â€” if WRs are flying off the board, grab yours before they're gone."}</div>

                    <div style={GS.sec}>{"PLAYER EVALUATION"}</div>
                    <div style={GS.p}>{"OVR = current ability (higher is better). Age matters: a 22yr/78 OVR player is worth more than a 31yr/82 OVR because of development upside. After the draft, you'll enter Training Camp to evaluate your 75-man roster and cut to 53."}</div>
                    <div style={GS.intel}><div style={GS.intelLabel}>{"KEY METRICS"}</div>{"Look for: High OVR (immediate impact), Young age (development years), High POT (ceiling), and Dev Traits (ðŸŒŸ Superstar = 1.5Ã— growth rate). A 68 OVR / 90 POT Superstar rookie will be elite within 2 seasons."}</div>
                  </div>}

                  {fieldGuide==="draft" && <div>
                    <div style={GS.sec}>{"DRAFT MECHANICS"}</div>
                    <div style={GS.p}>{"7 rounds, all "+getLeagueTeamCountLabel97()+" teams. Draft order based on last season's standings (worst team picks first). You can trade picks during the draft â€” hit 'ðŸ”„ Trade Pick' when you're on the clock to see offers from AI teams."}</div>
                    <div style={GS.intel}><div style={GS.intelLabel}>{"ON-THE-CLOCK ACTIONS"}</div>{"Pick a player from the board, trade your pick to another team for players/picks, or trade UP by offering your future picks to move higher. AI teams will approach you with trade offers too."}</div>

                    <div style={GS.sec}>{"SCOUTING INTELLIGENCE"}</div>
                    <div style={GS.p}>{"Players you scouted during Combine show their true OVR and ALL their traits (up to 3). Unscouted players show fuzzy estimates â€” you might draft a bust or find a steal. Scouted players appear with a green checkmark."}</div>
                    <table style={GS.tbl}>
                      <thead><tr><th style={GS.th}>{"Scout Method"}</th><th style={GS.th}>{"Cost"}</th><th style={GS.th}>{"Reveals"}</th></tr></thead>
                      <tbody>
                        <tr><td style={GS.td}>{"ðŸƒ Measurables"}</td><td style={GS.td}>{"20-40 pts"}</td><td style={GS.td}>{"Speed, Strength, Motor"}</td></tr>
                        <tr><td style={GS.td}>{"ðŸŽ¤ Interview"}</td><td style={GS.td}>{"30-50 pts"}</td><td style={GS.td}>{"IQ, Scheme Fit, Traits"}</td></tr>
                        <tr><td style={GS.td}>{"ðŸŽ¬ Film Study"}</td><td style={GS.td}>{"40-60 pts"}</td><td style={GS.td}>{"True OVR, Hands, Technique"}</td></tr>
                      </tbody>
                    </table>

                    <div style={GS.sec}>{"DRAFT STRATEGY"}</div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Best Player Available (BPA) usually beats reaching for need"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Dev Traits matter more than draft position â€” ðŸŒŸ Superstar in Rd 3 > Normal in Rd 1"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Rounds 1-3: starters and immediate contributors"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Rounds 4-5: high-upside projects and depth"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Rounds 6-7: ðŸ’Ž hidden gems with high potential, special teams"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Undrafted players enter Free Agency after the draft completes"}</div></div>
                    <div style={GS.tip}><div style={GS.tipLabel}>{"POST-DRAFT"}</div>{"After your draft, a Press Conference lets you address the media. High-grade picks get praise; low-grade picks get scrutiny. Your answers affect morale and owner mood."}</div>
                  </div>}

                  {fieldGuide==="fa" && <div>
                    <div style={GS.sec}>{"MARKET MECHANICS"}</div>
                    <div style={GS.p}>{"The open market! Sign players to fill roster gaps. Every player has a market value based on OVR, age, and position scarcity. AI teams are also competing for the best available talent â€” top players go fast."}</div>
                    <table style={GS.tbl}>
                      <thead><tr><th style={GS.th}>{"Offer Type"}</th><th style={GS.th}>{"Success Rate"}</th><th style={GS.th}>{"Effect"}</th></tr></thead>
                      <tbody>
                        <tr><td style={GS.td}>{"ðŸ’Ž Pay Up"}</td><td style={GS.td}>{"~95%"}</td><td style={GS.td}>{"Guaranteed sign + bonus year. Premium price."}</td></tr>
                        <tr><td style={GS.td}>{"ðŸ“Š Market Rate"}</td><td style={GS.td}>{"~80%"}</td><td style={GS.td}>{"Fair offer. Standard contract."}</td></tr>
                        <tr><td style={GS.td}>{"ðŸ“‰ Lowball"}</td><td style={GS.td}>{"~60%"}</td><td style={GS.td}>{"Risky â€” may reject. Saves cap space."}</td></tr>
                        <tr><td style={GS.td}>{"â¬‡ï¸ League Min"}</td><td style={GS.td}>{"~40%"}</td><td style={GS.td}>{"1 year, cap-exempt. Rarely accepted by starters."}</td></tr>
                      </tbody>
                    </table>

                    <div style={GS.sec}>{"CAP MANAGEMENT"}</div>
                    <div style={GS.p}>{"Every signing counts against your $255M salary cap (grows ~5%/year). Plan 2-3 years ahead â€” a $20M/year deal for a 30-year-old WR looks different when they're 33 and declining. Use Franchise Tag in the Re-Sign Phase for your top expiring player before FA opens."}</div>
                    <div style={GS.warn}><div style={GS.warnLabel}>{"CAP WARNING"}</div>{"Don't spend your entire budget on one player. Leave at least $15M in cap space for mid-season acquisitions, injury replacements, and practice squad signings."}</div>

                    <div style={GS.sec}>{"FA STRATEGY"}</div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Fill your biggest needs first â€” starting QB > backup LB"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Filter by position to find exactly what you need"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Young FAs (24-27) have more upside than veterans"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Lowball mid-tier players â€” save premium offers for difference-makers"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"Check personality traits before signing â€” avoid â˜ ï¸ Cancer traits"}</div></div>
                    <div style={GS.row}><div style={GS.dot}/><div style={GS.li}>{"When done, hit 'Start Next Season' to begin the new year"}</div></div>
                    <div style={GS.tip}><div style={GS.tipLabel}>{"SLEEPER STRATEGY"}</div>{"After the draft, undrafted players flood the FA pool. Some have Superstar dev traits that every other team missed. Sort by potential and age to find bargains."}</div>
                  </div>}
                </div>
                <div style={GS.footer}>
                  <button onClick={function(){
                    if(pendingDraft){
                      var pd=pendingDraft;setPendingDraft(null);
                      if(pd.type==="auction"){initExpAuctionDraft(pd.idx,pd.depth);}
                      else{initExpSnakeDraft(pd.idx,pd.depth);}
                    }
                    setFieldGuide(null);
                  }} style={GS.goldBtn}>{
                    fieldGuide==="expansion"?"ENTER THE DRAFT ROOM ðŸˆ":
                    fieldGuide==="draft"?"START PICKING ðŸ“º":
                    fieldGuide==="fa"?"HIT THE MARKET ðŸª":
                    "GOT IT"
                  }</button>
                </div>
              </div>
            </div>
          )}
          
          {draftPresser975&&draftPresser975.questions&&draftPresser975.currentQ<draftPresser975.questions.length&&(
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.86)",zIndex:9400,display:"flex",alignItems:"center",justifyContent:"center",padding:16}}>
              <div style={{maxWidth:560,width:"100%",background:T.bg2,borderRadius:12,border:"1px solid rgba(251,191,36,0.3)",padding:20,boxShadow:"0 30px 80px rgba(0,0,0,0.6)"}}>
                <div style={{fontSize:14,fontWeight:900,color:T.gold,marginBottom:4}}>{"ðŸŽ¤ POST-DRAFT PRESS CONFERENCE"}</div>
                <div style={{fontSize:10,color:T.faint,marginBottom:6}}>
                  {"Draft Grade: "+((draftPresser975.grade&&draftPresser975.grade.grade)||"?")+" â€” "+((draftPresser975.grade&&draftPresser975.grade.analyst)||"MFSN")}
                </div>
                <div style={{fontSize:9,color:T.dim,marginBottom:14}}>
                  {"Question "+(draftPresser975.currentQ+1)+" of "+draftPresser975.questions.length}
                </div>
                {(function(){
                  var q975=draftPresser975.questions[draftPresser975.currentQ];
                  if(!q975)return null;
                  return <div>
                    <div style={{fontSize:12,fontWeight:700,color:"#e2e8f0",lineHeight:1.45,marginBottom:12}}>
                      {"\""+q975.q+"\""}
                    </div>
                    {(q975.opts||[]).map(function(opt,oi){
                      var fx=opt.effect||{};
                      var fxText=[];
                      if(fx.morale)fxText.push((fx.morale>0?"+":"")+fx.morale+" morale");
                      if(fx.chemistry)fxText.push((fx.chemistry>0?"+":"")+fx.chemistry+" chemistry");
                      if(fx.ownerMood)fxText.push((fx.ownerMood>0?"+":"")+fx.ownerMood+" owner");
                      return <button key={oi} onClick={function(){handleDraftPressAnswer975(draftPresser975.currentQ,oi);}}
                        style={{display:"block",width:"100%",textAlign:"left",padding:"10px 12px",marginBottom:6,borderRadius:8,cursor:"pointer",
                          border:"1px solid "+T.border,background:T.bg3,color:"#e2e8f0",fontSize:11,lineHeight:1.4}}>
                        <div>{opt.text}</div>
                        {fxText.length>0&&<div style={{fontSize:8,color:T.faint,marginTop:2}}>{fxText.join(" â€¢ ")}</div>}
                      </button>;
                    })}
                  </div>;
                })()}
              </div>
            </div>
          )}
          
          {draftPresser975&&draftPresser975.questions&&draftPresser975.currentQ>=draftPresser975.questions.length&&(
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.82)",zIndex:9400,display:"flex",alignItems:"center",justifyContent:"center",padding:16}}>
              <div style={{maxWidth:560,width:"100%",background:T.bg2,borderRadius:12,border:"1px solid rgba(251,191,36,0.25)",padding:20}}>
                <div style={{fontSize:13,fontWeight:900,color:T.gold,marginBottom:4}}>{"ðŸŽ¤ PRESS CONFERENCE COMPLETE"}</div>
                <div style={{fontSize:9,color:T.dim,marginBottom:10}}>
                  {"You wrapped the post-draft media session. Final grade: "+((draftPresser975.grade&&draftPresser975.grade.grade)||"?")}
                </div>
                <div style={{maxHeight:180,overflow:"auto",padding:"6px 8px",borderRadius:6,border:"1px solid "+T.border,background:"rgba(255,255,255,0.02)"}}>
                  {(draftPresser975.answers||[]).map(function(a975,ai975){
                    return <div key={ai975} style={{fontSize:9,color:T.dim,padding:"2px 0",lineHeight:1.35}}>
                      {"Q"+(ai975+1)+": \""+a975.text+"\""}
                    </div>;
                  })}
                </div>
                <button onClick={function(){setDraftPresser975(null);}}
                  style={{marginTop:10,fontSize:10,padding:"8px 12px",borderRadius:6,cursor:"pointer",background:T.gold,color:"#000",border:"none",fontWeight:800}}>
                  {"Continue to Free Agency â†’"}
                </button>
              </div>
            </div>
          )}
          
          {presser && presser.done && (
            <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:90,background:"rgba(0,0,0,0.92)",display:"flex",alignItems:"center",justifyContent:"center",padding:16}}>
              <div style={{background:T.bg2,border:"1px solid "+T.gold,borderRadius:12,padding:20,maxWidth:500,width:"100%",textAlign:"center"}}>
                <div style={{fontSize:28}}>ðŸŽ™ï¸</div>
                <div style={{fontWeight:800,color:T.gold,fontSize:16,marginBottom:12}}>PRESSER COMPLETE</div>
                <div style={{display:"flex",justifyContent:"center",gap:20,marginBottom:16}}>
                  <div><div style={{fontSize:9,color:T.faint}}>MORALE</div><div style={{fontSize:22,fontWeight:800,color:presser.summary.morale>=0?T.green:T.red}}>{(presser.summary.morale>=0?"+":"")+presser.summary.morale}</div></div>
                  <div><div style={{fontSize:9,color:T.faint}}>OWNER</div><div style={{fontSize:22,fontWeight:800,color:presser.summary.owner>=0?T.green:T.red}}>{(presser.summary.owner>=0?"+":"")+presser.summary.owner}</div></div>
                  {presser.summary.prep>0 && <div><div style={{fontSize:9,color:T.faint}}>OPP PREP</div><div style={{fontSize:22,fontWeight:800,color:T.red}}>{"+"+presser.summary.prep+"%"}</div></div>}
                </div>
                {presser.answers.map(function(ans,ai3){return <div key={ai3} style={{fontSize:11,color:T.dim,marginBottom:4,textAlign:"left"}}>
                  <span style={{color:T.gold}}>{"Q"+(ai3+1)+": "}</span>{ans.a}</div>;})}
                <button style={mS(S.btn,S.btnPrimary,{marginTop:16,width:"100%",padding:"12px 16px"})} onClick={function(){setPresser(null);}}>{"Continue â†’"}</button>
              </div>
            </div>
          )}
          
          {weekShow && weekShow.headlines && weekShow.headlines.length>0 && !theater && !selGame && !presser && (
            <div style={mS(S.ticker,{position:"fixed",bottom:0,left:0,right:0,zIndex:50,display:"flex",alignItems:"center",gap:8})}>
              <span style={{fontSize:7,color:T.dim,flexShrink:0,textTransform:"uppercase",letterSpacing:1}}>{"LIVE"}</span>
              <span style={{display:"inline-block",width:4,height:4,borderRadius:"50%",background:T.red,flexShrink:0,animation:"blink 1s infinite"}}/>
              <span style={{flex:1,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}>{weekShow.headlines[tickerIdx%weekShow.headlines.length]}</span>
            </div>
          )}
          
          {!theater && !selGame && !presser && !seasonReport && !preseasonReport && !fitDrilldown && !schemeConfirm && !showHelp && (function(){
            var fabLabel=null;var fabAction=null;
            var ph=season.phase;
            if(ph==="regular"&&!done){fabLabel="â–¶ Sim Wk "+season.week;fabAction=simWeek;}
            else if(ph==="regular"&&done){fabLabel="ðŸ† Playoffs";fabAction=function(){setSeason(function(s){return assign({},s,{phase:"playoffs"});});};}
            else if(ph==="preseason"){fabLabel="ðŸˆ Sim Preseason";fabAction=simWeek;}
            else if(ph==="cutDay"){fabLabel="âœ‚ï¸ Cut Day";fabAction=function(){setTab("roster");};}
            else if(ph==="reSign"){fabLabel="âœï¸ Re-Sign ("+reSignPool.length+")";fabAction=function(){setTab("reSign");};}
            else if(ph==="combine"){fabLabel="ðŸ” Scout";fabAction=function(){setTab("combine");};}
            else if(ph==="draft"){fabLabel="ðŸ“º Draft";fabAction=function(){startDraft();};}
            else if(ph==="drafting"){fabLabel="ðŸ“‹ Draft Board";fabAction=function(){setTab("draft");};}
            else if(ph==="freeAgency"){fabLabel="ðŸª Free Agents";fabAction=function(){setTab("fa");};}
            else if(tab==="depth"){fabLabel="âš¡ Auto-Optimize";fabAction=autoSortDepth;}
            else if(tab==="roster"){fabLabel="ðŸ“‹ Depth Chart";fabAction=function(){setTab("depth");};}
            if(!fabLabel)return null;
            var hasTickerBottom=weekShow&&weekShow.headlines&&weekShow.headlines.length>0&&ph==="regular"&&!done;
            return React.createElement("button",{style:mS(S.fab,{bottom:hasTickerBottom?36:16}),onClick:fabAction},fabLabel);
          })()}
          
          {showScanlines && <div style={S.scanlines}/>}
          <style>{"@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}} @keyframes fadeInOut{0%{opacity:0}10%{opacity:1}80%{opacity:1}100%{opacity:0}}"}</style>
          
          {autoSaveInd && <div style={{position:"fixed",bottom:60,right:16,background:T.bg2,color:T.dim,padding:"6px 14px",borderRadius:8,fontSize:11,fontWeight:600,border:"1px solid "+T.bg3,zIndex:9000,animation:"fadeInOut 1.4s ease-in-out forwards"}}>{autoSaveInd}</div>}
          
          {showKbHelp && <div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",zIndex:9500,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={function(){setShowKbHelp(false);}}>
            <div style={{background:T.bg2,border:"1px solid "+T.gold,borderRadius:12,padding:24,maxWidth:500,width:"90%",maxHeight:"80vh",overflowY:"auto"}} onClick={function(e){e.stopPropagation();}}>
              <div style={{fontSize:18,fontWeight:800,color:T.gold,marginBottom:16}}>{"âŒ¨ï¸ Keyboard Shortcuts"}</div>
              {HELP_SECTIONS.map(function(sec){
                return <div key={sec.title} style={{marginBottom:16}}>
                  <div style={{fontSize:12,fontWeight:700,color:T.cyan,marginBottom:6,textTransform:"uppercase"}}>{sec.title}</div>
                  {sec.keys.map(function(kb){
                    return <div key={kb.k} style={{display:"flex",justifyContent:"space-between",padding:"3px 0",fontSize:13}}>
                      <span style={{color:T.text,fontWeight:600}}>{kb.desc}</span>
                      <span style={{background:T.bg3,color:T.dim,padding:"2px 8px",borderRadius:4,fontFamily:"monospace",fontSize:11}}>{kb.k}</span>
                    </div>;
                  })}
                </div>;
              })}
              <div style={{fontSize:10,color:T.faint,marginTop:12}}>{"Tip: shortcuts are disabled while typing in boxes."}</div>
              <button onClick={function(){setShowKbHelp(false);}} style={{marginTop:12,background:T.gold,color:"#000",border:"none",borderRadius:6,padding:"8px 20px",fontWeight:700,cursor:"pointer"}}>{"Close (Esc)"}</button>
            </div>
          </div>}
          
          {importModal && <div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",zIndex:9500,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={function(){setImportModal(false);}}>
            <div style={{background:T.bg2,border:"1px solid "+T.cyan,borderRadius:12,padding:24,maxWidth:500,width:"90%"}} onClick={function(e){e.stopPropagation();}}>
              <div style={{fontSize:16,fontWeight:800,color:T.cyan,marginBottom:8}}>{"ðŸ“‹ Import Save"}</div>
              <div style={{fontSize:12,color:T.dim,marginBottom:12}}>{"Paste a save string to restore a league. This will overwrite your current league."}</div>
              <textarea value={importStr} onChange={function(e){setImportStr(e.target.value);}}
                placeholder="Paste your save string here..."
                style={{width:"100%",height:120,background:T.bg,color:T.text,border:"1px solid "+T.bg3,borderRadius:6,padding:10,fontSize:12,fontFamily:"monospace",resize:"vertical"}}/>
              <div style={{display:"flex",gap:8,marginTop:12}}>
                <button onClick={function(){
                  if(!importStr.trim()){addN("âŒ Paste a save string first.","red");return;}
                  importClipboard(importStr);setImportModal(false);setImportStr("");
                }} style={{background:T.cyan,color:"#000",border:"none",borderRadius:6,padding:"8px 20px",fontWeight:700,cursor:"pointer"}}>{"Overwrite & Import"}</button>
                <button onClick={function(){setImportModal(false);setImportStr("");}} style={{background:T.bg3,color:T.dim,border:"none",borderRadius:6,padding:"8px 20px",fontWeight:600,cursor:"pointer"}}>{"Cancel"}</button>
              </div>
              <div style={{fontSize:10,color:T.faint,marginTop:10}}>{"Move your league between devices by exporting a save string. Paste it on another computer to restore your league exactlyâ€”same teams, same seasons, same history."}</div>
            </div>
          </div>}
          
          {careerPage && <div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",zIndex:9500,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={function(){setCareerPage(null);}}>
            <div style={{background:T.bg2,border:"1px solid "+T.gold,borderRadius:12,padding:20,maxWidth:500,width:"90%",maxHeight:"80vh",overflow:"auto"}} onClick={function(e){e.stopPropagation();}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
                <div>
                  <div style={{fontSize:18,fontWeight:900,color:T.gold}}>{"ðŸ“Š "+careerPage.name}</div>
                  <div style={{fontSize:11,color:T.dim}}>{careerPage.pos+" | "+careerPage.teams.join(", ")+" | "+careerPage.yearsPlayed+" seasons"}</div>
                </div>
                <button onClick={function(){setCareerPage(null);}} style={{background:T.bg3,color:T.faint,border:"none",borderRadius:6,padding:"4px 10px",cursor:"pointer",fontSize:12}}>{"âœ•"}</button>
              </div>
              
              {careerPage.awards.length>0 && <div style={{marginBottom:8,display:"flex",gap:6,flexWrap:"wrap"}}>
                {careerPage.awards.map(function(a,ai){
                  return <span key={ai} style={{fontSize:9,padding:"2px 6px",borderRadius:4,background:"rgba(251,191,36,0.1)",
                    color:T.gold,fontWeight:700}}>{a.award+" "+a.year}</span>;
                })}
              </div>}
              
              <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:10}}>
                {[["Pass Yds",careerPage.career.passYds],["Pass TD",careerPage.career.passTD],
                  ["Rush Yds",careerPage.career.rushYds],["Rush TD",careerPage.career.rushTD],
                  ["Rec Yds",careerPage.career.recYds],["Sacks",careerPage.career.sacks],
                  ["INTs",careerPage.career.ints],["Tackles",careerPage.career.tackles]]
                  .filter(function(s){return s[1]>0;}).map(function(s,si){
                  return <div key={si} style={{background:T.bg3,borderRadius:4,padding:"4px 8px",textAlign:"center"}}>
                    <div style={{fontSize:12,fontWeight:800,color:T.cyan}}>{s[1].toLocaleString()}</div>
                    <div style={{fontSize:7,color:T.faint}}>{s[0]}</div>
                  </div>;
                })}
              </div>
              
              <div style={{fontSize:9,fontWeight:700,color:T.faint,marginBottom:4}}>{"SEASON-BY-SEASON"}</div>
              <div style={{maxHeight:200,overflow:"auto"}}>
                {careerPage.seasons.map(function(s,si){
                  var st=s.stats||{};
                  var line=s.pos==="QB"?(st.passYds||0)+"yds/"+(st.passTD||0)+"TD":
                    ["RB","WR","TE"].indexOf(s.pos)>=0?(st.rushYds||0)+"rush/"+(st.recYds||0)+"rec/"+(((st.rushTD||0)+(st.recTD||0)))+"TD":
                    (st.sacks||0)+"sck/"+(st.ints||0)+"INT/"+(st.tackles||0)+"tkl";
                  return <div key={si} style={{display:"flex",gap:6,alignItems:"center",padding:"3px 0",fontSize:9,
                    borderBottom:si<careerPage.seasons.length-1?"1px solid "+T.border:"none"}}>
                    <span style={{width:30,fontWeight:800,color:T.gold}}>{s.year}</span>
                    <span style={{width:30}}>{s.icon}</span>
                    <span style={{width:24,fontWeight:700}}>{s.team}</span>
                    <span style={{width:20,color:T.cyan}}>{s.ovr}</span>
                    <span style={{width:16,color:T.dim}}>{"Age "+s.age}</span>
                    <span style={{flex:1,color:T.text}}>{line}</span>
                  </div>;
                })}
              </div>
            </div>
          </div>}
          
          {/* v97.7: Pre-Game Speech Overlay */}
          {gameDayPhase977==="pregame"&&pregameTalk977&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.92)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"}}>
            <div style={{maxWidth:520,width:"90%",background:T.bg2,borderRadius:12,border:"1px solid "+(rivalryAtmo977?"rgba(239,68,68,0.4)":"rgba(99,102,241,0.4)"),padding:24}}>
              <div style={{fontSize:14,fontWeight:900,color:T.text,marginBottom:4}}>{"ðŸˆ GAME DAY â€” WEEK "+season.week}</div>
              <div style={{fontSize:11,color:T.dim,marginBottom:4}}>{(my?my.icon+my.abbr:"YOUR TEAM")+" vs "+(oppTeam977?oppTeam977.icon+oppTeam977.abbr:"???")}</div>
              {gotwData977&&gotwData977.isUser&&<div style={{fontSize:9,color:T.gold,fontWeight:800,marginBottom:6}}>{"ðŸ“º NATIONALLY TELEVISED â€” GAME OF THE WEEK"}</div>}
              {rivalryAtmo977&&<div style={{fontSize:10,color:"#ef4444",fontWeight:700,marginBottom:6}}>{rivalryAtmo977.emoji+" "+rivalryAtmo977.label}</div>}
              <div style={{fontSize:12,fontWeight:800,color:T.text,marginTop:10,marginBottom:8}}>{"ðŸŽ¤ Pre-Game Speech"}</div>
              {pregameTalk977.map(function(speech,si){
                return <button key={si} onClick={function(){handlePregameSpeech977(speech.id);}}
                  style={{display:"block",width:"100%",textAlign:"left",padding:"10px 14px",marginBottom:6,borderRadius:8,cursor:"pointer",border:"1px solid "+T.border,background:T.bg3,color:"#e2e8f0",fontSize:11,lineHeight:1.4}}>
                  <div style={{fontWeight:700}}>{speech.label}</div>
                  <div style={{fontSize:10,color:T.dim,marginTop:2,fontStyle:"italic"}}>{"\""+speech.text+"\""}</div>
                  <div style={{fontSize:8,color:T.faint,marginTop:2}}>{speech.desc}</div>
                </button>;
              })}
              <button onClick={function(){handlePregameSpeech977("focus");}} style={{fontSize:9,color:T.faint,marginTop:4,cursor:"pointer",background:"none",border:"none",textDecoration:"underline"}}>{"Skip speech â†’"}</button>
            </div>
          </div>}
          {/* v97.7: Halftime Adjustment Overlay */}
          {gameDayPhase977==="halftime"&&halftimePanel977&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.92)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"}}>
            <div style={{maxWidth:500,width:"90%",background:T.bg2,borderRadius:12,border:"1px solid rgba(59,130,246,0.4)",padding:24}}>
              <div style={{fontSize:14,fontWeight:900,color:T.text,marginBottom:4}}>{"ðŸˆ HALF-TIME ADJUSTMENTS"}</div>
    {(function(){var _hsc=lg&&lg.hScore||0;var _asc=lg&&lg.aScore||0;var _usr=lg&&lg.userId===((lg.homeTeam||{}).id)?"home":"away";var _myS=_usr==="home"?_hsc:_asc;var _opS=_usr==="home"?_asc:_hsc;var _mArr=_myS>_opS?MFSN_DRIVES_994.momentum.takeLead:_opS>_myS?MFSN_DRIVES_994.momentum.comeback:MFSN_DRIVES_994.momentum.extendLead;if(_mArr&&_mArr.length)return <div style={{padding:"5px 10px",marginBottom:8,borderRadius:5,background:"rgba(212,167,75,0.05)",borderLeft:"3px solid rgba(212,167,75,0.2)"}}><div style={{fontSize:8,fontWeight:700,color:T.gold,marginBottom:2}}>{"HALFTIME"}</div><div style={{fontSize:9,color:T.dim,fontStyle:"italic",lineHeight:1.4}}>{pick(_mArr)}</div></div>;return null;})()}
              {halftimePanel977.speechLabel&&<div style={{fontSize:9,color:T.faint,marginBottom:8}}>{"Pre-game: "+halftimePanel977.speechLabel+" âœ“"}</div>}
              <div style={{fontSize:11,color:T.dim,marginBottom:8}}>{"How do you approach the second half?"}</div>
    {(function(){var _cpvk=["grinder_workEthic","hothead_pressure","professor_discipline","zen_ambition"];var _cpvkey=_cpvk[Math.floor(RNG.ui()*_cpvk.length)];var _cpvArr=COACH_PLAYER_VOICE_994.synergy&&COACH_PLAYER_VOICE_994.synergy[_cpvkey];if(_cpvArr&&_cpvArr.length)return <div style={{padding:"5px 10px",marginBottom:8,borderRadius:5,background:"rgba(59,130,246,0.05)",borderLeft:"3px solid rgba(59,130,246,0.25)"}}><div style={{fontSize:8,fontWeight:700,color:"#60a5fa",marginBottom:2}}>{"COACH VOICE"}</div><div style={{fontSize:9,color:T.dim,fontStyle:"italic",lineHeight:1.4}}>{"â€œ"+pick(_cpvArr)+"â€"}</div></div>;return null;})()}
              {halftimePanel977.adjustments.map(function(adj,ai){
                return <button key={ai} onClick={function(){handleHalftimeChoice977(adj.id);}}
                  style={{display:"block",width:"100%",textAlign:"left",padding:"10px 14px",marginBottom:6,borderRadius:8,cursor:"pointer",border:"1px solid "+T.border,background:T.bg3,color:"#e2e8f0",fontSize:11,lineHeight:1.4}}>
                  <div style={{fontWeight:700}}>{adj.label}</div>
                  <div style={{fontSize:10,color:T.dim,marginTop:2,fontStyle:"italic"}}>{"\""+adj.text+"\""}</div>
                  <div style={{fontSize:8,color:T.faint,marginTop:2}}>{adj.desc}</div>
                </button>;
              })}
            </div>
          </div>}
          {/* v97.7: Post-Game Locker Room */}
          {gameDayPhase977==="postgame"&&postgameLocker977&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:9998,display:"flex",alignItems:"center",justifyContent:"center"}}>
            <div style={{maxWidth:480,width:"90%",background:postgameLocker977.mood==="euphoric"||postgameLocker977.mood==="satisfied"||postgameLocker977.mood==="relieved"?"rgba(16,15,30,0.98)":"rgba(20,10,10,0.98)",borderRadius:12,border:"1px solid "+(postgameLocker977.mood==="euphoric"?"rgba(16,185,129,0.4)":postgameLocker977.mood==="devastated"?"rgba(239,68,68,0.4)":T.border),padding:24}}>
              <div style={{fontSize:12,fontWeight:900,color:postgameLocker977.mood==="euphoric"||postgameLocker977.mood==="relieved"||postgameLocker977.mood==="satisfied"?T.green:"#ef4444",marginBottom:8}}>{"ðŸšª LOCKER ROOM â€” "+postgameLocker977.mood.toUpperCase()}</div>
              {(function(){var _lrk=postgameLocker977.mood==="euphoric"||postgameLocker977.mood==="satisfied"||postgameLocker977.mood==="relieved"?LOCKER_ROOM_994.chemistry.highChemBonus:LOCKER_ROOM_994.chemistry.lowChemTension;if(_lrk&&_lrk.length)return <div style={{marginBottom:8,padding:"5px 10px",borderRadius:5,background:"rgba(212,167,75,0.04)",borderLeft:"3px solid rgba(212,167,75,0.25)"}}><div style={{fontSize:8,fontWeight:700,color:T.gold,marginBottom:2}}>{"LOCKER ROOM"}</div><div style={{fontSize:9,color:T.dim,fontStyle:"italic",lineHeight:1.4}}>{"â€œ"+pick(_lrk)+"â€"}</div></div>;return null;})()}
          {postgameLocker977.locker.map(function(quote,qi){
                return <div key={qi} style={{marginBottom:8,padding:"6px 10px",background:"rgba(255,255,255,0.03)",borderRadius:6,borderLeft:"3px solid "+T.cyan}}>
                  <div style={{fontSize:9,fontWeight:700,color:T.cyan}}>{quote.player+" ("+quote.pos+")"}</div>
                  <div style={{fontSize:10,color:T.dim,fontStyle:"italic",marginTop:2,lineHeight:1.4}}>{"\""+quote.quote+"\""}</div>
                </div>;
              })}
              <button onClick={function(){setGameDayPhase977(null);setPostgameLocker977(null);}} style={{marginTop:8,fontSize:11,padding:"8px 16px",borderRadius:6,cursor:"pointer",background:T.bg3,color:T.text,border:"1px solid "+T.border,fontWeight:700}}>{"Continue â†’"}</button>
            </div>
          </div>}
          {React.createElement(ToastContainer,{toasts:toasts,remove:removeToast,onAction:handleToastAction})}
        </div>
      </div>
    );
    }catch(leagueErr){console.error("LEAGUE RENDER CRASH:",leagueErr);return <div style={{padding:40,color:"#ef4444",background:"#0f172a",minHeight:"100vh",fontFamily:"monospace"}}><h2>{"ðŸš¨ League Screen Crash"}</h2><pre style={{whiteSpace:"pre-wrap",fontSize:12}}>{String(leagueErr)+"\n\n"+leagueErr.stack}</pre><button onClick={function(){setScreen("title");}} style={{marginTop:20,padding:"10px 20px",background:"#fbbf24",color:"#000",border:"none",borderRadius:6,fontWeight:700,cursor:"pointer"}}>{"â† Back to Title"}</button></div>;}
  }
  return (
    <div style={{minHeight:"100vh",background:T.bg,color:T.text,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"'Inter',sans-serif"}}>
      <button style={bS()} onClick={function(){setScreen("title");}}>â† Mr. Football</button>
    </div>
  );
}
export default function App(){
  try{
    return AppCore();
  }catch(appBootErr){
    try{console.error("APP BOOT CRASH:",appBootErr);}catch(_c){}
    return (
      <div style={{minHeight:"100vh",background:"#0f172a",color:"#ef4444",padding:24,fontFamily:"monospace"}}>
        <h2>{"ðŸš¨ App Boot Crash"}</h2>
        <pre style={{whiteSpace:"pre-wrap",fontSize:12}}>{String(appBootErr)+"\n\n"+(appBootErr&&appBootErr.stack?appBootErr.stack:"")}</pre>
      </div>
    );
  }
}
